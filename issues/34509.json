{
  "type": "issue",
  "issue": {
    "id": 3900215683,
    "node_id": "I_kwDOABII587oeJGD",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34509",
    "number": 34509,
    "state": "open",
    "state_reason": null,
    "title": "test: Replace hardcoded time.sleep() with smart polling",
    "body": "### Please describe the feature you'd like to see added.\n\nFound several hardcoded `time.sleep()` calls in functional tests that waste CI time:\n\n- `wallet_encryption.py:55` - always sleeps 3s for timeout test\n- `p2p_leak.py:139` - sleeps 5s waiting for peer timeout  \n- `feature_dbcrash.py:96` - 1s sleep in crash recovery\n- Framework sync functions default to 1s waits\n\nThese add up to significant overhead. For example, the wallet test could poll the wallet lock state instead of waiting 3 full seconds.\n\nProposal: Replace with `wait_until()` pattern already used elsewhere in the codebase. Should save 30+ minutes on full test runs.\n\nHappy to work on this if there's interest.\n\n### Is your feature related to a problem, if so please describe it.\n\nFound several hardcoded time.sleep() calls in functional tests that waste CI time:\n\n- wallet_encryption.py:55 - always sleeps 3s for timeout test\n- p2p_leak.py:139 - sleeps 5s waiting for peer timeout  \n- feature_dbcrash.py:96 - 1s sleep in crash recovery\n- Framework sync functions default to 1s waits\n\nThese add up to significant overhead across the test suite. The wallet test could poll the wallet lock state instead of waiting 3 full seconds every time.\n\n### Describe the solution you'd like\n\nReplace hardcoded sleeps with the wait_until() pattern already used elsewhere in the codebase. \n\nFor example, instead of time.sleep(3) in the wallet test, poll the wallet lock status until the condition is met (with a timeout for safety).\n\nShould save 30+ minutes on full test runs while maintaining the same reliability.\n\n### Describe any alternatives you've considered\n\nConsidered leaving things as it is, but the time waste is noticeable during development. Could also just reduce the hardcoded values, but smart polling is more robust.\n\n### Please leave any additional context\n\nHappy to implement this if there's interest. The wait_until() pattern is already used throughout the test framework, so this would just be applying it more consistently.",
    "user": {
      "login": "Hijanhv",
      "id": 128885110,
      "node_id": "U_kgDOB66hdg",
      "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Hijanhv",
      "html_url": "https://github.com/Hijanhv",
      "followers_url": "https://api.github.com/users/Hijanhv/followers",
      "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
      "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
      "repos_url": "https://api.github.com/users/Hijanhv/repos",
      "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 0,
    "created_at": "2026-02-05T07:59:19Z",
    "updated_at": "2026-02-05T07:59:19Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 22550721535,
      "node_id": "LE_lADOABII587oeJGDzwAAAAVAILP_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22550721535",
      "actor": {
        "login": "Hijanhv",
        "id": 128885110,
        "node_id": "U_kgDOB66hdg",
        "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Hijanhv",
        "html_url": "https://github.com/Hijanhv",
        "followers_url": "https://api.github.com/users/Hijanhv/followers",
        "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
        "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
        "repos_url": "https://api.github.com/users/Hijanhv/repos",
        "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T07:59:21Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    }
  ]
}
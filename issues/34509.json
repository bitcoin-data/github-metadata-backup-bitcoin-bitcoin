{
  "type": "issue",
  "issue": {
    "id": 3900215683,
    "node_id": "I_kwDOABII587oeJGD",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34509",
    "number": 34509,
    "state": "open",
    "state_reason": null,
    "title": "test: Replace hardcoded time.sleep() with smart polling",
    "body": "### Please describe the feature you'd like to see added.\n\nFound several hardcoded `time.sleep()` calls in functional tests that waste CI time:\n\n- `wallet_encryption.py:55` - always sleeps 3s for timeout test\n- `p2p_leak.py:139` - sleeps 5s waiting for peer timeout  \n- `feature_dbcrash.py:96` - 1s sleep in crash recovery\n- Framework sync functions default to 1s waits\n\nThese add up to significant overhead. For example, the wallet test could poll the wallet lock state instead of waiting 3 full seconds.\n\nProposal: Replace with `wait_until()` pattern already used elsewhere in the codebase. Should save 30+ minutes on full test runs.\n\nHappy to work on this if there's interest.\n\n### Is your feature related to a problem, if so please describe it.\n\nFound several hardcoded time.sleep() calls in functional tests that waste CI time:\n\n- wallet_encryption.py:55 - always sleeps 3s for timeout test\n- p2p_leak.py:139 - sleeps 5s waiting for peer timeout  \n- feature_dbcrash.py:96 - 1s sleep in crash recovery\n- Framework sync functions default to 1s waits\n\nThese add up to significant overhead across the test suite. The wallet test could poll the wallet lock state instead of waiting 3 full seconds every time.\n\n### Describe the solution you'd like\n\nReplace hardcoded sleeps with the wait_until() pattern already used elsewhere in the codebase. \n\nFor example, instead of time.sleep(3) in the wallet test, poll the wallet lock status until the condition is met (with a timeout for safety).\n\nShould save 30+ minutes on full test runs while maintaining the same reliability.\n\n### Describe any alternatives you've considered\n\nConsidered leaving things as it is, but the time waste is noticeable during development. Could also just reduce the hardcoded values, but smart polling is more robust.\n\n### Please leave any additional context\n\nHappy to implement this if there's interest. The wait_until() pattern is already used throughout the test framework, so this would just be applying it more consistently.",
    "user": {
      "login": "Hijanhv",
      "id": 128885110,
      "node_id": "U_kgDOB66hdg",
      "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Hijanhv",
      "html_url": "https://github.com/Hijanhv",
      "followers_url": "https://api.github.com/users/Hijanhv/followers",
      "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
      "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
      "repos_url": "https://api.github.com/users/Hijanhv/repos",
      "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "created_at": "2026-02-05T07:59:19Z",
    "updated_at": "2026-02-05T10:47:13Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 22550721535,
      "node_id": "LE_lADOABII587oeJGDzwAAAAVAILP_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22550721535",
      "actor": {
        "login": "Hijanhv",
        "id": 128885110,
        "node_id": "U_kgDOB66hdg",
        "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Hijanhv",
        "html_url": "https://github.com/Hijanhv",
        "followers_url": "https://api.github.com/users/Hijanhv/followers",
        "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
        "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
        "repos_url": "https://api.github.com/users/Hijanhv/repos",
        "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T07:59:21Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 3851779857,
      "node_id": "IC_kwDOABII587llX8R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3851779857",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T08:19:04Z",
      "updated_at": "2026-02-05T08:19:04Z",
      "author_association": "MEMBER",
      "body": "> `feature_dbcrash.py:96` - 1s sleep in crash recovery\n\nYeah, I guess it could be cleaner code to wait on the Popen object\n\n\n\n\n> Proposal: Replace with `wait_until()` pattern already used elsewhere in the codebase. Should save 30+ minutes on full test runs.\n\nidk, this is just ai llm slop? The full test run takes less than 30 minutes, so this can't possibly make the tests pass in negative time.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34509#issuecomment-3851779857",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509"
    },
    {
      "event": "commented",
      "id": 3852734075,
      "node_id": "IC_kwDOABII587lpA57",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3852734075",
      "actor": {
        "login": "Hijanhv",
        "id": 128885110,
        "node_id": "U_kgDOB66hdg",
        "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Hijanhv",
        "html_url": "https://github.com/Hijanhv",
        "followers_url": "https://api.github.com/users/Hijanhv/followers",
        "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
        "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
        "repos_url": "https://api.github.com/users/Hijanhv/repos",
        "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T10:47:13Z",
      "updated_at": "2026-02-05T10:47:13Z",
      "author_association": "NONE",
      "body": "@maflcko You're right about the math - I overstated the savings. Looking more carefully:\n\n- The 3s wallet timeout happens once per test run, not per test\n- Framework sync calls might save a few seconds total across all tests  \n- Realistic savings: probably 5-10 seconds per test run\n\nThe main benefit is developer experience when running individual tests during development, not massive CI savings. Thanks for the reality check.",
      "user": {
        "login": "Hijanhv",
        "id": 128885110,
        "node_id": "U_kgDOB66hdg",
        "avatar_url": "https://avatars.githubusercontent.com/u/128885110?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Hijanhv",
        "html_url": "https://github.com/Hijanhv",
        "followers_url": "https://api.github.com/users/Hijanhv/followers",
        "following_url": "https://api.github.com/users/Hijanhv/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Hijanhv/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Hijanhv/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Hijanhv/subscriptions",
        "organizations_url": "https://api.github.com/users/Hijanhv/orgs",
        "repos_url": "https://api.github.com/users/Hijanhv/repos",
        "events_url": "https://api.github.com/users/Hijanhv/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Hijanhv/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34509#issuecomment-3852734075",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34509"
    },
    {
      "event": "mentioned",
      "id": 22554816774,
      "node_id": "MEE_lADOABII587oeJGDzwAAAAVAXzEG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22554816774",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T10:47:14Z"
    },
    {
      "event": "subscribed",
      "id": 22554816809,
      "node_id": "SE_lADOABII587oeJGDzwAAAAVAXzEp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22554816809",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T10:47:14Z"
    }
  ]
}
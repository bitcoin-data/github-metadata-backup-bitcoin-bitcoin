{
  "type": "issue",
  "issue": {
    "id": 3527492138,
    "node_id": "I_kwDOABII587SQUIq",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33647",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33647/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33647/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33647/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33647",
    "number": 33647,
    "state": "open",
    "state_reason": null,
    "title": "[`v30.0`] `createNewBlock` never returns",
    "body": "while connected to `testnet4` and letting the current implementation of SRI client connected for a while, `bitcoin-node` stops responding to IPC calls\n\nsteps to reproduce:\n- build `bitcoin-node` from `v30.0` tag\n- clone https://github.com/plebhash/sv2-bitcoin-core\n- check out `2025-10-17-hanging-ipc` branch\n- launch `bitcoin-node` with `-testnet4 -ipc-bind=unix -debug=ipc`\n- launch `sv2-bitcoin-core` with `RUST_LOG=debug cargo run --example logger \"/path/to/node.sock\"`\n- let it run for a while (for me it took ~25 minutes)\n\neventually, the logs on the rust client start to look like this:\n```\n2025-10-17T15:29:29.614817Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:29:29.614853Z DEBUG bitcoin_core_sv2: Received: CoinbaseOutputConstraints: CoinbaseOutputConstraints(coinbase_output_max_additional_size: 2, coinbase_output_max_additional_sigops: 2)\n2025-10-17T15:29:29.614934Z DEBUG bitcoin_core_sv2: monitor_incoming_messages() processing message\n2025-10-17T15:29:29.614973Z DEBUG bitcoin_core_sv2: Received CoinbaseOutputConstraints - max_additional_size: 2, max_additional_sigops: 2\n2025-10-17T15:29:29.615022Z DEBUG bitcoin_core_sv2: handle_coinbase_output_constraints() called\n2025-10-17T15:29:29.615058Z DEBUG bitcoin_core_sv2: Cancelling template_ipc_client_cancellation_token\n2025-10-17T15:29:29.615099Z DEBUG bitcoin_core_sv2: Creating new template IPC client with new constraints\n2025-10-17T15:29:29.615139Z DEBUG bitcoin_core_sv2: new_template_ipc_client() called - max_size: 2, max_sigops: 2\n2025-10-17T15:29:29.615219Z DEBUG bitcoin_core_sv2: Setting block_reserved_weight: 2000\n2025-10-17T15:29:29.615255Z DEBUG bitcoin_core_sv2: Sending createNewBlock request to Bitcoin Core\n2025-10-17T15:29:39.616976Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:29:49.619034Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:29:59.621747Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:30:09.624253Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:30:19.625848Z  INFO logger: Sent new CoinbaseOutputConstraints\n2025-10-17T15:30:29.627359Z  INFO logger: Sent new CoinbaseOutputConstraints\n```\n\nthis is a clear indication that `createNewBlock` IPC call got stuck and never returned\n\nthe rust client becomes unkillable via ctrl+c, since there's hanging futures inside... so the process must be killed with other methods\n\nif we restart the rust client, the normal bootstrapping process doesn't go through, which indicates that `bitcoin-node` is no longer able to respond to any IPC calls whatsoever\n\nadditionally, `bitcoin-node` also becomes unkillable via ctrl+c\n\n---\n\nhere's logs of `bitcoin-node` around the timestamp where `createNewBlock` IPC call got stuck:\n\n```\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server send response #347 BlockTemplate.waitNext$Results (result = <external capability>)\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server send response #349 BlockTemplate.waitNext$Results (result = <external capability>)\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server recv request  #350 BlockTemplate.getBlock$Params (context = (thread = <external capability>))\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server post request  #350 {bitcoin-node-58573/26538479 (from )}\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server recv request  #351 BlockTemplate.getBlock$Params (context = (thread = <external capability>))\n2025-10-17T15:29:24Z [ipc] {bitcoin-node-58573/b-capnp-loop-26537354} IPC server post request  #351 {bitcoin-node-58573/26538479 (from )}\n2025-10-17T15:42:11Z Saw new header hash=000000001fe51f6e5b13b64e87e1c66f475adc2b4fa97b0b39c7b9a20fe0ea0e height=106954 peer=5\n2025-10-17T15:42:11Z UpdateTip: new best=000000001fe51f6e5b13b64e87e1c66f475adc2b4fa97b0b39c7b9a20fe0ea0e height=106954 version=0x20000000 log2_work=74.802497 tx=12113955 date='2025-10-17T17:42:11Z' progress=1.000000 cache=0.3MiB(337txo)\n2025-10-17T15:42:11Z Saw new header hash=00000000e206db80ad182ffdabc05bf9f6a1e13bd62b5ec4a51750c42e456648 height=106954 peer=8\n2025-10-17T15:45:11Z New block-relay-only v2 peer connected: version: 70016, blocks=106954, peer=15\n2025-10-17T15:58:34Z New block-relay-only v2 peer connected: version: 70016, blocks=106954, peer=16\n2025-10-17T15:59:44Z New block-relay-only v2 peer connected: version: 70016, blocks=106954, peer=17\n2025-10-17T16:02:12Z Saw new cmpctblock header hash=000000009a3bbd6b55b974200199e2cb7272deb8c892d2ee7b4215ec9b1e0876 height=106955 peer=4\n2025-10-17T16:02:12Z UpdateTip: new best=000000009a3bbd6b55b974200199e2cb7272deb8c892d2ee7b4215ec9b1e0876 height=106955 version=0x20000000 log2_work=74.802497 tx=12113988 date='2025-10-17T18:02:12Z' progress=1.000000 cache=0.3MiB(342txo)\n2025-10-17T16:04:58Z Flushed fee estimates to fee_estimates.dat.\n2025-10-17T16:22:13Z Saw new header hash=0000000073d29bfc7123c09a0dda5e64bd3e58383d85621c64625fad817215fa height=106956 peer=5\n2025-10-17T16:22:13Z Saw new header hash=0000000001f79e1b92f6f254cc5a5ff72bb8ce76731c53d50c28176663949972 height=106956 peer=1\n2025-10-17T16:22:13Z UpdateTip: new best=0000000001f79e1b92f6f254cc5a5ff72bb8ce76731c53d50c28176663949972 height=106956 version=0x20000000 log2_work=74.802497 tx=12114006 date='2025-10-17T18:22:13Z' progress=1.000000 cache=0.3MiB(391txo)\n2025-10-17T16:22:13Z Saw new header hash=00000000a820139f0791d0a2994bec73a29cb8563c34f4a68b96d7fe31cac7ef height=106956 peer=10\n2025-10-17T16:35:29Z New block-relay-only v2 peer connected: version: 70016, blocks=106956, peer=19\n2025-10-17T16:36:29Z New block-relay-only v2 peer connected: version: 70016, blocks=106956, peer=20\n2025-10-17T16:39:45Z Saw new cmpctblock header hash=00000000000000015ef791c938c1399989dcc68ead8057c508e03e585d2110c0 height=106957 peer=4\n2025-10-17T16:39:45Z UpdateTip: new best=00000000000000015ef791c938c1399989dcc68ead8057c508e03e585d2110c0 height=106957 version=0x200f2000 log2_work=74.803065 tx=12114029 date='2025-10-17T16:42:09Z' progress=1.000000 cache=0.3MiB(429txo)\n```\n\ncc @ryanofsky ",
    "user": {
      "login": "plebhash",
      "id": 147345153,
      "node_id": "U_kgDOCMhPAQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/147345153?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/plebhash",
      "html_url": "https://github.com/plebhash",
      "followers_url": "https://api.github.com/users/plebhash/followers",
      "following_url": "https://api.github.com/users/plebhash/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/plebhash/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/plebhash/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/plebhash/subscriptions",
      "organizations_url": "https://api.github.com/users/plebhash/orgs",
      "repos_url": "https://api.github.com/users/plebhash/repos",
      "events_url": "https://api.github.com/users/plebhash/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/plebhash/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 0,
    "created_at": "2025-10-17T20:42:18Z",
    "updated_at": "2025-10-17T20:45:52Z"
  },
  "events": []
}
{
  "type": "issue",
  "issue": {
    "id": 278179354,
    "node_id": "MDU6SXNzdWUyNzgxNzkzNTQ=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/11800",
    "number": 11800,
    "state": "open",
    "state_reason": null,
    "title": "Bitcoin is returning higher fees for 36 block window than 2 block window (on testnet)",
    "body": "In testnet, right now, `estimatesmartfee` is returning *higher* estimates for 36 block window than 2 block window. The results:\r\n\r\n```\r\nestimatesmartfee 2 ->\r\n{\r\n  \"feerate\": 0.01254483,\r\n  \"blocks\": 2\r\n}\r\n\r\nestimatesmartfee 36 ->\r\n{\r\n  \"feerate\": 0.03863968,\r\n  \"blocks\": 36\r\n}\r\n\r\n\r\nestimaterawfee 2 ->\r\n{\r\n  \"short\": {\r\n    \"decay\": 0.962,\r\n    \"scale\": 1,\r\n    \"fail\": {\r\n      \"startrange\": 490954,\r\n      \"endrange\": 1e+99,\r\n      \"withintarget\": 35,\r\n      \"totalconfirmed\": 35.41,\r\n      \"inmempool\": 165,\r\n      \"leftmempool\": 0\r\n    },\r\n    \"errors\": [\r\n      \"Insufficient data or no feerate found which meets threshold\"\r\n    ]\r\n  },\r\n  \"medium\": {\r\n    \"feerate\": 0.01254483,\r\n    \"decay\": 0.9952,\r\n    \"scale\": 2,\r\n    \"pass\": {\r\n      \"startrange\": 626596,\r\n      \"endrange\": 1e+99,\r\n      \"withintarget\": 38,\r\n      \"totalconfirmed\": 38.96,\r\n      \"inmempool\": 1,\r\n      \"leftmempool\": 0\r\n    },\r\n    \"fail\": {\r\n      \"startrange\": 596758,\r\n      \"endrange\": 626596,\r\n      \"withintarget\": 15.9,\r\n      \"totalconfirmed\": 50.78,\r\n      \"inmempool\": 14,\r\n      \"leftmempool\": 0\r\n    }\r\n  },\r\n  \"long\": {\r\n    \"decay\": 0.99931,\r\n    \"scale\": 24,\r\n    \"fail\": {\r\n      \"startrange\": 799713,\r\n      \"endrange\": 1e+99,\r\n      \"withintarget\": 138.78,\r\n      \"totalconfirmed\": 147.56,\r\n      \"inmempool\": 1,\r\n      \"leftmempool\": 0\r\n    },\r\n    \"errors\": [\r\n      \"Insufficient data or no feerate found which meets threshold\"\r\n    ]\r\n  }\r\n}\r\n\r\nestimaterawfee 36 ->\r\n{\r\n  \"medium\": {\r\n    \"feerate\": 0.01254483,\r\n    \"decay\": 0.9952,\r\n    \"scale\": 2,\r\n    \"pass\": {\r\n      \"startrange\": 690822,\r\n      \"endrange\": 1e+99,\r\n      \"withintarget\": 37.33,\r\n      \"totalconfirmed\": 38.19,\r\n      \"inmempool\": 1,\r\n      \"leftmempool\": 0\r\n    },\r\n    \"fail\": {\r\n      \"startrange\": 596758,\r\n      \"endrange\": 690822,\r\n      \"withintarget\": 47.22,\r\n      \"totalconfirmed\": 51.99,\r\n      \"inmempool\": 12,\r\n      \"leftmempool\": 0\r\n    }\r\n  },\r\n  \"long\": {\r\n    \"decay\": 0.99931,\r\n    \"scale\": 24,\r\n    \"fail\": {\r\n      \"startrange\": 799713,\r\n      \"endrange\": 1e+99,\r\n      \"withintarget\": 139.47,\r\n      \"totalconfirmed\": 147.66,\r\n      \"inmempool\": 1,\r\n      \"leftmempool\": 0\r\n    },\r\n    \"errors\": [\r\n      \"Insufficient data or no feerate found which meets threshold\"\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nI am also attaching fee_estimates.dat\r\n\r\n[fee_estimates.dat.zip](https://github.com/bitcoin/bitcoin/files/1518545/fee_estimates.dat.zip)\r\n\r\nOf course testnet is always \"weird\", but 36 block estimate being higher than 2 block estimate doesn't make sense, even on testnet.\r\n\r\nThe version of bitcoind is v0.15.0.0",
    "user": {
      "login": "karelbilek",
      "id": 104945,
      "node_id": "MDQ6VXNlcjEwNDk0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/104945?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karelbilek",
      "html_url": "https://github.com/karelbilek",
      "followers_url": "https://api.github.com/users/karelbilek/followers",
      "following_url": "https://api.github.com/users/karelbilek/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/karelbilek/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/karelbilek/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/karelbilek/subscriptions",
      "organizations_url": "https://api.github.com/users/karelbilek/orgs",
      "repos_url": "https://api.github.com/users/karelbilek/repos",
      "events_url": "https://api.github.com/users/karelbilek/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/karelbilek/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 82428251,
        "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
        "name": "TX fees and policy",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 6,
    "created_at": "2017-11-30T16:15:10Z",
    "updated_at": "2017-12-06T17:07:47Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 1365977935,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTM2NTk3NzkzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1365977935",
      "actor": {
        "login": "karelbilek",
        "id": 104945,
        "node_id": "MDQ6VXNlcjEwNDk0NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/104945?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/karelbilek",
        "html_url": "https://github.com/karelbilek",
        "followers_url": "https://api.github.com/users/karelbilek/followers",
        "following_url": "https://api.github.com/users/karelbilek/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/karelbilek/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/karelbilek/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/karelbilek/subscriptions",
        "organizations_url": "https://api.github.com/users/karelbilek/orgs",
        "repos_url": "https://api.github.com/users/karelbilek/repos",
        "events_url": "https://api.github.com/users/karelbilek/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/karelbilek/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-30T16:17:06Z",
      "rename": {
        "from": "Bitcoind is returning higher fees for 36 block window than 2 block window",
        "to": "Bitcoin is returning higher fees for 36 block window than 2 block window (on testnet)"
      }
    },
    {
      "event": "labeled",
      "id": 1366254681,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDEzNjYyNTQ2ODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1366254681",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-30T18:37:52Z",
      "label": {
        "name": "TX fees and policy",
        "color": "5319e7"
      }
    },
    {
      "event": "commented",
      "id": 348280430,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODI4MDQzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/348280430",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-11-30T18:38:23Z",
      "updated_at": "2017-11-30T18:38:23Z",
      "author_association": "MEMBER",
      "body": "> Of course testnet is always \"weird\", but 36 block estimate being higher than 2 block estimate doesn't make sense, even on testnet.\r\n\r\nYes, that seems wrong.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-348280430",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "commented",
      "id": 349343598,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTM0MzU5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349343598",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-05T15:42:35Z",
      "updated_at": "2017-12-05T15:42:35Z",
      "author_association": "MEMBER",
      "body": "Question about the fee_estimates file you attached.  Did you quit bitcoind before grabbing it, or is that the file that was in place while it was running?",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349343598",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "commented",
      "id": 349361281,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTM2MTI4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349361281",
      "actor": {
        "login": "karelbilek",
        "id": 104945,
        "node_id": "MDQ6VXNlcjEwNDk0NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/104945?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/karelbilek",
        "html_url": "https://github.com/karelbilek",
        "followers_url": "https://api.github.com/users/karelbilek/followers",
        "following_url": "https://api.github.com/users/karelbilek/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/karelbilek/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/karelbilek/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/karelbilek/subscriptions",
        "organizations_url": "https://api.github.com/users/karelbilek/orgs",
        "repos_url": "https://api.github.com/users/karelbilek/repos",
        "events_url": "https://api.github.com/users/karelbilek/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/karelbilek/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-05T16:35:44Z",
      "updated_at": "2017-12-05T16:35:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "Oh. I don't remember at this point, but I probably forgot that it's written\nonly on turn-off and I copied from a live node, so it's useless. Sorry\n\nOn Dec 5, 2017 4:43 PM, \"Alex Morcos\" <notifications@github.com> wrote:\n\n> Question about the fee_estimates file you attached. Did you quit bitcoind\n> before grabbing it, or is that the file that was in place while it was\n> running?\n>\n> â€”\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349343598>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAGZ8WloqN4hL17wYMpG400k6jN49bx_ks5s9WSggaJpZM4Qwztn>\n> .\n>\n",
      "user": {
        "login": "karelbilek",
        "id": 104945,
        "node_id": "MDQ6VXNlcjEwNDk0NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/104945?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/karelbilek",
        "html_url": "https://github.com/karelbilek",
        "followers_url": "https://api.github.com/users/karelbilek/followers",
        "following_url": "https://api.github.com/users/karelbilek/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/karelbilek/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/karelbilek/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/karelbilek/subscriptions",
        "organizations_url": "https://api.github.com/users/karelbilek/orgs",
        "repos_url": "https://api.github.com/users/karelbilek/repos",
        "events_url": "https://api.github.com/users/karelbilek/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/karelbilek/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349361281",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "commented",
      "id": 349396568,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTM5NjU2OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349396568",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-05T18:29:10Z",
      "updated_at": "2017-12-05T18:29:10Z",
      "author_association": "MEMBER",
      "body": "That's ok, I think I have an idea for what the issue is, and perhaps a way to fix it.",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349396568",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "commented",
      "id": 349697807,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTY5NzgwNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349697807",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-06T16:38:45Z",
      "updated_at": "2017-12-06T16:38:45Z",
      "author_association": "MEMBER",
      "body": "OK, so I believe I understand the bug.\r\nestimatesmartfee takes the max of three different sub-estimates:\r\n- 60% threshold at half the target\r\n- 85% threshold at the target\r\n- 95% threshold at double the target\r\n\r\nAn estimate for a higher target should be monotonically decreasing in each of those 3 sub-estimates.  So therefore the final estimates should also be monotonically decreasing.\r\n\r\nHowever, there is the possibility that one of the sub-estimates is unable to return an estimate because there is no fee rate that is high enough to meet the threshold.  The algorithm was designed to just return the max of the other sub-estimates in this case with the reasoning being that it is better to give some estimate rather than give up and revert to the fallback fee or have a potentially computationally expensive search for the lowest target which is able to return all sub-estimates.   The downside of this is that if a higher target can return that sub-estimate, it might actually be higher than either of the other sub-estimates at the lower target and cause a final estimate which is actually greater for the higher target.\r\n\r\nAlthough it's not ideal, I think this falls in the category of \"won't fix\".  What is really happening in this edge case is that the estimate for the lower target is perhaps not as high as it should be.  But in analyzing a proper fix, I think that time would be better spent either doing a wholesale improvement to fee estimation, or working on better RBF or CPFP tools.\r\n\r\nI believe that given current fee markets this should be very unlikely on mainnet, and that if conditions were to arise that made this more likely, we probably need a better fee estimation algorithm anyway.  Also the raw data is accessible through estimaterawfee which could allow anyone to make their own more complicated combination of sub-estimates if they really care.\r\n\r\n",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349697807",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "commented",
      "id": 349707510,
      "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTcwNzUxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/349707510",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-12-06T17:07:47Z",
      "updated_at": "2017-12-06T17:07:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "It might be good to update the existing code comment to mention the edge case, since it's easy to read it and think that monoticity will always be preserved:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/497d0e014cc79d46531d570e74e4aeae72db602d/src/policy/fees.cpp#L860-L868",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/11800#issuecomment-349707510",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11800"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "conscott",
        "id": 14220652,
        "node_id": "MDQ6VXNlcjE0MjIwNjUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/14220652?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/conscott",
        "html_url": "https://github.com/conscott",
        "followers_url": "https://api.github.com/users/conscott/followers",
        "following_url": "https://api.github.com/users/conscott/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/conscott/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/conscott/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/conscott/subscriptions",
        "organizations_url": "https://api.github.com/users/conscott/orgs",
        "repos_url": "https://api.github.com/users/conscott/repos",
        "events_url": "https://api.github.com/users/conscott/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/conscott/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2018-03-18T14:40:18Z",
      "updated_at": "2018-03-18T14:40:18Z",
      "source": {
        "issue": {
          "id": 305951775,
          "node_id": "MDU6SXNzdWUzMDU5NTE3NzU=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12706",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/12706/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/12706",
          "number": 12706,
          "state": "closed",
          "state_reason": "completed",
          "title": "Estimatesmartfee is easily gameable by miners",
          "body": "<!-- This issue tracker is only for technical issues related to Bitcoin Core.\r\n\r\nGeneral bitcoin questions and/or support requests are best directed to the Bitcoin StackExchange at https://bitcoin.stackexchange.com.\r\n\r\nFor reporting security issues, please read instructions at https://bitcoincore.org/en/contact/.\r\n\r\nIf the node is \"stuck\" during sync or giving \"block checksum mismatch\" errors, please ensure your hardware is stable by running memtest and observe CPU temperature with a load-test tool such as linpack before creating an issue! -->\r\n\r\n<!-- Describe the issue -->\r\n\r\nCurrently on testnet, estimatesmartfee 3 displays \r\nfeerate: 0.01502015. This is a ridiculous value because the blocks are not full and the reason is that some of the miners for some reasons currently do not mine segwit transactions at all. Since some of these segwit transactions carry a huge fee and are nevertheless not mined, the estimatesmartfee increases the estimate to take it into account.\r\n\r\n<!--- What behavior did you expect? -->\r\n\r\nThe estimate algorithm believes the reason the transactions are not mined are too low fees but there are apparently non-monetary reasons. I think the algorithm should also look at the transaction with the  5-10% lowest fees to check if there are lower-paying transactions that are confirmed and in this case, lower the estimate to these values since it means that such a fee is enough. Without such a check even a small cartel of the miners can significantly increase the estimates (by not confirming several percent of the high-paying transactions) and since the estimator is fairly widely used can book a profit. Even now, there are a few miners on the mainnet (e.g. bw.com) that do not mine segwit transactions at all and it's possible that there is some impact on the estimatesmartfee for 1 or 2 blocks\r\n\r\nOf course, if estimatesmartfee  looks at the bottom 5-10% of the transactions, the miners can game the estimate downwards (by confirming below market fee transactions) but at least in this case, the gaming cannot be profitable is is, in my opinion, preferable to the current system. \r\n\r\n<!--- What was the actual behavior (provide screenshots if the issue is GUI-related)? -->\r\n\r\n<!--- How reliably can you reproduce the issue, what are the steps to do so? -->\r\n\r\n<!-- What version of Bitcoin Core are you using, where did you get it (website, self-compiled, etc)? -->\r\n\r\n<!-- What type of machine are you observing the error on (OS/CPU and disk type)? -->\r\n\r\n<!-- Any extra information that might be useful in the debugging process. -->\r\n<!--- This is normally the contents of a `debug.log` or `config.log` file. Raw text or a link to a pastebin type site are preferred. -->\r\n",
          "user": {
            "login": "Raulo",
            "id": 630679,
            "node_id": "MDQ6VXNlcjYzMDY3OQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/630679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Raulo",
            "html_url": "https://github.com/Raulo",
            "followers_url": "https://api.github.com/users/Raulo/followers",
            "following_url": "https://api.github.com/users/Raulo/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Raulo/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Raulo/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Raulo/subscriptions",
            "organizations_url": "https://api.github.com/users/Raulo/orgs",
            "repos_url": "https://api.github.com/users/Raulo/repos",
            "events_url": "https://api.github.com/users/Raulo/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Raulo/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64584,
              "node_id": "MDU6TGFiZWw2NDU4NA==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
              "name": "Brainstorming",
              "color": "ebd775",
              "default": false
            },
            {
              "id": 82428251,
              "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
              "name": "TX fees and policy",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "NONE",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 4,
          "closed_at": "2021-01-27T14:44:55Z",
          "created_at": "2018-03-16T14:35:53Z",
          "updated_at": "2022-08-18T18:34:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "tonymorony",
        "id": 24797699,
        "node_id": "MDQ6VXNlcjI0Nzk3Njk5",
        "avatar_url": "https://avatars.githubusercontent.com/u/24797699?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tonymorony",
        "html_url": "https://github.com/tonymorony",
        "followers_url": "https://api.github.com/users/tonymorony/followers",
        "following_url": "https://api.github.com/users/tonymorony/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tonymorony/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tonymorony/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tonymorony/subscriptions",
        "organizations_url": "https://api.github.com/users/tonymorony/orgs",
        "repos_url": "https://api.github.com/users/tonymorony/repos",
        "events_url": "https://api.github.com/users/tonymorony/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tonymorony/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-19T21:47:22Z",
      "updated_at": "2020-08-19T21:47:22Z",
      "source": {
        "issue": {
          "id": 682202739,
          "node_id": "MDU6SXNzdWU2ODIyMDI3Mzk=",
          "url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework/issues/710",
          "repository_url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework",
          "labels_url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework/issues/710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework/issues/710/comments",
          "events_url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework/issues/710/events",
          "html_url": "https://github.com/KomodoPlatform/komodo-defi-framework/issues/710",
          "number": 710,
          "state": "closed",
          "state_reason": "completed",
          "title": "BTC fees estimations displaying per kilobyte",
          "body": "as a user faced no-go BTC<->X swaps problem, BTC tx fees from estimatesmartfee are way to high if compare with average tx fee:\r\n\r\n```json\r\ncurl --url \"http://127.0.0.1:7783\" --data \"{\\\"userpass\\\":\\\"$userpass\\\",\\\"method\\\":\\\"get_trade_fee\\\",\\\"coin\\\":\\\"BTC\\\"}\"\r\n{\"result\":{\"amount\":\"0.00148896\",\"amount_fraction\":{\"denom\":\"3125000\",\"numer\":\"4653\"},\"amount_rat\":[[1,[4653]],[1,[3125000]]],\"coin\":\"BTC\"}}\r\n```\r\n\r\n```json\r\nbitcoin-cli estimatesmartfee 1 ECONOMICAL\r\n{\r\n  \"feerate\": 0.00148896,\r\n  \"blocks\": 2\r\n}\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/24797699/90691429-88bc3500-e29d-11ea-8cfd-dc740cda17da.png)\r\n\r\nWhat is 15$ per transaction, but according to https://bitinfocharts.com/comparison/bitcoin-transactionfees.html or https://txstreet.com/ avg. fee is ~3-5$ at the moment, what is few times less (segwit fees are 30-40% lower afaik so it might be the case partially)\r\n\r\nbtw according to that issue this call might have bugs: https://github.com/bitcoin/bitcoin/issues/11800\r\n\r\nBTC fees calc is quite complicated matter as I understand (after reding https://bitcointechtalk.com/an-introduction-to-bitcoin-core-fee-estimation-27920880ad0 and https://scholarworks.sjsu.edu/cgi/viewcontent.cgi?article=1637&context=etd_projects https://bitcointechtalk.com/an-introduction-to-bitcoin-core-fee-estimation-27920880ad0) \r\n\r\nIt's reflections mostly, unlikely it's possible to get BTC fees some trustable way (maybe from oracle?). Therefore we getting fees for ETH from API (gasstation) :)\r\n\r\nMy only idea on how to improve that without API usage is \"custom tx fee\" for BTC txs in trades which expereienced users might set similar as it's possible to set for withdrawal calls.\r\n\r\nMost practical solution imo is to use some BTC pegged asset for such BTC applications as atomic swaps. There is https://wbtc.network/ for example, but funny thing is that now avg. ETH tx fees almost on the same level with BTC avg. tx fees (but since we getting it from gasstation it's 4-5 times lower than for BTC fees  atm in adex)",
          "user": {
            "login": "tonymorony",
            "id": 24797699,
            "node_id": "MDQ6VXNlcjI0Nzk3Njk5",
            "avatar_url": "https://avatars.githubusercontent.com/u/24797699?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tonymorony",
            "html_url": "https://github.com/tonymorony",
            "followers_url": "https://api.github.com/users/tonymorony/followers",
            "following_url": "https://api.github.com/users/tonymorony/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/tonymorony/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/tonymorony/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/tonymorony/subscriptions",
            "organizations_url": "https://api.github.com/users/tonymorony/orgs",
            "repos_url": "https://api.github.com/users/tonymorony/repos",
            "events_url": "https://api.github.com/users/tonymorony/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/tonymorony/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 824820434,
              "node_id": "MDU6TGFiZWw4MjQ4MjA0MzQ=",
              "url": "https://api.github.com/repos/KomodoPlatform/komodo-defi-framework/labels/bug",
              "name": "bug",
              "description": "Something isn't working",
              "color": "d73a4a",
              "default": true
            }
          ],
          "assignee": {
            "login": "sergeyboyko0791",
            "id": 58207208,
            "node_id": "MDQ6VXNlcjU4MjA3MjA4",
            "avatar_url": "https://avatars.githubusercontent.com/u/58207208?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sergeyboyko0791",
            "html_url": "https://github.com/sergeyboyko0791",
            "followers_url": "https://api.github.com/users/sergeyboyko0791/followers",
            "following_url": "https://api.github.com/users/sergeyboyko0791/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sergeyboyko0791/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sergeyboyko0791/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sergeyboyko0791/subscriptions",
            "organizations_url": "https://api.github.com/users/sergeyboyko0791/orgs",
            "repos_url": "https://api.github.com/users/sergeyboyko0791/repos",
            "events_url": "https://api.github.com/users/sergeyboyko0791/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sergeyboyko0791/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "sergeyboyko0791",
              "id": 58207208,
              "node_id": "MDQ6VXNlcjU4MjA3MjA4",
              "avatar_url": "https://avatars.githubusercontent.com/u/58207208?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/sergeyboyko0791",
              "html_url": "https://github.com/sergeyboyko0791",
              "followers_url": "https://api.github.com/users/sergeyboyko0791/followers",
              "following_url": "https://api.github.com/users/sergeyboyko0791/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/sergeyboyko0791/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/sergeyboyko0791/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/sergeyboyko0791/subscriptions",
              "organizations_url": "https://api.github.com/users/sergeyboyko0791/orgs",
              "repos_url": "https://api.github.com/users/sergeyboyko0791/repos",
              "events_url": "https://api.github.com/users/sergeyboyko0791/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/sergeyboyko0791/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "COLLABORATOR",
          "locked": false,
          "comments": 9,
          "closed_at": "2021-02-05T08:30:09Z",
          "created_at": "2020-08-19T21:47:21Z",
          "updated_at": "2021-02-05T08:30:09Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-27T15:08:33Z",
      "updated_at": "2021-01-27T15:08:33Z",
      "source": {
        "issue": {
          "id": 771447280,
          "node_id": "MDU6SXNzdWU3NzE0NDcyODA=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20725",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20725/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20725/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20725/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/20725",
          "number": 20725,
          "state": "open",
          "state_reason": null,
          "title": "EstimateMedianVal returns higher fee for higher confTarget",
          "body": "Running on recent master, commit f1dbf92ff0475a01d20170ea422c1d086acbbc57\r\n\r\nIf I run:\r\n```\r\ntest/functional/feature_fee_estimation.py --randomseed 108574360997204915\r\n```\r\n\r\nI get:\r\n```\r\n2020-12-19T20:14:06.175000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_bcwexp78\r\n2020-12-19T20:14:07.738000Z TestFramework (INFO): This test is time consuming, please be patient\r\n2020-12-19T20:14:07.738000Z TestFramework (INFO): Splitting inputs so we can generate tx's\r\n2020-12-19T20:14:10.870000Z TestFramework (INFO): Finished splitting\r\n2020-12-19T20:14:12.104000Z TestFramework (INFO): Will output estimates for 1/2/3/6/15/25 blocks\r\n2020-12-19T20:14:12.104000Z TestFramework (INFO): Creating transactions and mining them with a block size that can't keep up\r\n2020-12-19T20:14:15.879000Z TestFramework (INFO): Creating transactions and mining them at a block size that is just big enough\r\n2020-12-19T20:14:21.104000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/sdaftuar/ccl-bitcoin/2020-12-latest-master/test/functional/test_framework/test_framework.py\", line 126, in main\r\n    self.run_test()\r\n  File \"test/functional/feature_fee_estimation.py\", line 256, in run_test\r\n    check_estimates(self.nodes[1], self.fees_per_kb)\r\n  File \"test/functional/feature_fee_estimation.py\", line 140, in check_estimates\r\n    check_smart_estimates(node, fees_seen)\r\n  File \"test/functional/feature_fee_estimation.py\", line 130, in check_smart_estimates\r\n    % (feerate, last_feerate))\r\nAssertionError: Estimated fee (0.000565) larger than last fee (0.000479) for lower number of confirms\r\n\r\n```",
          "user": {
            "login": "sdaftuar",
            "id": 7463573,
            "node_id": "MDQ6VXNlcjc0NjM1NzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sdaftuar",
            "html_url": "https://github.com/sdaftuar",
            "followers_url": "https://api.github.com/users/sdaftuar/followers",
            "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
            "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
            "repos_url": "https://api.github.com/users/sdaftuar/repos",
            "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            },
            {
              "id": 82428251,
              "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
              "name": "TX fees and policy",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 11,
          "created_at": "2020-12-19T20:16:36Z",
          "updated_at": "2023-07-06T20:40:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-10-03T07:04:23Z",
      "updated_at": "2021-10-03T07:04:23Z",
      "source": {
        "issue": {
          "id": 1014290176,
          "node_id": "I_kwDOABII5848dNcA",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23165",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23165/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23165/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23165/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/23165",
          "number": 23165,
          "state": "open",
          "state_reason": "reopened",
          "title": "qa: Intermittent failure in `feature_fee_estimation.py`",
          "body": "On master (29b030bca31d1246e94b3396b0a01a17dadc96a8), native [Windows build](https://api.cirrus-ci.com/v1/task/6631349290270720/logs/functional_tests.log):\r\n\r\n```\r\n50/221 - feature_fee_estimation.py failed, Duration: 49 s\r\nstdout:\r\n2021-10-01T09:05:04.925000Z TestFramework (INFO): Initializing test directory C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\test_runner_â‚¿_ðŸƒ_20211001_084858\\feature_fee_estimation_176\r\n2021-10-01T09:05:07.559000Z TestFramework (INFO): This test is time consuming, please be patient\r\n2021-10-01T09:05:07.559000Z TestFramework (INFO): Splitting inputs so we can generate tx's\r\n2021-10-01T09:05:15.861000Z TestFramework (INFO): Finished splitting\r\n2021-10-01T09:05:18.194000Z TestFramework (INFO): Will output estimates for 1/2/3/6/15/25 blocks\r\n2021-10-01T09:05:18.194000Z TestFramework (INFO): Creating transactions and mining them with a block size that can't keep up\r\n2021-10-01T09:05:33.053000Z TestFramework (INFO): Creating transactions and mining them at a block size that is just big enough\r\n2021-10-01T09:05:53.747000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\test_framework\\test_framework.py\", line 131, in main\r\n    self.run_test()\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_fee_estimation.py\", line 272, in run_test\r\n    check_estimates(self.nodes[1], self.fees_per_kb)\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_fee_estimation.py\", line 156, in check_estimates\r\n    check_smart_estimates(node, fees_seen)\r\n  File \"C:\\Users\\ContainerAdministrator\\AppData\\Local\\Temp\\cirrus-ci-build\\test\\functional\\feature_fee_estimation.py\", line 146, in check_smart_estimates\r\n    raise AssertionError(f\"Estimated fee ({feerate}) larger than last fee ({last_feerate}) for lower number of confirms\")\r\nAssertionError: Estimated fee (0.00029) larger than last fee (0.0002826) for lower number of confirms\r\n```\r\n\r\nSimilar issues are known (#11800, #20725), but I'm not sure all failures are the same.",
          "user": {
            "login": "hebasto",
            "id": 32963518,
            "node_id": "MDQ6VXNlcjMyOTYzNTE4",
            "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hebasto",
            "html_url": "https://github.com/hebasto",
            "followers_url": "https://api.github.com/users/hebasto/followers",
            "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
            "organizations_url": "https://api.github.com/users/hebasto/orgs",
            "repos_url": "https://api.github.com/users/hebasto/repos",
            "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/hebasto/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 13,
          "created_at": "2021-10-03T07:04:23Z",
          "updated_at": "2023-07-06T21:30:42Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-05-20T14:48:19Z",
      "updated_at": "2022-05-20T14:48:19Z",
      "source": {
        "issue": {
          "id": 1243252494,
          "node_id": "I_kwDOABII585KGocO",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25179",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25179/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25179/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25179/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/25179",
          "number": 25179,
          "state": "closed",
          "state_reason": "completed",
          "title": "\"Estimated fee out of range\" intermittent failure in feature_fee_estimation.py",
          "body": "https://cirrus-ci.com/task/4707498732027904 on [nowallet libbitcoinkernel] [bionic]\r\n\r\n```bash\r\n node1 2022-05-20T14:25:48.635128Z [httpworker.3] [policy/fees.cpp:365] [EstimateMedianVal] FeeEst: 1 > 95% decay 0.99520: feerate: 307809 from (301403 - 348912) 100.00% 34.4/(34.4 0 mem 0.0 out) Fail: (247965 - 301403) 86.60% 32.3/(32.3 5 mem 0.0 out) \r\n node1 2022-05-20T14:25:48.635669Z [httpworker.3] [policy/fees.cpp:365] [EstimateMedianVal] FeeEst: 1 > 95% decay 0.99931: feerate: 732088 from (515502 - 1e+99) 100.00% 156.5/(156.5 0 mem 0.0 out) Fail: (247965 - 515502) 93.92% 154.6/(154.6 10 mem 0.0 out) \r\n test  2022-05-20T14:25:48.638000Z TestFramework (ERROR): Assertion failed \r\n                                   Traceback (most recent call last):\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 133, in main\r\n                                       self.run_test()\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_fee_estimation.py\", line 297, in run_test\r\n                                       self.sanity_check_estimates_range()\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_fee_estimation.py\", line 205, in sanity_check_estimates_range\r\n                                       check_estimates(self.nodes[1], self.fees_per_kb)\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_fee_estimation.py\", line 114, in check_estimates\r\n                                       check_raw_estimates(node, fees_seen)\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/feature_fee_estimation.py\", line 79, in check_raw_estimates\r\n                                       f\"Estimated fee ({feerate}) out of range ({min(fees_seen)},{max(fees_seen)})\"\r\n                                   AssertionError: Estimated fee (0.00732088) out of range (3.9370078740157485e-05,0.007271477272727272)\r\n test  2022-05-20T14:25:48.639000Z TestFramework (DEBUG): Closing down network thread \r\n test  2022-05-20T14:25:48.690000Z TestFramework (INFO): Stopping nodes \r\n test  2022-05-20T14:25:48.690000Z TestFramework.node0 (DEBUG): Stopping node \r\n```\r\n\r\nI initially thought this might be the same as #23165 (and https://github.com/bitcoin/bitcoin/issues/11800 and https://github.com/bitcoin/bitcoin/issues/20725) that return *Estimated fee (a) larger than last fee (b) for lower number of confirms.*\r\n\r\nBut this one is *Estimated fee out of range*, so opening this issue and linking to the other ones.",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 5,
          "closed_at": "2022-12-07T17:28:39Z",
          "created_at": "2022-05-20T14:48:19Z",
          "updated_at": "2022-12-07T17:28:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:49:04Z",
      "updated_at": "2022-10-03T14:49:04Z",
      "source": {
        "issue": {
          "id": 590603920,
          "node_id": "MDU6SXNzdWU1OTA2MDM5MjA=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18475",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18475/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18475/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18475/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/18475",
          "number": 18475,
          "state": "closed",
          "state_reason": "completed",
          "title": "Tx with feeRate = 1100sat/vB doesn't pass -minrelaytxfee of 1100sat/vB",
          "body": "So I was fiddling with feerates today. I bumped into https://github.com/bitcoin/bitcoin/issues/13283, but this seemed different.\r\n\r\nI have the following setup:\r\n- `-regtest` and `-minrelaytxfee=0.00001100` \r\n- one node makes a block every some seconds\r\n- other node has `-mintxfee=0.00001100` as well and connects to that node and creates a tx with createraw+fundraw+signraw+sendraw\r\n\r\nOn fundraw, I use `\"{\\\"feeRate\\\": 0.00001100}\"`.\r\n\r\nResult: the txs of the second node don't get relayed to the first node and don't get mined.\r\n\r\nSo my main reason for this research was to observe fee estimation. After a while, `estimatesmartfee 3` gives a feerate of `0.00001097`, which is just below the feeRate supposedly set in every txs in the blockchain & mempool (which seems weird on itself), but is also lower than the `minRelayTxFee` for that node.",
          "user": {
            "login": "stevenroose",
            "id": 853468,
            "node_id": "MDQ6VXNlcjg1MzQ2OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/853468?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stevenroose",
            "html_url": "https://github.com/stevenroose",
            "followers_url": "https://api.github.com/users/stevenroose/followers",
            "following_url": "https://api.github.com/users/stevenroose/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/stevenroose/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/stevenroose/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/stevenroose/subscriptions",
            "organizations_url": "https://api.github.com/users/stevenroose/orgs",
            "repos_url": "https://api.github.com/users/stevenroose/repos",
            "events_url": "https://api.github.com/users/stevenroose/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/stevenroose/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64585,
              "node_id": "MDU6TGFiZWw2NDU4NQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
              "name": "Bug",
              "color": "FBBAAB",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 9,
          "closed_at": "2022-10-17T07:01:50Z",
          "created_at": "2020-03-30T21:20:10Z",
          "updated_at": "2022-10-17T07:01:50Z"
        },
        "type": "issue"
      }
    }
  ]
}
{
  "type": "issue",
  "issue": {
    "id": 2096721588,
    "node_id": "I_kwDOABII5858-W60",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29296",
    "number": 29296,
    "state": "closed",
    "state_reason": "not_planned",
    "title": "Huge disk fragmentation",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nvery many fragmented files\n\n### Expected behaviour\n\nfiles are not fragmented\n\n### Steps to reproduce\n\nAn extra description of the behaviour from #26063 \r\nPrerequisite: disc defragmented (I used Full optimization from UltraDefrag), Windows Security(including real-time protection) are disabled.\r\n1. Start Bitcoin Core\r\n2. Wait for half an hour\r\n3. Stop Bitcoin Core\r\n4. Run UltraDefrag report\n\n### Relevant log output\n\n[fragmentation_and_speed_degradation.zip](https://github.com/bitcoin/bitcoin/files/14028413/fragmentation_and_speed_degradation.zip)\r\n\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\n26.0\n\n### Operating system and version\n\nWindows 10 22H2\n\n### Machine specifications\n\nHDD SATA III (1 TB, 64 MB cache, NTFS)\r\nIntel(R) Xeon(R) CPU E5-2670 v3 @ 2.30GHz   2.30 GHz\r\n16 GB RAM",
    "user": {
      "login": "helpau",
      "id": 30323047,
      "node_id": "MDQ6VXNlcjMwMzIzMDQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/30323047?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/helpau",
      "html_url": "https://github.com/helpau",
      "followers_url": "https://api.github.com/users/helpau/followers",
      "following_url": "https://api.github.com/users/helpau/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/helpau/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/helpau/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/helpau/subscriptions",
      "organizations_url": "https://api.github.com/users/helpau/orgs",
      "repos_url": "https://api.github.com/users/helpau/repos",
      "events_url": "https://api.github.com/users/helpau/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/helpau/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "closed_at": "2024-01-23T18:44:11Z",
    "created_at": "2024-01-23T18:28:33Z",
    "updated_at": "2024-01-25T11:29:12Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1906702516,
      "node_id": "IC_kwDOABII585xpfi0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1906702516",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-23T18:44:11Z",
      "updated_at": "2024-01-23T18:44:11Z",
      "author_association": "MEMBER",
      "body": "Disk fragmentation is a property of your hardware and your operating system. Software such as Bitcoin Core do not have low level access to the filesystem and hardware to control where the data will be physically placed. This is a problem with your operating system and how it chooses where files are actually physically stored.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29296#issuecomment-1906702516",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296"
    },
    {
      "event": "closed",
      "id": 11574623998,
      "node_id": "CE_lADOABII5858-W60zwAAAAKx5r7-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11574623998",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-23T18:44:11Z"
    },
    {
      "event": "commented",
      "id": 1908614398,
      "node_id": "IC_kwDOABII585xwyT-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1908614398",
      "actor": {
        "login": "helpau",
        "id": 30323047,
        "node_id": "MDQ6VXNlcjMwMzIzMDQ3",
        "avatar_url": "https://avatars.githubusercontent.com/u/30323047?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/helpau",
        "html_url": "https://github.com/helpau",
        "followers_url": "https://api.github.com/users/helpau/followers",
        "following_url": "https://api.github.com/users/helpau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/helpau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/helpau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/helpau/subscriptions",
        "organizations_url": "https://api.github.com/users/helpau/orgs",
        "repos_url": "https://api.github.com/users/helpau/repos",
        "events_url": "https://api.github.com/users/helpau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/helpau/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-24T17:36:47Z",
      "updated_at": "2024-01-24T17:36:47Z",
      "author_association": "NONE",
      "body": "In my test environment fragmentation is only caused by Bitcoin Core, and affects Bitcoin Core. I think to eliminate fragmentation, all you need to do is increase buffers(e.g. to 2MB for .ldb files), limit simultaneous writes for different files, or preallocate disc space.  I don't see your answer as a solution, as it boils down to:\r\n1)buying an SSD(which imposes limitations, and doesn't completely solve the problem)\r\n2)using defragmentation(requires time, user involvement and restarting Bitcoin Core)\r\n3)using non-NTFS(requires reformatting the volume, effectively prohibiting Windows)\r\nI think fixing the issue would greatly improve the UX of IBD. Please consider it specifically as a user experience improvement.",
      "user": {
        "login": "helpau",
        "id": 30323047,
        "node_id": "MDQ6VXNlcjMwMzIzMDQ3",
        "avatar_url": "https://avatars.githubusercontent.com/u/30323047?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/helpau",
        "html_url": "https://github.com/helpau",
        "followers_url": "https://api.github.com/users/helpau/followers",
        "following_url": "https://api.github.com/users/helpau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/helpau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/helpau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/helpau/subscriptions",
        "organizations_url": "https://api.github.com/users/helpau/orgs",
        "repos_url": "https://api.github.com/users/helpau/repos",
        "events_url": "https://api.github.com/users/helpau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/helpau/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29296#issuecomment-1908614398",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296"
    },
    {
      "event": "commented",
      "id": 1909970643,
      "node_id": "IC_kwDOABII585x19bT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1909970643",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-25T11:29:12Z",
      "updated_at": "2024-01-25T11:29:12Z",
      "author_association": "MEMBER",
      "body": "According to your debug log 5 blocks are advanced per second, which seems fast, even for spinning storage. Not sure if much can be done to improve upon that. In any case, if you have a software solution, no one is holding you back from testing and benchmarking it. If it does really does improve performance significantly, it can be considered.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29296#issuecomment-1909970643",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29296"
    }
  ]
}
{
  "type": "issue",
  "issue": {
    "id": 1421700419,
    "node_id": "I_kwDOABII585UvW1D",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/26385",
    "number": 26385,
    "state": "open",
    "state_reason": null,
    "title": "signrawtransactionwithwallet fails with signed non-wallet inputs and breaks the existing signatures",
    "body": "The error returned by the RPC is:\r\n`Unable to sign input, invalid stack size (possibly missing key)`\r\n\r\nIt seems that this rpc alters the scriptSig of all of the inputs that were already signed.\r\n\r\nThe problem is very similar to https://github.com/bitcoin/bitcoin/issues/21151, which is already solved. \r\n\r\nHere's an example of the broken signatures after signing:\r\n```diff\r\n--- 0_before.txt\t2022-10-24 17:46:31.105518559 -0300\r\n+++ 1_after.txt\t2022-10-24 17:46:31.146517797 -0300\r\n@@ -1,18 +1,18 @@\r\n {\r\n-  \"txid\": \"7107a82fd2d783d32e2926bf91b5dea5908203a3d81f8bb67b267f9aeab3c16d\",\r\n-  \"hash\": \"7107a82fd2d783d32e2926bf91b5dea5908203a3d81f8bb67b267f9aeab3c16d\",\r\n+  \"txid\": \"b4b09eebed1f427f7ae80004ca1e55688567bc8e01af7608311c7d0a31ffcf83\",\r\n+  \"hash\": \"685100e81d34140941b3c15af9598e0d2ffdbee92b3706c82561ff2232c94cbc\",\r\n   \"version\": 1,\r\n-  \"size\": 406,\r\n-  \"vsize\": 406,\r\n-  \"weight\": 1624,\r\n+  \"size\": 373,\r\n+  \"vsize\": 291,\r\n+  \"weight\": 1162,\r\n   \"locktime\": 0,\r\n   \"vin\": [\r\n     {\r\n       \"txid\": \"c2afc743b00acb7a9a9cccc9e9b2751f0ae17206a9492dc0537ec72f44c7f6e0\",\r\n       \"vout\": 1,\r\n       \"scriptSig\": {\r\n-        \"asm\": \"0 30440220201b3d70770c2b325c8cac16593a4606cdcb29c094f67ec700d6aaadfdcc3bdf022057b70804b24d66664f1a82f7936773fbc3bcb15740a0e7b772ddf7bfe486b6fe[SINGLE|ANYONECANPAY] 3044022034eaf58c896885fc1597a848d268ad618e621b33be77bed67bcfa6180611ac31022073f947c7d2ebd81c1d52236030dd1a5d6b178c9361786ff9d6d3ef9740be1c76[SINGLE|ANYONECANPAY] 522103d28e83bfc9d2ab30f26f7b62ac4b64a932272ba124c6c4d29e901eaf8724aab7210366dc61fb53bce09777fe7c4766a55af9649cc26deb21b204ae6bf4e93413a46c2102439d6a6bc199460e4e0a6e5fdcb87162cafa5cae6ee4845d23d9dc5e840ffdb153ae\",\r\n-        \"hex\": \"004730440220201b3d70770c2b325c8cac16593a4606cdcb29c094f67ec700d6aaadfdcc3bdf022057b70804b24d66664f1a82f7936773fbc3bcb15740a0e7b772ddf7bfe486b6fe83473044022034eaf58c896885fc1597a848d268ad618e621b33be77bed67bcfa6180611ac31022073f947c7d2ebd81c1d52236030dd1a5d6b178c9361786ff9d6d3ef9740be1c76834c69522103d28e83bfc9d2ab30f26f7b62ac4b64a932272ba124c6c4d29e901eaf8724aab7210366dc61fb53bce09777fe7c4766a55af9649cc26deb21b204ae6bf4e93413a46c2102439d6a6bc199460e4e0a6e5fdcb87162cafa5cae6ee4845d23d9dc5e840ffdb153ae\"\r\n+        \"asm\": \"0 0 522103d28e83bfc9d2ab30f26f7b62ac4b64a932272ba124c6c4d29e901eaf8724aab7210366dc61fb53bce09777fe7c4766a55af9649cc26deb21b204ae6bf4e93413a46c2102439d6a6bc199460e4e0a6e5fdcb87162cafa5cae6ee4845d23d9dc5e840ffdb153ae\",\r\n+        \"hex\": \"00004c69522103d28e83bfc9d2ab30f26f7b62ac4b64a932272ba124c6c4d29e901eaf8724aab7210366dc61fb53bce09777fe7c4766a55af9649cc26deb21b204ae6bf4e93413a46c2102439d6a6bc199460e4e0a6e5fdcb87162cafa5cae6ee4845d23d9dc5e840ffdb153ae\"\r\n       },\r\n       \"sequence\": 0\r\n     },\r\n@@ -23,6 +23,10 @@\r\n         \"asm\": \"\",\r\n         \"hex\": \"\"\r\n       },\r\n+      \"txinwitness\": [\r\n+        \"304402202dc3e510dc053dcdd29be701441337c93f6923686cc5ba4a915dbc17073dd26c02207aa8b76a447bde52b4cb1146781745826692d4484327f2a78a73818183e5f37f01\",\r\n+        \"0379d702db49e91dd63127278c06ed99ef05b43d15f2583bb28b4f0e9b49b9f50c\"\r\n+      ],\r\n       \"sequence\": 0\r\n     }\r\n   ],\r\n```\r\n\r\nI've prepared a bash script that reproduces it (I used hal to merge the transactions):\r\n```bash\r\n#!/bin/bash\r\n\r\n#set -x\r\nset -e\r\n\r\nshopt -s expand_aliases\r\nalias b-dae=\"~/opt/bitcoin/bin/bitcoind -datadir=$PWD -daemon=1\"\r\nalias b-cli=\"~/opt/bitcoin/bin/bitcoin-cli -datadir=$PWD\"\r\n\r\ndeclare -a privkeys\r\ndeclare -a pubkeys\r\ndeclare -a multisigs\r\ndeclare -a addresses\r\ndeclare -a redeemScripts\r\ndeclare -a txs\r\ndeclare -a scriptPubKeys\r\ndeclare -a vouts\r\ndeclare -a mergetxs\r\n\r\n#parameters for the multisig addreesses\r\naddresstype=legacy\r\nmultisig_n=2\r\nmultisig_m=3\r\nmultisig_count=1\r\n#create the keypairs\r\nfor i in $(seq 0 $((multisig_count * multisig_m - 1)));do\r\n    KEYPAIR=$(hal key generate --regtest 2>/dev/null)\r\n    privkeys[$i]=$(echo $KEYPAIR | jq -r .wif_private_key)\r\n    pubkeys[$i]=$(echo $KEYPAIR | jq -r .public_key)\r\ndone\r\n\r\nb-cli stop && sleep 5 || true\r\nrm -rf regtest\r\nb-dae\r\nb-cli -rpcwait createwallet \"\"\r\necho\r\n\r\n#create the multisig addresses\r\nfor i in $(seq 0 $((multisig_count - 1)));do\r\n    mspubkeys='['\r\n    sep=\r\n    for j in $(seq $((i * multisig_m)) $((i * multisig_m + multisig_m -1)));do\r\n        mspubkeys+=\"$sep\\\"${pubkeys[$j]}\\\"\"\r\n        sep=','\r\n    done\r\n    mspubkeys+=']'\r\n    echo b-cli createmultisig ${multisig_n} \"${mspubkeys}\" $addresstype\r\n    multisigs[$i]=$(b-cli -rpcwait createmultisig ${multisig_n} \"${mspubkeys}\" $addresstype)\r\n    addresses[$i]=$(echo \"${multisigs[$i]}\" | jq -r '.address')\r\n    redeemScripts[$i]=$(echo \"${multisigs[$i]}\" | jq -r '.redeemScript')\r\ndone\r\n\r\necho \"pubkeys: ${pubkeys[@]}\"\r\necho \"privkeys: ${privkeys[@]}\"\r\n#generate enough blocks to unlock the reward\r\nDEST=$(b-cli getnewaddress)\r\nb-cli generatetoaddress 101 $DEST >/dev/null 2>&1\r\n#send 1 btc to each multisig address\r\nfor i in $(seq 0 $((multisig_count - 1)));do\r\n    txs[$i]=$(b-cli sendtoaddress \"${addresses[$i]}\" 1)\r\n    scriptPubKeys[$i]=$(b-cli decoderawtransaction $(b-cli getrawtransaction ${txs[$i]})| jq -r \".vout[] .scriptPubKey | select(.address == \\\"${addresses[$i]}\\\") .hex\")\r\n    vouts[$i]=$(b-cli decoderawtransaction $(b-cli getrawtransaction ${txs[$i]})| jq -r \".vout[] | select(.scriptPubKey.address == \\\"${addresses[$i]}\\\") .n\")\r\n    #echo ${txs[$i]} ${scriptPubKeys[$i]}\r\n    b-cli generatetoaddress 1 $DEST >/dev/null 2>&1\r\ndone\r\necho\r\n\r\n#each multisig sends its coins to a new wallet (destwallet) and signs the transaction using signrawtransactionwithkey\r\necho createwallet destwallet\r\nb-cli createwallet destwallet\r\ndestaddress=$(b-cli -rpcwallet=destwallet getnewaddress)\r\necho unloadwallet destwallet\r\nb-cli unloadwallet destwallet\r\nfor i in $(seq 0 $((multisig_count - 1)));do\r\n    echo \"Sending utxo ${txs[$i]} to final address $destaddress\"\r\n    tx=$(b-cli createrawtransaction \"[{\\\"txid\\\":\\\"${txs[$i]}\\\",\\\"vout\\\":${vouts[$i]}}]\" \"[{\\\"$destaddress\\\":1}]\")\r\n\r\n    prevtxs=\"[{\\\"txid\\\":\\\"${txs[$i]}\\\",\\\"vout\\\":${vouts[$i]},\\\"scriptPubKey\\\":\\\"${scriptPubKeys[$i]}\\\",\\\"redeemScript\\\":\\\"${redeemScripts[$i]}\\\",\\\"amount\\\":1}]\"\r\n    #sign with keys one by one\r\n    for j in $(seq $((i * multisig_m)) $((i * multisig_m + multisig_n - 1)));do\r\n        tx=$(b-cli signrawtransactionwithkey $tx \"[\\\"${privkeys[$j]}\\\"]\" \"$prevtxs\" \"SINGLE|ANYONECANPAY\")\r\n        tx=$(echo $tx|jq -r '.hex')\r\n    done\r\n    mergetxs[$i]=$tx\r\ndone\r\necho\r\n\r\nfinalinputs=\"\"\r\nfinaloutputs=\"\"\r\n\r\n#create the transaction to provide the funds to pay for the previous transactions\r\nfee_input=$(b-cli listunspent|jq -r '.[0]')\r\nfee_input_amount=$(echo $fee_input|jq -r '.amount')\r\nfee=0.0001\r\nchange_amount=$(bc -l <<< \"$fee_input_amount - $fee\")\r\nchangeaddress=$(b-cli getnewaddress)\r\nchange_tx=$(b-cli createrawtransaction \"[$fee_input]\" \"[{\\\"$changeaddress\\\":$change_amount}]\")\r\nmergetxs[$multisig_count]=$change_tx\r\n\r\nsepin=\"\"\r\nsepout=\"\"\r\n\r\n#prepare a Json with the inputs, and another one with the outputs\r\nfor i in $(seq 0 $((multisig_count)));do\r\n    decodedtx=$(hal tx decode ${mergetxs[$i]})\r\n    inputno=$(echo $decodedtx| jq -r \".inputs | length -1\")\r\n    for k in $(seq 0 $inputno);do\r\n        input=$(echo $decodedtx| jq -r \".inputs[$k] | del(.sequence)\")\r\n        finalinputs+=\"$sepin$input\"\r\n        sepin=\",\"\r\n    done\r\n    outputno=$(echo $decodedtx| jq -r \".outputs | length -1\")\r\n    for k in $(seq 0 $outputno);do\r\n        output=$(echo $decodedtx| jq -r \".outputs[$k] | del(.n)\")\r\n        finaloutputs+=\"$sepout$output\"\r\n        sepout=\",\"\r\n    done\r\ndone\r\n\r\nfulltx=\"\r\n{\r\n  \\\"version\\\": 1,\r\n  \\\"locktime\\\": 0,\r\n  \\\"inputs\\\": [ $finalinputs ],\r\n  \\\"outputs\\\": [ $finaloutputs ]\r\n}\r\n\"\r\necho $fulltx|jq >fulltx.txt\r\n\r\n#create the transaction with all the inputs and outpts, and sign it using signrawtransactionwithwallet (fails...)\r\nfinaltx=$(echo $fulltx|jq|hal tx create 2>/dev/null)\r\nb-cli decoderawtransaction $finaltx >0_before.txt\r\necho \"tx BEFORE signrawtransactionwithwallet: $finaltx\"\r\nsignedfinaltx=$(b-cli signrawtransactionwithwallet $finaltx)\r\necho \"tx AFTER signrawtransactionwithwallet: $(echo $signedfinaltx|jq -r '.hex')\"\r\nb-cli decoderawtransaction $(echo $signedfinaltx|jq -r '.hex') >1_after.txt\r\ndiff -Naurwp 0_before.txt 1_after.txt >0.diff || true\r\nsignerror=$(echo $signedfinaltx|jq -r '.errors[0].error//empty')\r\nif [ -n \"$signerror\" ];then\r\n    echo \"Error signing with wallet ($signerror)\"\r\n    exit -1\r\nfi\r\n\r\nsenttx=$(b-cli sendrawtransaction $(echo $signedfinaltx|jq -r '.hex'))\r\nb-cli gettransaction $senttx\r\nb-cli generatetoaddress 1 $DEST >/dev/null 2>&1\r\nb-cli gettransaction $senttx\r\n```\r\nI've tested with Bitcoin Core 23.0.\r\nPlease let me know if there's anything else I can test.",
    "user": {
      "login": "andreabonel",
      "id": 94554885,
      "node_id": "U_kgDOBaLLBQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/94554885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andreabonel",
      "html_url": "https://github.com/andreabonel",
      "followers_url": "https://api.github.com/users/andreabonel/followers",
      "following_url": "https://api.github.com/users/andreabonel/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andreabonel/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andreabonel/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andreabonel/subscriptions",
      "organizations_url": "https://api.github.com/users/andreabonel/orgs",
      "repos_url": "https://api.github.com/users/andreabonel/repos",
      "events_url": "https://api.github.com/users/andreabonel/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andreabonel/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 5,
    "created_at": "2022-10-25T01:29:38Z",
    "updated_at": "2023-03-29T13:32:37Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 7659043752,
      "node_id": "LE_lADOABII585UvW1DzwAAAAHIg7uo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7659043752",
      "actor": {
        "login": "andreabonel",
        "id": 94554885,
        "node_id": "U_kgDOBaLLBQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/94554885?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andreabonel",
        "html_url": "https://github.com/andreabonel",
        "followers_url": "https://api.github.com/users/andreabonel/followers",
        "following_url": "https://api.github.com/users/andreabonel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andreabonel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andreabonel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andreabonel/subscriptions",
        "organizations_url": "https://api.github.com/users/andreabonel/orgs",
        "repos_url": "https://api.github.com/users/andreabonel/repos",
        "events_url": "https://api.github.com/users/andreabonel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andreabonel/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T01:29:38Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "commented",
      "id": 1290491358,
      "node_id": "IC_kwDOABII585M61Xe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1290491358",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T12:42:02Z",
      "updated_at": "2022-10-25T12:42:16Z",
      "author_association": "MEMBER",
      "body": "Thank you for the bug report and repro steps.\r\n\r\nMight be related to https://github.com/bitcoin/bitcoin/issues/21151 ?\r\n\r\nI have reproduced with your script on v24.0rc2, but not yet gone through the script logic in detail to see why this is failing since https://github.com/bitcoin/bitcoin/pull/21166:\r\n\r\n```\r\nwill@ubuntu in ~/temp via ðŸ v3.6.12 took 16s\r\nâ¯ ./26385.sh\r\nBitcoin Core starting\r\n{\r\n  \"name\": \"\",\r\n  \"warning\": \"\"\r\n}\r\n\r\nb-cli createmultisig 2 [\"02204cc848e8ac548b5e716e9c06eaf8bc84f896d08f5c5e21b97f6d5e5f88c95d\",\"030297346cd7b3236e844fc8ba63793f4677fab9eb0282abec99c00b42770d051a\",\"03d9a9029dec2e0d62f3f5bedd686b919bba7ce7bd36c2406e1b8e7ebeea1b637c\"] legacy\r\npubkeys: 02204cc848e8ac548b5e716e9c06eaf8bc84f896d08f5c5e21b97f6d5e5f88c95d 030297346cd7b3236e844fc8ba63793f4677fab9eb0282abec99c00b42770d051a 03d9a9029dec2e0d62f3f5bedd686b919bba7ce7bd36c2406e1b8e7ebeea1b637c\r\nprivkeys: cW3np3Apfi1dbvV9WxabWn1BVBkrce2nbbYYE34DkQRdZFNiNYoz cUePsEDPDouj2eb6jhYRmxhutdoMQFCiwQN1B9ErtKdmXKYx8Xjg cMjnX31zMHDQoeXfoCCgug2bjLHTX3Bihtg56re6UQicshbBcfdT\r\n\r\ncreatewallet destwallet\r\n{\r\n  \"name\": \"destwallet\",\r\n  \"warning\": \"\"\r\n}\r\nunloadwallet destwallet\r\n{\r\n  \"warning\": \"\"\r\n}\r\nSending utxo d4b5e918f5e8296b74a003037c21680b893d4161bcbf6fd9ee909537f561a259 to final address bcrt1qcysp6g4kmhk8c39yf7xm6vkqxmg8k4ljf8prtn\r\n\r\ntx BEFORE signrawtransactionwithwallet: 010000000259a261f5379590eed96fbfbc61413d890b68217c0303a0746b29e8f518e9b5d400000000fc00473044022029458f221b23dff4171a492fea136e7a6d70214aa249be6b770accf3df49511e02207a84db1a6c012106a6e3fcfe37fff4c0171995e9f99e00bbb0f3bb335789689483473044022051d3fc59fc06b82ed0b5b4812a567eed0ef597dab3f4ef67f7154b181790b7c00220528a7b1febf010fbbdd682e68ac400fe635769542323adf6e129c23c19143c51834c69522102204cc848e8ac548b5e716e9c06eaf8bc84f896d08f5c5e21b97f6d5e5f88c95d21030297346cd7b3236e844fc8ba63793f4677fab9eb0282abec99c00b42770d051a2103d9a9029dec2e0d62f3f5bedd686b919bba7ce7bd36c2406e1b8e7ebeea1b637c53ae0000000059a261f5379590eed96fbfbc61413d890b68217c0303a0746b29e8f518e9b5d40100000000000000000200e1f50500000000160014c1201d22b6ddec7c44a44f8dbd32c036d07b57f25ae40f2401000000160014d3d3201f954e2344958af90ddaa2be84b6928a0100000000\r\ntx AFTER signrawtransactionwithwallet: 0100000000010259a261f5379590eed96fbfbc61413d890b68217c0303a0746b29e8f518e9b5d4000000006d00004c69522102204cc848e8ac548b5e716e9c06eaf8bc84f896d08f5c5e21b97f6d5e5f88c95d21030297346cd7b3236e844fc8ba63793f4677fab9eb0282abec99c00b42770d051a2103d9a9029dec2e0d62f3f5bedd686b919bba7ce7bd36c2406e1b8e7ebeea1b637c53ae0000000059a261f5379590eed96fbfbc61413d890b68217c0303a0746b29e8f518e9b5d40100000017160014bafa6a4a429e1e06cd4ea7a81c8a40f5a9e73e29000000000200e1f50500000000160014c1201d22b6ddec7c44a44f8dbd32c036d07b57f25ae40f2401000000160014d3d3201f954e2344958af90ddaa2be84b6928a010002473044022012427cd5dce2b32deb820c880ed43d0f4c30f5475d783d9a1ab63df4a94c5ecd02200b962e4386dc66b9e3bcf1888a07e9a782d92473a78de36163bc4f640adc6aa30121020ada311431cadab2788e59d7e419d64859a31dc76a19e2f84926d5b7b47876ab00000000\r\nError signing with wallet (Unable to sign input, invalid stack size (possibly missing key))\r\n```",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26385#issuecomment-1290491358",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385"
    },
    {
      "event": "commented",
      "id": 1291025359,
      "node_id": "IC_kwDOABII585M83vP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291025359",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T19:17:15Z",
      "updated_at": "2022-10-25T19:17:15Z",
      "author_association": "MEMBER",
      "body": "It looks like `$finaltx` comes from `hal`. Are you certain that that transaction is valid? I think the only way that this issue can occur is if the signatures in `$finaltx` are invalid. In that case, the signature extractor will fail to find the signatures as it is detecting them to be invalid and so ignores them. Then when it \"signs\" the input, it doesn't have anything to fill in and ends up clearing it.\r\n\r\nI don't have some of the tools needed to run the script installed on my system. Can you reproduce this issue with *only* Bitcoin Core commands? What happens if you do `testmempoolaccept $finaltx` before doing `signrawtransactionwithwallet`?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26385#issuecomment-1291025359",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385"
    },
    {
      "event": "commented",
      "id": 1291293119,
      "node_id": "IC_kwDOABII585M95G_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291293119",
      "actor": {
        "login": "andreabonel",
        "id": 94554885,
        "node_id": "U_kgDOBaLLBQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/94554885?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andreabonel",
        "html_url": "https://github.com/andreabonel",
        "followers_url": "https://api.github.com/users/andreabonel/followers",
        "following_url": "https://api.github.com/users/andreabonel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andreabonel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andreabonel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andreabonel/subscriptions",
        "organizations_url": "https://api.github.com/users/andreabonel/orgs",
        "repos_url": "https://api.github.com/users/andreabonel/repos",
        "events_url": "https://api.github.com/users/andreabonel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andreabonel/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T00:52:16Z",
      "updated_at": "2022-10-26T00:52:16Z",
      "author_association": "NONE",
      "body": "I'm not certain that that transaction is valid tbh, but I have no reason to suspect it isn't (hal is based on rust-bitcoin). By the way: shouldn't `decoderawtransaction` fail if that were the case?\r\n\r\nTo try to reproduce this issue with only Bitcoin Core commands: do you know which rpc I could use to merge the transactions?\r\nI tried with `testmempoolaccept $finaltx` before doing `signrawtransactionwithwallet` but it fails since the last transaction isn't signed yet.\r\nI also tried `testmempoolaccept` with only the first transaction, and it fails because it doesn't have fees (\"min relay fee not met\").",
      "user": {
        "login": "andreabonel",
        "id": 94554885,
        "node_id": "U_kgDOBaLLBQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/94554885?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andreabonel",
        "html_url": "https://github.com/andreabonel",
        "followers_url": "https://api.github.com/users/andreabonel/followers",
        "following_url": "https://api.github.com/users/andreabonel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andreabonel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andreabonel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andreabonel/subscriptions",
        "organizations_url": "https://api.github.com/users/andreabonel/orgs",
        "repos_url": "https://api.github.com/users/andreabonel/repos",
        "events_url": "https://api.github.com/users/andreabonel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andreabonel/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26385#issuecomment-1291293119",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385"
    },
    {
      "event": "commented",
      "id": 1291381723,
      "node_id": "IC_kwDOABII585M-Ovb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291381723",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T01:51:28Z",
      "updated_at": "2022-10-26T01:51:28Z",
      "author_association": "MEMBER",
      "body": "> By the way: shouldn't `decoderawtransaction` fail if that were the case?\r\n\r\nNo, `decoderawtransaction` does not check signatures.\r\n\r\n> To try to reproduce this issue with only Bitcoin Core commands: do you know which rpc I could use to merge the transactions?\r\n\r\nYou could use `combinerawtransaction`.\r\n\r\n> I also tried `testmempoolaccept` with only the first transaction, and it fails because it doesn't have fees (\"min relay fee not met\").\r\n\r\nThe output has the same amount as the input, so the fee is 0. Try setting the output amount to be 0.9999",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26385#issuecomment-1291381723",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385"
    },
    {
      "event": "commented",
      "id": 1488621015,
      "node_id": "IC_kwDOABII585Yuo3X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1488621015",
      "actor": {
        "login": "meglio",
        "id": 282177,
        "node_id": "MDQ6VXNlcjI4MjE3Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/282177?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meglio",
        "html_url": "https://github.com/meglio",
        "followers_url": "https://api.github.com/users/meglio/followers",
        "following_url": "https://api.github.com/users/meglio/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meglio/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meglio/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meglio/subscriptions",
        "organizations_url": "https://api.github.com/users/meglio/orgs",
        "repos_url": "https://api.github.com/users/meglio/repos",
        "events_url": "https://api.github.com/users/meglio/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meglio/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-29T13:32:37Z",
      "updated_at": "2023-03-29T13:32:37Z",
      "author_association": "NONE",
      "body": "Am I correct to assume this is still a bug awaiting a fix?",
      "user": {
        "login": "meglio",
        "id": 282177,
        "node_id": "MDQ6VXNlcjI4MjE3Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/282177?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/meglio",
        "html_url": "https://github.com/meglio",
        "followers_url": "https://api.github.com/users/meglio/followers",
        "following_url": "https://api.github.com/users/meglio/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/meglio/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/meglio/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/meglio/subscriptions",
        "organizations_url": "https://api.github.com/users/meglio/orgs",
        "repos_url": "https://api.github.com/users/meglio/repos",
        "events_url": "https://api.github.com/users/meglio/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/meglio/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/26385#issuecomment-1488621015",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26385"
    }
  ]
}
{
  "type": "issue",
  "issue": {
    "id": 3543842298,
    "node_id": "I_kwDOABII587TOr36",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33687",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33687/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33687/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33687/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33687",
    "number": 33687,
    "state": "open",
    "state_reason": null,
    "title": "Seemingly second (very long) validation at the same height",
    "body": "`Bitcoin Core 30.0`\n\nI automatically measure the verification time between \"Saw new header\" or \"Saw new cmpctblock header\" and \"UpdateTip:\" for the same height in debug.log. Almost always that time difference is 0 or 1 second. However, at block 920139 I see a huge spike of 443 seconds. Turns out there is something strange happening for block 920138. Here's what debug.log reports for this block:\n\n```\n2025-10-21T17:17:37Z Saw new cmpctblock header hash=00000000000000000000a0eb867d25dd2e5284750888c545607d30aecc48c691 height=920138 peer=96259\n2025-10-21T17:17:37Z UpdateTip: new best=00000000000000000000a0eb867d25dd2e5284750888c545607d30aecc48c691 height=920138 version=0x28000000 log2_work=95.892695 tx=1259718316 date='2025-10-21T17:17:24Z' progress=1.000000 cache=276.8MiB(2069960txo)\n2025-10-21T17:17:37Z Saw new header hash=000000000000000000002e852c1cb8e698df53a4c2646115fbb73d78298b5b2c height=920138 peer=92507\n2025-10-21T17:27:00Z UpdateTip: new best=000000000000000000002e852c1cb8e698df53a4c2646115fbb73d78298b5b2c height=920138 version=0x3227a000 log2_work=95.892695 tx=1259718525 date='2025-10-21T17:17:07Z' progress=0.999995 cache=276.8MiB(2071109txo)\n```\n\nSo there's a \"Saw new cmpctblock header\" and almost immediately the UpdateTip as usual. However, at the same time a \"Saw new header\" comes in for that same height and now the verification takes almost 10 minutes and progress falls from 1.000000 to 0.999995. This looks to me like a double verification for the same height where the second verification takes much longer.  Maybe it has something to do with a reorg, maybe this is normal behavior but I wanted to report it here just to be sure.\n\nBelow what happens around height 920138 in debug.log:\n\n```\n2025-10-21T16:59:13Z Saw new cmpctblock header hash=00000000000000000000f640d1940946015764ddcc37a631d8aebe69301a79d2 height=920135 peer=99563\n2025-10-21T16:59:13Z UpdateTip: new best=00000000000000000000f640d1940946015764ddcc37a631d8aebe69301a79d2 height=920135 version=0x20052000 log2_work=95.892658 tx=1259707764 date='2025-10-21T16:58:20Z' progress=1.000000 cache=276.8MiB(2053530txo)\n2025-10-21T17:00:56Z New block-relay-only v2 peer connected: version: 70016, blocks=920135, peer=160571\n2025-10-21T17:01:43Z Saw new header hash=00000000000000000001317b451e3306a1b62bb0ceb1b81524f90f95c6c95186 height=920136 peer=15656\n2025-10-21T17:01:44Z UpdateTip: new best=00000000000000000001317b451e3306a1b62bb0ceb1b81524f90f95c6c95186 height=920136 version=0x206b6000 log2_work=95.892671 tx=1259710624 date='2025-10-21T17:00:47Z' progress=1.000000 cache=276.8MiB(2057507txo)\n2025-10-21T17:06:52Z New block-relay-only v2 peer connected: version: 70016, blocks=920136, peer=160814\n2025-10-21T17:12:36Z New block-relay-only v2 peer connected: version: 70016, blocks=920136, peer=161247\n2025-10-21T17:14:46Z [net:info] portmap: Added mapping pcp:95.99.132.155:8333 -> 192.168.1.20:8333 (for 2400s)\n2025-10-21T17:14:46Z AddLocal(95.99.132.155:8333,3)\n2025-10-21T17:15:13Z Saw new cmpctblock header hash=000000000000000000004f08e2501645727550d7474400a3fa0ff7013dcd4ea9 height=920137 peer=21\n2025-10-21T17:15:13Z UpdateTip: new best=000000000000000000004f08e2501645727550d7474400a3fa0ff7013dcd4ea9 height=920137 version=0x200de000 log2_work=95.892683 tx=1259713766 date='2025-10-21T17:14:48Z' progress=1.000000 cache=276.8MiB(2065321txo)\n2025-10-21T17:17:37Z Saw new cmpctblock header hash=00000000000000000000a0eb867d25dd2e5284750888c545607d30aecc48c691 height=920138 peer=96259\n2025-10-21T17:17:37Z UpdateTip: new best=00000000000000000000a0eb867d25dd2e5284750888c545607d30aecc48c691 height=920138 version=0x28000000 log2_work=95.892695 tx=1259718316 date='2025-10-21T17:17:24Z' progress=1.000000 cache=276.8MiB(2069960txo)\n2025-10-21T17:17:37Z Saw new header hash=000000000000000000002e852c1cb8e698df53a4c2646115fbb73d78298b5b2c height=920138 peer=92507\n2025-10-21T17:19:37Z Saw new header hash=0000000000000000000004f6eb492f1e998b569a1940f690d0b691a2f4ba2d00 height=920139 peer=27652\n2025-10-21T17:25:54Z Saw new header hash=00000000000000000000c183ce29bb73ddf8e00419ce437bfc58f0abd8d1b161 height=920140 peer=27652\n2025-10-21T17:27:00Z UpdateTip: new best=000000000000000000004f08e2501645727550d7474400a3fa0ff7013dcd4ea9 height=920137 version=0x200de000 log2_work=95.892683 tx=1259713766 date='2025-10-21T17:14:48Z' progress=0.999992 cache=276.8MiB(2066586txo)\n2025-10-21T17:27:00Z UpdateTip: new best=000000000000000000002e852c1cb8e698df53a4c2646115fbb73d78298b5b2c height=920138 version=0x3227a000 log2_work=95.892695 tx=1259718525 date='2025-10-21T17:17:07Z' progress=0.999995 cache=276.8MiB(2071109txo)\n2025-10-21T17:27:00Z UpdateTip: new best=0000000000000000000004f6eb492f1e998b569a1940f690d0b691a2f4ba2d00 height=920139 version=0x202e2000 log2_work=95.892708 tx=1259722731 date='2025-10-21T17:19:29Z' progress=0.999997 cache=277.3MiB(2074876txo)\n2025-10-21T17:27:01Z UpdateTip: new best=00000000000000000000c183ce29bb73ddf8e00419ce437bfc58f0abd8d1b161 height=920140 version=0x2c542000 log2_work=95.892720 tx=1259726559 date='2025-10-21T17:25:32Z' progress=1.000000 cache=277.8MiB(2079466txo)\n2025-10-21T17:27:01Z txindex is catching up on block notifications\n2025-10-21T17:27:01Z txindex is catching up on block notifications\n2025-10-21T17:28:03Z Flushed fee estimates to fee_estimates.dat.\n2025-10-21T17:32:07Z Saw new header hash=0000000000000000000005d578e2ed197675684b0e9d57e19081b18879179804 height=920141 peer=105484\n2025-10-21T17:32:08Z UpdateTip: new best=0000000000000000000005d578e2ed197675684b0e9d57e19081b18879179804 height=920141 version=0x26000000 log2_work=95.892732 tx=1259730043 date='2025-10-21T17:31:56Z' progress=1.000000 cache=277.8MiB(2037404txo)\n```",
    "user": {
      "login": "hMsats",
      "id": 74196711,
      "node_id": "MDQ6VXNlcjc0MTk2NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/74196711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hMsats",
      "html_url": "https://github.com/hMsats",
      "followers_url": "https://api.github.com/users/hMsats/followers",
      "following_url": "https://api.github.com/users/hMsats/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/hMsats/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/hMsats/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/hMsats/subscriptions",
      "organizations_url": "https://api.github.com/users/hMsats/orgs",
      "repos_url": "https://api.github.com/users/hMsats/repos",
      "events_url": "https://api.github.com/users/hMsats/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/hMsats/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 0,
    "created_at": "2025-10-23T09:18:16Z",
    "updated_at": "2025-10-23T09:18:16Z"
  },
  "events": []
}
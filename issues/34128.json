{
  "type": "issue",
  "issue": {
    "id": 3750246491,
    "node_id": "I_kwDOABII587fiDhb",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34128",
    "number": 34128,
    "state": "open",
    "state_reason": null,
    "title": "migrating legacy wallet \"completes\", then removes bitcoin/wallets",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nWhen I start bitcoin-qt, it says I have a legacy wallet and tells me to migrate it. When I do, a message says that the migration is starting and after a time bitcoin-qt abruptly ends. When I start bitcoin-qt again it says that it cannot find the wallet. On investigating, I see that not only is bitcoin/wallet/wallet.dat gone, but so is the directory bitcoin/wallet.\n\nLooking at the log, it appears that the migration is successful, then ... something happens.\n\n### Expected behaviour\n\ncomplete the migration and don't destroy the wallet.\n\n### Steps to reproduce\n\nWith my legacy wallet.dat, use bitcoin-qt to migrate the legacy wallet.\n\n### Relevant log output\n\n2025-12-20T16:59:02Z [default wallet] Last client version = 80500\n2025-12-20T16:59:02Z [default wallet] Legacy Wallet Keys: 104 plaintext, 0 encrypted, 0 w/ metadata, 104 total.\n2025-12-20T16:59:02Z [default wallet] Descriptors: 0, Descriptor Keys: 0 plaintext, 0 encrypted, 0 total.\n2025-12-20T16:59:02Z [default wallet] Wallet completed loading in              17ms\n2025-12-20T16:59:02Z [default wallet] setKeyPool.size() = 0\n2025-12-20T16:59:02Z [default wallet] mapWallet.size() = 14\n2025-12-20T16:59:02Z [default wallet] m_address_book.size() = 4\n2025-12-20T16:59:02Z copied /mnt/bitcoin/wallets/wallet.dat to /mnt/bitcoin/wallets/default_wallet_1766249942.legacy.bak\n2025-12-20T16:59:02Z [default wallet] Migrating wallet storage database from BerkeleyDB to SQLite.\n2025-12-20T16:59:02Z Using SQLite Version 3.50.2\n2025-12-20T16:59:02Z Using wallet /mnt/bitcoin/wallets\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 374182aed2e22c1ef37dd8e5b9fd631242f647ae57f05d8b9556d18db013ee47, type = legacy, internal = false\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = ceff5344334331f96f356b6e01c5271441aef08d6e4ee1581cc21c652f42bc86, type = p2sh-segwit, internal = false\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 155bbeb7f9c67d2d69329fb2a3762c295de656cb81ecda752985e51e8c3c6c79, type = bech32, internal = false\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 1bd0bae9fcd655a7eefabfa486a4aac06d378caaea4fb18fd3ff82e267f33a5c, type = bech32m, internal = false\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 7ecccb708fa526705eae8095ab93eb2818c2046f7bc0f16991ce7290ea359751, type = legacy, internal = true\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 504be46550019ff607ead9e999e4fd08f4c302f7c64275eecadd31189a08d53d, type = p2sh-segwit, internal = true\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = ee394eb8b5666dc08b1ba7d763045043101fead2bf3d2f374a8dceb15efc676c, type = bech32, internal = true\n2025-12-20T16:59:02Z [default wallet] Setting spkMan to active: id = 295830f0bdf428f220030af634792d5c40ded7d2b129fc2d185d31d21992bf77, type = bech32m, internal = true\n2025-12-20T16:59:02Z [default wallet] Wallet migration complete.\n2025-12-20T16:59:02Z [default wallet] Releasing wallet ..\n2025-12-20T16:59:02Z Using SQLite Version 3.50.2\n2025-12-20T16:59:02Z Using wallet /mnt/bitcoin/wallets\n2025-12-20T16:59:02Z init message: Loading wallet…\n2025-12-20T16:59:02Z [default wallet] Last client version = 80500\n2025-12-20T16:59:03Z [default wallet] Descriptors: 112, Descriptor Keys: 1 plaintext, 0 encrypted, 1 total.\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 374182aed2e22c1ef37dd8e5b9fd631242f647ae57f05d8b9556d18db013ee47, type = legacy, internal = false\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = ceff5344334331f96f356b6e01c5271441aef08d6e4ee1581cc21c652f42bc86, type = p2sh-segwit, internal = false\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 155bbeb7f9c67d2d69329fb2a3762c295de656cb81ecda752985e51e8c3c6c79, type = bech32, internal = false\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 1bd0bae9fcd655a7eefabfa486a4aac06d378caaea4fb18fd3ff82e267f33a5c, type = bech32m, internal = false\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 7ecccb708fa526705eae8095ab93eb2818c2046f7bc0f16991ce7290ea359751, type = legacy, internal = true\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 504be46550019ff607ead9e999e4fd08f4c302f7c64275eecadd31189a08d53d, type = p2sh-segwit, internal = true\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = ee394eb8b5666dc08b1ba7d763045043101fead2bf3d2f374a8dceb15efc676c, type = bech32, internal = true\n2025-12-20T16:59:03Z [default wallet] Setting spkMan to active: id = 295830f0bdf428f220030af634792d5c40ded7d2b129fc2d185d31d21992bf77, type = bech32m, internal = true\n2025-12-20T16:59:03Z [default wallet] Wallet completed loading in             509ms\n2025-12-20T16:59:03Z [default wallet] Releasing wallet ..\n\n\n\n\n\n2025-12-20T17:07:16Z Bitcoin Core version v30.0.0 (release build)\n2025-12-20T17:07:16Z Qt 6.10.1 (dynamic), plugin=xcb\n2025-12-20T17:07:16Z No static plugins.\n2025-12-20T17:07:16Z Style: fusion / QFusionStyle\n2025-12-20T17:07:16Z System: Fedora Linux 43 (Workstation Edition), x86_64-little_endian-lp64\n2025-12-20T17:07:16Z Screen: HDMI-0 1920x1080, pixel ratio=1.0\n2025-12-20T17:07:16Z GUI: QFSFileEngine::open: No file name specified\n2025-12-20T17:07:16Z GUI: QFSFileEngine::open: No file name specified\n2025-12-20T17:07:16Z GUI: QFSFileEngine::open: No file name specified\n2025-12-20T17:07:16Z GUI: QFSFileEngine::open: No file name specified\n2025-12-20T17:07:16Z GUI: QFSFileEngine::open: No file name specified\n2025-12-20T17:07:16Z Using the 'sse4(1way);sse41(4way);avx2(8way)' SHA256 implementation\n2025-12-20T17:07:16Z Using RdSeed as an additional entropy source\n2025-12-20T17:07:16Z Using RdRand as an additional entropy source\n2025-12-20T17:07:16Z Default data directory /home/jonathans/.bitcoin\n2025-12-20T17:07:16Z Using data directory /mnt/bitcoin\n2025-12-20T17:07:16Z Config file: /home/jonathans/.bitcoin/bitcoin.conf\n2025-12-20T17:07:16Z Config file arg: datadir=\"/mnt/bitcoin\"\n2025-12-20T17:07:16Z Config file arg: dbcache=\"1024\"\n2025-12-20T17:07:16Z Config file arg: listen=\"1\"\n2025-12-20T17:07:16Z Config file arg: maxconnections=\"40\"\n2025-12-20T17:07:16Z Config file arg: maxmempool=\"300\"\n2025-12-20T17:07:16Z Config file arg: prune=\"550\"\n2025-12-20T17:07:16Z Config file arg: walletdir=\"/mnt/bitcoin/wallets\"\n2025-12-20T17:07:16Z Setting file arg: prune = \"3814\"\n2025-12-20T17:07:16Z Setting file arg: wallet = [\"\"]\n2025-12-20T17:07:16Z Using at most 40 automatic connections (1024 file descriptors available)\n2025-12-20T17:07:16Z scheduler thread start\n2025-12-20T17:07:16Z [error] Specified -walletdir \"/mnt/bitcoin/wallets\" does not exist\n2025-12-20T17:07:29Z Shutdown in progress...\n2025-12-20T17:07:29Z scheduler thread exit\n2025-12-20T17:07:29Z Shutdown done\n2025-12-20T17:07:29Z GUI: QFontDatabase: Must construct a QGuiApplication before accessing QFontDatabase\n\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nBitcoin Core version v30.0.0 (release build)\n\n### Operating system and version\n\nFedora Linux 43\n\n### Machine specifications\n\nKernel: 6.17.12-300.fc43.x86_64\nWindowing system: X11\nCPU: Intel i5-10400F CPU @ 2.90 GHz\nMemory: 62.7 GiB\nbroadband Internet",
    "user": {
      "login": "jestory",
      "id": 6830092,
      "node_id": "MDQ6VXNlcjY4MzAwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6830092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jestory",
      "html_url": "https://github.com/jestory",
      "followers_url": "https://api.github.com/users/jestory/followers",
      "following_url": "https://api.github.com/users/jestory/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jestory/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jestory/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jestory/subscriptions",
      "organizations_url": "https://api.github.com/users/jestory/orgs",
      "repos_url": "https://api.github.com/users/jestory/repos",
      "events_url": "https://api.github.com/users/jestory/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jestory/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/74",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74/labels",
      "id": 12610874,
      "node_id": "MI_kwDOABII584AwG06",
      "number": 74,
      "state": "open",
      "title": "31.0",
      "creator": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "open_issues": 14,
      "closed_issues": 21,
      "created_at": "2025-03-25T18:44:16Z",
      "updated_at": "2025-12-27T04:39:06Z"
    },
    "locked": false,
    "comments": 6,
    "created_at": "2025-12-20T17:26:58Z",
    "updated_at": "2025-12-27T10:13:40Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 21685801449,
      "node_id": "LE_lADOABII587fiDhbzwAAAAUMkxHp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21685801449",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T17:33:57Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "milestoned",
      "id": 21686944701,
      "node_id": "MIE_lADOABII587fiDhbzwAAAAUMpIO9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21686944701",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T22:05:30Z",
      "milestone": {
        "title": "31.0"
      }
    },
    {
      "event": "commented",
      "id": 3678181156,
      "node_id": "IC_kwDOABII587bPJck",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678181156",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T22:47:35Z",
      "updated_at": "2025-12-20T22:47:35Z",
      "author_association": "MEMBER",
      "body": "Are you able to reliably reproduce this issue? I am unable to reproduce the issue both with self compiled and the release binaries.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3678181156",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "commented",
      "id": 3678379212,
      "node_id": "IC_kwDOABII587bP5zM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678379212",
      "actor": {
        "login": "jestory",
        "id": 6830092,
        "node_id": "MDQ6VXNlcjY4MzAwOTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6830092?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jestory",
        "html_url": "https://github.com/jestory",
        "followers_url": "https://api.github.com/users/jestory/followers",
        "following_url": "https://api.github.com/users/jestory/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jestory/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jestory/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jestory/subscriptions",
        "organizations_url": "https://api.github.com/users/jestory/orgs",
        "repos_url": "https://api.github.com/users/jestory/repos",
        "events_url": "https://api.github.com/users/jestory/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jestory/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-21T02:38:37Z",
      "updated_at": "2025-12-21T02:38:37Z",
      "author_association": "NONE",
      "body": "It is very reliable. I copy my backup wallet.dat to wallets, and when I restart bitcoin-qt, the cycle continues again:\nI select migrate, the migration appears to complete, based on the log information, then bitcoin-qt quits without any error message, and when I look the wallets directory is gone, with everything in it.\n\nI have not been able to migrate the legacy wallet.",
      "user": {
        "login": "jestory",
        "id": 6830092,
        "node_id": "MDQ6VXNlcjY4MzAwOTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6830092?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jestory",
        "html_url": "https://github.com/jestory",
        "followers_url": "https://api.github.com/users/jestory/followers",
        "following_url": "https://api.github.com/users/jestory/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jestory/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jestory/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jestory/subscriptions",
        "organizations_url": "https://api.github.com/users/jestory/orgs",
        "repos_url": "https://api.github.com/users/jestory/repos",
        "events_url": "https://api.github.com/users/jestory/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jestory/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3678379212",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "commented",
      "id": 3678426957,
      "node_id": "IC_kwDOABII587bQFdN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678426957",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-21T04:03:10Z",
      "updated_at": "2025-12-21T04:03:10Z",
      "author_association": "MEMBER",
      "body": "Does it happen if you use the release binaries? What about with 29.2?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3678426957",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "commented",
      "id": 3678880849,
      "node_id": "IC_kwDOABII587bR0RR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678880849",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-21T15:14:06Z",
      "updated_at": "2025-12-21T15:14:06Z",
      "author_association": "MEMBER",
      "body": "As it seems you compiled it yourself, could you attach the debugger and tell us where it crashed?\nThat would speed up the bug-hunting process.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3678880849",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "commented",
      "id": 3681849201,
      "node_id": "IC_kwDOABII587bdI9x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3681849201",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-22T12:16:48Z",
      "updated_at": "2025-12-22T12:16:48Z",
      "author_association": "MEMBER",
      "body": "I also can't reproduce this. Do the functional tests pass for you?\n\nI've also written a sketch of a functional test to check this:\n\n```diff\ndiff --git a/test/functional/wallet_migration.py b/test/functional/wallet_migration.py\nindex 89989fbf81..1e9bc18bde 100755\n--- a/test/functional/wallet_migration.py\n+++ b/test/functional/wallet_migration.py\n@@ -698,6 +698,47 @@ class WalletMigrationTest(BitcoinTestFramework):\n         assert (self.master_node.wallets_path / \"plainfile\").is_dir()\n         assert (self.master_node.wallets_path / \"plainfile\" / \"wallet.dat\").is_file()\n \n+    def test_walletdir_direct_file(self):\n+        self.log.info(\"Test migrating a legacy wallet stored as a direct file inside a custom walletdir\")\n+        wallet_name = \"walletdir_direct\"\n+        wallet = self.create_legacy_wallet(wallet_name)\n+        wallet.unloadwallet()\n+\n+        wallets_direct = self.master_node.datadir_path / \"wallets_direct\"\n+        wallets_direct.mkdir(parents=True, exist_ok=True)\n+        shutil.copyfile(\n+            self.old_node.wallets_path / wallet_name / \"wallet.dat\",\n+            wallets_direct / wallet_name,\n+        )\n+        assert (wallets_direct / wallet_name).is_file()\n+\n+        self.restart_node(0, extra_args=[f\"-walletdir={wallets_direct}\"])\n+        self.connect_nodes(0, 1)\n+\n+        mocked_time = int(time.time())\n+        self.master_node.setmocktime(mocked_time)\n+        migrate_res = self.master_node.migratewallet(wallet_name)\n+        self.master_node.setmocktime(0)\n+\n+        assert_equal(migrate_res[\"wallet_name\"], wallet_name)\n+        migrated_wallet = self.master_node.get_wallet_rpc(wallet_name)\n+        info = migrated_wallet.getwalletinfo()\n+        assert_equal(info[\"descriptors\"], True)\n+        assert_equal(info[\"format\"], \"sqlite\")\n+\n+        assert (wallets_direct / wallet_name).is_dir()\n+        assert (wallets_direct / wallet_name / \"wallet.dat\").is_file()\n+\n+        self.master_node.unloadwallet(wallet_name, load_on_startup=False)\n+\n+        assert False  # passed until now\n+\n+        self.restart_node(0, extra_args=self.extra_args[0])\n+        self.connect_nodes(0, 1)\n+        if self.default_wallet_name not in self.master_node.listwallets():\n+            self.master_node.loadwallet(self.default_wallet_name)\n+        self.sync_all()\n+\n     def test_addressbook(self):\n         df_wallet = self.master_node.get_wallet_rpc(self.default_wallet_name)\n \n@@ -1562,6 +1603,7 @@ class WalletMigrationTest(BitcoinTestFramework):\n         self.test_wallet_with_path(\"path/that/ends/in/..\")\n         self.test_default_wallet()\n         self.test_direct_file()\n+        self.test_walletdir_direct_file()\n         self.test_addressbook()\n         self.test_migrate_raw_p2sh()\n         self.test_conflict_txs()\n```\n\nIt doesn't fully integrate and pass yet, but the relevant part does pass locally for me.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3681849201",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "commented",
      "id": 3690068030,
      "node_id": "IC_kwDOABII587b8fg-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3690068030",
      "actor": {
        "login": "navneettsinghh",
        "id": 149674402,
        "node_id": "U_kgDOCOvZog",
        "avatar_url": "https://avatars.githubusercontent.com/u/149674402?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/navneettsinghh",
        "html_url": "https://github.com/navneettsinghh",
        "followers_url": "https://api.github.com/users/navneettsinghh/followers",
        "following_url": "https://api.github.com/users/navneettsinghh/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/navneettsinghh/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/navneettsinghh/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/navneettsinghh/subscriptions",
        "organizations_url": "https://api.github.com/users/navneettsinghh/orgs",
        "repos_url": "https://api.github.com/users/navneettsinghh/repos",
        "events_url": "https://api.github.com/users/navneettsinghh/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/navneettsinghh/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-24T15:12:53Z",
      "updated_at": "2025-12-24T15:12:53Z",
      "author_association": "NONE",
      "body": "Yes — I can reproduce the issue 100% of the time.\n\nSteps I follow:\n\nCopy my known-good legacy wallet.dat into the wallet directory:\n\n/mnt/bitcoin/wallets/\n\n\nLaunch bitcoin-qt.\n\nBitcoin Core prompts for migration.\n\nI click Migrate.\n\nMigration completes according to the log, the new descriptor wallet loads once, and then bitcoin-qt exits abruptly with no GUI error.\n\nWhen restarting bitcoin-qt, the entire wallet directory is gone, not just wallet.dat.\n\nThis cycle repeats consistently.\n\nKey Details Suggesting a Bug\n\nThe log always shows:\n\nWallet migration complete.\nWallet completed loading...\nReleasing wallet ..\n\n\nImmediately followed by multiple Qt errors:\n\nGUI: QFSFileEngine::open: No file name specified\n\n\nAnd on the next startup:\n\n[error] Specified -walletdir \"/mnt/bitcoin/wallets\" does not exist\n\n\nThis confirms the directory was deleted after migration, not before.\n\nEnvironment Information\n\nBitcoin Core: v30.0.0 (compiled from source)\n\nQt version: 6.10.1 (dynamic)\n\nOS: Fedora Linux 43 (X11)\n\nKernel: 6.17.12-300.fc43.x86_64\n\nwalletdir: /mnt/bitcoin/wallets mounted on a secondary disk\n\nHardware: Intel i5-10400F, 62.7 GiB RAM\n\nFilesystem: (same as underlying /mnt/bitcoin mount)\n\nThe migration only fails when the wallet directory is on this mounted path. I have not been able to produce a successful migration under any configuration when using this folder.\n\nWhat Actually Gets Deleted\n\nAfter migration succeeds and the wallet is released, the entire directory /mnt/bitcoin/wallets is missing.\n\nInside Bitcoin Core’s log, earlier I can see the backup is made successfully:\n\ncopied wallet.dat to default_wallet_*.legacy.bak\n\n\nThat backup file also disappears because the directory itself gets removed.",
      "user": {
        "login": "navneettsinghh",
        "id": 149674402,
        "node_id": "U_kgDOCOvZog",
        "avatar_url": "https://avatars.githubusercontent.com/u/149674402?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/navneettsinghh",
        "html_url": "https://github.com/navneettsinghh",
        "followers_url": "https://api.github.com/users/navneettsinghh/followers",
        "following_url": "https://api.github.com/users/navneettsinghh/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/navneettsinghh/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/navneettsinghh/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/navneettsinghh/subscriptions",
        "organizations_url": "https://api.github.com/users/navneettsinghh/orgs",
        "repos_url": "https://api.github.com/users/navneettsinghh/repos",
        "events_url": "https://api.github.com/users/navneettsinghh/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/navneettsinghh/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34128#issuecomment-3690068030",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34128"
    },
    {
      "event": "labeled",
      "id": 21756404757,
      "node_id": "LE_lADOABII587fiDhbzwAAAAUQyGQV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21756404757",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-26T07:33:17Z",
      "label": {
        "name": "GUI",
        "color": "02d7e1"
      }
    },
    {
      "event": "unlabeled",
      "id": 21765092925,
      "node_id": "UNLE_lADOABII587fiDhbzwAAAAURTPY9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21765092925",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T10:13:40Z",
      "label": {
        "name": "GUI",
        "color": "02d7e1"
      }
    }
  ]
}
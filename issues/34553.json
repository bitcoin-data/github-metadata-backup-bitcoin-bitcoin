{
  "type": "issue",
  "issue": {
    "id": 3923539750,
    "node_id": "I_kwDOABII587p3Hcm",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34553",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34553/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34553/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34553/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34553",
    "number": 34553,
    "state": "open",
    "state_reason": null,
    "title": "wallet, rpc: createwalletdescriptors ignores BIP44 accounts",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nIf I import a descriptor with a non-zero BIP44 account path, then run the createwalletdescriptor command for the same address type it creates the index 0 account and deactivates the one I imported. Other address types also use account 0.\n```shell\nbitcoin rpc -testnet createwallet \"blank_wallet\" blank=true\nbitcoin rpc -testnet importdescriptors '[{\"desc\": \"pkh(tprv8ZgxMBicQKsPehov3DbrnoRUPSX6DpANYfqcZX6RCaux8pMHhDPLm1NMsiJVPRLZccrsDcDo4b8182oJ9zbTQE6uvM6VznTjqCsezwb51MT/44h/1h/1h/<0;1>/*)#c63vt4ly\", \"active\": true, \"timestamp\": \"now\"}]'\nbitcoin rpc -testnet gethdkeys\nbitcoin rpc -testnet createwalletdescriptor legacy\nbitcoin rpc -testnet createwalletdescriptor bech32m\nbitcoin rpc -testnet gethdkeys\n```\n```json\n{\n  \"name\": \"blank_wallet\"\n}\n[\n  {\n    \"success\": true,\n    \"warnings\": [\n      \"Range not given, using default keypool range\"\n    ]\n  }\n]\n[\n  {\n    \"xpub\": \"tpubD6NzVbkrYhZ4YAqhvsGTCD5axU32P9MH7ySPr38icriLyJc4KcCvwVzE3rsiXaAHBC8QtYWhiBGdc6aZRmroQShGcWygQfErbvLULfJSi8j\",\n    \"has_private\": true,\n    \"descriptors\": [\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/0/*)#4q2dlgt8\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/1/*)#y50vzaml\",\n        \"active\": true\n      }\n    ]\n  }\n]\n{\n  \"descs\": [\n    \"pkh([3f3521a6/44h/1h/0h]tpubDC96eSBUJsfwQLgFycrHgLCvgxy7BM6hbp65t1Tn9ajLQhDTHmtgWQjmgdWgyZxfNY4nGJztAYK7CYh83pNvj1V72Fe2cogcd2WJFwZK9EB/0/*)#5470vsc4\",\n    \"pkh([3f3521a6/44h/1h/0h]tpubDC96eSBUJsfwQLgFycrHgLCvgxy7BM6hbp65t1Tn9ajLQhDTHmtgWQjmgdWgyZxfNY4nGJztAYK7CYh83pNvj1V72Fe2cogcd2WJFwZK9EB/1/*)#9pmw39gd\"\n  ]\n}\n{\n  \"descs\": [\n    \"tr([3f3521a6/86h/1h/0h]tpubDCW7vJKTJGE1e5WTX7mWDmafQmsEMpaVbqFkZih8uQympr8a1FZkw7paeNXkVgE28jdZd13aexRzuCzF3NfuzQNFgAqmSU9p1DDrYeRUUoE/0/*)#e7freggd\",\n    \"tr([3f3521a6/86h/1h/0h]tpubDCW7vJKTJGE1e5WTX7mWDmafQmsEMpaVbqFkZih8uQympr8a1FZkw7paeNXkVgE28jdZd13aexRzuCzF3NfuzQNFgAqmSU9p1DDrYeRUUoE/1/*)#g2vzyac4\"\n  ]\n}\n[\n  {\n    \"xpub\": \"tpubD6NzVbkrYhZ4YAqhvsGTCD5axU32P9MH7ySPr38icriLyJc4KcCvwVzE3rsiXaAHBC8QtYWhiBGdc6aZRmroQShGcWygQfErbvLULfJSi8j\",\n    \"has_private\": true,\n    \"descriptors\": [\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/0h]tpubDC96eSBUJsfwQLgFycrHgLCvgxy7BM6hbp65t1Tn9ajLQhDTHmtgWQjmgdWgyZxfNY4nGJztAYK7CYh83pNvj1V72Fe2cogcd2WJFwZK9EB/0/*)#5470vsc4\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/0h]tpubDC96eSBUJsfwQLgFycrHgLCvgxy7BM6hbp65t1Tn9ajLQhDTHmtgWQjmgdWgyZxfNY4nGJztAYK7CYh83pNvj1V72Fe2cogcd2WJFwZK9EB/1/*)#9pmw39gd\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/0/*)#4q2dlgt8\",\n        \"active\": false\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/1/*)#y50vzaml\",\n        \"active\": false\n      },\n      {\n        \"desc\": \"tr([3f3521a6/86h/1h/0h]tpubDCW7vJKTJGE1e5WTX7mWDmafQmsEMpaVbqFkZih8uQympr8a1FZkw7paeNXkVgE28jdZd13aexRzuCzF3NfuzQNFgAqmSU9p1DDrYeRUUoE/0/*)#e7freggd\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"tr([3f3521a6/86h/1h/0h]tpubDCW7vJKTJGE1e5WTX7mWDmafQmsEMpaVbqFkZih8uQympr8a1FZkw7paeNXkVgE28jdZd13aexRzuCzF3NfuzQNFgAqmSU9p1DDrYeRUUoE/1/*)#g2vzyac4\",\n        \"active\": true\n      }\n    ]\n  }\n]\n```\n\nRelated to: https://github.com/bitcoin/bitcoin/pull/29129\n\n### Expected behaviour\n\nBased on the `createwalletdescriptor` help text,\n> Creates the wallet's descriptor for the given address type. The address type must be one that the wallet does not already have a descriptor for.\n\nI expected:\n\n-  an error given an address type the wallet already has a descriptor for\n- the active account to propagate to other address types\n\n```shell\n{\n  \"name\": \"blank_wallet\"\n}\n[\n  {\n    \"success\": true,\n    \"warnings\": [\n      \"Range not given, using default keypool range\"\n    ]\n  }\n]\n[\n  {\n    \"xpub\": \"tpubD6NzVbkrYhZ4YAqhvsGTCD5axU32P9MH7ySPr38icriLyJc4KcCvwVzE3rsiXaAHBC8QtYWhiBGdc6aZRmroQShGcWygQfErbvLULfJSi8j\",\n    \"hd_account\": 1,\n    \"has_private\": true,\n    \"descriptors\": [\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/0/*)#4q2dlgt8\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/1/*)#y50vzaml\",\n        \"active\": true\n      }\n    ]\n  }\n]\nerror code: -4\nerror message:\nDescriptor already exists\n{\n  \"descs\": [\n    \"tr([3f3521a6/86h/1h/1h]tpub.../0/*)...\",\n    \"tr([3f3521a6/86h/1h/1h]tpub.../1/*)...\"\n  ]\n}\n[\n  {\n    \"xpub\": \"tpubD6NzVbkrYhZ4YAqhvsGTCD5axU32P9MH7ySPr38icriLyJc4KcCvwVzE3rsiXaAHBC8QtYWhiBGdc6aZRmroQShGcWygQfErbvLULfJSi8j\",\n    \"hd_account\": 1,\n    \"has_private\": true,\n    \"descriptors\": [\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/0/*)#4q2dlgt8\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"pkh([3f3521a6/44h/1h/1h]tpubDC96eSBUJsfwSkkQFtdwCv2sYs3BNDVpBn7RqnpP2e1BSZDzojUT9J5SyEpZXJJtmm1mGRfpyipjQ1XhzrnxUoRT17BhWGw4G6UQimL4t42/1/*)#y50vzaml\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"tr([3f3521a6/86h/1h/1h]tpub.../0/*)...\",\n        \"active\": true\n      },\n      {\n        \"desc\": \"tr([3f3521a6/86h/1h/1h]tpub.../1/*)...\",\n        \"active\": true\n      }\n    ]\n  }\n]\n```\n\nI also expected an `hd_account` option for createwalletdescriptor (see https://github.com/bitcoin/bitcoin/pull/29130#discussion_r1435607572):\n>It could make sense to add an ... `hd_account` option (see https://github.com/bitcoin/bitcoin/pull/29129#issuecomment-1869859432) for ... wallets :\n> ```shell\n> # Add descriptors from the external signer with the specified BIP44 account\n> createwalletdescriptor hd_account=1\n>```\n\n`createwalletdescriptor help`:\n```\nNamed Arguments:\ninternal    (boolean, optional, default=Both external and internal will be generated unless this parameter is specified) Whether to only make one descriptor that is internal (if parameter is true) or external (if parameter is false)\nhdkey       (string, optional, default=The HD key used by all other active descriptors) The HD key that the wallet knows the private key of, listed using 'gethdkeys', to use for this descriptor's key\nhd_account  (numeric, optional, default=The BIP44 account used by all other active descriptors) The BIP44 account, listed using 'gethdkeys', to use for this descriptor's derivation path.\n```\n`gethdkeys help`:\n```\nResult:\n[                                  (json array)\n  {                                (json object)\n    \"xpub\" : \"str\",                (string) The extended public key\n    \"hd_account\": n,               (numeric, optional) The HD account used by all active descriptors if the wallet follows BIP44\n    \"has_private\" : true|false,    (boolean) Whether the wallet has the private key for this xpub\n    \"xprv\" : \"str\",                (string, optional) The extended private key if \"private\" is true\n    \"descriptors\" : [              (json array) Array of descriptor objects that use this HD key\n      {                            (json object)\n        \"desc\" : \"str\",            (string) Descriptor string representation\n        \"active\" : true|false      (boolean) Whether this descriptor is currently used to generate new addresses\n      },\n      ...\n    ]\n  },\n  ...\n]\n```\n\nThe following behavior may also be expected for non-0 BIP44 accounts:\n>Software should prevent a creation of an account if a previous account does not have a transaction history (meaning none of its addresses have been used before).\n>\n>Software needs to discover all used accounts after importing the seed from an external source. Such an algorithm is described in \"[Account discovery](github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#account-discovery)\" chapter.\n\nHowever this is problematic for external signers so it should warn rather than prevent if it cannot scan the chain.\n\n### Steps to reproduce\n\n```shell\nbitcoin rpc -testnet createwallet \"blank_wallet\" blank=true\nbitcoin rpc -testnet importdescriptors '[{\"desc\": \"pkh(tprv8ZgxMBicQKsPehov3DbrnoRUPSX6DpANYfqcZX6RCaux8pMHhDPLm1NMsiJVPRLZccrsDcDo4b8182oJ9zbTQE6uvM6VznTjqCsezwb51MT/44h/1h/1h/<0;1>/*)#c63vt4ly\", \"active\": true, \"timestamp\": \"now\"}]'\nbitcoin rpc -testnet gethdkeys\nbitcoin rpc -testnet createwalletdescriptor legacy\nbitcoin rpc -testnet createwalletdescriptor bech32m\nbitcoin rpc -testnet gethdkeys\n```\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv30.2.0\n\n### Operating system and version\n\nDebian 13\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "BenWestgate",
      "id": 73506583,
      "node_id": "MDQ6VXNlcjczNTA2NTgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/73506583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BenWestgate",
      "html_url": "https://github.com/BenWestgate",
      "followers_url": "https://api.github.com/users/BenWestgate/followers",
      "following_url": "https://api.github.com/users/BenWestgate/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/BenWestgate/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/BenWestgate/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/BenWestgate/subscriptions",
      "organizations_url": "https://api.github.com/users/BenWestgate/orgs",
      "repos_url": "https://api.github.com/users/BenWestgate/repos",
      "events_url": "https://api.github.com/users/BenWestgate/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/BenWestgate/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 0,
    "created_at": "2026-02-10T20:58:26Z",
    "updated_at": "2026-02-10T20:58:26Z"
  },
  "events": []
}
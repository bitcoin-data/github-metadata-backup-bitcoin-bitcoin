{
  "type": "issue",
  "issue": {
    "id": 2483414139,
    "node_id": "I_kwDOABII586UBeR7",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30704",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30704/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30704/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30704/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30704",
    "number": 30704,
    "state": "closed",
    "state_reason": "completed",
    "title": "Intermittent timeout on p2p_ibd_stalling.py",
    "body": "On slow hardware (e.g. qemu s390x), the test may take long enough for a block timeout to hit.\r\n\r\nShould be easy to fix with by using mocktime.\r\n\r\nTest folder: https://drahtbot.space/temp_scratch/p2p_ibd_stalling_23.tar.zstd\r\n\r\nLog:\r\n\r\n```\r\n node0 2024-08-22T06:47:16.815656Z [msghand] [net_processing.cpp:6260] [SendMessages] Timeout downloading block 18f9c9ae8651e9aeb776ec51943c7fb4b813b1dedae262459d1915f69c345f52 from peer=0, disconnecting \r\n node0 2024-08-22T06:47:16.815964Z [msghand] [net_processing.cpp:3721] [ProcessMessage] [net] received: ping (8 bytes) peer=3 \r\n node0 2024-08-22T06:47:16.816064Z [msghand] [net.cpp:3811] [PushMessage] [net] sending pong (8 bytes) peer=3 \r\n node0 2024-08-22T06:47:16.915330Z [net] [net.cpp:554] [CloseSocketDisconnect] [net] disconnecting peer=0 \r\n node0 2024-08-22T06:47:16.918118Z [msghand] [net.cpp:3811] [PushMessage] [net] sending getheaders (709 bytes) peer=2 \r\n node0 2024-08-22T06:47:16.918724Z [msghand] [net_processing.cpp:5956] [SendMessages] [net] initial getheaders (1023) to peer=2 (startheight:-1) \r\n node0 2024-08-22T06:47:16.918966Z [msghand] [net_processing.cpp:6330] [SendMessages] [net] Requesting block 18f9c9ae8651e9aeb776ec51943c7fb4b813b1dedae262459d1915f69c345f52 (1) peer=2 \r\n node0 2024-08-22T06:47:16.919067Z [msghand] [net.cpp:3811] [PushMessage] [net] sending getdata (37 bytes) peer=2 \r\n node0 2024-08-22T06:47:16.919942Z [net] [net_processing.cpp:1829] [FinalizeNode] [net] Cleared nodestate for peer=0 \r\n test  2024-08-22T06:47:17.017000Z TestFramework.p2p (DEBUG): Received message from 0:0: msg_pong(nonce=00000000) \r\n test  2024-08-22T06:47:17.119000Z TestFramework.p2p (DEBUG): Received message from 0:0: msg_pong(nonce=00000002) \r\n node0 2024-08-22T06:47:17.520157Z [http] [httpserver.cpp:304] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:47064 \r\n node0 2024-08-22T06:47:17.520799Z [httpworker.2] [rpc/request.cpp:232] [parse] [rpc] ThreadRPCServer method=setmocktime user=__cookie__ \r\n node0 2024-08-22T06:47:17.523977Z (mocktime: 2024-08-22T06:47:20Z) [msghand] [net.cpp:3811] [PushMessage] [net] sending ping (8 bytes) peer=3 \r\n test  2024-08-22T06:47:17.729000Z TestFramework.p2p (DEBUG): Send message to 0:0: msg_ping(nonce=00000000) \r\n test  2024-08-22T06:47:18.034000Z TestFramework.p2p (DEBUG): Send message to 0:0: msg_ping(nonce=00000003) \r\n test  2024-08-22T06:47:18.133000Z TestFramework.p2p (DEBUG): Received message from 0:0: msg_getheaders(locator=CBlockLocator(vHave=[51028225979965589115881295727807611172333580580510573636467498638508850996547, 37346697185465419591271892594955379773421573672880910261031220352642097666271, 47497146063212786347821522065691681944014067115601124413323342786269280909619, 10155215406424420928512133715677395700252338193336708338193649843546379819750, 12596206149537312092722852210202627880578754014803501430438212157406146713615, 4988562031271065201841151199285356329364187965297931174338631... (msg truncated) \r\n test  2024-08-22T06:47:18.231000Z TestFramework.p2p (DEBUG): Received message from 0:0: msg_getdata(inv=[CInv(type=WitnessBlock hash=18f9c9ae8651e9aeb776ec51943c7fb4b813b1dedae262459d1915f69c345f52)]) \r\n test  2024-08-22T06:47:18.232000Z TestFramework.p2p (DEBUG): Closed connection to: 0:0 \r\n test  2024-08-22T06:47:18.329000Z TestFramework.p2p (DEBUG): Received message from 0:0: msg_ping(nonce=c80d58f07fbd6fa5) \r\n test  2024-08-22T06:47:18.331000Z TestFramework (ERROR): Assertion failed \r\n                                   Traceback (most recent call last):\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/test_framework/test_framework.py\", line 132, in main\r\n                                       self.run_test()\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/p2p_ibd_stalling.py\", line 90, in run_test\r\n                                       self.all_sync_send_with_ping(peers)\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/p2p_ibd_stalling.py\", line 155, in all_sync_send_with_ping\r\n                                       p.sync_with_ping()\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/test_framework/p2p.py\", line 703, in sync_with_ping\r\n                                       self.wait_until(test_function, timeout=timeout)\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/test_framework/p2p.py\", line 588, in wait_until\r\n                                       wait_until_helper_internal(test_function, timeout=timeout, lock=p2p_lock, timeout_factor=self.timeout_factor)\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/test_framework/util.py\", line 286, in wait_until_helper_internal\r\n                                       if predicate():\r\n                                          ^^^^^^^^^^^\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-s390x-linux-gnu/test/functional/test_framework/p2p.py\", line 585, in test_function\r\n                                       assert self.is_connected\r\n                                              ^^^^^^^^^^^^^^^^^\r\n                                   AssertionError\r\n ",
    "user": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "closed_at": "2024-08-27T10:20:47Z",
    "created_at": "2024-08-23T15:45:23Z",
    "updated_at": "2024-08-27T10:20:47Z"
  },
  "events": [
    {
      "event": "closed",
      "id": 14026099940,
      "node_id": "CE_lADOABII586UBeR7zwAAAANEBUzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14026099940",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e53b1c1a4bba7814a0431dfc976193761efc773a",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e53b1c1a4bba7814a0431dfc976193761efc773a",
      "created_at": "2024-08-27T10:20:48Z"
    },
    {
      "event": "referenced",
      "id": 14026105347,
      "node_id": "REFE_lADOABII586UBeR7zwAAAANEBWID",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14026105347",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e53b1c1a4bba7814a0431dfc976193761efc773a",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/e53b1c1a4bba7814a0431dfc976193761efc773a",
      "created_at": "2024-08-27T10:21:12Z"
    }
  ]
}
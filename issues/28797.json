{
  "type": "issue",
  "issue": {
    "id": 1977888344,
    "node_id": "I_kwDOABII58515C5Y",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/28797",
    "number": 28797,
    "state": "open",
    "state_reason": null,
    "title": "Wallet Missing Balances/Unspent",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nWallet is missing the balance for txid d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396. The output address (and input address) are mine:\r\n\r\n```\r\n getaddressinfo bc1qag6gtevhvuhafph4d73ajlj5vyhh7k4xff0p4f\r\n{\r\n  \"address\": \"bc1qag6gtevhvuhafph4d73ajlj5vyhh7k4xff0p4f\",\r\n  \"scriptPubKey\": \"0014ea3485e597672fd486f56fa3d97e54612f7f5aa6\",\r\n  \"ismine\": true,\r\n  \"solvable\": true,\r\n  \"desc\": \"wpkh([e330d50b/0'/0'/1882']02beedde844990949a471bef29330f6a777ccb88aaecaf3491d9119f9454ffbd1f)#5tasvy0h\",\r\n  \"iswatchonly\": false,\r\n  \"isscript\": false,\r\n  \"iswitness\": true,\r\n  \"witness_version\": 0,\r\n  \"witness_program\": \"ea3485e597672fd486f56fa3d97e54612f7f5aa6\",\r\n  \"pubkey\": \"02beedde844990949a471bef29330f6a777ccb88aaecaf3491d9119f9454ffbd1f\",\r\n  \"ischange\": false,\r\n  \"timestamp\": 1634944153,\r\n  \"hdkeypath\": \"m/0'/0'/1882'\",\r\n  \"hdseedid\": \"bf8e10d1998ca0f7a73b372d0ab4d9ddfa6aa4c6\",\r\n  \"hdmasterfingerprint\": \"e330d50b\",\r\n  \"labels\": [\r\n    \"LDK output address\"\r\n  ]\r\n}\r\ngetaddressinfo bc1qqdaevqjz84r0m8wxejugvcnjreuuu0xz0wwxym\r\n{\r\n  \"address\": \"bc1qqdaevqjz84r0m8wxejugvcnjreuuu0xz0wwxym\",\r\n  \"scriptPubKey\": \"0014037b9602423d46fd9dc6ccb88662721e79ce3cc2\",\r\n  \"ismine\": true,\r\n  \"solvable\": true,\r\n  \"desc\": \"wpkh([e330d50b/0'/0'/1822']03e243567081536017cb11508b7fb53ccdde657bcc5df10b9405f4cb9aa3fa6858)#48670jcm\",\r\n  \"iswatchonly\": false,\r\n  \"isscript\": false,\r\n  \"iswitness\": true,\r\n  \"witness_version\": 0,\r\n  \"witness_program\": \"037b9602423d46fd9dc6ccb88662721e79ce3cc2\",\r\n  \"pubkey\": \"03e243567081536017cb11508b7fb53ccdde657bcc5df10b9405f4cb9aa3fa6858\",\r\n  \"ischange\": false,\r\n  \"timestamp\": 1634856115,\r\n  \"hdkeypath\": \"m/0'/0'/1822'\",\r\n  \"hdseedid\": \"bf8e10d1998ca0f7a73b372d0ab4d9ddfa6aa4c6\",\r\n  \"hdmasterfingerprint\": \"e330d50b\",\r\n  \"labels\": [\r\n    \"LDK output address\"\r\n  ]\r\n}\r\n```\r\n\r\nlisttransactions lists it with 200+ confirmations\r\n```\r\n  {\r\n    \"address\": \"bc1qag6gtevhvuhafph4d73ajlj5vyhh7k4xff0p4f\",\r\n    \"parent_descs\": [\r\n    ],\r\n    \"category\": \"receive\",\r\n    \"amount\": 0.07856602,\r\n    \"label\": \"LDK output address\",\r\n    \"vout\": 0,\r\n    \"confirmations\": 257,\r\n    \"blockhash\": \"00000000000000000000a1c320c11959e670e2fb26ca0d5df64a2c453b4105d2\",\r\n    \"blockheight\": 815214,\r\n    \"blockindex\": 41,\r\n    \"blocktime\": 1699074707,\r\n    \"txid\": \"d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396\",\r\n    \"wtxid\": \"137bf6d9142d8a3a5a554f86298c43b635c40d8e4486a0d92a320d03c7160708\",\r\n    \"walletconflicts\": [\r\n      \"1bd8d162be5a4b91c083866386a9e6ca0201f2c837241350855a61a7d4a9f78c\"\r\n    ],\r\n    \"time\": 1699074653,\r\n    \"timereceived\": 1699074653,\r\n    \"bip125-replaceable\": \"no\"\r\n  },\r\n  {\r\n    \"address\": \"bc1qag6gtevhvuhafph4d73ajlj5vyhh7k4xff0p4f\",\r\n    \"category\": \"send\",\r\n    \"amount\": -0.07856602,\r\n    \"label\": \"LDK output address\",\r\n    \"vout\": 0,\r\n    \"fee\": -0.00019383,\r\n    \"confirmations\": 257,\r\n    \"blockhash\": \"00000000000000000000a1c320c11959e670e2fb26ca0d5df64a2c453b4105d2\",\r\n    \"blockheight\": 815214,\r\n    \"blockindex\": 41,\r\n    \"blocktime\": 1699074707,\r\n    \"txid\": \"d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396\",\r\n    \"wtxid\": \"137bf6d9142d8a3a5a554f86298c43b635c40d8e4486a0d92a320d03c7160708\",\r\n    \"walletconflicts\": [\r\n      \"1bd8d162be5a4b91c083866386a9e6ca0201f2c837241350855a61a7d4a9f78c\"\r\n    ],\r\n    \"time\": 1699074653,\r\n    \"timereceived\": 1699074653,\r\n    \"bip125-replaceable\": \"no\",\r\n    \"abandoned\": false\r\n  },\r\n```\r\n\r\nbut its not in listunspent and its missing from balances\r\n```\r\n$ listunspent 0 | grep d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396\r\n$  getbalance \"*\" 0\r\n0.00000000\r\n```\n\n### Expected behaviour\n\nMy money is listed as spendable\n\n### Steps to reproduce\n\nProbably import those keys as watchonly and see what happens\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\n25.1, also happened on 23.0 which i was using until i upgraded to try to fix this\n\n### Operating system and version\n\nLinux\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 10,
    "created_at": "2023-11-05T17:40:00Z",
    "updated_at": "2023-11-08T00:24:02Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1795347642,
      "node_id": "IC_kwDOABII585rAtS6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795347642",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T16:26:08Z",
      "updated_at": "2023-11-06T16:26:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "```\r\ngetwalletinfo\r\n{\r\n  \"walletname\": \"\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"bdb\",\r\n...\r\n  \"keypoolsize\": 1000,\r\n  \"keypoolsize_hd_internal\": 1000,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": false,\r\n  \"external_signer\": false\r\n}\r\n```",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1795347642",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1795362833,
      "node_id": "IC_kwDOABII585rAxAR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795362833",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T16:31:55Z",
      "updated_at": "2023-11-06T16:31:55Z",
      "author_association": "NONE",
      "body": ">     \"walletconflicts\": [\r\n>      \"1bd8d162be5a4b91c083866386a9e6ca0201f2c837241350855a61a7d4a9f78c\"\r\n\r\nMaybe this is the reason for incorrect balance?\r\n    \r\n",
      "user": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1795362833",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1795856728,
      "node_id": "IC_kwDOABII585rCplY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795856728",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T18:30:40Z",
      "updated_at": "2023-11-06T18:30:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "Probably, but just because a transaction was RBF-bumped there shouldn't be an incorrect balance/missing unspent entry :)",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1795856728",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1795955354,
      "node_id": "IC_kwDOABII585rDBqa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1795955354",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T19:03:24Z",
      "updated_at": "2023-11-06T19:03:24Z",
      "author_association": "MEMBER",
      "body": "cc @achow101 ",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1795955354",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "mentioned",
      "id": 10877342082,
      "node_id": "MEE_lADOABII58515C5YzwAAAAKIVxGC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10877342082",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T19:03:24Z"
    },
    {
      "event": "subscribed",
      "id": 10877342116,
      "node_id": "SE_lADOABII58515C5YzwAAAAKIVxGk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10877342116",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T19:03:24Z"
    },
    {
      "event": "commented",
      "id": 1796181526,
      "node_id": "IC_kwDOABII585rD44W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796181526",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T19:40:25Z",
      "updated_at": "2023-11-06T19:46:34Z",
      "author_association": "MEMBER",
      "body": "I think the only conditions for this to happen are either the output has been spent by something in the wallet that has not been broadcast yet, or if the wallet thinks that those outputs are not ismine. The latter shouldn't be possible given that `getaddressinfo` reports both addresses as ismine. Can you check if there is some transaction in your wallet that is spending that output but wasn't broadcast?\r\n\r\nIt could be that the output is locked with `lockunspent`, but that should only affect `listunspent` and not `getbalance`.\r\n\r\nAlso, I don't think it's possible to replicate this without having the private keys or even the wallet itself. Watchonly is a different set of conditions.\r\n\r\nCan you provide more details on how this wallet was constructed, e.g. were things imported?\r\n\r\nIf you import the privkeys into a new wallet, does it exhibit the same problem?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1796181526",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1796963490,
      "node_id": "IC_kwDOABII585rG3yi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796963490",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T22:37:01Z",
      "updated_at": "2023-11-06T22:37:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "Nothing has ever been imported into this wallet, its pretty much bog-standard, except that transactions are built with the raw transaction interface (eg the linked transaction, which spends my money back to myself and adds another input, in this case a lightning anchor). Nothing touching this wallet uses `lockunspent`.",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1796963490",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1796972545,
      "node_id": "IC_kwDOABII585rG6AB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1796972545",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T22:42:52Z",
      "updated_at": "2023-11-06T22:44:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "There doesn't appear to be anything in-wallet that is spending that output:\r\n\r\n`bitcoin-cli listtransactions \"*\" 10000000 | jq '.[] | select(.confirmations <= 0) | .txid' | xargs -L1 bitcoin-cli gettransaction | grep bc1qag6gtevhvuhafph4d73ajlj5vyhh7k4xff0p4f` shows nothing and the non-confirmations-filtered version only shows `d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396` twice.",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1796972545",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1797031592,
      "node_id": "IC_kwDOABII585rHIao",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1797031592",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T23:32:54Z",
      "updated_at": "2023-11-06T23:32:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "Ah, okay, so what happened is two bugs and one need-package-relay issue:\r\n\r\nThe above snippet didn't work because of the bug you can see in the above `listtransactions` output: if a transaction spends from an address of ours to an address of ours its (correctly) listed twice, but both times with the output address, neither time with the input address, even though one listing is \"send\". That's a bug.\r\n\r\nThis did turn up a spending tx, but that tx was in the broader mempool because its parent didn't have sufficient feerate to enter common mempools (the spending tx is a CPFP fee-bump of an unrelated transaction):\r\n`listtransactions \"*\" 10000000 | jq '.[] | select(.confirmations <= 0) | .txid' | xargs -L1 ~/search-tx.sh | grep -C50 d49589ccd8488c56fbf12aee2652f760e1e84e6da1edd3dcf98bf6d556151396`\r\n```\r\ncat ~/search-tx.sh\r\nbitcoin-cli \"$1\" | jq '.hex' | tr -d '\"' | bitcoin-cli decoderawtransaction\r\n```\r\n\r\nSo, were there package relay it would have broadcasted.\r\n\r\nFurther, the spending tx here is a send-from-self-to-self, which should be listed in balance/listunspent when I ask for 0-conf as the limit, AFAIU, or at least should have an option to, which is a second bug.",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1797031592",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1797041131,
      "node_id": "IC_kwDOABII585rHKvr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1797041131",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T23:44:18Z",
      "updated_at": "2023-11-06T23:44:18Z",
      "author_association": "MEMBER",
      "body": "> The above snippet didn't work because of the bug you can see in the above `listtransactions` output: if a transaction spends from an address of ours to an address of ours its (correctly) listed twice, but both times with the output address, neither time with the input address, even though one listing is \"send\". That's a bug.\r\n\r\nIt doesn't show input addresses since they don't exist (or something like that). However we do have the spent-by info so each \"transaction\" in `listtransactions` could show that.\r\n\r\n> Further, the spending tx here is a send-from-self-to-self, which should be listed in balance/listunspent when I ask for 0-conf as the limit, AFAIU, or at least should have an option to, which is a second bug.\r\n\r\nIt only includes the utxo in the balance and in `listunspent` if it is available for spending. A transaction that is not in the mempool should not have any of its outputs available for spending since any attempt to spend them (currently) would result in a transaction that probably cannot be broadcast. I'm pretty sure there are several ancient issues describing this and I believe the conclusion is generally to err on the safe side of telling the user that they don't have the money.\r\n\r\nI think it will show up if you use `getbalances` though?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1797041131",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    },
    {
      "event": "commented",
      "id": 1797050149,
      "node_id": "IC_kwDOABII585rHM8l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1797050149",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T23:55:13Z",
      "updated_at": "2023-11-07T00:07:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It doesn't show input addresses since they don't exist (or something like that). However we do have the spent-by info so each \"transaction\" in listtransactions could show that.\r\n\r\nRight, then the \"address\" field should be skipped. A \"send\" entry is referring to the fact that we spent some of our money, and generally we don't list an address, the address inclusion in a \"send\" entry that's unrelated to the \"send\" part of the transaction is...very confusing :)\r\n\r\nThat said, given such an entry is specifically related a an input which spends our own address, I think its safe to say there's a \"from\" address when we're talking about a specific input in a greater transaction :).\r\n\r\n> It only includes the utxo in the balance and in listunspent if it is available for spending. A transaction that is not in the mempool should not have any of its outputs available for spending since any attempt to spend them (currently) would result in a transaction that probably cannot be broadcast. I'm pretty sure there are several ancient issues describing this and I believe the conclusion is generally to err on the safe side of telling the user that they don't have the money.\r\n\r\n~To be clear it was in the local node's mempool, it however had not propagated. Even now with it pushed to a neighboring node the balance is still listed zero.~ Oh, that's a lie, I was looking in the wrong place. Indeed, not a bug then, though with modern technologies like RBF and CPFP we may want to reconsider the state of things here.",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/28797#issuecomment-1797050149",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28797"
    }
  ]
}
{
  "type": "issue",
  "issue": {
    "id": 3653223188,
    "node_id": "I_kwDOABII587Zv8MU",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33923",
    "number": 33923,
    "state": "open",
    "state_reason": null,
    "title": "should concurrent IPC requests directed to the same thread cause a crash?",
    "body": "recently I reported https://github.com/bitcoin/bitcoin/issues/33554, which was fixed by the introduction of `interruptWait` via #33575\n\nthen I noticed crashes for similar reasons (although unrelated to `waitNext`), which I explain in detail here: https://github.com/stratum-mining/sv2-apps/issues/88#issuecomment-3558003166\n\nTLDR: I was trying to do a `getBlock` while a `submitSolution` was happening at the same time, both against the same Bitcoin Core thread\n\nthis made me realize that regardless of whether the call is going to block for a long time (like `waitNext`), I simply cannot leave room for concurrent calls against the same Bitcoin Core thread\n\nwhich feels a bit contradictory to what @ryanofsky suggested here: https://github.com/bitcoin/bitcoin/issues/33554#issuecomment-3382354366\n\n> More broadly, I think I'd try just having a c++ \"waiter\" thread dedicated to running waitNext calls, and a c++ \"worker\" thread to run all other IPC operations besides waitNext. The \"waiter\" thread should be mostly blocked monitoring mempool and network, and the \"worker\" thread should be available to do anything else you might need like fetching and submitting block data.\n\nand it's making me re-evaluate some assumptions I had when I started https://github.com/stratum-mining/sv2-apps/pull/59\n\noverall, I'm getting to a place where I'm having to go great lengths in terms of defensive programming just to avoid crashing Bitcoin Core\n\nI'm still evaluating the trade-offs of potential defensive strategies, namely:\n- having synchronization primitives that avoid overlapping requests against the same Bitcoin Core thread\n- instantiating multiple Bitcoin Core threads, one dedicated for each potentially concurrent request\n\nbut I digress... the main point I wanted to articulate here was: shouldn't Bitcoin Core simply not crash if two requests arrive for the same thread?\n\nideally, a naive client should simply be forced to wait a bit longer if they send concurrent requests against the same Bitcoin Core thread, instead of being forced to avoid doing this at all cost because it could cause havoc on the other side of the IPC connection",
    "user": {
      "login": "plebhash",
      "id": 147345153,
      "node_id": "U_kgDOCMhPAQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/147345153?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/plebhash",
      "html_url": "https://github.com/plebhash",
      "followers_url": "https://api.github.com/users/plebhash/followers",
      "following_url": "https://api.github.com/users/plebhash/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/plebhash/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/plebhash/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/plebhash/subscriptions",
      "organizations_url": "https://api.github.com/users/plebhash/orgs",
      "repos_url": "https://api.github.com/users/plebhash/repos",
      "events_url": "https://api.github.com/users/plebhash/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/plebhash/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      },
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      },
      {
        "id": 2260068353,
        "node_id": "MDU6TGFiZWwyMjYwMDY4MzUz",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/interfaces",
        "name": "interfaces",
        "description": "",
        "color": "83c9fc",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 4,
    "created_at": "2025-11-21T22:05:01Z",
    "updated_at": "2026-01-15T09:08:52Z"
  },
  "events": [
    {
      "event": "mentioned",
      "id": 21106296673,
      "node_id": "MEE_lADOABII587Zv8MUzwAAAATqCIdh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21106296673",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T22:05:02Z"
    },
    {
      "event": "subscribed",
      "id": 21106296695,
      "node_id": "SE_lADOABII587Zv8MUzwAAAATqCId3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21106296695",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T22:05:03Z"
    },
    {
      "event": "commented",
      "id": 3564979973,
      "node_id": "IC_kwDOABII587UfUcF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3564979973",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T23:29:12Z",
      "updated_at": "2025-11-21T23:29:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "> shouldn't Bitcoin Core simply not crash if two requests arrive for the same thread?\n\nYes this shouldn't crash. Hopefully, if you are using a version of bitcoin after https://github.com/bitcoin-core/libmultiprocess/pull/214 (part of #33518 in master and part of #33519 in 30.x branch) you should just see \"thread busy\" errors instead of crashes, and it is a bug if there are still crashes.\n\n> ideally, a naive client should simply be forced to wait a bit longer if they send concurrent requests against the same Bitcoin Core thread\n\nThis is reasonable and would be pretty easy to implement, but it raises the question of how many requests should be allowed? Should it allow 5, 10, or 100 requests before returning \"thread busy\"? Or an arbitrary amount? Or a configurable amount?\n\nMy thinking has been that if a client needs a request queue, it is probably better for the client implement the queue, than to have the server provide one because the client should know its own needs better. Also, not every client needs a queue. For example, Sjor's SV2 client is multithreaded and only makes blocking requests. It just creates one server thread for each client thread, so every server thread is guaranteed to not be busy when a request comes in.\n\nSince the rust client is single threaded and nonblocking, it needs to create different server threads for those requests to execute in parallel like the c++ client does, or it needs to have a queue so requests created in parallel can be executed serially on a single server thread.\n\nIn practice, I think it make sense for the rust client to just create 2 server threads: a waiting thread to execute `waitNext()` calls, and a worker thread using a queue to execute all other calls.\n\nIt if would help, I could add a `enableRequestQueue()` or similar method to the [`Thread`](https://github.com/bitcoin-core/libmultiprocess/blob/470fc518d4be83649fce9ad71e6d32536ffa1aac/include/mp/proxy.capnp#L50-L54) interface so the rust client can ask for the requests sent to a thread to be queued. \n\nHowever, I think it would probably be straightforward to implement a queue in rust on the client side instead. And I wouldn't want queuing to be enabled on the server by default because it could mask other problems. Like if a request was accidentally sent to the waiting thread rather than the worker thread, it could just sit there forever if queuing was enabled on the waiting thread, instead of returning an error.\n\nThanks for reporting the problem here and I hope this can lead to a good solution.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3564979973",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923"
    },
    {
      "event": "commented",
      "id": 3566852691,
      "node_id": "IC_kwDOABII587UmdpT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3566852691",
      "actor": {
        "login": "plebhash",
        "id": 147345153,
        "node_id": "U_kgDOCMhPAQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/147345153?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/plebhash",
        "html_url": "https://github.com/plebhash",
        "followers_url": "https://api.github.com/users/plebhash/followers",
        "following_url": "https://api.github.com/users/plebhash/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/plebhash/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/plebhash/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/plebhash/subscriptions",
        "organizations_url": "https://api.github.com/users/plebhash/orgs",
        "repos_url": "https://api.github.com/users/plebhash/repos",
        "events_url": "https://api.github.com/users/plebhash/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/plebhash/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-22T16:18:56Z",
      "updated_at": "2025-11-22T16:18:56Z",
      "author_association": "NONE",
      "body": "I guess the main thing I wanted to report here is a duplicate of https://github.com/bitcoin-core/libmultiprocess/pull/214, so it's good to know these crashes won't happen on `v30.x`!\n\n> how many requests should be allowed? Should it allow 5, 10, or 100 requests before returning \"thread busy\"? Or an arbitrary amount? Or a configurable amount?\n\nit would be up to the client to know what are the reasonable bounds for backpressure so that it can avoid the need to handle errors, so I'd say that a configurable amount with a reasonably large default\n\nbut since you also mentioned:\n\n> And I wouldn't want queuing to be enabled on the server by default because it could mask other problems.\n\nI wouldn't necessarily frame this as an actual feature request, mainly because we're working around this without having to resort to server-side queueing.\n\n---\n\n> Since the rust client is single threaded and nonblocking, it needs to create different server threads for those requests to execute in parallel like the c++ client does, or it needs to have a queue so requests created in parallel can be executed serially on a single server thread.\n\ncurrently we're going with the first approach, so now we create 5 server threads, one dedicated for each potentially concurrent call:\n- `submitSolution`\n- `getHeader`\n- `getCoinbaseTx`\n- `getCoinbaseMerklePath`\n- `waitNext`\n\nplus some ad-hoc threads that are created ephemerally whenever we need to do a `getBlock` (either to reply to a `RequestTransactionData` or because we want to dump a valid solution to disk)\n\nto be honest, we could have gotten away with only 2 by forcing `getHeader`, `getCoinbaseTx`, `getCoinbaseMerklePath` and `waitNext` to be done sequentially under the same server thread\n\nbut we're trying to squeeze out every possible micro/nano/pico second out of the way with concurrent execution of `getHeader`, `getCoinbaseTx`, `getCoinbaseMerklePath` so we can craft a `NewTemplate` message ASAP (the ones for mempool updates are actually rate-limited, so we're not really in a race... but for chain tip updates we do want this to happen as fast as possible)\n\nwith this approach, queuing requests on the server side is not needed at all.\n\nbut it made me wonder about something (which I was eventually going to be forced to consider anyways):\n\nwe eventually want to adapt this code so that it can become a sidecar that's attached to Bitcoin Core, which then acts as a Sv2 Template Provider, listening on a TCP port and catering for as many clients as possible... so now, for every client that connects to it, we create 5 new threads on Bitcoin Core\n\nwhether we create 1, 2 or 5 threads for each client is not too relevant, but my main question is whether there are there protection mechanisms in place in case we try to create too many threads at once? if so, what happens once Bitcoin Core is no longer willing to create new threads?",
      "user": {
        "login": "plebhash",
        "id": 147345153,
        "node_id": "U_kgDOCMhPAQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/147345153?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/plebhash",
        "html_url": "https://github.com/plebhash",
        "followers_url": "https://api.github.com/users/plebhash/followers",
        "following_url": "https://api.github.com/users/plebhash/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/plebhash/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/plebhash/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/plebhash/subscriptions",
        "organizations_url": "https://api.github.com/users/plebhash/orgs",
        "repos_url": "https://api.github.com/users/plebhash/repos",
        "events_url": "https://api.github.com/users/plebhash/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/plebhash/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3566852691",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923"
    },
    {
      "event": "subscribed",
      "id": 21133631201,
      "node_id": "SE_lADOABII587Zv8MUzwAAAATrqZ7h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21133631201",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-24T10:03:49Z"
    },
    {
      "event": "commented",
      "id": 3569919239,
      "node_id": "IC_kwDOABII587UyKUH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3569919239",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-24T10:11:41Z",
      "updated_at": "2025-11-24T10:11:41Z",
      "author_association": "MEMBER",
      "body": "> to be honest, we could have gotten away with only 2 by forcing `getHeader`, `getCoinbaseTx`, `getCoinbaseMerklePath` and waitNext to be done sequentially under the same server thread\n\nI think you should bench this before deciding if it needs optimising and also check whether it's _actually_ faster and not e.g. slowing the node responses down with overhead.\n\nIf `getHeader`, `getCoinbase(Tx)` and `getCoinbaseMerklePath` really need to be called in parallel, then I think it would be better if the `BlockTemplate` interface is somehow pre-populated with those values - avoiding these round trips entirely.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3569919239",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923"
    },
    {
      "event": "commented",
      "id": 3607727965,
      "node_id": "IC_kwDOABII587XCY9d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3607727965",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-03T16:31:04Z",
      "updated_at": "2025-12-03T16:31:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "re: https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3566852691\n\n> my main question is whether there are there protection mechanisms in place in case we try to create too many threads at once?\n\nThere aren't any currently, and making a lot of threads is probably the easiest way an IPC client could DoS the node.\n\nIt wouldn't be hard to create a limit though, if there is a use-case.\n\nI do think creating 5 threads for each client that needs to receive templates sounds like overkill, and would suggest trying to implement an approach with less overhead. Ideally the SV2 template provider be able to take a single bitcoin core template and broadcast it out to many clients, instead of each client needing unique templates.\n\nI also agree with sjors it doesn't seem ideal to be calling getters like getHeader, getCoinbaseTx, and getCoinbaseMerklePath in parallel. If we can change the interface to provide a single method that will return all the information needed so you don't need to make multiple calls, that would be better.\n\nre: https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3564979973\n\n> My thinking has been that if a client needs a request queue, it is probably better for the client implement the queue, than to have the server provide one because the client should know its own needs better.\n\nReplying to myself, I now am rethinking my previous thinking. One case where a server queue is clearly better than a client queue is when a client wants to request multiple pieces of data and have the data sent back sequentially. Without a server queue, the client needs to wait for each piece of data to be received before requesting the next piece of data, which is not efficient. With a server queue, data can be streamed back much more nicely. So now I am thinking about ways to implement a queue. And I think it might be possible to do without creating an separate data structure or explicit queue limit by simply attaching data to capnproto promises. This would get rid of the \"thread busy\" error entirely.\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33923#issuecomment-3607727965",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33923"
    },
    {
      "event": "labeled",
      "id": 22064253254,
      "node_id": "LE_lADOABII587Zv8MUzwAAAAUjIclG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22064253254",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T09:08:52Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    },
    {
      "event": "labeled",
      "id": 22064253276,
      "node_id": "LE_lADOABII587Zv8MUzwAAAAUjIclc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22064253276",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T09:08:52Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "labeled",
      "id": 22064253286,
      "node_id": "LE_lADOABII587Zv8MUzwAAAAUjIclm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22064253286",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T09:08:52Z",
      "label": {
        "name": "interfaces",
        "color": "83c9fc"
      }
    }
  ]
}
{
  "type": "issue",
  "issue": {
    "id": 2046743377,
    "node_id": "I_kwDOABII5855_tNR",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/29109",
    "number": 29109,
    "state": "closed",
    "state_reason": "completed",
    "title": "Old wallet.dat: Error reading wallet database: keymeta found with unexpected path / All keys read correctly, but transaction data or address metadata may be missing or incorrect",
    "body": "### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nWhen starting bitcoind with an old wallet (created July 2019, probably `v0.17.x` or `v0.18.x`) the log records 2 errors and one warning that are not self-explanatory.\r\n\r\nMight be related to #19051\n\n### Expected behaviour\n\nNo warning/errors are shown or the errors/warnings are more detailed as to what's going on.\n\n### Steps to reproduce\n\nRun v26.0 with a very old `wallet.dat` file. I wasn't able to reproduce this with a wallet.dat file created in `v0.12.x`, `v0.16.3` or `v0.18.x`. I'm not sure how to reproduce this without uploading the specific `wallet.dat` file (I'm not able to, sorry).\n\n### Relevant log output\n\n## Log from v26.0.0\r\n\r\n```\r\n2023-12-18T13:24:00Z Bitcoin Core version v26.0.0 (release build)\r\n2023-12-18T13:24:00Z Using the 'x86_shani(1way,2way)' SHA256 implementation\r\n2023-12-18T13:24:00Z Using RdSeed as an additional entropy source\r\n2023-12-18T13:24:00Z Using RdRand as an additional entropy source\r\n[..]\r\n2023-12-18T13:24:00Z Using at most 125 automatic connections (1024 file descriptors available)\r\n2023-12-18T13:24:00Z Using 16 MiB out of 16 MiB requested for signature cache, able to store 524288 elements\r\n2023-12-18T13:24:00Z Using 16 MiB out of 16 MiB requested for script execution cache, able to store 524288 elements\r\n2023-12-18T13:24:00Z Script verification uses 7 additional threads\r\n2023-12-18T13:24:00Z scheduler thread start\r\n[..]\r\n2023-12-18T13:24:00Z Using wallet directory /home/foobar/.bitcoin\r\n2023-12-18T13:24:00Z init message: Verifying wallet(s)…\r\n2023-12-18T13:24:00Z Using BerkeleyDB version Berkeley DB 4.8.30: (April  9, 2010)\r\n2023-12-18T13:24:00Z Using wallet /home/foobar/.bitcoin/wallet.dat\r\n2023-12-18T13:24:00Z BerkeleyEnvironment::Open: LogDir=/home/foobar/.bitcoin/database ErrorFile=/home/foobar/.bitcoin/db.log\r\n[..]\r\n2023-12-18T13:24:00Z init message: Loading block index…\r\n2023-12-18T13:24:00Z Assuming ancestors of block 00000000000000000001a0a448d6cf2546b06801389cc030b2b18c6491266815 have valid signatures.\r\n2023-12-18T13:24:00Z Setting nMinimumChainWork=000000000000000000000000000000000000000052b2559353df4117b7348b64\r\n2023-12-18T13:24:00Z Opening LevelDB in /home/foobar/.bitcoin/blocks/index\r\n2023-12-18T13:24:00Z Opened LevelDB successfully\r\n2023-12-18T13:24:00Z Using obfuscation key for /home/foobar/.bitcoin/blocks/index: 0000000000000000\r\n2023-12-18T13:24:03Z LoadBlockIndexDB: last block file = 3945\r\n2023-12-18T13:24:03Z LoadBlockIndexDB: last block file info: CBlockFileInfo(blocks=51, size=84327429, heights=817322...817411, time=2023-11-18...2023-11-19)\r\n2023-12-18T13:24:03Z Checking all blk files are present...\r\n2023-12-18T13:24:04Z Initializing chainstate Chainstate [ibd] @ height -1 (null)\r\n2023-12-18T13:24:04Z Opening LevelDB in /home/foobar/.bitcoin/chainstate\r\n2023-12-18T13:24:04Z Opened LevelDB successfully\r\n2023-12-18T13:24:04Z Using obfuscation key for /home/foobar/.bitcoin/chainstate: 9735fc6504867afd\r\n2023-12-18T13:24:04Z Loaded best chain: hashBestChain=0000000000000000000290f359a90a5d57160fd27954703351c6f1bf838941e0 height=816997 date=2023-11-16T10:24:28Z progress=0.983619\r\n2023-12-18T13:24:04Z Opening LevelDB in /home/foobar/.bitcoin/chainstate\r\n2023-12-18T13:24:04Z Opened LevelDB successfully\r\n2023-12-18T13:24:04Z Using obfuscation key for /home/foobar/.bitcoin/chainstate: 9735fc6504867afd\r\n2023-12-18T13:24:04Z [Chainstate [ibd] @ height 816997 (0000000000000000000290f359a90a5d57160fd27954703351c6f1bf838941e0)] resized coinsdb cache to 8.0 MiB\r\n2023-12-18T13:24:04Z [Chainstate [ibd] @ height 816997 (0000000000000000000290f359a90a5d57160fd27954703351c6f1bf838941e0)] resized coinstip cache to 440.0 MiB\r\n2023-12-18T13:24:04Z init message: Verifying blocks…\r\n2023-12-18T13:24:04Z Verifying last 6 blocks at level 3\r\n2023-12-18T13:24:04Z Verification progress: 0%\r\n2023-12-18T13:24:05Z Verification progress: 16%\r\n2023-12-18T13:24:05Z Verification progress: 33%\r\n2023-12-18T13:24:05Z Verification progress: 50%\r\n2023-12-18T13:24:05Z Verification progress: 66%\r\n2023-12-18T13:24:05Z Verification progress: 83%\r\n2023-12-18T13:24:06Z Verification progress: 99%\r\n2023-12-18T13:24:06Z Verification: No coin database inconsistencies in last 6 blocks (26158 transactions)\r\n2023-12-18T13:24:06Z  block index            5148ms\r\n2023-12-18T13:24:06Z init message: Loading wallet…\r\n2023-12-18T13:24:06Z BerkeleyEnvironment::Open: LogDir=/home/foobar/.bitcoin/database ErrorFile=/home/foobar/.bitcoin/db.log\r\n2023-12-18T13:24:06Z [default wallet] Wallet file version = 10500, last client version = 220000\r\n\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n\r\n2023-12-18T13:24:06Z [default wallet] Legacy Wallet Keys: 657 plaintext, 0 encrypted, 657 w/ metadata, 657 total.\r\n2023-12-18T13:24:06Z [default wallet] Descriptors: 0, Descriptor Keys: 0 plaintext, 0 encrypted, 0 total.\r\n2023-12-18T13:24:06Z [default wallet] Wallet completed loading in               8ms\r\n2023-12-18T13:24:06Z [default wallet] setKeyPool.size() = 600\r\n2023-12-18T13:24:06Z [default wallet] mapWallet.size() = 51\r\n2023-12-18T13:24:06Z [default wallet] m_address_book.size() = 100\r\n\r\n2023-12-18T13:24:06Z Warning: Error reading /home/foobar/.bitcoin/wallet.dat! All keys read correctly, but transaction data or address metadata may be missing or incorrect.\r\n\r\n2023-12-18T13:24:06Z Setting NODE_NETWORK on non-prune mode\r\n2023-12-18T13:24:06Z block tree size = 821776\r\n2023-12-18T13:24:06Z nBestHeight = 816997\r\n2023-12-18T13:24:06Z initload thread start\r\n2023-12-18T13:24:06Z torcontrol thread start\r\n2023-12-18T13:24:06Z Imported mempool transactions from disk: 0 succeeded, 0 failed, 0 expired, 0 already there, 0 waiting for initial broadcast\r\n2023-12-18T13:24:06Z initload thread exit\r\n2023-12-18T13:24:06Z Bound to 127.0.0.1:8334\r\n2023-12-18T13:24:06Z Bound to [::]:8333\r\n2023-12-18T13:24:06Z Bound to 0.0.0.0:8333\r\n2023-12-18T13:24:06Z Loaded 1 addresses from \"anchors.dat\"\r\n2023-12-18T13:24:06Z 1 block-relay-only anchors will be tried for connections.\r\n2023-12-18T13:24:06Z init message: Starting network threads…\r\n[..]\r\n```\r\n\r\n## Log from v25.1.0\r\n\r\nThe error/warning is slightly different.\r\n\r\nInstead of\r\n\r\n> Warning: Error reading /home/foobar/.bitcoin/wallet.dat! All keys read correctly, but transaction data or address metadata may be missing or incorrect.\r\n\r\nit logs\r\n\r\n> Warning: Error reading /home/foobar/.bitcoin/wallet.dat! All keys read correctly, but transaction data or address book entries might be missing or incorrect.\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv26.0\n\n### Operating system and version\n\nUbuntu 22.04 LTS\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "c0deright",
      "id": 20477825,
      "node_id": "MDQ6VXNlcjIwNDc3ODI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/c0deright",
      "html_url": "https://github.com/c0deright",
      "followers_url": "https://api.github.com/users/c0deright/followers",
      "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
      "organizations_url": "https://api.github.com/users/c0deright/orgs",
      "repos_url": "https://api.github.com/users/c0deright/repos",
      "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/c0deright/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      },
      {
        "id": 323697996,
        "node_id": "MDU6TGFiZWwzMjM2OTc5OTY=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Data%20corruption",
        "name": "Data corruption",
        "color": "f7c6c7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 16,
    "closed_at": "2023-12-20T21:55:30Z",
    "created_at": "2023-12-18T14:06:32Z",
    "updated_at": "2023-12-20T21:55:30Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 1861029919,
      "node_id": "IC_kwDOABII585u7RAf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1861029919",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-18T16:48:51Z",
      "updated_at": "2023-12-18T19:42:50Z",
      "author_association": "MEMBER",
      "body": "The specific thing causing this error would be the lines:\r\n\r\n```\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n2023-12-18T13:24:06Z [default wallet] Error reading wallet database: keymeta found with unexpected path\r\n```\r\n\r\nThis means that the stored metadata entries for a 2 keys has derivation paths of an unexpected length (`!= 3`). This error should be benign, although I think it's also erroneous since I'm pretty sure it is possible to import keys with derivation path information that would not match the standard pattern the loading code is checking for. \r\n\r\nEdit: Actually, such imports would not reach this code. Rather the only way that it is possible to get these errors is if that wallet got corrupted.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1861029919",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1862723349,
      "node_id": "IC_kwDOABII585vBucV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862723349",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T13:04:39Z",
      "updated_at": "2023-12-19T13:39:37Z",
      "author_association": "NONE",
      "body": "Ok, thank you very much. This is a dedicated test machine and the error did not occur on production machines.\r\n\r\nI'll try dumping the wallet.dat file and importing the keys into a new wallet.",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1862723349",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "labeled",
      "id": 11289599439,
      "node_id": "LE_lADOABII5855_tNRzwAAAAKg6Z3P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11289599439",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T13:17:32Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "labeled",
      "id": 11289599452,
      "node_id": "LE_lADOABII5855_tNRzwAAAAKg6Z3c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11289599452",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T13:17:32Z",
      "label": {
        "name": "Data corruption",
        "color": "f7c6c7"
      }
    },
    {
      "event": "commented",
      "id": 1862813350,
      "node_id": "IC_kwDOABII585vCEam",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1862813350",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T14:01:26Z",
      "updated_at": "2023-12-19T14:03:42Z",
      "author_association": "NONE",
      "body": "I did `dumpwallet` and the file created looks like this:\r\n\r\n```\r\n# Wallet dump created by Bitcoin Core v26.0.0\r\n# * Created on 2023-12-19T13:47:56Z\r\n# * Best block at time of backup was 821931 (00000000000000000003241b21de4d2d4d3505c2941fba3cccec82f1dbdbce4b),\r\n#   mined on 2023-12-19T13:46:59Z\r\n\r\n# extended private masterkey: xprv***********************************************************************************************************\r\n\r\nL**************************************************n 1970-01-01T00:00:01Z label= # addr=1E*******************************,3H********************************,bc1***************************************\r\nK**************************************************E 1970-01-01T00:00:01Z label= # addr=1K*******************************,31********************************,bc1***************************************\r\nL**************************************************U 1970-01-01T00:00:01Z label= # addr=1U*******************************,35********************************,bc1***************************************\r\nL**************************************************3 1970-01-01T00:00:01Z label= # addr=12********************************,3D********************************,bc1***************************************\r\nL**************************************************7 1970-01-01T00:00:01Z label= # addr=13********************************,3G********************************,bc1***************************************\r\n5*************************************************6 1970-01-01T00:00:01Z label= # addr=13********************************\r\nK*************************************************Rf 1970-01-01T00:00:01Z label= # addr=13********************************,3P********************************,bc1***************************************\r\nL*************************************************YD 1970-01-01T00:00:01Z label= # addr=15********************************,38********************************,bc1***************************************\r\nK*************************************************87 1970-01-01T00:00:01Z label= # addr=16********************************,3M********************************,bc1***************************************\r\nK*************************************************ib 1970-01-01T00:00:01Z label= # addr=17********************************,3Q********************************,bc1***************************************\r\nK*************************************************x5 1970-01-01T00:00:01Z label= # addr=17********************************,37********************************,bc1***************************************\r\n[..]\r\nL*************************************************1y 2019-12-18T14:06:33Z reserve=1 # addr=3A******************************** hdkeypath=m/0'/0'/66'\r\nL*************************************************1k 2019-12-18T14:06:33Z reserve=1 # addr=3C******************************** hdkeypath=m/0'/0'/60'\r\nL*************************************************nz 2019-12-18T14:06:33Z reserve=1 # addr=3J******************************** hdkeypath=m/0'/0'/190'\r\nK*************************************************Lb 2019-12-18T14:06:33Z inactivehdseed=1 # addr=39********************************\r\nK*************************************************pJ 2019-12-18T14:06:33Z reserve=1 # addr=3E******************************** hdkeypath=m/0'/0'/54'\r\nL*************************************************m5 2019-12-18T14:06:33Z label= # addr=3N******************************** hdkeypath=m/0'/0'/5'\r\nL*************************************************jk 2019-12-18T14:06:33Z reserve=1 # addr=3Q******************************** hdkeypath=m/0'/0'/33'\r\nK*************************************************Ty 2019-12-18T14:06:33Z reserve=1 # addr=3N******************************** hdkeypath=m/0'/0'/201'\r\nK*************************************************D1 2019-12-18T14:06:33Z reserve=1 # addr=3K******************************** hdkeypath=m/0'/0'/64'\r\nK*************************************************o5 2019-12-18T14:06:33Z reserve=1 # addr=3A******************************** hdkeypath=m/0'/0'/108'\r\n[..]\r\n```\r\n\r\nThe 6th key looks odd with it being one character short.\r\nOne key with has tag `inactivehdseed=1`.\r\n\r\nMight this be the cause of the error messages?\r\n\r\nThe rest looks good, being `change=1`, `reserve=1` and one being `hdseed=1`",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1862813350",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863129994,
      "node_id": "IC_kwDOABII585vDRuK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863129994",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T16:51:44Z",
      "updated_at": "2023-12-19T16:51:44Z",
      "author_association": "MEMBER",
      "body": "Do you see any `hdkeypath` that doesn't follow the pattern `m/a'/b'/c'`?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863129994",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863241394,
      "node_id": "IC_kwDOABII585vDs6y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863241394",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T17:58:02Z",
      "updated_at": "2023-12-19T18:09:21Z",
      "author_association": "NONE",
      "body": "Oh, now that you told me where to look ... there are indeed two strange looking key paths.\r\n\r\nAll but two are in the format `m/a'/b'/c'`, e.g. `m/0'/1'/289'` or `m/0'/1'/4'`. Most are distinct but eleven key paths are found twice in the dump. And then there are two with a very odd path: `m/0'/1'/299'/0'/1'/300'` and `m/0'/0'/299'/0'/0'/300'`.\r\n\r\nI'm sure our devs never tested with `derivation paths` but it is possible that on that particular machine some keys from bitcoin forks were imported, e.g. BTG, BSV or BCH. I will talk to our devs after the holidays to get some feedback as to where these two keys originated so it's documented here in case someone has the same warnings pop up and ends up here.\r\n\r\nThanks very much, @achow101.",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863241394",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "mentioned",
      "id": 11293189761,
      "node_id": "MEE_lADOABII5855_tNRzwAAAAKhIGaB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11293189761",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T18:09:22Z"
    },
    {
      "event": "subscribed",
      "id": 11293189776,
      "node_id": "SE_lADOABII5855_tNRzwAAAAKhIGaQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11293189776",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T18:09:22Z"
    },
    {
      "event": "commented",
      "id": 1863413296,
      "node_id": "IC_kwDOABII585vEW4w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863413296",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T20:14:20Z",
      "updated_at": "2023-12-19T20:30:38Z",
      "author_association": "MEMBER",
      "body": "> Most are distinct but eleven key paths are found twice in the dump\r\n\r\nSince there is an `inactivehdseed`, that means that the seed has been rotated, probably by encrypting the wallet. So these duplicated paths are expected. One of the keys is derived from the inactive seed, and the other from the current active seed.\r\n\r\n> And then there are two with a very odd path: `m/0'/1'/299'/0'/1'/300'` and `m/0'/0'/299'/0'/0'/300'`.\r\n\r\nThis lines up with the errors in the debug.log.\r\n\r\nThese derivation paths look like the paths for a key got combined with the derivation path for the next key to be derived. I've seen this before, but I think only in PR branches, not after being merged. I suspect that these keys were automatically generated and the weird derivation path is the result of a bug in key metadata upgrading code.\r\n\r\nAre there any keys with any of the derivation paths `m/0'/1'/299'`, `m/0'/1'/300'`, `m/0'/0'/299'`, or `m/0'/0'/300'`?\r\n\r\nIf you are able to, try loading the wallet in 0.17 or earlier and then doing `dumpwallet`. If you lookup these two addresses (with the weird derivation paths) in the dump, what derivation paths do they have?\r\n\r\nIt would also be useful to see the actual keymeta records themselves. You can get a dump of raw data stored in the wallet file by using the `bitcoin-wallet` tool's `dump` command (e.g. `bitcoin-wallet -dumpfile=dump.txt -wallet=mywallet dump`). This will dump all of the records in the database as hex bytes to a text file. Within that file, search for the strings `00000080000000802b01008000000080000000802c010080` and `00000080010000802b01008000000080010000802c010080`. These are the derivation paths as they would be stored in the wallet file. Then you can copy the lines with those strings and paste them here. Those lines will be the entire metadata records for these two keys. These are safe to share as they will only contain the public key, a version number, the time the key was created, the seed's id (hash of the seed), and the derivation path.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863413296",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863432854,
      "node_id": "IC_kwDOABII585vEbqW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863432854",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T20:31:30Z",
      "updated_at": "2023-12-19T20:36:01Z",
      "author_association": "NONE",
      "body": "> Since there is an `inactivehdseed`, that means that the seed has been rotated, probably by encrypting the wallet. So these duplicated paths are expected. One of the keys is derived from the inactive seed, and the other from the current active seed.\r\n\r\nNot encrypted but a `dumpwallet` dump from a different wallet.dat (might be from a fork) was imported with`importwallet` into the already existing `wallet.dat` which most likely made the old hdseed inactive and the imported one active (or vice versa).\r\n\r\n> Are there any keys with any of the derivation paths `m/0'/1'/299'`, `m/0'/1'/300'`, `m/0'/0'/299'`, or `m/0'/0'/300'`?\r\n\r\nOnly these two:\r\n\r\n```\r\nreserve=1 [..] hdkeypath=m/0'/0'/299'\r\nreserve=1 [..] hdkeypath=m/0'/0'/300'\r\n```\r\n\r\n> If you are able to, try loading the wallet in 0.17 or earlier and then doing `dumpwallet`. If you lookup these two addresses (with the weird derivation paths) in the dump, what derivation paths do they have?\r\n\r\nI did as you described and `dumpwallet` with 0.17.0 gives\r\n\r\n* `hdkeypath=m/0'/1'/300'` for the address with `hdkeypath=m/0'/1'/299'/0'/1'/300'` in v26.0\r\n* `hdkeypath=m/0'/0'/300'` for the address with `hdkeypath=m/0'/0'/299'/0'/0'/300'` in v26.0\r\n\r\nBoth addresses/keys were created on `2021-10-28` according to the `dumpwallet` file and are of type `change=1`",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863432854",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863449058,
      "node_id": "IC_kwDOABII585vEfni",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863449058",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T20:46:18Z",
      "updated_at": "2023-12-19T20:46:18Z",
      "author_association": "NONE",
      "body": "`bitcoin-wallet` doesn't create any file:\r\n\r\n```\r\n% bitcoin-wallet -datadir=. -dumpfile=026.dump -wallet=wallet.dat dump\r\nError reading wallet.dat! All keys read correctly, but transaction data or address book entries might be missing or incorrect.\r\n```",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863449058",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863491818,
      "node_id": "IC_kwDOABII585vEqDq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863491818",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T21:23:41Z",
      "updated_at": "2023-12-19T21:48:09Z",
      "author_association": "MEMBER",
      "body": "> `bitcoin-wallet` doesn't create any file:\r\n\r\nOh, that's a bug, Should be simple to fix. In any case, I don't think that dump will be needed since the `dumpwallet` output should be enough to have an idea of what was stored.\r\n\r\n***\r\n\r\nThe `dumpwallet` file has a xprv at the top. Can you try deriving the 4 keys at the derivation paths I mentioned above and see which match the lines with the weird derivation paths? I'm pretty sure the wallet just stored the wrong derivation paths somehow.\r\n\r\n> Both addresses/keys were created on `2021-10-28`\r\n\r\nAny idea what version was running on that date?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863491818",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1863531177,
      "node_id": "IC_kwDOABII585vEzqp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1863531177",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T22:00:04Z",
      "updated_at": "2023-12-19T22:00:04Z",
      "author_association": "NONE",
      "body": "Will try tomorrow using https://github.com/dan-da/hd-wallet-derive",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863531177",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T22:05:19Z",
      "updated_at": "2023-12-19T22:05:19Z",
      "source": {
        "issue": {
          "id": 2049508623,
          "node_id": "PR_kwDOABII585iamOH",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29117",
          "number": 29117,
          "state": "open",
          "state_reason": null,
          "title": "wallettool: Always be able to dump a wallet's database",
          "body": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863449058 reports that a wallet with noncritical errors cannot be dumped with `bitcoin-wallet dump`. This was caused by an erroneous reset of the wallet pointer when the loading the wallet returns something other than `LOAD_OK`. Not all errors are errors that require aborting, so unilaterally resetting the pointer at that time is incorrect. The first commit resolves this issue.\r\n\r\nFurthermore, if a wallet has loading errors, that should not prevent the wallet tool from dumping the wallet. The wallet application logic should not get in the way of performing such a low level database operation, especially when it's primary usage is for debugging potentially corrupted wallets. The 2nd commit is taken from #28710 and changes the `dump` to stop at making a `WalletDatabase` rather than making a `CWallet` only to retrieve the underlying `WalletDatabase`.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29117",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29117",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29117.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29117.patch"
          },
          "created_at": "2023-12-19T22:05:19Z",
          "updated_at": "2023-12-19T23:39:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1864352916,
      "node_id": "IC_kwDOABII585vH8SU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864352916",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T11:58:31Z",
      "updated_at": "2023-12-20T14:56:35Z",
      "author_association": "NONE",
      "body": "# derived keys\r\n\r\nI used https://github.com/dan-da/hd-wallet-derive to derive\r\n\r\n* 301 keys in path `m/0'/0'/0'` to `m/0'/0'/300'`\r\n* 301 keys in path `m/0'/1'/0'` to `m/0'/1'/300'`\r\n\r\nfrom the **xprv** like so:\r\n```\r\nphp hd-wallet-derive.php -g --cols=path,privkey --key=xprv... --path=\"m/0'/0'/x'\" --numderive 301 > xprv-0.txt\r\nphp hd-wallet-derive.php -g --cols=path,privkey --key=xprv... --path=\"m/0'/1'/x'\" --numderive 301 > xprv-1.txt\r\n```\r\n\r\nThen I took all the private keys from the `walletdump` output and grepped for the keys in the 2 `.txt` files and only found 11 matches for the following paths:\r\n\r\n* `m/0'/0'/0'` to `m/0'/0'/5'` in `xprv-0.txt`\r\n* `m/0'/1'/0'` to `m/0'/1'/4'` in `xprv-1.txt`\r\n\r\nThere are 623 keys in the `walletdump` output with a `hdkeypath` info but only 11 can be derived from the `xprv`? That's odd to me.\r\n\r\n# Edit\r\n\r\n>> Both addresses/keys were created on 2021-10-28\r\n\r\n> Any idea what version was running on that date?\r\n\r\n## Timeline according to company communication history\r\n\r\n### 2021-10-28T09:48Z\r\n\r\nWe upgraded from `v0.19.1` to `v22.0` on that dedicated test server.\r\n\r\n### 2021-10-28T11:42Z\r\n\r\n`getwalletinfo`\r\n\r\n```json\r\n{\r\n  \"walletname\": \"\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"bdb\",\r\n  \"balance\": 0.00032451,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 50,\r\n  \"keypoololdest\": 1576677994,\r\n  \"keypoolsize\": 300,\r\n  \"hdseedid\": \"8136................................49b9\",\r\n  \"keypoolsize_hd_internal\": 300,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": false\r\n}\r\n```\r\n\r\n### 2021-10-28T13:33Z\r\n\r\nOne key is generated/imported:\r\n\r\n```\r\nL**************************************************G 2021-10-28T13:33:14Z reserve=1 # addr=3********************************x hdkeypath=m/0'/0'/2'\r\n```\r\n\r\n### 2021-10-28T14:05Z\r\n\r\n15 keys are generated/imported, among them two with the bogus keypath:\r\n\r\n```\r\nK**************************************************G 2021-10-28T14:05:29Z change=1 # addr=32*******************************T hdkeypath=m/0'/0'/302'\r\nK**************************************************7 2021-10-28T14:05:29Z change=1 # addr=3E*******************************7 hdkeypath=m/0'/1'/305'\r\nL**************************************************K 2021-10-28T14:05:29Z change=1 # addr=3A*******************************n hdkeypath=m/0'/0'/305'\r\nL**************************************************i 2021-10-28T14:05:29Z reserve=1 # addr=32*******************************x hdkeypath=m/0'/1'/3'\r\nK**************************************************c 2021-10-28T14:05:29Z change=1 # addr=3D******************************MN hdkeypath=m/0'/0'/301'\r\nL**************************************************3 2021-10-28T14:05:29Z change=1 # addr=3F******************************n7 hdkeypath=m/0'/1'/302'\r\nL**************************************************C 2021-10-28T14:05:29Z change=1 # addr=3Q******************************5F hdkeypath=m/0'/1'/304'\r\nK**************************************************i 2021-10-28T14:05:29Z reserve=1 # addr=38******************************Sg hdkeypath=m/0'/0'/3'\r\nK**************************************************N 2021-10-28T14:05:29Z change=1 # addr=3M******************************HV hdkeypath=m/0'/1'/303'\r\nK**************************************************3 2021-10-28T14:05:29Z change=1 # addr=3D******************************8C hdkeypath=m/0'/0'/304'\r\nK**************************************************t 2021-10-28T14:05:29Z change=1 # addr=38******************************8w hdkeypath=m/0'/1'/299'/0'/1'/300'\r\nK**************************************************t 2021-10-28T14:05:29Z change=1 # addr=3A******************************xU hdkeypath=m/0'/1'/301'\r\nK**************************************************x 2021-10-28T14:05:29Z change=1 # addr=3D******************************fD hdkeypath=m/0'/0'/299'/0'/0'/300'\r\nL**************************************************T 2021-10-28T14:05:29Z reserve=1 # addr=3M******************************du hdkeypath=m/0'/0'/4'\r\nL**************************************************z 2021-10-28T14:05:29Z change=1 # addr=3F******************************yC hdkeypath=m/0'/0'/303'\r\n\r\n```\r\n\r\n# bitcoin-wallet\r\n\r\nI compiled `v26.0` with patch from #29117 and used `bitcoin-wallet` to dump the `wallet.dat` into `bitcoin-wallet.dump`\r\n\r\n```\r\n% grep 00000080000000802b01008000000080000000802c010080 bitcoin-wallet.dump | xxd -r -p | hd\r\n00000000  07 6b 65 79 6d 65 74 61  21 03 5c 24 01 45 a6 43  |.keymeta!.\\$.E.C|\r\n00000010  29 a2 d6 f9 75 38 69 b2  a2 a3 ff 08 bb df 37 7d  |)...u8i.......7}|\r\n00000020  50 4d 36 82 83 c3 fb e9  bd 0b 0c 00 00 00 29 ae  |PM6...........).|\r\n00000030  7a 61 00 00 00 00 0c 6d  2f 30 27 2f 30 27 2f 33  |za.....m/0'/0'/3|\r\n00000040  30 30 27 1a f5 3c d5 83  ec fc ff 41 e8 2b a8 8e  |00'..<.....A.+..|\r\n00000050  4e 85 6e 04 46 b9 58 1b  e3 33 09 06 00 00 00 80  |N.n.F.X..3......|\r\n00000060  00 00 00 80 2b 01 00 80  00 00 00 80 00 00 00 80  |....+...........|\r\n00000070  2c 01 00 80 01                                    |,....|\r\n00000075\r\n```\r\n\r\n```\r\n% grep 00000080010000802b01008000000080010000802c010080 bitcoin-wallet.dump | xxd -r -p | hd\r\n00000000  07 6b 65 79 6d 65 74 61  21 02 21 03 73 d4 c0 a2  |.keymeta!.!.s...|\r\n00000010  2a d0 49 f1 22 85 9a 90  36 8c 86 e5 35 8e 43 bc  |*.I.\"...6...5.C.|\r\n00000020  ea 84 08 60 4c 8c a5 f8  98 50 0c 00 00 00 29 ae  |...`L....P....).|\r\n00000030  7a 61 00 00 00 00 0c 6d  2f 30 27 2f 31 27 2f 33  |za.....m/0'/1'/3|\r\n00000040  30 30 27 1a f5 3c d5 83  ec fc ff 41 e8 2b a8 8e  |00'..<.....A.+..|\r\n00000050  4e 85 6e 04 46 b9 58 1b  e3 33 09 06 00 00 00 80  |N.n.F.X..3......|\r\n00000060  01 00 00 80 2b 01 00 80  00 00 00 80 01 00 00 80  |....+...........|\r\n00000070  2c 01 00 80 01                                    |,....|\r\n00000075\r\n```",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864352916",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "mentioned",
      "id": 11301638636,
      "node_id": "MEE_lADOABII5855_tNRzwAAAAKhoVHs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11301638636",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T11:58:31Z"
    },
    {
      "event": "subscribed",
      "id": 11301638644,
      "node_id": "SE_lADOABII5855_tNRzwAAAAKhoVH0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11301638644",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T11:58:31Z"
    },
    {
      "event": "commented",
      "id": 1864618020,
      "node_id": "IC_kwDOABII585vI9Ak",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864618020",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T14:57:37Z",
      "updated_at": "2023-12-20T14:57:37Z",
      "author_association": "NONE",
      "body": "Let me know if I can help with debugging this any further.",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864618020",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "comment_deleted",
      "id": 11304499339,
      "node_id": "CDE_lADOABII5855_tNRzwAAAAKhzPiL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11304499339",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T15:54:48Z"
    },
    {
      "event": "commented",
      "id": 1864879265,
      "node_id": "IC_kwDOABII585vJ8yh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1864879265",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T17:39:34Z",
      "updated_at": "2023-12-20T17:40:32Z",
      "author_association": "MEMBER",
      "body": "I was able to replicate the bug. I believe this is only an issue with 0.21.x and 22.x as the bug was fixed by #23304 which was first released in 23.0.\r\n\r\nThe issue occurs when inactive key chains are topped up. There was an off-by-one where loading would erroneously find the last index derived rather than the next index to be derived (last index + 1), and so it would end up re-deriving that last index, which I think is what causes the weird derivation path. Specifically, `DeriveNewChildKey` takes a metadata object and overwrites the `hdKeypath` string but appends to `key_origin.path`, so if it gets the same object twice, then it would overwrite `hdKeypath` with the path it just derived, but append that path to `key_origin.path`. This results in the derivation path that looks like it's two derivation paths concatenated, because that's what it is.\r\n\r\nThe exact mechanism is not entirely clear to me though since `DeriveNewChildKey` is always called by `GenerateNewKey` which always provides it with a new metadata object. However, empirically, I can replicate the issue on 22.x, but the same procedure does not have the issue on 23.x.\r\n\r\nIt should be possible for the wallet to detect when this error had occurred previously and be able to fix it automatically. I'll see if I can put together a fix.\r\n\r\n***\r\n\r\n> There are 623 keys in the `walletdump` output with a `hdkeypath` info but only 11 can be derived from the `xprv`? That's odd to me.\r\n\r\nThis is expected as the hd seed has been rotated (most commonly by encrypting the wallet). The one shown at the top will be for the current seed, while the wallet will still store and have metadata for all of the keys generated with the previous seed. We can further see that the keys with the odd derivation paths are generated from a seed whose id does not match the active one, which is consistent with the way that I replicated the issue.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1864879265",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1865108566,
      "node_id": "IC_kwDOABII585vK0xW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865108566",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T20:38:56Z",
      "updated_at": "2023-12-20T20:38:56Z",
      "author_association": "NONE",
      "body": "Thanks for your thorough explanation of this bug!",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1865108566",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T20:47:16Z",
      "updated_at": "2023-12-20T20:47:16Z",
      "source": {
        "issue": {
          "id": 2051245022,
          "node_id": "PR_kwDOABII585igi10",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29124",
          "number": 29124,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Automatically repair corrupted metadata with doubled derivation path",
          "body": "A bug in 0.21.x and 22.x resulted in some wallets storing invalid derivation paths that are the concatenation of two derivation paths. This corruption follows a rigid pattern and can be easily detected and repaired.\r\n\r\nThe bug that resulted in such wallets was fixed in #23304 but wallets that already ran into it would still have bad data stored. This PR should fix such wallets.\r\n\r\nFixes #29109",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29124",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29124.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29124.patch"
          },
          "created_at": "2023-12-20T20:47:16Z",
          "updated_at": "2023-12-20T21:51:56Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1865119581,
      "node_id": "IC_kwDOABII585vK3dd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865119581",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T20:48:40Z",
      "updated_at": "2023-12-20T20:48:40Z",
      "author_association": "MEMBER",
      "body": "#29124 should automatically fix the bad metadata. Can you try running that?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1865119581",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "commented",
      "id": 1865189611,
      "node_id": "IC_kwDOABII585vLIjr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865189611",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T21:50:15Z",
      "updated_at": "2023-12-20T21:55:19Z",
      "author_association": "NONE",
      "body": "Looks good:\r\n\r\n```\r\n2023-12-20T21:34:16Z init message: Loading wallet…\r\n2023-12-20T21:34:16Z BerkeleyEnvironment::Open: LogDir=/home/foobar/.bitcoin/database ErrorFile=/home/foobar/.bitcoin/db.log\r\n2023-12-20T21:34:16Z [default wallet] Wallet file version = 10500, last client version = 220000\r\n2023-12-20T21:34:16Z [default wallet] Repairing derivation path for 0221......850[default wallet] Repairing derivation path for 035c.....d0b[default wallet] Legacy Wallet Keys: 657 plaintext, 0 encrypted, 657 w/ metadata, 657 total.\r\n```\r\n\r\nNo warning/error regarding keymeta. The `WalletLogPrintf` call should end with `\\n`, though.\r\n\r\nDid a diff between v26.0.0 RPC `dumpwallet` and your version.\r\n\r\n```diff\r\n [..]\r\n-[..] hdkeypath=m/0'/1'/299'/0'/1'/300'\r\n+[..] hdkeypath=m/0'/1'/300'\r\n [..]\r\n-[..] hdkeypath=m/0'/0'/299'/0'/0'/300'\r\n+[..] hdkeypath=m/0'/0'/300'\r\n [..]\r\n```\r\n\r\nLooks fixed for me.\r\n\r\nThe label 'data corruption' should be removed from the issue, shouldn't it?",
      "user": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1865189611",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29109"
    },
    {
      "event": "closed",
      "id": 11307852072,
      "node_id": "CE_lADOABII5855_tNRzwAAAAKiACEo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11307852072",
      "actor": {
        "login": "c0deright",
        "id": 20477825,
        "node_id": "MDQ6VXNlcjIwNDc3ODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/20477825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/c0deright",
        "html_url": "https://github.com/c0deright",
        "followers_url": "https://api.github.com/users/c0deright/followers",
        "following_url": "https://api.github.com/users/c0deright/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/c0deright/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/c0deright/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/c0deright/subscriptions",
        "organizations_url": "https://api.github.com/users/c0deright/orgs",
        "repos_url": "https://api.github.com/users/c0deright/repos",
        "events_url": "https://api.github.com/users/c0deright/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/c0deright/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T21:55:30Z"
    }
  ]
}
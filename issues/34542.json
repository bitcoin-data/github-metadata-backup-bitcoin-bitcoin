{
  "type": "issue",
  "issue": {
    "id": 3918326723,
    "node_id": "I_kwDOABII587pjOvD",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34542",
    "number": 34542,
    "state": "open",
    "state_reason": null,
    "title": "RFC: Erlay Conceptual Discussion",
    "body": "As suggested during the IRC meeting last week ([logs](https://www.erisian.com.au/bitcoin-core-dev/log-2026-02-05.html#l-251)), this issue is for discussing recent progress on [Erlay](https://github.com/bitcoin/bips/blob/master/bip-0330.mediawiki), evaluating its trade-offs and goals, and ultimately deciding whether it's worth continuing to pursue.\n\nThe current project tracking issue is https://github.com/bitcoin/bitcoin/issues/30249, though some of the performance research results shown there may be outdated. We can gather updated data here and discuss.\n\nCouple questions on my mind:\n\n- What does the bandwidth/latency trade-off look like as we scale the number of connections?\n- Do the benefits outweigh the added code complexity?\n\nOf course, discussion isn't limited to the above. Feel free to bring up any other points that come to mind.",
    "user": {
      "login": "marcofleon",
      "id": 95179662,
      "node_id": "U_kgDOBaxTjg",
      "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcofleon",
      "html_url": "https://github.com/marcofleon",
      "followers_url": "https://api.github.com/users/marcofleon/followers",
      "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
      "organizations_url": "https://api.github.com/users/marcofleon/orgs",
      "repos_url": "https://api.github.com/users/marcofleon/repos",
      "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/marcofleon/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 4,
    "created_at": "2026-02-09T21:53:28Z",
    "updated_at": "2026-02-11T14:23:04Z"
  },
  "events": [
    {
      "event": "comment_deleted",
      "id": 22658133197,
      "node_id": "CDE_lADOABII587pjOvDzwAAAAVGh6zN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22658133197",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-09T23:59:22Z"
    },
    {
      "event": "subscribed",
      "id": 22670635240,
      "node_id": "SE_lADOABII587pjOvDzwAAAAVHRnDo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22670635240",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T11:02:49Z"
    },
    {
      "event": "labeled",
      "id": 22671865038,
      "node_id": "LE_lADOABII587pjOvDzwAAAAVHWTTO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22671865038",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T11:55:33Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    },
    {
      "event": "subscribed",
      "id": 22678029726,
      "node_id": "SE_lADOABII587pjOvDzwAAAAVHt0We",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22678029726",
      "actor": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T15:33:46Z"
    },
    {
      "event": "subscribed",
      "id": 22688307830,
      "node_id": "SE_lADOABII587pjOvDzwAAAAVIVBp2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22688307830",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T22:30:12Z"
    },
    {
      "event": "subscribed",
      "id": 22698562232,
      "node_id": "SE_lADOABII587pjOvDzwAAAAVI8JK4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22698562232",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T09:47:48Z"
    },
    {
      "event": "commented",
      "id": 3884345863,
      "node_id": "IC_kwDOABII587nhmoH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3884345863",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T13:09:29Z",
      "updated_at": "2026-02-11T13:24:37Z",
      "author_association": "MEMBER",
      "body": "Thanks for opening this @marcofleon.\n\nI'd like to give a refresher and overview of Erlay, and explain some of the details of the experimentation and current approach. I also have a few questions/points that I'd like to discuss with people in the project.\n\n## Overview\n\nErlay is an alternative method of announcing transactions between peers in the Bitcoin P2P network. Erlay’s main goal is to reduce bandwidth utilization when propagating transaction data by minimizing the amount of redundant inventory messages (`INV`) exchanged between peers.\n\nIn our current transaction relaying approach (we'll be calling _txflood_ or _fanout_ from now on), every transaction is announced on every transaction relaying link in the peer-to-peer network at least once. That is, for each transaction relaying connection in the network, each side of the connection will either send or receive an `INV` message containing the given transaction. Most of these announcements (`n-1/n`) are actually redundant, but it is impossible for the announcer to know until the announcement has been sent.\n\nErlay tries to solve this issue by using set reconciliation to work out the transaction differences between two nodes connected to each other instead of just announcing all transactions through all links. To do so, nodes keep a set of transactions to be reconciled (or reconciliation set) between each of their Erlay-enabled peers, and reconciliation is performed at regular intervals. Once it is time to reconcile, peers exchange _sketches_ of their reconciliation sets, which can be used to optimally compute the symmetrical difference between their reconciliation sets and, therefore, identify which transactions need to be sent by each end of the connection.\n\nErlay works optimally (sketches are smaller and sketch differences are cheaper to compute) when the differences between sets are small. This means that, even if all peers of a given node are Erlay-enabled, some transactions will still be exchanged using fanout. Finally, as we will expand on later on, fanout is more efficient and considerably faster than set reconciliation provided the receiving node does not know about the transaction being announced.\n\n## Fanout: The current approach\n\nBefore jumping into Erlay, its important to understand how fanout works in Core, so we can reason about the proposed changes and tradeoffs. \n\nTransactions are exchanged between network peers using a 3-step protocol (`INV/GETDATA/TX`). The first round-trip of this protocol (`INV/GETDATA`) can be seen as the announcement/request phase, here is where both sides of the connection are made aware of what the other side knows. The last half-round trip (`TX`) is where the actual transaction is exchanged, if necessary. Given transactions are significantly bigger than transaction ids, the `INV/GETDATA` part of the protocol is used to minimize the amount of potentially redundant information exchanged between peers. If I don't know if you know something, I'd better make sure first before dumping a lot of data on you. Hence, if the announcement receiver knows about the target transaction, we waste a minimal amount of bandwidth, and if not, we add a minimal amount of overhead to sending the transaction.\n\nTransactions are announced between peers at random intervals following a Poisson process. The expected delay between announcements depends on the type of connection: outbounds have an independent clock per connection with an expected value of **2 seconds**, whereas inbounds share a timer with an expected value of **5 seconds**. Transactions are queued to be announced until the timer goes off, and then announced using as many inventory messages as needed to clear the queue (each INV message can hold up to 50.000 entries IIRC). These timers are in place to obfuscate when a node learns about a transaction, in order to make it harder for a global network observer to pinpoint the transaction origin.\n\nWhen a node learns about a new transaction via an inventory message, it may request it back from the announcer. Announcements are requested back in order of arrival, prioritizing outbound peers. If a peer takes too long to respond to a request, we may ask the next peer and so on. Inbound peers are de-prioritized here, by giving them a **2-second** delay before requesting. This is to prevent them from stalling us (e.g., sending multiple announcements of the same transaction from different connections to delay us from learning the announced transaction).\n\nLast but not least, when a transaction is being purposely delayed (in the `to_be_announced` queue), a node will pretend not to know about it, so it won’t reply to `GETDATA` messages requesting it. This is to prevent probing.\n\n**Pros: fast (artificially slower for privacy/DoS protection purposes)**\n\n**Cons: each transaction is announced at least once per link (too redundant)**\n\n## Erlay: The second take\n\nErlay is not a drop-in replacement for fanout, but a protocol that works alongside it. This is obvious for backwards compatibility reasons: nodes are not forced to implement or adopt the change, but it’s not the only reason why. Set reconciliation is really good at fixing small differences between sets (both fast and efficient), but it becomes way less optimal when the differences in the sets to reconcile are big: sketches become big (they grow with the size of the diffs they can compute), and the diffs are expensive to compute. This is why set reconciliation works best alongside fanout, and why our approach to implement Erlay is as a hybrid between both.\n\nOnce this becomes clear, the main question to answer when implementing Erlay is: **how we partition peers between fanout and reconciliation, and how big is the split?** This is the question that has led most of the experimentation in the project and that most of the simulations have tried to answer. To answer this question, we need to understand the properties of each group:\n\n- Fanout peers are good at propagating the transaction fast, but too much use of them leads to redundant announcements\n- Reconciliation peers are good at fixing small differences between peers, but they are, **inherently, slower at propagating transactions.**\n\nThe reason why reconciliation is slower lies in how transaction announcement is implemented in Core. When a transaction is propagated using set reconciliation, we need to go over an additional 1.5 round-trips (`REQRECON/SKETCH/RECONDIFF`) to learn if the target peer knows about a certain transaction **AND THEN,** if it doesn’t, default to `INV/GETDATA/TX` to send it. Therefore, 3 round-trips in total. This may seem a bit counter intuitive, why can we not just send the transaction straightaway once we learn the peer doesn’t have it? Because another peer could have announced the transaction before us, and the target peer may already have selected them for download. \n\nIn order to answer this question, I built a discrete-time network event simulator for Bitcoin (you can find it [here](https://github.com/sr-gi/hyperion)) so I could quickly iterate over different configurations in significantly big networks. \n\n### Experimentation and findings\n\nThe initial approach was to simply answer the following question: how small can we keep fanout so that network latency remains similar while maximizing the bandwidth savings of set reconciliation? This proved tricky right out of the bat: set reconciliation is much slower than I originally imagined, and deciding what’s acceptable in terms of latency is hard to assess. As a matter of example, here are some simulation results with no optimizations:\n\n**Network:** 110K nodes (100K unreachable, 10K reachable), random topology, 8 outbounds.\n\n| No optimizations  | Full recon | Erlay 1 (out), 10%(ins) | Full fanout |\n| ------------- | ------------- | ------------- | ------------- |\n| T-90%  | 25.07007s  | 20.413506s | 8.676374s | \n| T-100%  |32.31443s  | 27.577503s | 14.88974s | \ndata-volume (reachable) | 1038.9468 messages (4589.844 bytes)  | 846.8382 messages (4876.821 bytes) | 119.51961 messages (6120.7563 bytes) | \ndata-volume (unreachable) | 87.36723 messages (405.09848 bytes) | 71.30196 messages (429.1808 bytes) | 10.086697 messages (524.5129 bytes)  | \n\nThis shows the difference between doing full reconciliation (no fanout involved), doing minimal reconciliation (using similar parameters defined as “best” in the previous [Erlay attempt](https://github.com/naumenkogs/txrelaysim/issues/7#issuecomment-902165806), and full fanout (the current state of things). It becomes pretty clear that the impact on latency is more than significant when no optimizations are being applied, but it also raises the question: **What is acceptable in terms of latency and at what cost?**\n\nOne of the first attempts to reduce latency while maximizing our bandwidth savings was to reduce the previously mentioned expected values for the peer-announcement Poisson process sampling. Halving those artificially reduces latency with almost no effect on bandwidth (if any). This was the approach in the original [Erlay implementation](https://github.com/naumenkogs/bitcoin/blob/89de0f71dce11e29c4c115a3021e97da62ba3ce6/src/net_processing.cpp#L155-L162), but I never felt too comfortable with it. **There is little documentation (if any) of why the broadcast intervals were picked as {5s, 2s}, and if that’s the route we want to take, I think it comes from a well-reasoned discussion.**\n\n### Fine-tuning the approach\n\nThere have been several experiments and theories being tested to try to optimize the aforementioned approach to make it more latency-efficient while preserving the bandwidth savings. For an extended and more detailed explanation of some of these, I’d recommend checking the series I wrote on [Delving](https://delvingbitcoin.org/tag/erlay). Here, I’ll be highlighting the two optimizations that have shown to work in simulation.\n\n### Reconcile on trickle\n\nOne of the main reasons why Erlay is slow has to do with when data is made available to our peers. As we’ve mentioned earlier, this happens when we trickle for them (their timer has gone off, so we will try to send them whatever we have available). However, adding reconciliation on top of this means that now both need to synchronize; otherwise, if data is being purposely delayed for a peer when they request reconciliation, they will have to wait until the next reconciliation cycle to get it (FYI, this is once every 8 seconds per outbound peer at the moment). \n\nA solution for this problem is not to reply to reconciliation requests straightaway. Instead, the request can be recorded, and replied to when we trickle for that peer, ensuring that they get all transactions we have received up to that point. Here are the simulation results using the same network as before, but applying this optimization:\n\n| Recon on trickle  | Full recon | Erlay 1 (out), 10%(ins) | Full fanout |\n| ------------- | ------------- | ------------- | ------------- |\n| T-90%  | 22.339193s  | 16.797455s | 8.654676s | \n| T-100%  | 29.805967s | 23.903776s | 14.878592s | \ndata-volume (reachable) | 713.03534 messages (4071.1865 bytes)  | 562.6937 messages (4548.8276 bytes)  | 119.527855 messages (6121.74 bytes) | \ndata-volume (unreachable) |  59.583134 messages (350.2714 bytes) | 47.12237 messages (395.96457 bytes)  | 10.085797 messages (524.41187 bytes) | \n\n### INV-based fanout\n\nThe second optimization worth mentioning has to do with how we pick nodes for fanout and reconciliation. So far, nodes have been picked as a static split. We select some for reconciliation and some for fanout, making the latter big enough so a big chunk of the network can be reached fast, but not big enough so it starts being redundant, and leave the rest to reconciliation. The specific numbers here come from simulating different partitions and seeing what seems to perform better in random networks.\n\nHowever, we can do better than this. In an ideal world, if we knew how long the transaction has been propagating and what fraction of the network it has reached, we could use that to turn our fanout/reconciliation up or down. Unfortunately, we don’t have that information, but we know one thing: fanout is faster than reconciliation, therefore if we receive a transaction via fanout, we are likely to be amongst the first peers to receive it, whereas if we receive it via reconciliation, it is likely that we are further down the line.\n\nWe can use this to tweak our fanout rates:\n\n- When receiving a transaction via fanout, keep fanning out until we reach a certain threshold, and reconcile with the rest of your peers\n- If a transaction is received via reconciliation, see it as being late and keep reconciling with the rest of your peers\n\nThis approach applies to outbound connections only, given that anything learnt from an inbound connection is easy to fake, so it’s better not to be trusted. Applying this optimization on top of the previous one, and simulating for the same network, we obtain:\n\n| on-trickle + inv-based-fanout  | Full recon | Erlay 1 (out), 10%(ins) | Full fanout |\n| ------------- | ------------- | ------------- | ------------- |\n| T-90%  | 21.70218s | 14.427859s | 8.654676s | \n| T-100%  | 28.977697s  | 21.619083s | 14.878592s | \ndata-volume (reachable) | 695.2272 messages (4085.9502 bytes)   | 493.16547 messages (4593.411 bytes) | 119.527855 messages (6121.74 bytes) | \ndata-volume (unreachable) | 58.117065 messages (349.74905 bytes) | 41.418915 messages (401.29572 bytes) | 10.085797 messages (524.41187 bytes) | \n\n### Conclusions and questions\n\nWith the two presented optimizations, we are able to achieve savings of ~25% in bandwidth for the cost of ~ 67% more latency. Some of these combinations have also been tested on smaller networks with actual Bitcoin nodes implementing Erlay (using Warnet) and the obtained results have been similar. However, things are far harder (and more expensive) to test like that. \n\nI personally think the design space for improvements and optimizations may still be substantial. However, I also think I’d be good to define what is acceptable in terms of bandwidth and latency tradeoffs, and what things are open to change:\n\n- Are the expected values for the poisson processes set to stone? Is it OK to reduce them? How can we reason about the implications?\n- What are acceptable transaction propagation times? Are we OK with increasing them at all? If so, by how much?\n- What would be acceptable bandwidth savings given the additional complexity brought by this change?\n\nI’ve tried to give as much context and information as possible while keeping this digestible. I’m happy to extend on any of the directions others are curious about, explain things that may have fallen of and provide additional data.",
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34542#issuecomment-3884345863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542"
    },
    {
      "event": "mentioned",
      "id": 22703404009,
      "node_id": "MEE_lADOABII587pjOvDzwAAAAVJOnPp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22703404009",
      "actor": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T13:09:30Z"
    },
    {
      "event": "subscribed",
      "id": 22703404036,
      "node_id": "SE_lADOABII587pjOvDzwAAAAVJOnQE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22703404036",
      "actor": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T13:09:30Z"
    },
    {
      "event": "commented",
      "id": 3884356816,
      "node_id": "IC_kwDOABII587nhpTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3884356816",
      "actor": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T13:11:32Z",
      "updated_at": "2026-02-11T13:11:32Z",
      "author_association": "MEMBER",
      "body": "> Couple questions on my mind:\n> \n> * What does the bandwidth/latency trade-off look like as we scale the number of connections?\n\nI'm going to reserve this spot to extend on the tradeoffs when the number of connections is increased, since I did not touch that on the original post, but it's one of the main goals of the project (the write-up was already pretty lengthy). I may need to re-run some of the simulations for it.",
      "user": {
        "login": "sr-gi",
        "id": 6665628,
        "node_id": "MDQ6VXNlcjY2NjU2Mjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6665628?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sr-gi",
        "html_url": "https://github.com/sr-gi",
        "followers_url": "https://api.github.com/users/sr-gi/followers",
        "following_url": "https://api.github.com/users/sr-gi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sr-gi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sr-gi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sr-gi/subscriptions",
        "organizations_url": "https://api.github.com/users/sr-gi/orgs",
        "repos_url": "https://api.github.com/users/sr-gi/repos",
        "events_url": "https://api.github.com/users/sr-gi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sr-gi/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34542#issuecomment-3884356816",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542"
    },
    {
      "event": "commented",
      "id": 3884592388,
      "node_id": "IC_kwDOABII587nii0E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3884592388",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T13:55:29Z",
      "updated_at": "2026-02-11T13:55:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Erlay’s main goal is to reduce bandwidth utilization when propagating transaction data by minimizing the amount of redundant inventory messages (`INV`) exchanged between peers.\n\nI'm not excited about this amount of research and code complexity for having bandwidth reduction as a goal. Bandwidth reduction by itself is nice, and obviously it is something we should improve where possible, but I don't see the current bandwidth consumption as problematic for users who wish to run without `blocksonly`? Is it possible that, with this project going on for so long and with a couple of reboots, we kinda lost track of why we were doing this in the first place?\n\nIt's been a while since I initially read the Erlay paper, but IIRC the reason I found this interesting at the time was that Erlay allows having more connections with acceptable bandwidth trade-offs, improving eclipse attack resistance. Even if it seems we currently already have reasonable eclipse attack resistance, this security benefit to me seems like much more worthy goal of investigating and - if Erlay turns out to be a worthwhile improvement - pursuing? I've not been following this project closely, so apologies if this has been covered already, I'm just not seeing it mentioned in the [current write-up](https://github.com/bitcoin/bitcoin/issues/34542#issuecomment-3884345863).",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34542#issuecomment-3884592388",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542"
    },
    {
      "event": "commented",
      "id": 3884755099,
      "node_id": "IC_kwDOABII587njKib",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3884755099",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T14:23:04Z",
      "updated_at": "2026-02-11T14:23:04Z",
      "author_association": "MEMBER",
      "body": "To add to Stephan's comment: simpler proposals seem to achieve (for the most part at least) the same goal of increased network security: https://github.com/bitcoin/bitcoin/pull/28463, https://github.com/bitcoin/bitcoin/issues/28462 and it's not clear to me that the additional benefits that erlay offers over these (increased full-outbound relay connections instead of block-relay-only & bandwidth reduction) are worth the complexity (minisketch, reconciliation module, extra protocol messages).",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34542#issuecomment-3884755099",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34542"
    }
  ]
}
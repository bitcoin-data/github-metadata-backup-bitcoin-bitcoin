{
  "type": "issue",
  "issue": {
    "id": 3723031325,
    "node_id": "I_kwDOABII587d6PMd",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34056",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34056/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34056/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34056/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/34056",
    "number": 34056,
    "state": "closed",
    "state_reason": "completed",
    "title": "Wallet RPC semantics: gettransaction.confirmations returns large negative values for RBF-replaced transactions (undocumented behavior)",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nWhen using Replace-By-Fee (RBF) in combination with wallet rescans, the wallet RPC reports transactions with negative confirmation counts (e.g. -900, -1200), long after the replacing transaction has been confirmed.\n\nThese negative confirmation values persist even when:\n- the replacement transaction is deeply confirmed\n- the original transaction is fully conflicted and no longer in the mempool\n- wallet balances and UTXO sets are otherwise correct\n\nThe negative value appears to encode “distance since replacement” rather than an actual confirmation count.\n\n\n### Expected behaviour\n\nOnce a transaction has been replaced via RBF and the replacement transaction is confirmed, the original transaction should report a stable and documented state.\n\nSpecifically:\n- `confirmations` should not become increasingly negative over time\n- confirmation values should have a clear and documented semantic meaning\n- wallet RPC consumers should not need to infer hidden meanings from confirmation numbers\n\n\n### Steps to reproduce\n\n1. Create a wallet on regtest\n2. Send a transaction with BIP125 replaceable flag enabled\n3. Trigger a wallet rescan\n4. Perform a bumpfee (RBF replacement)\n5. Mine blocks to deeply confirm the replacement transaction\n6. Query `gettransaction` for the original transaction\n\nObservation:\nThe original transaction reports large negative confirmation counts (e.g. -900, -1200), even though the replacement transaction is confirmed.\n\n\n- regtest mode\n- default wallet settings\n- descriptor wallet\n- RBF enabled\n- wallet rescan invoked via RPC\n\n\n### Relevant log output\n\nSee attached JSON excerpts showing:\n- negative confirmation values\n- walletconflicts\n- replaced_by_txid relationships\n\nThe following excerpts show a replaced RBF transaction reporting large negative\nconfirmation counts long after its replacement has been deeply confirmed.\nThere is no chain reorg and wallet balances are correct.\n\nThe negative confirmation value continues to decrease as new blocks are mined,\neven though the replacing transaction is already confirmed.\n\nThis raises a question about RPC semantics: is `confirmations` for replaced\ntransactions intended to represent a negative distance to the replacing\ntransaction’s confirmation height, and if so, where is this behavior documented?\n\n\n[gettransaction.json](https://github.com/user-attachments/files/24125876/gettransaction.json)\n[gettransaction-replace.txt](https://github.com/user-attachments/files/24125875/gettransaction-replace.txt)\n[getbalance.txt](https://github.com/user-attachments/files/24125874/getbalance.txt)\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv27.0\n\n### Operating system and version\n\nUbuntu 22.04 LTS\n\n### Machine specifications\n\nx86_64 system, local regtest environment, SSD storage\n",
    "user": {
      "login": "husstege-e",
      "id": 247751831,
      "node_id": "U_kgDODsRklw",
      "avatar_url": "https://avatars.githubusercontent.com/u/247751831?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/husstege-e",
      "html_url": "https://github.com/husstege-e",
      "followers_url": "https://api.github.com/users/husstege-e/followers",
      "following_url": "https://api.github.com/users/husstege-e/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/husstege-e/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/husstege-e/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/husstege-e/subscriptions",
      "organizations_url": "https://api.github.com/users/husstege-e/orgs",
      "repos_url": "https://api.github.com/users/husstege-e/repos",
      "events_url": "https://api.github.com/users/husstege-e/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/husstege-e/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "labels": [
      {
        "id": 148216,
        "node_id": "MDU6TGFiZWwxNDgyMTY=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Docs",
        "name": "Docs",
        "color": "02d7e1",
        "default": false
      },
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      },
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      },
      {
        "id": 477890092,
        "node_id": "MDU6TGFiZWw0Nzc4OTAwOTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help",
        "name": "Questions and Help",
        "color": "006688",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "closed_at": "2025-12-12T11:54:46Z",
    "closed_by": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "created_at": "2025-12-12T11:12:57Z",
    "updated_at": "2025-12-12T11:54:56Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 3646182093,
      "node_id": "IC_kwDOABII587ZVFLN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3646182093",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:46Z",
      "updated_at": "2025-12-12T11:54:46Z",
      "author_association": "MEMBER",
      "body": "> undocumented\n\nTo get the documentation, you can use the `help` RPC. It will explain and document the output. E.g.\n\n```\n  \"confirmations\" : n,              (numeric) The number of confirmations for the transaction. Negative confirmations means the\n                                    transaction conflicted that many blocks ago.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/34056#issuecomment-3646182093",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34056"
    },
    {
      "event": "closed",
      "id": 21526420212,
      "node_id": "CE_lADOABII587d6PMdzwAAAAUDExr0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526420212",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:46Z"
    },
    {
      "event": "labeled",
      "id": 21526423002,
      "node_id": "LE_lADOABII587d6PMdzwAAAAUDEyXa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526423002",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:55Z",
      "label": {
        "name": "Docs",
        "color": "02d7e1"
      }
    },
    {
      "event": "labeled",
      "id": 21526423015,
      "node_id": "LE_lADOABII587d6PMdzwAAAAUDEyXn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526423015",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:56Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "labeled",
      "id": 21526423027,
      "node_id": "LE_lADOABII587d6PMdzwAAAAUDEyXz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526423027",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:56Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "labeled",
      "id": 21526423035,
      "node_id": "LE_lADOABII587d6PMdzwAAAAUDEyX7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526423035",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:54:56Z",
      "label": {
        "name": "Questions and Help",
        "color": "006688"
      }
    }
  ]
}
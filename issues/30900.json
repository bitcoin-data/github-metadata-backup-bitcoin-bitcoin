{
  "type": "issue",
  "issue": {
    "id": 2525340354,
    "node_id": "I_kwDOABII586WhaLC",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30900",
    "number": 30900,
    "state": "open",
    "state_reason": null,
    "title": "Use IPv4-encoded IPv6 address to get IPv4 node address with port number from DNS seeds",
    "body": "### Please describe the feature you'd like to see added.\r\n\r\nUse the IPv4-encoded IPv6 addresses that start with a reserved prefix to support nodes with non-default ports in bootstrapping process.\r\n\r\nThere are 7k IPv4 reachable nodes and some of them use non-default ports:\r\n\r\n![image](https://github.com/user-attachments/assets/1135ce50-0c43-4da6-af37-4c2ee2bfe5bc)\r\n\r\nExample: Port 39388 is used by more than [1000 nodes](https://bitnodes.io/nodes/all/ports/)\r\n\r\nThe scripts used in this testing guide can be helpful to discover more nodes with non-default ports: https://web.archive.org/web/20230129111013/https://github.com/bitcoin-core/bitcoin-devwiki/wiki/23.0-Release-Candidate-Testing-Guide\r\n\r\n\r\n### Is your feature related to a problem, if so please describe it.\r\n\r\nNon-default ports are supported in automatic connections since v23.0: https://github.com/bitcoin/bitcoin/pull/23542. However, DNS seeds cannot return port numbers in DNS queries. So, the nodes with non-default port will never be a part of bootstrapping.\r\n\r\nRelated discussion:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/23542#issuecomment-1036384792\r\n\r\nhttps://delvingbitcoin.org/t/hardcoded-seeds-dns-seeds-and-darknet-nodes/1123/8\r\n\r\nhttps://njump.me/nevent1qqst405e4jwg9fwufrqrmjczxdc6desc8xsqlhzsvk7w5wk3lrlmqlczyq9288j6a7v6qq98hkctfxg43jftcj4zp7m9jvd995z4kh4kmlmns9h6j6q\r\n\r\n### Describe the solution you'd like\r\n\r\nIPv4 address and port number can be encoded in an IPv6 address by DNS seeds. IPv6 address format:\r\n\r\n```\r\n| 80 bits                          | 32 bits         | 16 bits |\r\n|----------------------------------|-----------------|---------|\r\n| 0000 0000 0000 0000 abcd (prefix)| IPv4 Address    | Port    |\r\n```\r\n\r\nPython script to encode and decode: https://gitlab.com/-/snippets/3746764\r\n\r\n```\r\n1. Encode\r\n2. Decode\r\n3. Exit\r\nEnter your choice: 1\r\nEnter IPv4 address: 127.0.0.1\r\nEnter port number: 8080\r\nEncoded IPv6: 0000:0000:0000:0000:abcd:7f00:0001:1f90\r\n1. Encode\r\n2. Decode\r\n3. Exit\r\nEnter your choice: 2\r\nEnter the encoded IPv6 address: ::abcd:7f00:1:1f90\r\nDecoded Data (IPv4, Port): 127.0.0.1, 8080\r\n```\r\n\r\nI am using clouflare for DNS and tested this on a domain: \r\n\r\n![image](https://github.com/user-attachments/assets/372c0359-8b1d-4935-a456-65524038b19c)\r\n\r\nIPv6 addresses are valid, AAAA for domain is resolved successfully by `getaddrinfo` and Google DNS: https://dns.google/resolve?name=test.joinstr.xyz&type=AAAA&cd=true \r\n\r\n### Describe any alternatives you've considered\r\n\r\n- IPv4 mapped IPv6 addresses are supported based on RFC 4291 and I tested it on Cloudflare. However, you cannot add anything more than IPv4 address.\r\n\r\n  https://datatracker.ietf.org/doc/html/rfc4291#section-2.5.5.2\r\n\r\n- NULL and TXT records\r\n\r\n  Related issues:\r\n  \r\n  https://delvingbitcoin.org/t/hardcoded-seeds-dns-seeds-and-darknet-nodes/1123/6\r\n  \r\n  https://njump.me/nevent1qqsp9v4jxynf8k93erdl2ku3nh92ng7fwr695lvwmh0tek8k2r6fvscpp4mhxue69uhkummn9ekx7mqpz3mhxue69uhhyetvv9ujuerpd46hxtnfdupzqz4rnedwlxdqqznmmv95ny2cey4uf23qldjexxjj6p2mt6mdlaeceaxu3t\r\n",
    "user": {
      "login": "1440000bytes",
      "id": 147166694,
      "node_id": "U_kgDOCMWV5g",
      "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/1440000bytes",
      "html_url": "https://github.com/1440000bytes",
      "followers_url": "https://api.github.com/users/1440000bytes/followers",
      "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
      "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
      "repos_url": "https://api.github.com/users/1440000bytes/repos",
      "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "created_at": "2024-09-13T17:35:09Z",
    "updated_at": "2024-09-16T21:29:31Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 14252182106,
      "node_id": "LE_lADOABII586WhaLCzwAAAANRfwpa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14252182106",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-13T17:35:09Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 2354009797,
      "node_id": "IC_kwDOABII586MT1bF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2354009797",
      "actor": {
        "login": "petertodd",
        "id": 7042,
        "node_id": "MDQ6VXNlcjcwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/petertodd",
        "html_url": "https://github.com/petertodd",
        "followers_url": "https://api.github.com/users/petertodd/followers",
        "following_url": "https://api.github.com/users/petertodd/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/petertodd/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/petertodd/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
        "organizations_url": "https://api.github.com/users/petertodd/orgs",
        "repos_url": "https://api.github.com/users/petertodd/repos",
        "events_url": "https://api.github.com/users/petertodd/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/petertodd/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:52:16Z",
      "updated_at": "2024-09-16T20:52:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "NACK\r\n\r\nThe purpose of the DNS seeds is just to find some bootstrap nodes. More addresses are then learned from those bootstrap nodes, and additional connections are made to them. There's no need for the initial bootstrap nodes to be sampled from the entire set of possible nodes.",
      "user": {
        "login": "petertodd",
        "id": 7042,
        "node_id": "MDQ6VXNlcjcwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/petertodd",
        "html_url": "https://github.com/petertodd",
        "followers_url": "https://api.github.com/users/petertodd/followers",
        "following_url": "https://api.github.com/users/petertodd/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/petertodd/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/petertodd/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
        "organizations_url": "https://api.github.com/users/petertodd/orgs",
        "repos_url": "https://api.github.com/users/petertodd/repos",
        "events_url": "https://api.github.com/users/petertodd/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/petertodd/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30900#issuecomment-2354009797",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900"
    },
    {
      "event": "commented",
      "id": 2354062985,
      "node_id": "IC_kwDOABII586MUCaJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2354062985",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T21:29:30Z",
      "updated_at": "2024-09-16T21:29:30Z",
      "author_association": "NONE",
      "body": "> The purpose of the DNS seeds is just to find some bootstrap nodes.\r\n> There's no need for the initial bootstrap nodes to be sampled from the entire set of possible nodes.\r\n\r\nI disagree. @cdecker's DNS seed was recently [removed](https://github.com/bitcoin/bitcoin/pull/30720) from bitcoin core because it did not return enough nodes for bootstrapping. It was [noticed](https://github.com/bitcoin/bitcoin/pull/29145#pullrequestreview-1797445282) that @luke-jr's DNS seed returned only nodes with older version and now it only returns [newer versions](https://21.ninja/dns-seeds/node-version-range/). \r\n\r\nSuch results violate 1 and 2 mentioned in [DNS seed policy](https://github.com/bitcoin/bitcoin/blob/master/doc/dnsseed-policy.md) and even if the policy is useless, they do affect the bootstrapping process used for a decentralized network.\r\n\r\nIf most nodes start using non-default ports for various reasons, including government censorship, DNS seeds may become irrelevant.",
      "user": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30900#issuecomment-2354062985",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30900"
    },
    {
      "event": "mentioned",
      "id": 14281378528,
      "node_id": "MEE_lADOABII586WhaLCzwAAAANTPIrg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281378528",
      "actor": {
        "login": "cdecker",
        "id": 120117,
        "node_id": "MDQ6VXNlcjEyMDExNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/120117?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cdecker",
        "html_url": "https://github.com/cdecker",
        "followers_url": "https://api.github.com/users/cdecker/followers",
        "following_url": "https://api.github.com/users/cdecker/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/cdecker/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/cdecker/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/cdecker/subscriptions",
        "organizations_url": "https://api.github.com/users/cdecker/orgs",
        "repos_url": "https://api.github.com/users/cdecker/repos",
        "events_url": "https://api.github.com/users/cdecker/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/cdecker/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T21:29:31Z"
    },
    {
      "event": "subscribed",
      "id": 14281378538,
      "node_id": "SE_lADOABII586WhaLCzwAAAANTPIrq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281378538",
      "actor": {
        "login": "cdecker",
        "id": 120117,
        "node_id": "MDQ6VXNlcjEyMDExNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/120117?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cdecker",
        "html_url": "https://github.com/cdecker",
        "followers_url": "https://api.github.com/users/cdecker/followers",
        "following_url": "https://api.github.com/users/cdecker/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/cdecker/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/cdecker/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/cdecker/subscriptions",
        "organizations_url": "https://api.github.com/users/cdecker/orgs",
        "repos_url": "https://api.github.com/users/cdecker/repos",
        "events_url": "https://api.github.com/users/cdecker/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/cdecker/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T21:29:31Z"
    },
    {
      "event": "mentioned",
      "id": 14281378559,
      "node_id": "MEE_lADOABII586WhaLCzwAAAANTPIr_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281378559",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T21:29:31Z"
    },
    {
      "event": "subscribed",
      "id": 14281378567,
      "node_id": "SE_lADOABII586WhaLCzwAAAANTPIsH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281378567",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T21:29:31Z"
    }
  ]
}
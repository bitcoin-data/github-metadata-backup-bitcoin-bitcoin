{
  "type": "issue",
  "issue": {
    "id": 2605658939,
    "node_id": "I_kwDOABII586bTzM7",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31131",
    "number": 31131,
    "state": "open",
    "state_reason": null,
    "title": "TestFramework: TestShell.reset() will always fail",
    "body": "[TestShell documentation](https://github.com/bitcoin/bitcoin/blob/28ce159bc327e6dfec34077ff2e379b23a95db65/test/functional/test-shell.md?plain=1#L167) mentions a `TestShell.reset()` method.\r\n\r\nWhen experimenting with it, it will always fail with:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/jose.edil/2-development/bitcoin/vinteum/foss-program/infra-signet-server/signet-server.py\", line 169, in <module>\r\n    TestShell().reset()\r\n  File \"/Users/jose.edil/2-development/bitcoin/bitcoin-core-build/test/functional/test_framework/test_shell.py\", line 64, in reset\r\n    super().__init__()\r\nTypeError: BitcoinTestFramework.__init__() missing 1 required positional argument: 'test_file'\r\n```\r\n\r\nIndeed, inspecting the [source code](https://github.com/bitcoin/bitcoin/blob/28ce159bc327e6dfec34077ff2e379b23a95db65/test/functional/test_framework/test_shell.py#L59-L64), we see that `TestShell` is a wrapper class for `BitcoinTestFramework`. `TestShell.reset()` will call `super().__init__()` which refers to `BitcoinTestFramework.__init__()`.\r\n\r\nBut we only have `def __init__(self, test_file) -> None:` which will require a mandatory `test_file` parameter. (https://github.com/bitcoin/bitcoin/blob/28ce159bc327e6dfec34077ff2e379b23a95db65/test/functional/test_framework/test_framework.py#L95C5-L95C43).\r\n\r\nNot sure if `TestShell.reset()` should change to receive this parameter and pass along to the `__init__()` function it calls internally or any other workaround. In my specific case, I can't see what I can pass as `test_file`.",
    "user": {
      "login": "edilmedeiros",
      "id": 78322931,
      "node_id": "MDQ6VXNlcjc4MzIyOTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/edilmedeiros",
      "html_url": "https://github.com/edilmedeiros",
      "followers_url": "https://api.github.com/users/edilmedeiros/followers",
      "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
      "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
      "repos_url": "https://api.github.com/users/edilmedeiros/repos",
      "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 3,
    "created_at": "2024-10-22T14:38:58Z",
    "updated_at": "2024-10-23T18:15:29Z"
  },
  "events": [
    {
      "event": "renamed",
      "id": 14786893459,
      "node_id": "RTE_lADOABII586bTzM7zwAAAANxXhaT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14786893459",
      "actor": {
        "login": "edilmedeiros",
        "id": 78322931,
        "node_id": "MDQ6VXNlcjc4MzIyOTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/edilmedeiros",
        "html_url": "https://github.com/edilmedeiros",
        "followers_url": "https://api.github.com/users/edilmedeiros/followers",
        "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
        "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
        "repos_url": "https://api.github.com/users/edilmedeiros/repos",
        "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-22T14:39:25Z",
      "rename": {
        "from": "[TestFramework] TestShell.reset() will always fail",
        "to": "TestFramework: TestShell.reset() will always fail"
      }
    },
    {
      "event": "commented",
      "id": 2431516183,
      "node_id": "IC_kwDOABII586Q7f4X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2431516183",
      "actor": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-23T09:40:35Z",
      "updated_at": "2024-10-23T09:40:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for it! I think this is similar to #30714 (which fixed the initialization).\r\ncc: @theStack \r\n\r\n",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31131#issuecomment-2431516183",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131"
    },
    {
      "event": "mentioned",
      "id": 14807542950,
      "node_id": "MEE_lADOABII586bTzM7zwAAAANymSym",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14807542950",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-23T09:41:14Z"
    },
    {
      "event": "subscribed",
      "id": 14807542968,
      "node_id": "SE_lADOABII586bTzM7zwAAAANymSy4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14807542968",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-23T09:41:14Z"
    },
    {
      "event": "commented",
      "id": 2432635781,
      "node_id": "IC_kwDOABII586Q_xOF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2432635781",
      "actor": {
        "login": "edilmedeiros",
        "id": 78322931,
        "node_id": "MDQ6VXNlcjc4MzIyOTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/edilmedeiros",
        "html_url": "https://github.com/edilmedeiros",
        "followers_url": "https://api.github.com/users/edilmedeiros/followers",
        "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
        "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
        "repos_url": "https://api.github.com/users/edilmedeiros/repos",
        "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-23T15:31:50Z",
      "updated_at": "2024-10-23T15:31:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "Looks similar, indeed, but I think #30714 did not covered `TestShell().setup()`.",
      "user": {
        "login": "edilmedeiros",
        "id": 78322931,
        "node_id": "MDQ6VXNlcjc4MzIyOTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78322931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/edilmedeiros",
        "html_url": "https://github.com/edilmedeiros",
        "followers_url": "https://api.github.com/users/edilmedeiros/followers",
        "following_url": "https://api.github.com/users/edilmedeiros/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/edilmedeiros/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/edilmedeiros/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/edilmedeiros/subscriptions",
        "organizations_url": "https://api.github.com/users/edilmedeiros/orgs",
        "repos_url": "https://api.github.com/users/edilmedeiros/repos",
        "events_url": "https://api.github.com/users/edilmedeiros/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/edilmedeiros/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31131#issuecomment-2432635781",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131"
    },
    {
      "event": "commented",
      "id": 2433056070,
      "node_id": "IC_kwDOABII586RBX1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2433056070",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-23T18:15:28Z",
      "updated_at": "2024-10-23T18:15:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "It seems that the TestShell instructions generally don't work anymore since we switched to CMake. For me they fail already earlier at the `TestShell` instantiation, as the generated `config.ini` file is searched in a path that still assumes in-tree builds:\r\n```\r\n$ git rev-parse HEAD\r\nffe4261cb0669b1e1a926638e0498ae5b63f3599\r\n$ python3\r\nPython 3.10.12 (main, Sep 11 2024, 15:47:36) [GCC 11.4.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import sys\r\n>>> sys.path.insert(0, \"./test/functional\")\r\n>>> from test_framework.test_shell import TestShell\r\n>>> test = TestShell().setup(num_nodes=2, setup_clean_chain=True)\r\ntests_directory = /home/fas/bitcoin/test/functional\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/fas/bitcoin/./test/functional/test_framework/test_shell.py\", line 79, in __new__\r\n    TestShell.instance = TestShell.__TestShell(tests_directory / \"testshell_dummy.py\")\r\n  File \"/home/fas/bitcoin/./test/functional/test_framework/test_framework.py\", line 106, in __init__\r\n    self.parse_args(test_file)\r\n  File \"/home/fas/bitcoin/./test/functional/test_framework/test_framework.py\", line 210, in parse_args\r\n    config.read_file(open(self.options.configfile))\r\nFileNotFoundError: [Errno 2] No such file or directory: '/home/fas/bitcoin/test/config.ini'\r\n```\r\nI assume that this was not noticed for some time as users probably had left-over files around from previous autotools builds (or, no-one just tried it after the switch to CMake, which was merged after the last TestShell fix #30714). A first naive try to fix this by adding the out-of-tree path \"./build/test/functional\" to sys.path instead of the in-tree one didn't help either. ",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31131#issuecomment-2433056070",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31131"
    }
  ]
}
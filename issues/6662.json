{
  "type": "issue",
  "issue": {
    "id": 106067364,
    "node_id": "MDU6SXNzdWUxMDYwNjczNjQ=",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/6662",
    "number": 6662,
    "state": "closed",
    "state_reason": "completed",
    "title": "rescanning uses incorrect date for old transactions",
    "body": "I had a few conflicted transactions in my wallet, so I ran:\n\n```\nbitcoind -zapwallettxes=2\n```\n\nto delete them. After doing so, all my transactions from before January 2014 had a date of January 2014.\n\nUpon checking the source code, I see this line in `CWallet::AddToWallet()` in `wallet/wallet.cpp`:\n\n```\nwtx.nTimeSmart = std::max(latestEntry, std::min(blocktime, latestNow));\n```\n\n`blocktime` is the time I want to see in my transactions, `latestNow` is much bigger, and so the `min()` returns the time I want, but `latestEntry` is January 2014, and so that's the time that is used for all my old transactions.\n\nI'm not entirely clear how the Jan 2014 date is being found, since `-zapwallettxes` is meant to delete all the transactions and rescan to find them again, but it seems that\n\n```\nTxItems txOrdered = OrderedTxItems(acentries);\n```\n\nis finding a transaction from 2014, even after all transactions have been deleted.\n\nI tried replacing the nTimeSmart = max(min()) code with this:\n\n```\nwtx.nTimeSmart = std::min(blocktime, latestNow);\n```\n\nthen re-ran with the -zap flag, and now I see the correct dates next to all of my transactions.\n",
    "user": {
      "login": "dooglus",
      "id": 573356,
      "node_id": "MDQ6VXNlcjU3MzM1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dooglus",
      "html_url": "https://github.com/dooglus",
      "followers_url": "https://api.github.com/users/dooglus/followers",
      "following_url": "https://api.github.com/users/dooglus/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dooglus/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dooglus/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dooglus/subscriptions",
      "organizations_url": "https://api.github.com/users/dooglus/orgs",
      "repos_url": "https://api.github.com/users/dooglus/repos",
      "events_url": "https://api.github.com/users/dooglus/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dooglus/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 5,
    "closed_at": "2022-08-05T06:24:27Z",
    "created_at": "2015-09-11T18:34:41Z",
    "updated_at": "2022-08-05T06:24:27Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 416145960,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQxNjE0NTk2MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/416145960",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2015-09-22T17:59:11Z",
      "label": {
        "name": "Wallet",
        "color": "02d7e1"
      }
    },
    {
      "event": "commented",
      "id": 326349733,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjM0OTczMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326349733",
      "actor": {
        "login": "bitcartel",
        "id": 194979,
        "node_id": "MDQ6VXNlcjE5NDk3OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/194979?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcartel",
        "html_url": "https://github.com/bitcartel",
        "followers_url": "https://api.github.com/users/bitcartel/followers",
        "following_url": "https://api.github.com/users/bitcartel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcartel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcartel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcartel/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcartel/orgs",
        "repos_url": "https://api.github.com/users/bitcartel/repos",
        "events_url": "https://api.github.com/users/bitcartel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcartel/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-31T16:25:44Z",
      "updated_at": "2017-08-31T16:25:44Z",
      "author_association": "NONE",
      "body": "Does this still need fixing?\r\n https://github.com/bitcoin/bitcoin/blob/df91e11ae1e9d7af55a549b597a73d01e3a646c7/src/wallet/wallet.cpp#L3700",
      "user": {
        "login": "bitcartel",
        "id": 194979,
        "node_id": "MDQ6VXNlcjE5NDk3OQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/194979?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcartel",
        "html_url": "https://github.com/bitcartel",
        "followers_url": "https://api.github.com/users/bitcartel/followers",
        "following_url": "https://api.github.com/users/bitcartel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcartel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcartel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcartel/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcartel/orgs",
        "repos_url": "https://api.github.com/users/bitcartel/repos",
        "events_url": "https://api.github.com/users/bitcartel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcartel/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6662#issuecomment-326349733",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662"
    },
    {
      "event": "commented",
      "id": 326353456,
      "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjM1MzQ1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/326353456",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-08-31T16:39:46Z",
      "updated_at": "2017-08-31T16:39:46Z",
      "author_association": "MEMBER",
      "body": "It doesn't look like that line of code has changed since it was added in 2012 c3f95ef13f48d21db53992984976eac93e7a08fc.\r\n\r\nIt sounds like dooglus had to remove the max with `latestEntry` part to avoid the problem.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6662#issuecomment-326353456",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662"
    },
    {
      "event": "commented",
      "id": 700750968,
      "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDc1MDk2OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/700750968",
      "actor": {
        "login": "thejohnha",
        "id": 6325833,
        "node_id": "MDQ6VXNlcjYzMjU4MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6325833?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/thejohnha",
        "html_url": "https://github.com/thejohnha",
        "followers_url": "https://api.github.com/users/thejohnha/followers",
        "following_url": "https://api.github.com/users/thejohnha/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/thejohnha/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/thejohnha/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/thejohnha/subscriptions",
        "organizations_url": "https://api.github.com/users/thejohnha/orgs",
        "repos_url": "https://api.github.com/users/thejohnha/repos",
        "events_url": "https://api.github.com/users/thejohnha/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/thejohnha/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-09-29T14:38:59Z",
      "updated_at": "2020-09-29T14:38:59Z",
      "author_association": "NONE",
      "body": "I believe this is the issue causing older transactions to have incorrect dates when using the Export function out of the bitcoin-core client (GUI). It would be nice if the export function worked correctly... Many thanks üôèüôèüôè",
      "user": {
        "login": "thejohnha",
        "id": 6325833,
        "node_id": "MDQ6VXNlcjYzMjU4MzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6325833?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/thejohnha",
        "html_url": "https://github.com/thejohnha",
        "followers_url": "https://api.github.com/users/thejohnha/followers",
        "following_url": "https://api.github.com/users/thejohnha/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/thejohnha/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/thejohnha/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/thejohnha/subscriptions",
        "organizations_url": "https://api.github.com/users/thejohnha/orgs",
        "repos_url": "https://api.github.com/users/thejohnha/repos",
        "events_url": "https://api.github.com/users/thejohnha/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/thejohnha/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6662#issuecomment-700750968",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662"
    },
    {
      "event": "commented",
      "id": 1205710182,
      "node_id": "IC_kwDOABII585H3a1m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1205710182",
      "actor": {
        "login": "kouloumos",
        "id": 18506343,
        "node_id": "MDQ6VXNlcjE4NTA2MzQz",
        "avatar_url": "https://avatars.githubusercontent.com/u/18506343?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kouloumos",
        "html_url": "https://github.com/kouloumos",
        "followers_url": "https://api.github.com/users/kouloumos/followers",
        "following_url": "https://api.github.com/users/kouloumos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kouloumos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kouloumos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kouloumos/subscriptions",
        "organizations_url": "https://api.github.com/users/kouloumos/orgs",
        "repos_url": "https://api.github.com/users/kouloumos/repos",
        "events_url": "https://api.github.com/users/kouloumos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kouloumos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-04T20:00:14Z",
      "updated_at": "2022-08-04T20:00:14Z",
      "author_association": "MEMBER",
      "body": "The logic mentioned here was initially extracted to `ComputeTimeSmart` with https://github.com/bitcoin/bitcoin/pull/9369 and the issue was later fixed with https://github.com/bitcoin/bitcoin/pull/20591. See https://github.com/bitcoin/bitcoin/issues/11703#issuecomment-1205701710 for more details.",
      "user": {
        "login": "kouloumos",
        "id": 18506343,
        "node_id": "MDQ6VXNlcjE4NTA2MzQz",
        "avatar_url": "https://avatars.githubusercontent.com/u/18506343?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kouloumos",
        "html_url": "https://github.com/kouloumos",
        "followers_url": "https://api.github.com/users/kouloumos/followers",
        "following_url": "https://api.github.com/users/kouloumos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kouloumos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kouloumos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kouloumos/subscriptions",
        "organizations_url": "https://api.github.com/users/kouloumos/orgs",
        "repos_url": "https://api.github.com/users/kouloumos/repos",
        "events_url": "https://api.github.com/users/kouloumos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kouloumos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6662#issuecomment-1205710182",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662"
    },
    {
      "event": "commented",
      "id": 1206088563,
      "node_id": "IC_kwDOABII585H43Nz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1206088563",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-05T06:24:27Z",
      "updated_at": "2022-08-05T06:24:27Z",
      "author_association": "MEMBER",
      "body": "Ok, closing for now. Can be reopened if the fix didn't work.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/6662#issuecomment-1206088563",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6662"
    },
    {
      "event": "closed",
      "id": 7133354311,
      "node_id": "CE_lADOABII584GUnWkzwAAAAGpLllH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7133354311",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-05T06:24:27Z"
    }
  ]
}
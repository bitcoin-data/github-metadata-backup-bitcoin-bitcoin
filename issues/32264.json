{
  "type": "issue",
  "issue": {
    "id": 2992484696,
    "node_id": "I_kwDOABII586yXbFY",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32264",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32264/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32264/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32264/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32264",
    "number": 32264,
    "state": "open",
    "state_reason": null,
    "title": "test: functional test failures under `--usecli`",
    "body": "Ubuntu 24.04.2 LTS\nPython 3.12.3\nmaster @ 817edfb21e4fa96289d69d4e1dbabb6b9ef9d8f5\n```bash\ncmake -B build\ncmake --build build\n./build/test/functional/test_runner.py --usecli\n```\n\n```bash\nfeature_assumeutxo.py                                                | âœ– Failed  | 11 s\nfeature_bip68_sequence.py                                            | âœ– Failed  | 58 s\nfeature_fastprune.py                                                 | âœ– Failed  | 1 s\nfeature_fee_estimation.py                                            | âœ– Failed  | 1 s\nfeature_nulldummy.py                                                 | âœ– Failed  | 1 s\nfeature_reindex_readonly.py                                          | âœ– Failed  | 0 s\nfeature_signet.py                                                    | âœ– Failed  | 1 s\nfeature_taproot.py                                                   | âœ– Failed  | 6 s\nmempool_package_rbf.py                                               | âœ– Failed  | 22 s\nmining_mainnet.py                                                    | âœ– Failed  | 1 s\np2p_net_deadlock.py --v1transport                                    | âœ– Failed  | 1 s\np2p_net_deadlock.py --v2transport                                    | âœ– Failed  | 1 s\np2p_tx_download.py                                                   | âœ– Failed  | 34 s\nrpc_deprecated.py                                                    | âœ– Failed  | 1 s\nrpc_estimatefee.py                                                   | âœ– Failed  | 1 s\nrpc_generate.py                                                      | âœ– Failed  | 1 s\nrpc_getblockfrompeer.py                                              | âœ– Failed  | 1 s\nrpc_getdescriptorinfo.py                                             | âœ– Failed  | 1 s\nrpc_invalid_address_message.py                                       | âœ– Failed  | 2 s\nrpc_packages.py                                                      | âœ– Failed  | 5 s\nrpc_scanblocks.py                                                    | âœ– Failed  | 1 s\nrpc_scantxoutset.py                                                  | âœ– Failed  | 5 s\nrpc_whitelist.py                                                     | âœ– Failed  | 1 s\nwallet_bumpfee.py --descriptors                                      | âœ– Failed  | 10 s\nwallet_descriptor.py --descriptors                                   | âœ– Failed  | 7 s\nwallet_encryption.py --descriptors                                   | âœ– Failed  | 6 s\nwallet_fundrawtransaction.py --descriptors                           | âœ– Failed  | 12 s\nwallet_labels.py --descriptors                                       | âœ– Failed  | 2 s\nwallet_miniscript.py --descriptors                                   | âœ– Failed  | 2 s\nwallet_send.py --descriptors                                         | âœ– Failed  | 1 s\n```\n\n```bash\n147/318 - rpc_deprecated.py failed, Duration: 1 s\n\nstdout:\n2025-04-14T09:29:49.903000Z TestFramework (INFO): PRNG seed is: 5746030027211002162\n2025-04-14T09:29:49.903000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_â‚¿_ðŸƒ_20250414_092629/rpc_deprecated_169\n2025-04-14T09:29:50.177000Z TestFramework (INFO): Tests for deprecated RPC methods (if any)\n2025-04-14T09:29:50.178000Z TestFramework (INFO): Tests for deprecated wallet-related RPC methods (if any)\n2025-04-14T09:29:50.178000Z TestFramework (INFO): Test settxfee RPC deprecation\n2025-04-14T09:29:50.203000Z TestFramework (ERROR): Unexpected exception caught during testing\nTraceback (most recent call last):\n  File \"/root/ci_scratch/test/functional/test_framework/test_framework.py\", line 182, in main\n    self.run_test()\n  File \"/root/ci_scratch/build/test/functional/rpc_deprecated.py\", line 37, in run_test\n    assert_raises_rpc_error(-32, 'settxfee is deprecated and will be fully removed in v31.0.', self.nodes[0].rpc.settxfee, 0.01)\n                                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'settxfee'\n```\n\n```bash\n131/318 - rpc_whitelist.py failed, Duration: 1 s\n\nstdout:\n2025-04-14T09:29:42.390000Z TestFramework (INFO): PRNG seed is: 3309837604605811676\n2025-04-14T09:29:42.390000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_â‚¿_ðŸƒ_20250414_092629/rpc_whitelist_186\n2025-04-14T09:29:43.102000Z TestFramework (INFO): [user1]: Testing a non permitted permission (getnetworkinfo)\n2025-04-14T09:29:43.102000Z TestFramework (ERROR): Unexpected exception caught during testing\nTraceback (most recent call last):\n  File \"/root/ci_scratch/test/functional/test_framework/test_framework.py\", line 182, in main\n    self.run_test()\n  File \"/root/ci_scratch/build/test/functional/rpc_whitelist.py\", line 78, in run_test\n    assert_equal(403, rpccall(self.nodes[0], user, permission).status)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/ci_scratch/build/test/functional/rpc_whitelist.py\", line 20, in rpccall\n    conn = http.client.HTTPConnection(url.hostname, url.port)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/http/client.py\", line 880, in __init__\n    (self.host, self.port) = self._get_hostport(host, port)\n                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/http/client.py\", line 926, in _get_hostport\n    i = host.rfind(':')\n        ^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'rfind'\n```\n\n```bash\n90/318 - feature_bip68_sequence.py failed, Duration: 58 s\n\nstdout:\n2025-04-14T09:28:25.778000Z TestFramework (INFO): PRNG seed is: 2393500354933353065\n2025-04-14T09:28:25.779000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_â‚¿_ðŸƒ_20250414_092629/feature_bip68_sequence_271\n2025-04-14T09:28:26.365000Z TestFramework (INFO): Running test disable flag\n2025-04-14T09:28:26.430000Z TestFramework (INFO): Running test sequence-lock-confirmed-inputs\n2025-04-14T09:29:22.254000Z TestFramework (INFO): Running test sequence-lock-unconfirmed-inputs\n2025-04-14T09:29:23.869000Z TestFramework (ERROR): Assertion failed\nTraceback (most recent call last):\n  File \"/root/ci_scratch/test/functional/test_framework/test_framework.py\", line 182, in main\n    self.run_test()\n  File \"/root/ci_scratch/build/test/functional/feature_bip68_sequence.py\", line 73, in run_test\n    self.test_sequence_lock_unconfirmed_inputs()\n  File \"/root/ci_scratch/build/test/functional/feature_bip68_sequence.py\", line 336, in test_sequence_lock_unconfirmed_inputs\n    assert_equal(None if i == 1 else 'inconclusive', self.nodes[0].submitblock(block.serialize().hex()))\n  File \"/root/ci_scratch/test/functional/test_framework/util.py\", line 77, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(None == )\n```",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 1,
    "created_at": "2025-04-14T09:36:43Z",
    "updated_at": "2025-04-14T09:50:09Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2801131278,
      "node_id": "IC_kwDOABII586m9d8O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2801131278",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-14T09:50:00Z",
      "updated_at": "2025-04-14T09:50:00Z",
      "author_association": "MEMBER",
      "body": "> File \"/root/ci_scratch/build/test/functional/rpc_deprecated.py\", line 37, in run_test\n>     assert_raises_rpc_error(-32, 'settxfee is deprecated and will be fully removed in v31.0.', self.nodes[0].rpc.settxfee, 0.01)\n>                                                                                                ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> AttributeError: 'NoneType' object has no attribute 'settxfee'\n\nThis one seems obvious: The `rpc` member field should almost never be used. Directly calling the RPC field via the getattr is better.\n\n\n\n> File \"/root/ci_scratch/build/test/functional/feature_bip68_sequence.py\", line 336, in test_sequence_lock_unconfirmed_inputs\n>     assert_equal(None if i == 1 else 'inconclusive', self.nodes[0].submitblock(block.serialize().hex()))\n>   File \"/root/ci_scratch/test/functional/test_framework/util.py\", line 77, in assert_equal\n>     raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\n> AssertionError: not(None == )\n\nThis affects a few RPCs, where json-none is an empty string for the cli,  see also https://github.com/bitcoin/bitcoin/issues/18476.\n\n\n\nFor the other issues, I haven't looked, but there is `self.supports_cli = False`.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32264#issuecomment-2801131278",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32264"
    },
    {
      "event": "labeled",
      "id": 17245714229,
      "node_id": "LE_lADOABII586yXbFYzwAAAAQD7Lc1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17245714229",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-14T09:50:09Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    }
  ]
}
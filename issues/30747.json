{
  "type": "issue",
  "issue": {
    "id": 2493716223,
    "node_id": "I_kwDOABII586Uoxb_",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30747",
    "number": 30747,
    "state": "open",
    "state_reason": null,
    "title": "Risczero Fit",
    "body": "### Please describe the feature you'd like to see added.\n\nSupport the risczero platfrom by riscv32-unknown-elf-g++. which will bring more prove system for bitcoin.\r\n\n\n### Is your feature related to a problem, if so please describe it.\n\nwhen i compile by riscv32-unknown-elf-g++ compiler, get the below error:\r\n\r\n```\r\nblockbody-guest:   cargo:warning=In file included from depend/bitcoin/src/hash.h:14,\r\nblockbody-guest:   cargo:warning=                 from depend/bitcoin/src/script/interpreter.h:9,\r\nblockbody-guest:   cargo:warning=                 from depend/bitcoin/src/script/interpreter.cpp:6:\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/serialize.h: In instantiation of 'void Serialize(Stream&, const T&) [with Stream = HashWriter; T = int]':\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/hash.h:144:20:   required from 'HashWriter& HashWriter::operator<<(const T&) [with T = int]'\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/script/interpreter.cpp:1613:12:   required from 'uint256 SignatureHash(const CScript&, const T&, unsigned int, int, const CAmount&, SigVersion, const PrecomputedTransactionData*) [with T = CTransaction; CAmount = long long int]'\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/script/interpreter.cpp:1664:36:   required from 'bool GenericTransactionSignatureChecker<T>::CheckECDSASignature(const std::vector<unsigned char>&, const std::vector<unsigned char>&, const CScript&, SigVersion) const [with T = CTransaction]'\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/script/interpreter.cpp:1785:16:   required from here\r\nblockbody-guest:   cargo:warning=depend/bitcoin/src/serialize.h:776:7: error: request for member 'Serialize' in 'a', which is of non-class type 'const int'\r\nblockbody-guest:   cargo:warning=  776 |     a.Serialize(os);\r\n```\r\n\r\nThis error is caused by the logic in the SignatureHash function within src/script/interpreter.cpp. The function serializes the data to obtain a hash value, but it fails to find a serialization method for the int type.\r\n\r\n```\r\n// Sighash type\r\nss << nHashType;\r\n```\r\nThis behavior is particularly strict in environments like RISC-V, where the ABI (Application Binary Interface) might enforce more rigid type distinctions, leading to errors during compilation.\r\n\r\nThe `-march=rv32i -mabi=ilp32` for the compiler(riscv32-unknown-elf-g++).\n\n### Describe the solution you'd like\n\nThis issue was temporarily bypassed by adding serialization/deserialization code for the int type. Supporting R0 will allow the BTC L2 prover to extend to more proof systems.\r\n\r\nAdd methods temporarily in the PR\r\n: https://github.com/rust-bitcoin/rust-bitcoinconsensus/pull/97/files; Maybe best solution from the commiunity.\n\n### Describe any alternatives you've considered\n\n_No response_\n\n### Please leave any additional context\n\n_No response_",
    "user": {
      "login": "ludete",
      "id": 23181804,
      "node_id": "MDQ6VXNlcjIzMTgxODA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/23181804?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ludete",
      "html_url": "https://github.com/ludete",
      "followers_url": "https://api.github.com/users/ludete/followers",
      "following_url": "https://api.github.com/users/ludete/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ludete/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ludete/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ludete/subscriptions",
      "organizations_url": "https://api.github.com/users/ludete/orgs",
      "repos_url": "https://api.github.com/users/ludete/repos",
      "events_url": "https://api.github.com/users/ludete/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ludete/received_events",
      "type": "User",
      "site_admin": false
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      },
      {
        "id": 61889416,
        "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
        "name": "Build system",
        "color": "5319e7",
        "default": false
      },
      {
        "id": 192202000,
        "node_id": "MDU6TGFiZWwxOTIyMDIwMDA=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus",
        "name": "Consensus",
        "color": "009800",
        "default": false
      },
      {
        "id": 477890092,
        "node_id": "MDU6TGFiZWw0Nzc4OTAwOTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help",
        "name": "Questions and Help",
        "color": "006688",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "created_at": "2024-08-29T07:55:48Z",
    "updated_at": "2024-09-03T05:59:35Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 14057392275,
      "node_id": "LE_lADOABII586Uoxb_zwAAAANF4siT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14057392275",
      "actor": {
        "login": "ludete",
        "id": 23181804,
        "node_id": "MDQ6VXNlcjIzMTgxODA0",
        "avatar_url": "https://avatars.githubusercontent.com/u/23181804?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ludete",
        "html_url": "https://github.com/ludete",
        "followers_url": "https://api.github.com/users/ludete/followers",
        "following_url": "https://api.github.com/users/ludete/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ludete/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ludete/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ludete/subscriptions",
        "organizations_url": "https://api.github.com/users/ludete/orgs",
        "repos_url": "https://api.github.com/users/ludete/repos",
        "events_url": "https://api.github.com/users/ludete/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ludete/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T07:55:48Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "commented",
      "id": 2316988697,
      "node_id": "IC_kwDOABII586KGnEZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2316988697",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T08:15:53Z",
      "updated_at": "2024-08-29T08:15:53Z",
      "author_association": "MEMBER",
      "body": "> This issue was temporarily bypassed by adding serialization/deserialization code for the int type. Supporting R0 will allow the BTC L2 prover to extend to more proof systems.\r\n\r\nInteresting. All int widths should already be possible to serialize, according to the code:\r\n\r\n```cpp\r\ntemplate<typename Stream> inline void Serialize(Stream& s, int16_t a ) { ser_writedata16(s, a); }\r\ntemplate<typename Stream> inline void Serialize(Stream& s, uint16_t a) { ser_writedata16(s, a); }\r\ntemplate<typename Stream> inline void Serialize(Stream& s, int32_t a ) { ser_writedata32(s, a); }\r\ntemplate<typename Stream> inline void Serialize(Stream& s, uint32_t a) { ser_writedata32(s, a); }\r\ntemplate<typename Stream> inline void Serialize(Stream& s, int64_t a ) { ser_writedata64(s, a); }\r\ntemplate<typename Stream> inline void Serialize(Stream& s, uint64_t a) { ser_writedata64(s, a); }\r\n```\r\n\r\nI guess `int` is somehow a distinct type in your environment?\r\n\r\nPlease be aware that violations in `src/compat/assumptions.h` may lead to incorrectly compiled code.\r\n\r\nI see that https://github.com/rust-bitcoin/rust-bitcoinconsensus/blob/0fcec269c6c7fee11b163c6800c998eee9b64df6/depend/bitcoin/src/serialize.h lacks that include, whereas in current master in this repo, it is present.\r\n\r\nCan you try to compile `static_assert(std::is_same_v<int, int32_t>);` on your system, as well as `assumptions.h`?\r\n\r\n(Godbolt: https://godbolt.org/z/T9bY9PrPx)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30747#issuecomment-2316988697",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747"
    },
    {
      "event": "labeled",
      "id": 14057659201,
      "node_id": "LE_lADOABII586Uoxb_zwAAAANF5ttB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14057659201",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T08:16:05Z",
      "label": {
        "name": "Build system",
        "color": "5319e7"
      }
    },
    {
      "event": "labeled",
      "id": 14057659208,
      "node_id": "LE_lADOABII586Uoxb_zwAAAANF5ttI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14057659208",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T08:16:05Z",
      "label": {
        "name": "Consensus",
        "color": "009800"
      }
    },
    {
      "event": "labeled",
      "id": 14057659219,
      "node_id": "LE_lADOABII586Uoxb_zwAAAANF5ttT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14057659219",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-29T08:16:05Z",
      "label": {
        "name": "Questions and Help",
        "color": "006688"
      }
    },
    {
      "event": "commented",
      "id": 2320560690,
      "node_id": "IC_kwDOABII586KUPIy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2320560690",
      "actor": {
        "login": "nicholas-1vbw",
        "id": 168563882,
        "node_id": "U_kgDOCgwUqg",
        "avatar_url": "https://avatars.githubusercontent.com/u/168563882?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nicholas-1vbw",
        "html_url": "https://github.com/nicholas-1vbw",
        "followers_url": "https://api.github.com/users/nicholas-1vbw/followers",
        "following_url": "https://api.github.com/users/nicholas-1vbw/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nicholas-1vbw/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nicholas-1vbw/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nicholas-1vbw/subscriptions",
        "organizations_url": "https://api.github.com/users/nicholas-1vbw/orgs",
        "repos_url": "https://api.github.com/users/nicholas-1vbw/repos",
        "events_url": "https://api.github.com/users/nicholas-1vbw/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nicholas-1vbw/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-30T09:00:41Z",
      "updated_at": "2024-08-30T09:22:11Z",
      "author_association": "NONE",
      "body": "Using toolchain from risc0, main.cpp that includes `assumptions.h` compiles successfully, but fails with `static_assert(std::is_same_v<int, int32_t>);`\r\n\r\nActually, the toolchain from risc0 **does** have different type of \"int\" and \"int32_t\", see https://github.com/risc0/toolchain/releases/tag/2024.01.05\r\n\r\nint32_t is defined in \"riscv32-unknown-elf/include/sys/_stdint.h\"\r\n```\r\n#ifdef ___int32_t_defined\r\n#ifndef _INT32_T_DECLARED\r\ntypedef __int32_t int32_t ;\r\n#define _INT32_T_DECLARED\r\n#endif\r\n#ifndef _UINT32_T_DECLARED\r\ntypedef __uint32_t uint32_t ;\r\n#define _UINT32_T_DECLARED\r\n#endif\r\n#define __int32_t_defined 1\r\n#endif /* ___int32_t_defined */\r\n```\r\n\r\nMaybe, we should static_cast/reinterpret_cast to int32_t on all \"int\" types, such as `nHashType`.",
      "user": {
        "login": "nicholas-1vbw",
        "id": 168563882,
        "node_id": "U_kgDOCgwUqg",
        "avatar_url": "https://avatars.githubusercontent.com/u/168563882?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nicholas-1vbw",
        "html_url": "https://github.com/nicholas-1vbw",
        "followers_url": "https://api.github.com/users/nicholas-1vbw/followers",
        "following_url": "https://api.github.com/users/nicholas-1vbw/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nicholas-1vbw/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nicholas-1vbw/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nicholas-1vbw/subscriptions",
        "organizations_url": "https://api.github.com/users/nicholas-1vbw/orgs",
        "repos_url": "https://api.github.com/users/nicholas-1vbw/repos",
        "events_url": "https://api.github.com/users/nicholas-1vbw/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nicholas-1vbw/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30747#issuecomment-2320560690",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747"
    },
    {
      "event": "commented",
      "id": 2325665028,
      "node_id": "IC_kwDOABII586KntUE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2325665028",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-03T05:59:34Z",
      "updated_at": "2024-09-03T05:59:34Z",
      "author_association": "MEMBER",
      "body": "> `assumptions.h` compiles successfully,  but fails with `static_assert(std::is_same_v<int, int32_t>);`\r\n\r\nOk, that means `int` has the correct width and thus the correct behavior, apart from being a separate type that the serialization templates can't deal with.\r\n\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30747#issuecomment-2325665028",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30747"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306",
    "id": 2799580389,
    "node_id": "PR_kwDOABII586m3jTl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33306",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33306.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33306.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/cb7f981018a843196062f86aab806cb446f58fd8",
    "number": 33306,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "index: Force database compaction in coinstatsindex",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This PR forces full database compaction on coinstatsindex every 10,000 blocks. This does not seem to come with any considerable performance impact, though I did not test on many different systems.\r\n\r\nMotivation: Currently, coinstatsindex ends up using a lot of 55kb files if this is not the case. This is likely related to very fast writes occurring during sync but so far I could not pin down where exactly the difference in behavior is coming from. It seems to be a LevelDB internal thing though, since I can not make out any difference in configuration between coinstatsindex and the other indexes.\r\n\r\nThis was first reported here: https://github.com/bitcoin/bitcoin/pull/30469#issuecomment-3235597424",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-09-04T13:56:22Z",
    "updated_at": "2026-02-05T13:50:22Z",
    "mergeable_state": "unknown",
    "merged": false,
    "merge_commit_sha": "bcd64d5aa492a1cd374bd540ab625320a44ea525",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "fjahr:2025-09-csi-compaction",
      "ref": "2025-09-csi-compaction",
      "sha": "cb7f981018a843196062f86aab806cb446f58fd8",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 196253948,
        "node_id": "MDEwOlJlcG9zaXRvcnkxOTYyNTM5NDg=",
        "name": "bitcoin",
        "full_name": "fjahr/bitcoin",
        "owner": {
          "login": "fjahr",
          "id": 1322187,
          "node_id": "MDQ6VXNlcjEzMjIxODc=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/fjahr",
          "html_url": "https://github.com/fjahr",
          "followers_url": "https://api.github.com/users/fjahr/followers",
          "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
          "organizations_url": "https://api.github.com/users/fjahr/orgs",
          "repos_url": "https://api.github.com/users/fjahr/repos",
          "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/fjahr/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/fjahr/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/fjahr/bitcoin",
        "archive_url": "https://api.github.com/repos/fjahr/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/fjahr/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/fjahr/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/fjahr/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/fjahr/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/fjahr/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/fjahr/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/fjahr/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/fjahr/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/fjahr/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/fjahr/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/fjahr/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/fjahr/bitcoin/events",
        "forks_url": "https://api.github.com/repos/fjahr/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/fjahr/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/fjahr/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/fjahr/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/fjahr/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/fjahr/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/fjahr/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/fjahr/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/fjahr/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/fjahr/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/fjahr/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/fjahr/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/fjahr/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/fjahr/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/fjahr/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/fjahr/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:fjahr/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/fjahr/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/fjahr/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/fjahr/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/fjahr/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/fjahr/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/fjahr/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/fjahr/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/fjahr/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/fjahr/bitcoin/hooks",
        "svn_url": "https://github.com/fjahr/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 287392,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-03T17:05:41Z",
        "created_at": "2019-07-10T18:11:06Z",
        "updated_at": "2024-07-23T22:14:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "8bb77f348ef390b7f7c7fb6b57fdc7e86ddb4ce7",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38846,
        "stargazers_count": 87948,
        "watchers_count": 87948,
        "size": 303081,
        "default_branch": "master",
        "open_issues_count": 748,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-05T12:19:13Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-05T13:42:44Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 21,
    "deletions": 1,
    "changed_files": 6,
    "commits": 2,
    "review_comments": 17,
    "comments": 8
  },
  "events": [
    {
      "event": "labeled",
      "id": 19505673336,
      "node_id": "LE_lADOABII587JsnzQzwAAAASKoPR4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19505673336",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-04T13:56:25Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3253859937,
      "node_id": "IC_kwDOABII587B8fZh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3253859937",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-04T13:56:27Z",
      "updated_at": "2026-02-05T13:50:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33306.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| User requested bot ignore | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832167483) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30342](https://github.com/bitcoin/bitcoin/pull/30342) (kernel, logging: Pass Logger instances to kernel objects by ryanofsky)\n* [#26966](https://github.com/bitcoin/bitcoin/pull/26966) (index: initial sync speedup, parallelize process by furszy)\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- synce -> sync [typo: \"synce\" is misspelled; should be \"sync\" to read \"upon finishing sync\"]\n\n\n\n<sup>2026-02-01 21:13:26</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3253859937",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "reviewed",
      "id": 3185973049,
      "node_id": "PRR_kwDOABII58695hc5",
      "url": null,
      "actor": null,
      "commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-04T15:49:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "Do you know if the current state with many small files and one large file has actual downsides, or does it just look weird? \r\n\r\nI am not an expert on LevelDB, just mentioning that two AIs I consulted say that benefits of regular compaction would be only be of cosmetic value and suggest to just let LevelDB do its thing.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#pullrequestreview-3185973049",
      "submitted_at": "2025-09-04T15:48:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
    },
    {
      "event": "commented",
      "id": 3254606614,
      "node_id": "IC_kwDOABII587B_VsW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3254606614",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-04T16:56:14Z",
      "updated_at": "2025-09-04T16:56:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "Good question and I am definitely not a LevelDB expert either. I think that at the size and usage pattern of the coinstatsindex we are not really facing any significant problems on a modern computer and system since the size of the data we are storing is very small relatively speaking for what LevelDB is capable of handling. But I think the impact is probably also non-zero and might increase over time as the blockchain grows. Very high-level rationale: there must be a reason LevelDB does these compactions usually.\r\n\r\nAs far as I can tell the best resource on this topic is this docs page: https://chromium.googlesource.com/external/leveldb/%2B/HEAD/doc/impl.md#timing From my understanding these small files are L0 files and having many of them means we potentially have overlapping keys among them, meaning we are wasting disk space, and \"This may significantly increase the cost of reads due to the overhead of merging more files together on every read.\" per the document.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3254606614",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "commented",
      "id": 3254623438,
      "node_id": "IC_kwDOABII587B_ZzO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3254623438",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-04T17:01:57Z",
      "updated_at": "2025-09-04T17:01:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "FWIW, from the patterns I have observed so far it seems likely to me that the problem is only occurring during sync and afterwards the data of new blocks are actually compacted as it should, just those 55kb files are left over from the sync phase. So I am thinking about changing the approach to only compact once when the index is being set to `m_synced = true`, though this would make it a more complex change and I need to do some more testing if my anecdotal observation is correct.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3254623438",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "reviewed",
      "id": 3186768456,
      "node_id": "PRR_kwDOABII58698jpI",
      "url": null,
      "actor": null,
      "commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-04T19:14:08Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#pullrequestreview-3186768456",
      "submitted_at": "2025-09-04T19:14:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19566661338,
      "node_id": "HRFPE_lADOABII587JsnzQzwAAAASOQ47a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19566661338",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "137ea944fb91a7d952c75d0e1e99bdf10491e119",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/137ea944fb91a7d952c75d0e1e99bdf10491e119",
      "created_at": "2025-09-08T14:30:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19566768683,
      "node_id": "HRFPE_lADOABII587JsnzQzwAAAASORTIr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19566768683",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "created_at": "2025-09-08T14:35:19Z"
    },
    {
      "event": "labeled",
      "id": 19577185394,
      "node_id": "LE_lADOABII587JsnzQzwAAAASO5CRy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19577185394",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-09T01:28:09Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3197501516,
      "node_id": "PRR_kwDOABII586-lgBM",
      "url": null,
      "actor": null,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-09T05:06:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm missing benchmark results to see how this change affects the already very slow performance. I will post my own results as soon as they finish.\n\nI would also like to understand why database compaction isn't enabled for this LevelDB instance.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#pullrequestreview-3197501516",
      "submitted_at": "2025-09-09T05:06:13Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhmZDI4NWIyNGZlZWUzNjlkZDM1N2Q2ZmE4OThjMzkwMTAxY2UwZWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8fd285b24feee369dd357d6fa898c390101ce0ee",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8fd285b24feee369dd357d6fa898c390101ce0ee",
      "tree": {
        "sha": "e96b606f206dd393b07a967acf47c6b189f83116",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e96b606f206dd393b07a967acf47c6b189f83116"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e96b606f206dd393b07a967acf47c6b189f83116\nparent 3d180d3c7f1f26c2fb3139937406cc84dbea5325\nauthor Fabian Jahr <fjahr@protonmail.com> 1757336991 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769975160 +0100\n\ndb, refactor: Add full compaction helper method\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml/rXkVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNbdYQAKOojqSAyopNnJtNf0WAgNaJRtuG\nSuOoSWEBclsMWT1Cv1bWqlWjTCYKXNqmeUWXh87EY5lwkbtumCQtJMsOK5ksOJin\nHDxspnu/Y+6YIMgbZ9a3wKkRpnvvTregeTL3wXI0eB5SoXMc5AAE+BMi4OzkjB1r\nhJPXRcQPH33JmvnS2hKmwCWf3E0dMyGLodn0D7qkvdXYC4uW43L+DqjXcTBRYtGU\nfT4t0LD6RYnzQBKtLOr/JpqBo8xNUbVxozy6C+VgTcCplFUbj/d9/ogoor/DeJgY\ncg1ywQ2O1LklcNlqeRpn6CkMHxSJNNZTRQQSjKY5JzXFuqKeIDvLbjWQfIg3DEfP\n5D0UxVjp3SIzObKRZK5XXhZAnWYRVo4oZlIp8NjuDS1/cPFo3eXaZ/8valYy6TaM\nGMsqomLs63xII0jHVGWpqAMIYAk6IiJDppQiMZfA7GK5U7h50+CmbhrI1dNgdojM\nT45lg4hvpgyx9AL4HF7ELIopdR2xgrAXY25Twu2wQnWD2QEwZqOYyE4BbUGx1Cu7\nXkLCCqj+jl4W2qf9pqpNs7OYK9j2AFHAT88x5bpmmjtvDFz0Y44C7nsdEwSGk0R+\nagJtiScQNMsIHb7BpJagHfjPQqIQtZSBgMPPhNtLtNKJNzUiakMoD1+35SlMv4o1\nE/UYY3shn+hXMJzS\n=n22i\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3d180d3c7f1f26c2fb3139937406cc84dbea5325",
          "sha": "3d180d3c7f1f26c2fb3139937406cc84dbea5325",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3d180d3c7f1f26c2fb3139937406cc84dbea5325"
        }
      ],
      "message": "db, refactor: Add full compaction helper method",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-02-01T19:46:00Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-09-08T13:09:51Z"
      },
      "sha": "8fd285b24feee369dd357d6fa898c390101ce0ee"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNiN2Y5ODEwMThhODQzMTk2MDYyZjg2YWFiODA2Y2I0NDZmNThmZDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cb7f981018a843196062f86aab806cb446f58fd8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cb7f981018a843196062f86aab806cb446f58fd8",
      "tree": {
        "sha": "5039b64cc7d107d63c756cfec74c3ecf426ae9b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5039b64cc7d107d63c756cfec74c3ecf426ae9b1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5039b64cc7d107d63c756cfec74c3ecf426ae9b1\nparent 8fd285b24feee369dd357d6fa898c390101ce0ee\nauthor Fabian Jahr <fjahr@protonmail.com> 1757337029 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769979412 +0100\n\nindex: Force database compaction in coinstatsindex\n\nThe coinstatsindex ends up using a lot of 55kb files if this is not the case. This is likely related to very fast writes occurring during sync.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml/vhQVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNdBIQAJDkTCVKmQ6LstpwwzpQk5RrJpC7\nVWnR/n1UQRfYmqid9WOHCecQUQfGpAu89hhzSjQ0r2rhlCxwgA1uXoEhCZ0P+Y1l\nWPoHF3Y090O0fH4ytxB81fWelD02Z59QN3D2tguFVCjJD+HFHQjSPKeAP7ksYRzq\nQjeLkVrgRPOec7uBgnabzhHiFsDpPwL1PAwu7I2bd5+RKcQzwamEzG02UQYuO17u\n6ADoH1+f1klwyfoJXVS0xAMtFUeDKl560r2NslDJCWAFP+bQzPWtshONcujNm8sm\n0J2mpvxDSxkgW7WrylFAAPrPIED2zoI6R8mqMixnNRZhN6c6apbSh1hZLvrqme0Y\nupUW69B2/AoannEcNQ0RwXjFBUTIJVOAeWqDZYnVM7fzlhUv/ENY6VE3DmpFMTws\nUbQEBvEDlGBaPwAtE8WAf0gSvloB7xXrPn4599KYjrw87Ai+pczHyRmrfchyaRLb\nqqJr4ySWTRl50wyr72YIuKFO0AINmfTDTqLU2RexZMbD/4HQ3aHvGQ1u095XMuCS\n51oaFGRpECFx9bAkL+CHnbvThPk63E18mOdXLSIYv+w8EekqvAcbJ0q1oK5jnsJy\nF101ZAy/7SvLUivQ+cFnFcPuVzUMwnLdhSWS0Ys/2DOKscleEkJGcBWIj/nkqSSQ\nFAFbq0E9D1m+2EoC\n=qnZZ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8fd285b24feee369dd357d6fa898c390101ce0ee",
          "sha": "8fd285b24feee369dd357d6fa898c390101ce0ee",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8fd285b24feee369dd357d6fa898c390101ce0ee"
        }
      ],
      "message": "index: Force database compaction in coinstatsindex\n\nThe coinstatsindex ends up using a lot of 55kb files if this is not the case. This is likely related to very fast writes occurring during sync.",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-02-01T20:56:52Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-09-08T13:10:29Z"
      },
      "sha": "cb7f981018a843196062f86aab806cb446f58fd8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22448713049,
      "node_id": "HRFPE_lADOABII587JsnzQzwAAAAU6DC1Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22448713049",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "cb7f981018a843196062f86aab806cb446f58fd8",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/cb7f981018a843196062f86aab806cb446f58fd8",
      "created_at": "2026-02-01T21:13:08Z"
    },
    {
      "event": "commented",
      "id": 3832075622,
      "node_id": "IC_kwDOABII587kaNVm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3832075622",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T21:25:41Z",
      "updated_at": "2026-02-01T21:25:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "I am giving this another chance to receive some concept acks and see if the pain is big enough to add a fix.\r\n\r\nAddressed comments by @l0rinc and particularly only compact once upon completion of sync. This required adding a hook for this to the base index but it's still a very minimal change.\r\n\r\nThere is still virtually zero performance impact from this change. I synced the `coinstatsindex` on signet on my machine and at some point there were 2500 of these 55kb files there, after compaction it was reduced to 4 files. That compaction process took less than a second (I didn't have more granular logging in place).",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832075622",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "mentioned",
      "id": 22448861007,
      "node_id": "MEE_lADOABII587JsnzQzwAAAAU6Dm9P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22448861007",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T21:25:42Z"
    },
    {
      "event": "subscribed",
      "id": 22448861019,
      "node_id": "SE_lADOABII587JsnzQzwAAAAU6Dm9b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22448861019",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T21:25:42Z"
    },
    {
      "event": "commented",
      "id": 3832167483,
      "node_id": "IC_kwDOABII587kajw7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3832167483",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T22:26:43Z",
      "updated_at": "2026-02-01T22:50:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "~Approach NACK~\r\n<!--meta-tag:bot-skip-->\r\n\r\nI think we're just treating the symptoms here, the problem is that we write in batches of a single element - the solution would be to batch the writes instead of writing the one-by-one and compacting, please see my comments:\r\n>  We seem to be writing each entry separately to LevelDB in a single-value batch and fsync-ing immediately? Could use some kind of batching like we do with the UTXO set? https://github.com/bitcoin/bitcoin/blob/e419b0e17f8acfe577c35c62a8a71a19aad249f3/src/txdb.cpp#L94 and `TxIndex::CustomAppend` and `BaseIndex::Commit` already write in batches - wouldn't that fix the coinstatsindex small files better than doing compactions manually (it should also be a lot faster)",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832167483",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "commented",
      "id": 3832185726,
      "node_id": "IC_kwDOABII587kaoN-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3832185726",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T22:38:17Z",
      "updated_at": "2026-02-01T22:38:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "> the problem is that we write in batches of a single element\r\n\r\nHow can this be the problem when we do the exact same thing in BlockFilterIndex and we don't see the problem there? The problem is the write speed of coinstatsindex.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832185726",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "commented",
      "id": 3832206226,
      "node_id": "IC_kwDOABII587katOS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3832206226",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T22:51:54Z",
      "updated_at": "2026-02-01T22:51:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "> exact same thing in BlockFilterIndex and we don't see the problem there\r\n\r\nI will investigate if you don't think it works, I remembered that I have tried it before - removed the nack in the meantime",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832206226",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    },
    {
      "event": "unlabeled",
      "id": 22449796810,
      "node_id": "UNLE_lADOABII587JsnzQzwAAAAU6HLbK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22449796810",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T22:54:11Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3832258602,
      "node_id": "IC_kwDOABII587ka6Aq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3832258602",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T23:22:09Z",
      "updated_at": "2026-02-02T00:01:38Z",
      "author_association": "MEMBER",
      "body": "The second commit of #26966 already allows us to process batches of blocks (5eaf553d047aa720924c05b2fb8580fe744d940f). It includes some extra code because I implemented it with parallelization in mind, not just batching. But it shouldnâ€™t take me much effort to decouple it (if needed). Happy to reduce the size of that PR too.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#issuecomment-3832258602",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33306"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323203417",
      "pull_request_review_id": 3186768456,
      "id": 2323203417,
      "node_id": "PRRC_kwDOABII586KeUVZ",
      "diff_hunk": "@@ -348,6 +348,11 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+void CDBWrapper::CompactFull() const",
      "path": "src/dbwrapper.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "could you please separate the low risk changes from the riskier ones? This extraction seems like a simple refactor, would be great to see this in a very simple first commit, so that we can focus on the new call in `src/index/coinstatsindex.cpp`",
      "created_at": "2025-09-04T19:03:44Z",
      "updated_at": "2025-09-04T19:14:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2323203417",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323203417"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 351,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323209517",
      "pull_request_review_id": 3186768456,
      "id": 2323209517,
      "node_id": "PRRC_kwDOABII586KeV0t",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "as other have also mentioned, compaction is already a background process, it is triggered regularly, it should already take care of these as far as I can tell.\r\nIs it urgent to do the expensive compaction regularly? Doing more compactions should take more time overall, can you please share your benchmarks in this regard?",
      "created_at": "2025-09-04T19:06:10Z",
      "updated_at": "2025-09-04T19:14:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2323209517",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323209517"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323214015",
      "pull_request_review_id": 3186768456,
      "id": 2323214015,
      "node_id": "PRRC_kwDOABII586KeW6_",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.\n+    if (block.height % 10000 == 0) {\n+        LogInfo(\"Compacting database of coinstatsindex\");",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "shouldn't this be a debug? Do we need 91 instances of this?\r\n(haven't checked, but will this be triggered for genesis?)",
      "created_at": "2025-09-04T19:08:06Z",
      "updated_at": "2025-09-04T19:14:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2323214015",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323214015"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323218302",
      "pull_request_review_id": 3186768456,
      "id": 2323218302,
      "node_id": "PRRC_kwDOABII586KeX9-",
      "diff_hunk": "@@ -284,6 +284,8 @@ class CDBWrapper\n         ssKey2 << key_end;\n         return EstimateSizeImpl(ssKey1, ssKey2);\n     }\n+\n+    void CompactFull() const;",
      "path": "src/dbwrapper.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "is `const` the right thing to advertise here? And is it a `noexcept`?",
      "created_at": "2025-09-04T19:09:49Z",
      "updated_at": "2025-09-04T19:14:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2323218302",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323218302"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323228522",
      "pull_request_review_id": 3186768456,
      "id": 2323228522,
      "node_id": "PRRC_kwDOABII586Keadq",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.\n+    if (block.height % 10000 == 0) {",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: to avoid counting the `0`s manually:\r\n```C++\r\nif (block.height % 10'000 == 0) {\r\n```\r\nor\r\n```C++\r\nif (!(block.height % 10'000)) {\r\n```\r\n",
      "created_at": "2025-09-04T19:13:38Z",
      "updated_at": "2025-09-04T19:14:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2323228522",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2323228522"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 230,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330441916",
      "pull_request_review_id": 3196821988,
      "id": 2330441916,
      "node_id": "PRRC_kwDOABII586K57i8",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.\n+    if (block.height % 10000 == 0) {",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323228522,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-09-08T14:31:27Z",
      "updated_at": "2025-09-08T14:31:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330441916",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330441916"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 230,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442142",
      "pull_request_review_id": 3196822327,
      "id": 2330442142,
      "node_id": "PRRC_kwDOABII586K57me",
      "diff_hunk": "@@ -284,6 +284,8 @@ class CDBWrapper\n         ssKey2 << key_end;\n         return EstimateSizeImpl(ssKey1, ssKey2);\n     }\n+\n+    void CompactFull() const;",
      "path": "src/dbwrapper.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323218302,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It doesn't modify the data but the storage on disk but since there are changes I think you are right and this shouldn't be `const`. I don't think it's `noexcept` because we are doing stuff on disk there are a lot issues that could come from that.",
      "created_at": "2025-09-08T14:31:32Z",
      "updated_at": "2025-09-08T14:31:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330442142",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442142"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442363",
      "pull_request_review_id": 3196822708,
      "id": 2330442363,
      "node_id": "PRRC_kwDOABII586K57p7",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.\n+    if (block.height % 10000 == 0) {\n+        LogInfo(\"Compacting database of coinstatsindex\");",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323214015,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I am pretty indifferent, so making it debug. I had to add a new category since none of the existing seemed to fit.",
      "created_at": "2025-09-08T14:31:37Z",
      "updated_at": "2025-09-08T14:31:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330442363",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442363"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442716",
      "pull_request_review_id": 3196823394,
      "id": 2330442716,
      "node_id": "PRRC_kwDOABII586K57vc",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323209517,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "As I and others have mentioned (see the linked PR), this doesn't work for coinstatsindex and we end up with hundreds of 55kb files that seem to stay around forever or until we trigger a full compaction manually.\r\n\r\nBenchmarking didn't seem to make sense to me because the compaction completes almost infinitely so comparing two runs with compaction and without may not have given a result that gives an accurate answer. But I figured if I time the runtime of each compaction to the millisecond and then add them up that gives me a good indicator for how much time the compaction takes. I have been using Signet for this test and the individual runtimes of the compactions range from 12ms to 220ms. Overall the time for the coinstatsindex to sync (time between thread start and thread exit messages) took 5 minutes and 6 seconds. The cummulative time spend on compaction during that sync was 1,367ms. So the performance impact was making full sync of the index ~0.45% slower.\r\n\r\nHere is the patch I used for this: https://github.com/fjahr/bitcoin/commit/817990e515c1b64de59b2838c91032069651da5d In case you want to reproduce the result.",
      "created_at": "2025-09-08T14:31:44Z",
      "updated_at": "2025-09-08T14:33:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330442716",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330442716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330443068",
      "pull_request_review_id": 3196823899,
      "id": 2330443068,
      "node_id": "PRRC_kwDOABII586K5708",
      "diff_hunk": "@@ -348,6 +348,11 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+void CDBWrapper::CompactFull() const",
      "path": "src/dbwrapper.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323203417,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "DOne",
      "created_at": "2025-09-08T14:31:53Z",
      "updated_at": "2025-09-08T14:31:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330443068",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330443068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 351,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330924479",
      "pull_request_review_id": 3197501516,
      "id": 2330924479,
      "node_id": "PRRC_kwDOABII586K7xW_",
      "diff_hunk": "@@ -94,6 +94,7 @@ namespace BCLog {\n         TXRECONCILIATION = (CategoryMask{1} << 26),\n         SCAN        = (CategoryMask{1} << 27),\n         TXPACKAGES  = (CategoryMask{1} << 28),\n+        INDEX       = (CategoryMask{1} << 29),",
      "path": "src/logging.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "bf99e7fbc678d8625cbc0769d07c0f9a274e4802",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "do you think this is better than using the existing `LEVELDB` category? Seems these categories are in short supply and compaction seems like a LevelDB thing to me.",
      "created_at": "2025-09-08T17:46:48Z",
      "updated_at": "2025-09-09T05:06:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330924479",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330924479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330966568",
      "pull_request_review_id": 3197501516,
      "id": 2330966568,
      "node_id": "PRRC_kwDOABII586K77oo",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323209517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I haven't checked the linked PR in detail (I have to have *some* stopping condition, and I think the PR should explain the important context) but I didn't get the impression until now that we weren't doing any compaction here before, I just thought you meant that \"it's struggling to keep up\".\r\n\r\nHave a few questions here:\r\n* could we rather add this to the other background compaction thread? Do we understand why there's no automatic compaction?\r\n* does it make sense to do the compaction so often? There's a reason that's usually not done for every change, garbage collection is usually a rare event. Wouldn't it suffice to to it once at the very end only? Maybe 10k isn't *that* often, I'll see if there's a way to measure it.\r\n* We're doing a compactionand logging for genesis (height == 0) as well, right? Is it deliberate?\r\n* We seem to be writing each entry separately to LevelDB in a single-value batch and fsync-ing immediately? Could use some kind of batching like we do with the UTXO set? https://github.com/bitcoin/bitcoin/blob/e419b0e17f8acfe577c35c62a8a71a19aad249f3/src/txdb.cpp#L94 and `TxIndex::CustomAppend` and `BaseIndex::Commit` already write in batches - wouldn't that fix the coinstatsindex small files better than doing compactions manually (it should also be a lot faster)\r\n\r\nI want to see a global, macro benchmark as well, since the continuous compaction most likely slows it down - but I haven't worked with this area of the code yet so it may take a while for me to set it up\r\n\r\n---\r\n\r\nHere's what I did to benchmark the performance of only the indexing - created 3 commits:\r\n* One without any compaction, representing the before state: https://github.com/l0rinc/bitcoin/commit/abab616a2ba4701816c582dab24593f3f8200b0a\r\n* One with compaction at every single block to see how much time it really takes: https://github.com/l0rinc/bitcoin/commit/7d3fa1c8e99828751187b13fb1e2de11052c6215\r\n* Compaction at 10'000 blocks, as suggested in the PR: https://github.com/l0rinc/bitcoin/commit/62d3ad137f70803b210623c51ea3b8a20996b39b\r\n* One which only does the compaction at the very end or since that's simpler, every 100k blocks: https://github.com/l0rinc/bitcoin/commit/7779473a6e2f3b9fa5b8b97800e29d6fb3299aad.\r\n\r\nFor simplicity the application terminates after the indexes are successfully created and we're measuring the time it took to iterate and index them.\r\n\r\nI've started the application with `-connect=0 -coinstatsindex=1` to show the progress without any additional activity for stability and measure the output folder's size and number of files.\r\n\r\n<details>\r\n<summary>bash script comparing the 4 commits</summary>\r\n\r\n```bash\r\nCOMMITS=\"62d3ad137f70803b210623c51ea3b8a20996b39b 7779473a6e2f3b9fa5b8b97800e29d6fb3299aad abab616a2ba4701816c582dab24593f3f8200b0a 7d3fa1c8e99828751187b13fb1e2de11052c6215\";\\\r\nDATA_DIR=\"/mnt/my_storage/BitcoinData\";\\\r\nfor COMMIT in $COMMITS; do\\\r\n    killall bitcoind 2>&1; rm -rf \"$DATA_DIR/indexes\" \"$DATA_DIR/debug.log\" &&\\\r\n    git fetch -q origin \"$COMMIT\" >/dev/null 2>&1 || true && git checkout -q \"$COMMIT\" && git log -1 --pretty='%h %s' \"$COMMIT\" &&\\\r\n    cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release >/dev/null 2>&1 && ninja -C build >/dev/null 2>&1 &&\\\r\n    ./build/bin/bitcoind -datadir=\"$DATA_DIR\" -connect=0 -coinstatsindex=1 -printtoconsole=0 2>&1;\\\r\n    grep 'Indexing finished migrating' \"$DATA_DIR/debug.log\";\\\r\n    du -h \"$DATA_DIR/indexes/coinstatsindex/db\";\\\r\n    find \"$DATA_DIR/indexes/coinstatsindex/db\" -type f -name '*.ldb' | wc -l;\\\r\ndone\r\n```\r\n\r\n</details>\r\n\r\nIt seems the indexing takes several hours, I'll post the result here after it finishes\r\nEdit:\r\n* `no compaction`: 33869s, 211MB, 112 files\r\n* `compact at every 10k blocks`: 33998s, 211MB, 16 files\r\n* `compact at every 100k blocks`: 34055s, 211M, 36 files\r\n* `compact at every block`: 56403s, 301M, 131 files (seems suspicious)",
      "created_at": "2025-09-08T18:05:57Z",
      "updated_at": "2025-09-11T15:15:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2330966568",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2330966568"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2331873098",
      "pull_request_review_id": 3197501516,
      "id": 2331873098,
      "node_id": "PRRC_kwDOABII586K_Y9K",
      "diff_hunk": "@@ -348,6 +348,11 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+void CDBWrapper::CompactFull()\n+{\n+    DBContext().pdb->CompactRange(nullptr, nullptr);",
      "path": "src/dbwrapper.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: since we're touching it:\n```suggestion\n    DBContext().pdb->CompactRange(/*begin=*/nullptr, /*end=*/nullptr);\n```",
      "created_at": "2025-09-09T02:58:08Z",
      "updated_at": "2025-09-09T05:06:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2331873098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2331873098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 353,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2338351098",
      "pull_request_review_id": 3208444066,
      "id": 2338351098,
      "node_id": "PRRC_kwDOABII586LYGf6",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323209517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Instead of the current single-entry LevelDB batching (creating a batch, serializing the `DBHeightKey` and `std::pair<uint256, DBVal>` and writing the batch, containing a single entry), I have extracted the `CDBBatch` outside of the loops and committing and writing *that* regularly, see https://github.com/l0rinc/bitcoin/pull/37/files for a draft (I will need to break into commits and maybe adjust some tests if needed).\r\n\r\nI will run a follow-up benchmark to see how well this performs, since the original 9.5 hours sync time is (with or without compaction) is at least an order of magnitude slower than I expected it to be.\r\n\r\nI expect this to solve the the small-file fragmentation issue as well - will get back on both.\r\nEdit:\r\n* `indexes: batch index writes`: 34188s, 211M, 8 files\r\n\r\nIt solved the fragmentation, but didn't speed up anything.\r\nI still think this is a better direction than adding manual compactions.",
      "created_at": "2025-09-11T02:31:00Z",
      "updated_at": "2025-09-12T03:13:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2338351098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2338351098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751965291",
      "pull_request_review_id": 3736654438,
      "id": 2751965291,
      "node_id": "PRRC_kwDOABII586kB6hr",
      "diff_hunk": "@@ -348,6 +348,11 @@ bool CDBWrapper::IsEmpty()\n     return !(it->Valid());\n }\n \n+void CDBWrapper::CompactFull()\n+{\n+    DBContext().pdb->CompactRange(nullptr, nullptr);",
      "path": "src/dbwrapper.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "in_reply_to_id": 2331873098,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-02-01T21:13:19Z",
      "updated_at": "2026-02-01T21:13:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2751965291",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751965291"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 353,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751965789",
      "pull_request_review_id": 3736654919,
      "id": 2751965789,
      "node_id": "PRRC_kwDOABII586kB6pd",
      "diff_hunk": "@@ -94,6 +94,7 @@ namespace BCLog {\n         TXRECONCILIATION = (CategoryMask{1} << 26),\n         SCAN        = (CategoryMask{1} << 27),\n         TXPACKAGES  = (CategoryMask{1} << 28),\n+        INDEX       = (CategoryMask{1} << 29),",
      "path": "src/logging.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "bf99e7fbc678d8625cbc0769d07c0f9a274e4802",
      "in_reply_to_id": 2330924479,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ok, I was thinking an `INDEX` category would be useful anyway, but I am using the `LEVELDB` one now and dropped the commit adding the new category.",
      "created_at": "2026-02-01T21:13:56Z",
      "updated_at": "2026-02-01T21:13:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2751965789",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751965789"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751969423",
      "pull_request_review_id": 3736658886,
      "id": 2751969423,
      "node_id": "PRRC_kwDOABII586kB7iP",
      "diff_hunk": "@@ -224,6 +224,14 @@ bool CoinStatsIndex::CustomAppend(const interfaces::BlockInfo& block)\n     m_muhash.Finalize(out);\n     value.second.muhash = out;\n \n+    // Force compaction of the database from time to time since LevelDB doesn't\n+    // seem to be handling this well itself at the speed coinstats index is\n+    // syncing.",
      "path": "src/index/coinstatsindex.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "7bc77c5c378318db625b3937b8ddc4a7c1faa299",
      "original_commit_id": "62d3806127d06df1d91e58af1dbf30b6ce1e7b8c",
      "in_reply_to_id": 2323209517,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> could we rather add this to the other background compaction thread? Do we understand why there's no automatic compaction?\r\n\r\nI am not aware of a compaction thread that we control, can you elaborate what you mean? And no, as I have tried to explain there seems to be no easy answer but the evidence points to the fact that LEVELDB can not keep up at a certain write speed.\r\n\r\n> does it make sense to do the compaction so often? There's a reason that's usually not done for every change, garbage collection is usually a rare event. Wouldn't it suffice to to it once at the very end only? Maybe 10k isn't that often, I'll see if there's a way to measure it.\r\n\r\nI had thought about doing it once at the end of sync and I am doing this now in the latest push. Just necessitates a hook to be added for this.\r\n\r\n> Instead of the current single-entry LevelDB batching (creating a batch, serializing the DBHeightKey and std::pair<uint256, DBVal> and writing the batch, containing a single entry), I have extracted the CDBBatch outside of the loops and committing and writing that regularly,\r\n\r\nSeems like a pretty big refactor and IMO not worth it only for the issue that we are dealing with here, given the edge cases and inconsistencies we have fixed in index over last few years.",
      "created_at": "2026-02-01T21:16:25Z",
      "updated_at": "2026-02-01T21:16:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33306#discussion_r2751969423",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751969423"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33306"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    }
  ]
}
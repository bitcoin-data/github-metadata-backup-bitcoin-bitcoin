{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532",
    "id": 2524620285,
    "node_id": "PR_kwDOABII586WeqX9",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32532",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32532.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32532.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/bde1fc1289443785e4538c757631d2fa19d5ecd8",
    "number": 32532,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "script: short-circuit `GetLegacySigOpCount` for known scripts",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "### Summary\r\n\r\nFor the vast majority of scripts we encounter, the sig-op count can be deduced directly from their fixed-length template (e.g. P2PKH, P2SH, P2WPKH, P2WSH, P2TR â€¦), without iterating the script manually.\r\n\r\n### Context\r\n\r\nWhile profiling the remaining **SwiftSync** bottlenecks, I saw that [Own Samples](https://youtrack.jetbrains.com/issue/CPP-30003) highlighted `GetSigOpCount` as a non-negligible slice of validation time.\r\nTest coverage for this code path was also thin, and 3 recent PRs touched the same area (https://github.com/bitcoin/bitcoin/pull/31624 and https://github.com/bitcoin/bitcoin/pull/32521 and https://github.com/bitcoin/bitcoin/pull/32533) highlighting the need for better code coverage and additional optimizations.\r\n\r\n### Fix\r\n\r\n* return early for known templates;\r\n* for all other scripts parse opcodes in-place and reuse computed values;\r\n* `DecodePushData()` factorises the common `PUSHDATA` length/bounds reads and error checks.\r\n\r\n### Testing\r\n\r\n* added unit tests covering every standard script type (and a historical `OP_RETURN â€¦ OP_CHECKSIG` oddity);\r\n* added fuzz-style test that compares the refactored implementation against the *exact* legacy algorithm on random scripts - also ran it continuously for 25 hours without divergence;\r\n* reindexed to height 897,000 [comparing the outputs of the old and the new implementation](https://gist.github.com/l0rinc/ff6347164b3c502a9643ba7be171860e) without incidents.\r\n\r\n### Performance\r\n\r\nI have added a dedicated benchmark for the `GetSigOpCount` function, measuring the sigop calculations of block 413,567.\r\nSince this is still pre-segwit, I've done most optimization decisions with [block 784,588](https://mempool.space/block/784588) instead (see https://github.com/bitcoin/bitcoin/pull/32457), which reveals a **2.3x** speedup:\r\n\r\n> Before:\r\n\r\n|           ns/sigops |            sigops/s |    err% |      ins/sigops |      cyc/sigops |    IPC |     bra/sigops |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|              139.57 |        7,164,906.66 |    0.0% |        1,260.77 |          501.15 |  2.516 |         252.46 |    1.2% |     11.00 | `SigOpsBlockBench`\r\n\r\n> After:\r\n\r\n|           ns/sigops |            sigops/s |    err% |      ins/sigops |      cyc/sigops |    IPC |     bra/sigops |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|               58.43 |       17,115,813.09 |    0.1% |          354.20 |          209.79 |  1.688 |          89.46 |    2.8% |     10.83 | `SigOpsBlockBench`\r\n\r\nAlso, together with https://github.com/bitcoin/bitcoin/pull/31682 measured on a slimmed down `CheckBlock` benchmark (without serialization, which is optimized separately) it achieves ~43.7% validation speedup for the given block. On its own this results in a ~11.4% validation speed-up thanks to short-circuit SigOp counting ",
    "labels": [
      {
        "id": 192202000,
        "node_id": "MDU6TGFiZWwxOTIyMDIwMDA=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus",
        "name": "Consensus",
        "color": "009800",
        "default": false
      }
    ],
    "created_at": "2025-05-16T13:59:35Z",
    "updated_at": "2025-05-19T15:08:31Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "53c708890c2191850991846aae81ce681d1daa32",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/short-circuit-known-script-types",
      "ref": "l0rinc/short-circuit-known-script-types",
      "sha": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 261986,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-19T15:00:44Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-05-18T21:06:38Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "7710a31f0cb69a04529f39840196826d0b9770ab",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37245,
        "stargazers_count": 83657,
        "watchers_count": 83657,
        "size": 282139,
        "default_branch": "master",
        "open_issues_count": 741,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-19T10:56:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-05-19T15:55:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 450,
    "deletions": 165,
    "changed_files": 16,
    "commits": 7,
    "review_comments": 10,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2886809136,
      "node_id": "IC_kwDOABII586sETYw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2886809136",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-16T13:59:39Z",
      "updated_at": "2025-05-19T14:30:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32532.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [tapcrafter](https://github.com/bitcoin/bitcoin/pull/32532#pullrequestreview-2849025458), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/32532#pullrequestreview-2850988140) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32521](https://github.com/bitcoin/bitcoin/pull/32521) (policy: make pathological transactions packed with legacy sigops non-standard by darosior)\n* [#31989](https://github.com/bitcoin/bitcoin/pull/31989) (BIP-119 (OP_CHECKTEMPLATEVERIFY) (regtest only) by jamesob)\n* [#31682](https://github.com/bitcoin/bitcoin/pull/31682) ([IBD] specialize CheckBlock's input & coinbase checks by l0rinc)\n* [#31622](https://github.com/bitcoin/bitcoin/pull/31622) (psbt: add non-default sighash types to PSBTs and unify sighash type match checking by achow101)\n* [#29675](https://github.com/bitcoin/bitcoin/pull/29675) (wallet: Be able to receive and spend inputs involving MuSig2 aggregate keys by achow101)\n* [#29060](https://github.com/bitcoin/bitcoin/pull/29060) (Policy: Report reason inputs are non standard by ismaelsadeeq)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#issuecomment-2886809136",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17695141109,
      "node_id": "HRFPE_lADOABII58627qjKzwAAAAQetmz1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17695141109",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "432ff7e736942c6dd6fc923300b5fa5f0f94c287",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/432ff7e736942c6dd6fc923300b5fa5f0f94c287",
      "created_at": "2025-05-16T22:37:44Z"
    },
    {
      "event": "reviewed",
      "id": 2849025458,
      "node_id": "PRR_kwDOABII586p0K2y",
      "url": null,
      "actor": null,
      "commit_id": "432ff7e736942c6dd6fc923300b5fa5f0f94c287",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "Concept ACK 432ff7e736942c6dd6fc923300b5fa5f0f94c287.\r\n\r\nCan't fully speak to the correctness of the refactor itself, still brushing up on my C++. So can't give a full ACK but left some questions instead.\r\n\r\n<details>\r\n\r\n<summay>Test protocol</summary>\r\n\r\nNew benchmark test on 2e8a9e17 (first commit of PR, before refactor):\r\n\r\n```\r\n|           ns/sigops |            sigops/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               50.76 |       19,700,534.44 |    0.5% |      0.01 | `SigOpsBlockBench`\r\n```\r\n\r\n\r\nOn 432ff7e736942c6dd6fc923300b5fa5f0f94c287 (last commit):\r\n\r\n```\r\n|           ns/sigops |            sigops/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               18.87 |       53,002,534.31 |    0.4% |      0.01 | `SigOpsBlockBench`\r\n```\r\n\r\nI also ran the unit tests a couple of times to excercise the randomized tests in `src/test/sigopcount_tests.cpp`.\r\nNo failures to report.\r\n\r\n</details>",
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#pullrequestreview-2849025458",
      "submitted_at": "2025-05-18T18:45:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
    },
    {
      "event": "commented",
      "id": 2889730573,
      "node_id": "IC_kwDOABII586sPcoN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2889730573",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T06:08:19Z",
      "updated_at": "2025-05-19T06:08:19Z",
      "author_association": "MEMBER",
      "body": "I can't tell from the pull description, but is there a end-user visible performance difference? If yes, how much?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#issuecomment-2889730573",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY3NTFlMDMyNTcyYzM5YzU1MmQ0YjExNDJkZTYzOGI5YThiZjE0Y2E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f751e032572c39c552d4b1142de638b9a8bf14ca",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f751e032572c39c552d4b1142de638b9a8bf14ca",
      "tree": {
        "sha": "88ab9b6d7f624469fff59a7b07ddb5f6d324d8db",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/88ab9b6d7f624469fff59a7b07ddb5f6d324d8db"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c461d1528758df8a38b4c2c18b98591e1de8c9c0",
          "sha": "c461d1528758df8a38b4c2c18b98591e1de8c9c0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c461d1528758df8a38b4c2c18b98591e1de8c9c0"
        }
      ],
      "message": "bench: measure `CheckBlock` speed separately from serialization",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T08:47:32Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-01-18T10:43:26Z"
      },
      "sha": "f751e032572c39c552d4b1142de638b9a8bf14ca"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg1NDA2YmQwY2VmODhkOTMxMzgzMGFlNzA5ZTFhM2E2YTk0ZGFiZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/85406bd0cef88d9313830ae709e1a3a6a94dabed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/85406bd0cef88d9313830ae709e1a3a6a94dabed",
      "tree": {
        "sha": "952e983a9ccf6dc64250bd560822f7e4585a06aa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/952e983a9ccf6dc64250bd560822f7e4585a06aa"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f751e032572c39c552d4b1142de638b9a8bf14ca",
          "sha": "f751e032572c39c552d4b1142de638b9a8bf14ca",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f751e032572c39c552d4b1142de638b9a8bf14ca"
        }
      ],
      "message": "bench: measure `SigOpsBlock` speeds separately",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T08:47:32Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-01-18T10:43:26Z"
      },
      "sha": "85406bd0cef88d9313830ae709e1a3a6a94dabed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZiMzU5YjZiMjY0OGEzY2I4M2VhZTMyOTg2OTUxYjRjNTEyNGQyNGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6b359b6b2648a3cb83eae32986951b4c5124d24b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6b359b6b2648a3cb83eae32986951b4c5124d24b",
      "tree": {
        "sha": "f37a1680296c9d8a3ee263e0a0bd2083a3dd8b1b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f37a1680296c9d8a3ee263e0a0bd2083a3dd8b1b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/85406bd0cef88d9313830ae709e1a3a6a94dabed",
          "sha": "85406bd0cef88d9313830ae709e1a3a6a94dabed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/85406bd0cef88d9313830ae709e1a3a6a94dabed"
        }
      ],
      "message": "refactor: rename `GetSigOpCount` to `GetLegacySigOpCount`\n\nAlso added primitive argument name reminder to the call sites to highlight the meaning of the call.",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T08:50:37Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-14T14:05:05Z"
      },
      "sha": "6b359b6b2648a3cb83eae32986951b4c5124d24b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZlZWU3YjZhNjk0YzJmMDU0ZWVlNDk5ZDY3Y2Y1MTYwNWQxYjQ5Mzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6eee7b6a694c2f054eee499d67cf51605d1b4939",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6eee7b6a694c2f054eee499d67cf51605d1b4939",
      "tree": {
        "sha": "e178b24a6804a5a833e810ce28df6d913a7ba7a9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e178b24a6804a5a833e810ce28df6d913a7ba7a9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6b359b6b2648a3cb83eae32986951b4c5124d24b",
          "sha": "6b359b6b2648a3cb83eae32986951b4c5124d24b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6b359b6b2648a3cb83eae32986951b4c5124d24b"
        }
      ],
      "message": "refactor: add extra-fast checks for all standard script types\n\nThe usages in `compressor.cpp` and `solver.cpp` were also updated to use the new methods.\nTo be able to use previously defined constants here as well, instead of adding a dependency on `interpreter.h`, I've moved the script-hash-size constants to `script.h`. There are no other constants with the same names.\n\nCo-authored-by: TapCrafter <tapcrafter@proton.me>",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T09:12:37Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-16T13:17:36Z"
      },
      "sha": "6eee7b6a694c2f054eee499d67cf51605d1b4939"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFlZmEyOTUwY2Q3MWQzNGNiZjEzNjFjOTQ0YWQ1MGFjMWNkNjJiZjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aefa2950cd71d34cbf1361c944ad50ac1cd62bf5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aefa2950cd71d34cbf1361c944ad50ac1cd62bf5",
      "tree": {
        "sha": "291b670258d25ae548f94192d5b7422150cef2ae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/291b670258d25ae548f94192d5b7422150cef2ae"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6eee7b6a694c2f054eee499d67cf51605d1b4939",
          "sha": "6eee7b6a694c2f054eee499d67cf51605d1b4939",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6eee7b6a694c2f054eee499d67cf51605d1b4939"
        }
      ],
      "message": "test: add `SigOpCount` edgeâ€‘cases & knownâ€‘template coverage\n\n* `GetLegacySigOpCountErrors` feeds malformed PUSHDATA sequences to confirm the parser never crashes and still counts sigâ€‘ops that appear before the error.\n* `GetLegacySigOpCountStandardScripts` asserts the expected legacy/accurate sigâ€‘op totals for all common known script templates (P2PKH, P2SH, P2WPKH/WSH, P2TR, compressed & uncompressed P2PK, OP_RETURN, multisig).",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T09:12:39Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-14T14:41:02Z"
      },
      "sha": "aefa2950cd71d34cbf1361c944ad50ac1cd62bf5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA0YzNlMDAyODM3N2MzM2MyZWM1ZmNjZmRhODM4NGY4ZjM2YjNlYjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/04c3e0028377c33c2ec5fccfda8384f8f36b3eb6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/04c3e0028377c33c2ec5fccfda8384f8f36b3eb6",
      "tree": {
        "sha": "4a6d190810bbec9228fe5a39e6a847b454d90fb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4a6d190810bbec9228fe5a39e6a847b454d90fb9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aefa2950cd71d34cbf1361c944ad50ac1cd62bf5",
          "sha": "aefa2950cd71d34cbf1361c944ad50ac1cd62bf5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aefa2950cd71d34cbf1361c944ad50ac1cd62bf5"
        }
      ],
      "message": "refactor: extract `DecodePushData` from GetScriptOp\n\nIntroduce helper `DecodePushData` that parses the size prefixes, checks bounds, and returns size_bytes & data_bytes - or error on truncation.\n\nTo make absolutely sure it's just a refactor, a new unit test was added which asserts the refactored `GetLegacySigOpCount` exactly matches the previous algorithm.",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T09:12:39Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-14T16:36:22Z"
      },
      "sha": "04c3e0028377c33c2ec5fccfda8384f8f36b3eb6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJkZTFmYzEyODk0NDM3ODVlNDUzOGM3NTc2MzFkMmZhMTlkNWVjZDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "tree": {
        "sha": "714017ffde40871657d341f729e63379d8d2c369",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/714017ffde40871657d341f729e63379d8d2c369"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/04c3e0028377c33c2ec5fccfda8384f8f36b3eb6",
          "sha": "04c3e0028377c33c2ec5fccfda8384f8f36b3eb6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/04c3e0028377c33c2ec5fccfda8384f8f36b3eb6"
        }
      ],
      "message": "script: short-circuit `GetLegacySigOpCount` for known scripts\n\n> build/bin/bench_bitcoin -filter='SigOpsBlockBench' --min-time=1000\n\n|           ns/sigops |            sigops/s |    err% |      ins/sigops |      cyc/sigops |    IPC |     bra/sigops |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|               58.43 |       17,115,813.09 |    0.1% |          354.20 |          209.79 |  1.688 |          89.46 |    2.8% |     10.83 | `SigOpsBlockBench`",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-19T09:12:39Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-05T12:27:16Z"
      },
      "sha": "bde1fc1289443785e4538c757631d2fa19d5ecd8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17711015624,
      "node_id": "HRFPE_lADOABII58627qjKzwAAAAQfqKbI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17711015624",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "created_at": "2025-05-19T09:19:01Z"
    },
    {
      "event": "commented",
      "id": 2890294507,
      "node_id": "IC_kwDOABII586sRmTr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2890294507",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:25:40Z",
      "updated_at": "2025-05-19T09:25:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the observations @tapcrafter, addressed your concerns in the latest push, adding you as a co-author in one of the commits.\r\n\r\n@maflcko, to clarify the effect on the overall behavior, I slimmed down the `DeserializeAndCheckBlockTest` similarly to https://github.com/bitcoin/bitcoin/pull/32457 and added the results to the PR's description.\r\n\r\n---\r\n\r\nI ran\r\n\r\n```bash\r\ncmake -B build -DBUILD_BENCH=ON -DCMAKE_BUILD_TYPE=Release\r\ncmake --build build -j$(nproc)\r\nbuild/bin/bench_bitcoin -filter='CheckBlockBench' --min-time=10000\r\n```\r\nseveral times before and after the SigOp fast-path.\r\n\r\nTo isolate the remaining hot-spots I also:\r\n* split the former `DeserializeAndCheckBlockTest` into a pureâ€serialization (optimized independetly) and a pure `CheckBlock` benchmark;\r\n* switched to block 784,588 (contains every modern script type) - see https://github.com/bitcoin/bitcoin/pull/32457;\r\n* included another related optimization (special-cases the coinbase & duplicate-input checks - https://github.com/bitcoin/bitcoin/pull/31682).\r\n\r\nBefore (ef73758d5bd0ef32749d2cefc475bb84e4e6d11e - bench: measure behavior of a more representative block):\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,077,514.54 |              928.06 |    0.0% |    8,231,717.91 |    3,867,061.18 |  2.129 |   1,234,943.74 |    2.5% |     11.00 | `CheckBlockBench`\r\n|        1,077,039.60 |              928.47 |    0.1% |    8,231,717.76 |    3,865,853.67 |  2.129 |   1,234,943.80 |    2.5% |     11.01 | `CheckBlockBench`\r\n|        1,077,973.36 |              927.67 |    0.1% |    8,231,717.62 |    3,869,437.50 |  2.127 |   1,234,943.75 |    2.5% |     11.01 | `CheckBlockBench`\r\n```\r\n\r\nBefore (9d719108bef902590aa55bf61f979dbcfa152020 - specialize CheckBlock's input & coinbase checks):\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|          836,899.54 |            1,194.89 |    0.1% |    6,618,933.87 |    3,003,330.32 |  2.204 |     847,006.84 |    2.4% |     10.77 | `CheckBlockBench`\r\n|          838,135.14 |            1,193.13 |    0.0% |    6,618,933.87 |    3,008,503.94 |  2.200 |     847,006.84 |    2.4% |     10.78 | `CheckBlockBench`\r\n|          835,303.73 |            1,197.17 |    0.1% |    6,618,933.87 |    2,997,539.89 |  2.208 |     847,006.84 |    2.4% |     10.77 | `CheckBlockBench`\r\n```\r\n\r\nAfter (ddc82fdb6fae77ba299104ed03c33ea9dd0e2e05 - script: short-circuit `GetLegacySigOpCount` for known scripts):\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|          753,774.48 |            1,326.66 |    0.0% |    5,224,278.78 |    2,705,172.05 |  1.931 |     597,353.76 |    3.4% |     10.70 | `CheckBlockBench`\r\n|          753,337.59 |            1,327.43 |    0.0% |    5,224,278.78 |    2,704,108.71 |  1.932 |     597,353.76 |    3.4% |     10.70 | `CheckBlockBench`\r\n|          749,374.04 |            1,334.45 |    0.0% |    5,224,278.78 |    2,690,235.39 |  1.942 |     597,353.75 |    3.4% |     10.69 | `CheckBlockBench`\r\n```\r\n\r\n~11.4% additional validation speed-up thanks to short-circuit SigOp counting (the two changes together result in a ~43.7% validation speedup for the given block).\r\nNote that instruction count also dropped from 6,6M to 5.2M, branch executions from 0.8M to 0.6M.\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#issuecomment-2890294507",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532"
    },
    {
      "event": "mentioned",
      "id": 17711133799,
      "node_id": "MEE_lADOABII58627qjKzwAAAAQfqnRn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17711133799",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:25:41Z"
    },
    {
      "event": "subscribed",
      "id": 17711133844,
      "node_id": "SE_lADOABII58627qjKzwAAAAQfqnSU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17711133844",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:25:41Z"
    },
    {
      "event": "mentioned",
      "id": 17711133873,
      "node_id": "MEE_lADOABII58627qjKzwAAAAQfqnSx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17711133873",
      "actor": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:25:41Z"
    },
    {
      "event": "subscribed",
      "id": 17711133888,
      "node_id": "SE_lADOABII58627qjKzwAAAAQfqnTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17711133888",
      "actor": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:25:41Z"
    },
    {
      "event": "commented",
      "id": 2890357028,
      "node_id": "IC_kwDOABII586sR1kk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2890357028",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:41:57Z",
      "updated_at": "2025-05-19T09:41:57Z",
      "author_association": "MEMBER",
      "body": "Ah, ok. So from extrapolating the previous comment and https://github.com/bitcoin/bitcoin/pull/31682#issuecomment-2606765689, the IBD speedup should be around 1%?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#issuecomment-2890357028",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32532"
    },
    {
      "event": "reviewed",
      "id": 2850988140,
      "node_id": "PRR_kwDOABII586p7qBs",
      "url": null,
      "actor": null,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK bde1fc1289443785e4538c757631d2fa19d5ecd8. Seems like this makes code clearer and faster without changing complexity, and adds tests.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#pullrequestreview-2850988140",
      "submitted_at": "2025-05-19T14:30:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
    },
    {
      "event": "renamed",
      "id": 17717091425,
      "node_id": "RTE_lADOABII58627qjKzwAAAAQgBVxh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17717091425",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T15:08:13Z",
      "rename": {
        "from": "RFC: script: short-circuit `GetLegacySigOpCount` for known scripts",
        "to": "script: short-circuit `GetLegacySigOpCount` for known scripts"
      }
    },
    {
      "event": "labeled",
      "id": 17717092503,
      "node_id": "LE_lADOABII58627qjKzwAAAAQgBWCX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17717092503",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T15:08:17Z",
      "label": {
        "name": "Consensus",
        "color": "009800"
      }
    },
    {
      "event": "ready_for_review",
      "id": 17717097104,
      "node_id": "RFRE_lADOABII58627qjKzwAAAAQgBXKQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17717097104",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T15:08:31Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094559241",
      "pull_request_review_id": 2849025458,
      "id": 2094559241,
      "node_id": "PRRC_kwDOABII58582HAJ",
      "diff_hunk": "@@ -30,17 +30,16 @@ BOOST_FIXTURE_TEST_SUITE(sigopcount_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(GetSigOpCount)\n {\n-    // Test CScript::GetSigOpCount()\n     CScript s1;\n-    BOOST_CHECK_EQUAL(s1.GetSigOpCount(false), 0U);\n-    BOOST_CHECK_EQUAL(s1.GetSigOpCount(true), 0U);\n+    BOOST_CHECK_EQUAL(s1.GetLegacySigOpCount(/*fAccurate=*/false), 0U);",
      "path": "src/test/sigopcount_tests.cpp",
      "position": 173,
      "original_position": 8,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "3248d025cc66e367aba0e00c122926fe694d8dc1",
      "in_reply_to_id": null,
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Should the test case (`BOOST_AUTO_TEST_CASE(GetSigOpCount)`) also be renamed?",
      "created_at": "2025-05-18T15:32:50Z",
      "updated_at": "2025-05-18T18:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2094559241",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094559241"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 190,
      "original_line": 190,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094560461",
      "pull_request_review_id": 2849025458,
      "id": 2094560461,
      "node_id": "PRRC_kwDOABII58582HTN",
      "diff_hunk": "@@ -1501,7 +1501,7 @@ def test_spenders(self, node, spenders, input_counts):\n                     tx.vout[-1].nValue = random.randint(DUST_LIMIT, in_value)\n                 in_value -= tx.vout[-1].nValue\n                 tx.vout[-1].scriptPubKey = random.choice(host_spks)\n-                sigops_weight += CScript(tx.vout[-1].scriptPubKey).GetSigOpCount(False) * WITNESS_SCALE_FACTOR\n+                sigops_weight += CScript(tx.vout[-1].scriptPubKey).GetLegacySigOpCount(False) * WITNESS_SCALE_FACTOR",
      "path": "test/functional/feature_taproot.py",
      "position": null,
      "original_position": 5,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "3248d025cc66e367aba0e00c122926fe694d8dc1",
      "in_reply_to_id": null,
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can we add `fAccurate=False` here?",
      "created_at": "2025-05-18T15:39:23Z",
      "updated_at": "2025-05-18T18:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2094560461",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094560461"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094593425",
      "pull_request_review_id": 2849025458,
      "id": 2094593425,
      "node_id": "PRRC_kwDOABII58582PWR",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&",
      "path": "src/script/script.h",
      "position": null,
      "original_position": 19,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": null,
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Not sure if we can include `interpreter.h` here, but if yes, we could use `WITNESS_V0_KEYHASH_SIZE`. And the other constants too, for extra clarity (`WITNESS_V0_SCRIPTHASH_SIZE = 32`, `WITNESS_V1_TAPROOT_SIZE = 32`).",
      "created_at": "2025-05-18T18:17:21Z",
      "updated_at": "2025-05-18T18:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2094593425",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094593425"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 561,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094594352",
      "pull_request_review_id": 2849025458,
      "id": 2094594352,
      "node_id": "PRRC_kwDOABII58582Pkw",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&\n+               (*this)[23] == OP_EQUALVERIFY &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsPayToScriptHash() const noexcept\n+    {\n+        return size() == 23 &&\n+               front() == OP_HASH160 &&\n+               (*this)[1] == 0x14 &&\n+               back() == OP_EQUAL;\n+    }\n+\n+    bool IsPayToWitnessPubKeyHash() const noexcept\n+    {\n+        return size() == 22 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x14;\n+    }\n+\n+    bool IsPayToTaproot() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_1 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsPayToWitnessScriptHash() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsCompressedPayToPubKey() const noexcept",
      "path": "src/script/script.h",
      "position": 87,
      "original_position": 53,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": null,
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Looks like this check omits the `&& (script[1] == 0x02 || script[1] == 0x03)` part that was in the original `IsToPubKey` function. Not sure if this is on purpose?",
      "created_at": "2025-05-18T18:21:58Z",
      "updated_at": "2025-05-18T18:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2094594352",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094594352"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 606,
      "original_line": 606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094594388",
      "pull_request_review_id": 2849025458,
      "id": 2094594388,
      "node_id": "PRRC_kwDOABII58582PlU",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&\n+               (*this)[23] == OP_EQUALVERIFY &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsPayToScriptHash() const noexcept\n+    {\n+        return size() == 23 &&\n+               front() == OP_HASH160 &&\n+               (*this)[1] == 0x14 &&\n+               back() == OP_EQUAL;\n+    }\n+\n+    bool IsPayToWitnessPubKeyHash() const noexcept\n+    {\n+        return size() == 22 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x14;\n+    }\n+\n+    bool IsPayToTaproot() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_1 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsPayToWitnessScriptHash() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsCompressedPayToPubKey() const noexcept\n+    {\n+        return size() == CPubKey::COMPRESSED_SIZE + 2 &&\n+               front() == CPubKey::COMPRESSED_SIZE &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsUncompressedPayToPubKey() const noexcept",
      "path": "src/script/script.h",
      "position": 94,
      "original_position": 60,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": null,
      "user": {
        "login": "tapcrafter",
        "id": 207358173,
        "node_id": "U_kgDODFwI3Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/207358173?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tapcrafter",
        "html_url": "https://github.com/tapcrafter",
        "followers_url": "https://api.github.com/users/tapcrafter/followers",
        "following_url": "https://api.github.com/users/tapcrafter/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/tapcrafter/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/tapcrafter/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/tapcrafter/subscriptions",
        "organizations_url": "https://api.github.com/users/tapcrafter/orgs",
        "repos_url": "https://api.github.com/users/tapcrafter/repos",
        "events_url": "https://api.github.com/users/tapcrafter/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/tapcrafter/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Same here, the original had the additional condition `&& script[1] == 0x04`.",
      "created_at": "2025-05-18T18:22:12Z",
      "updated_at": "2025-05-18T18:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2094594388",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2094594388"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 613,
      "original_line": 613,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258063",
      "pull_request_review_id": 2850050345,
      "id": 2095258063,
      "node_id": "PRRC_kwDOABII58584xnP",
      "diff_hunk": "@@ -30,17 +30,16 @@ BOOST_FIXTURE_TEST_SUITE(sigopcount_tests, BasicTestingSetup)\n \n BOOST_AUTO_TEST_CASE(GetSigOpCount)\n {\n-    // Test CScript::GetSigOpCount()\n     CScript s1;\n-    BOOST_CHECK_EQUAL(s1.GetSigOpCount(false), 0U);\n-    BOOST_CHECK_EQUAL(s1.GetSigOpCount(true), 0U);\n+    BOOST_CHECK_EQUAL(s1.GetLegacySigOpCount(/*fAccurate=*/false), 0U);",
      "path": "src/test/sigopcount_tests.cpp",
      "position": 173,
      "original_position": 8,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "3248d025cc66e367aba0e00c122926fe694d8dc1",
      "in_reply_to_id": 2094559241,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It exercises both `GetSigOpCount` and `GetLegacySigOpCount`, so I kept it.\r\nBut the new tests can indeed be renamed, thanks!",
      "created_at": "2025-05-19T09:19:01Z",
      "updated_at": "2025-05-19T09:19:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2095258063",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258063"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 190,
      "original_line": 190,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258155",
      "pull_request_review_id": 2850050500,
      "id": 2095258155,
      "node_id": "PRRC_kwDOABII58584xor",
      "diff_hunk": "@@ -1501,7 +1501,7 @@ def test_spenders(self, node, spenders, input_counts):\n                     tx.vout[-1].nValue = random.randint(DUST_LIMIT, in_value)\n                 in_value -= tx.vout[-1].nValue\n                 tx.vout[-1].scriptPubKey = random.choice(host_spks)\n-                sigops_weight += CScript(tx.vout[-1].scriptPubKey).GetSigOpCount(False) * WITNESS_SCALE_FACTOR\n+                sigops_weight += CScript(tx.vout[-1].scriptPubKey).GetLegacySigOpCount(False) * WITNESS_SCALE_FACTOR",
      "path": "test/functional/feature_taproot.py",
      "position": null,
      "original_position": 5,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "3248d025cc66e367aba0e00c122926fe694d8dc1",
      "in_reply_to_id": 2094560461,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Indeed, added, thanks.",
      "created_at": "2025-05-19T09:19:04Z",
      "updated_at": "2025-05-19T09:19:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2095258155",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258155"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258344",
      "pull_request_review_id": 2850050808,
      "id": 2095258344,
      "node_id": "PRRC_kwDOABII58584xro",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&",
      "path": "src/script/script.h",
      "position": null,
      "original_position": 19,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": 2094593425,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I have tried including `interpreter.h` before, but it results in ugly weird compiler mess.\r\nBut it seems we can move those constant over to `script.h` instead - done, added you as a co-author.",
      "created_at": "2025-05-19T09:19:10Z",
      "updated_at": "2025-05-19T09:19:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2095258344",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258344"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 561,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258456",
      "pull_request_review_id": 2850050969,
      "id": 2095258456,
      "node_id": "PRRC_kwDOABII58584xtY",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&\n+               (*this)[23] == OP_EQUALVERIFY &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsPayToScriptHash() const noexcept\n+    {\n+        return size() == 23 &&\n+               front() == OP_HASH160 &&\n+               (*this)[1] == 0x14 &&\n+               back() == OP_EQUAL;\n+    }\n+\n+    bool IsPayToWitnessPubKeyHash() const noexcept\n+    {\n+        return size() == 22 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x14;\n+    }\n+\n+    bool IsPayToTaproot() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_1 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsPayToWitnessScriptHash() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsCompressedPayToPubKey() const noexcept",
      "path": "src/script/script.h",
      "position": 87,
      "original_position": 53,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": 2094594352,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I took these definitions from `solver.cpp` - the point here is not necessarily to fully validate the internal structure of the script templates, but rather to check if it follows a general template's layout (opcode, followed by a version, followed by a hash, etc). Validating the existing versions is done in other places, it's not important for e.g. SigOp count. If you think I'm mistaken here, please let me know.",
      "created_at": "2025-05-19T09:19:13Z",
      "updated_at": "2025-05-19T09:19:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2095258456",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 606,
      "original_line": 606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258535",
      "pull_request_review_id": 2850051137,
      "id": 2095258535,
      "node_id": "PRRC_kwDOABII58584xun",
      "diff_hunk": "@@ -552,8 +553,59 @@ class CScript : public CScriptBase\n      */\n     static bool IsPayToAnchor(int version, const std::vector<unsigned char>& program);\n \n-    bool IsPayToScriptHash() const;\n-    bool IsPayToWitnessScriptHash() const;\n+    bool IsPayToPubKeyHash() const noexcept\n+    {\n+        return size() == 25 &&\n+               front() == OP_DUP &&\n+               (*this)[1] == OP_HASH160 &&\n+               (*this)[2] == 0x14 &&\n+               (*this)[23] == OP_EQUALVERIFY &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsPayToScriptHash() const noexcept\n+    {\n+        return size() == 23 &&\n+               front() == OP_HASH160 &&\n+               (*this)[1] == 0x14 &&\n+               back() == OP_EQUAL;\n+    }\n+\n+    bool IsPayToWitnessPubKeyHash() const noexcept\n+    {\n+        return size() == 22 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x14;\n+    }\n+\n+    bool IsPayToTaproot() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_1 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsPayToWitnessScriptHash() const noexcept\n+    {\n+        return size() == 34 &&\n+               front() == OP_0 &&\n+               (*this)[1] == 0x20;\n+    }\n+\n+    bool IsCompressedPayToPubKey() const noexcept\n+    {\n+        return size() == CPubKey::COMPRESSED_SIZE + 2 &&\n+               front() == CPubKey::COMPRESSED_SIZE &&\n+               back() == OP_CHECKSIG;\n+    }\n+\n+    bool IsUncompressedPayToPubKey() const noexcept",
      "path": "src/script/script.h",
      "position": 94,
      "original_position": 60,
      "commit_id": "bde1fc1289443785e4538c757631d2fa19d5ecd8",
      "original_commit_id": "fcc418de426f32e8c366c182950d4acbb9e7556b",
      "in_reply_to_id": 2094594388,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This wasn't checked in `MatchPayToPubkey` either.",
      "created_at": "2025-05-19T09:19:17Z",
      "updated_at": "2025-05-19T09:19:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32532#discussion_r2095258535",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2095258535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32532"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 613,
      "original_line": 613,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018",
    "id": 2679273445,
    "node_id": "PR_kwDOABII586fsnfl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33018",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33018.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33018.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/ca035174a3920edbae279663580f193d1ae5ea3e",
    "number": 33018,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove SetFresh method from CCoinsCacheEntry",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "There is plenty of test code that exercises the code path for FRESH-but-not-DIRTY coins in CCoinsViewCache. However, we can see there is only one place in production code where we call `SetFresh` that is not preceded by `SetDirty`. This is in `CCoinsViewCache::FetchCoin` and we can see that this is called if the coin retrieved from `base->GetCoin` is spent. The `base` in this case can be another `CCoinsViewCache` or a `CCoinsViewDB`. In `CCoinsViewCache::GetCoin` we can see that we do not return spent coins, and in `CCoinsViewDB` we don't ever store spent coins so there are none to return.\r\n\r\nThus, we can safely remove this dead code, and now we can see that there are never any calls to `SetFresh` not preceded by `SetDirty`. This PR removes this dead code and replaces `SetFresh` by passing a `fresh` boolean flag to `SetDirty`. This simplifies the logic of `CCoinsViewCache` and lets us remove test cases checking for FRESH-but-not-DIRTY coins. It removes the possibility of FRESH-but-not-DIRTY coins being called from any code path, so we can eliminate this state entirely and reduce the cognitive load of having to consider it.\r\n\r\nThis is pulled out from https://github.com/bitcoin/bitcoin/pull/30673 to make the change simpler.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-07-19T19:21:35Z",
    "updated_at": "2026-01-04T19:08:03Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "d08dd73afbbbbb5d328dfec21cb56ed7f88bad66",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:remove-setfresh",
      "ref": "remove-setfresh",
      "sha": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 294264,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-04T19:54:38Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2025-11-13T15:07:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "bd4f4782f23b59f8ddd608e1b5a3690e134f2a0e",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38574,
        "stargazers_count": 87521,
        "watchers_count": 87521,
        "size": 301129,
        "default_branch": "master",
        "open_issues_count": 738,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-04T16:22:45Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-04T19:29:46Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 86,
    "deletions": 122,
    "changed_files": 6,
    "commits": 7,
    "review_comments": 56,
    "comments": 6
  },
  "events": [
    {
      "event": "labeled",
      "id": 18712832524,
      "node_id": "LE_lADOABII587Bc6GezwAAAARbXyoM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18712832524",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:38Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3092526814,
      "node_id": "IC_kwDOABII5864VDbe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3092526814",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:39Z",
      "updated_at": "2026-01-04T02:08:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33018.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101), [sedited](https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3558493235) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33512](https://github.com/bitcoin/bitcoin/pull/33512) (coins: use number of dirty cache entries in flush warnings/logs by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3092526814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18717562758,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbp1eG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18717562758",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "created_at": "2025-07-20T18:17:13Z"
    },
    {
      "event": "reviewed",
      "id": 3036128101,
      "node_id": "PRR_kwDOABII586096Nl",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-07-20T19:20:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nVery glad this is getting cleanup up, I found it worrying that a lot of tests were exercising invalid states in the first place - not the best foundation.\r\nQuickly went over the changes, I find the small commits and excellent commit messages easy to follow.\r\nI'll run a full IBD over this (maybe with some extra `SanityCheck` sprinkled around for extra measure) to make sure real usage doesn't trigger any invalid states we're not aware of.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101",
      "submitted_at": "2025-07-20T19:20:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "reviewed",
      "id": 3036282843,
      "node_id": "PRR_kwDOABII5860-f_b",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-07-21T01:11:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036282843",
      "submitted_at": "2025-07-21T01:11:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18719180874,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbwAhK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719180874",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "created_at": "2025-07-21T01:28:49Z"
    },
    {
      "event": "commented",
      "id": 3095031799,
      "node_id": "IC_kwDOABII5864em_3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3095031799",
      "actor": {
        "login": "Lalaweazel",
        "id": 180723578,
        "node_id": "U_kgDOCsWfeg",
        "avatar_url": "https://avatars.githubusercontent.com/u/180723578?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Lalaweazel",
        "html_url": "https://github.com/Lalaweazel",
        "followers_url": "https://api.github.com/users/Lalaweazel/followers",
        "following_url": "https://api.github.com/users/Lalaweazel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Lalaweazel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Lalaweazel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Lalaweazel/subscriptions",
        "organizations_url": "https://api.github.com/users/Lalaweazel/orgs",
        "repos_url": "https://api.github.com/users/Lalaweazel/repos",
        "events_url": "https://api.github.com/users/Lalaweazel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Lalaweazel/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:06:34Z",
      "updated_at": "2025-07-21T02:21:13Z",
      "author_association": "NONE",
      "body": "' DQ at need  f cc 2iooo9 to be in work iiiiiiii iroieeieeieowwiereo W e\r\n\r\nOn Mon, 21 July 2025, 12:02 pm Andrew Toth, ***@***.***>\r\nwrote:\r\n\r\n> ***@***.**** commented on this pull request.\r\n> ------------------------------\r\n>\r\n> In src/coins.h\r\n> <https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867>:\r\n>\r\n> >   * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\r\n>   */\r\n>  struct CCoinsCacheEntry\r\n>  {\r\n>  private:\r\n>      /**\r\n>       * These are used to create a doubly linked list of flagged entries.\r\n> -     * They are set in SetDirty, SetFresh, and unset in SetClean.\r\n> -     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\r\n> +     * They are set in SetDirty and unset in SetClean.\r\n> +     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.\r\n>\r\n> Done.\r\n>\r\n> â€”\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/BLCZ66TZ63CTQEG3FDJLXXD3JRC23AVCNFSM6AAAAACB46C4HCVHI2DSMVQWIX3LMV43YUDVNRWFEZLROVSXG5CSMV3GSZLXHMZTAMZWGMZDKOBZGM>\r\n> .\r\n> You are receiving this because you are subscribed to this thread.Message\r\n> ID: ***@***.***>\r\n>\r\n",
      "user": {
        "login": "Lalaweazel",
        "id": 180723578,
        "node_id": "U_kgDOCsWfeg",
        "avatar_url": "https://avatars.githubusercontent.com/u/180723578?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Lalaweazel",
        "html_url": "https://github.com/Lalaweazel",
        "followers_url": "https://api.github.com/users/Lalaweazel/followers",
        "following_url": "https://api.github.com/users/Lalaweazel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Lalaweazel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Lalaweazel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Lalaweazel/subscriptions",
        "organizations_url": "https://api.github.com/users/Lalaweazel/orgs",
        "repos_url": "https://api.github.com/users/Lalaweazel/repos",
        "events_url": "https://api.github.com/users/Lalaweazel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Lalaweazel/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3095031799",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18719537063,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbxXen",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719537063",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/99b243d53e7ca3e824369e7e194981d814c04708",
      "created_at": "2025-07-21T02:21:13Z"
    },
    {
      "event": "labeled",
      "id": 18719538269,
      "node_id": "LE_lADOABII587Bc6GezwAAAARbxXxd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719538269",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:21:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3095048145,
      "node_id": "IC_kwDOABII5864eq_R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3095048145",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:21:26Z",
      "updated_at": "2025-07-21T02:21:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `CentOS, depends, gui`: https://github.com/bitcoin/bitcoin/runs/46353382966</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failure is caused by an assertion failure in coins.cpp during the coins_tests, leading to subprocess abortion.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3095048145",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "unlabeled",
      "id": 18721406277,
      "node_id": "UNLE_lADOABII587Bc6GezwAAAARb4f1F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18721406277",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T06:04:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 20300507169,
      "node_id": "LE_lADOABII587Bc6GezwAAAAS6ASgh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20300507169",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-15T16:28:46Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20307550458,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAAS6bKD6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20307550458",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/98698b45d53f92603ada14689f377df3df973893",
      "created_at": "2025-10-16T00:34:16Z"
    },
    {
      "event": "unlabeled",
      "id": 20307825723,
      "node_id": "UNLE_lADOABII587Bc6GezwAAAAS6cNQ7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20307825723",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-16T01:10:27Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3558493235,
      "node_id": "PRR_kwDOABII587UGkwz",
      "url": null,
      "actor": null,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-09T17:41:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3558493235",
      "submitted_at": "2025-12-09T17:41:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "reviewed",
      "id": 3563616983,
      "node_id": "PRR_kwDOABII587UaHrX",
      "url": null,
      "actor": null,
      "commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-10T17:07:33Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3563616983",
      "submitted_at": "2025-12-10T17:07:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "reviewed",
      "id": 3563622065,
      "node_id": "PRR_kwDOABII587UaI6x",
      "url": null,
      "actor": null,
      "commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-10T17:10:41Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3563622065",
      "submitted_at": "2025-12-10T17:10:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21492857248,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAAUBEvmg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21492857248",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8cc8458f623cef190dc4d82c3de7317b0872244f",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8cc8458f623cef190dc4d82c3de7317b0872244f",
      "created_at": "2025-12-11T02:13:51Z"
    },
    {
      "event": "commented",
      "id": 3647464529,
      "node_id": "IC_kwDOABII587ZZ-RR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3647464529",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T17:25:38Z",
      "updated_at": "2025-12-12T17:25:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "@sedited @l0rinc thank you both for your reviews! I rebased and updated with your suggestions.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3647464529",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "mentioned",
      "id": 21532988084,
      "node_id": "MEE_lADOABII587Bc6GezwAAAAUDd1K0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21532988084",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T17:25:39Z"
    },
    {
      "event": "subscribed",
      "id": 21532988103,
      "node_id": "SE_lADOABII587Bc6GezwAAAAUDd1LH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21532988103",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T17:25:40Z"
    },
    {
      "event": "mentioned",
      "id": 21532988129,
      "node_id": "MEE_lADOABII587Bc6GezwAAAAUDd1Lh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21532988129",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T17:25:40Z"
    },
    {
      "event": "subscribed",
      "id": 21532988154,
      "node_id": "SE_lADOABII587Bc6GezwAAAAUDd1L6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21532988154",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T17:25:40Z"
    },
    {
      "event": "labeled",
      "id": 21628380679,
      "node_id": "LE_lADOABII587Bc6GezwAAAAUJJuYH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21628380679",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-17T21:51:45Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMxNWUwYmMyNWFlY2E3ODRlNGEwYTk3MzgwMWNiYmVjZGYxZDViODI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c15e0bc25aeca784e4a0a973801cbbecdf1d5b82",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c15e0bc25aeca784e4a0a973801cbbecdf1d5b82",
      "tree": {
        "sha": "3ad28f1a6ddd42249c46764fec017809a2b0bd8b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3ad28f1a6ddd42249c46764fec017809a2b0bd8b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3ad28f1a6ddd42249c46764fec017809a2b0bd8b\nparent 7f295e1d9b44c225c823242c1f04239f46fb27a6\nauthor Andrew Toth <andrewstoth@gmail.com> 1752949714 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1766244970 -0500\n\ntest: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlGwmsACgkQYAB6/Ik4\nsBjo5g/9FozSEawNb1qyrQGvR8f5uODo9/+z+UMUghIah7ZhCVNNAyC1NFpkOZ3O\n0NU4PuGUKn/RH30q6YfrKfrUkKWbmfe8pLty3DD9ctpY4Nic2coChm5MIZ4Wemo+\ntXNnu7xgNLLnOudRYrkc9dgkxAruLmBLeu6irOSSGO9CLXNtSTHLYOYy6E9vjFXA\nhauMX8AxjUNKkN4c17f+hD6pyAD4+lm5Va+Pg2DgZNJDWpq32zgRcLGZHpCW+g2Z\ndad4b9vhozmoivM1Oi4ltRQHA4kxx8ZKaVuoBmscvQxTVurbSZJ7qBfTiM8qATHN\n47zmBsW2y7a/Xn3g1XrDbqtt3i9yOVuOrKsRUPTcIF/b694B9coZSQDQQeSl4DiZ\nF9fPvf+BVJ9ufuHi1ZaJqJfT61v4pkljMMb9aEUBFt2XCgznp7FCswCd1xrNexcY\nKyb7/uw7HJs3958WQ/mVj0Q65c2gk6MfoIujL5BywysbxHn8/iTa0D0lDz3GzvZd\nHl0nkH7eQyRq8gLlU84yBXd7h6+vOXh9L2Im1iBqKsqjYZEHWz080ZuaAK+w42U8\nkJ3lrO00KRlrfwZf8qpECU+NkNaTyweW0Ec6Ppsa2FPemEbYFApmlKX6D1w3rdhN\nM30aO+RBMakTRCfKKWKXV+AIPz1/w25rpiEeXQxw8HOe+RkDfFo=\n=uRsO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7f295e1d9b44c225c823242c1f04239f46fb27a6",
          "sha": "7f295e1d9b44c225c823242c1f04239f46fb27a6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7f295e1d9b44c225c823242c1f04239f46fb27a6"
        }
      ],
      "message": "test: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-20T15:36:10Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-19T18:28:34Z"
      },
      "sha": "c15e0bc25aeca784e4a0a973801cbbecdf1d5b82"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU3ZDkzZTlkNzdhMmJmOGRlOGY5MTQzNzZhOWNiN2NmZGQ2NDdhNzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76",
      "tree": {
        "sha": "0d09cad105e30f6cf57e68d9b0ad2fe6d24e96bb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0d09cad105e30f6cf57e68d9b0ad2fe6d24e96bb"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0d09cad105e30f6cf57e68d9b0ad2fe6d24e96bb\nparent c15e0bc25aeca784e4a0a973801cbbecdf1d5b82\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033832 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1766244972 -0500\n\ncoins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlGwmwACgkQYAB6/Ik4\nsBilTBAArryty0ZlhDHM40QojTSZmqBBc02hznGpikV9xaKmDRgRvLAfK0mTbW+5\njkumiC2TRPawYTPpCFaoNZ/yeEA3ZzSl/WZ7g6CV434b33WJXnbxK3ucCIowdujo\n3vfMHS9C/jO5CICz5yz9a5Ybxn6GtPxrHtRCytMDiyD4/hI06Ca5u2JgVRqRmpmr\n0uEAmFxxF7fi2BkTdxnKkQzBHHxFLL8XIx/bIcoUJOPrwkZsid/7t7wjEWj2Dmlj\n5IAP/4RInSUPudeCV7ROHmncFVC9Tui0f48lTyUV4O25zoPPyQ6YmC7zOKbMM1KC\nDapo3Uey/RhgQTSLL1tOYWMYZsIsS2obImwanXes80ogB47xEI4+qx3n8Z/uBe78\n2Fa/9v/JqMwuOTmGlxPLR0/BKp9YwNV39f6fM7hjYhVZEUWn2AE3y7idi22VkfMs\nYOTwyYIlrBP8liUMEmsM8T5KnPn6wOdK0tdNCjZdQN3JT3p/avKKUr4OFbdFApYF\nQquONWefXP9giFMd3jT3nCfKt8chCGiu+z7ZA68S/atJgpFd/NiMb+rxlcWRfVbu\nWY1c7e/0XTusjHU6W5rUvn8hnRCpNaq1UllXNgkAekbLFVFTHjrb831o0c0im/gN\ncmlWolMWBXifDnFOYt978MhloB+r5uFWugsHUcaHMAM9wfBGNoc=\n=7Mqx\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c15e0bc25aeca784e4a0a973801cbbecdf1d5b82",
          "sha": "c15e0bc25aeca784e4a0a973801cbbecdf1d5b82",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c15e0bc25aeca784e4a0a973801cbbecdf1d5b82"
        }
      ],
      "message": "coins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-20T15:36:12Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:50:32Z"
      },
      "sha": "e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE2YzgzZTJjNzkyZTU5Yjk4NDcyZTBmOGVkMTYwZTBkZjgwOGQ1MTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/16c83e2c792e59b98472e0f8ed160e0df808d516",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/16c83e2c792e59b98472e0f8ed160e0df808d516",
      "tree": {
        "sha": "ebf5705ab97a5ae5ca5fe49b4afa9fe9c4fb8620",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ebf5705ab97a5ae5ca5fe49b4afa9fe9c4fb8620"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ebf5705ab97a5ae5ca5fe49b4afa9fe9c4fb8620\nparent e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033959 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1766244972 -0500\n\ntest: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlGwmwACgkQYAB6/Ik4\nsBjNhRAApHEjGfuMPUdL9D/sQPIauG46KZUoaFj3ea+mp2x2mtnnyLmvY8O8JWhZ\ndx5KUwJETwLneZEczDVTIeBIBGAIzq2yrFHmx7806zmPctAfyECLIOM1e8lmg0K7\n07psWqStJvTH1scm1Vlcc+eKSU0Fvp6yNIMhvF+5Z/gJG6MprE2JlSsooYn6qi/A\n9Y0h32ESALGSyCeQKncyF3FZte2BuL1USZyXitfv1haCz0ZVJsF2v4wvESizq5t/\n4okHDkP8CmOmVZdCipL8ArzIkbg/nZd+3kkOgqEqV2zaiUafIk9V7Q14dqhJbYM0\n/mvFFXoTC/lMruerfdK3aI0DFiHzTLa418VxkkjHQQewFFe8Gn9WTVYL23f6ESq5\n1IGPjx1PQDAGcYaEItHmua+fXpDGkYbpHXTijthfEY44I1WxMTDBawNb46c4fDjD\nR2CnQLvnkDfVv8pdYEilUaJXPGt+E61sSM0hPYT2WPxKfMit11rZsQoCEgVk4KkW\nzYmQg8xiS2ZJ9wWoCTTdrDBGAC9oAqBm2y9bJwjrWjpocR81hrJ4hXBN+ml8ugyl\nx94njHxLS3cWnQWtQ49uHM7sfFpI6suWZU297DWbAuLzJWI9TEswt7pC0ZlXlxTD\nAeCFgCAdH7Xos1Ld3a0vJZgHSCKpcwknVAJ3MCj1dOHrnZ3Qruw=\n=mPHV\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76",
          "sha": "e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e7d93e9d77a2bf8de8f914376a9cb7cfdd647a76"
        }
      ],
      "message": "test: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-20T15:36:12Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:52:39Z"
      },
      "sha": "16c83e2c792e59b98472e0f8ed160e0df808d516"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAyNzZlNDkzMGI1OGRlYTM1YmZjZWM5YTM0NGM5YTFkYTAyMDY1MGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0276e4930b58dea35bfcec9a344c9a1da020650d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0276e4930b58dea35bfcec9a344c9a1da020650d",
      "tree": {
        "sha": "2875581df878240fc46b9ca8ff8969906248ec9c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2875581df878240fc46b9ca8ff8969906248ec9c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2875581df878240fc46b9ca8ff8969906248ec9c\nparent 16c83e2c792e59b98472e0f8ed160e0df808d516\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034147 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1766244972 -0500\n\ntest: assert no FRESH-but-not-DIRTY coins can occur\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlGwmwACgkQYAB6/Ik4\nsBiQRhAAtRfOUAhs/Z3telCXQEGWA4nLSoYktc3kNwoTssBuD1/y65WAolK82UPV\nu7OFTWR4xy+fr8yoV49gmzZPJMq28KYyXVN8nQfbx1B36fFeOeA0rVoIRLXATbuV\nXGquq5pJOxIcIOdc9OryAwiKntyNPJcNw57FWSGVrv9BNsquN5B+Szt2RAsAy+RE\nh9teQAvkhme4HrFRi905n1VFNM0R1QvKuEPRl00EGNbUNaMiLPGEDswwGQZztlWS\n+LcUVPwuDy/6RZUahPraVEdNVgNgqzxK+Lb1cbfq2YI6jVgtZ5rUMw+Am84YH/oa\nNyqSNaxqL/lUlR0fUMUgwZP1WommaXV7rbQPmZVXl6U2qeHAHHKTeKbFqCzUty8b\nZsxaEq46z13jCwjhtjnVBjUv9EP0PoDGRpHO2Mp7oXEyD0Bt9Vv3NLKGdX1DtZsp\nvXeuOQiocHQHJnU2UgTNCN09MbM3X//e2cRAC2do09nJF8QTbr/XkYv+6pLX/A4o\nLY15B3OazGj4nq5aRxdAxZ7cgZv9RLfu5vTXItRTykCYZOV1ptBVPxM0YsPWPIyZ\nFth2yUye4EqozX3J7yCwyMUtBGqQ23WrB+Klm4rx6OUqTYadaZkN/VdrtW0YYgBK\n0et0Ls9pDxXz5pmxTMVYDtjuWl+zc0tc9r6rg4fPp453RUL0KQE=\n=J7lD\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/16c83e2c792e59b98472e0f8ed160e0df808d516",
          "sha": "16c83e2c792e59b98472e0f8ed160e0df808d516",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/16c83e2c792e59b98472e0f8ed160e0df808d516"
        }
      ],
      "message": "test: assert no FRESH-but-not-DIRTY coins can occur",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-20T15:36:12Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:55:47Z"
      },
      "sha": "0276e4930b58dea35bfcec9a344c9a1da020650d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21685352456,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAAUMjDgI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21685352456",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "created_at": "2025-12-20T15:36:17Z"
    },
    {
      "event": "commented",
      "id": 3677906681,
      "node_id": "IC_kwDOABII587bOGb5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3677906681",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T15:38:38Z",
      "updated_at": "2025-12-20T15:38:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased due to https://github.com/bitcoin/bitcoin/pull/34095 modifying code that is deleted in this change.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3677906681",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "unlabeled",
      "id": 21685487354,
      "node_id": "UNLE_lADOABII587Bc6GezwAAAAUMjkb6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21685487354",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T16:11:22Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3601358966,
      "node_id": "PRR_kwDOABII587WqGB2",
      "url": null,
      "actor": null,
      "commit_id": "e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-20T22:44:25Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3601358966",
      "submitted_at": "2025-12-20T22:44:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21842403049,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAAUV6J7p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21842403049",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "65e673c2013613aa749e92ccbff7a8bfd9632246",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/65e673c2013613aa749e92ccbff7a8bfd9632246",
      "created_at": "2026-01-04T17:21:30Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRiZDliNzhlNTlmYThmNDgwYzU2NzYwMzczNDZmNGU5M2Q0MDY5OWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4bd9b78e59fa8f480c5676037346f4e93d40699c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4bd9b78e59fa8f480c5676037346f4e93d40699c",
      "tree": {
        "sha": "fde65a60fdca6c4f162e012210c4dbe1d5772b33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fde65a60fdca6c4f162e012210c4dbe1d5772b33"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree fde65a60fdca6c4f162e012210c4dbe1d5772b33\nparent 0276e4930b58dea35bfcec9a344c9a1da020650d\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034772 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1767547447 -0500\n\ncoins: remove SetFresh method from CCoinsCacheEntry\n\nThere are no instances where SetFresh is called without being\npreceded by SetDirty. This replaces SetFresh with a boolean flag\npassed to SetDirty to indicate whether the DIRTY coin should also\nbe set to FRESH. This removes the possibility of setting a\nFRESH-but-not-DIRTY cached coin state.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlaojcACgkQYAB6/Ik4\nsBhBSA/8CbbST51ueVj/1HC0mnAWtFgiQHXoRNHBTmaHOMR2gxjFkMTX4nrD1JrE\nBaQU/hKoEgaCRolVZWCp9XAEsW/MytnaBXn4/ydqrMbc4hkZqiQzcrNGV8f31wxS\n5Ei2/MilAEVfi0mPN2FtLum0GHpbYgkh0J07oGq7UlXGdf2m3ZE6SCd5OQRMjFH3\nyzXx6b3z4LHGQYI0TP4/fvFCx/y1TejAmGplANzCm6eZ5QUVw9loI7k2AYM2NZIT\nKvTvcwxXxcz38NR51aRKuwYdKhSImLf5qVqcSvb8Kb9+uLfGnOF6+qwiLKLvPgmF\njGJ2ddA+b3gvZ65f7xSDjcQvEt01VWhIwVQOcERz66T2RmH5sze+rlZ+hmcxWWMO\n5cbzlJYiFVCgdVT6RrUCBkwC4nyo0NQTEfhmgSjHt/I9ErFtrehj9WLtP22QOiBz\nyan7bBYqGX/1dp2lgmGijyrz5vUW9jl6JCeRAUyFiA1cm9q9Jwkc1Vne/mJbU3G6\nFxcbfjCH8CgJY8zcMism+jGjRPbegR0CKb/TJFNDPgTweghcVhKpsLoT0TInzxZY\n/KihvOR3oeQeR26DdsBi8VMWF7tUKbVj5otjxmdtS89ZcsqEZYvt+Nz06yJ8rscA\nMGYHpdckmFaL5fnGSJG+xdLZLflBkCMvsMNdGPXI1Ucs5Vw31bI=\n=f0W0\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0276e4930b58dea35bfcec9a344c9a1da020650d",
          "sha": "0276e4930b58dea35bfcec9a344c9a1da020650d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0276e4930b58dea35bfcec9a344c9a1da020650d"
        }
      ],
      "message": "coins: remove SetFresh method from CCoinsCacheEntry\n\nThere are no instances where SetFresh is called without being\npreceded by SetDirty. This replaces SetFresh with a boolean flag\npassed to SetDirty to indicate whether the DIRTY coin should also\nbe set to FRESH. This removes the possibility of setting a\nFRESH-but-not-DIRTY cached coin state.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-04T17:24:07Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:06:12Z"
      },
      "sha": "4bd9b78e59fa8f480c5676037346f4e93d40699c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNjMmUzYTMxNjliNGIyYjg0NmViNTNjMTA2MWRjZmU4MWVmN2JkZmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff",
      "tree": {
        "sha": "8e271df9a8a18113da5e28dd25b50e99bdebd2c6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8e271df9a8a18113da5e28dd25b50e99bdebd2c6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8e271df9a8a18113da5e28dd25b50e99bdebd2c6\nparent 4bd9b78e59fa8f480c5676037346f4e93d40699c\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034941 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1767547447 -0500\n\ncoins: inline CCoinsViewCache::AddFlags into SetDirty\n\nThere is only one callsite now for AddFlags, so we can inline\nit into SetDirty.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlaojcACgkQYAB6/Ik4\nsBgxFA//YLlTE18g8SYfJDqKlM5RwoIAP6HUStvUey1ZPxURmPp39BXmbrNc6EDm\nI2DvfMfuC33RDQcHYZ38GcykmM/hShC4ET3PdtEhs3/voR+PdRMpcGUxuWWkcTGl\nGNAKVB+6bO+Y/Fd6amSd3Lq3l9h7G3L4gMgJRkN10f3HPn5bCa1QCzh2DutL5Pgk\nmqRzaiF2YBr/WekejX//rOxcnF+cEyoESPsgsr/pY9qXjbPpxbNexmRhuE04uwkL\nGIt0ZY2Gzh3DQxnDTqk2AdBhfkYL55rSE/njh4kH9XBUN5VhXX3+BxU/8lrgbxdC\nV+JOrd8Ufr8hLShHO1AaGGnvBXLILZ9T6UJN1crpH5rmuWOuoseSs7OFQObnedib\nf6NYoB7a6DO2jocsuZttq5BDPr603C14bYFHcmC/GNrZdN5Uwmq8+7H6MXYrmnvK\nW0YBU8PGQlWdKCrWO54jqFt5624aSHFiYG/u5JB7X73F3EZ2cXa8c2n22TTcFSvU\nNw7z+OfUGIvFTidk6AYuroXRqjn3FL3957XGjz+U1LZSAYIHihb/aARsRVdhuj/v\nW0Rj4G2nk7IEp6gVJ+rzG6NMivM4UQZNqBCdA7FttKMyJdaZprvAoyPTus4oPSDu\n769c9HTFFwAEgcYXMbtPP2qULx4pX3y4J8eMHz130HI7RQsLnr4=\n=HuRx\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4bd9b78e59fa8f480c5676037346f4e93d40699c",
          "sha": "4bd9b78e59fa8f480c5676037346f4e93d40699c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4bd9b78e59fa8f480c5676037346f4e93d40699c"
        }
      ],
      "message": "coins: inline CCoinsViewCache::AddFlags into SetDirty\n\nThere is only one callsite now for AddFlags, so we can inline\nit into SetDirty.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-04T17:24:07Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:09:01Z"
      },
      "sha": "3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhMDM1MTc0YTM5MjBlZGJhZTI3OTY2MzU4MGYxOTNkMWFlNWVhM2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca035174a3920edbae279663580f193d1ae5ea3e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca035174a3920edbae279663580f193d1ae5ea3e",
      "tree": {
        "sha": "1acf877ad5ed7b1ee25cfc1ae8218bc14298db87",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1acf877ad5ed7b1ee25cfc1ae8218bc14298db87"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1acf877ad5ed7b1ee25cfc1ae8218bc14298db87\nparent 3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff\nauthor Andrew Toth <andrewstoth@gmail.com> 1765385044 -0500\ncommitter Andrew Toth <andrewstoth@gmail.com> 1767547447 -0500\n\ncoins: replace CCoinsCacheEntry::m_flags the m_fresh boolean\n\nA cache entry is now always DIRTY if it is in the linked list.\nWe can use linked list membership instead of a flag to determine\ndirtiness.\nThus, the only state we need to track is if an entry is FRESH.\nThis can be represented by a simple bool instead of a bitfield.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmlaojcACgkQYAB6/Ik4\nsBhUog/9FHuKiVdT+t81FNLhinkLp7XtChFp4/09X1+NLXp5xRgg28vg0CN8Fnwl\nH0/2XjOdRyMVfuq9F3ARgoA8Fd63arLf9Xrb+cYV+PfYilV6fegPwn7YdhuwQt/g\nv+QjkKanA077WO4U2U5UswVdlTn9XCITUyRMianvAaRnsqmj8esaI73EnNoBKQmf\nCa2rJ888l+1bNAyCh61MeEKzGPoHUDz0ODbziiSjd/P9nAkbwY/ypN4JshWagZAl\n+vIP9Wm92z+eUY+cjnqz4IdZQqOnzTqAfbbeJqTflq+BHrE+F0vlQxpNc2g7vlFC\niuMvV70Pl9y06c5Y6LR1cpEyLbSguM4yY72XLq/GAqjC0MM66oIR3FfVWSwoYC0B\nxXPAbHT8WX9HN3ZG7cafcDypoFhOp6xQW2EBXx/w7Sr+SBQWUz51/wkgvhMj4B+d\na8RfzrGfgvjMAM69VPZb/aeVgnZVdBkA8W9sMKjSkShtXQL6Sxv86/9EJA1uLDul\n0aj1c8k9Iz88gCuJeu4XULqEhu7UeTHNGq6hYiAiA0/STyhSMN/V6HqVGB32R0CJ\n2KDltU18Qh+toMLwzaMgCtZO4495MBOwXCfoG3myzBgdByEmDMyuj2Up6uiAuHZq\nzzGZeU49Tlt/BUEqkqkNh5a2mNyJOnCuTKskvH0V61qKO5CoBb4=\n=XFPX\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff",
          "sha": "3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3c2e3a3169b4b2b846eb53c1061dcfe81ef7bdff"
        }
      ],
      "message": "coins: replace CCoinsCacheEntry::m_flags the m_fresh boolean\n\nA cache entry is now always DIRTY if it is in the linked list.\nWe can use linked list membership instead of a flag to determine\ndirtiness.\nThus, the only state we need to track is if an entry is FRESH.\nThis can be represented by a simple bool instead of a bitfield.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-04T17:24:07Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-10T16:44:04Z"
      },
      "sha": "ca035174a3920edbae279663580f193d1ae5ea3e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21842413640,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAAUV6MhI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21842413640",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/ca035174a3920edbae279663580f193d1ae5ea3e",
      "created_at": "2026-01-04T17:24:12Z"
    },
    {
      "event": "labeled",
      "id": 21842415603,
      "node_id": "LE_lADOABII587Bc6GezwAAAAUV6M_z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21842415603",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-04T17:24:44Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3708270023,
      "node_id": "IC_kwDOABII587dB7XH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3708270023",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-04T17:24:52Z",
      "updated_at": "2026-01-04T17:24:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/20696479226/job/59412536506</sub>\n<sub>LLM reason (âœ¨ experimental): Lint failure due to trailing whitespace detected in src/coins.h (trailing_whitespace check).</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3708270023",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "unlabeled",
      "id": 21842835020,
      "node_id": "UNLE_lADOABII587Bc6GezwAAAAUV7zZM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21842835020",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-04T19:08:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312",
      "pull_request_review_id": 3036128101,
      "id": 2217920312,
      "node_id": "PRRC_kwDOABII586EMsc4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We should be able to remove `HaveCoin` now, since\r\n```C++\r\nbool CCoinsView::HaveCoin(const COutPoint &outpoint) const\r\n{\r\n    return GetCoin(outpoint).has_value();\r\n}\r\n```\r\nis more accurate (especially with the new extra assert)",
      "created_at": "2025-07-20T19:01:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920312",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379",
      "pull_request_review_id": 3036128101,
      "id": 2217920379,
      "node_id": "PRRC_kwDOABII586EMsd7",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 4,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Now that we've removed it we should at least add an `Assume(!ret->second.coin.IsSpent());` here - or even an `assert`, since if we're not sure about this we shouldn't do it in the first place",
      "created_at": "2025-07-20T19:01:26Z",
      "updated_at": "2025-07-20T19:26:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920379",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 58,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517",
      "pull_request_review_id": 3036128101,
      "id": 2217920517,
      "node_id": "PRRC_kwDOABII586EMsgF",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 80,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I understand if you think it may modify too many things here, but I'd prefer an actual `Assume` instead of the comment:\r\n```suggestion\r\n    CoinsCachePair* Next() const noexcept\r\n    {\r\n        Assume(IsDirty());\r\n        return m_next;\r\n    }\r\n```\r\n\r\n(same for `Prev`)",
      "created_at": "2025-07-20T19:02:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920517",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827",
      "pull_request_review_id": 3036128101,
      "id": 2217920827,
      "node_id": "PRRC_kwDOABII586EMsk7",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we might want to mention in the commit message why we can safely remove this now",
      "created_at": "2025-07-20T19:03:03Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211",
      "pull_request_review_id": 3036128101,
      "id": 2217921211,
      "node_id": "PRRC_kwDOABII586EMsq7",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "What should happen when `fresh` is `false`?\r\nShouldn't we assert something like:\r\n```C++\r\nif (fresh) {\r\n    pair.second.m_flags |= FRESH; \r\n} else {\r\n    assert(!(pair.second.m_flags & FRESH));\r\n}",
      "created_at": "2025-07-20T19:04:30Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921211",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830",
      "pull_request_review_id": 3036128101,
      "id": 2217921830,
      "node_id": "PRRC_kwDOABII586EMs0m",
      "diff_hunk": "@@ -154,16 +154,16 @@ BOOST_AUTO_TEST_CASE(linked_list_set_state)\n     BOOST_CHECK_EQUAL(sentinel.second.Next(), &n1);\n     BOOST_CHECK_EQUAL(sentinel.second.Prev(), &n1);\n \n-    // Check that setting FRESH on new node inserts it after n1\n-    CCoinsCacheEntry::SetFresh(n2, sentinel);\n-    BOOST_CHECK(n2.second.IsFresh() && !n2.second.IsDirty());\n+    // Check that setting DIRTY and FRESH on new node inserts it after n1\n+    CCoinsCacheEntry::SetDirty(n2, sentinel, /*fresh=*/true);\n+    BOOST_CHECK(n2.second.IsFresh() && n2.second.IsDirty());",
      "path": "src/test/coinscachepair_tests.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: for consistency with other `SetDirty` calls we could swap the parameter order:\r\n```suggestion\r\n    BOOST_CHECK(n2.second.IsDirty() && n2.second.IsFresh());\r\n```\r\n\r\n----\r\n\r\nAlternatively we could rename `IsFresh` to `IsDirtyAndFresh` and assert that if fresh is true, so is dirty - which would simplify this line to asserting just a single method.",
      "created_at": "2025-07-20T19:06:43Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921830",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071",
      "pull_request_review_id": 3036128101,
      "id": 2217922071,
      "node_id": "PRRC_kwDOABII586EMs4X",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 28,
      "original_position": 6,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "definition of `fresh` should likely include `dirty` now:\r\n```C++\r\nconst auto fresh{dirty && fuzzed_data_provider.ConsumeBool()};\r\n```",
      "created_at": "2025-07-20T19:07:45Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922071",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 146,
      "original_line": 146,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169",
      "pull_request_review_id": 3036128101,
      "id": 2217922169,
      "node_id": "PRRC_kwDOABII586EMs55",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.\r\n```\r\n(the or/and combination is confusing otherwise)",
      "created_at": "2025-07-20T19:08:14Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008",
      "pull_request_review_id": 3036128101,
      "id": 2217923008,
      "node_id": "PRRC_kwDOABII586EMtHA",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: for consistency with other overrides:\r\n```suggestion\r\n        if (auto it{m_data.find(outpoint)}; it != m_data.end()) {\r\n```",
      "created_at": "2025-07-20T19:10:42Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217923008",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887",
      "pull_request_review_id": 3036128101,
      "id": 2217925887,
      "node_id": "PRRC_kwDOABII586EMtz_",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "great, now that we have this, can we call `SanityCheck` in more tests? I understood that we couldn't do it until now since we still had invalid states in fuzz/unit tests",
      "created_at": "2025-07-20T19:17:42Z",
      "updated_at": "2025-07-20T19:27:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217925887",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983",
      "pull_request_review_id": 3036282843,
      "id": 2218040983,
      "node_id": "PRRC_kwDOABII586ENJ6X",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 58,
      "original_position": 25,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "note: the cursor contains dirty entries now, so `if (!it->second.IsDirty()) {` on line 186 is also a noop - could we add a TODO there to signal that we're aware of it but want to tackle it in a follow-up?",
      "created_at": "2025-07-21T01:11:45Z",
      "updated_at": "2025-07-21T01:11:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218040983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 213,
      "original_line": 208,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169",
      "pull_request_review_id": 3036298262,
      "id": 2218050169,
      "node_id": "PRRC_kwDOABII586ENMJ5",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:05Z",
      "updated_at": "2025-07-21T01:29:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233",
      "pull_request_review_id": 3036298324,
      "id": 2218050233,
      "node_id": "PRRC_kwDOABII586ENMK5",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 4,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920379,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:13Z",
      "updated_at": "2025-07-21T01:29:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050233",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 58,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997",
      "pull_request_review_id": 3036299636,
      "id": 2218050997,
      "node_id": "PRRC_kwDOABII586ENMW1",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 80,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I don't see how that is different. `m_flags` being set implies `IsDirty()` now, so it is equivalent. I prefer not to change this.",
      "created_at": "2025-07-21T01:30:06Z",
      "updated_at": "2025-07-21T01:30:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411",
      "pull_request_review_id": 3036303265,
      "id": 2218053411,
      "node_id": "PRRC_kwDOABII586ENM8j",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 80,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`Assume(m_flags);` would also be true for fresh only - `Assume(IsDirty());` is stricter",
      "created_at": "2025-07-21T01:34:38Z",
      "updated_at": "2025-07-21T01:37:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218053411",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579",
      "pull_request_review_id": 3036305261,
      "id": 2218054579,
      "node_id": "PRRC_kwDOABII586ENNOz",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Isn't that the same as the parent in `CCoinsView`?",
      "created_at": "2025-07-21T01:37:04Z",
      "updated_at": "2025-07-21T01:37:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218054579",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776",
      "pull_request_review_id": 3036316470,
      "id": 2218061776,
      "node_id": "PRRC_kwDOABII586ENO_Q",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 80,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It's not possible to set fresh only now.",
      "created_at": "2025-07-21T01:47:42Z",
      "updated_at": "2025-07-21T01:47:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218061776",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237",
      "pull_request_review_id": 3036320785,
      "id": 2218064237,
      "node_id": "PRRC_kwDOABII586ENPlt",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 80,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Exactly, hence my recommendation ",
      "created_at": "2025-07-21T01:51:53Z",
      "updated_at": "2025-07-21T01:51:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218064237",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867",
      "pull_request_review_id": 3036325893,
      "id": 2218067867,
      "node_id": "PRRC_kwDOABII586ENQeb",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922169,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:56:35Z",
      "updated_at": "2025-07-21T01:56:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273",
      "pull_request_review_id": 3036326661,
      "id": 2218068273,
      "node_id": "PRRC_kwDOABII586ENQkx",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We can't since we are still calling this with spent, dirty, and fresh entries. These would be deleted in production code. That can also be tackled in a follow-up.",
      "created_at": "2025-07-21T01:57:14Z",
      "updated_at": "2025-07-21T01:57:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575",
      "pull_request_review_id": 3036327280,
      "id": 2218068575,
      "node_id": "PRRC_kwDOABII586ENQpf",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 58,
      "original_position": 25,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2218040983,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "There are quite a few places where we can clean up production and test logic to not have to deal with non-dirty entries in BatchWrite. I think there would be too many TODOs.",
      "created_at": "2025-07-21T01:57:47Z",
      "updated_at": "2025-07-21T01:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068575",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 213,
      "original_line": 208,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664",
      "pull_request_review_id": 3036327359,
      "id": 2218068664,
      "node_id": "PRRC_kwDOABII586ENQq4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217923008,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:57:54Z",
      "updated_at": "2025-07-21T01:57:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068664",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073",
      "pull_request_review_id": 3036328308,
      "id": 2218069073,
      "node_id": "PRRC_kwDOABII586ENQxR",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "You did enable it for a few additional cases, that's already a win ðŸ‘ ",
      "created_at": "2025-07-21T01:59:02Z",
      "updated_at": "2025-07-21T01:59:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069073",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128",
      "pull_request_review_id": 3036328369,
      "id": 2218069128,
      "node_id": "PRRC_kwDOABII586ENQyI",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 28,
      "original_position": 6,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922071,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:59:08Z",
      "updated_at": "2025-07-21T01:59:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069128",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 146,
      "original_line": 146,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218070113",
      "pull_request_review_id": 3036329626,
      "id": 2218070113,
      "node_id": "PRRC_kwDOABII586ENRBh",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Err, I did but didn't test locally before pushing. I will have to revert. Tests are failing.",
      "created_at": "2025-07-21T02:01:21Z",
      "updated_at": "2025-07-21T02:01:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218070113",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218070113"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071116",
      "pull_request_review_id": 3036331142,
      "id": 2218071116,
      "node_id": "PRRC_kwDOABII586ENRRM",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920827,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I don't see what can be explained more than the code? This seems obvious to me.",
      "created_at": "2025-07-21T02:04:03Z",
      "updated_at": "2025-07-21T02:04:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071185",
      "pull_request_review_id": 3036331255,
      "id": 2218071185,
      "node_id": "PRRC_kwDOABII586ENRSR",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can we fix those cases instead? Having a sanitycheck which isn't run just gives us a false sense of security otherwise\r\n",
      "created_at": "2025-07-21T02:04:15Z",
      "updated_at": "2025-07-21T02:04:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071185",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071185"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071890",
      "pull_request_review_id": 3036332453,
      "id": 2218071890,
      "node_id": "PRRC_kwDOABII586ENRdS",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920827,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ok, agree, please resolve the comment",
      "created_at": "2025-07-21T02:05:34Z",
      "updated_at": "2025-07-21T02:05:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071890",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071890"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218079735",
      "pull_request_review_id": 3036343490,
      "id": 2218079735,
      "node_id": "PRRC_kwDOABII586ENTX3",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ah right, removed.",
      "created_at": "2025-07-21T02:21:43Z",
      "updated_at": "2025-07-21T02:21:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218079735",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218079735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218080120",
      "pull_request_review_id": 3036343964,
      "id": 2218080120,
      "node_id": "PRRC_kwDOABII586ENTd4",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I suppose its legal to call SetDirty on a coin that is already DIRTY-and-FRESH. I'm not sure we need to do anything here in that case.",
      "created_at": "2025-07-21T02:22:30Z",
      "updated_at": "2025-07-21T02:22:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218080120",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218080120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218081257",
      "pull_request_review_id": 3036345672,
      "id": 2218081257,
      "node_id": "PRRC_kwDOABII586ENTvp",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should we remove its freshness in that case?",
      "created_at": "2025-07-21T02:24:47Z",
      "updated_at": "2025-07-21T02:24:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218081257",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218081257"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218084376",
      "pull_request_review_id": 3036350295,
      "id": 2218084376,
      "node_id": "PRRC_kwDOABII586ENUgY",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "No, that would make this a behavior change rather than a refactor. We only added flags before, so we must only do that now as well.",
      "created_at": "2025-07-21T02:29:55Z",
      "updated_at": "2025-07-21T02:29:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218084376",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218084376"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086462",
      "pull_request_review_id": 3036353147,
      "id": 2218086462,
      "node_id": "PRRC_kwDOABII586ENVA-",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "But we have prohibited one of the states here, we can document that with code now instead of comments. If we think it's a behavior change the PR is incorrect, isn't it?",
      "created_at": "2025-07-21T02:34:31Z",
      "updated_at": "2025-07-21T02:34:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218086462",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086462"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086535",
      "pull_request_review_id": 3036353511,
      "id": 2218086535,
      "node_id": "PRRC_kwDOABII586ENVCH",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 120,
      "original_position": 41,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I can make a follow-up to remove spent fresh and dirty entries from the test cases as well. I don't think that should happen in this PR though to keep it focused.\nThe previous PR also did this.",
      "created_at": "2025-07-21T02:34:43Z",
      "updated_at": "2025-07-21T02:34:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218086535",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 324,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218092689",
      "pull_request_review_id": 3036363265,
      "id": 2218092689,
      "node_id": "PRRC_kwDOABII586ENWiR",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Your suggestion is to assert that if fresh is false then the entry cannot already be fresh. This is not the case. An entry can be made DIRTY-and-FRESH, and then it can be made DIRTY again while already DIRTY-and-FRESH. The current behavior allows this to happen and keeps the entry DIRTY-and-FRESH when SetDirty is called. If we assert that we can't call SetDirty on a DIRTY-and-FRESH entry then it is a behavior change.",
      "created_at": "2025-07-21T02:45:01Z",
      "updated_at": "2025-07-21T02:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218092689",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218092689"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218093659",
      "pull_request_review_id": 3036364564,
      "id": 2218093659,
      "node_id": "PRRC_kwDOABII586ENWxb",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 36,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nah, I'm just on a phone and thought I'm commenting on SetDirty and SetFresh. ",
      "created_at": "2025-07-21T02:47:07Z",
      "updated_at": "2025-07-21T02:47:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218093659",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218093659"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603592702",
      "pull_request_review_id": 3558493235,
      "id": 2603592702,
      "node_id": "PRRC_kwDOABII586bL6v-",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Do we really still need a bitfield at this point? I would find an enum class easier to understand if we don't allow combinations anymore.",
      "created_at": "2025-12-09T17:20:39Z",
      "updated_at": "2025-12-09T17:41:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2603592702",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603592702"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603654783",
      "pull_request_review_id": 3558493235,
      "id": 2603654783,
      "node_id": "PRRC_kwDOABII586bMJ5_",
      "diff_hunk": "@@ -174,8 +167,10 @@ struct CCoinsCacheEntry\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 35,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit 2f8d09d7a19f074970aaa8488c1edaa425148f57\r\n\r\nI have a slight preference for keeping this function, but calling it `SetFreshAndDirty` (or something along the lines) and leaving `SetDirty` as is. To me that would convey intent clearer. What do you think?",
      "created_at": "2025-12-09T17:36:04Z",
      "updated_at": "2025-12-09T17:41:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2603654783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603654783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603685179",
      "pull_request_review_id": 3558797251,
      "id": 2603685179,
      "node_id": "PRRC_kwDOABII586bMRU7",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603592702,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We likely don't (the pointers already signal dirtiness), but that might be a bigger change - https://github.com/bitcoin/bitcoin/pull/30673 was closed for being too complicated",
      "created_at": "2025-12-09T17:45:23Z",
      "updated_at": "2025-12-09T17:45:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2603685179",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2603685179"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605190043",
      "pull_request_review_id": 3560702289,
      "id": 2605190043,
      "node_id": "PRRC_kwDOABII586bSAub",
      "diff_hunk": "@@ -174,8 +167,10 @@ struct CCoinsCacheEntry\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 35,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603654783,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It does make the callsites less elegant. Here's the diff:\r\n```diff\r\ndiff --git a/src/coins.cpp b/src/coins.cpp\r\nindex 5caf0e2789..81be5967b7 100644\r\n--- a/src/coins.cpp\r\n+++ b/src/coins.cpp\r\n@@ -96,7 +96,11 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\r\n         cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n     }\r\n     it->second.coin = std::move(coin);\r\n-    CCoinsCacheEntry::SetDirty(*it, m_sentinel, fresh);\r\n+    if (fresh) {\r\n+        CCoinsCacheEntry::SetFreshAndDirty(*it, m_sentinel);\r\n+    } else {\r\n+        CCoinsCacheEntry::SetDirty(*it, m_sentinel);\r\n+    }\r\n     cachedCoinsUsage += it->second.coin.DynamicMemoryUsage();\r\n     TRACEPOINT(utxocache, add,\r\n            outpoint.hash.data(),\r\n@@ -206,7 +210,11 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\r\n                 // We can mark it FRESH in the parent if it was FRESH in the child\r\n                 // Otherwise it might have just been flushed from the parent's cache\r\n                 // and already exist in the grandparent\r\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel, it->second.IsFresh());\r\n+                if (it->second.IsFresh()) {\r\n+                    CCoinsCacheEntry::SetFreshAndDirty(*itUs, m_sentinel);\r\n+                } else {\r\n+                    CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);\r\n+                }\r\n             }\r\n         } else {\r\n             // Found the entry in the parent cache\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex e1463d1236..ceb075bd6f 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -109,7 +109,7 @@ struct CCoinsCacheEntry\r\n private:\r\n     /**\r\n      * These are used to create a doubly linked list of flagged entries.\r\n-     * They are set in SetDirty and unset in SetClean.\r\n+     * They are set in SetDirty/SetFreshAndDirty and unset in SetClean.\r\n      * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.\r\n      *\r\n      * DIRTY entries are tracked so that only modified entries can be passed to\r\n@@ -167,9 +167,14 @@ public:\r\n         SetClean();\r\n     }\r\n \r\n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\r\n+    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\r\n     {\r\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\r\n+        AddFlags(DIRTY, pair, sentinel);\r\n+    }\r\n+\r\n+    static void SetFreshAndDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\r\n+    {\r\n+        AddFlags(DIRTY | FRESH, pair, sentinel);\r\n     }\r\n \r\n     void SetClean() noexcept\r\ndiff --git a/src/test/coins_tests.cpp b/src/test/coins_tests.cpp\r\nindex cc5146a915..c499fde360 100644\r\n--- a/src/test/coins_tests.cpp\r\n+++ b/src/test/coins_tests.cpp\r\n@@ -633,8 +633,10 @@ static size_t InsertCoinsMapEntry(CCoinsMap& map, CoinsCachePair& sentinel, cons\r\n     SetCoinsValue(cache_coin.value, entry.coin);\r\n     auto [iter, inserted] = map.emplace(OUTPOINT, std::move(entry));\r\n     assert(inserted);\r\n-    if (cache_coin.IsDirty()) {\r\n-        CCoinsCacheEntry::SetDirty(*iter, sentinel, cache_coin.IsDirtyFresh());\r\n+    if (cache_coin.IsDirtyFresh()) {\r\n+        CCoinsCacheEntry::SetFreshAndDirty(*iter, sentinel);\r\n+    } else if (cache_coin.IsDirty()) {\r\n+        CCoinsCacheEntry::SetDirty(*iter, sentinel);\r\n     }\r\n     return iter->second.coin.DynamicMemoryUsage();\r\n }\r\ndiff --git a/src/test/coinscachepair_tests.cpp b/src/test/coinscachepair_tests.cpp\r\nindex 1110f1cdd1..73fbf784c5 100644\r\n--- a/src/test/coinscachepair_tests.cpp\r\n+++ b/src/test/coinscachepair_tests.cpp\r\n@@ -155,7 +155,7 @@ BOOST_AUTO_TEST_CASE(linked_list_set_state)\r\n     BOOST_CHECK_EQUAL(sentinel.second.Prev(), &n1);\r\n \r\n     // Check that setting DIRTY and FRESH on new node inserts it after n1\r\n-    CCoinsCacheEntry::SetDirty(n2, sentinel, /*fresh=*/true);\r\n+    CCoinsCacheEntry::SetFreshAndDirty(n2, sentinel);\r\n     BOOST_CHECK(n2.second.IsFresh() && n2.second.IsDirty());\r\n     BOOST_CHECK_EQUAL(n2.second.Next(), &sentinel);\r\n     BOOST_CHECK_EQUAL(n2.second.Prev(), &n1);\r\n@@ -163,7 +163,7 @@ BOOST_AUTO_TEST_CASE(linked_list_set_state)\r\n     BOOST_CHECK_EQUAL(sentinel.second.Prev(), &n2);\r\n \r\n     // Check that we can set extra state, but they don't change our position\r\n-    CCoinsCacheEntry::SetDirty(n1, sentinel, /*fresh=*/true);\r\n+    CCoinsCacheEntry::SetFreshAndDirty(n1, sentinel);\r\n     BOOST_CHECK(n1.second.IsDirty() && n1.second.IsFresh());\r\n     BOOST_CHECK_EQUAL(n1.second.Next(), &n2);\r\n     BOOST_CHECK_EQUAL(n1.second.Prev(), &sentinel);\r\ndiff --git a/src/test/fuzz/coins_view.cpp b/src/test/fuzz/coins_view.cpp\r\nindex d538a62825..0a2df0fdb6 100644\r\n--- a/src/test/fuzz/coins_view.cpp\r\n+++ b/src/test/fuzz/coins_view.cpp\r\n@@ -143,7 +143,13 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\r\n                         coins_cache_entry.coin = *opt_coin;\r\n                     }\r\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\r\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);\r\n+                    if (dirty) {\r\n+                        if (fresh) {\r\n+                            CCoinsCacheEntry::SetFreshAndDirty(*it, sentinel);\r\n+                        } else {\r\n+                            CCoinsCacheEntry::SetDirty(*it, sentinel);\r\n+                        }\r\n+                    }\r\n                 }\r\n                 bool expected_code_path = false;\r\n                 try {\r\n```",
      "created_at": "2025-12-10T04:54:53Z",
      "updated_at": "2025-12-10T04:54:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2605190043",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605190043"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605213533",
      "pull_request_review_id": 3560732951,
      "id": 2605213533,
      "node_id": "PRRC_kwDOABII586bSGdd",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603592702,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yep, we can get rid of the bitfield entirely and just have a `bool m_fresh`. Dirtiness is implied by belonging to the linked list. WDYT of the diff?\r\n\r\n```diff\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex 2357f6bd3e..6745117f4c 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -108,9 +108,8 @@ struct CCoinsCacheEntry\r\n {\r\n private:\r\n     /**\r\n-     * These are used to create a doubly linked list of flagged entries.\r\n+     * These are used to create a doubly linked list of dirty entries.\r\n      * They are set in SetDirty and unset in SetClean.\r\n-     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.\r\n      *\r\n      * DIRTY entries are tracked so that only modified entries can be passed to\r\n      * the parent cache for batch writing. This is a performance optimization\r\n@@ -119,32 +118,11 @@ private:\r\n      */\r\n     CoinsCachePair* m_prev{nullptr};\r\n     CoinsCachePair* m_next{nullptr};\r\n-    uint8_t m_flags{0};\r\n+    bool m_fresh{false};\r\n \r\n public:\r\n     Coin coin; // The actual cached data.\r\n \r\n-    enum Flags {\r\n-        /**\r\n-         * DIRTY means the CCoinsCacheEntry is potentially different from the\r\n-         * version in the parent cache. Failure to mark a coin as DIRTY when\r\n-         * it is potentially different from the parent cache will cause a\r\n-         * consensus failure, since the coin's state won't get written to the\r\n-         * parent when the cache is flushed.\r\n-         */\r\n-        DIRTY = (1 << 0),\r\n-        /**\r\n-         * FRESH means the parent cache does not have this coin or that it is a\r\n-         * spent coin in the parent cache. If a FRESH coin in the cache is\r\n-         * later spent, it can be deleted entirely and doesn't ever need to be\r\n-         * flushed to the parent. This is a performance optimization. Marking a\r\n-         * coin as FRESH when it exists unspent in the parent cache will cause a\r\n-         * consensus failure, since it might not be deleted from the parent\r\n-         * when this cache is flushed.\r\n-         */\r\n-        FRESH = (1 << 1),\r\n-    };\r\n-\r\n     CCoinsCacheEntry() noexcept = default;\r\n     explicit CCoinsCacheEntry(Coin&& coin_) noexcept : coin(std::move(coin_)) {}\r\n     ~CCoinsCacheEntry()\r\n@@ -154,7 +132,7 @@ public:\r\n \r\n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\r\n     {\r\n-        if (!pair.second.m_flags) {\r\n+        if (!pair.second.m_prev) {\r\n             Assume(!pair.second.m_prev && !pair.second.m_next);\r\n             pair.second.m_prev = sentinel.second.m_prev;\r\n             pair.second.m_next = &sentinel;\r\n@@ -162,32 +140,29 @@ public:\r\n             pair.second.m_prev->second.m_next = &pair;\r\n         }\r\n         Assume(pair.second.m_prev && pair.second.m_next);\r\n-        pair.second.m_flags |= DIRTY;\r\n-        if (fresh) pair.second.m_flags |= FRESH;\r\n+        pair.second.m_fresh = fresh;\r\n     }\r\n \r\n     void SetClean() noexcept\r\n     {\r\n-        if (!m_flags) return;\r\n+        if (!m_prev) return;\r\n         m_next->second.m_prev = m_prev;\r\n         m_prev->second.m_next = m_next;\r\n-        m_flags = 0;\r\n+        m_fresh = false;\r\n         m_prev = m_next = nullptr;\r\n     }\r\n-    bool IsDirty() const noexcept { return m_flags & DIRTY; }\r\n-    bool IsFresh() const noexcept { return m_flags & FRESH; }\r\n+    bool IsDirty() const noexcept { return m_prev; }\r\n+    bool IsFresh() const noexcept { return m_fresh; }\r\n \r\n-    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\r\n+    //! Only call Next when this entry is dirty\r\n     CoinsCachePair* Next() const noexcept\r\n     {\r\n-        Assume(m_flags);\r\n         return m_next;\r\n     }\r\n \r\n-    //! Only call Prev when this entry is DIRTY or DIRTY-and-FRESH\r\n+    //! Only call Prev when this entry is dirty\r\n     CoinsCachePair* Prev() const noexcept\r\n     {\r\n-        Assume(m_flags);\r\n         return m_prev;\r\n     }\r\n \r\n@@ -197,8 +172,6 @@ public:\r\n         Assume(&pair.second == this);\r\n         m_prev = &pair;\r\n         m_next = &pair;\r\n-        // Set sentinel to DIRTY so we can call Next on it\r\n-        m_flags = DIRTY;\r\n     }\r\n };\r\n\r\n```",
      "created_at": "2025-12-10T05:08:15Z",
      "updated_at": "2025-12-10T05:08:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2605213533",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605213533"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606286863",
      "pull_request_review_id": 3562085499,
      "id": 2606286863,
      "node_id": "PRRC_kwDOABII586bWMgP",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603592702,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I like this, let's do it in this PR - only comment is to use `m_next` instead of prev since I want to investigate removing `m_prev`",
      "created_at": "2025-12-10T11:30:18Z",
      "updated_at": "2025-12-10T11:30:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2606286863",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606286863"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606310824",
      "pull_request_review_id": 3562114739,
      "id": 2606310824,
      "node_id": "PRRC_kwDOABII586bWSWo",
      "diff_hunk": "@@ -174,8 +167,10 @@ struct CCoinsCacheEntry\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 35,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603654783,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Had a [similar suggestion](https://github.com/bitcoin/bitcoin/pull/30673#discussion_r2206097629) in the old PR.\r\nthe new code is indeed more complicated. What if instead both `fresh` and `dirty` are parameters to a general `SetState` method?",
      "created_at": "2025-12-10T11:35:20Z",
      "updated_at": "2025-12-10T11:35:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2606310824",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606310824"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606338909",
      "pull_request_review_id": 3562147016,
      "id": 2606338909,
      "node_id": "PRRC_kwDOABII586bWZNd",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603592702,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "That looks nice, I'd support that.",
      "created_at": "2025-12-10T11:44:18Z",
      "updated_at": "2025-12-10T11:45:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2606338909",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606338909"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606341201",
      "pull_request_review_id": 3562147016,
      "id": 2606341201,
      "node_id": "PRRC_kwDOABII586bWZxR",
      "diff_hunk": "@@ -174,8 +167,10 @@ struct CCoinsCacheEntry\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 35,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603654783,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think in combination with your other suggestion, keeping it is fine too.",
      "created_at": "2025-12-10T11:45:04Z",
      "updated_at": "2025-12-10T11:45:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2606341201",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2606341201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607248709",
      "pull_request_review_id": 3563292136,
      "id": 2607248709,
      "node_id": "PRRC_kwDOABII586bZ3VF",
      "diff_hunk": "@@ -174,8 +167,10 @@ struct CCoinsCacheEntry\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 35,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603654783,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> What if instead both `fresh` and `dirty` are parameters to a general `SetState` method?\r\n\r\nBut the goal is to make it impossible to set `fresh` on its own. So why have a separate `dirty` parameter? I think the way it is now is optimal.",
      "created_at": "2025-12-10T15:58:45Z",
      "updated_at": "2025-12-10T15:58:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2607248709",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607248709"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607449049",
      "pull_request_review_id": 3563542751,
      "id": 2607449049,
      "node_id": "PRRC_kwDOABII586baoPZ",
      "diff_hunk": "@@ -102,27 +102,20 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "98698b45d53f92603ada14689f377df3df973893",
      "original_commit_id": "2f8d09d7a19f074970aaa8488c1edaa425148f57",
      "in_reply_to_id": 2603592702,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "created_at": "2025-12-10T16:50:16Z",
      "updated_at": "2025-12-10T16:50:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2607449049",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607449049"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607508978",
      "pull_request_review_id": 3563616983,
      "id": 2607508978,
      "node_id": "PRRC_kwDOABII586ba23y",
      "diff_hunk": "@@ -119,32 +118,11 @@ struct CCoinsCacheEntry\n      */\n     CoinsCachePair* m_prev{nullptr};\n     CoinsCachePair* m_next{nullptr};\n-    uint8_t m_flags{0};\n+    bool m_fresh{false};\n \n public:\n     Coin coin; // The actual cached data.\n \n-    enum Flags {\n-        /**\n-         * DIRTY means the CCoinsCacheEntry is potentially different from the\n-         * version in the parent cache. Failure to mark a coin as DIRTY when\n-         * it is potentially different from the parent cache will cause a\n-         * consensus failure, since the coin's state won't get written to the\n-         * parent when the cache is flushed.\n-         */\n-        DIRTY = (1 << 0),\n-        /**\n-         * FRESH means the parent cache does not have this coin or that it is a\n-         * spent coin in the parent cache. If a FRESH coin in the cache is\n-         * later spent, it can be deleted entirely and doesn't ever need to be\n-         * flushed to the parent. This is a performance optimization. Marking a\n-         * coin as FRESH when it exists unspent in the parent cache will cause a\n-         * consensus failure, since it might not be deleted from the parent\n-         * when this cache is flushed.\n-         */\n-        FRESH = (1 << 1),\n-    };",
      "path": "src/coins.h",
      "position": 70,
      "original_position": 40,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "this is defintely too verbose, but some some explanation for the getters would be welcome",
      "created_at": "2025-12-10T17:07:33Z",
      "updated_at": "2025-12-10T17:07:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2607508978",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607508978"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 149,
      "original_start_line": 127,
      "start_side": "LEFT",
      "line": 168,
      "original_line": 168,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607512445",
      "pull_request_review_id": 3563622065,
      "id": 2607512445,
      "node_id": "PRRC_kwDOABII586ba3t9",
      "diff_hunk": "@@ -154,40 +132,37 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        if (!pair.second.m_flags) {\n+        if (!pair.second.m_next) {\n             Assume(!pair.second.m_prev && !pair.second.m_next);\n             pair.second.m_prev = sentinel.second.m_prev;\n             pair.second.m_next = &sentinel;\n             sentinel.second.m_prev = &pair;\n             pair.second.m_prev->second.m_next = &pair;\n         }\n         Assume(pair.second.m_prev && pair.second.m_next);\n-        pair.second.m_flags |= DIRTY;\n-        if (fresh) pair.second.m_flags |= FRESH;\n+        pair.second.m_fresh = fresh || pair.second.m_fresh;\n     }\n \n     void SetClean() noexcept\n     {\n-        if (!m_flags) return;\n+        if (!m_next) return;\n         m_next->second.m_prev = m_prev;\n         m_prev->second.m_next = m_next;\n-        m_flags = 0;\n+        m_fresh = false;\n         m_prev = m_next = nullptr;\n     }\n-    bool IsDirty() const noexcept { return m_flags & DIRTY; }\n-    bool IsFresh() const noexcept { return m_flags & FRESH; }\n+    bool IsDirty() const noexcept { return m_next; }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 75,
      "commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "original_commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: if you think it makes it more readable\r\n```suggestion\r\n    bool IsDirty() const noexcept { return !!m_next; }\r\n```\r\nor\r\n```suggestion\r\n    bool IsDirty() const noexcept { return m_next != nullptr; }\r\n```",
      "created_at": "2025-12-10T17:08:25Z",
      "updated_at": "2025-12-10T17:10:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2607512445",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607512445"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607517231",
      "pull_request_review_id": 3563622065,
      "id": 2607517231,
      "node_id": "PRRC_kwDOABII586ba44v",
      "diff_hunk": "@@ -154,40 +132,37 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        if (!pair.second.m_flags) {\n+        if (!pair.second.m_next) {\n             Assume(!pair.second.m_prev && !pair.second.m_next);\n             pair.second.m_prev = sentinel.second.m_prev;\n             pair.second.m_next = &sentinel;\n             sentinel.second.m_prev = &pair;\n             pair.second.m_prev->second.m_next = &pair;\n         }\n         Assume(pair.second.m_prev && pair.second.m_next);\n-        pair.second.m_flags |= DIRTY;\n-        if (fresh) pair.second.m_flags |= FRESH;\n+        pair.second.m_fresh = fresh || pair.second.m_fresh;\n     }\n \n     void SetClean() noexcept\n     {\n-        if (!m_flags) return;\n+        if (!m_next) return;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 66,
      "commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "original_commit_id": "4564e571f2ef22ac096c58033137154e1e4b4cf7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n        if (!IsDirty()) return;\r\n```",
      "created_at": "2025-12-10T17:10:00Z",
      "updated_at": "2025-12-10T17:10:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2607517231",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2607517231"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2637419114",
      "pull_request_review_id": 3601358966,
      "id": 2637419114,
      "node_id": "PRRC_kwDOABII586dM9Jq",
      "diff_hunk": "@@ -102,103 +102,84 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n-     * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * These are used to create a doubly linked list of DIRTY entries.\n+     * They are set in SetDirty and unset in SetClean.\n      *\n      * DIRTY entries are tracked so that only modified entries can be passed to\n      * the parent cache for batch writing. This is a performance optimization\n      * compared to giving all entries in the cache to the parent and having the\n      * parent scan for only modified entries.\n-     *\n-     * FRESH-but-not-DIRTY coins can not occur in practice, since that would\n-     * mean a spent coin exists in the parent CCoinsView and not in the child\n-     * CCoinsViewCache. Nevertheless, if a spent coin is retrieved from the\n-     * parent cache, the FRESH-but-not-DIRTY coin will be tracked by the linked\n-     * list and deleted when Sync or Flush is called on the CCoinsViewCache.\n      */\n     CoinsCachePair* m_prev{nullptr};\n     CoinsCachePair* m_next{nullptr};\n-    uint8_t m_flags{0};\n-\n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));\n-        if (!pair.second.m_flags) {\n-            Assume(!pair.second.m_prev && !pair.second.m_next);\n-            pair.second.m_prev = sentinel.second.m_prev;\n-            pair.second.m_next = &sentinel;\n-            sentinel.second.m_prev = &pair;\n-            pair.second.m_prev->second.m_next = &pair;\n-        }\n-        Assume(pair.second.m_prev && pair.second.m_next);\n-        pair.second.m_flags |= flags;\n-    }\n+    bool m_fresh{false};\n \n public:\n     Coin coin; // The actual cached data.\n \n-    enum Flags {\n-        /**\n-         * DIRTY means the CCoinsCacheEntry is potentially different from the\n-         * version in the parent cache. Failure to mark a coin as DIRTY when\n-         * it is potentially different from the parent cache will cause a\n-         * consensus failure, since the coin's state won't get written to the\n-         * parent when the cache is flushed.\n-         */\n-        DIRTY = (1 << 0),\n-        /**\n-         * FRESH means the parent cache does not have this coin or that it is a\n-         * spent coin in the parent cache. If a FRESH coin in the cache is\n-         * later spent, it can be deleted entirely and doesn't ever need to be\n-         * flushed to the parent. This is a performance optimization. Marking a\n-         * coin as FRESH when it exists unspent in the parent cache will cause a\n-         * consensus failure, since it might not be deleted from the parent\n-         * when this cache is flushed.\n-         */\n-        FRESH = (1 << 1),\n-    };\n-\n     CCoinsCacheEntry() noexcept = default;\n     explicit CCoinsCacheEntry(Coin&& coin_) noexcept : coin(std::move(coin_)) {}\n     ~CCoinsCacheEntry()\n     {\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }\n+    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept",
      "path": "src/coins.h",
      "position": 97,
      "original_position": 81,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think it's important to add a docstring to this function. Would also be good to explain what happens if a non-fresh entry is marked fresh by accident (and vice-versa), similar to the previous brief explainer for the FRESH enum variant (don't have a good suggestion yet though).",
      "created_at": "2025-12-20T22:44:25Z",
      "updated_at": "2025-12-20T22:44:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2637419114",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2637419114"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2637428213",
      "pull_request_review_id": 3601365157,
      "id": 2637428213,
      "node_id": "PRRC_kwDOABII586dM_X1",
      "diff_hunk": "@@ -102,103 +102,84 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n-     * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * These are used to create a doubly linked list of DIRTY entries.\n+     * They are set in SetDirty and unset in SetClean.\n      *\n      * DIRTY entries are tracked so that only modified entries can be passed to\n      * the parent cache for batch writing. This is a performance optimization\n      * compared to giving all entries in the cache to the parent and having the\n      * parent scan for only modified entries.\n-     *\n-     * FRESH-but-not-DIRTY coins can not occur in practice, since that would\n-     * mean a spent coin exists in the parent CCoinsView and not in the child\n-     * CCoinsViewCache. Nevertheless, if a spent coin is retrieved from the\n-     * parent cache, the FRESH-but-not-DIRTY coin will be tracked by the linked\n-     * list and deleted when Sync or Flush is called on the CCoinsViewCache.\n      */\n     CoinsCachePair* m_prev{nullptr};\n     CoinsCachePair* m_next{nullptr};\n-    uint8_t m_flags{0};\n-\n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));\n-        if (!pair.second.m_flags) {\n-            Assume(!pair.second.m_prev && !pair.second.m_next);\n-            pair.second.m_prev = sentinel.second.m_prev;\n-            pair.second.m_next = &sentinel;\n-            sentinel.second.m_prev = &pair;\n-            pair.second.m_prev->second.m_next = &pair;\n-        }\n-        Assume(pair.second.m_prev && pair.second.m_next);\n-        pair.second.m_flags |= flags;\n-    }\n+    bool m_fresh{false};\n \n public:\n     Coin coin; // The actual cached data.\n \n-    enum Flags {\n-        /**\n-         * DIRTY means the CCoinsCacheEntry is potentially different from the\n-         * version in the parent cache. Failure to mark a coin as DIRTY when\n-         * it is potentially different from the parent cache will cause a\n-         * consensus failure, since the coin's state won't get written to the\n-         * parent when the cache is flushed.\n-         */\n-        DIRTY = (1 << 0),\n-        /**\n-         * FRESH means the parent cache does not have this coin or that it is a\n-         * spent coin in the parent cache. If a FRESH coin in the cache is\n-         * later spent, it can be deleted entirely and doesn't ever need to be\n-         * flushed to the parent. This is a performance optimization. Marking a\n-         * coin as FRESH when it exists unspent in the parent cache will cause a\n-         * consensus failure, since it might not be deleted from the parent\n-         * when this cache is flushed.\n-         */\n-        FRESH = (1 << 1),\n-    };\n-\n     CCoinsCacheEntry() noexcept = default;\n     explicit CCoinsCacheEntry(Coin&& coin_) noexcept : coin(std::move(coin_)) {}\n     ~CCoinsCacheEntry()\n     {\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }\n+    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept",
      "path": "src/coins.h",
      "position": 97,
      "original_position": 81,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "in_reply_to_id": 2637419114,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm working on a PR to reduce the doubly-linked list to a single one - it will likely change these methods anyway.\r\nIf I finish it in time, maybe I can provide feedback about that here...\r\nBut let's also step back and notice that we're trying to add a comment for a method that we concede is hard to understand. Can we refactor instead of admitting defeat and commenting?\r\nI will review this in detail to see if I have a better idea.",
      "created_at": "2025-12-20T23:08:14Z",
      "updated_at": "2025-12-20T23:09:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2637428213",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2637428213"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659809871",
      "pull_request_review_id": 3625100497,
      "id": 2659809871,
      "node_id": "PRRC_kwDOABII586eiXpP",
      "diff_hunk": "@@ -102,103 +102,84 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n-     * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * These are used to create a doubly linked list of DIRTY entries.\n+     * They are set in SetDirty and unset in SetClean.\n      *\n      * DIRTY entries are tracked so that only modified entries can be passed to\n      * the parent cache for batch writing. This is a performance optimization\n      * compared to giving all entries in the cache to the parent and having the\n      * parent scan for only modified entries.\n-     *\n-     * FRESH-but-not-DIRTY coins can not occur in practice, since that would\n-     * mean a spent coin exists in the parent CCoinsView and not in the child\n-     * CCoinsViewCache. Nevertheless, if a spent coin is retrieved from the\n-     * parent cache, the FRESH-but-not-DIRTY coin will be tracked by the linked\n-     * list and deleted when Sync or Flush is called on the CCoinsViewCache.\n      */\n     CoinsCachePair* m_prev{nullptr};\n     CoinsCachePair* m_next{nullptr};\n-    uint8_t m_flags{0};\n-\n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));\n-        if (!pair.second.m_flags) {\n-            Assume(!pair.second.m_prev && !pair.second.m_next);\n-            pair.second.m_prev = sentinel.second.m_prev;\n-            pair.second.m_next = &sentinel;\n-            sentinel.second.m_prev = &pair;\n-            pair.second.m_prev->second.m_next = &pair;\n-        }\n-        Assume(pair.second.m_prev && pair.second.m_next);\n-        pair.second.m_flags |= flags;\n-    }\n+    bool m_fresh{false};\n \n public:\n     Coin coin; // The actual cached data.\n \n-    enum Flags {\n-        /**\n-         * DIRTY means the CCoinsCacheEntry is potentially different from the\n-         * version in the parent cache. Failure to mark a coin as DIRTY when\n-         * it is potentially different from the parent cache will cause a\n-         * consensus failure, since the coin's state won't get written to the\n-         * parent when the cache is flushed.\n-         */\n-        DIRTY = (1 << 0),\n-        /**\n-         * FRESH means the parent cache does not have this coin or that it is a\n-         * spent coin in the parent cache. If a FRESH coin in the cache is\n-         * later spent, it can be deleted entirely and doesn't ever need to be\n-         * flushed to the parent. This is a performance optimization. Marking a\n-         * coin as FRESH when it exists unspent in the parent cache will cause a\n-         * consensus failure, since it might not be deleted from the parent\n-         * when this cache is flushed.\n-         */\n-        FRESH = (1 << 1),\n-    };\n-\n     CCoinsCacheEntry() noexcept = default;\n     explicit CCoinsCacheEntry(Coin&& coin_) noexcept : coin(std::move(coin_)) {}\n     ~CCoinsCacheEntry()\n     {\n         SetClean();\n     }\n \n-    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(DIRTY, pair, sentinel); }\n-    static void SetFresh(CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept { AddFlags(FRESH, pair, sentinel); }\n+    static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept",
      "path": "src/coins.h",
      "position": 97,
      "original_position": 81,
      "commit_id": "ca035174a3920edbae279663580f193d1ae5ea3e",
      "original_commit_id": "e9d793dc091c9a6359a4725ac1d0d734b983c6f4",
      "in_reply_to_id": 2637419114,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added a docstring to this function and to `SetClean()`.",
      "created_at": "2026-01-04T17:23:09Z",
      "updated_at": "2026-01-04T17:23:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2659809871",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659809871"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018",
    "id": 2679273445,
    "node_id": "PR_kwDOABII586fsnfl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33018",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33018.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33018.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/99b243d53e7ca3e824369e7e194981d814c04708",
    "number": 33018,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove SetFresh method from CCoinsCacheEntry",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "There is plenty of test code that exercises the code path for FRESH-but-not-DIRTY coins in CCoinsViewCache. However, we can see there is only one place in production code where we call `SetFresh` that is not preceded by `SetDirty`. This is in `CCoinsViewCache::FetchCoin` and we can see that this is called if the coin retrieved from `base->GetCoin` is spent. The `base` in this case can be another `CCoinsViewCache` or a `CCoinsViewDB`. In `CCoinsViewCache::GetCoin` we can see that we do not return spent coins, and in `CCoinsViewDB` we don't ever store spent coins so there are none to return.\r\n\r\nThus, we can safely remove this dead code, and now we can see that there are never any calls to `SetFresh` not preceded by `SetDirty`. This PR removes this dead code and replaces `SetFresh` by passing a `fresh` boolean flag to `SetDirty`. This simplifies the logic of `CCoinsViewCache` and lets us remove test cases checking for FRESH-but-not-DIRTY coins. It removes the possibility of FRESH-but-not-DIRTY coins being called from any code path, so we can eliminate this state entirely and reduce the cognitive load of having to consider it.\r\n\r\nThis is pulled out from https://github.com/bitcoin/bitcoin/pull/30673 to make the change simpler.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-07-19T19:21:35Z",
    "updated_at": "2025-10-15T16:28:47Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "andrewtoth:remove-setfresh",
      "ref": "remove-setfresh",
      "sha": "99b243d53e7ca3e824369e7e194981d814c04708",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 287436,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-14T14:02:54Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5878f35446ae260ccb0ab5051b795b4364f77951",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38031,
        "stargazers_count": 86193,
        "watchers_count": 86193,
        "size": 294954,
        "default_branch": "master",
        "open_issues_count": 824,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-15T14:01:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-15T16:36:52Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 42,
    "deletions": 91,
    "changed_files": 6,
    "commits": 6,
    "review_comments": 36,
    "comments": 4
  },
  "events": [
    {
      "event": "labeled",
      "id": 18712832524,
      "node_id": "LE_lADOABII587Bc6GezwAAAARbXyoM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18712832524",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:38Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3092526814,
      "node_id": "IC_kwDOABII5864VDbe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3092526814",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:39Z",
      "updated_at": "2025-10-02T16:37:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33018.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33512](https://github.com/bitcoin/bitcoin/pull/33512) (coins: use number of dirty cache entries in flush warnings/logs by l0rinc)\n* [#32313](https://github.com/bitcoin/bitcoin/pull/32313) (coins: fix `cachedCoinsUsage` accounting in `CCoinsViewCache` by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3092526814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18717562758,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbp1eG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18717562758",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "created_at": "2025-07-20T18:17:13Z"
    },
    {
      "event": "reviewed",
      "id": 3036128101,
      "node_id": "PRR_kwDOABII586096Nl",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-07-20T19:20:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nVery glad this is getting cleanup up, I found it worrying that a lot of tests were exercising invalid states in the first place - not the best foundation.\r\nQuickly went over the changes, I find the small commits and excellent commit messages easy to follow.\r\nI'll run a full IBD over this (maybe with some extra `SanityCheck` sprinkled around for extra measure) to make sure real usage doesn't trigger any invalid states we're not aware of.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101",
      "submitted_at": "2025-07-20T19:20:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "reviewed",
      "id": 3036282843,
      "node_id": "PRR_kwDOABII5860-f_b",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-07-21T01:11:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036282843",
      "submitted_at": "2025-07-21T01:11:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18719180874,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbwAhK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719180874",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "created_at": "2025-07-21T01:28:49Z"
    },
    {
      "event": "commented",
      "id": 3095031799,
      "node_id": "IC_kwDOABII5864em_3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3095031799",
      "actor": {
        "login": "Lalaweazel",
        "id": 180723578,
        "node_id": "U_kgDOCsWfeg",
        "avatar_url": "https://avatars.githubusercontent.com/u/180723578?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Lalaweazel",
        "html_url": "https://github.com/Lalaweazel",
        "followers_url": "https://api.github.com/users/Lalaweazel/followers",
        "following_url": "https://api.github.com/users/Lalaweazel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Lalaweazel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Lalaweazel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Lalaweazel/subscriptions",
        "organizations_url": "https://api.github.com/users/Lalaweazel/orgs",
        "repos_url": "https://api.github.com/users/Lalaweazel/repos",
        "events_url": "https://api.github.com/users/Lalaweazel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Lalaweazel/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:06:34Z",
      "updated_at": "2025-07-21T02:21:13Z",
      "author_association": "NONE",
      "body": "' DQ at need  f cc 2iooo9 to be in work iiiiiiii iroieeieeieowwiereo W e\r\n\r\nOn Mon, 21 July 2025, 12:02 pm Andrew Toth, ***@***.***>\r\nwrote:\r\n\r\n> ***@***.**** commented on this pull request.\r\n> ------------------------------\r\n>\r\n> In src/coins.h\r\n> <https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867>:\r\n>\r\n> >   * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\r\n>   */\r\n>  struct CCoinsCacheEntry\r\n>  {\r\n>  private:\r\n>      /**\r\n>       * These are used to create a doubly linked list of flagged entries.\r\n> -     * They are set in SetDirty, SetFresh, and unset in SetClean.\r\n> -     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\r\n> +     * They are set in SetDirty and unset in SetClean.\r\n> +     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.\r\n>\r\n> Done.\r\n>\r\n> —\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/BLCZ66TZ63CTQEG3FDJLXXD3JRC23AVCNFSM6AAAAACB46C4HCVHI2DSMVQWIX3LMV43YUDVNRWFEZLROVSXG5CSMV3GSZLXHMZTAMZWGMZDKOBZGM>\r\n> .\r\n> You are receiving this because you are subscribed to this thread.Message\r\n> ID: ***@***.***>\r\n>\r\n",
      "user": {
        "login": "Lalaweazel",
        "id": 180723578,
        "node_id": "U_kgDOCsWfeg",
        "avatar_url": "https://avatars.githubusercontent.com/u/180723578?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Lalaweazel",
        "html_url": "https://github.com/Lalaweazel",
        "followers_url": "https://api.github.com/users/Lalaweazel/followers",
        "following_url": "https://api.github.com/users/Lalaweazel/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Lalaweazel/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Lalaweazel/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Lalaweazel/subscriptions",
        "organizations_url": "https://api.github.com/users/Lalaweazel/orgs",
        "repos_url": "https://api.github.com/users/Lalaweazel/repos",
        "events_url": "https://api.github.com/users/Lalaweazel/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Lalaweazel/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3095031799",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk3ODY4NjlhMmYyMGFmMjlhNzQyOGU1ZGQ3ODdlN2NjOTljOTliZjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9786869a2f20af29a7428e5dd787e7cc99c99bf4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9786869a2f20af29a7428e5dd787e7cc99c99bf4",
      "tree": {
        "sha": "9677a4a17a9adfb06d9535293c98f506d39650f7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9677a4a17a9adfb06d9535293c98f506d39650f7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9677a4a17a9adfb06d9535293c98f506d39650f7\nparent 184159e4f30c6846cd0324ee07b59e7f8121a5ea\nauthor Andrew Toth <andrewstoth@gmail.com> 1752949714 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ntest: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBhIRxAAoP+0jPQ6mzH4tEQ9mzXBoYWaLhJM8n+1/ay50vvvt5qsqfBaBDkwsEHw\nKRpz5iV1hpYUDDYxvnd4imJIoyUCm7reHzB5qn9vhht0cEJk6M0ptljTGx3jpKGJ\nNQLjo1dBJDI8pmTXKy1O2TRRQEjGF6K6KMfJXzPb6ODoNaqKr9zjYuFKXAL5C5n5\nKY6aUWiYTh9sDKQww7ziscjCxEa80ly4t9HMlbfwO3EMcL5pavYKFZleT4lDeOMx\nDbCwPQxik1X3OaP+hV/ZXA8SSTEZm7WIuJRlevNWyIJFi2Whz7oHvfA9gd1kCftA\nfLE5SvBbxdDzNI3qL8bL3fh1OP27bnkqI6dJPtuPx/P5AvJu4PWFZp6hW8qm52jQ\nK6qWcHOJGZm8heRAxjm6f4LZBVmD5L7gcqmFsKZ2Kti8zHexEMYz7y/wxIPn3i8w\n207IkoR0Rf4v/yKMBii18oCSivPIK2iZJ6UZYd0/H2B1qy06Dvko8IigP3HnRKDo\nq0fbFaVgVY0UfwXCbl4wOc5+3rf1SRCT5B/W1RRTAaoppIDqgqxpvfVq644g9iCs\nKbi8E+ZdNhD7KJ7NqfbFYNyVRsaXcUbTTF1h3kANUiCiDF3tjrMV0GQLz2MGgKjl\nJ+kIXX0WsWfJkfgbmJNIj7LvZPndNF6+JMERn0B18f/2SL87PdM=\n=ltu8\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/184159e4f30c6846cd0324ee07b59e7f8121a5ea",
          "sha": "184159e4f30c6846cd0324ee07b59e7f8121a5ea",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/184159e4f30c6846cd0324ee07b59e7f8121a5ea"
        }
      ],
      "message": "test: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-19T18:28:34Z"
      },
      "sha": "9786869a2f20af29a7428e5dd787e7cc99c99bf4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNlYTY0MTA0Njc5N2FkOTFmMGYyNThmYjYzNWYyNTQyNTQwODlhYTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3ea641046797ad91f0f258fb635f254254089aa4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3ea641046797ad91f0f258fb635f254254089aa4",
      "tree": {
        "sha": "80cb0ce33f417c5bd2014a318d6c76334b14c3f6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/80cb0ce33f417c5bd2014a318d6c76334b14c3f6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 80cb0ce33f417c5bd2014a318d6c76334b14c3f6\nparent 9786869a2f20af29a7428e5dd787e7cc99c99bf4\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033832 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ncoins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBi+Ag/9FepNUCDiIHfX+oWw5oRQy88h0JRPB0DlLulxwBmEJBiGVvzcSqX25fZ0\nkudGlJYAhn73T5DMDu4BWbDvVWOT7KzRCQYkvPDrCF40Lnzbhwn/KkuHty/SoCGf\nCIrRCE72krX2rI05K+kHTN9Kmu/r/UYcvjY+Da4t5dhwFAKEhVRSwThsV1qrFFDJ\nRXjTYAxBW9ATckdW8QYi/CWJvOpAOQUflDWNlbAbe0LKhu2bImN+W2nH4lKDEGS2\nhMo9ZfyiqDE1lkkYuJshGcVK82Yx3cuRe7jdsxV5Koblq+ymHs9HSQK1TKIGwrJe\nJKrKXZcxiY8BSNmJXefjhBys470WEOPB0rGRMrUcPrIKrYf+eBpRMIXoUbM4ERoO\nkpOZjK+MOi4dV9+iBGSI/xrRFD5Xpk8gifJbb4vNXUSlBG1btxBwFD6QSTurxS4D\n40HPbCcVzqOI0Fq8K2VscWhaBs/XCRYgAieSPPNtN3agpqYolt2msih6S3ldGt4M\nLrH6fsdKm11N2Bs80pmi1VwXesb/Q5GxozGXl1ouCuO/dh25FKxKTYj5y7wi4HhQ\nJxORroERKcSxs75QiT7ilUKdbC1wF33t9Zmw4AHdsxt+XxeYa1XUAbX0B1Q3U3zu\nu5lEWw7bJxlWjtzW6SsKXMAXKEEyeoq2A9vUkTKguouRfVazn50=\n=ZDBH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9786869a2f20af29a7428e5dd787e7cc99c99bf4",
          "sha": "9786869a2f20af29a7428e5dd787e7cc99c99bf4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9786869a2f20af29a7428e5dd787e7cc99c99bf4"
        }
      ],
      "message": "coins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:50:32Z"
      },
      "sha": "3ea641046797ad91f0f258fb635f254254089aa4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMzMjVlZDM2NDRjNmExYTJiNDljZDM3NjViZTA3ZGEzMjBhYjE4NzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c325ed3644c6a1a2b49cd3765be07da320ab1873",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c325ed3644c6a1a2b49cd3765be07da320ab1873",
      "tree": {
        "sha": "4f4ec6e50825e3eec84a0fdd27e0095fc00e1947",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4f4ec6e50825e3eec84a0fdd27e0095fc00e1947"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4f4ec6e50825e3eec84a0fdd27e0095fc00e1947\nparent 3ea641046797ad91f0f258fb635f254254089aa4\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033959 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ntest: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBgNdA//Vfrr9ZjS1Cymll0w9K2nxJAiJXknPaf1Skv6+1l71HvjNI7s3mPTCpGM\ng+0DnC+OFpOKIIW+OljcvwDQyi4m5KCijuMHkN7a8TJ1i5nTEw83AsIFMreAnfEA\nQCs7z4oggZvNtEprYH2huEDREQh4GVoMjVuafgJGZmh14ZWT+wpnchKAkWIhA95w\nMEiHhl3vXMcwveOP/DdjVsqQwXJWQjiXkrIOBLnAZf8VwV67zMdk9B7GcP9A5Wjo\ntgS9kmNoa/Ec4UzRNUSG9lf1+xqFuiWhxrwL03EU5tLBDIhqx95XbUEN/Qqs9Sk8\nlIWctJYioekdKc4kgNzq5HDTm24TAGpBNv89PVcPIjazJ38p8B8sO8C8LeJM5x4h\n1vEJb9kENGZ4Kj2kSl52098EpxcTOCCUWn5g9djXo8xyU5ihDhqAvJEPm6nbJIqh\n9SZw7FGf5yksUUBrDXv22uoQHEu4L0Ndbg4biuqEWz/5tSUmI0jb+SRzn2yuw4AR\nY6ZT6kmGqXvGKB72vrSAySZ8cmtRU67835KQ7q+4ZHrLDQ2K8dsUuIoJe7A+HaK0\nIqLZAm4+oz+cwWNNkKoz51wK5txhaZvpf7kmBjNXhyePkHfygmLfjaVqCeRHpDBV\nmPc0pCsxerXQmEp5af0X3BtIjRx6MesRTYJ4l+uBHkRp0tad/dU=\n=+Yu9\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3ea641046797ad91f0f258fb635f254254089aa4",
          "sha": "3ea641046797ad91f0f258fb635f254254089aa4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3ea641046797ad91f0f258fb635f254254089aa4"
        }
      ],
      "message": "test: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:52:39Z"
      },
      "sha": "c325ed3644c6a1a2b49cd3765be07da320ab1873"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc2NDVhNzUwNDM5NjUyNGNhNmU5MDFmYzdmYmM0NWU0ZmVmMWVmNDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7645a7504396524ca6e901fc7fbc45e4fef1ef49",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7645a7504396524ca6e901fc7fbc45e4fef1ef49",
      "tree": {
        "sha": "bf3286da1925b18ca79771cce42b544128e50081",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bf3286da1925b18ca79771cce42b544128e50081"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bf3286da1925b18ca79771cce42b544128e50081\nparent c325ed3644c6a1a2b49cd3765be07da320ab1873\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034147 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ntest: assert no FRESH-but-not-DIRTY coins can occur\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBiw0A/7Bi0xHixAXIoHVNAGV/EdBYqm4qbWOJaNF/UaNcusYFrHDRuhIUQWzIsM\nnDyyvFDBr8YYOYB4D5u37H8RHBTPbe49LkDm21/zV0DhhzhHLofZR5zH8haait/O\nCsMcYWIENbVXIEJCJJY19KXYOIg0JEGQFCQjHidAX34ViiI5KboGN/zIQRYhB5ZP\nRpXr7mA3Te/1yX/8E03xnS6hw5Xz2dqLc5Eawo5a0XClZZgDfeqtT+i/acBkoaGx\n2r2hQTMnQulqW1nLthlpO4YVRU+x500Io4jzFJShzQ9O5w+dte96L8JDidKZyIJk\n9H9iBgjEhKXMxCNkf/sHs5ZoovEqpQ2bnjDe5/9Jy4dry6EtH0PGanHK2KpHqa0F\n3NLIHOmuqyq7wyG2cMb8T21wSL1PrYePv7ulKHFWEFgNaygtMfqUsb5xtveg4cfq\nIvIJ2Y0twNKeWDlXYGHWHW1b4l38dGIDFdY5kz89ZJTCJBaAgIuS2baSLIL1ub2T\nCVkgLgyb9IWJUoRRvucU+nAbav8PmqmyvLC20vxmGG6AhhlEcqoGurDePAwMGN5l\nEd586r3NjblFmQC+mPGRKZcB6sSyxQ2wxwaQibuUrvKsegahqbANOrHmR4bvCOND\npkcIShgfGlDBYdz11Urbdz0mj9gB2pexW+ZZBwjNMZ/iwkgpY+8=\n=5hFE\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c325ed3644c6a1a2b49cd3765be07da320ab1873",
          "sha": "c325ed3644c6a1a2b49cd3765be07da320ab1873",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c325ed3644c6a1a2b49cd3765be07da320ab1873"
        }
      ],
      "message": "test: assert no FRESH-but-not-DIRTY coins can occur",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:55:47Z"
      },
      "sha": "7645a7504396524ca6e901fc7fbc45e4fef1ef49"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZkZjhmMDcwZWUzNjAyOGIyZjRjNzk0YjMwNTYxNzllM2YzMTc0ZDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdf8f070ee36028b2f4c794b3056179e3f3174d0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fdf8f070ee36028b2f4c794b3056179e3f3174d0",
      "tree": {
        "sha": "7aadba08afc1196a9667acd1e04303afae3e67ba",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7aadba08afc1196a9667acd1e04303afae3e67ba"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7aadba08afc1196a9667acd1e04303afae3e67ba\nparent 7645a7504396524ca6e901fc7fbc45e4fef1ef49\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034772 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ncoins: remove SetFresh method from CCoinsCacheEntry\n\nThere are no instances where SetFresh is called without being\npreceded by SetDirty. This replaces SetFresh with a boolean flag\npassed to SetDirty to indicate whether the DIRTY coin should also\nbe set to FRESH. This removes the possibility of setting a\nFRESH-but-not-DIRTY cached coin state.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBiAcA/8C/UR5wDGoZ7C+w60VxSlIFdgp40jcnYIUFaXE50Bho6eN8G52Bcu8FLx\n+rIYpGL0elJoLZWmF/QN9oDUng/Gw5/bV/BW/ub2CoOLQHK6RBvfSZg9Wz5EuXUO\nTD6j3Y9NgzwexudxipYsY7oQyVJYCYdjgIXIOCZgWKO0tOhE5yDuzX8qRch3mCDY\n7OQpN97FBdAjniUmfVrKRflX4P34kDtJ0zUqUlnb3fJwKQzROgtdu84fyey7koR2\nGOBstF6YqqBNYt/9uFvHrRXY9K55AoJ5+bj4hepqlGwuOSMnULGHBMSNzkeTK9PR\nFYAoaX8sfruBHALd05SWdOSgAoDCPK6kgh3TIsc2GZ+8GMenjmeLMugQTbcPgJTx\nQ2pWMlra9r4q6H1IywXGmUNKl2kVMaD+pWvFN6OetOXyDzeWBum8kNNQQeQcQMZX\nsvBhOJYkoSahgZNEBcQ/akEHvf0cSIswf4FZlATUYeBE5+xTngGAQge3u2Tlrtu1\nWm4LuqrluRNJT9qOYpEhTG8/bcruYCnaVHRLbqHJ6SVdCM0W4t/ous7DFAz6on4n\nmpcD4uRFVVwH8u6Q7+ISuP47PaxiizNOe1NC3F/KVJ3/b3sdUKgjAoIAcWLwq/OL\nIkOmvTWg/OBKr/H9IREGgf9iIN6asfWv5mhBof1wqBQjQApCaV0=\n=z2L0\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7645a7504396524ca6e901fc7fbc45e4fef1ef49",
          "sha": "7645a7504396524ca6e901fc7fbc45e4fef1ef49",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7645a7504396524ca6e901fc7fbc45e4fef1ef49"
        }
      ],
      "message": "coins: remove SetFresh method from CCoinsCacheEntry\n\nThere are no instances where SetFresh is called without being\npreceded by SetDirty. This replaces SetFresh with a boolean flag\npassed to SetDirty to indicate whether the DIRTY coin should also\nbe set to FRESH. This removes the possibility of setting a\nFRESH-but-not-DIRTY cached coin state.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:06:12Z"
      },
      "sha": "fdf8f070ee36028b2f4c794b3056179e3f3174d0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk5YjI0M2Q1M2U3Y2EzZTgyNDM2OWU3ZTE5NDk4MWQ4MTRjMDQ3MDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/99b243d53e7ca3e824369e7e194981d814c04708",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/99b243d53e7ca3e824369e7e194981d814c04708",
      "tree": {
        "sha": "1421ddcbd9960c7d16423778e369bf4c91d2e541",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1421ddcbd9960c7d16423778e369bf4c91d2e541"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1421ddcbd9960c7d16423778e369bf4c91d2e541\nparent fdf8f070ee36028b2f4c794b3056179e3f3174d0\nauthor Andrew Toth <andrewstoth@gmail.com> 1753034941 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753064468 -0400\n\ncoins: inline CCoinsViewCache::AddFlags into SetDirty\n\nThere is only one callsite now for AddFlags, so we can inline\nit into SetDirty.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9pBQACgkQYAB6/Ik4\nsBi3ow//VAAxBpHvnzxBb1ysgB4BSl9jz5gjvyJT73pJ5N3mWuFTge72oX7a/zuw\noOayMaMejhQSqLKaIzYgbdZWNGKhf4Sqt7mrHYVDCu8ebQkm1wEsu3cCMdHgZkR1\nUr+3ZR9mHwCG265NYKcE/8xzciXEoMH9tdHc40QFx6sRnvWFPP6ALFErj5Vas88O\nsdO/t7G51O6SxK5QSfR/s1S75ftPsooQZJO/DYp9+1bD3tzkhGW0Vb7ATGC2wwrb\nbc4PPT4nj8lWYxkkKNsa5GJ5CkKjWWaLouzC29FRwMiN4v73QTfA65xOLnyz+7Eg\nGupIIFINMhthFzWZOaMY+oDc6NvHfajef3KZkHnVfcaDKG1CeufVrPdm0XCwfWno\nyhXO/lIUfJ0t6j+x462mov4kK1BPHczoSWgupI+JRLGUD2ujLYhyQoMdz4BZHkET\natfl6q79c1RyxTUrGCnLwuAAbLONUVnOxb+xZCJKFgw77OPSyt+iEYmkZytLdYkl\nQB9wcAiUcZBX6NvUhdhJZ89RlC+ANFM4WglDI//8XRXBvFiDtSNC9BF5HSfFWCqF\nY6H3CeM9QS1onZ3xsp/5guF26ITyLkwFywIpX8S0r4ZKCfj67EBQnBRALXsu2Ibc\n71Ot2ZVU6MQUw2XGj0XhGtenjAv95fm4EP9CRo4ZW2nEXsRuWOs=\n=yN40\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdf8f070ee36028b2f4c794b3056179e3f3174d0",
          "sha": "fdf8f070ee36028b2f4c794b3056179e3f3174d0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fdf8f070ee36028b2f4c794b3056179e3f3174d0"
        }
      ],
      "message": "coins: inline CCoinsViewCache::AddFlags into SetDirty\n\nThere is only one callsite now for AddFlags, so we can inline\nit into SetDirty.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T02:21:08Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:09:01Z"
      },
      "sha": "99b243d53e7ca3e824369e7e194981d814c04708"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18719537063,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbxXen",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719537063",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/99b243d53e7ca3e824369e7e194981d814c04708",
      "created_at": "2025-07-21T02:21:13Z"
    },
    {
      "event": "labeled",
      "id": 18719538269,
      "node_id": "LE_lADOABII587Bc6GezwAAAARbxXxd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719538269",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:21:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3095048145,
      "node_id": "IC_kwDOABII5864eq_R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3095048145",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T02:21:26Z",
      "updated_at": "2025-07-21T02:21:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `CentOS, depends, gui`: https://github.com/bitcoin/bitcoin/runs/46353382966</sub>\n<sub>LLM reason (✨ experimental): The CI failure is caused by an assertion failure in coins.cpp during the coins_tests, leading to subprocess abortion.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3095048145",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "unlabeled",
      "id": 18721406277,
      "node_id": "UNLE_lADOABII587Bc6GezwAAAARb4f1F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18721406277",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-21T06:04:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 20300507169,
      "node_id": "LE_lADOABII587Bc6GezwAAAAS6ASgh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20300507169",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-15T16:28:46Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3407325621,
      "node_id": "IC_kwDOABII587LF6m1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3407325621",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-15T16:28:47Z",
      "updated_at": "2025-10-15T16:28:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3407325621",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312",
      "pull_request_review_id": 3036128101,
      "id": 2217920312,
      "node_id": "PRRC_kwDOABII586EMsc4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We should be able to remove `HaveCoin` now, since\r\n```C++\r\nbool CCoinsView::HaveCoin(const COutPoint &outpoint) const\r\n{\r\n    return GetCoin(outpoint).has_value();\r\n}\r\n```\r\nis more accurate (especially with the new extra assert)",
      "created_at": "2025-07-20T19:01:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920312",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379",
      "pull_request_review_id": 3036128101,
      "id": 2217920379,
      "node_id": "PRRC_kwDOABII586EMsd7",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Now that we've removed it we should at least add an `Assume(!ret->second.coin.IsSpent());` here - or even an `assert`, since if we're not sure about this we shouldn't do it in the first place",
      "created_at": "2025-07-20T19:01:26Z",
      "updated_at": "2025-07-20T19:26:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920379",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517",
      "pull_request_review_id": 3036128101,
      "id": 2217920517,
      "node_id": "PRRC_kwDOABII586EMsgF",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I understand if you think it may modify too many things here, but I'd prefer an actual `Assume` instead of the comment:\r\n```suggestion\r\n    CoinsCachePair* Next() const noexcept\r\n    {\r\n        Assume(IsDirty());\r\n        return m_next;\r\n    }\r\n```\r\n\r\n(same for `Prev`)",
      "created_at": "2025-07-20T19:02:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920517",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827",
      "pull_request_review_id": 3036128101,
      "id": 2217920827,
      "node_id": "PRRC_kwDOABII586EMsk7",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "we might want to mention in the commit message why we can safely remove this now",
      "created_at": "2025-07-20T19:03:03Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211",
      "pull_request_review_id": 3036128101,
      "id": 2217921211,
      "node_id": "PRRC_kwDOABII586EMsq7",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What should happen when `fresh` is `false`?\r\nShouldn't we assert something like:\r\n```C++\r\nif (fresh) {\r\n    pair.second.m_flags |= FRESH; \r\n} else {\r\n    assert(!(pair.second.m_flags & FRESH));\r\n}",
      "created_at": "2025-07-20T19:04:30Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921211",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830",
      "pull_request_review_id": 3036128101,
      "id": 2217921830,
      "node_id": "PRRC_kwDOABII586EMs0m",
      "diff_hunk": "@@ -154,16 +154,16 @@ BOOST_AUTO_TEST_CASE(linked_list_set_state)\n     BOOST_CHECK_EQUAL(sentinel.second.Next(), &n1);\n     BOOST_CHECK_EQUAL(sentinel.second.Prev(), &n1);\n \n-    // Check that setting FRESH on new node inserts it after n1\n-    CCoinsCacheEntry::SetFresh(n2, sentinel);\n-    BOOST_CHECK(n2.second.IsFresh() && !n2.second.IsDirty());\n+    // Check that setting DIRTY and FRESH on new node inserts it after n1\n+    CCoinsCacheEntry::SetDirty(n2, sentinel, /*fresh=*/true);\n+    BOOST_CHECK(n2.second.IsFresh() && n2.second.IsDirty());",
      "path": "src/test/coinscachepair_tests.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: for consistency with other `SetDirty` calls we could swap the parameter order:\r\n```suggestion\r\n    BOOST_CHECK(n2.second.IsDirty() && n2.second.IsFresh());\r\n```\r\n\r\n----\r\n\r\nAlternatively we could rename `IsFresh` to `IsDirtyAndFresh` and assert that if fresh is true, so is dirty - which would simplify this line to asserting just a single method.",
      "created_at": "2025-07-20T19:06:43Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921830",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071",
      "pull_request_review_id": 3036128101,
      "id": 2217922071,
      "node_id": "PRRC_kwDOABII586EMs4X",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 15,
      "original_position": 6,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "definition of `fresh` should likely include `dirty` now:\r\n```C++\r\nconst auto fresh{dirty && fuzzed_data_provider.ConsumeBool()};\r\n```",
      "created_at": "2025-07-20T19:07:45Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922071",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169",
      "pull_request_review_id": 3036128101,
      "id": 2217922169,
      "node_id": "PRRC_kwDOABII586EMs55",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.\r\n```\r\n(the or/and combination is confusing otherwise)",
      "created_at": "2025-07-20T19:08:14Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008",
      "pull_request_review_id": 3036128101,
      "id": 2217923008,
      "node_id": "PRRC_kwDOABII586EMtHA",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: for consistency with other overrides:\r\n```suggestion\r\n        if (auto it{m_data.find(outpoint)}; it != m_data.end()) {\r\n```",
      "created_at": "2025-07-20T19:10:42Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217923008",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887",
      "pull_request_review_id": 3036128101,
      "id": 2217925887,
      "node_id": "PRRC_kwDOABII586EMtz_",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "great, now that we have this, can we call `SanityCheck` in more tests? I understood that we couldn't do it until now since we still had invalid states in fuzz/unit tests",
      "created_at": "2025-07-20T19:17:42Z",
      "updated_at": "2025-07-20T19:27:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217925887",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983",
      "pull_request_review_id": 3036282843,
      "id": 2218040983,
      "node_id": "PRRC_kwDOABII586ENJ6X",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 25,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "note: the cursor contains dirty entries now, so `if (!it->second.IsDirty()) {` on line 186 is also a noop - could we add a TODO there to signal that we're aware of it but want to tackle it in a follow-up?",
      "created_at": "2025-07-21T01:11:45Z",
      "updated_at": "2025-07-21T01:11:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218040983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 206,
      "original_line": 206,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169",
      "pull_request_review_id": 3036298262,
      "id": 2218050169,
      "node_id": "PRRC_kwDOABII586ENMJ5",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:05Z",
      "updated_at": "2025-07-21T01:29:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233",
      "pull_request_review_id": 3036298324,
      "id": 2218050233,
      "node_id": "PRRC_kwDOABII586ENMK5",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920379,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:13Z",
      "updated_at": "2025-07-21T01:29:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050233",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997",
      "pull_request_review_id": 3036299636,
      "id": 2218050997,
      "node_id": "PRRC_kwDOABII586ENMW1",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't see how that is different. `m_flags` being set implies `IsDirty()` now, so it is equivalent. I prefer not to change this.",
      "created_at": "2025-07-21T01:30:06Z",
      "updated_at": "2025-07-21T01:30:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411",
      "pull_request_review_id": 3036303265,
      "id": 2218053411,
      "node_id": "PRRC_kwDOABII586ENM8j",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`Assume(m_flags);` would also be true for fresh only - `Assume(IsDirty());` is stricter",
      "created_at": "2025-07-21T01:34:38Z",
      "updated_at": "2025-07-21T01:37:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218053411",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579",
      "pull_request_review_id": 3036305261,
      "id": 2218054579,
      "node_id": "PRRC_kwDOABII586ENNOz",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Isn't that the same as the parent in `CCoinsView`?",
      "created_at": "2025-07-21T01:37:04Z",
      "updated_at": "2025-07-21T01:37:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218054579",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776",
      "pull_request_review_id": 3036316470,
      "id": 2218061776,
      "node_id": "PRRC_kwDOABII586ENO_Q",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It's not possible to set fresh only now.",
      "created_at": "2025-07-21T01:47:42Z",
      "updated_at": "2025-07-21T01:47:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218061776",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237",
      "pull_request_review_id": 3036320785,
      "id": 2218064237,
      "node_id": "PRRC_kwDOABII586ENPlt",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Exactly, hence my recommendation ",
      "created_at": "2025-07-21T01:51:53Z",
      "updated_at": "2025-07-21T01:51:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218064237",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867",
      "pull_request_review_id": 3036325893,
      "id": 2218067867,
      "node_id": "PRRC_kwDOABII586ENQeb",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922169,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:56:35Z",
      "updated_at": "2025-07-21T01:56:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273",
      "pull_request_review_id": 3036326661,
      "id": 2218068273,
      "node_id": "PRRC_kwDOABII586ENQkx",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We can't since we are still calling this with spent, dirty, and fresh entries. These would be deleted in production code. That can also be tackled in a follow-up.",
      "created_at": "2025-07-21T01:57:14Z",
      "updated_at": "2025-07-21T01:57:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575",
      "pull_request_review_id": 3036327280,
      "id": 2218068575,
      "node_id": "PRRC_kwDOABII586ENQpf",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 25,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2218040983,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "There are quite a few places where we can clean up production and test logic to not have to deal with non-dirty entries in BatchWrite. I think there would be too many TODOs.",
      "created_at": "2025-07-21T01:57:47Z",
      "updated_at": "2025-07-21T01:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068575",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 206,
      "original_line": 206,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664",
      "pull_request_review_id": 3036327359,
      "id": 2218068664,
      "node_id": "PRRC_kwDOABII586ENQq4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217923008,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:57:54Z",
      "updated_at": "2025-07-21T01:57:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068664",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073",
      "pull_request_review_id": 3036328308,
      "id": 2218069073,
      "node_id": "PRRC_kwDOABII586ENQxR",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "You did enable it for a few additional cases, that's already a win 👍 ",
      "created_at": "2025-07-21T01:59:02Z",
      "updated_at": "2025-07-21T01:59:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069073",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128",
      "pull_request_review_id": 3036328369,
      "id": 2218069128,
      "node_id": "PRRC_kwDOABII586ENQyI",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 15,
      "original_position": 6,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922071,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:59:08Z",
      "updated_at": "2025-07-21T01:59:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069128",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218070113",
      "pull_request_review_id": 3036329626,
      "id": 2218070113,
      "node_id": "PRRC_kwDOABII586ENRBh",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Err, I did but didn't test locally before pushing. I will have to revert. Tests are failing.",
      "created_at": "2025-07-21T02:01:21Z",
      "updated_at": "2025-07-21T02:01:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218070113",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218070113"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071116",
      "pull_request_review_id": 3036331142,
      "id": 2218071116,
      "node_id": "PRRC_kwDOABII586ENRRM",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920827,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't see what can be explained more than the code? This seems obvious to me.",
      "created_at": "2025-07-21T02:04:03Z",
      "updated_at": "2025-07-21T02:04:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071185",
      "pull_request_review_id": 3036331255,
      "id": 2218071185,
      "node_id": "PRRC_kwDOABII586ENRSR",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can we fix those cases instead? Having a sanitycheck which isn't run just gives us a false sense of security otherwise\r\n",
      "created_at": "2025-07-21T02:04:15Z",
      "updated_at": "2025-07-21T02:04:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071185",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071185"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071890",
      "pull_request_review_id": 3036332453,
      "id": 2218071890,
      "node_id": "PRRC_kwDOABII586ENRdS",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920827,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ok, agree, please resolve the comment",
      "created_at": "2025-07-21T02:05:34Z",
      "updated_at": "2025-07-21T02:05:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218071890",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218071890"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218079735",
      "pull_request_review_id": 3036343490,
      "id": 2218079735,
      "node_id": "PRRC_kwDOABII586ENTX3",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ah right, removed.",
      "created_at": "2025-07-21T02:21:43Z",
      "updated_at": "2025-07-21T02:21:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218079735",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218079735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218080120",
      "pull_request_review_id": 3036343964,
      "id": 2218080120,
      "node_id": "PRRC_kwDOABII586ENTd4",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I suppose its legal to call SetDirty on a coin that is already DIRTY-and-FRESH. I'm not sure we need to do anything here in that case.",
      "created_at": "2025-07-21T02:22:30Z",
      "updated_at": "2025-07-21T02:22:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218080120",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218080120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218081257",
      "pull_request_review_id": 3036345672,
      "id": 2218081257,
      "node_id": "PRRC_kwDOABII586ENTvp",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Should we remove its freshness in that case?",
      "created_at": "2025-07-21T02:24:47Z",
      "updated_at": "2025-07-21T02:24:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218081257",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218081257"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218084376",
      "pull_request_review_id": 3036350295,
      "id": 2218084376,
      "node_id": "PRRC_kwDOABII586ENUgY",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "No, that would make this a behavior change rather than a refactor. We only added flags before, so we must only do that now as well.",
      "created_at": "2025-07-21T02:29:55Z",
      "updated_at": "2025-07-21T02:29:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218084376",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218084376"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086462",
      "pull_request_review_id": 3036353147,
      "id": 2218086462,
      "node_id": "PRRC_kwDOABII586ENVA-",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "But we have prohibited one of the states here, we can document that with code now instead of comments. If we think it's a behavior change the PR is incorrect, isn't it?",
      "created_at": "2025-07-21T02:34:31Z",
      "updated_at": "2025-07-21T02:34:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218086462",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086462"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086535",
      "pull_request_review_id": 3036353511,
      "id": 2218086535,
      "node_id": "PRRC_kwDOABII586ENVCH",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I can make a follow-up to remove spent fresh and dirty entries from the test cases as well. I don't think that should happen in this PR though to keep it focused.\nThe previous PR also did this.",
      "created_at": "2025-07-21T02:34:43Z",
      "updated_at": "2025-07-21T02:34:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218086535",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218086535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218092689",
      "pull_request_review_id": 3036363265,
      "id": 2218092689,
      "node_id": "PRRC_kwDOABII586ENWiR",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Your suggestion is to assert that if fresh is false then the entry cannot already be fresh. This is not the case. An entry can be made DIRTY-and-FRESH, and then it can be made DIRTY again while already DIRTY-and-FRESH. The current behavior allows this to happen and keeps the entry DIRTY-and-FRESH when SetDirty is called. If we assert that we can't call SetDirty on a DIRTY-and-FRESH entry then it is a behavior change.",
      "created_at": "2025-07-21T02:45:01Z",
      "updated_at": "2025-07-21T02:45:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218092689",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218092689"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218093659",
      "pull_request_review_id": 3036364564,
      "id": 2218093659,
      "node_id": "PRRC_kwDOABII586ENWxb",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "99b243d53e7ca3e824369e7e194981d814c04708",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217921211,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nah, I'm just on a phone and thought I'm commenting on SetDirty and SetFresh. ",
      "created_at": "2025-07-21T02:47:07Z",
      "updated_at": "2025-07-21T02:47:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218093659",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218093659"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    }
  ]
}
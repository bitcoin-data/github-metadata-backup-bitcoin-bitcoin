{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015",
    "id": 2378191350,
    "node_id": "PR_kwDOABII586NwFH2",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32015",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32015.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32015.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
    "number": 32015,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "net: replace manual reference counting of CNode with shared_ptr",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Before this change the code used to count references to `CNode` objects manually via `CNode::nRefCount`. Unneeded `CNode`s were scheduled for deletion by putting them in `CConnman::m_nodes_disconnected` and were deleted after their reference count reached zero. Deleting consists of calling `PeerManager::FinalizeNode()` and destroying the `CNode` object.\r\n\r\nReplace this scheme with `std::shared_ptr`. This simplifies the code and removes:\r\n`CNode::nRefCount`\r\n`CNode::GetRefCount()`\r\n`CNode::AddRef()`\r\n`CNode::Release()`\r\n`CConnman::m_nodes_disconnected`\r\n`CConnman::NodesSnapshot`\r\n\r\nNow creating a snapshot of `CConnman::m_nodes` is done by simply copying it (under the mutex).\r\n\r\nCall `PeerManager::FinalizeNode()` from the destructor of `CNode`, which is called when the reference count reaches 0.\r\n\r\n---\r\n\r\nThis has some history in https://github.com/bitcoin/bitcoin/pull/28222 and https://github.com/bitcoin/bitcoin/pull/10738. See below https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717384152 and https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717860925.\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2025-03-07T09:53:01Z",
    "updated_at": "2025-03-16T07:22:53Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "c0cbabc14d70d66ca92d941f0551aa7128da0717",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "vasild:cnode_shared_ptr",
      "ref": "cnode_shared_ptr",
      "sha": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 120608826,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjA2MDg4MjY=",
        "name": "bitcoin",
        "full_name": "vasild/bitcoin",
        "owner": {
          "login": "vasild",
          "id": 266751,
          "node_id": "MDQ6VXNlcjI2Njc1MQ==",
          "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/vasild",
          "html_url": "https://github.com/vasild",
          "followers_url": "https://api.github.com/users/vasild/followers",
          "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
          "organizations_url": "https://api.github.com/users/vasild/orgs",
          "repos_url": "https://api.github.com/users/vasild/repos",
          "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/vasild/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/vasild/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/vasild/bitcoin",
        "archive_url": "https://api.github.com/repos/vasild/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/vasild/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/vasild/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/vasild/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/vasild/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/vasild/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/vasild/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/vasild/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/vasild/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/vasild/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/vasild/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/vasild/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/vasild/bitcoin/events",
        "forks_url": "https://api.github.com/repos/vasild/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/vasild/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/vasild/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/vasild/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/vasild/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/vasild/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/vasild/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/vasild/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/vasild/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/vasild/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/vasild/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/vasild/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/vasild/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/vasild/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/vasild/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/vasild/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:vasild/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/vasild/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/vasild/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/vasild/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/vasild/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/vasild/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/vasild/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/vasild/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/vasild/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/vasild/bitcoin/hooks",
        "svn_url": "https://github.com/vasild/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 7,
        "watchers_count": 7,
        "size": 253700,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-14T12:42:11Z",
        "created_at": "2018-02-07T11:52:47Z",
        "updated_at": "2025-03-14T08:09:20Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "502d47203e7e10b273c66e5a2ee7bb1d67593dc0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36932,
        "stargazers_count": 82476,
        "watchers_count": 82476,
        "size": 278049,
        "default_branch": "master",
        "open_issues_count": 694,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-14T03:23:42Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-03-16T07:48:50Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 191,
    "deletions": 258,
    "changed_files": 11,
    "commits": 1,
    "review_comments": 21,
    "comments": 18
  },
  "events": [
    {
      "event": "commented",
      "id": 2706010466,
      "node_id": "IC_kwDOABII586hSnFi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706010466",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:04Z",
      "updated_at": "2025-03-16T07:22:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32015.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2668522266) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32073](https://github.com/bitcoin/bitcoin/pull/32073) (net: Only attempt v2->v1 transport downgrade if online by hodlinator)\n* [#32061](https://github.com/bitcoin/bitcoin/pull/32061) ([draft] Replace libevent with our own HTTP and socket-handling implementation by pinheadmz)\n* [#31868](https://github.com/bitcoin/bitcoin/pull/31868) ([IBD] specialize block serialization by l0rinc)\n* [#31672](https://github.com/bitcoin/bitcoin/pull/31672) (rpc: add cpu_load to getpeerinfo by vasild)\n* [#31519](https://github.com/bitcoin/bitcoin/pull/31519) (refactor: Use std::span over Span by maflcko)\n* [#30988](https://github.com/bitcoin/bitcoin/pull/30988) (Split CConnman by vasild)\n* [#30951](https://github.com/bitcoin/bitcoin/pull/30951) (net: option to disallow v1 connection on ipv4 and ipv6 peers by stratospher)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n* [#28463](https://github.com/bitcoin/bitcoin/pull/28463) (p2p: Increase inbound capacity for block-relay only connections by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706010466",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "labeled",
      "id": 16629735375,
      "node_id": "LE_lADOABII586tARLSzwAAAAPfNZ_P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629735375",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:07Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 2706012277,
      "node_id": "IC_kwDOABII586hSnh1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706012277",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:53Z",
      "updated_at": "2025-03-07T09:53:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "cc @willcl-ark, @dergoegge, @theuni ",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706012277",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "mentioned",
      "id": 16629746709,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPfNcwV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746709",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "subscribed",
      "id": 16629746730,
      "node_id": "SE_lADOABII586tARLSzwAAAAPfNcwq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746730",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "mentioned",
      "id": 16629746758,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPfNcxG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746758",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "subscribed",
      "id": 16629746779,
      "node_id": "SE_lADOABII586tARLSzwAAAAPfNcxb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746779",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "mentioned",
      "id": 16629746802,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPfNcxy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746802",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "subscribed",
      "id": 16629746821,
      "node_id": "SE_lADOABII586tARLSzwAAAAPfNcyF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629746821",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:53:54Z"
    },
    {
      "event": "commented",
      "id": 2706016805,
      "node_id": "IC_kwDOABII586hSool",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706016805",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:55:59Z",
      "updated_at": "2025-03-07T09:55:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "cc @hodlinator, you might be interested in this as well",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706016805",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "mentioned",
      "id": 16629775507,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPfNjyT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629775507",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:56:00Z"
    },
    {
      "event": "subscribed",
      "id": 16629775519,
      "node_id": "SE_lADOABII586tARLSzwAAAAPfNjyf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16629775519",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T09:56:00Z"
    },
    {
      "event": "commented",
      "id": 2706054855,
      "node_id": "IC_kwDOABII586hSx7H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706054855",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T10:13:26Z",
      "updated_at": "2025-03-07T10:13:26Z",
      "author_association": "MEMBER",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/13718139296/job/38367326902?pr=32015#step:7:1603:\r\n```bash\r\nRun p2p_headers_presync with args ['/Users/runner/work/bitcoin/bitcoin/ci/scratch/build-aarch64-apple-darwin23.6.0/src/test/fuzz/fuzz', PosixPath('/Users/runner/work/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_corpora/p2p_headers_presync')]net_processing.cpp:295 SetTxRelay: Assertion `!m_tx_relay' failed.\r\nError processing input \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_corpora/p2p_headers_presync/c12f87158cda99b4fb2e1fe7312af392a1f4634a\"\r\n\r\nnet_processing.cpp:295 SetTxRelay: Assertion `!m_tx_relay' failed.\r\nError processing input \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_corpora/p2p_headers_presync/c12f87158cda99b4fb2e1fe7312af392a1f4634a\"\r\n```",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706054855",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "reviewed",
      "id": 2666944030,
      "node_id": "PRR_kwDOABII586e9lYe",
      "url": null,
      "actor": null,
      "commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2666944030",
      "submitted_at": "2025-03-07T11:03:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
    },
    {
      "event": "labeled",
      "id": 16630969657,
      "node_id": "LE_lADOABII586tARLSzwAAAAPfSHU5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16630969657",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T11:14:11Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2706186536,
      "node_id": "IC_kwDOABII586hTSEo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706186536",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T11:14:12Z",
      "updated_at": "2025-03-07T11:14:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/38367328595</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706186536",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16632514500,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPfYAfE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16632514500",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e35a382388d230daa0e05d41b53dc46117f9898e",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/e35a382388d230daa0e05d41b53dc46117f9898e",
      "created_at": "2025-03-07T13:22:11Z"
    },
    {
      "event": "commented",
      "id": 2706446575,
      "node_id": "IC_kwDOABII586hURjv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2706446575",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T13:23:01Z",
      "updated_at": "2025-03-07T13:23:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "`2747f135be...e35a382388`: fix the CI failure, thanks!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2706446575",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16633047252,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPfaCjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16633047252",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "36d932cebbb235a79e90575960646e86a23d39a8",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/36d932cebbb235a79e90575960646e86a23d39a8",
      "created_at": "2025-03-07T14:02:31Z"
    },
    {
      "event": "unlabeled",
      "id": 16634179327,
      "node_id": "UNLE_lADOABII586tARLSzwAAAAPfeW7_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16634179327",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T15:23:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2668522266,
      "node_id": "PRR_kwDOABII586fDmsa",
      "url": null,
      "actor": null,
      "commit_id": "36d932cebbb235a79e90575960646e86a23d39a8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 36d932cebbb235a79e90575960646e86a23d39a8",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2668522266",
      "submitted_at": "2025-03-07T23:13:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16657708442,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPg4HWa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16657708442",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "created_at": "2025-03-10T16:06:36Z"
    },
    {
      "event": "commented",
      "id": 2711102281,
      "node_id": "IC_kwDOABII586hmCNJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2711102281",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T16:07:17Z",
      "updated_at": "2025-03-10T16:07:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "`36d932cebb...af622d00ba`: address https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1985793960",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2711102281",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "commented",
      "id": 2711463453,
      "node_id": "IC_kwDOABII586hnaYd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2711463453",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T18:24:49Z",
      "updated_at": "2025-03-10T18:24:49Z",
      "author_association": "CONTRIBUTOR",
      "body": "Instead of passing around shared pointers to mutable data (aka global variables in disguise), would it be possible to increase the level of abstraction and pass around values with regular semantics? Every C++ programmer should rewatch https://youtu.be/W2tWOdzgXHA from time to time.",
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2711463453",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "commented",
      "id": 2711668773,
      "node_id": "IC_kwDOABII586hoMgl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2711668773",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T19:51:54Z",
      "updated_at": "2025-03-10T19:51:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Every C++ programmer should rewatch https://youtu.be/W2tWOdzgXHA from time to time.\r\n\r\nI remembered that as \"the seminal `std::rotate()`-talk\", but it also has \"No Raw Pointers\" from 48:45. Probably stoked my hatred of smart pointers which led to #31713. To be fair, in the talk he also says that we used to do intrusive ref-counting... so this is at least one step away from that.\r\n\r\n> Instead of passing around shared pointers to mutable data (aka global variables in disguise), would it be possible to increase the level of abstraction and pass around values with regular semantics?\r\n\r\nGuess one could have an `InternalCNode` which is the actual meat, and make the public `CNode` instances hold `shared_ptr<InternalCNode>`. Not sure how well that plays out.\r\nMaybe you  @purpleKarrot could take a stab at something along the lines of what you pointed to? Keep in mind that we try to minimize the number of lines touched in a change unless necessary.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2711668773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "mentioned",
      "id": 16660721697,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPhDnAh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16660721697",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T19:51:56Z"
    },
    {
      "event": "subscribed",
      "id": 16660721718,
      "node_id": "SE_lADOABII586tARLSzwAAAAPhDnA2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16660721718",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T19:51:56Z"
    },
    {
      "event": "commented",
      "id": 2711842250,
      "node_id": "IC_kwDOABII586ho23K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2711842250",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T21:08:30Z",
      "updated_at": "2025-03-10T21:08:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "After reviewing the code line by line, I realized that the only places where `AddRef` was ever called, was directly after construction (plus one place in the fuzz tests, not sure why that is needed). It looks like the `CNode` instances are not actually shared (good news). Could it be passed around by `std::unique_ptr` instead? This would greatly simplify future refactoring.",
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2711842250",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "commented",
      "id": 2711968502,
      "node_id": "IC_kwDOABII586hpVr2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2711968502",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T22:15:26Z",
      "updated_at": "2025-03-10T22:15:26Z",
      "author_association": "MEMBER",
      "body": ">  realized that the only places where AddRef was ever called, was directly after construction\r\n\r\nIt is also called in the RAII helper `NodesSnapshot` which is used in different threads (i.e. \"net\" and \"msghand\"), so `unique_ptr` won't work unfortunately.\r\n\r\n> plus one place in the fuzz tests, not sure why that is needed\r\n\r\nIt's probably just there to have it \"covered\".",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2711968502",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "reviewed",
      "id": 2672347152,
      "node_id": "PRR_kwDOABII586fSMgQ",
      "url": null,
      "actor": null,
      "commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2672347152",
      "submitted_at": "2025-03-10T22:41:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
    },
    {
      "event": "reviewed",
      "id": 2672297590,
      "node_id": "PRR_kwDOABII586fSAZ2",
      "url": null,
      "actor": null,
      "commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2672297590",
      "submitted_at": "2025-03-10T22:58:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
    },
    {
      "event": "commented",
      "id": 2712060971,
      "node_id": "IC_kwDOABII586hpsQr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2712060971",
      "actor": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-10T23:18:39Z",
      "updated_at": "2025-03-10T23:18:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "> unique_ptr won't work unfortunately.\r\n\r\nGot it. `m_nodes` needs to be able to be snapshotted. But that seems to be the only place where copies are made. `FindNode` should return non-owning observers rather than extend the ownership.",
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2712060971",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16682244877,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPiVtsN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16682244877",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "d233c7e9996912ef708d64a52604f3d5e8b54f47",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/d233c7e9996912ef708d64a52604f3d5e8b54f47",
      "created_at": "2025-03-11T11:55:11Z"
    },
    {
      "event": "commented",
      "id": 2713885677,
      "node_id": "IC_kwDOABII586hwpvt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2713885677",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T11:55:36Z",
      "updated_at": "2025-03-11T11:55:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "`af622d00ba...d233c7e999`: address https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988085255",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2713885677",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16682764869,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPiXspF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16682764869",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "created_at": "2025-03-11T11:59:56Z"
    },
    {
      "event": "commented",
      "id": 2713906394,
      "node_id": "IC_kwDOABII586hwuza",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2713906394",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T12:00:24Z",
      "updated_at": "2025-03-11T12:00:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "`d233c7e999...4492abbf0a`: rebase and address https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988125455",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2713906394",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "reviewed",
      "id": 2674417539,
      "node_id": "PRR_kwDOABII586faF-D",
      "url": null,
      "actor": null,
      "commit_id": "4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#pullrequestreview-2674417539",
      "submitted_at": "2025-03-11T20:19:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhjMGNlMWNhMWM1ZjQ3MDFjMjRkYzc3MjEyMzdmOWFmM2ZiMDJmYWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "tree": {
        "sha": "c0f40f374d9554a5636625326ad107109ad4edb7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0f40f374d9554a5636625326ad107109ad4edb7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0f40f374d9554a5636625326ad107109ad4edb7\nparent 45719390a1434ad7377a5ed05dcd73028130cf2d\nauthor Vasil Dimov <vd@FreeBSD.org> 1692032928 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1741755873 +0100\n\nnet: replace manual reference counting of CNode with shared_ptr\n\nBefore this change the code used to count references to `CNode` objects\nmanually via `CNode::nRefCount`. Unneeded `CNode`s were scheduled for\ndeletion by putting them in `CConnman::m_nodes_disconnected` and were\ndeleted after their reference count reached zero. Deleting consists of\ncalling `PeerManager::FinalizeNode()` and destroying the `CNode` object.\n\nReplace this scheme with `std::shared_ptr`. This simplifies the code and\nremoves:\n`CNode::nRefCount`\n`CNode::GetRefCount()`\n`CNode::AddRef()`\n`CNode::Release()`\n`CConnman::m_nodes_disconnected`\n`CConnman::NodesSnapshot`\n\nNow creating a snapshot of `CConnman::m_nodes` is done by simply copying\nit (under the mutex).\n\nCall `PeerManager::FinalizeNode()` from the destructor of `CNode`, which\nis called when the reference count reaches 0.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmfRFeIACgkQVN8G9ktV\ny7+2LiAAm7q36jVC6tGVxPATlkFTR6hJ0GlDVy5XbEArtapHEmt6MLJOCVb7EtDE\nECjlkEgyyDe/MbPm3Pe4cJ33wFlve18N5I9P7nXzsv9hzYnT/2WWeu2qtrVp1P8g\nIbqbtGloPvJDO1qpTARvMzN4XEzUnXL6oK5p+IgYjY+2TWYnTYXJ/hjt0tt5Ua7z\nY8avIOaaQYWPVnweYHo3r1FP9YyY2OkoAj8660y9iHQOkVHtqZIwvotLFCTuJR7r\nEAIky1JVl/UNwqWwWuHK5ZtbhZfn3bRZzWLgqkvTu8M0zjVIyq+4ntuClSEZ4sh9\njrKI1MGOHh0/wiYiaMb5Xhx7W/K/QfjFFYIEOdhPoFRdOeeVh8LXHwH2Gx0JwfxW\n3/8KdzRh44uL2RmZyVSZOfOOvE2QvOl/DjazccL630XiSng9jXUCTtTFLALT1NN9\nDQk8YHKct9+Pv/Ieal9WQX6pOL7Px7JHCfMt74bud7XzumTO4RY8HLE+oiKLqMx1\nT5k0uV3PCJiY+ix2DUhsh0kyP6PZfMRq6DFSYI3E5AVE5XlHgS5ksF7lrjIL5McX\n+sxSfbBmpNOO9yCLWPrZlOkkZi60P9lHJQTz4qaYIeQJSgW3ejvDF2jueqScG88+\nv7yJ9qhG6oMiFpja3k6Yvv/aNQMKFTuSkMTOVRyGJKbn5R69bVcJhZVS2SUIBve/\n5LwTJcycuqExdXFQE6JWgW6dGSnB4ANNJqWokMPoPaRdGYWVDTQtE9VOlyoWvOwJ\nFZZPcSl+AR+SQNja57nudRGkblMcy3BERPyqYU3VOl8wtF3aYArLq40Pl45YP9aq\nfVWMfHu7AEGpPYPUywP5graggf1JHtmGNZ+vmQrLwSrF4G5uofOJfOT6mNV0Ji00\nPa38u0DRXJq6f4hZxYn8T/qJk+ScbXZKaPY0frd5FMS3m4l3Y+9cL27ClEHWwSLB\nFjeI+1ZRFCljY6CPsfP8VLd0KCJF1dTU8sLgloy2lsV8veoaWYVSXHaLyyqxRvb4\n5ut4T2rlD64UYU7t7JdX2ALBJzlyRgRdDqs/U66GkmbsJhB34UbM7r4O+OqHJ7Tm\nlQmEVyKqkP32D78dxx16Qh0MQrMnmkAtYlNkcYsipV9O7R2kzXfgLFznix2YYFXJ\n2Yo4x+5iOY4aN524R2oGb+mdY2zjSFZCa7krq3+Xi4pLRQiYtuSL7O3bEp3MKGa9\nVV/q1pPMSA70upbShhcCSsbIbFrseefuE+1lcwikHJHwB1/R0JGBlYa45atgab05\nkCquHtIyQ525ERq0uuxnAGFFs+z7XxawWPlrLH77/J6EEyVcI7cuyaA8jaUSA4Uy\nDPU8lS+bZsE5o0uHSNwFDggDYcap5A==\n=TrgY\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/45719390a1434ad7377a5ed05dcd73028130cf2d",
          "sha": "45719390a1434ad7377a5ed05dcd73028130cf2d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/45719390a1434ad7377a5ed05dcd73028130cf2d"
        }
      ],
      "message": "net: replace manual reference counting of CNode with shared_ptr\n\nBefore this change the code used to count references to `CNode` objects\nmanually via `CNode::nRefCount`. Unneeded `CNode`s were scheduled for\ndeletion by putting them in `CConnman::m_nodes_disconnected` and were\ndeleted after their reference count reached zero. Deleting consists of\ncalling `PeerManager::FinalizeNode()` and destroying the `CNode` object.\n\nReplace this scheme with `std::shared_ptr`. This simplifies the code and\nremoves:\n`CNode::nRefCount`\n`CNode::GetRefCount()`\n`CNode::AddRef()`\n`CNode::Release()`\n`CConnman::m_nodes_disconnected`\n`CConnman::NodesSnapshot`\n\nNow creating a snapshot of `CConnman::m_nodes` is done by simply copying\nit (under the mutex).\n\nCall `PeerManager::FinalizeNode()` from the destructor of `CNode`, which\nis called when the reference count reaches 0.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2025-03-12T05:04:33Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-08-14T17:08:48Z"
      },
      "sha": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16704922171,
      "node_id": "HRFPE_lADOABII586tARLSzwAAAAPjsOI7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16704922171",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "commit_url": "https://api.github.com/repos/vasild/bitcoin/commits/8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "created_at": "2025-03-12T05:06:34Z"
    },
    {
      "event": "commented",
      "id": 2716480960,
      "node_id": "IC_kwDOABII586h6jXA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2716480960",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T05:06:51Z",
      "updated_at": "2025-03-12T05:06:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "`4492abbf0a...8c0ce1ca1c`: address https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989217778",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2716480960",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "commented",
      "id": 2717384152,
      "node_id": "IC_kwDOABII586h9_3Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2717384152",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:56Z",
      "updated_at": "2025-03-12T10:25:53Z",
      "author_association": "MEMBER",
      "body": "This seems like a nice simplification. It would be good to do before nobody remembers what the old code was trying to do (and prevent). Since @theUni tried something similar before in #10738 it would be great if he can look at this again.\r\n\r\nIn particular the 2017 PR claimed \"special care must be taken\" as to which thread destroys the object, but @vasild believes this doesn't matter (here): https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1984875189\r\n\r\nThe end result of that PR seems a lot more complicated than what this PR does, and perhaps that's part of why it didn't get a huge amount of review and was closed eventually?\r\n\r\n@willcl-ark then tried again in 2023 in #28222 (initially not knowing about the earlier attempt). Similar concerns about threading were raised: https://github.com/bitcoin/bitcoin/pull/28222#pullrequestreview-1565029167\r\n\r\nIt seems that was never really settled and the PR died.\r\n\r\nIt would be good to be address this in the PR description to prevent going in circles.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717384152",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "mentioned",
      "id": 16709837397,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPj--JV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837397",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "subscribed",
      "id": 16709837417,
      "node_id": "SE_lADOABII586tARLSzwAAAAPj--Jp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837417",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "mentioned",
      "id": 16709837439,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPj--J_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837439",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "subscribed",
      "id": 16709837454,
      "node_id": "SE_lADOABII586tARLSzwAAAAPj--KO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837454",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "mentioned",
      "id": 16709837478,
      "node_id": "MEE_lADOABII586tARLSzwAAAAPj--Km",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837478",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "subscribed",
      "id": 16709837494,
      "node_id": "SE_lADOABII586tARLSzwAAAAPj--K2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16709837494",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T10:24:58Z"
    },
    {
      "event": "commented",
      "id": 2717860925,
      "node_id": "IC_kwDOABII586h_0Q9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2717860925",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T13:18:52Z",
      "updated_at": "2025-03-12T13:18:52Z",
      "author_association": "CONTRIBUTOR",
      "body": " Some comments from the other PRs:\r\n\r\n_from https://github.com/bitcoin/bitcoin/pull/10738#issue-240283546:_\r\n> Special care must be taken, though, to only delete CNodes from a single thread, and to control which thread that is.\r\n\r\nIn `master` deletion of `CNode` objects could happen in the `net` thread or in the `main` thread. In other words, some `CNode` object might be destroyed in the `net` thread and another `CNode` object might be destroyed in the `main` thread. I do not see any problem with that. Of course we do not destroy the same object from more than one thread, in `master` or in this PR. With this PR deletion might as well happen in the `msghand` thread (when destroying the temporary copy of `m_nodes` in `ThreadMessageHandler()`). That is fine as well, correct me if I am wrong.\r\n\r\n_from https://github.com/bitcoin/bitcoin/pull/28222#pullrequestreview-1565029167:_\r\n>> which thread actually deletes the CNode.\r\n\r\n> The reason why that is important is because we only want to call FinalizeNode once and we want there to be no other references to that CNode at that time.\r\n\r\nThis PR achieves that by calling `FinalizeNode()` from `~CNode()`. Just to clarify the obvious: the destructor is called only once and at the time the destructor is called `shared_ptr` has ensured that there are no other references to the object. This is simpler and easier to reason about than the code in `master` which waits manually for the number of references to drop.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717860925",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    },
    {
      "event": "commented",
      "id": 2725084083,
      "node_id": "IC_kwDOABII586ibXuz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2725084083",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T15:48:31Z",
      "updated_at": "2025-03-14T15:48:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "Further idea around the second sentence of this:\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/10738#issue-240283546:\r\n> Special care must be taken, though, to only delete CNodes from a single thread, and to control which thread that is. Eventually, this should move to the message processing thread, so that it's not possible to hit cs_main from the main network thread.\r\n\r\nIt is possible to decouple `CNode` deletion from the `FinalizeNode()` call and do the latter in the `msghand` thread regardless of when `CNode` is deleted. `FinalizeNode()` only needs 3 properties from `CNode`, so they can be extracted out from the `CNode` object and saved to a place which later is looked up by the `msghand` thread which calls `FinalizeNode()` on that data.\r\n\r\nHere is a patch that does that:\r\n\r\n<details>\r\n<summary>[patch] Call FinalizeNode() in the message processing thread</summary>\r\n\r\n```diff\r\ndiff --git i/src/net_processing.cpp w/src/net_processing.cpp\r\nindex 1da3ec9d21..1124036a2a 100644\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -487,13 +487,13 @@ public:\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     void NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_most_recent_block_mutex);\r\n \r\n     /** Implement NetEventsInterface */\r\n     void InitializeNode(const CNode& node, ServiceFlags our_services) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_tx_download_mutex);\r\n-    void FinalizeNode(const CNode& node) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_headers_presync_mutex, !m_tx_download_mutex);\r\n+    void FinalizeNode(const NodeFinalizationData& node) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_headers_presync_mutex, !m_tx_download_mutex);\r\n     bool HasAllDesirableServiceFlags(ServiceFlags services) const override;\r\n     bool ProcessMessages(CNode* pfrom, std::atomic<bool>& interrupt) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_most_recent_block_mutex, !m_headers_presync_mutex, g_msgproc_mutex, !m_tx_download_mutex);\r\n     bool SendMessages(CNode* pto) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex, !m_most_recent_block_mutex, g_msgproc_mutex, !m_tx_download_mutex);\r\n \r\n@@ -1560,80 +1560,78 @@ void PeerManagerImpl::ReattemptInitialBroadcast(CScheduler& scheduler)\r\n     // Schedule next run for 10-15 minutes in the future.\r\n     // We add randomness on every cycle to avoid the possibility of P2P fingerprinting.\r\n     const auto delta = 10min + FastRandomContext().randrange<std::chrono::milliseconds>(5min);\r\n     scheduler.scheduleFromNow([&] { ReattemptInitialBroadcast(scheduler); }, delta);\r\n }\r\n \r\n-void PeerManagerImpl::FinalizeNode(const CNode& node)\r\n+void PeerManagerImpl::FinalizeNode(const NodeFinalizationData& node)\r\n {\r\n-    NodeId nodeid = node.GetId();\r\n     {\r\n     LOCK(cs_main);\r\n     {\r\n         // We remove the PeerRef from g_peer_map here, but we don't always\r\n         // destruct the Peer. Sometimes another thread is still holding a\r\n         // PeerRef, so the refcount is >= 1. Be careful not to do any\r\n         // processing here that assumes Peer won't be changed before it's\r\n         // destructed.\r\n-        PeerRef peer = RemovePeer(nodeid);\r\n+        PeerRef peer = RemovePeer(node.id);\r\n         assert(peer != nullptr);\r\n         m_wtxid_relay_peers -= peer->m_wtxid_relay;\r\n         assert(m_wtxid_relay_peers >= 0);\r\n     }\r\n-    CNodeState *state = State(nodeid);\r\n+    CNodeState *state = State(node.id);\r\n     assert(state != nullptr);\r\n \r\n     if (state->fSyncStarted)\r\n         nSyncStarted--;\r\n \r\n     for (const QueuedBlock& entry : state->vBlocksInFlight) {\r\n         auto range = mapBlocksInFlight.equal_range(entry.pindex->GetBlockHash());\r\n         while (range.first != range.second) {\r\n             auto [node_id, list_it] = range.first->second;\r\n-            if (node_id != nodeid) {\r\n+            if (node_id != node.id) {\r\n                 range.first++;\r\n             } else {\r\n                 range.first = mapBlocksInFlight.erase(range.first);\r\n             }\r\n         }\r\n     }\r\n     {\r\n         LOCK(m_tx_download_mutex);\r\n-        m_txdownloadman.DisconnectedPeer(nodeid);\r\n+        m_txdownloadman.DisconnectedPeer(node.id);\r\n     }\r\n-    if (m_txreconciliation) m_txreconciliation->ForgetPeer(nodeid);\r\n+    if (m_txreconciliation) m_txreconciliation->ForgetPeer(node.id);\r\n     m_num_preferred_download_peers -= state->fPreferredDownload;\r\n     m_peers_downloading_from -= (!state->vBlocksInFlight.empty());\r\n     assert(m_peers_downloading_from >= 0);\r\n     m_outbound_peers_with_protect_from_disconnect -= state->m_chain_sync.m_protect;\r\n     assert(m_outbound_peers_with_protect_from_disconnect >= 0);\r\n \r\n-    m_node_states.erase(nodeid);\r\n+    m_node_states.erase(node.id);\r\n \r\n     if (m_node_states.empty()) {\r\n         // Do a consistency check after the last peer is removed.\r\n         assert(mapBlocksInFlight.empty());\r\n         assert(m_num_preferred_download_peers == 0);\r\n         assert(m_peers_downloading_from == 0);\r\n         assert(m_outbound_peers_with_protect_from_disconnect == 0);\r\n         assert(m_wtxid_relay_peers == 0);\r\n         WITH_LOCK(m_tx_download_mutex, m_txdownloadman.CheckIsEmpty());\r\n     }\r\n     } // cs_main\r\n-    if (node.fSuccessfullyConnected &&\r\n-        !node.IsBlockOnlyConn() && !node.IsInboundConn()) {\r\n+    if (node.was_connected_full_outbound) {\r\n         // Only change visible addrman state for full outbound peers.  We don't\r\n         // call Connected() for feeler connections since they don't have\r\n         // fSuccessfullyConnected set.\r\n         m_addrman.Connected(node.addr);\r\n     }\r\n     {\r\n         LOCK(m_headers_presync_mutex);\r\n-        m_headers_presync_stats.erase(nodeid);\r\n+        m_headers_presync_stats.erase(node.id);\r\n     }\r\n-    LogDebug(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", nodeid);\r\n+    LogDebug(BCLog::NET, \"Cleared nodestate for peer=%d\\n\", node.id);\r\n }\r\n \r\n bool PeerManagerImpl::HasAllDesirableServiceFlags(ServiceFlags services) const\r\n {\r\n     // Shortcut for (services & GetDesirableServiceFlags(services)) == GetDesirableServiceFlags(services)\r\n     return !(GetDesirableServiceFlags(services) & (~services));\r\ndiff --git i/src/net.h w/src/net.h\r\nindex ff83ecde4d..cbe044f27e 100644\r\n--- i/src/net.h\r\n+++ w/src/net.h\r\n@@ -1000,14 +1000,29 @@ public:\r\n     /** Mutex for anything that is only accessed via the msg processing thread */\r\n     static Mutex g_msgproc_mutex;\r\n \r\n     /** Initialize a peer (setup state) */\r\n     virtual void InitializeNode(const CNode& node, ServiceFlags our_services) = 0;\r\n \r\n+    /** Data needed for `FinalizeNode()`. */\r\n+    struct NodeFinalizationData {\r\n+        NodeFinalizationData(const CNode& node)\r\n+            : id{node.GetId()},\r\n+              addr{node.addr},\r\n+              was_connected_full_outbound{node.fSuccessfullyConnected &&\r\n+                                          !node.IsBlockOnlyConn() &&\r\n+                                          !node.IsInboundConn()}\r\n+        {}\r\n+\r\n+        const NodeId id;\r\n+        const CService addr;\r\n+        const bool was_connected_full_outbound;\r\n+    };\r\n+\r\n     /** Handle removal of a peer (clear state) */\r\n-    virtual void FinalizeNode(const CNode& node) = 0;\r\n+    virtual void FinalizeNode(const NodeFinalizationData& node_finalization_data) = 0;\r\n \r\n     /**\r\n      * Callback to determine whether the given set of service flags are sufficient\r\n      * for a peer to be \"relevant\".\r\n      */\r\n     virtual bool HasAllDesirableServiceFlags(ServiceFlags services) const = 0;\r\n@@ -1112,15 +1127,17 @@ public:\r\n \r\n     ~CConnman();\r\n \r\n     bool Start(CScheduler& scheduler, const Options& options) EXCLUSIVE_LOCKS_REQUIRED(!m_total_bytes_sent_mutex, !m_added_nodes_mutex, !m_addr_fetches_mutex, !mutexMsgProc);\r\n \r\n     void StopThreads();\r\n-    void StopNodes();\r\n-    void Stop()\r\n+    void StopNodes() EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_for_finalization_mutex);\r\n+    void Stop() EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_for_finalization_mutex)\r\n     {\r\n+        AssertLockNotHeld(m_nodes_for_finalization_mutex);\r\n+\r\n         StopThreads();\r\n         StopNodes();\r\n     };\r\n \r\n     void Interrupt() EXCLUSIVE_LOCKS_REQUIRED(!mutexMsgProc);\r\n     bool GetNetworkActive() const { return fNetworkActive; };\r\n@@ -1261,12 +1278,15 @@ public:\r\n \r\n     /** Return true if we should disconnect the peer for failing an inactivity check. */\r\n     bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const;\r\n \r\n     bool MultipleManualOrFullOutboundConns(Network net) const EXCLUSIVE_LOCKS_REQUIRED(m_nodes_mutex);\r\n \r\n+    /** Remember some of the node's properties for calling `m_msgproc->FinalizeNode()` later. */\r\n+    void RememberForFinalization(const CNode& node) EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_for_finalization_mutex);\r\n+\r\n private:\r\n     struct ListenSocket {\r\n     public:\r\n         std::shared_ptr<Sock> sock;\r\n         inline void AddSocketPermissionFlags(NetPermissionFlags& flags) const { NetPermissions::AddFlag(flags, m_permissions); }\r\n         ListenSocket(std::shared_ptr<Sock> sock_, NetPermissionFlags permissions_)\r\n@@ -1287,13 +1307,13 @@ private:\r\n     bool InitBinds(const Options& options);\r\n \r\n     void ThreadOpenAddedConnections() EXCLUSIVE_LOCKS_REQUIRED(!m_added_nodes_mutex, !m_unused_i2p_sessions_mutex, !m_reconnections_mutex);\r\n     void AddAddrFetch(const std::string& strDest) EXCLUSIVE_LOCKS_REQUIRED(!m_addr_fetches_mutex);\r\n     void ProcessAddrFetch() EXCLUSIVE_LOCKS_REQUIRED(!m_addr_fetches_mutex, !m_unused_i2p_sessions_mutex);\r\n     void ThreadOpenConnections(std::vector<std::string> connect, Span<const std::string> seed_nodes) EXCLUSIVE_LOCKS_REQUIRED(!m_addr_fetches_mutex, !m_added_nodes_mutex, !m_nodes_mutex, !m_unused_i2p_sessions_mutex, !m_reconnections_mutex);\r\n-    void ThreadMessageHandler() EXCLUSIVE_LOCKS_REQUIRED(!mutexMsgProc);\r\n+    void ThreadMessageHandler() EXCLUSIVE_LOCKS_REQUIRED(!mutexMsgProc, !m_nodes_for_finalization_mutex);\r\n     void ThreadI2PAcceptIncoming();\r\n     void AcceptConnection(const ListenSocket& hListenSocket);\r\n \r\n     /**\r\n      * Create a `CNode` object from a socket that has just been accepted and add the node to\r\n      * the `m_nodes` member.\r\n@@ -1305,12 +1325,16 @@ private:\r\n     void CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\r\n                                       NetPermissionFlags permission_flags,\r\n                                       const CService& addr_bind,\r\n                                       const CService& addr);\r\n \r\n     void DisconnectNodes() EXCLUSIVE_LOCKS_REQUIRED(!m_reconnections_mutex, !m_nodes_mutex);\r\n+\r\n+    /** Call `m_msgproc->FinalizeNode()` on all entries from `m_nodes_for_finalization`. */\r\n+    void FinalizeNodes() EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_for_finalization_mutex);\r\n+\r\n     void NotifyNumConnectionsChanged();\r\n     /** Return true if the peer is inactive and should be disconnected. */\r\n     bool InactivityCheck(const CNode& node) const;\r\n \r\n     /**\r\n      * Generate a collection of sockets to check for IO readiness.\r\n@@ -1395,12 +1419,17 @@ private:\r\n     // Whether the node should be passed out in ForEach* callbacks\r\n     static bool NodeFullyConnected(const CNode& node);\r\n \r\n     uint16_t GetDefaultPort(Network net) const;\r\n     uint16_t GetDefaultPort(const std::string& addr) const;\r\n \r\n+    Mutex m_nodes_for_finalization_mutex;\r\n+\r\n+    /** When a node is destroyed some of its properties are saved here for calling m_msgproc->FinalizeNode() later. */\r\n+    std::queue<std::unique_ptr<NetEventsInterface::NodeFinalizationData>> m_nodes_for_finalization GUARDED_BY(m_nodes_for_finalization_mutex);\r\n+\r\n     // Network usage totals\r\n     mutable Mutex m_total_bytes_sent_mutex;\r\n     std::atomic<uint64_t> nTotalBytesRecv{0};\r\n     uint64_t nTotalBytesSent GUARDED_BY(m_total_bytes_sent_mutex) {0};\r\n \r\n     // outbound limit & stats\r\ndiff --git i/src/net.cpp w/src/net.cpp\r\nindex d641579f6b..3a6ba226d0 100644\r\n--- i/src/net.cpp\r\n+++ w/src/net.cpp\r\n@@ -534,13 +534,13 @@ std::shared_ptr<CNode> CConnman::ConnectNode(CAddress addrConnect, const char *p\r\n             CalculateKeyedNetGroup(target_addr),\r\n             nonce,\r\n             addr_bind,\r\n             pszDest ? pszDest : \"\",\r\n             conn_type,\r\n             /*inbound_onion=*/false,\r\n-            [this](CNode& node) { m_msgproc->FinalizeNode(node); },\r\n+            [this](CNode& node) { RememberForFinalization(node); },\r\n             CNodeOptions{\r\n                 .permission_flags = permission_flags,\r\n                 .i2p_sam_session = std::move(i2p_transient_session),\r\n                 .recv_flood_size = nReceiveFloodSize,\r\n                 .use_v2transport = use_v2transport,\r\n             });\r\n@@ -1832,13 +1832,13 @@ void CConnman::CreateNodeFromAcceptedSocket(std::unique_ptr<Sock>&& sock,\r\n         CalculateKeyedNetGroup(addr),\r\n         nonce,\r\n         addr_bind,\r\n         /*addrNameIn=*/\"\",\r\n         ConnectionType::INBOUND,\r\n         inbound_onion,\r\n-        [this](CNode& node) { m_msgproc->FinalizeNode(node); },\r\n+        [this](CNode& node) { RememberForFinalization(node); },\r\n         CNodeOptions{\r\n             .permission_flags = permission_flags,\r\n             .prefer_evict = discouraged,\r\n             .recv_flood_size = nReceiveFloodSize,\r\n             .use_v2transport = use_v2transport,\r\n         });\r\n@@ -1904,14 +1904,12 @@ void CConnman::DisconnectNodes()\r\n     AssertLockNotHeld(m_reconnections_mutex);\r\n \r\n     // Use a temporary variable to accumulate desired reconnections, so we don't need\r\n     // m_reconnections_mutex while holding m_nodes_mutex.\r\n     decltype(m_reconnections) reconnections_to_add;\r\n \r\n-    std::vector<std::shared_ptr<CNode>> disconnected_nodes;\r\n-\r\n     {\r\n         LOCK(m_nodes_mutex);\r\n \r\n         if (!fNetworkActive) {\r\n             // Disconnect any connected nodes\r\n             for (auto& pnode : m_nodes) {\r\n@@ -1925,18 +1923,12 @@ void CConnman::DisconnectNodes()\r\n         // Disconnect unused nodes\r\n         for (auto it = m_nodes.begin(); it != m_nodes.end();) {\r\n             auto node = *it;\r\n             if (node->fDisconnect) {\r\n                 it = m_nodes.erase(it);\r\n \r\n-                // Keep a reference to this CNode object to delay its destruction until\r\n-                // after m_nodes_mutex has been released. Destructing a node involves\r\n-                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\r\n-                // should be cs_main, m_nodes_mutex.\r\n-                disconnected_nodes.push_back(node);\r\n-\r\n                 // Add to reconnection list if appropriate. We don't reconnect right here, because\r\n                 // the creation of a connection is a blocking operation (up to several seconds),\r\n                 // and we don't want to hold up the socket handler thread for that long.\r\n                 if (node->m_transport->ShouldReconnectV1()) {\r\n                     reconnections_to_add.push_back({\r\n                         .addr_connect = node->addr,\r\n@@ -1964,12 +1956,38 @@ void CConnman::DisconnectNodes()\r\n         // Move entries from reconnections_to_add to m_reconnections.\r\n         LOCK(m_reconnections_mutex);\r\n         m_reconnections.splice(m_reconnections.end(), std::move(reconnections_to_add));\r\n     }\r\n }\r\n \r\n+void CConnman::RememberForFinalization(const CNode& node)\r\n+{\r\n+    LOCK(m_nodes_for_finalization_mutex);\r\n+    m_nodes_for_finalization.emplace(std::make_unique<NetEventsInterface::NodeFinalizationData>(node));\r\n+}\r\n+\r\n+void CConnman::FinalizeNodes()\r\n+{\r\n+    AssertLockNotHeld(m_nodes_for_finalization_mutex);\r\n+\r\n+    for (;;) {\r\n+        std::unique_ptr<NetEventsInterface::NodeFinalizationData> node_finalization_data;\r\n+\r\n+        {\r\n+            LOCK(m_nodes_for_finalization_mutex);\r\n+            if (m_nodes_for_finalization.empty()) {\r\n+                break;\r\n+            }\r\n+            node_finalization_data.swap(m_nodes_for_finalization.front());\r\n+            m_nodes_for_finalization.pop();\r\n+        }\r\n+\r\n+        m_msgproc->FinalizeNode(*node_finalization_data);\r\n+    }\r\n+}\r\n+\r\n void CConnman::NotifyNumConnectionsChanged()\r\n {\r\n     size_t nodes_size;\r\n     {\r\n         LOCK(m_nodes_mutex);\r\n         nodes_size = m_nodes.size();\r\n@@ -3050,12 +3068,14 @@ void CConnman::ThreadMessageHandler()\r\n \r\n         WAIT_LOCK(mutexMsgProc, lock);\r\n         if (!fMoreWork) {\r\n             condMsgProc.wait_until(lock, std::chrono::steady_clock::now() + std::chrono::milliseconds(100), [this]() EXCLUSIVE_LOCKS_REQUIRED(mutexMsgProc) { return fMsgProcWake; });\r\n         }\r\n         fMsgProcWake = false;\r\n+\r\n+        FinalizeNodes();\r\n     }\r\n }\r\n \r\n void CConnman::ThreadI2PAcceptIncoming()\r\n {\r\n     static constexpr auto err_wait_begin = 1s;\r\n@@ -3440,12 +3460,14 @@ void CConnman::StopThreads()\r\n     if (threadSocketHandler.joinable())\r\n         threadSocketHandler.join();\r\n }\r\n \r\n void CConnman::StopNodes()\r\n {\r\n+    AssertLockNotHeld(m_nodes_for_finalization_mutex);\r\n+\r\n     if (fAddressesInitialized) {\r\n         DumpAddresses();\r\n         fAddressesInitialized = false;\r\n \r\n         if (m_use_addrman_outgoing) {\r\n             // Anchor connections are only dumped during clean shutdown.\r\n@@ -3466,12 +3488,14 @@ void CConnman::StopNodes()\r\n     }\r\n     nodes.clear();\r\n \r\n     vhListenSocket.clear();\r\n     semOutbound.reset();\r\n     semAddnode.reset();\r\n+\r\n+    FinalizeNodes(); // Finalize any leftovers which were added after the msghand thread was interrupted.\r\n }\r\n \r\n CConnman::~CConnman()\r\n {\r\n     Interrupt();\r\n     Stop();\r\ndiff --git i/src/test/fuzz/p2p_handshake.cpp w/src/test/fuzz/p2p_handshake.cpp\r\nindex d881cb35ba..99b2d70706 100644\r\n--- i/src/test/fuzz/p2p_handshake.cpp\r\n+++ w/src/test/fuzz/p2p_handshake.cpp\r\n@@ -61,14 +61,14 @@ FUZZ_TARGET(p2p_handshake, .init = ::initialize)\r\n \r\n     LOCK(NetEventsInterface::g_msgproc_mutex);\r\n \r\n     std::vector<CNode*> peers;\r\n     const auto num_peers_to_add = fuzzed_data_provider.ConsumeIntegralInRange(1, 3);\r\n     for (int i = 0; i < num_peers_to_add; ++i) {\r\n-        peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i, [&peerman](CNode& node) {\r\n-                            peerman->FinalizeNode(node);\r\n+        peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i, [&connman](CNode& node) {\r\n+                            connman.RememberForFinalization(node);\r\n                         }).release());\r\n         connman.AddTestNode(*peers.back());\r\n         peerman->InitializeNode(\r\n             *peers.back(),\r\n             static_cast<ServiceFlags>(fuzzed_data_provider.ConsumeIntegral<uint64_t>()));\r\n     }\r\ndiff --git i/src/test/fuzz/p2p_headers_presync.cpp w/src/test/fuzz/p2p_headers_presync.cpp\r\nindex 4c470dab1c..d6159efaee 100644\r\n--- i/src/test/fuzz/p2p_headers_presync.cpp\r\n+++ w/src/test/fuzz/p2p_headers_presync.cpp\r\n@@ -58,13 +58,13 @@ void HeadersSyncSetup::ResetAndInitialize()\r\n         ConnectionType::INBOUND\r\n     };\r\n \r\n     for (auto conn_type : conn_types) {\r\n         CAddress addr{};\r\n         m_connections.push_back(new CNode(id++, nullptr, addr, 0, 0, addr, \"\", conn_type, false,\r\n-                                          [this](CNode& node) { m_node.peerman->FinalizeNode(node); }));\r\n+                                          [this](CNode& node) { m_node.connman->RememberForFinalization(node); }));\r\n         CNode& p2p_node = *m_connections.back();\r\n \r\n         connman.Handshake(\r\n             /*node=*/p2p_node,\r\n             /*successfully_connected=*/true,\r\n             /*remote_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS),\r\ndiff --git i/src/test/fuzz/process_message.cpp w/src/test/fuzz/process_message.cpp\r\nindex b2031a60cc..a7b6913584 100644\r\n--- i/src/test/fuzz/process_message.cpp\r\n+++ w/src/test/fuzz/process_message.cpp\r\n@@ -64,13 +64,13 @@ FUZZ_TARGET(process_message, .init = initialize_process_message)\r\n \r\n     const std::string random_message_type{fuzzed_data_provider.ConsumeBytesAsString(CMessageHeader::MESSAGE_TYPE_SIZE).c_str()};\r\n     if (!LIMIT_TO_MESSAGE_TYPE.empty() && random_message_type != LIMIT_TO_MESSAGE_TYPE) {\r\n         return;\r\n     }\r\n     CNode& p2p_node = *ConsumeNodeAsUniquePtr(fuzzed_data_provider, std::nullopt, [](CNode& node) {\r\n-                           g_setup->m_node.peerman->FinalizeNode(node);\r\n+                           g_setup->m_node.connman->RememberForFinalization(node);\r\n                        }).release();\r\n \r\n     connman.AddTestNode(p2p_node);\r\n     FillNode(fuzzed_data_provider, connman, p2p_node);\r\n \r\n     const auto mock_time = ConsumeTime(fuzzed_data_provider);\r\ndiff --git i/src/test/fuzz/process_messages.cpp w/src/test/fuzz/process_messages.cpp\r\nindex 89584e3d59..9377327f8e 100644\r\n--- i/src/test/fuzz/process_messages.cpp\r\n+++ w/src/test/fuzz/process_messages.cpp\r\n@@ -53,13 +53,13 @@ FUZZ_TARGET(process_messages, .init = initialize_process_messages)\r\n     LOCK(NetEventsInterface::g_msgproc_mutex);\r\n \r\n     std::vector<CNode*> peers;\r\n     const auto num_peers_to_add = fuzzed_data_provider.ConsumeIntegralInRange(1, 3);\r\n     for (int i = 0; i < num_peers_to_add; ++i) {\r\n         peers.push_back(ConsumeNodeAsUniquePtr(fuzzed_data_provider, i, [&connman](CNode& node) {\r\n-                            connman.MsgProc()->FinalizeNode(node);\r\n+                            connman.RememberForFinalization(node);\r\n                         }).release());\r\n         CNode& p2p_node = *peers.back();\r\n \r\n         FillNode(fuzzed_data_provider, connman, p2p_node);\r\n \r\n         connman.AddTestNode(p2p_node);\r\n```\r\n</details>\r\n\r\nMaybe worth exploring in a followup if people think that makes sense. Calling `FinalizeNode()` on the `msghand` thread to avoid locking `cs_main` in the `net` thread looks out of the scope of this PR which is about removing the manual reference counting of `CNode`.\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2725084083",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32015"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1984875189",
      "pull_request_review_id": 2666944030,
      "id": 1984875189,
      "node_id": "PRRC_kwDOABII5852Tsq1",
      "diff_hunk": "@@ -1921,51 +1927,40 @@ void CConnman::DisconnectNodes()\n         }\n \n         // Disconnect unused nodes\n-        std::vector<CNode*> nodes_copy = m_nodes;\n-        for (CNode* pnode : nodes_copy)\n-        {\n-            if (pnode->fDisconnect)\n-            {\n-                // remove from m_nodes\n-                m_nodes.erase(remove(m_nodes.begin(), m_nodes.end(), pnode), m_nodes.end());\n+        for (auto it = m_nodes.begin(); it != m_nodes.end();) {\n+            auto node = *it;\n+            if (node->fDisconnect) {\n+                it = m_nodes.erase(it);\n+\n+                // Keep a reference to this CNode object to delay its destruction until\n+                // after m_nodes_mutex has been released. Destructing a node involves\n+                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\n+                // should be cs_main, m_nodes_mutex.\n+                disconnected_nodes.push_back(node);",
      "path": "src/net.cpp",
      "position": 235,
      "original_position": 207,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Now that `~CNode` is responsible for calling `FinalizeNode`, the guarantees around which thread does the actual cleanup are lost. It's basically just whichever thread ends up holding the last instance of a `CNode`. This seems bug prone.\r\n\r\nE.g. there are no guarantees (afaict) that `disconnected_nodes` will actually be the last owner.",
      "created_at": "2025-03-07T11:03:12Z",
      "updated_at": "2025-03-07T11:03:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1984875189",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1984875189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1935,
      "original_line": 1935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985062506",
      "pull_request_review_id": 2667258371,
      "id": 1985062506,
      "node_id": "PRRC_kwDOABII5852UaZq",
      "diff_hunk": "@@ -1921,51 +1927,40 @@ void CConnman::DisconnectNodes()\n         }\n \n         // Disconnect unused nodes\n-        std::vector<CNode*> nodes_copy = m_nodes;\n-        for (CNode* pnode : nodes_copy)\n-        {\n-            if (pnode->fDisconnect)\n-            {\n-                // remove from m_nodes\n-                m_nodes.erase(remove(m_nodes.begin(), m_nodes.end(), pnode), m_nodes.end());\n+        for (auto it = m_nodes.begin(); it != m_nodes.end();) {\n+            auto node = *it;\n+            if (node->fDisconnect) {\n+                it = m_nodes.erase(it);\n+\n+                // Keep a reference to this CNode object to delay its destruction until\n+                // after m_nodes_mutex has been released. Destructing a node involves\n+                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\n+                // should be cs_main, m_nodes_mutex.\n+                disconnected_nodes.push_back(node);",
      "path": "src/net.cpp",
      "position": 235,
      "original_position": 207,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "in_reply_to_id": 1984875189,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The idea is that it does not matter which thread will destroy the `CNode` objects.\r\n\r\n> there are no guarantees (afaict) that `disconnected_nodes` will actually be the last owner.\r\n\r\nThat is right, but there is no need for such a guarantee. `disconnected_nodes` is to guarantee that the objects will not be destroyed while holding `m_nodes_mutex`.",
      "created_at": "2025-03-07T13:29:34Z",
      "updated_at": "2025-03-07T13:29:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1985062506",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985062506"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1935,
      "original_line": 1935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985793960",
      "pull_request_review_id": 2668522266,
      "id": 1985793960,
      "node_id": "PRRC_kwDOABII5852XM-o",
      "diff_hunk": "@@ -1884,8 +1884,15 @@ bool CConnman::AddConnection(const std::string& address, ConnectionType conn_typ\n     } // no default case, so the compiler can warn about missing cases\n \n     // Count existing connections\n-    int existing_connections = WITH_LOCK(m_nodes_mutex,\n-                                         return std::count_if(m_nodes.begin(), m_nodes.end(), [conn_type](CNode* node) { return node->m_conn_type == conn_type; }););\n+    const int existing_connections = WITH_LOCK(m_nodes_mutex,\n+        return std::count_if(",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 193,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "36d932cebbb235a79e90575960646e86a23d39a8",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: Might as well use `std::ranges::count_if` here and in `GetFullOutboundConnCount`.",
      "created_at": "2025-03-07T22:24:56Z",
      "updated_at": "2025-03-07T23:13:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1985793960",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985793960"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985826873",
      "pull_request_review_id": 2668522266,
      "id": 1985826873,
      "node_id": "PRRC_kwDOABII5852XVA5",
      "diff_hunk": "@@ -1921,51 +1927,40 @@ void CConnman::DisconnectNodes()\n         }\n \n         // Disconnect unused nodes\n-        std::vector<CNode*> nodes_copy = m_nodes;\n-        for (CNode* pnode : nodes_copy)\n-        {\n-            if (pnode->fDisconnect)\n-            {\n-                // remove from m_nodes\n-                m_nodes.erase(remove(m_nodes.begin(), m_nodes.end(), pnode), m_nodes.end());\n+        for (auto it = m_nodes.begin(); it != m_nodes.end();) {\n+            auto node = *it;\n+            if (node->fDisconnect) {\n+                it = m_nodes.erase(it);\n+\n+                // Keep a reference to this CNode object to delay its destruction until\n+                // after m_nodes_mutex has been released. Destructing a node involves\n+                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\n+                // should be cs_main, m_nodes_mutex.\n+                disconnected_nodes.push_back(node);",
      "path": "src/net.cpp",
      "position": 235,
      "original_position": 207,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "in_reply_to_id": 1984875189,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In thread https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1984875189:\r\n\r\nMaybe one could have an additional `vector<shared_ptr<CNode>>` member in `CConnman` beyond `m_nodes` that always keeps the `shared_ptr::use_count()` above 0. Then use removal from that vector (when `use_count() == 1`) for controlled deletion with enforced lock order, more like how the code was before?",
      "created_at": "2025-03-07T23:06:14Z",
      "updated_at": "2025-03-07T23:13:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1985826873",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1985826873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1935,
      "original_line": 1935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1987604281",
      "pull_request_review_id": 2671518728,
      "id": 1987604281,
      "node_id": "PRRC_kwDOABII5852eG85",
      "diff_hunk": "@@ -1884,8 +1884,15 @@ bool CConnman::AddConnection(const std::string& address, ConnectionType conn_typ\n     } // no default case, so the compiler can warn about missing cases\n \n     // Count existing connections\n-    int existing_connections = WITH_LOCK(m_nodes_mutex,\n-                                         return std::count_if(m_nodes.begin(), m_nodes.end(), [conn_type](CNode* node) { return node->m_conn_type == conn_type; }););\n+    const int existing_connections = WITH_LOCK(m_nodes_mutex,\n+        return std::count_if(",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 193,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "36d932cebbb235a79e90575960646e86a23d39a8",
      "in_reply_to_id": 1985793960,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Indeed, done, thanks!",
      "created_at": "2025-03-10T16:06:50Z",
      "updated_at": "2025-03-10T16:06:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1987604281",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1987604281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988085255",
      "pull_request_review_id": 2672297590,
      "id": 1988085255,
      "node_id": "PRRC_kwDOABII5852f8YH",
      "diff_hunk": "@@ -1716,7 +1714,7 @@ bool CConnman::AttemptToEvictConnection()\n         return false;\n     }\n     LOCK(m_nodes_mutex);\n-    for (CNode* pnode : m_nodes) {\n+    for (const auto& pnode : m_nodes) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 132,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Not sure about adding non-transitive `const` here since we set `pnode->fDisconnect` inside the loop.\r\n\r\nSimilar case in `DisconnectNodes()`-loop.",
      "created_at": "2025-03-10T22:01:04Z",
      "updated_at": "2025-03-10T22:58:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988085255",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988085255"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1717,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988117321",
      "pull_request_review_id": 2672347152,
      "id": 1988117321,
      "node_id": "PRRC_kwDOABII5852gENJ",
      "diff_hunk": "@@ -54,20 +54,19 @@ struct ConnmanTestMsg : public CConnman {\n     void AddTestNode(CNode& node)\n     {\n         LOCK(m_nodes_mutex);\n-        m_nodes.push_back(&node);\n+        m_nodes.push_back(std::shared_ptr<CNode>(&node));",
      "path": "src/test/util/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": null,
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This looks suspicious. No custom deleter is passed to the `shared_ptr` constructor, so it defaults to [`default_delete`](https://en.cppreference.com/w/cpp/memory/default_delete) which will `delete ptr;` eventually. Is the argument `CNode& node` guaranteed to be heap allocated? Otherwise:\r\n\r\n```cpp\r\nm_nodes.push_back(std::shared_ptr<CNode>(&node, [](CNode*){}));\r\n```",
      "created_at": "2025-03-10T22:41:30Z",
      "updated_at": "2025-03-10T22:41:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988117321",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988117321"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 57,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988125455",
      "pull_request_review_id": 2672297590,
      "id": 1988125455,
      "node_id": "PRRC_kwDOABII5852gGMP",
      "diff_hunk": "@@ -438,8 +436,7 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                 // It is possible that we already have a connection to the IP/port pszDest resolved to.\n                 // In that case, drop the connection that was just created.\n                 LOCK(m_nodes_mutex);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 71,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Since we aren't doing anything with `pnode` anymore, we should be able to remove this `LOCK()` too, avoiding re-entrant locking inside `FindNode()`.",
      "created_at": "2025-03-10T22:52:54Z",
      "updated_at": "2025-03-10T22:58:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988125455",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988125455"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 438,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988127685",
      "pull_request_review_id": 2672297590,
      "id": 1988127685,
      "node_id": "PRRC_kwDOABII5852gGvF",
      "diff_hunk": "@@ -332,32 +332,32 @@ bool IsLocal(const CService& addr)\n     return mapLocalHost.count(addr) > 0;\n }\n \n-CNode* CConnman::FindNode(const CNetAddr& ip)",
      "path": "src/net.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It is notable how unsafe the design was for the `FindNode()`-methods before switching to `shared_ptr`. Returning a raw pointer as we let go of the mutex protecting it.",
      "created_at": "2025-03-10T22:55:39Z",
      "updated_at": "2025-03-10T22:58:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988127685",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988127685"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988141217",
      "pull_request_review_id": 2672382867,
      "id": 1988141217,
      "node_id": "PRRC_kwDOABII5852gKCh",
      "diff_hunk": "@@ -332,32 +332,32 @@ bool IsLocal(const CService& addr)\n     return mapLocalHost.count(addr) > 0;\n }\n \n-CNode* CConnman::FindNode(const CNetAddr& ip)",
      "path": "src/net.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988127685,
      "user": {
        "login": "purpleKarrot",
        "id": 185240,
        "node_id": "MDQ6VXNlcjE4NTI0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/185240?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/purpleKarrot",
        "html_url": "https://github.com/purpleKarrot",
        "followers_url": "https://api.github.com/users/purpleKarrot/followers",
        "following_url": "https://api.github.com/users/purpleKarrot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/purpleKarrot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/purpleKarrot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/purpleKarrot/subscriptions",
        "organizations_url": "https://api.github.com/users/purpleKarrot/orgs",
        "repos_url": "https://api.github.com/users/purpleKarrot/repos",
        "events_url": "https://api.github.com/users/purpleKarrot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/purpleKarrot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is not a raw pointer, but an observer (\"Raw pointer\" is coined by Sean Parent as \"anything that implies ownership\", which explicitly includes `shared_ptr`. Stricly speaking, changing `CNode*` to `std::shared_ptr<CNode>` turns an observer **into** a raw pointer).\r\n\r\nI actually think that returning an observer is fine here, even after the change.",
      "created_at": "2025-03-10T23:15:10Z",
      "updated_at": "2025-03-10T23:15:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988141217",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988141217"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988630364",
      "pull_request_review_id": 2673269135,
      "id": 1988630364,
      "node_id": "PRRC_kwDOABII5852iBdc",
      "diff_hunk": "@@ -332,32 +332,32 @@ bool IsLocal(const CService& addr)\n     return mapLocalHost.count(addr) > 0;\n }\n \n-CNode* CConnman::FindNode(const CNetAddr& ip)",
      "path": "src/net.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988127685,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If that is the case I think Parent goes one step too far in redefining terms.\r\n\r\nReturning an raw C pointer is not an okay design, as another thread could potentially come along and delete whatever the returned pointer is referencing, resulting in use-after-free. This is mitigated by `FindNode` being private and node deletion being done in a controlled fashion on master. But it's a loaded foot-gun IMO.\r\n\r\nAdding `EXCLUSIVE_LOCKS_REQUIRED()` would have been a different fix, forcing the caller to protect the returned value with the mutex.\r\n```C++\r\nCNode* FindNode(...) EXCLUSIVE_LOCKS_REQUIRED(m_nodes_mutex)\r\n```\r\n\r\nIntroducing `shared_ptr` solves the use-after-free design issue. (Although I agree it would be great to get rid of `shared_ptr`).",
      "created_at": "2025-03-11T08:02:08Z",
      "updated_at": "2025-03-11T08:02:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988630364",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988630364"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988726994",
      "pull_request_review_id": 2673460137,
      "id": 1988726994,
      "node_id": "PRRC_kwDOABII5852iZDS",
      "diff_hunk": "@@ -1921,51 +1927,40 @@ void CConnman::DisconnectNodes()\n         }\n \n         // Disconnect unused nodes\n-        std::vector<CNode*> nodes_copy = m_nodes;\n-        for (CNode* pnode : nodes_copy)\n-        {\n-            if (pnode->fDisconnect)\n-            {\n-                // remove from m_nodes\n-                m_nodes.erase(remove(m_nodes.begin(), m_nodes.end(), pnode), m_nodes.end());\n+        for (auto it = m_nodes.begin(); it != m_nodes.end();) {\n+            auto node = *it;\n+            if (node->fDisconnect) {\n+                it = m_nodes.erase(it);\n+\n+                // Keep a reference to this CNode object to delay its destruction until\n+                // after m_nodes_mutex has been released. Destructing a node involves\n+                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\n+                // should be cs_main, m_nodes_mutex.\n+                disconnected_nodes.push_back(node);",
      "path": "src/net.cpp",
      "position": 235,
      "original_position": 207,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "in_reply_to_id": 1984875189,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I do not think that is necessary. I mean - if we would assume that the code is going to be modified in a careless way to break the logic, in other words to destroy `CNode` objects while holding `m_nodes_mutex`, then we might as well assume that the code could be modified in a way that breaks the manual reference counting. IMO the manual reference counting is more fragile and error prone.\r\n\r\nFurther, if the code is changed to destroy `CNode` objects while holding `m_nodes_mutex`, then 83 functional tests fail. I think it is safe to assume that such a thing will not go unnoticed.",
      "created_at": "2025-03-11T08:55:46Z",
      "updated_at": "2025-03-11T08:55:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988726994",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988726994"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1935,
      "original_line": 1935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988909339",
      "pull_request_review_id": 2673807235,
      "id": 1988909339,
      "node_id": "PRRC_kwDOABII5852jFkb",
      "diff_hunk": "@@ -54,20 +54,19 @@ struct ConnmanTestMsg : public CConnman {\n     void AddTestNode(CNode& node)\n     {\n         LOCK(m_nodes_mutex);\n-        m_nodes.push_back(&node);\n+        m_nodes.push_back(std::shared_ptr<CNode>(&node));",
      "path": "src/test/util/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988117321,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, the argument `CNode& node` is always heap allocated. Not sure about \"guaranteed\". If not heap allocated, then this will be a gross error, resulting in an immediate crash or an error report by Valgrind or a memory sanitizer.\r\n\r\nNote that the semantic of this piece of code is not changed by this PR. It was the same before as well - it would eventually `delete` the object.",
      "created_at": "2025-03-11T10:25:38Z",
      "updated_at": "2025-03-11T10:25:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1988909339",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1988909339"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 57,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989085326",
      "pull_request_review_id": 2674151425,
      "id": 1989085326,
      "node_id": "PRRC_kwDOABII5852jwiO",
      "diff_hunk": "@@ -1716,7 +1714,7 @@ bool CConnman::AttemptToEvictConnection()\n         return false;\n     }\n     LOCK(m_nodes_mutex);\n-    for (CNode* pnode : m_nodes) {\n+    for (const auto& pnode : m_nodes) {",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 132,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988085255,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Removed the `const`.",
      "created_at": "2025-03-11T11:55:50Z",
      "updated_at": "2025-03-11T11:55:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989085326",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989085326"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1717,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989097485",
      "pull_request_review_id": 2674178728,
      "id": 1989097485,
      "node_id": "PRRC_kwDOABII5852jzgN",
      "diff_hunk": "@@ -438,8 +436,7 @@ CNode* CConnman::ConnectNode(CAddress addrConnect, const char *pszDest, bool fCo\n                 // It is possible that we already have a connection to the IP/port pszDest resolved to.\n                 // In that case, drop the connection that was just created.\n                 LOCK(m_nodes_mutex);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 71,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988125455,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Right! Removed.",
      "created_at": "2025-03-11T12:00:50Z",
      "updated_at": "2025-03-11T12:00:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989097485",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989097485"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 438,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989115901",
      "pull_request_review_id": 2674218491,
      "id": 1989115901,
      "node_id": "PRRC_kwDOABII5852j3_9",
      "diff_hunk": "@@ -332,32 +332,32 @@ bool IsLocal(const CService& addr)\n     return mapLocalHost.count(addr) > 0;\n }\n \n-CNode* CConnman::FindNode(const CNetAddr& ip)",
      "path": "src/net.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "af622d00ba7f5317220cf8d7d71ad9cd791dd892",
      "in_reply_to_id": 1988127685,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I agree with @hodlinator that this has lifetime issue in `master` and in this PR it does not. That issue was also discussed in another PR. Good to resolve it.",
      "created_at": "2025-03-11T12:10:28Z",
      "updated_at": "2025-03-11T12:10:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989115901",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989115901"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989217778",
      "pull_request_review_id": 2674417539,
      "id": 1989217778,
      "node_id": "PRRC_kwDOABII5852kQ3y",
      "diff_hunk": "@@ -1363,7 +1355,7 @@ class CConnman\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n     bool AttemptToEvictConnection();\n-    CNode* ConnectNode(CAddress addrConnect, const char *pszDest, bool fCountFailure, ConnectionType conn_type, bool use_v2transport) EXCLUSIVE_LOCKS_REQUIRED(!m_unused_i2p_sessions_mutex);\n+    std::shared_ptr<CNode> ConnectNode(CAddress addrConnect, const char *pszDest, bool fCountFailure, ConnectionType conn_type, bool use_v2transport) EXCLUSIVE_LOCKS_REQUIRED(!m_unused_i2p_sessions_mutex);\n     void AddWhitelistPermissionFlags(NetPermissionFlags& flags, const CNetAddr &addr, const std::vector<NetWhitelistPermissions>& ranges) const;\n \n     void DeleteNode(CNode* pnode);",
      "path": "src/net.h",
      "position": null,
      "original_position": 128,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Function body was removed.",
      "created_at": "2025-03-11T13:01:17Z",
      "updated_at": "2025-03-11T20:19:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989217778",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989217778"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1361,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989248213",
      "pull_request_review_id": 2674417539,
      "id": 1989248213,
      "node_id": "PRRC_kwDOABII5852kYTV",
      "diff_hunk": "@@ -3470,30 +3458,19 @@ void CConnman::StopNodes()\n     }\n \n     // Delete peer connections.\n-    std::vector<CNode*> nodes;\n+    std::vector<std::shared_ptr<CNode>> nodes;\n     WITH_LOCK(m_nodes_mutex, nodes.swap(m_nodes));\n-    for (CNode* pnode : nodes) {\n+    for (auto& pnode : nodes) {\n         LogDebug(BCLog::NET, \"Stopping node, %s\", pnode->DisconnectMsg(fLogIPs));\n         pnode->CloseSocketDisconnect();\n-        DeleteNode(pnode);",
      "path": "src/net.cpp",
      "position": 490,
      "original_position": 490,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Seems brittle on master that we just `delete` the node here without checking the refcount. From what I see we only call `StopNodes()` from tests and `CConnman::Stop()`, and we only create `NodesSnapshot`s inside threads we've already stopped earlier in `Stop()`.",
      "created_at": "2025-03-11T13:14:39Z",
      "updated_at": "2025-03-11T20:19:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1989248213",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1989248213"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3478,
      "original_line": 3478,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1990071370",
      "pull_request_review_id": 2674417539,
      "id": 1990071370,
      "node_id": "PRRC_kwDOABII5852nhRK",
      "diff_hunk": "@@ -1921,51 +1927,40 @@ void CConnman::DisconnectNodes()\n         }\n \n         // Disconnect unused nodes\n-        std::vector<CNode*> nodes_copy = m_nodes;\n-        for (CNode* pnode : nodes_copy)\n-        {\n-            if (pnode->fDisconnect)\n-            {\n-                // remove from m_nodes\n-                m_nodes.erase(remove(m_nodes.begin(), m_nodes.end(), pnode), m_nodes.end());\n+        for (auto it = m_nodes.begin(); it != m_nodes.end();) {\n+            auto node = *it;\n+            if (node->fDisconnect) {\n+                it = m_nodes.erase(it);\n+\n+                // Keep a reference to this CNode object to delay its destruction until\n+                // after m_nodes_mutex has been released. Destructing a node involves\n+                // calling m_msgproc->FinalizeNode() which acquires cs_main. Lock order\n+                // should be cs_main, m_nodes_mutex.\n+                disconnected_nodes.push_back(node);",
      "path": "src/net.cpp",
      "position": 235,
      "original_position": 207,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "2747f135be3a2ccf3ce89bea3ee6037266611a16",
      "in_reply_to_id": 1984875189,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In thread https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1984875189:\r\n\r\nStarted proving out my suggestion and landed on something closer to master.\r\n- Resurrect `m_nodes_disconnected` (now holding `shared_ptr`) along with clearly defined lifetimes.\r\n- Resurrect `DeleteNode()`, but make it take an r-value `shared_ptr` and assert that `use_count() == 1`.\r\n- Avoid adding `~CNode()` and `CNode::m_destruct_cb` along with sending it in everywhere in the constructor. This means we don't need to touch 5 of the test files.\r\n\r\nhttps://github.com/bitcoin/bitcoin/compare/master...hodlinator:bitcoin:pr/32015_suggestion\r\n\r\nPasses unit tests and functional tests.",
      "created_at": "2025-03-11T20:18:38Z",
      "updated_at": "2025-03-11T20:19:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1990071370",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1990071370"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1935,
      "original_line": 1935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1990577831",
      "pull_request_review_id": 2676928054,
      "id": 1990577831,
      "node_id": "PRRC_kwDOABII5852pc6n",
      "diff_hunk": "@@ -1363,7 +1355,7 @@ class CConnman\n     bool AlreadyConnectedToAddress(const CAddress& addr);\n \n     bool AttemptToEvictConnection();\n-    CNode* ConnectNode(CAddress addrConnect, const char *pszDest, bool fCountFailure, ConnectionType conn_type, bool use_v2transport) EXCLUSIVE_LOCKS_REQUIRED(!m_unused_i2p_sessions_mutex);\n+    std::shared_ptr<CNode> ConnectNode(CAddress addrConnect, const char *pszDest, bool fCountFailure, ConnectionType conn_type, bool use_v2transport) EXCLUSIVE_LOCKS_REQUIRED(!m_unused_i2p_sessions_mutex);\n     void AddWhitelistPermissionFlags(NetPermissionFlags& flags, const CNetAddr &addr, const std::vector<NetWhitelistPermissions>& ranges) const;\n \n     void DeleteNode(CNode* pnode);",
      "path": "src/net.h",
      "position": null,
      "original_position": 128,
      "commit_id": "8c0ce1ca1c5f4701c24dc7721237f9af3fb02faa",
      "original_commit_id": "4492abbf0a8f34e07ac92bf5786f9564c00c8e45",
      "in_reply_to_id": 1989217778,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Removed the declaration as well, thanks!",
      "created_at": "2025-03-12T05:07:27Z",
      "updated_at": "2025-03-12T05:07:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32015#discussion_r1990577831",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1990577831"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32015"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1361,
      "side": "RIGHT"
    }
  ]
}
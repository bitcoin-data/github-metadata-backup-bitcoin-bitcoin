{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34565",
    "id": 3273035746,
    "node_id": "PR_kwDOABII587DFo_i",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34565",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34565.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34565.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34565/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34565/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a24d36e75c0f602fbef6106928f5631be41c150f",
    "number": 34565,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "refactor: extract BlockDownloadManager from PeerManagerImpl",
    "user": {
      "login": "w0xlt",
      "id": 94266259,
      "node_id": "U_kgDOBZ5jkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/w0xlt",
      "html_url": "https://github.com/w0xlt",
      "followers_url": "https://api.github.com/users/w0xlt/followers",
      "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
      "organizations_url": "https://api.github.com/users/w0xlt/orgs",
      "repos_url": "https://api.github.com/users/w0xlt/repos",
      "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/w0xlt/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Motivation\r\n\r\n`net_processing.cpp` is the largest file in the codebase (~6200 lines) and `PeerManagerImpl` mixes several largely independent subsystems into a single class: transaction relay, address gossip, headers sync, compactblocks, and block download. This makes the file difficult to review, test in isolation, and reason about lock ordering.\r\n\r\n #30110 successfully extracted transaction download logic into `TxDownloadManager`. This PR applies the same approach to block download, continuing the incremental decomposition of `PeerManagerImpl`.\r\n \r\n### What this PR does\r\n\r\nExtract all block download state and scheduling logic into a new `BlockDownloadManager` module:\r\n\r\n**Global state moved** (from `PeerManagerImpl`): `mapBlocksInFlight`, `mapBlockSource`, `nSyncStarted`, `m_block_stalling_timeout`, `m_last_tip_update`, `m_num_preferred_download_peers`, `m_peers_downloading_from`.\r\n\r\n**Per-peer state moved** (from `CNodeState`): `pindexBestKnownBlock`, `hashLastUnknownBlock`, `pindexLastCommonBlock`, `pindexBestHeaderSent`, `fSyncStarted`, `vBlocksInFlight`, `m_downloading_since`, `m_stalling_since`, `fPreferredDownload`.\r\n\r\n**Methods moved** (from `PeerManagerImpl`): `FindNextBlocksToDownload`, `TryDownloadingHistoricalBlocks`, `ProcessBlockAvailability`, `UpdateBlockAvailability`, `BlockRequested`, `RemoveBlockRequest`, `IsBlockRequested`, `IsBlockRequestedFromOutbound`, `TipMayBeStale`.\r\n\r\n### The result:\r\n* `net_processing.cpp` shrinks from 6193 to 5751 lines (−442 net)\r\n* `CNodeState` loses 10 fields, retaining only compact block relay and chain sync timeout state\r\n* Block download logic becomes unit-testable in isolation (8 test cases added)\r\n\r\n### Design\r\n\r\nFollows the `TxDownloadManager` pimpl pattern:\r\n* `blockdownloadman.h` — public interface\r\n* `blockdownloadman_impl.h` — implementation class with per-peer state\r\n* `blockdownloadman_impl.cpp` — implementation\r\n\r\n Unlike `TxDownloadManager`, no new mutex is introduced. Block download is inherently tied to chain state through `CBlockIndex*` pointers, so `cs_main` remains the synchronizing lock. The extraction is for code organization and testability, not lock granularity.\r\n \r\n ### Commits\r\n\r\n1. **Add BlockDownloadManager class with pimpl skeleton**: all new module files, no call sites changed\r\n2. **Add unit tests**: exercises the module in isolation\r\n3. **Migrate call sites**: ~150 call sites in `net_processing.cpp` rewired through `m_blockdownloadman`, pure mechanical replacement",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2026-02-11T18:54:52Z",
    "updated_at": "2026-02-17T20:48:35Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "104d574d673975f9ef978919d4b2092b4c974599",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "w0xlt:refactor/extract-block-download-manager",
      "ref": "refactor/extract-block-download-manager",
      "sha": "a24d36e75c0f602fbef6106928f5631be41c150f",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 427811926,
        "node_id": "R_kgDOGX_kVg",
        "name": "bitcoin",
        "full_name": "w0xlt/bitcoin",
        "owner": {
          "login": "w0xlt",
          "id": 94266259,
          "node_id": "U_kgDOBZ5jkw",
          "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/w0xlt",
          "html_url": "https://github.com/w0xlt",
          "followers_url": "https://api.github.com/users/w0xlt/followers",
          "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
          "organizations_url": "https://api.github.com/users/w0xlt/orgs",
          "repos_url": "https://api.github.com/users/w0xlt/repos",
          "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/w0xlt/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/w0xlt/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/w0xlt/bitcoin",
        "archive_url": "https://api.github.com/repos/w0xlt/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/w0xlt/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/w0xlt/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/w0xlt/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/w0xlt/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/w0xlt/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/w0xlt/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/w0xlt/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/w0xlt/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/w0xlt/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/w0xlt/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/w0xlt/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/w0xlt/bitcoin/events",
        "forks_url": "https://api.github.com/repos/w0xlt/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/w0xlt/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/w0xlt/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/w0xlt/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/w0xlt/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/w0xlt/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/w0xlt/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/w0xlt/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/w0xlt/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/w0xlt/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/w0xlt/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/w0xlt/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/w0xlt/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/w0xlt/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/w0xlt/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/w0xlt/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:w0xlt/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/w0xlt/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/w0xlt/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/w0xlt/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/w0xlt/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/w0xlt/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/w0xlt/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/w0xlt/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/w0xlt/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/w0xlt/bitcoin/hooks",
        "svn_url": "https://github.com/w0xlt/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 294956,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-17T19:28:27Z",
        "created_at": "2021-11-14T01:34:01Z",
        "updated_at": "2026-01-15T17:28:29Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a7c29df0e5ace05b6186612671d6103c112ec922",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38908,
        "stargazers_count": 88156,
        "watchers_count": 88156,
        "size": 303687,
        "default_branch": "master",
        "open_issues_count": 733,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-17T13:15:46Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-17T20:37:37Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34565"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 1508,
    "deletions": 584,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 0,
    "comments": 5
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ5ZGRlNjQ4ZmU2ZGYxMWM2Y2Q4MTIxMDhkZDA1ZGQ2MzRlNzU0MDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9dde648fe6df11c6cd812108dd05dd634e75403",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d9dde648fe6df11c6cd812108dd05dd634e75403",
      "tree": {
        "sha": "ac2d50df25be76d41fe2628770813b36866dcbea",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ac2d50df25be76d41fe2628770813b36866dcbea"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f0e1f6540be5cc4f91f2409f0326a95d498087d",
          "sha": "8f0e1f6540be5cc4f91f2409f0326a95d498087d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8f0e1f6540be5cc4f91f2409f0326a95d498087d"
        }
      ],
      "message": "refactor: add BlockDownloadManager class with pimpl pattern\n\nCreate a new BlockDownloadManager module following the established\nTxDownloadManager pimpl pattern:\n\n- blockdownloadman.h: public interface with QueuedBlock, options/info\n  structs, and full BlockDownloadManager API\n- blockdownloadman_impl.h: BlockDownloadManagerImpl with\n  PeerBlockDownloadState and per-peer map\n- blockdownloadman_impl.cpp: forwarding wrappers and implementations\n  for block request tracking, availability processing, download\n  scheduling, stalling detection, and tip staleness checks\n\nThe module manages all block download state: in-flight tracking\n(mapBlocksInFlight), block source attribution (mapBlockSource),\nper-peer download state, sync coordination, and scheduling algorithms\n(FindNextBlocksToDownload, TryDownloadingHistoricalBlocks).\n\nKey design decisions:\n- cs_main provides synchronization (no separate mutex), since block\n  download is inherently tied to chain state via CBlockIndex pointers\n- Two-phase peer registration: ConnectedPeer handles both initial\n  registration (conservative defaults) and re-registration (real\n  connection properties from VERSION handshake)\n- TipMayBeStale preserves lazy initialization of m_last_tip_update\n- CompareExchangeBlockStallingTimeout preserves CAS atomicity for\n  the stalling timeout accessed from multiple threads\n\nNo call sites are migrated yet; that happens in a subsequent commit.",
      "committer": {
        "name": "w0xlt",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-11T01:53:50Z"
      },
      "author": {
        "name": "woltx",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-09T07:21:48Z"
      },
      "sha": "d9dde648fe6df11c6cd812108dd05dd634e75403"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA0MWEzMzExMTQxOWZhN2JhOTljNmZmZTQ3MGIzMmU1OTEzNDA4YzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/041a33111419fa7ba99c6ffe470b32e5913408c1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/041a33111419fa7ba99c6ffe470b32e5913408c1",
      "tree": {
        "sha": "7f6724f8ef71e743ccd05d88861ef84e4d461db5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7f6724f8ef71e743ccd05d88861ef84e4d461db5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9dde648fe6df11c6cd812108dd05dd634e75403",
          "sha": "d9dde648fe6df11c6cd812108dd05dd634e75403",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d9dde648fe6df11c6cd812108dd05dd634e75403"
        }
      ],
      "message": "test: add unit tests for BlockDownloadManager\n\nExercise BlockDownloadManager in isolation:\n\n- peer_lifecycle: registration, sync state (including idempotency\n  and explicit unsetting), blocks in flight, and disconnect cleanup\n  for all counters (preferred, sync, downloading)\n- block_source_tracking: set/get/erase block sources\n- stalling_and_tip_staleness: last tip update get/set, and\n  TipMayBeStale lazy initialization and staleness detection\n- block_requested_basic: request/remove lifecycle, outbound\n  detection, duplicate rejection, in-flight counts\n- remove_block_request_from_specific_peer: peer-targeted removal\n  leaves other peers' requests intact\n- find_block_in_flight: verify BlockInFlightInfo fields across\n  no-flight, single-peer, and multi-peer scenarios with and\n  without partialBlock\n- tip_not_stale_with_blocks_in_flight: blocks in flight suppress\n  staleness even with an old tip update\n- connected_peer_reregistration: two-phase ConnectedPeer upgrade\n  from preferred=false to preferred=true without double-counting\n- compare_exchange_stalling_timeout: CAS success/failure semantics",
      "committer": {
        "name": "w0xlt",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-11T01:53:56Z"
      },
      "author": {
        "name": "woltx",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-09T07:23:07Z"
      },
      "sha": "041a33111419fa7ba99c6ffe470b32e5913408c1"
    },
    {
      "event": "labeled",
      "id": 22713167662,
      "node_id": "LE_lADOABII587qInudzwAAAAVJz28u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22713167662",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T18:54:59Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "commented",
      "id": 3886309416,
      "node_id": "IC_kwDOABII587npGAo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3886309416",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T18:56:09Z",
      "updated_at": "2026-02-17T19:29:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [sedited](https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3887406021), [0xbrito](https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3888994209) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34588](https://github.com/bitcoin/bitcoin/pull/34588) (refactor: decompose Peer struct into focused sub-components by w0xlt)\n* [#34440](https://github.com/bitcoin/bitcoin/pull/34440) (Refactor CChain methods to use references, tests by optout21)\n* [#34389](https://github.com/bitcoin/bitcoin/pull/34389) (net/log: standardize peer+addr log formatting via `LogPeer` by l0rinc)\n* [#33854](https://github.com/bitcoin/bitcoin/pull/33854) (fix assumevalid is ignored during reindex by Eunovo)\n* [#27052](https://github.com/bitcoin/bitcoin/pull/27052) (test: rpc: add last block announcement time to getpeerinfo result by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (✨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- \"the actual timeout is increased temporarily if peers are disconnected for hitting the timeout\" -> \"The actual timeout is increased temporarily if peers are disconnected for hitting the timeout\" [Sentence starts with lowercase \"the\"; capitalize to form a proper sentence.]\n- \"Number of preferable block download peers.\" -> \"Number of preferred block download peers.\" [\"preferable\" is incorrect word choice here; \"preferred\" matches the code and meaning.]\n\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- m_blockdownloadman.SetBlockSource(block_transactions.blockhash, pfrom.GetId(), false) in src/net_processing.cpp\n- m_blockdownloadman.SetBlockSource(hash, pfrom.GetId(), true) in src/net_processing.cpp\n- bdm.SetBlockSource(hash1, peer1, true) in src/test/blockdownload_tests.cpp\n\n\n\n<sup>2026-02-17 19:29:10</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3886309416",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565"
    },
    {
      "event": "commented",
      "id": 3887406021,
      "node_id": "IC_kwDOABII587ntRvF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3887406021",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T21:48:34Z",
      "updated_at": "2026-02-11T21:48:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3887406021",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565"
    },
    {
      "event": "commented",
      "id": 3888994209,
      "node_id": "IC_kwDOABII587nzVeh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3888994209",
      "actor": {
        "login": "0xbrito",
        "id": 84880186,
        "node_id": "MDQ6VXNlcjg0ODgwMTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/84880186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xbrito",
        "html_url": "https://github.com/0xbrito",
        "followers_url": "https://api.github.com/users/0xbrito/followers",
        "following_url": "https://api.github.com/users/0xbrito/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xbrito/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xbrito/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xbrito/subscriptions",
        "organizations_url": "https://api.github.com/users/0xbrito/orgs",
        "repos_url": "https://api.github.com/users/0xbrito/repos",
        "events_url": "https://api.github.com/users/0xbrito/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xbrito/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T06:49:40Z",
      "updated_at": "2026-02-12T06:49:40Z",
      "author_association": "NONE",
      "body": "Concept ACK",
      "user": {
        "login": "0xbrito",
        "id": 84880186,
        "node_id": "MDQ6VXNlcjg0ODgwMTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/84880186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xbrito",
        "html_url": "https://github.com/0xbrito",
        "followers_url": "https://api.github.com/users/0xbrito/followers",
        "following_url": "https://api.github.com/users/0xbrito/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xbrito/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xbrito/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xbrito/subscriptions",
        "organizations_url": "https://api.github.com/users/0xbrito/orgs",
        "repos_url": "https://api.github.com/users/0xbrito/repos",
        "events_url": "https://api.github.com/users/0xbrito/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xbrito/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3888994209",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565"
    },
    {
      "event": "subscribed",
      "id": 22781874699,
      "node_id": "SE_lADOABII587qInudzwAAAAVN59IL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22781874699",
      "actor": {
        "login": "nervana21",
        "id": 205626986,
        "node_id": "U_kgDODEGeag",
        "avatar_url": "https://avatars.githubusercontent.com/u/205626986?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nervana21",
        "html_url": "https://github.com/nervana21",
        "followers_url": "https://api.github.com/users/nervana21/followers",
        "following_url": "https://api.github.com/users/nervana21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/nervana21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/nervana21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/nervana21/subscriptions",
        "organizations_url": "https://api.github.com/users/nervana21/orgs",
        "repos_url": "https://api.github.com/users/nervana21/repos",
        "events_url": "https://api.github.com/users/nervana21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/nervana21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T00:11:35Z"
    },
    {
      "event": "commented",
      "id": 3902164735,
      "node_id": "IC_kwDOABII587olk7_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902164735",
      "actor": {
        "login": "Crypt-iQ",
        "id": 15145615,
        "node_id": "MDQ6VXNlcjE1MTQ1NjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/15145615?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Crypt-iQ",
        "html_url": "https://github.com/Crypt-iQ",
        "followers_url": "https://api.github.com/users/Crypt-iQ/followers",
        "following_url": "https://api.github.com/users/Crypt-iQ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Crypt-iQ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Crypt-iQ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Crypt-iQ/subscriptions",
        "organizations_url": "https://api.github.com/users/Crypt-iQ/orgs",
        "repos_url": "https://api.github.com/users/Crypt-iQ/repos",
        "events_url": "https://api.github.com/users/Crypt-iQ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Crypt-iQ/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T16:50:53Z",
      "updated_at": "2026-02-14T16:50:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "Only glanced at the changes -- does this change make it easier to fuzz individual components?",
      "user": {
        "login": "Crypt-iQ",
        "id": 15145615,
        "node_id": "MDQ6VXNlcjE1MTQ1NjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/15145615?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Crypt-iQ",
        "html_url": "https://github.com/Crypt-iQ",
        "followers_url": "https://api.github.com/users/Crypt-iQ/followers",
        "following_url": "https://api.github.com/users/Crypt-iQ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Crypt-iQ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Crypt-iQ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Crypt-iQ/subscriptions",
        "organizations_url": "https://api.github.com/users/Crypt-iQ/orgs",
        "repos_url": "https://api.github.com/users/Crypt-iQ/repos",
        "events_url": "https://api.github.com/users/Crypt-iQ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Crypt-iQ/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3902164735",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEyNGQzNmU3NWMwZjYwMmZiZWY2MTA2OTI4ZjU2MzFiZTQxYzE1MGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a24d36e75c0f602fbef6106928f5631be41c150f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a24d36e75c0f602fbef6106928f5631be41c150f",
      "tree": {
        "sha": "ee18b04766571038fdfa479ceefd33942de120ca",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee18b04766571038fdfa479ceefd33942de120ca"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/041a33111419fa7ba99c6ffe470b32e5913408c1",
          "sha": "041a33111419fa7ba99c6ffe470b32e5913408c1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/041a33111419fa7ba99c6ffe470b32e5913408c1"
        }
      ],
      "message": "refactor: migrate block download state and methods into BlockDownloadManager\n\nMove all block download state and logic from PeerManagerImpl and\nCNodeState into BlockDownloadManager, completing the extraction.\n\nMigrated from PeerManagerImpl:\n- mapBlocksInFlight, mapBlockSource, nSyncStarted\n- m_block_stalling_timeout, m_last_tip_update\n- m_num_preferred_download_peers, m_peers_downloading_from\n- IsBlockRequested, IsBlockRequestedFromOutbound\n- RemoveBlockRequest, BlockRequested, TipMayBeStale\n- ProcessBlockAvailability, UpdateBlockAvailability\n- FindNextBlocksToDownload, TryDownloadingHistoricalBlocks\n\nMigrated from CNodeState:\n- pindexBestKnownBlock, hashLastUnknownBlock\n- pindexLastCommonBlock, pindexBestHeaderSent\n- fSyncStarted, vBlocksInFlight, m_downloading_since\n- m_stalling_since, fPreferredDownload\n\n~150 call sites updated to go through m_blockdownloadman.",
      "committer": {
        "name": "w0xlt",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-17T19:27:48Z"
      },
      "author": {
        "name": "woltx",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2026-02-09T07:23:37Z"
      },
      "sha": "a24d36e75c0f602fbef6106928f5631be41c150f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22863080233,
      "node_id": "HRFPE_lADOABII587qInudzwAAAAVSvusp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22863080233",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a24d36e75c0f602fbef6106928f5631be41c150f",
      "commit_url": "https://api.github.com/repos/w0xlt/bitcoin/commits/a24d36e75c0f602fbef6106928f5631be41c150f",
      "created_at": "2026-02-17T19:28:29Z"
    },
    {
      "event": "commented",
      "id": 3917016833,
      "node_id": "IC_kwDOABII587peO8B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3917016833",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-17T20:48:35Z",
      "updated_at": "2026-02-17T20:48:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Only glanced at the changes -- does this change make it easier to fuzz individual components?\r\n\r\nYes, this is one of the main benefits. Currently block download logic is embedded in `PeerManagerImpl` and `CNodeState`, which require standing up the full net_processing stack (`connman`, `addrman`, `mempool`, etc.) to test. There is no way to exercise block scheduling, request tracking, or stalling detection without that heavy setup.\r\n\r\nAfter this PR, `BlockDownloadManager` can be constructed with just a `ChainstateManager` reference:\r\n\r\n```c++\r\nBlockDownloadManager bdm(BlockDownloadOptions{*m_node.chainman});\r\nbdm.ConnectedPeer(peer1, info);\r\nbdm.BlockRequested(peer1, *genesis);\r\n```\r\n\r\nThe fuzz target itself isn't included here (keeping scope focused on the extraction), but the architecture now makes it straightforward to add as a follow-up.\r\n",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34565#issuecomment-3917016833",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34565"
    }
  ],
  "comments": []
}
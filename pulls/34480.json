{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480",
    "id": 3236402146,
    "node_id": "PR_kwDOABII587A55Pi",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34480",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34480.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34480.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
    "number": 34480,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: don't back-date locktime below input locktime",
    "user": {
      "login": "danielabrozzoni",
      "id": 25042473,
      "node_id": "MDQ6VXNlcjI1MDQyNDcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/danielabrozzoni",
      "html_url": "https://github.com/danielabrozzoni",
      "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
      "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
      "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
      "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
      "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Fixes #26527\r\n\r\nThe Bitcoin Core wallet implements an anti-fee-sniping mechanism that sets a transaction's nLockTime to the current block height, and occasionally to an earlier height.\r\n\r\nPreviously, when creating a transaction, the wallet could choose an nLockTime that was lower than the nLockTime of one of its inputs. This creates an unrealistic \"transaction signed earlier but only broadcast now\" scenario and may act as a wallet fingerprint.\r\n\r\nThis PR fixes the issue by adding a `min_allowed_locktime` parameter to `DiscourageFeeSniping`. When creating a transaction, the wallet now sets this minimum to the highest locktime among all parent transactions. This ensures that while the locktime can still be backdated for anti-fee-sniping, it won't go below any input's locktime.\r\n\r\n`DiscourageFeeSniping` is invoked by the following RPCs:\r\n- `sendall`\r\n- `send`\r\n- `sendtoaddress`\r\n- `sendmany`\r\n- `fundrawtransaction`\r\n- `walletcreatefundedpsbt`\r\n\r\nTests are added for `sendall`, `send`, `sendtoaddress` and `sendmany`.\r\n\r\n`fundrawtransaction` and `walletcreatefundedpsbt` can't hit this edge case, because they don't use the anti-fee-sniping logic and instead always set nLockTime to 0 unless explicitly provided by the user.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2026-02-02T12:47:55Z",
    "updated_at": "2026-02-19T11:48:10Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "2f3f82d9d03e724134ddf2103234b4cf019ee912",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "danielabrozzoni:issue/26527-dont-backtime-nlocktime-unconf",
      "ref": "issue/26527-dont-backtime-nlocktime-unconf",
      "sha": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 487334034,
        "node_id": "R_kgDOHQwgkg",
        "name": "bitcoin",
        "full_name": "danielabrozzoni/bitcoin",
        "owner": {
          "login": "danielabrozzoni",
          "id": 25042473,
          "node_id": "MDQ6VXNlcjI1MDQyNDcz",
          "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/danielabrozzoni",
          "html_url": "https://github.com/danielabrozzoni",
          "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
          "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
          "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
          "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
          "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/danielabrozzoni/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/danielabrozzoni/bitcoin",
        "archive_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/events",
        "forks_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/danielabrozzoni/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:danielabrozzoni/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/danielabrozzoni/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/hooks",
        "svn_url": "https://github.com/danielabrozzoni/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 291725,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-09T19:11:55Z",
        "created_at": "2022-04-30T17:02:30Z",
        "updated_at": "2026-02-02T12:38:32Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "64294c89094d5ab10d87236729cc267fde0a24ca",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38914,
        "stargazers_count": 88182,
        "watchers_count": 88182,
        "size": 305192,
        "default_branch": "master",
        "open_issues_count": 724,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-19T10:19:10Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-19T11:26:51Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 158,
    "deletions": 8,
    "changed_files": 7,
    "commits": 6,
    "review_comments": 17,
    "comments": 9
  },
  "events": [
    {
      "event": "labeled",
      "id": 22464527233,
      "node_id": "LE_lADOABII587nm8WCzwAAAAU6_XuB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22464527233",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-02T12:48:00Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "commented",
      "id": 3834928158,
      "node_id": "IC_kwDOABII587klFwe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3834928158",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-02T12:48:45Z",
      "updated_at": "2026-02-14T19:31:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [gmaxwell](https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3902392948) |\n| Concept ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3877330485) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3834928158",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "commented",
      "id": 3834948866,
      "node_id": "IC_kwDOABII587klK0C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3834948866",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-02T12:52:58Z",
      "updated_at": "2026-02-02T12:52:58Z",
      "author_association": "MEMBER",
      "body": "@ishaanam: I put you as a co-author for the first commit, because I started working from your code here https://github.com/bitcoin/bitcoin/pull/26902#pullrequestreview-1522310111 :)",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3834948866",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "mentioned",
      "id": 22464665014,
      "node_id": "MEE_lADOABII587nm8WCzwAAAAU6_5W2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22464665014",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-02T12:52:59Z"
    },
    {
      "event": "subscribed",
      "id": 22464665095,
      "node_id": "SE_lADOABII587nm8WCzwAAAAU6_5YH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22464665095",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-02T12:52:59Z"
    },
    {
      "event": "reviewed",
      "id": 3741843815,
      "node_id": "PRR_kwDOABII587fCAFn",
      "url": null,
      "actor": null,
      "commit_id": "6dd81c2aaae5ce96d123fa637d3a373071c5fc27",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-02T22:12:19Z",
      "author_association": "MEMBER",
      "body": "> The `sendtoaddress` and `sendmany` RPCs don't spend unconfirmed inputs\n\nThey can spend unconfirmed change, and I would prefer for these to be tested as well since the calling of `DiscourageFeeSniping` is different between these RPCs and `send` and `sendall`.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#pullrequestreview-3741843815",
      "submitted_at": "2026-02-02T22:12:19Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhjNTM3YTFhMjZhZWRjYTY1NzE3NDM3ZTFlM2IyY2I4YTczMmQzMGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "tree": {
        "sha": "c0c7d10ba0cf212ee51406f1ff97afb40b144620",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0c7d10ba0cf212ee51406f1ff97afb40b144620"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0c7d10ba0cf212ee51406f1ff97afb40b144620\nparent 5cb4cf9b428ed64edc11fc5489d7b0f0be3c7d73\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1769692941 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770220713 +0100\n\nwallet: don't back-date locktime below input locktime\n\nWhen creating a transaction with anti fee sniping enabled, the wallet\ncould previously select an nLockTime that was lower than the nLockTime\nof its input transactions. This can break the \"transaction signed earlier\nbut broadcast later\" explanation and may act as a wallet fingerprint.\n\nThis is fixed by constraining the anti fee sniping logic to never select\nan nLockTime lower than the maximum nLockTime of the wallet-owned input\ntransactions. The minimum allowed value is passed to\nDiscourageFeeSniping().\n\nCo-Authored-By: ishaanam <ishaana.misra@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmDbKkACgkQfeTx/c7Q\nq4dPsw/+LKtygoek8c5zwKGhMDUr/Crt7seOKbz98WGJ28XvDyagTGCY/A6vODH2\n6SvGJ6DdyetKcg5kx/ujOmMi1DZSGDfV6E4fG2Wm/htT6eP4lKuU4l3vzC4zu/z6\nQq6tP1mJnxp+n2+EfflGT3j7b8dj0ZG1r3S+dKnM/UT++AlQ5kBonRW9LvPXv0PJ\n4CwyXf6yLaLUL+94Hyyw74oheVSvgAQcy5QtLzN/80rVT7OvAB5tibOW6I86XHmj\nIn6DuXVpcQ00s0yRH5OQ+e0+Epf5BE215v3yHMOh0V+hjY3s5f8h8GBCPrtPot9F\ndsUo0P8zdJ9vI5aiudnXbnonut4XdGq8IsOWnMs1x1R3jKJV4VV5QcSB0G9zqgPV\nbz9bHVihLmpfMvGID3asxlmIMgur6FCVYgm14c0ljzYrUYu7sXzpwZti5CzIo0o0\nxck4jtqwZREMW6MlwHJychar4ddsaauYaH1aVcfM+FcgpB/R1HRMa1tjkochfTnl\n8NW+lGGIZ0T8rYfaj17aA9jfA+weOtxtxWQMBG1Bw4CvSvbpNRf4GDypjfYCBaAm\ngBDhZHgODotFc1HuWSjZXj3AzZwlBfQBbuLMEuH8TTZJqmzIlMN/yUUwnP/QEGKY\nCptx7HvJYOb5h2F3g/6JCXkogmyCrF9czqt0N4e04CmPGspDkLI=\n=2nDH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5cb4cf9b428ed64edc11fc5489d7b0f0be3c7d73",
          "sha": "5cb4cf9b428ed64edc11fc5489d7b0f0be3c7d73",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5cb4cf9b428ed64edc11fc5489d7b0f0be3c7d73"
        }
      ],
      "message": "wallet: don't back-date locktime below input locktime\n\nWhen creating a transaction with anti fee sniping enabled, the wallet\ncould previously select an nLockTime that was lower than the nLockTime\nof its input transactions. This can break the \"transaction signed earlier\nbut broadcast later\" explanation and may act as a wallet fingerprint.\n\nThis is fixed by constraining the anti fee sniping logic to never select\nan nLockTime lower than the maximum nLockTime of the wallet-owned input\ntransactions. The minimum allowed value is passed to\nDiscourageFeeSniping().\n\nCo-Authored-By: ishaanam <ishaana.misra@gmail.com>",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-04T15:58:33Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-01-29T13:22:21Z"
      },
      "sha": "8c537a1a26aedca65717437e1e3b2cb8a732d30a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgyOTk5Njc2NjQxNzNmNGZhN2NmZTAxYWQ3NDZkZDBlNjIyMGQ4YzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8299967664173f4fa7cfe01ad746dd0e6220d8c5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8299967664173f4fa7cfe01ad746dd0e6220d8c5",
      "tree": {
        "sha": "bba9422f75ca16fc441c7f47c5f8ce55fec0d130",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bba9422f75ca16fc441c7f47c5f8ce55fec0d130"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bba9422f75ca16fc441c7f47c5f8ce55fec0d130\nparent 8c537a1a26aedca65717437e1e3b2cb8a732d30a\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1769692963 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770220714 +0100\n\ntest: assert anti-fee-sniping locktime is within 100 blocks\n\nThe previous assertion only verified that nLockTime was non-zero.\nTighten the check to ensure the locktime is within the allowed range,\nup to 100 blocks in the past.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmDbKoACgkQfeTx/c7Q\nq4c93A/+P1g4PsbCKmlFYBr4os9paUm/uaR1k9AIY3AGT96qgDaIqowtwruy1G9a\nLNZyAMK3sMz4OpQCeXTz77Xmlno8H9KZQ6eTo9RVZQm2EFeQkTriRGwpkD+4h8Um\n+I9Egx2qXI7A7J+RZzgdSSZjJCIQ7uPJLb+HTEyOQ+NdvpQ/jGcW38hC6VQwYNJH\nv30a7rrEt7NPJH38VpLaf5BUFJh06Fx7amGgiWE3jUi7ym25YPSJXDFcQwy7rQ0+\nnB1S+b4SA0wrnEc59BdujjC3sMLxA6kbkH4H2JdEN1A0gf3E/ZbOGNq3kx/rTL/8\nH/T75Fgfv3Z4eKGgJzVEbppw82Stq17yzgHGP4Lw8W/SB1CruuEujuP/zqPwWZzX\nx0KRUYLLc7WmL5VdqJWx1w1HpsEl75iu/P46i7JX5bExNxP1jxGvFsS1MV6Uc2hl\nuCCzLLJBagViw8JFxijYQUw6piI8+QC96Ycy7++OvyahfN7ATU9isWLZIsAlGbFd\nrfe2BYV/rCOOTva9V9vIPvTEblIy3y52LquFWg/Dxx654vpC04e2/h4zaMeozxQc\nVGqlyWd4/SHiV9Qb1/masJqWBsY3G29g/825+5w9Wtsu+MGEXB5dMoaebZj1ycUu\nPH6DEzOoyHvV92PPLX6HmP0bdc/utCJvIugH+soekU5l48di5jg=\n=T2O2\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c537a1a26aedca65717437e1e3b2cb8a732d30a",
          "sha": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8c537a1a26aedca65717437e1e3b2cb8a732d30a"
        }
      ],
      "message": "test: assert anti-fee-sniping locktime is within 100 blocks\n\nThe previous assertion only verified that nLockTime was non-zero.\nTighten the check to ensure the locktime is within the allowed range,\nup to 100 blocks in the past.",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-04T15:58:34Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-01-29T13:22:43Z"
      },
      "sha": "8299967664173f4fa7cfe01ad746dd0e6220d8c5"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22553937619,
      "node_id": "HRFPE_lADOABII587nm8WCzwAAAAVAUcbT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22553937619",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c3e79dffb0ccfaa86f61843838873059613caaaf",
      "commit_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/commits/c3e79dffb0ccfaa86f61843838873059613caaaf",
      "created_at": "2026-02-05T10:12:33Z"
    },
    {
      "event": "renamed",
      "id": 22553979690,
      "node_id": "RTE_lADOABII587nm8WCzwAAAAVAUmsq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22553979690",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T10:14:13Z",
      "rename": {
        "from": "wallet: don't back-date locktime below unconfirmed input locktime",
        "to": "wallet: don't back-date locktime below input locktime"
      }
    },
    {
      "event": "commented",
      "id": 3852562476,
      "node_id": "IC_kwDOABII587loXAs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3852562476",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T10:17:22Z",
      "updated_at": "2026-02-05T10:17:22Z",
      "author_association": "MEMBER",
      "body": "Thanks for your review Ava! I picked up your suggestions, and the idea in https://github.com/bitcoin/bitcoin/issues/26527#issuecomment-3818834598.\r\n\r\nChanges since last push:\r\n- Now we avoid backdating the nlocktime below any input nLocktime, not just unconfirmed inputs.\r\n- I added tests for `sendtoaddress` and `sendmany`. These use confirmed parent transactions instead of unconfirmed change, which was easier to implement and still tests the same behavior.\r\n- In the tests, I explicitly set the parent `nLockTime` and retry creating a child transaction until I get one with a backdated `nLockTime` (`nLockTime != tip_height`).\r\n\r\nOne concern I have, which I just realized: since we cannot know the `nLockTime` for external inputs, we might still end up backdating below those inputsâ€™ `nLockTime`. This could be problematic, since it may leak some information about which inputs are wallet-owned. Is this acceptable?\r\n\r\nI thought about a couple of ways to mitigate this but could not implement either. Let me know if I missed something:\r\n\r\n- Getting external unconfirmed inputs from the mempool. Unfortunately, I could use `wallet.chain` to check whether a tx is in the mempool (`isInMempool`), but couldn't retrieve the whole transaction\r\n- Getting external inputs from the txindex, if enabled. Unfortunately I could not access g_txindex from the wallet code.\r\n\r\nOtherwise, we could disallow backdating if there's at least one external input, by setting `min_allowed_locktime` to the tip height. ",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3852562476",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "reviewed",
      "id": 3760053162,
      "node_id": "PRR_kwDOABII587gHduq",
      "url": null,
      "actor": null,
      "commit_id": "c3e79dffb0ccfaa86f61843838873059613caaaf",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-06T00:10:51Z",
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#pullrequestreview-3760053162",
      "submitted_at": "2026-02-06T00:10:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQxMDBlZThhYTAwNzE0MWI1OWQ5OTBiZWM5NTA2NGVkNDJlMDRiOWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4100ee8aa007141b59d990bec95064ed42e04b9a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4100ee8aa007141b59d990bec95064ed42e04b9a",
      "tree": {
        "sha": "71307b9676ceacd965b454bc7c846b8286487fcc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/71307b9676ceacd965b454bc7c846b8286487fcc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 71307b9676ceacd965b454bc7c846b8286487fcc\nparent 8299967664173f4fa7cfe01ad746dd0e6220d8c5\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1769692981 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770661842 +0100\n\ntest: check send respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmKJ9IACgkQfeTx/c7Q\nq4ctJg/5AT+nd/Kyd2L9GPmk8G8sNXedUn4EkrM6HKoNrf17ViP2SBiQ2JW75NYH\npIOq7192L1cv6k+buNWTcHZpZpyUclAv/sqYzcrsntsI+xpDU7D/8Uk5zbu2iWmA\nUaDk/5rx3+DouNlsoLnZfMsR+BXfxfZm+rKXnyznaxb/VJHwYwiTfrPIa5fHujVZ\nDyLrADkzVz+mofftIO1G9Hba2ThSuLhsCZvDLSWLAleYk7jXKdWmUl29KOZoseZb\n3Kkie2Q9MXW8J3OKcgfaIYaIdYuv46FjtNogw2ARuFETH6WViKZ009bdPnGcTbQQ\nZSc7mT2nWxHkG7E/aulni5Ra9x81lBHfU5wpyNWV4XDbLSSlLJ35ypIU0ah408sD\nSIfjLPOHnuCT66xUjJMyN6yCYY/YApJ6g12RhQBcIqDxeDvC3HmszWzVueSEJMIb\nyrO0GMDUESRZ8qU4ttII5MqgETUz+VKM0Ba5kFPmqPWlqGX32dLNbyWohK9diovq\nWMMIo4RwcVMw2YRBgOgDKGHd6tFPy107wDlRA21wua3z9E+1lsw9bSwucQ7N4XGx\nJB54rFDD8r9TFWAG0ySqCgebCf+9gN+qMTOxbWc67aTBrMELvSojt+vFkrgtlUrl\np9nX5fKxg5icZa4IiuFhr4rrcmEu22BlbeqxGE8JmQfifilIk8g=\n=PvZX\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8299967664173f4fa7cfe01ad746dd0e6220d8c5",
          "sha": "8299967664173f4fa7cfe01ad746dd0e6220d8c5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8299967664173f4fa7cfe01ad746dd0e6220d8c5"
        }
      ],
      "message": "test: check send respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-09T18:30:42Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-01-29T13:23:01Z"
      },
      "sha": "4100ee8aa007141b59d990bec95064ed42e04b9a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM0MDlkOTlkYWE1ZTc4NGIzNGVhYWZhZGU2NzhkMmU1NDdiY2JjMjc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c409d99daa5e784b34eaafade678d2e547bcbc27",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c409d99daa5e784b34eaafade678d2e547bcbc27",
      "tree": {
        "sha": "e673c169a5c0a286e0d8a367e2c066bc855b92ae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e673c169a5c0a286e0d8a367e2c066bc855b92ae"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e673c169a5c0a286e0d8a367e2c066bc855b92ae\nparent 4100ee8aa007141b59d990bec95064ed42e04b9a\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1769692998 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770661844 +0100\n\ntest: check sendall respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmKJ9QACgkQfeTx/c7Q\nq4dhYg/9F9otWDISWo5LGL0v6CP7zl8FB7ZGQdkvtPoDEZWHF/FgeUef05NIUkov\n2arWAgfFtfzXu9//39jJggt9kn3RrGq4UY/b6EzpJro26zP1s43OPn2r1Nr3749S\nDb9ZPekwlrVExHyeXNVPkB1EgNj1sQYdyFeSNm+xFje10zJMs1wIcPfSltMRL20h\ngIVmpp0OQBmufkhrtKfAbx9808AH0F9Tr4qMp5OtqoMvO3ivwO84W+AGRjgmP2gj\nzKkuR8qZ+UzjXjaLmEdM5YW1zk4PP2lL8VBK19RVXWnaPL5cWNxuI9xwH3nMwn0Y\nVLCbPCRCbSWNPqMgwTe5g9Vuyft0M/TIZPGOu3gzjeN2YV+7It5ZhzEjshK1tYOh\nXPQzqNMD+8Nk/DSw2KFH9MTxjxvss6U/7u6CRGWwkyUksd5RhoCv0oW69eNVdhy4\nAhODwxBzPxHO1b5Us4Xce3nV0F5Xznd2o57knb8aKLbStxoRZ4Qs0O+K8Qb2Nx04\n7YMsFZtnaU+zGOcfsg8r5H/A9U1wmDmW915/LTQZ8OB0BvHtQpPVoiwfu8/vbFn7\ny0SxyHGI2ahUWNDOmbpsQ7qBtGuQ9GlBfgmeQ8+McaV5Bve71Ztfkfjj297xPHWi\nrz0HvettOX4r9ilK/HigJ+D3YirmG1AaT9DZSYIev7+x+nnTRH0=\n=S1KV\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4100ee8aa007141b59d990bec95064ed42e04b9a",
          "sha": "4100ee8aa007141b59d990bec95064ed42e04b9a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4100ee8aa007141b59d990bec95064ed42e04b9a"
        }
      ],
      "message": "test: check sendall respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-09T18:30:44Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-01-29T13:23:18Z"
      },
      "sha": "c409d99daa5e784b34eaafade678d2e547bcbc27"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRkOGJlZGIyZGVjNjFlOGUyNTBiNGU1ZjQwNjIxZDk3Mjk4NTFjNGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "tree": {
        "sha": "73796648b6c82422e7042b8c0c5331820e407e22",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/73796648b6c82422e7042b8c0c5331820e407e22"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 73796648b6c82422e7042b8c0c5331820e407e22\nparent c409d99daa5e784b34eaafade678d2e547bcbc27\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770203720 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770661845 +0100\n\ntest: check sendtoaddress respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmKJ9UACgkQfeTx/c7Q\nq4eMog/9G508w7DWVGFr33WB/qTFYZBRmUyCnwJeNCdHRyJF2NpCflp+UQBpBDu4\n4zNzmijyY/km5EFQIzd++zbOy9Tyv+JewYW7Yb3YC6rRBgVonkZj8MAMiJZJdGva\nkp68XaH9UwcRhWw4yOByVF9IghRM5s3+i54fYkZjL6HWX+MjzZLG8RRFMiajqgCW\nXIoXW2knDo6yJWKsTFCEq1nHnRXFNDi9BaIGGaB23DTlsQSV3AVHXmzINLIfylg4\n8Wl/1hLAV0wGb9zWSFfjnm/G6J0E9YzdY8WNBlm7LymFyBwG75lBQ0PrZR3LFFcl\n2DlL46g85R/ABafEtRAtRBEk7f8c7rYGUy/plXvPNgxlrT2caTtdQeVdwhFBBfyF\ntvME3OxVQYCTPhR0usLbw2Jeg/xgTGAFH9ZTFKYAZrnvisvMRpvEEN75CPZkSGeU\nAiylLeKDFcTtXOAW45WqHU993sgg4pSqE8VbFJaitfNHv9odBh12La7OOH84D+2z\nwesCE9upsZhU9efzRH9rwOCRbv8fhPBxD5rw1gS3exfJmxR9Ge7SCmvtyfM6y7c6\nUGOd8vD7P3YjPX1d3Pc+R0ATozyMDYBo0l59688DgJqFePMAjRx0N1xGFTLx5rfr\n/UMrieHwzeg4hxpDgtXwZF++ziGWiqlA6JSsQ9LHv19jeAcI/dA=\n=aUYS\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c409d99daa5e784b34eaafade678d2e547bcbc27",
          "sha": "c409d99daa5e784b34eaafade678d2e547bcbc27",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c409d99daa5e784b34eaafade678d2e547bcbc27"
        }
      ],
      "message": "test: check sendtoaddress respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-09T18:30:45Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-04T11:15:20Z"
      },
      "sha": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhiZDY4NTdlYjhkYzcyMGY4YTA4ODNkMmM1ODcwMjFiMmU4ZmQwZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "tree": {
        "sha": "3588f6e1a30c404d806522a14fa7c2f82256f978",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3588f6e1a30c404d806522a14fa7c2f82256f978"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3588f6e1a30c404d806522a14fa7c2f82256f978\nparent 4d8bedb2dec61e8e250b4e5f40621d9729851c4a\nauthor Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770203733 +0100\ncommitter Daniela Brozzoni <danielabrozzoni@protonmail.com> 1770661846 +0100\n\ntest: check sendmany respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEZkx/loNGWB3axvvxfeTx/c7Qq4cFAmmKJ9YACgkQfeTx/c7Q\nq4d37A/9G7JRIsi/cf70YzTvkcKHUrn/aXtqyFKLx46dEBiIsVRuPH/l8wnP/VXN\nDywXHo7g4gnCdriHoGFitxilxhv5R8KCn3tXlm+vNtI92T+iUaCJES39RUfV5mJk\neOBDEyPksu/CDYFLn3pw0degcOYaoYuBgDiP2dQUtooTZE81h0fwPiwRUMJzuqXl\n39vf5h1MpjjystTAAWheoaagwlR7GMG/BAsgmgq5EcPc5/Na57fP28yxW7LvmPg/\nNT80qD9ulkqkEZ9Mv/ea81W5vA6DHh5nkwrdoBR8PktlZxA8hbj/KgWLKYWM6eki\n/Lryf4kCgKeTfNJqLOQ7+pAoVC0TwqMVKKBz0lpSE12kmfRgrAa0lwuh0cbW6lcV\n15E/nTLeY7ToLGQQ9EvVdlLOJ92iwoGXjEuD/g1VRDvEgC3u5AaAPtHretFYdMNK\nfRB/ousRFTeDDA2230Ex3azXk+nytk3exrd+MGWTuJMX5hnqsTyQ4UzZ3Illa+Uf\nDA+4mniOyLcevF90TFSyx+IUiNHQmxswEHZwErTY0vFnWClTGIJ9DTIhdKySgPtw\nLLtFkGZK+SCZR5QoeIISlt4yK4X2wWPjC1D6foWn+H5dc5E0R1uNlJEbdiKRmyT9\nCx5DbFMRsrP7LaWOPXi2EtSM9O5eVKZemGSQqVDTwL5jjf1tRNk=\n=mui5\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
          "sha": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4d8bedb2dec61e8e250b4e5f40621d9729851c4a"
        }
      ],
      "message": "test: check sendmany respects input locktimes with anti fee sniping\n\nAdd a test to verify that when the anti fee sniping logic randomly\nbackdates a transaction locktime, the send RPC never selects a value\nlower than the nLockTime of its input transactions.",
      "committer": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-09T18:30:46Z"
      },
      "author": {
        "name": "Daniela Brozzoni",
        "email": "danielabrozzoni@protonmail.com",
        "date": "2026-02-04T11:15:33Z"
      },
      "sha": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22652099235,
      "node_id": "HRFPE_lADOABII587nm8WCzwAAAAVGK5qj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22652099235",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "commit_url": "https://api.github.com/repos/danielabrozzoni/bitcoin/commits/8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "created_at": "2026-02-09T19:11:56Z"
    },
    {
      "event": "commented",
      "id": 3873439869,
      "node_id": "IC_kwDOABII587m4AB9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3873439869",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-09T19:24:38Z",
      "updated_at": "2026-02-09T19:24:38Z",
      "author_association": "MEMBER",
      "body": "Thanks!\r\n\r\nLast push (8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6):\r\n- Address https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2771675158",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3873439869",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "commented",
      "id": 3877330485,
      "node_id": "IC_kwDOABII587nG141",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3877330485",
      "actor": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T12:35:40Z",
      "updated_at": "2026-02-10T12:35:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6, reviewing at the moment.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3877330485",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "reviewed",
      "id": 3778689371,
      "node_id": "PRR_kwDOABII587hOjlb",
      "url": null,
      "actor": null,
      "commit_id": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-10T13:06:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "I have shared few points.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#pullrequestreview-3778689371",
      "submitted_at": "2026-02-10T13:06:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
    },
    {
      "event": "reviewed",
      "id": 3778982205,
      "node_id": "PRR_kwDOABII587hPrE9",
      "url": null,
      "actor": null,
      "commit_id": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-10T13:30:26Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#pullrequestreview-3778982205",
      "submitted_at": "2026-02-10T13:30:26Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
    },
    {
      "event": "commented",
      "id": 3902392948,
      "node_id": "IC_kwDOABII587omcp0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902392948",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T19:31:34Z",
      "updated_at": "2026-02-14T19:31:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "NACK.\r\n\r\nOn its face this is kind of a pointless change:  A transaction can have any locktime before where was created, it's not a \"time the transaction was created\" except as a side effect of anti-fee sniping and then only if it was anti-fee-sniping that set the lock time... and so it's not weird for a transaction to have a locktime after one of its inputs.   It leaks no information to do this, so it's harmless if semantically meaningless since you can't confirm a transaction before its inputs.\r\n\r\nThe practice is not, however, *necessarily* semantically meaningless.  It is if SIGHASH_ALL is used, but if the transaction uses ANYONECANPAY or just doesn't have signatures, then it may be completely semantically sensible to have the locktime of a transaction lower than an input it uses when it does get confirmed.\r\n\r\nOn these basis I believe #26527 was just mistaken, it's not a problem.\r\n\r\nAll this seemed like pointless churn to me, and harmless within the context of core's wallet and anti-fee-sniping where the simplified understanding (e.g. no ANYONECANPAY) usually applies... I wasn't going to comment at all, other than to maybe mention it to the authors so they didn't think they could make these assumptions outside of the wallet.  But then I realized this PR has more serious problems:\r\n\r\nApplying the clamping only to wallet transactions is a distinguisher which identifies inputs as belonging to the wallet or not, and would potentially leak which inputs belong to the author (e.g. in a payjoin/coinjoin transactions).  It doesn't follow the causality argument (for non-anyonecanpay inputs) that a tx cannot be confirmed before its inputs, which doesn't care who authored the inputs. I think this is a fatal privacy vulnerability.  Even though nothing in the wallet's UI creates payjoins or coinjoins right now AFAIK people do it via the RPC, and future features could implement stuff like payjoin support without noticing this leak.\r\n\r\nThe approach here is also incorrect in that even among wallet transactions it would apply deeply and not just to the immediate inputs: We cannot assume that all transactions in the wallet were authored with the same code we're currently.  So if C spends B which spends A then C's locktime would need to be checked against A too and not just B.\r\n\r\nCorrectly applying that causality limit would require applying it to all transactions in the causative transaction history, regardless of who owns them. -- This data isn't tracked at all right now not even in the chainstate, so there is no trivial fix.  Even making it just go one deep (which still doesn't completely 'fix' the behavior) is also not trivial due to needing non-wallet data.\r\n\r\nThe code also doesn't appear to correctly (or at least intentionally) handle the fact that locktime is logically a union type between a lock height and a lock time.   How does one construct a maximum between inputs that are lock heights and lock times?  (I believe the current code just blindly changes things to locktimes if any input is a time-- probably not the intended behavior!).  It also doesn't appear to check if the locktime is actually active through non-maximal sequence.  \r\n\r\nSo I think to implement the intent of this would require tracking in the UTXO set a maximum locktime and lock height for the casual history of every output in the change (taking care to inspect sequences to only include active locks), and then apply it.  That would be conceptually correct absent the existence of ANYONECANPAY  (which I think can't ever be made to make sense with this behavior).  Sensibly handling mixed locktimes also seems hard even once you've correctly tracked them, as you may not always be able to convert between them until very close to locked in (when heights are convertible to MTP times).\r\n\r\nBut I think ultimately pointless because it's an attempt to fix a non-issue, and would be a complex, invasive, and runtime expensive change, and the half measure should not be done due to the privacy issue.\r\n",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3902392948",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "commented",
      "id": 3902513825,
      "node_id": "IC_kwDOABII587om6Kh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902513825",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T20:59:13Z",
      "updated_at": "2026-02-14T20:59:13Z",
      "author_association": "MEMBER",
      "body": "> Even though nothing in the wallet's UI creates payjoins or coinjoins right now AFAIK people do it via the RPC\r\n\r\nCurrently doing those via the `walletcreatefundedpsbt` and `*rawtransaction` RPCs results in no anti-fee-sniping being applied at all. I think `send` does apply anti-fee-sniping, but that can also easily be changed to not do it if any inputs are not known to the wallet.\r\n\r\n> future features could implement stuff like payjoin support without noticing this leak.\r\n\r\nThis probably needs a recommendation in the BIPs as well.\r\n\r\n> The code also doesn't appear to correctly (or at least intentionally) handle the fact that locktime is logically a union type between a lock height and a lock time. How does one construct a maximum between inputs that are lock heights and lock times? (I believe the current code just blindly changes things to locktimes if any input is a time-- probably not the intended behavior!).\r\n\r\nHmm, good point. It looks like it would change to timestamps, and then immediately assert.\r\n\r\n> It also doesn't appear to check if the locktime is actually active through non-maximal sequence.\r\n\r\nThere are checks prior to calling `DiscourageFeeSniping` to ensure that sequences are non-final so that anti-fee-sniping will work in general.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3902513825",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "commented",
      "id": 3902690382,
      "node_id": "IC_kwDOABII587onlRO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902690382",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T22:32:57Z",
      "updated_at": "2026-02-14T22:32:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "> There are checks prior to calling DiscourageFeeSniping to ensure that sequences are non-final so that anti-fee-sniping will work in general.\r\n\r\nThat helps only if you can presume all in-wallet transactions (including potentially ones created before anti-fee-sniping was invented) were created by code that makes them final! :)\r\n",
      "user": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3902690382",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "commented",
      "id": 3926747359,
      "node_id": "IC_kwDOABII587qDWjf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3926747359",
      "actor": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-19T11:48:10Z",
      "updated_at": "2026-02-19T11:48:10Z",
      "author_association": "MEMBER",
      "body": "Thanks for the feedback @gmaxwell!\r\n\r\nI agree with you that this change is a half measure, and your message helped me understand that it's a smaller improvement than what I initially thought. I still think it might be worth pursuing, since the privacy issue seems solvable. However, I'm not sure if this particular half measure is worth the review time and slight increase in code complexity.\r\n\r\nThe goal of this PR is to make anti-fee-sniping less obvious in certain (very) specific cases. The benefit is that an external observer would not be able to clearly distinguish between a wallet that implements anti-fee-sniping and one that simply supports nLockTime where the user selected it manually.\r\n\r\nThat said, there are a couple of issues, so thanks for pointing them out and taking the time to explain!\r\n\r\n> Applying the clamping only to wallet transactions is a distinguisher which identifies inputs as belonging to the wallet or not...\r\n\r\nAs far as I can see, there are two ways to create a multiparty transaction:\r\n1. You ask all your cosigners their inputs' outpoints, create a transaction with all the inputs, sign it (without need of using ANYONECANPAY), pass it on.\r\n2. You create a transaction with your inputs, sign with ANYONECANPAY, pass it on to your cosigners, which will add their inputs and sign\r\n\r\nCase 1) can be hit at the moment, using `sendall` or `send`. You can solve the privacy issue by not backdating when there are external inputs. Since anti fee sniping only backdates 10 percent of the time, an observer cannot easily distinguish between \"not backdated because it is multiparty\" and \"not backdated due to randomness.\"\r\n\r\nWe can't hit 2) at the moment, since we don't have a way to create a transaction and sign it with ANYONECANPAY with any RPCs affected by this change (`sendall`, `send`, `sendtoaddress`, `sendmany`), and I think it's safe to assume that we never will.\r\n\r\n> The approach here is also incorrect in that even among wallet transactions it would apply deeply and not just to the immediate inputs: We cannot assume that all transactions in the wallet were authored with the same code we're currently. So if C spends B which spends A then C's locktime would need to be checked against A too and not just B.\r\n\r\nYes, true. I agree with you that implementing the full fix wouldn't be worth the effort, and without implementing it, this is just a half measure.\r\n\r\n> The code also doesn't appear to correctly (or at least intentionally) handle the fact that locktime is logically a union type between a lock height and a lock time.\r\n\r\nYes, thanks for catching this. I didn't consider time-based locktime when writing the current code, which currently would simply not backdate at all if any parent had a time-based nlocktime. (It doesnâ€™t crash, but thatâ€™s not because I handled time-based locktimes properly, just because it happens to work out :))\r\n\r\nI think there could be two ways to go about this:\r\n1. Don't backdate at all if any input transaction has a time-based locktime, or\r\n2. Only consider height based locktimes when calculating `min_allowed_locktime`. If a parent has a time based locktime, I will simply ignore it. This means that if I create B, spending A, and A has a time-based locktime, I ignore it, and B might or might not have a locktime that is <= A's locktime, and I might or might not show that I'm backdating.\r\n\r\nI don't have a strong preference either way.\r\n\r\n>>> It also doesn't appear to check if the locktime is actually active through non-maximal sequence.\r\n\r\n>> There are checks prior to calling DiscourageFeeSniping to ensure that sequences are non-final so that anti-fee-sniping will work in general.\r\n\r\n> That helps only if you can presume all in-wallet transactions (including potentially ones created before anti-fee-sniping was invented) were created by code that makes them final! :)\r\n\r\nYes, thank you. All code paths that lead to calling DiscourageFeeSniping already check that the sequence is non-final so anti-fee-sniping can work. However, when calculating `min_allowed_locktime`, I consider each inputâ€™s locktime without checking whether the sequence actually made that locktime active in the previous transaction.\r\n\r\n## Where this puts us\r\n\r\nOne approach for this PR could be:\r\n\r\na) Only consider the immediate parents of a transaction, instead of all the ancestor history. As you pointed out, considering the whole history would be extremely complex and not worth it.  \r\n\r\nb) Check that the previous locktime is active, ofc :) We can check each inputs' nSequence, ignore the transaction nlocktime if all are SEQUENCE_FINAL\r\n\r\nThen, regarding time based locktimes, one of the following:\r\n\r\nc1) Only consider height based timelocks from the parents, and ignore time based ones.\r\nc2) Or, if one of my parents has a time-based locktime, disable backdating altogether.\r\n\r\nAnd finally\r\n\r\nd) Disable backdating if there are non-wallet inputs\r\n\r\nThe result would be:\r\n\r\nIn the specific case this PR targets, if I create B spending A and A has a height-based locktime, then Bâ€™s locktime would not be set below Aâ€™s.\r\n\r\nHowever, there are still cases this does not address:\r\n\r\n- As you pointed out, if I create C spending B, which spends A, and Aâ€™s locktime is greater than or equal to Bâ€™s, then C is only clamped against B. That means C could still end up with a locktime lower than Aâ€™s, which would reveal backdating.\r\n- For time-based locktimes, it depends on whether we go with c1 or c2. If we choose c1 and I create B spending A where A has a time-based locktime, B could still be backdated below Aâ€™s locktime, again revealing anti-fee-sniping. If we choose c2 instead, then backdating would be disabled in that situation, so B would not be backdated at all.\r\n\r\nOverall, this would be a small improvement over the current behavior, but I am still unsure whether it justifies the effort.",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3926747359",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34480"
    },
    {
      "event": "mentioned",
      "id": 22913453084,
      "node_id": "MEE_lADOABII587nm8WCzwAAAAVVv4wc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22913453084",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-19T11:48:11Z"
    },
    {
      "event": "subscribed",
      "id": 22913453136,
      "node_id": "SE_lADOABII587nm8WCzwAAAAVVv4xQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22913453136",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-19T11:48:12Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756256034",
      "pull_request_review_id": 3741843815,
      "id": 2756256034,
      "node_id": "PRRC_kwDOABII586kSSEi",
      "diff_hunk": "@@ -1286,7 +1293,19 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         use_anti_fee_sniping = false;\n     }\n     if (use_anti_fee_sniping) {\n-        DiscourageFeeSniping(txNew, rng_fast, wallet.chain(), wallet.GetLastBlockHash(), wallet.GetLastBlockHeight());\n+        // Find the highest nLockTime of all unconfirmed inputs so that\n+        // this transaction does not use a lower value.\n+        // Setting a lower nLockTime would make the \"signed earlier but broadcast later\"\n+        // explanation unrealistic, and may act as a wallet fingerprint.\n+        unsigned int max_unconfirmed_input_locktime{0}; // If there aren't any unconfirmed inputs, the minimum locktime is 0\n+        for (const auto& coin: selected_coins) {",
      "path": "src/wallet/spend.cpp",
      "position": 1,
      "original_position": 37,
      "commit_id": "c4325985a0a6f82d482f9c1f9c0276336b2476c8",
      "original_commit_id": "c4325985a0a6f82d482f9c1f9c0276336b2476c8",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In c4325985a0a6f82d482f9c1f9c0276336b2476c8 \"wallet: don't back-date locktime below unconfirmed input locktime\"\n\nnit:\n\n```suggestion\n        for (const auto& coin : selected_coins) {\n```",
      "created_at": "2026-02-02T22:03:42Z",
      "updated_at": "2026-02-02T22:12:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2756256034",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756256034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1301,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756266399",
      "pull_request_review_id": 3741843815,
      "id": 2756266399,
      "node_id": "PRRC_kwDOABII586kSUmf",
      "diff_hunk": "@@ -563,6 +564,25 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_unconfirmed_input_fee_sniping(self):\n+        self.log.info(\"Test that send sets the transaction locktime no lower than any unconfirmed input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        # Create parent tx with anti-fee-sniping nlocktime\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        unconfirmed_parent_txid = self.nodes[0].sendtoaddress(wallet.getnewaddress(), 10)",
      "path": "test/functional/wallet_send.py",
      "position": 1,
      "original_position": 17,
      "commit_id": "d4b45ac6fb09ac85579724497ec9ba639235fe0a",
      "original_commit_id": "d4b45ac6fb09ac85579724497ec9ba639235fe0a",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In d4b45ac6fb09ac85579724497ec9ba639235fe0a \"test: check send RPC locktime is not below unconfirmed input locktime\"\n\nThis relies on the anti-fee-sniping to randomly backdate the locktime. I think it would be better if this could set the locktime to a specific value that would be in range so that the range is not often just a single value.",
      "created_at": "2026-02-02T22:08:28Z",
      "updated_at": "2026-02-02T22:12:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2756266399",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756266399"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 572,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756269235",
      "pull_request_review_id": 3741843815,
      "id": 2756269235,
      "node_id": "PRRC_kwDOABII586kSVSz",
      "diff_hunk": "@@ -563,6 +564,25 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_unconfirmed_input_fee_sniping(self):\n+        self.log.info(\"Test that send sets the transaction locktime no lower than any unconfirmed input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        # Create parent tx with anti-fee-sniping nlocktime\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        unconfirmed_parent_txid = self.nodes[0].sendtoaddress(wallet.getnewaddress(), 10)\n+        unconfirmed_parent_nlocktime = self.nodes[0].gettransaction(txid=unconfirmed_parent_txid, verbose=True)[\"decoded\"][\"locktime\"]\n+        # Parent nlocktime should be within 100 blocks of tip\n+        assert_greater_than_or_equal(unconfirmed_parent_nlocktime, self.nodes[0].getblockcount() - 100)\n+        self.sync_mempools()\n+        # Create child tx spending the unconfirmed parent\n+        utxos = wallet.listunspent(0, 0)\n+        child_txid = wallet.send([{wallet.getnewaddress(): 8}], inputs=utxos)[\"txid\"]",
      "path": "test/functional/wallet_send.py",
      "position": 1,
      "original_position": 24,
      "commit_id": "d4b45ac6fb09ac85579724497ec9ba639235fe0a",
      "original_commit_id": "d4b45ac6fb09ac85579724497ec9ba639235fe0a",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In d4b45ac6fb09ac85579724497ec9ba639235fe0a \"test: check send RPC locktime is not below unconfirmed input locktime\"\n\nSince backdating anti-fee-sniping is random, we should do this multiple times to be reasonably sure that we get a backdated nlocktime.",
      "created_at": "2026-02-02T22:09:47Z",
      "updated_at": "2026-02-02T22:12:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2756269235",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2756269235"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 579,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2771675158",
      "pull_request_review_id": 3760053162,
      "id": 2771675158,
      "node_id": "PRRC_kwDOABII586lNGgW",
      "diff_hunk": "@@ -563,6 +564,35 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_fee_sniping_respects_input_locktime(self):\n+        self.log.info(\"Test that send sets the anti-fee-sniping locktime no lower than any input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        tip_height = self.nodes[0].getblockcount()\n+        # Create a parent transaction with an explicit backdated nLockTime\n+        parent_nlocktime = tip_height - 80\n+        self.nodes[0].send(outputs=[{wallet.getnewaddress(): 100}], locktime=parent_nlocktime)\n+        self.sync_mempools()\n+        # Create child transactions until we observe a backdated nLockTime.\n+        # Backdating happens randomly, so retry until the locktime is less than\n+        # the current block height.\n+        utxos = wallet.listunspent(0, 0)\n+        child_nlocktime = tip_height\n+        # We keep track of the amount to send, so that at each loop we send a bit less, paying more in fees\n+        # and replacing the previous transaction\n+        amount_to_send = 99\n+        while child_nlocktime == tip_height:\n+            child_txid = wallet.send([{wallet.getnewaddress(): amount_to_send}], inputs=utxos)[\"txid\"]",
      "path": "test/functional/wallet_send.py",
      "position": 1,
      "original_position": 30,
      "commit_id": "4033a5ccf924a22bb9236f67052dc05f1b14c446",
      "original_commit_id": "4033a5ccf924a22bb9236f67052dc05f1b14c446",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 4033a5ccf924a22bb9236f67052dc05f1b14c446 \"test: check send respects input locktimes with anti fee sniping\"\n\nSetting `add_to_wallet=False` will prevent the transaction from being added to the wallet or broadcast. That will allow this loop to run without needing to change the amount to send.\n\nSame for the `sendall` test. ",
      "created_at": "2026-02-06T00:08:56Z",
      "updated_at": "2026-02-06T00:10:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2771675158",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2771675158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 585,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787710443",
      "pull_request_review_id": 3778689371,
      "id": 2787710443,
      "node_id": "PRRC_kwDOABII586mKRXr",
      "diff_hunk": "@@ -200,8 +216,9 @@ struct CreatedTransactionResult\n /**\n  * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n+ *",
      "path": "src/wallet/spend.h",
      "position": 68,
      "original_position": 68,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 8c537a1a26aedca65717437e1e3b2cb8a732d30a \"wallet: don't back-date locktime below input locktime\"\n\nNit: Might as well close the unclosed parenthesis in the comment.",
      "created_at": "2026-02-10T12:36:48Z",
      "updated_at": "2026-02-10T13:06:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787710443",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787710443"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 217,
      "original_start_line": 217,
      "start_side": "RIGHT",
      "line": 219,
      "original_line": 219,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787719966",
      "pull_request_review_id": 3778689371,
      "id": 2787719966,
      "node_id": "PRRC_kwDOABII586mKTse",
      "diff_hunk": "@@ -200,8 +216,9 @@ struct CreatedTransactionResult\n /**\n  * Set a height-based locktime for new transactions (uses the height of the\n  * current chain tip unless we are not synced with the current chain\n+ *\n  */\n-void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast, interfaces::Chain& chain, const uint256& block_hash, int block_height);\n+void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast, interfaces::Chain& chain, const uint256& block_hash, int block_height, unsigned int min_allowed_locktime);",
      "path": "src/wallet/spend.h",
      "position": 71,
      "original_position": 71,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 8c537a1 \"wallet: don't back-date locktime below input locktime\"\n\n```diff\n- void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast, interfaces::Chain& chain, const uint256& block_hash, int block_height, unsigned int min_allowed_locktime);\n+ void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast, interfaces::Chain& chain, const uint256& block_hash, int block_height, uint32_t min_allowed_locktime);\n```\n\nReference: https://github.com/bitcoin/bitcoin/blob/64294c89094d5ab10d87236729cc267fde0a24ca/src/primitives/transaction.h#L294",
      "created_at": "2026-02-10T12:38:53Z",
      "updated_at": "2026-02-10T13:06:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787719966",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787719966"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 221,
      "original_line": 221,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787734792",
      "pull_request_review_id": 3778689371,
      "id": 2787734792,
      "node_id": "PRRC_kwDOABII586mKXUI",
      "diff_hunk": "@@ -1310,7 +1293,20 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         use_anti_fee_sniping = false;\n     }\n     if (use_anti_fee_sniping) {\n-        DiscourageFeeSniping(txNew, rng_fast, wallet.chain(), wallet.GetLastBlockHash(), wallet.GetLastBlockHeight());\n+        // Find the highest nLockTime of all the wallet-owned input transactions so that\n+        // this transaction does not use a lower value.\n+        // Setting a lower nLockTime would make the \"signed earlier but broadcast later\"\n+        // explanation unrealistic, and may act as a wallet fingerprint.\n+        // We can only inspect the nLockTime of wallet-owned inputs.\n+        // When spending external inputs, their original nLockTime is unknown,\n+        // so the selected value may still be lower.\n+        unsigned int max_input_locktime{0};\n+        for (const auto& coin : selected_coins) {\n+            if (const CWalletTx* coin_wtx{wallet.GetWalletTx(coin->outpoint.hash)}) {\n+                max_input_locktime = std::max(max_input_locktime, coin_wtx->tx->nLockTime);\n+            }\n+        }",
      "path": "src/wallet/spend.cpp",
      "position": 183,
      "original_position": 183,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 8c537a1 \"wallet: don't back-date locktime below input locktime\"\n\nCan we loop this over `txNew.vin` similar to the implementation in `rpc/spend`? Then, we would be able to extract it out in a helper function and could avoid the code duplication.\n\nThe verbose comment is helpful but doesn't need to be duplicated imo.",
      "created_at": "2026-02-10T12:42:05Z",
      "updated_at": "2026-02-10T13:06:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787734792",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787734792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 1304,
      "original_start_line": 1304,
      "start_side": "RIGHT",
      "line": 1308,
      "original_line": 1308,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787736820",
      "pull_request_review_id": 3778689371,
      "id": 2787736820,
      "node_id": "PRRC_kwDOABII586mKXz0",
      "diff_hunk": "@@ -989,7 +983,8 @@ static bool IsCurrentForAntiFeeSniping(interfaces::Chain& chain, const uint256&\n }\n \n void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast,\n-                                 interfaces::Chain& chain, const uint256& block_hash, int block_height)\n+                                 interfaces::Chain& chain, const uint256& block_hash, int block_height,\n+                                 unsigned int min_allowed_locktime)",
      "path": "src/wallet/spend.cpp",
      "position": 109,
      "original_position": 109,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Same comment: https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787719966",
      "created_at": "2026-02-10T12:42:33Z",
      "updated_at": "2026-02-10T13:07:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787736820",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787736820"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 987,
      "original_line": 987,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787750930",
      "pull_request_review_id": 3778689371,
      "id": 2787750930,
      "node_id": "PRRC_kwDOABII586mKbQS",
      "diff_hunk": "",
      "path": "test/functional/wallet_sendmany.py",
      "position": 1,
      "original_position": 1,
      "commit_id": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "original_commit_id": "8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 8bd6857eb8dc720f8a0883d2c587021b2e8fd0e6 \"test: check sendmany respects input locktimes with anti fee sniping\"\n\nFor the commit message:\n\n> locktime, the send RPC never selects\n\nEither the last 4 test commits could be squashed into one, or the correct RPC name should be mentioned in the commit description. `send` is mentioned even for other RPCs.",
      "created_at": "2026-02-10T12:45:29Z",
      "updated_at": "2026-02-10T13:06:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787750930",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787750930"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787835349",
      "pull_request_review_id": 3778689371,
      "id": 2787835349,
      "node_id": "PRRC_kwDOABII586mKv3V",
      "diff_hunk": "@@ -50,6 +51,35 @@ def test_anti_fee_sniping(self):\n         # The nlocktime should be within 100 blocks of the block height\n         assert 101 <= tx['locktime'] <= 201\n \n+        self.log.info('Test that sendtoaddress sets the transaction locktime no lower than any input locktime')\n+        wallet_rpc = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\"anti_fee_sniping_test\")\n+        test_wallet = self.nodes[0].get_wallet_rpc(\"anti_fee_sniping_test\")\n+        # Create 100 parent transactions, all with the same\n+        # explicit backdated nLockTime. This avoids relying on the random\n+        # anti fee sniping behavior and provides several inputs to spend from.\n+        num_parents = 100\n+        tip_height = self.nodes[0].getblockcount()\n+        parent_locktime = tip_height - 80\n+        for _ in range(num_parents):\n+            wallet_rpc.send(outputs=[{test_wallet.getnewaddress(): 10}], locktime=parent_locktime)\n+        self.generate(self.nodes[0], 5)\n+        tip_height = self.nodes[0].getblockcount()\n+        # Spend parents one by one until we observe a backdated\n+        # nLockTime on a child transaction. Backdating happens randomly, so\n+        # retry until the locktime is less than the current block height.\n+        child_nlocktime = tip_height\n+        num_tries = 0\n+        while child_nlocktime == tip_height:\n+            child_txid = test_wallet.sendtoaddress(wallet_rpc.getnewaddress(), 9)\n+            child_nlocktime = test_wallet.gettransaction(txid=child_txid, verbose=True)[\"decoded\"][\"locktime\"]\n+            num_tries += 1\n+            if num_tries >= num_parents:",
      "path": "test/functional/wallet_create_tx.py",
      "position": 35,
      "original_position": 35,
      "commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "original_commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 4d8bedb \"test: check sendtoaddress respects input locktimes with anti fee sniping\"\r\n\r\nIn agreement with using multiple unspents, the previous 2 test commits didn't. However, few points:\r\n\r\n1. This doesn't test spending multiple utxos in one transaction, so we never fully test the logic that the max among them is picked up.\r\n2. In order to test the above point, the parent transactions should have different locktimes.\r\n3. I don't see why 100 unspents need to be tested and I'm unable to see the correlation between `num_tries` and `num_parents`. There's a `wait_until` helper that waits for the passed predicate to be true until a configurable timeout is reached. We want to avoid the assertion error that's one line below as much as possible. \r\nReference:\r\nhttps://github.com/bitcoin/bitcoin/blob/64294c89094d5ab10d87236729cc267fde0a24ca/test/functional/test_framework/test_framework.py#L745-L746",
      "created_at": "2026-02-10T13:01:32Z",
      "updated_at": "2026-02-10T13:08:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787835349",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787835349"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 58,
      "original_start_line": 58,
      "start_side": "RIGHT",
      "line": 77,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787855556",
      "pull_request_review_id": 3778689371,
      "id": 2787855556,
      "node_id": "PRRC_kwDOABII586mK0zE",
      "diff_hunk": "@@ -563,6 +564,31 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_fee_sniping_respects_input_locktime(self):\n+        self.log.info(\"Test that send sets the anti-fee-sniping locktime no lower than any input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        tip_height = self.nodes[0].getblockcount()\n+        # Create a parent transaction with an explicit backdated nLockTime\n+        parent_nlocktime = tip_height - 80\n+        self.nodes[0].send(outputs=[{wallet.getnewaddress(): 10}], locktime=parent_nlocktime)\n+        self.sync_mempools()\n+        # Create child transactions until we observe a backdated nLockTime.\n+        # Backdating happens randomly, so retry until the locktime is less than\n+        # the current block height.\n+        utxos = wallet.listunspent(0, 0)\n+        child_nlocktime = tip_height\n+        while child_nlocktime == tip_height:\n+            # We set add_to_wallet=False, so that the transaction won't get added to the wallet or broadcasted.\n+            # This way we can continue creating transactions spending the same input, until we find one with\n+            # a backdated nlocktime\n+            child_hex = wallet.send([{wallet.getnewaddress(): 9}], inputs=utxos, add_to_wallet=False)[\"hex\"]",
      "path": "test/functional/wallet_send.py",
      "position": 30,
      "original_position": 30,
      "commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "original_commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 4100ee8aa007141b59d990bec95064ed42e04b9a \"test: check send respects input locktimes with anti fee sniping\"\n\nFrom this PR comment https://github.com/bitcoin/bitcoin/pull/34480#issuecomment-3852562476:\n> One concern I have, which I just realized: since we cannot know the nLockTime for external inputs, we might still end up backdating below those inputsâ€™ nLockTime. This could be problematic, since it may leak some information about which inputs are wallet-owned. Is this acceptable?\n> I thought about a couple of ways to mitigate this but could not implement either. Let me know if I missed something:\n> Getting external unconfirmed inputs from the mempool. Unfortunately, I could use wallet.chain to check whether a tx is in the mempool (isInMempool), but couldn't retrieve the whole transaction\n\nIs this concern still valid? IIUC, this test successfully tests the external unconfirmed inputs. The wallet in node0 sends some funds to the wallet in node1 that are unconfirmed at the moment. ",
      "created_at": "2026-02-10T13:05:54Z",
      "updated_at": "2026-02-10T13:06:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787855556",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787855556"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 569,
      "original_start_line": 569,
      "start_side": "RIGHT",
      "line": 585,
      "original_line": 585,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787979422",
      "pull_request_review_id": 3778982205,
      "id": 2787979422,
      "node_id": "PRRC_kwDOABII586mLTCe",
      "diff_hunk": "@@ -1020,8 +1015,14 @@ void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng_fast,\n         // that transactions that are delayed after signing for whatever reason,\n         // e.g. high-latency mix networks and some CoinJoin implementations, have\n         // better privacy.\n-        if (rng_fast.randrange(10) == 0) {\n-            tx.nLockTime = std::max(0, int(tx.nLockTime) - int(rng_fast.randrange(100)));\n+        // Only pick an nLockTime further back if min_allowed_locktime is lower than the\n+        // current block height; otherwise, we already picked the earliest possible nLockTime.\n+        if (static_cast<int>(min_allowed_locktime) < block_height && rng_fast.randrange(10) == 0) {\n+            // Calculate how far back we can set nLockTime: at most 100 blocks, but constrained\n+            // by min_allowed_locktime to make sure we don't go below the minimum value\n+            int locktime_range = std::min(100, int(block_height - min_allowed_locktime));\n+            tx.nLockTime = std::max(int(min_allowed_locktime), int(tx.nLockTime) - int(rng_fast.randrange(locktime_range)));",
      "path": "src/wallet/spend.cpp",
      "position": 125,
      "original_position": 125,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 8c537a1a26aedca65717437e1e3b2cb8a732d30a \"wallet: don't back-date locktime below input locktime\"\n\nBuilding up on this previous comment for the `nLockTime` data type https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787719966: I find these intermediate `int` conversions unnecessary because the `tx.nLockTime` type is already `uint32_t`. These casts also make the code difficult to read and promotes the tendency in the reader to skip reading altogether.\n\nThe following diff removes all of them except the `block_height` one. Though it can be argued that its type can also be changed but that would be an unrelated change, so to keep the diff minimal:\n\n```diff\n-            int locktime_range = std::min(100, int(block_height - min_allowed_locktime));\n-            tx.nLockTime = std::max(int(min_allowed_locktime), int(tx.nLockTime) - int(rng_fast.randrange(locktime_range)));\n+            uint32_t locktime_range = std::min(100U, uint32_t(block_height) - min_allowed_locktime);\n+            tx.nLockTime = std::max(min_allowed_locktime, tx.nLockTime - rng_fast.randrange(locktime_range));\n```",
      "created_at": "2026-02-10T13:30:22Z",
      "updated_at": "2026-02-10T13:30:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2787979422",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787979422"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 1023,
      "original_start_line": 1023,
      "start_side": "RIGHT",
      "line": 1024,
      "original_line": 1024,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792913699",
      "pull_request_review_id": 3784392086,
      "id": 2792913699,
      "node_id": "PRRC_kwDOABII586meHsj",
      "diff_hunk": "@@ -1310,7 +1293,20 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         use_anti_fee_sniping = false;\n     }\n     if (use_anti_fee_sniping) {\n-        DiscourageFeeSniping(txNew, rng_fast, wallet.chain(), wallet.GetLastBlockHash(), wallet.GetLastBlockHeight());\n+        // Find the highest nLockTime of all the wallet-owned input transactions so that\n+        // this transaction does not use a lower value.\n+        // Setting a lower nLockTime would make the \"signed earlier but broadcast later\"\n+        // explanation unrealistic, and may act as a wallet fingerprint.\n+        // We can only inspect the nLockTime of wallet-owned inputs.\n+        // When spending external inputs, their original nLockTime is unknown,\n+        // so the selected value may still be lower.\n+        unsigned int max_input_locktime{0};\n+        for (const auto& coin : selected_coins) {\n+            if (const CWalletTx* coin_wtx{wallet.GetWalletTx(coin->outpoint.hash)}) {\n+                max_input_locktime = std::max(max_input_locktime, coin_wtx->tx->nLockTime);\n+            }\n+        }",
      "path": "src/wallet/spend.cpp",
      "position": 183,
      "original_position": 183,
      "commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "original_commit_id": "8c537a1a26aedca65717437e1e3b2cb8a732d30a",
      "in_reply_to_id": 2787734792,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This helpful function, which would be extracted, most likely could be reused for fixing the related issue for replacement transactions later: #26526.",
      "created_at": "2026-02-11T12:05:28Z",
      "updated_at": "2026-02-11T12:05:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2792913699",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792913699"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 1304,
      "original_start_line": 1304,
      "start_side": "RIGHT",
      "line": 1308,
      "original_line": 1308,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793652937",
      "pull_request_review_id": 3785218324,
      "id": 2793652937,
      "node_id": "PRRC_kwDOABII586mg8LJ",
      "diff_hunk": "@@ -50,6 +51,35 @@ def test_anti_fee_sniping(self):\n         # The nlocktime should be within 100 blocks of the block height\n         assert 101 <= tx['locktime'] <= 201\n \n+        self.log.info('Test that sendtoaddress sets the transaction locktime no lower than any input locktime')\n+        wallet_rpc = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\"anti_fee_sniping_test\")\n+        test_wallet = self.nodes[0].get_wallet_rpc(\"anti_fee_sniping_test\")\n+        # Create 100 parent transactions, all with the same\n+        # explicit backdated nLockTime. This avoids relying on the random\n+        # anti fee sniping behavior and provides several inputs to spend from.\n+        num_parents = 100\n+        tip_height = self.nodes[0].getblockcount()\n+        parent_locktime = tip_height - 80\n+        for _ in range(num_parents):\n+            wallet_rpc.send(outputs=[{test_wallet.getnewaddress(): 10}], locktime=parent_locktime)\n+        self.generate(self.nodes[0], 5)\n+        tip_height = self.nodes[0].getblockcount()\n+        # Spend parents one by one until we observe a backdated\n+        # nLockTime on a child transaction. Backdating happens randomly, so\n+        # retry until the locktime is less than the current block height.\n+        child_nlocktime = tip_height\n+        num_tries = 0\n+        while child_nlocktime == tip_height:\n+            child_txid = test_wallet.sendtoaddress(wallet_rpc.getnewaddress(), 9)\n+            child_nlocktime = test_wallet.gettransaction(txid=child_txid, verbose=True)[\"decoded\"][\"locktime\"]\n+            num_tries += 1\n+            if num_tries >= num_parents:",
      "path": "test/functional/wallet_create_tx.py",
      "position": 35,
      "original_position": 35,
      "commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "original_commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "in_reply_to_id": 2787835349,
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> In agreement with using multiple unspents, the previous 2 test commits didn't.\r\n\r\nYes, sorry if it wasn't clear in the commit message.\r\nWhat I'm doing here is:\r\n- creating 100 parent transactions\r\n- creating children transactions over and over again, each one of them spending exactly one parent (child_tx `i` spends parent_tx `i`), until I find one child transaction that has a backdated nlocktime. At that point, I check that the nlocktime is >= the one of the parent.\r\n\r\nThe reason why only the `sendtoaddress` and `sendmany` tests do this is because with `send`/`sendall` I can set `add_to_wallet=False`, not adding the tx to the wallet or broadcasting it, and so I can keep re-using the same parent transaction. (See https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2771675158)\r\n\r\nI can absolutely modify the test to have multiple parents, and update the variable names/comments to make everything clearer!\r\n\r\n>  There's a wait_until helper that waits for the passed predicate to be true until a configurable timeout is reached.\r\n\r\nAh, thanks! I'll try refactoring the test in order to use `wait_until` :)\r\n",
      "created_at": "2026-02-11T14:37:06Z",
      "updated_at": "2026-02-11T14:37:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2793652937",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793652937"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 58,
      "original_start_line": 58,
      "start_side": "RIGHT",
      "line": 77,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2795229445",
      "pull_request_review_id": 3787086188,
      "id": 2795229445,
      "node_id": "PRRC_kwDOABII586mm9EF",
      "diff_hunk": "@@ -563,6 +564,31 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_fee_sniping_respects_input_locktime(self):\n+        self.log.info(\"Test that send sets the anti-fee-sniping locktime no lower than any input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        tip_height = self.nodes[0].getblockcount()\n+        # Create a parent transaction with an explicit backdated nLockTime\n+        parent_nlocktime = tip_height - 80\n+        self.nodes[0].send(outputs=[{wallet.getnewaddress(): 10}], locktime=parent_nlocktime)\n+        self.sync_mempools()\n+        # Create child transactions until we observe a backdated nLockTime.\n+        # Backdating happens randomly, so retry until the locktime is less than\n+        # the current block height.\n+        utxos = wallet.listunspent(0, 0)\n+        child_nlocktime = tip_height\n+        while child_nlocktime == tip_height:\n+            # We set add_to_wallet=False, so that the transaction won't get added to the wallet or broadcasted.\n+            # This way we can continue creating transactions spending the same input, until we find one with\n+            # a backdated nlocktime\n+            child_hex = wallet.send([{wallet.getnewaddress(): 9}], inputs=utxos, add_to_wallet=False)[\"hex\"]",
      "path": "test/functional/wallet_send.py",
      "position": 30,
      "original_position": 30,
      "commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "original_commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "in_reply_to_id": 2787855556,
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think I misused the word \"external\", I meant \"inputs that are not owned by the wallet\". In this test case, node1 receives the funds and spends them, so the input is owned by the wallet.\n\nBefore calling `DiscourageFeeSniping`, I'm finding the highest input nlocktime using `GetWalletTx`, but this means that if the transaction input is not owned by the wallet, I won't be able to see the nlocktime.\n\nI think I can hit this edge case in a couple of ways... For example, using `send` + `add_to_wallet=False` + `inputs`:\n\n```\nâ¯ ./build/bin/bitcoin-cli -datadir=signet-datadir -named send outputs='[{\"tb1p4tp4l6glyr2gs94neqcpr5gha7344nfyznfkc8szkreflscsdkgqsdent4\": 0.00001}]' add_to_wallet=false fee_rate=1 inputs='[{\"txid\": \"fb20af6c84b3fc1baff2f915140d0445b3479549093de35bdbe9e7d7d1008333\", \"vout\": 0}]'\n{\n  \"psbt\": \"cHNidP8BAIkCAAAAATODANHX5+nbW+M9CUmVR7NFBA0UFfnyrxv8s4RsryD7AAAAAAD9////Am5QPJMYAAAAIlEgR/Kst32gSmc8pi48WvNByPA4RzliEXhWybc25kgAUpnoAwAAAAAAACJRIKrDX+kfINSIFrPIMBHRF++jWs0kFNNsHgKw8p/DEG2Q0XAEAAAAAQUgtEB0iqlfBOJ0PlRRM3ubBOQxa5Kq4XSqozDCQ/cjgDUhB7RAdIqpXwTidD5UUTN7mwTkMWuSquF0qqMwwkP3I4A1GQAIf5iUVgAAgAEAAIAAAACAAQAAAH0AAAAAAA==\",\n  \"complete\": false\n}\n        \n```\nI picked these addresses and txid from a block explorer, and they are not in my wallet. The resulting psbt was signed at block height 291092, but the nlocktime was backdated to 291025. If I understand correctly the core wallet would have had no way of knowing whether it was backlocking before the input tx nlocktime, because it didn't know the input tx.\n\n\n",
      "created_at": "2026-02-11T20:00:25Z",
      "updated_at": "2026-02-11T20:00:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2795229445",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2795229445"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 569,
      "original_start_line": 569,
      "start_side": "RIGHT",
      "line": 585,
      "original_line": 585,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2797991957",
      "pull_request_review_id": 3790024615,
      "id": 2797991957,
      "node_id": "PRRC_kwDOABII586mxfgV",
      "diff_hunk": "@@ -563,6 +564,31 @@ def test_weight_limits(self):\n \n         self.nodes[1].unloadwallet(\"test_weight_limits\")\n \n+    def test_fee_sniping_respects_input_locktime(self):\n+        self.log.info(\"Test that send sets the anti-fee-sniping locktime no lower than any input locktime\")\n+        self.nodes[1].createwallet(\"test_fee_sniping\")\n+        wallet = self.nodes[1].get_wallet_rpc(\"test_fee_sniping\")\n+        tip_height = self.nodes[0].getblockcount()\n+        # Create a parent transaction with an explicit backdated nLockTime\n+        parent_nlocktime = tip_height - 80\n+        self.nodes[0].send(outputs=[{wallet.getnewaddress(): 10}], locktime=parent_nlocktime)\n+        self.sync_mempools()\n+        # Create child transactions until we observe a backdated nLockTime.\n+        # Backdating happens randomly, so retry until the locktime is less than\n+        # the current block height.\n+        utxos = wallet.listunspent(0, 0)\n+        child_nlocktime = tip_height\n+        while child_nlocktime == tip_height:\n+            # We set add_to_wallet=False, so that the transaction won't get added to the wallet or broadcasted.\n+            # This way we can continue creating transactions spending the same input, until we find one with\n+            # a backdated nlocktime\n+            child_hex = wallet.send([{wallet.getnewaddress(): 9}], inputs=utxos, add_to_wallet=False)[\"hex\"]",
      "path": "test/functional/wallet_send.py",
      "position": 30,
      "original_position": 30,
      "commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "original_commit_id": "4100ee8aa007141b59d990bec95064ed42e04b9a",
      "in_reply_to_id": 2787855556,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I meant \"inputs that are not owned by the wallet\".\r\n\r\nWhen I read this statement, the first things that pops up in my mind is that wallet can't spend the inputs that it doesn't own, which seems fine.\r\n\r\n> For example, using send + add_to_wallet=False + inputs\r\n> I picked these addresses and txid from a block explorer, and they are not in my wallet. \r\n\r\nI think I now get what you mean. However, this seems like quite a contrived example, can you explain how this can happen in a real world scenario - as in what would motivate the user go about using this approach?\r\n\r\n```cpp\r\n{\"add_to_wallet\", RPCArg::Type::BOOL, RPCArg::Default{true}, \"When false, returns the serialized transaction without broadcasting or adding it to the wallet\"},\r\n```\r\n\r\nIf `add_to_wallet` is used, then the user is responsible for storing the serialized transaction because there is no other way for the wallet to get it. If the user intends to create a child transaction of such a transaction, then the full transaction hex must be provided by the user, an option that I could not find in these RPCs. All I can see are the following arguments for `inputs` in these RPCs that allude to the assumption that the wallet can find the hex of the transaction pointed to by `txid` - something that doesn't hold true for the above example.\r\n\r\n```cpp\r\n{\"inputs\", RPCArg::Type::ARR, RPCArg::Default{UniValue::VARR}, \"Specify inputs instead of adding them automatically.\",\r\n                        {\r\n                          {\"\", RPCArg::Type::OBJ, RPCArg::Optional::OMITTED, \"\", {\r\n                            {\"txid\", RPCArg::Type::STR_HEX, RPCArg::Optional::NO, \"The transaction id\"},\r\n                            {\"vout\", RPCArg::Type::NUM, RPCArg::Optional::NO, \"The output number\"},\r\n                            {\"sequence\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"depends on the value of the 'replaceable' and 'locktime' arguments\"}, \"The sequence number\"},\r\n                            {\"weight\", RPCArg::Type::NUM, RPCArg::DefaultHint{\"Calculated from wallet and solving data\"}, \"The maximum weight for this input, \"\r\n                                        \"including the weight of the outpoint and sequence number. \"\r\n                                        \"Note that signature sizes are not guaranteed to be consistent, \"\r\n                                        \"so the maximum DER signatures size of 73 bytes should be used when considering ECDSA signatures.\"\r\n                                        \"Remember to convert serialized sizes to weight units when necessary.\"},\r\n                          }},\r\n                        },\r\n                    },\r\n```",
      "created_at": "2026-02-12T10:19:08Z",
      "updated_at": "2026-02-12T10:19:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2797991957",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2797991957"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 569,
      "original_start_line": 569,
      "start_side": "RIGHT",
      "line": 585,
      "original_line": 585,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2798189911",
      "pull_request_review_id": 3790230485,
      "id": 2798189911,
      "node_id": "PRRC_kwDOABII586myP1X",
      "diff_hunk": "@@ -50,6 +51,35 @@ def test_anti_fee_sniping(self):\n         # The nlocktime should be within 100 blocks of the block height\n         assert 101 <= tx['locktime'] <= 201\n \n+        self.log.info('Test that sendtoaddress sets the transaction locktime no lower than any input locktime')\n+        wallet_rpc = self.nodes[0].get_wallet_rpc(self.default_wallet_name)\n+        self.nodes[0].createwallet(\"anti_fee_sniping_test\")\n+        test_wallet = self.nodes[0].get_wallet_rpc(\"anti_fee_sniping_test\")\n+        # Create 100 parent transactions, all with the same\n+        # explicit backdated nLockTime. This avoids relying on the random\n+        # anti fee sniping behavior and provides several inputs to spend from.\n+        num_parents = 100\n+        tip_height = self.nodes[0].getblockcount()\n+        parent_locktime = tip_height - 80\n+        for _ in range(num_parents):\n+            wallet_rpc.send(outputs=[{test_wallet.getnewaddress(): 10}], locktime=parent_locktime)\n+        self.generate(self.nodes[0], 5)\n+        tip_height = self.nodes[0].getblockcount()\n+        # Spend parents one by one until we observe a backdated\n+        # nLockTime on a child transaction. Backdating happens randomly, so\n+        # retry until the locktime is less than the current block height.\n+        child_nlocktime = tip_height\n+        num_tries = 0\n+        while child_nlocktime == tip_height:\n+            child_txid = test_wallet.sendtoaddress(wallet_rpc.getnewaddress(), 9)\n+            child_nlocktime = test_wallet.gettransaction(txid=child_txid, verbose=True)[\"decoded\"][\"locktime\"]\n+            num_tries += 1\n+            if num_tries >= num_parents:",
      "path": "test/functional/wallet_create_tx.py",
      "position": 35,
      "original_position": 35,
      "commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "original_commit_id": "4d8bedb2dec61e8e250b4e5f40621d9729851c4a",
      "in_reply_to_id": 2787835349,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> The reason why only the sendtoaddress and sendmany tests do this is because with send/sendall I can set add_to_wallet=False, not adding the tx to the wallet or broadcasting it, and so I can keep re-using the same parent transaction. \r\n\r\nI see, `add_to_wallet` does seem quite handy but unfortunate that it's not available to `sendtoaddress/sendmany`. I guess the current idea seems alright but would suggest the following:\r\n1. The transactions should spend 2 inputs with different nlocktimes instead of one.\r\n2. If somehow in all these tries, the backdated nlocktime is not generated, we should not raise the below assertion error - it would make the test flaky and might fail CI of unrelated PRs later. I don't believe the `wait_until` approach would be foolproof as well. The only complete solution I see is to fund the wallet with more inputs and keep retrying until the backdate nlocktime is generated. \r\n```python\r\nif num_tries >= num_parents:\r\n   raise AssertionError(\"RPC call sendtoaddress() did not produce a backdated nLockTime\")\r\n```",
      "created_at": "2026-02-12T10:57:53Z",
      "updated_at": "2026-02-12T10:57:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34480#discussion_r2798189911",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2798189911"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34480"
        }
      },
      "start_line": 58,
      "original_start_line": 58,
      "start_side": "RIGHT",
      "line": 77,
      "original_line": 77,
      "side": "RIGHT"
    }
  ]
}
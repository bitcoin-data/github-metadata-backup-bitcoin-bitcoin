{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577",
    "id": 3277895355,
    "node_id": "PR_kwDOABII587DYLa7",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34577",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34577.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34577.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/881568b39b686f0a418e02972c28c050c76de059",
    "number": 34577,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "http: fix submission during shutdown race",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Fixes #34573.\r\n\r\nAs mentioned in https://github.com/bitcoin/bitcoin/issues/34573#issuecomment-3891596958, the ThreadPool PR (#33689) revealed an existing issue.\r\n\r\nBefore that PR, we were returning an incorrect error \"Request rejected because http work queue depth exceeded\" during shutdown for unhandled requests (we were not differentiating between \"queue depth exceeded\" and \"server interrupted\" errors). Now, with the ThreadPool inclusion, we return the proper error but we don't handle it properly.\r\n\r\nThis PR improves exactly that. Handling the missing error and properly returning it to the user.\r\n\r\nThe race can be reproduced as follows:\r\n\r\n1) The server receives an http request.\r\n2) Processing of the request is delayed, and shutdown is triggered in the meantime.\r\n3) During shutdown, the libevent callback is unregistered and the threadpool interrupted.\r\n4) The delayed request (step 2) resumes and tries to submit a task to the now-interrupted server.\r\n\r\nReproduction test can be found https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3902672521.\r\n\r\nAlso, to prevent this kind of issue from happening again, this PR changes task submission\r\nto return the error as part of the function's return value using `util::Expected` instead of\r\nthrowing the exception. Unlike exceptions, which require extra try-catch blocks and can be\r\nignored, returning `Expected` forces callers to explicitly handle failures, and attributes\r\nlike `[[nodiscard]]` allow us catch unhandled ones at compile time.\r\n\r\n",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/74",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74/labels",
      "id": 12610874,
      "node_id": "MI_kwDOABII584AwG06",
      "number": 74,
      "state": "open",
      "title": "31.0",
      "creator": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "open_issues": 24,
      "closed_issues": 43,
      "created_at": "2025-03-25T18:44:16Z",
      "updated_at": "2026-02-13T11:17:34Z"
    },
    "created_at": "2026-02-12T19:52:35Z",
    "updated_at": "2026-02-17T02:52:40Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "39fcc18707be69d25a989472473f95659d6e416f",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2026_http_submission_error",
      "ref": "2026_http_submission_error",
      "sha": "881568b39b686f0a418e02972c28c050c76de059",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 447789,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-17T01:57:58Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2026-02-07T21:37:50Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "35e6444fdc4068adc79082648f9889ad593e623b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38908,
        "stargazers_count": 88147,
        "watchers_count": 88147,
        "size": 303672,
        "default_branch": "master",
        "open_issues_count": 736,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-16T13:43:11Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-17T02:11:31Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 78,
    "deletions": 41,
    "changed_files": 4,
    "commits": 3,
    "review_comments": 38,
    "comments": 8
  },
  "events": [
    {
      "event": "labeled",
      "id": 22746199637,
      "node_id": "LE_lADOABII587qd6NDzwAAAAVLx3ZV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746199637",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T19:52:39Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "commented",
      "id": 3893067383,
      "node_id": "IC_kwDOABII587oC353",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893067383",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T19:52:59Z",
      "updated_at": "2026-02-17T00:53:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3793381996), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3809321408) |\n| Stale ACK | [andrewtoth](https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3805060506) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34562](https://github.com/bitcoin/bitcoin/pull/34562) (ThreadPool follow-ups, proactive shutdown and HasReason dependency cleanup by furszy)\n* [#32061](https://github.com/bitcoin/bitcoin/pull/32061) (Replace libevent with our own HTTP and socket-handling implementation by pinheadmz)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893067383",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22746449751,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVLy0dX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746449751",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/5326821cbffbef388421af082d43c7bc6bcc48f7",
      "created_at": "2026-02-12T20:02:29Z"
    },
    {
      "event": "labeled",
      "id": 22746465878,
      "node_id": "LE_lADOABII587qd6NDzwAAAAVLy4ZW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746465878",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:03:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3893112838,
      "node_id": "IC_kwDOABII587oDDAG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893112838",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:03:19Z",
      "updated_at": "2026-02-12T20:03:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `No wallet`: https://github.com/bitcoin/bitcoin/actions/runs/21961944156/job/63441463470</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed in fuzz/threadpool.cpp: Submit returns util::Expected<future<void>, string> which cannot be assigned to std::future<void>, causing build errors.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893112838",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "commented",
      "id": 3893242863,
      "node_id": "IC_kwDOABII587oDivv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893242863",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:31:52Z",
      "updated_at": "2026-02-12T20:31:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "> The race can be reproduced as follows:\r\n\r\nCan this be made into a functional regression test?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893242863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "commented",
      "id": 3893331956,
      "node_id": "IC_kwDOABII587oD4f0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893331956",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:53:36Z",
      "updated_at": "2026-02-12T21:13:39Z",
      "author_association": "MEMBER",
      "body": "> Can this be made into a functional regression test?\r\n\r\nThe \"processing request is delayed\" step means manually placing a `sleep()` inside the libevent callback `http_request_cb()` to progress on the server shutdown concurrently. Then we need to `sleep()` during shutdown, just after `InterruptHTTPServer()`, to resume the request processing before shutdown occurs.\r\nSo, the short answer is no. Sadly races aren't easy to replicate deterministically in functional tests.\r\nWe will surely be able to exercise more scenarios like this one, in unit tests, after the new http server inclusion (libevent removal path), which will bring better encapsulation.\r\n\r\nThat being said, could provide a `sleep()`-based patch to replicate it locally.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893331956",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "reviewed",
      "id": 3793381996,
      "node_id": "PRR_kwDOABII587iGmps",
      "url": null,
      "actor": null,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-12T21:01:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 5326821cbffbef388421af082d43c7bc6bcc48f7",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3793381996",
      "submitted_at": "2026-02-12T21:01:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "unlabeled",
      "id": 22748279893,
      "node_id": "UNLE_lADOABII587qd6NDzwAAAAVL5zRV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22748279893",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T21:16:37Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22750337843,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVMBpsz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22750337843",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "created_at": "2026-02-12T22:56:51Z"
    },
    {
      "event": "commented",
      "id": 3893890603,
      "node_id": "IC_kwDOABII587oGA4r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893890603",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T23:06:59Z",
      "updated_at": "2026-02-12T23:06:59Z",
      "author_association": "MEMBER",
      "body": "Updated per feedback, thanks @hodlinator!",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893890603",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "mentioned",
      "id": 22750534572,
      "node_id": "MEE_lADOABII587qd6NDzwAAAAVMCZus",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22750534572",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T23:07:00Z"
    },
    {
      "event": "subscribed",
      "id": 22750534594,
      "node_id": "SE_lADOABII587qd6NDzwAAAAVMCZvC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22750534594",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T23:07:00Z"
    },
    {
      "event": "milestoned",
      "id": 22759466804,
      "node_id": "MIE_lADOABII587qd6NDzwAAAAVMkec0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22759466804",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T08:34:24Z",
      "milestone": {
        "title": "31.0"
      }
    },
    {
      "event": "reviewed",
      "id": 3797580441,
      "node_id": "PRR_kwDOABII587iWnqZ",
      "url": null,
      "actor": null,
      "commit_id": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-13T14:25:55Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3797580441",
      "submitted_at": "2026-02-13T14:25:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22770059722,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVNM4nK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22770059722",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "created_at": "2026-02-13T15:38:00Z"
    },
    {
      "event": "reviewed",
      "id": 3799391187,
      "node_id": "PRR_kwDOABII587idhvT",
      "url": null,
      "actor": null,
      "commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-13T20:55:52Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3799391187",
      "submitted_at": "2026-02-13T20:55:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "commented",
      "id": 3899427784,
      "node_id": "IC_kwDOABII587obIvI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3899427784",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T20:59:27Z",
      "updated_at": "2026-02-13T20:59:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for incorporating my earlier feedback btw!",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3899427784",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22778869985,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVNufjh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22778869985",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "542879da7b66e890d2c1bf668ab5680e939541f8",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/542879da7b66e890d2c1bf668ab5680e939541f8",
      "created_at": "2026-02-13T21:29:34Z"
    },
    {
      "event": "commented",
      "id": 3902672521,
      "node_id": "IC_kwDOABII587ong6J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902672521",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T22:26:10Z",
      "updated_at": "2026-02-14T22:26:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "> That being said, could provide a sleep()-based patch to replicate it locally.\r\n\r\nHere is a diff, along with a functional test `rpc_http_shutdown_race.py`. Applying this to the base commit 07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b will fail with a remote disconnected error, and applying to this patch 542879da7b66e890d2c1bf668ab5680e939541f8 will pass. \r\n\r\n```diff\r\ndiff --git a/src/httpserver.cpp b/src/httpserver.cpp\r\nindex 671e119642..d2de754183 100644\r\n--- a/src/httpserver.cpp\r\n+++ b/src/httpserver.cpp\r\n@@ -18,6 +18,7 @@\r\n #include <util/strencodings.h>\r\n #include <util/threadnames.h>\r\n #include <util/threadpool.h>\r\n+#include <util/time.h>\r\n #include <util/translation.h>\r\n \r\n #include <condition_variable>\r\n@@ -257,6 +258,7 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\r\n             hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Work queue depth exceeded\");\r\n             return;\r\n         }\r\n+        UninterruptibleSleep(2s);\r\n \r\n         auto item = [req = std::move(hreq), in_path = std::move(path), fn = i->handler]() {\r\n             std::string err_msg;\r\n@@ -446,6 +448,7 @@ void InterruptHTTPServer()\r\n     }\r\n     // Interrupt pool after disabling requests\r\n     g_threadpool_http.Interrupt();\r\n+    UninterruptibleSleep(2s);\r\n }\r\n \r\n void StopHTTPServer()\r\ndiff --git a/test/functional/rpc_http_shutdown_race.py b/test/functional/rpc_http_shutdown_race.py\r\nnew file mode 100755\r\nindex 0000000000..f91cdee9f3\r\n--- /dev/null\r\n+++ b/test/functional/rpc_http_shutdown_race.py\r\n@@ -0,0 +1,42 @@\r\n+#!/usr/bin/env python3\r\n+# Copyright (c) The Bitcoin Core developers\r\n+# Distributed under the MIT software license, see the accompanying\r\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n+\"\"\"Test that an in-flight RPC during shutdown receives 503.\"\"\"\r\n+\r\n+from test_framework.test_framework import BitcoinTestFramework\r\n+from test_framework.util import assert_equal, str_to_b64str\r\n+\r\n+import http.client\r\n+import urllib.parse\r\n+\r\n+class RpcHttpShutdownRaceTest(BitcoinTestFramework):\r\n+    def set_test_params(self):\r\n+        self.num_nodes = 1\r\n+        self.setup_clean_chain = True\r\n+\r\n+    def run_test(self):\r\n+        url = urllib.parse.urlparse(self.nodes[0].url)\r\n+        authpair = f\"{url.username}:{url.password}\"\r\n+        headers = {\"Authorization\": f\"Basic {str_to_b64str(authpair)}\"}\r\n+\r\n+        conn = http.client.HTTPConnection(url.hostname, url.port, timeout=10)\r\n+        conn.connect()\r\n+        conn.request(\"POST\", \"/\", '{\"method\":\"getblockchaininfo\",\"id\":1}', headers)\r\n+\r\n+        # Trigger shutdown outside RPC callback path so the in-flight request\r\n+        # is interrupted before submitting to the pool.\r\n+        self.nodes[0].process.terminate()\r\n+\r\n+        resp = conn.getresponse()\r\n+        body = resp.read()\r\n+        assert_equal(resp.status, http.client.SERVICE_UNAVAILABLE)\r\n+        assert b\"Request rejected during server shutdown\" in body\r\n+        node = self.nodes[0]\r\n+        self.wait_until(lambda: node.process.poll() is not None, timeout=20)\r\n+        stderr = node.stderr.read().decode(\"utf-8\", errors=\"replace\").strip()\r\n+        node.is_node_stopped(expected_stderr=stderr, expected_ret_code=node.process.returncode)\r\n+\r\n+\r\n+if __name__ == '__main__':\r\n+    RpcHttpShutdownRaceTest(__file__).main()\r\ndiff --git a/test/functional/test_runner.py b/test/functional/test_runner.py\r\nindex cdfa8c1022..0d21907677 100755\r\n--- a/test/functional/test_runner.py\r\n+++ b/test/functional/test_runner.py\r\n@@ -201,6 +201,7 @@ BASE_SCRIPTS = [\r\n     'wallet_reindex.py',\r\n     'wallet_reorgsrestore.py',\r\n     'interface_http.py',\r\n+    'rpc_http_shutdown_race.py',\r\n     'interface_rpc.py',\r\n     'interface_usdt_coinselection.py',\r\n     'interface_usdt_mempool.py',\r\n```",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3902672521",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "reviewed",
      "id": 3805060506,
      "node_id": "PRR_kwDOABII587izJ2a",
      "url": null,
      "actor": null,
      "commit_id": "542879da7b66e890d2c1bf668ab5680e939541f8",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-15T15:11:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 542879da7b66e890d2c1bf668ab5680e939541f8\n\nThis fixes the unclean shutdown race condition. It's too bad we can't have a regression test without adding sleeps.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3805060506",
      "submitted_at": "2026-02-15T15:11:24Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "review_requested",
      "id": 22805721212,
      "node_id": "RRE_lADOABII587qd6NDzwAAAAVPU7B8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22805721212",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T15:11:28Z",
      "requested_reviewer": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3904770678,
      "node_id": "IC_kwDOABII587ovhJ2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3904770678",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T16:29:52Z",
      "updated_at": "2026-02-15T16:29:52Z",
      "author_association": "MEMBER",
      "body": "Thanks for the reproduction patch @andrewtoth! Added link to the PR description.\r\n\r\n> This fixes the unclean shutdown race condition. It's too bad we can't have a regression test without adding sleeps.\r\n\r\nA small reflection about this.\r\n\r\nWe can't expect to be able to cover everything in functional tests. Simply because they live on a higher level and have no access to internals to exercise race conditions.\r\n\r\nThese types of scenarios belong to the unit tests land. But for that to happen, the surrounding code has to be properly encapsulated. Which is not the case for the http server, as there is currently no class for it, we basically import an entire file with global variables and static functions (and up to a few days ago, we had no tests for the work queue at all and this race condition was already there, just hidden returning an incorrect error message instead).\r\n\r\nThe only way to replicate scenarios like this one atm, on a unit test, would be to manually copy paste startup and shutdown. Which is not really scalable nor maintainable.\r\n\r\nStill, we will get better soon, the libevent removal path @pinheadmz is working on also brings better encapsulation that we can use to deeply cover the area.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3904770678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "mentioned",
      "id": 22806457089,
      "node_id": "MEE_lADOABII587qd6NDzwAAAAVPXusB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22806457089",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T16:29:53Z"
    },
    {
      "event": "subscribed",
      "id": 22806457095,
      "node_id": "SE_lADOABII587qd6NDzwAAAAVPXusH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22806457095",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T16:29:53Z"
    },
    {
      "event": "mentioned",
      "id": 22806457108,
      "node_id": "MEE_lADOABII587qd6NDzwAAAAVPXusU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22806457108",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T16:29:53Z"
    },
    {
      "event": "subscribed",
      "id": 22806457115,
      "node_id": "SE_lADOABII587qd6NDzwAAAAVPXusb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22806457115",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T16:29:53Z"
    },
    {
      "event": "reviewed",
      "id": 3809321408,
      "node_id": "PRR_kwDOABII587jDaHA",
      "url": null,
      "actor": null,
      "commit_id": "542879da7b66e890d2c1bf668ab5680e939541f8",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-16T15:58:06Z",
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\n@furszy, it would be nice if you share a branch with a reproducer. \r\n\r\nedit: see https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3902672521 for reproducer",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3809321408",
      "submitted_at": "2026-02-16T15:44:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI1NzZhMjRmMzZhNTY3OGI4YzhmNDA5NDIyMWNhNWQ4NmE3OTUxZTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b576a24f36a5678b8c8f4094221ca5d86a7951e9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b576a24f36a5678b8c8f4094221ca5d86a7951e9",
      "tree": {
        "sha": "73df5a5ec66e993f0f9ad3b65962212b44bee47e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/73df5a5ec66e993f0f9ad3b65962212b44bee47e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 73df5a5ec66e993f0f9ad3b65962212b44bee47e\nparent 07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b\nauthor furszy <matiasfurszyfer@protonmail.com> 1770923302 -0500\ncommitter furszy <matiasfurszyfer@protonmail.com> 1771282578 -0500\n\nthreadpool: make Submit return Expected instead of throwing\n\nUnlike exceptions, which can be ignored as they require extra try-catch\nblocks, returning expected errors forces callers to always handle\nsubmission failures.\n\nNot throwing an exception also fixes an unclean shutdown bug\n#34573 since we no longer throw when attempting to Submit()\nfrom the libevent callback http_request_cb().\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmmToJIACgkQXdI8zGhq\npiPiFQ//cVstap2RfH4rkioMoxDTissmyv9FlZjnSNAEgCZLofPgzWcpQFBN7VZW\nJRvjMjb50U5N/6QKfPWzk9zLZQZ6jFAI2fTnFVpm20eeCqpaZ5LVxL2E2Z37rGKg\npLHIT8QE+iJhTh5TrbDtv2yuAX7BqZz3QZYWqdO+ZMLFn4tOzoxlHrJC1phdzJte\nAsrKpVF+d+sYb90eXffry6cHDHOeaIgNrom28KzjizjPawDF70bSfGQbwmhP93FJ\nhtOcKYB8AmGlZA2TO0MjEyPTT4z8Y0F1hUaXEBzmvyDoqHmIbJI176HCCBPPJTdT\nL+QhRlXoEXlCQ4n4RrcKJS0YbXiJtR5IbbJsKJrxl4yEhCKIHh0xvYqSGnobmqvX\nKUjUyNr0Qv/kc9zv26HaLjiuXZyCIewqu/V+G+bQzbTyTgmqakUVH6D03nKY14YB\nz2sS8G5ya+x0ZGhg053Kmlp8UfftLwREPUGF4fXxUjs/ocXSQRibrftJnWDek0O5\nMmkaZ4fiicK/JZCU20UCLy0J1vz8cItZkxIsCohvaMNSclv66HzUgIt3/whPHreY\nXyhMfmM5pk2Ms6L764nh8plf/obHSLfSdsZ3jq/+t1F/rMHGiRpDTsoTgCr1dDUW\nVvOn/xSJLHngoRmc/HHYHgeppcyYyiChOeo+WsbTB4NwML8VTdk=\n=Ah7l\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b",
          "sha": "07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b"
        }
      ],
      "message": "threadpool: make Submit return Expected instead of throwing\n\nUnlike exceptions, which can be ignored as they require extra try-catch\nblocks, returning expected errors forces callers to always handle\nsubmission failures.\n\nNot throwing an exception also fixes an unclean shutdown bug\n#34573 since we no longer throw when attempting to Submit()\nfrom the libevent callback http_request_cb().",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-16T22:56:18Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T19:08:22Z"
      },
      "sha": "b576a24f36a5678b8c8f4094221ca5d86a7951e9"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22838946089,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVRTqkp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22838946089",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c6a02a1a7c4440ae06a26e85623f5563f59b90c2",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/c6a02a1a7c4440ae06a26e85623f5563f59b90c2",
      "created_at": "2026-02-17T00:53:20Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdmZGM0ODE1OTliOWViMzQyMDBmMWQ0NTA0ODgzYWY0OTM3MjVmMjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7fdc481599b9eb34200f1d4504883af493725f20",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7fdc481599b9eb34200f1d4504883af493725f20",
      "tree": {
        "sha": "02697427e36debe3f541fe831927876f0dcfe0a0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/02697427e36debe3f541fe831927876f0dcfe0a0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 02697427e36debe3f541fe831927876f0dcfe0a0\nparent b576a24f36a5678b8c8f4094221ca5d86a7951e9\nauthor furszy <matiasfurszyfer@protonmail.com> 1770923302 -0500\ncommitter furszy <matiasfurszyfer@protonmail.com> 1771293427 -0500\n\nhttp: properly respond to HTTP request during shutdown\n\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\nthe thread pool during server shutdown.\n\nRoughly what happens:\n\n1) The server receives an HTTP request and starts calling http_request_cb().\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\n   and unregisters libevent http_request_cb() callback and interrupts the thread pool.\n3) The request (step 1) resumes and tries to submit a task to the now-interrupted server.\n\nThis fix detects failed submissions immediately, and the server responds with\nHTTP_SERVICE_UNAVAILABLE.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmmTyvQACgkQXdI8zGhq\npiPWPA/9EePmgL/GJri04M9WWCKnzZuDXC044QaV+MMewwU53lVgzOk28N/Jp+Ic\nso2sW8A04n73pkXgPUp6C4sOgVdvualEvPdZNjNPwl7xLwhTZkaSJ5TNpBkfIT2b\nTmibIuIzMyIjfDSLZrt+yxwbXWlvU/+IY6205dRg0DiW1uJegdSxYmH0wVI6YURt\nh098GPUx2243kcDdn4iY7cWYLWQvrweYck85PZ+hYeQwPMOpQpN/TNrCQWq2B6I6\nlANis4ABENw2PjG8gO7OK94Vw+pLG546uk0cMjgsysufR56fN1VDvM+Kr3OjApXh\nq1KsM+dheNzwMs3q5iFk5G0VDbHWO6xNy7EpFi7MquQi9bSiUWB/VvTcl1Fap7IB\nYUc67xerQ3BTLiOxj1T2ELb5CrlalqJqTm3T3auwOKhKT2Gqts11dI3Dwp56HmeO\n0APq8jKtMq8T1pYffrwuzgYj1lnA4FhdjSox1dDUvsiusplm5t/6MVlB+bI/TBdC\n2vYJ+2GzeRhQSL3BbuEZSqhn1jCZurSEH6lKHKAVndn4svrnI2x9C/gPCM/NoItg\nT5GTSa3Sb62nGpf3qS5v/FtcfnZux6ERFg0MHVsLp+f5rPmvYGRIN3zAbilBfs3S\nAZF6EodpVMkS/4MWcS+rvbKFr2WHMwe3lq32W73tqXCSDdJGfSo=\n=APDA\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b576a24f36a5678b8c8f4094221ca5d86a7951e9",
          "sha": "b576a24f36a5678b8c8f4094221ca5d86a7951e9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b576a24f36a5678b8c8f4094221ca5d86a7951e9"
        }
      ],
      "message": "http: properly respond to HTTP request during shutdown\n\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\nthe thread pool during server shutdown.\n\nRoughly what happens:\n\n1) The server receives an HTTP request and starts calling http_request_cb().\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\n   and unregisters libevent http_request_cb() callback and interrupts the thread pool.\n3) The request (step 1) resumes and tries to submit a task to the now-interrupted server.\n\nThis fix detects failed submissions immediately, and the server responds with\nHTTP_SERVICE_UNAVAILABLE.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-17T01:57:07Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T19:08:22Z"
      },
      "sha": "7fdc481599b9eb34200f1d4504883af493725f20"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg4MTU2OGIzOWI2ODZmMGE0MThlMDI5NzJjMjhjMDUwYzc2ZGUwNTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/881568b39b686f0a418e02972c28c050c76de059",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/881568b39b686f0a418e02972c28c050c76de059",
      "tree": {
        "sha": "a944b7d55db81865e502796508d98c9b1ca0d063",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a944b7d55db81865e502796508d98c9b1ca0d063"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a944b7d55db81865e502796508d98c9b1ca0d063\nparent 7fdc481599b9eb34200f1d4504883af493725f20\nauthor furszy <matiasfurszyfer@protonmail.com> 1771286167 -0500\ncommitter furszy <matiasfurszyfer@protonmail.com> 1771293428 -0500\n\nthreadpool: Treat double-Start as logic error\n\nCalling Start() on an already-running pool is a programming error, not\na recoverable runtime condition.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmmTyvQACgkQXdI8zGhq\npiNm8w/8D0/cpfnMG97VYrQi8lvQ0q3btbIzudcY+Gp9840ZvlIy8wilJp4NlkvN\nBAbsOeEL3mh4O00OSUMPYVo0HXoVr05pGiOg+k/ZYrzF88NdHefjL8M+8C6ESe2j\nDxxYZnh0WYu1sZCVYYkMtH8o2y6jdriYTDgeNH287MHqd0lL3cA12rIfVotEN1cS\na3IP71Zmih52oQ+2SC+UXPHYl79HwnalcJCdgEcP3qlo9WZM/gn2csaLjGk+PKBn\n2T+KYePjbBe0E7AoOL2ByTcxP/o0ry6x7AQ6d8YaRJCJ4JvsJuIGZMtkD1j0sPBG\n5SLonbNfNIKS8iVaJSHCJsHhQB+rPzROTnJNC/PIIIagDJHvY/AcLUhsyOpxBC9b\nMsNvIO1EHUqK7WQcshmT0s0UgVMfo5aDqNG+K+XpY/wI+08sZdOTiQiMstZQ+zET\nnSDgEL3zEn5umx+x/utFeM5whCxyOzgh5Iu+as7+f/gNehhRA7PI6WJ1WN8tkRRr\nr394gOqHHW3gwfNA/Py2sgrsnqFFEQjly0JZPht9F0RbflV1EXBodF1MEk3+/5DT\n3H2ObSZ7sI3DHF5lM7oDeA6ukmQqESJ0FqKcCF6iEn7rTEoAxUlce/eL6VvNDVDw\nLBXbojzOx9UZ7n9Gq5EQLXC2DcLl0MVWWe3VUZ0aAf3vmN7B7HU=\n=KEj7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7fdc481599b9eb34200f1d4504883af493725f20",
          "sha": "7fdc481599b9eb34200f1d4504883af493725f20",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7fdc481599b9eb34200f1d4504883af493725f20"
        }
      ],
      "message": "threadpool: Treat double-Start as logic error\n\nCalling Start() on an already-running pool is a programming error, not\na recoverable runtime condition.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-17T01:57:08Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-16T23:56:07Z"
      },
      "sha": "881568b39b686f0a418e02972c28c050c76de059"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22839736132,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVRWrdE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22839736132",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/881568b39b686f0a418e02972c28c050c76de059",
      "created_at": "2026-02-17T01:57:59Z"
    },
    {
      "event": "labeled",
      "id": 22840414515,
      "node_id": "LE_lADOABII587qd6NDzwAAAAVRZREz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22840414515",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-17T02:52:40Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800844092",
      "pull_request_review_id": 3793381996,
      "id": 2800844092,
      "node_id": "PRRC_kwDOABII586m8X08",
      "diff_hunk": "@@ -44,6 +44,13 @@ BOOST_FIXTURE_TEST_SUITE(threadpool_tests, ThreadPoolFixture)\n         }                                                                         \\\n     } while (0)\n \n+// Helper to unwrap a valid pool submission\n+template <typename F> [[nodiscard]]\n+auto Submit(ThreadPool& pool, F&& fn)",
      "path": "src/test/threadpool_tests.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "original_commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nice helper! Was actually experimenting with changing `ThreadPool::Submit()` to return `util::Expected` yesterday (suffering from lack of knowledge of `std::invoke_result_t<F>` though). It was *so* cumbersome to adapt these test without realizing a helper would be useful. :)\r\n \r\nnit: The going style seems to be `[[nodiscard]]` on the same line as the return type:\r\n\r\n```C++\r\ntemplate <typename F>\r\n[[nodiscard]] auto Submit(ThreadPool& pool, F&& fn)\r\n```\r\n\r\nExamples from master:\r\nhttps://github.com/bitcoin/bitcoin/blob/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b/src/util/overflow.h#L14-L15\r\nhttps://github.com/bitcoin/bitcoin/blob/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b/src/test/fuzz/util.h#L84-L85\r\n\r\nSame style nit goes for `ThreadPool::Submit()`.\r\n",
      "created_at": "2026-02-12T20:09:07Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800844092",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800844092"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 48,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800886683",
      "pull_request_review_id": 3793381996,
      "id": 2800886683,
      "node_id": "PRRC_kwDOABII586m8iOb",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");\n             }\n             m_work_queue.emplace(std::move(task));\n         }\n         m_cv.notify_one();\n-        return future;\n+        return util::Expected<decltype(future), std::string>(std::move(future));",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 38,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Can replace with:\n```C++\n        return {std::move(future)};\n```",
      "created_at": "2026-02-12T20:19:50Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800886683",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800886683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 167,
      "start_side": "LEFT",
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800890119",
      "pull_request_review_id": 3793381996,
      "id": 2800890119,
      "node_id": "PRRC_kwDOABII586m8jEH",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 32,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: No need to specify `Unexpected` template arg:\r\n ```suggestion\r\n                 return util::Unexpected{\"No active workers; cannot accept new tasks\"};\r\n```",
      "created_at": "2026-02-12T20:20:40Z",
      "updated_at": "2026-02-12T21:01:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800890119",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800890119"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 164,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800913416",
      "pull_request_review_id": 3793381996,
      "id": 2800913416,
      "node_id": "PRRC_kwDOABII586m8owI",
      "diff_hunk": "@@ -276,7 +276,12 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }\n+",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 28,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "meganit: Superfluous newline after `if`-block before end of outer block.\n\n```suggestion\n```",
      "created_at": "2026-02-12T20:26:58Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800913416",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800913416"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 284,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800934226",
      "pull_request_review_id": 3793381996,
      "id": 2800934226,
      "node_id": "PRRC_kwDOABII586m8t1S",
      "diff_hunk": "@@ -211,7 +211,7 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             }\n         }\n     }\n-    auto hreq{std::make_unique<HTTPRequest>(req, *static_cast<const util::SignalInterrupt*>(arg))};\n+    auto hreq{std::make_shared<HTTPRequest>(req, *static_cast<const util::SignalInterrupt*>(arg))};",
      "path": "src/httpserver.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "remark: Was experimenting with having `ThreadPool::Submit()` take a \"task_creator\" lambda that only gets called when no error condition in `Submit` occurs, it would then return the inner lambda which would take ownership of the `unique_ptr` as on master. Even though I have a distaste for `shared_ptr`, your version is more elegant.",
      "created_at": "2026-02-12T20:32:36Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800934226",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800934226"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 214,
      "original_line": 214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801004334",
      "pull_request_review_id": 3793381996,
      "id": 2801004334,
      "node_id": "PRRC_kwDOABII586m8-8u",
      "diff_hunk": "",
      "path": "src/test/fuzz/threadpool.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "241367d021d210f25e427e7bb35c676b293ff28a",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Commit message suggestion for 241367d021d210f25e427e7bb35c676b293ff28a:\r\n```diff\r\nthreadpool: make Submit return Expected instead of throwing\r\n\r\nUnlike exceptions, which can be ignored as they require extra try-catch\r\nblocks, returning expected errors forces callers to always handle\r\nsubmission failures.\r\n\r\n+ Not throwing an exception also happens to fix unclean shutdown bug\r\n+ #34573 since we no longer throw when attempting to Submit() from http_request_cb().\r\n```",
      "created_at": "2026-02-12T20:51:06Z",
      "updated_at": "2026-02-12T21:02:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801004334",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801004334"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801017120",
      "pull_request_review_id": 3793381996,
      "id": 2801017120,
      "node_id": "PRRC_kwDOABII586m9CEg",
      "diff_hunk": "",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Commit message suggestion for 5326821cbffbef388421af082d43c7bc6bcc48f7:\r\n\r\nGiven that I think the unclean shutdown is already fixed in the first commit by using `util::Expected` instead of throwing exceptions, I think this is somewhat more correct for the second:\r\n```\r\nhttp: properly respond to HTTP request during shutdown\r\n\r\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\r\nthe threadpool during server shutdown.\r\n\r\nRoughly what happens:\r\n\r\n1) The server receives an HTTP request and starts calling http_request_cb().\r\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\r\n   and unregisters http_request_cb() and interrupts the thread pool.\r\n3) The request (step 1) resumes and tries to submit a task\r\n   to the now-interrupted server.\r\n\r\nThis fix detects failed submissions immediately, and the server\r\nresponds with HTTP_SERVICE_UNAVAILABLE.\r\n```\r\nI don't think it's necessary to classify this as a race condition. I guess it depends on how you define it.",
      "created_at": "2026-02-12T20:54:37Z",
      "updated_at": "2026-02-12T21:02:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801017120",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801017120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801459421",
      "pull_request_review_id": 3794149447,
      "id": 2801459421,
      "node_id": "PRRC_kwDOABII586m-uDd",
      "diff_hunk": "@@ -44,6 +44,13 @@ BOOST_FIXTURE_TEST_SUITE(threadpool_tests, ThreadPoolFixture)\n         }                                                                         \\\n     } while (0)\n \n+// Helper to unwrap a valid pool submission\n+template <typename F> [[nodiscard]]\n+auto Submit(ThreadPool& pool, F&& fn)",
      "path": "src/test/threadpool_tests.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "original_commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "in_reply_to_id": 2800844092,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done as suggested. [[nodiscard]] inlined.\r\nAlso, credits to ryanofsky for the helper function idea <3. I was about to use a macro.",
      "created_at": "2026-02-12T23:01:45Z",
      "updated_at": "2026-02-12T23:01:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801459421",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801459421"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 48,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460139",
      "pull_request_review_id": 3794150427,
      "id": 2801460139,
      "node_id": "PRRC_kwDOABII586m-uOr",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");\n             }\n             m_work_queue.emplace(std::move(task));\n         }\n         m_cv.notify_one();\n-        return future;\n+        return util::Expected<decltype(future), std::string>(std::move(future));",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 38,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": 2800886683,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Cool. Done as suggested. Thanks.",
      "created_at": "2026-02-12T23:02:00Z",
      "updated_at": "2026-02-12T23:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801460139",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460139"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 167,
      "start_side": "LEFT",
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460424",
      "pull_request_review_id": 3794150790,
      "id": 2801460424,
      "node_id": "PRRC_kwDOABII586m-uTI",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 32,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": 2800890119,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Cool. Done as suggested. Thanks.",
      "created_at": "2026-02-12T23:02:06Z",
      "updated_at": "2026-02-12T23:02:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801460424",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460424"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 164,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460794",
      "pull_request_review_id": 3794151219,
      "id": 2801460794,
      "node_id": "PRRC_kwDOABII586m-uY6",
      "diff_hunk": "@@ -276,7 +276,12 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }\n+",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 28,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": 2800913416,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2026-02-12T23:02:13Z",
      "updated_at": "2026-02-12T23:02:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801460794",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801460794"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 284,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801461558",
      "pull_request_review_id": 3794152404,
      "id": 2801461558,
      "node_id": "PRRC_kwDOABII586m-uk2",
      "diff_hunk": "",
      "path": "src/test/fuzz/threadpool.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "241367d021d210f25e427e7bb35c676b293ff28a",
      "in_reply_to_id": 2801004334,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Sure. Done as suggested. Thanks.",
      "created_at": "2026-02-12T23:02:32Z",
      "updated_at": "2026-02-12T23:02:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801461558",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801461558"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801472139",
      "pull_request_review_id": 3794166799,
      "id": 2801472139,
      "node_id": "PRRC_kwDOABII586m-xKL",
      "diff_hunk": "",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": 2801017120,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Taken, thanks!\r\n\r\n> I don't think it's necessary to classify this as a race condition. I guess it depends on how you define it.\r\n\r\nThere is a thread (shutdown - main thread) modifying a resource (thread pool) just before another thread (libevent http handler) accesses it. It is pretty much a race condition to me.",
      "created_at": "2026-02-12T23:06:35Z",
      "updated_at": "2026-02-12T23:06:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801472139",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801472139"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2804490918",
      "pull_request_review_id": 3797580441,
      "id": 2804490918,
      "node_id": "PRRC_kwDOABII586nKSKm",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F>\n+    [[nodiscard]] util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 23,
      "commit_id": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "original_commit_id": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can this be `noexcept` now?",
      "created_at": "2026-02-13T14:25:55Z",
      "updated_at": "2026-02-13T14:25:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2804490918",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2804490918"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 157,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2804827413",
      "pull_request_review_id": 3797961362,
      "id": 2804827413,
      "node_id": "PRRC_kwDOABII586nLkUV",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F>\n+    [[nodiscard]] util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 23,
      "commit_id": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "original_commit_id": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "in_reply_to_id": 2804490918,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Sure, done as suggested.",
      "created_at": "2026-02-13T15:38:08Z",
      "updated_at": "2026-02-13T15:38:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2804827413",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2804827413"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 157,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2805989097",
      "pull_request_review_id": 3799391187,
      "id": 2805989097,
      "node_id": "PRRC_kwDOABII586nP_7p",
      "diff_hunk": "",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": 2801017120,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> There is a thread (shutdown - main thread) modifying a resource (thread pool) just before another thread (libevent http handler) accesses it. It is pretty much a race condition to me.\r\n\r\nFair.",
      "created_at": "2026-02-13T20:34:38Z",
      "updated_at": "2026-02-13T20:55:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2805989097",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2805989097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806053342",
      "pull_request_review_id": 3799391187,
      "id": 2806053342,
      "node_id": "PRRC_kwDOABII586nQPne",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "1. Log the inner error string (currently it's never read).\n2. Even though we know it in the context of this PR/issue - I think it's a bit overly presumptuous to claim we are shutting down. All this outer logic knows is that `Submit()` failed. Would go with more neutral language.\n```suggestion\n        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n            LogWarning(\"Request rejected by thread pool: %s\", res.error());\n            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected by thread pool\");\n            return;\n        }\n```\n(I was experimenting with changing `ThreadPool::Submit()` to enforce the queue depth by itself, which would be another potential reason for it to fail).",
      "created_at": "2026-02-13T20:55:13Z",
      "updated_at": "2026-02-13T20:55:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806053342",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806053342"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806122394",
      "pull_request_review_id": 3799567550,
      "id": 2806122394,
      "node_id": "PRRC_kwDOABII586nQgea",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The `LogWarning` change makes sense, but the `WriteReply` one isn't really appropriate. Have in mind that `WriteReply` is an user-facing response, and referring to the \"thread pool\" there leaks internal details that do not help the user understand what happened nor what to do next.\r\n\r\n> (I was experimenting with changing ThreadPool::Submit() to enforce the queue depth by itself, which would be another potential reason for it to fail).\r\n\r\nI briefly thought about this and ended up discarding the idea because there is no other known use-case that requires it for now. Capping the pool is required when the pool faces user's requests, and all other applications we have for it are purely internal (parallel index sync, block inputs fetching, wallet rescan, kernel validation signals, etc). Ideally, we should only generalize features into the thread pool class only when we plan to use them in more than one place.",
      "created_at": "2026-02-13T21:14:21Z",
      "updated_at": "2026-02-13T21:14:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806122394",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806122394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806173647",
      "pull_request_review_id": 3799640701,
      "id": 2806173647,
      "node_id": "PRRC_kwDOABII586nQs_P",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We currently don't have a simple way to detect shutdown from within the libevent request callback to be able to differentiate between states, and we shouldn't pollute code just because of this. Submission can only fail because of a shutdown atm.\r\nWe will be able to access more information from within this function after the libevent removal path, as the new server provides better encapsulation.",
      "created_at": "2026-02-13T21:28:05Z",
      "updated_at": "2026-02-13T21:36:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806173647",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806173647"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806210585",
      "pull_request_review_id": 3799692564,
      "id": 2806210585,
      "node_id": "PRRC_kwDOABII586nQ2AZ",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah, I can agree on not being to specific with the internals in user-facing messages and omitting thread pool.\r\n```suggestion\r\n        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\r\n            LogWarning(\"Request rejected by thread pool: %s\", res.error());\r\n            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected, probably due to server shutdown\");\r\n            return;\r\n        }\r\n```\r\nIf you want to keep the current very assertive wording \"Request rejected during server shutdown\" I would suggest returning a one-value error `enum` instead of the `std::string` in `util::Expected` and having:\r\n\r\n```suggestion\r\n        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\r\n            switch (res.error()) {\r\n            case ThreadPool::SubmitError::Interrupted:\r\n                LogWarning(\"Request rejected during server shutdown\");\r\n                hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\r\n                return;\r\n            } // no default case, so the compiler can warn about missing cases\r\n        }\r\n```",
      "created_at": "2026-02-13T21:37:54Z",
      "updated_at": "2026-02-13T21:37:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806210585",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806210585"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806233905",
      "pull_request_review_id": 3799723551,
      "id": 2806233905,
      "node_id": "PRRC_kwDOABII586nQ7sx",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I briefly thought about this and ended up discarding the idea because there is no other known use-case that requires it for now. Capping the pool is required when the pool faces user's requests, and all other applications we have for it are purely internal (parallel index sync, block inputs fetching, wallet rescan, kernel validation signals, etc). Ideally, we should only generalize features into the thread pool class only when we plan to use them in more than one place.\r\n\r\nI was worried about multiple threads calling `Submit()` and doing the queue depth check on the outside in a racy way where they both pass and then both `Submit()` and exceed the depth by one. But libevent probably only calls `http_request_cb()` from one thread so we should be fine right now. Thanks for laying out your reasoning, makes sense.",
      "created_at": "2026-02-13T21:44:50Z",
      "updated_at": "2026-02-13T21:44:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806233905",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806233905"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806257320",
      "pull_request_review_id": 3799754229,
      "id": 2806257320,
      "node_id": "PRRC_kwDOABII586nRBao",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> If you want to keep the current very assertive wording \"Request rejected during server shutdown\" I would suggest returning a one-value error enum instead of the std::string in util::Expected\r\n\r\nI'm not convinced we should add an error code enum when weâ€™re not expecting to expand it anytime soon. It would force everyone using the pool to add a bunch of boilerplate code for no real gain.\r\nWe could differentiate states now, without waiting for the post-libevent encapsulation, by checking whether the pool was interrupted too. Still, it feels like overthinking this for no real reason.\r\nI would focus on fixing the issue here and keep the code simple for now. We can always adapt/modify it when more pool use-cases get merged.",
      "created_at": "2026-02-13T21:51:59Z",
      "updated_at": "2026-02-13T21:54:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806257320",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806257320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806291786",
      "pull_request_review_id": 3799807774,
      "id": 2806291786,
      "node_id": "PRRC_kwDOABII586nRJ1K",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "True, I am probably somewhat biased by my earlier experiments. Maybe it would be cleaner for `Submit()` to return `std::optional<std::future<std::invoke_result_t<F>>>` instead of `util::Expected<std::future<std::invoke_result_t<F>>, std::string>` after all - as long as there is only one single cause of failure?",
      "created_at": "2026-02-13T22:03:30Z",
      "updated_at": "2026-02-13T22:03:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806291786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806291786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806459577",
      "pull_request_review_id": 3800073205,
      "id": 2806459577,
      "node_id": "PRRC_kwDOABII586nRyy5",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Maybe it would be cleaner for `Submit()` to return `std::optional<std::future<std::invoke_result_t<F>>>` instead of `util::Expected<std::future<std::invoke_result_t<F>>, std::string>` after all - as long as there is only one single cause of failure?\r\n\r\nHmm, good observation. Thinking further.. there are currently two possible errors during submission that are currently under the same error message: 1) a non-started pool and 2) an interrupted pool. The first one is actually a logical error rather than one during runtime, and we should probably assert/assume that cannot happen. Will think more about this.",
      "created_at": "2026-02-13T23:14:02Z",
      "updated_at": "2026-02-14T01:17:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2806459577",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2806459577"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2809534130",
      "pull_request_review_id": 3805060200,
      "id": 2809534130,
      "node_id": "PRRC_kwDOABII586ndhay",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think `Expected` is the appropriate return value here. It is an unexpected failure to submit a task, rather than the result being \"not found\" or \"not existing\" as a `nullopt` would imply.",
      "created_at": "2026-02-15T15:11:03Z",
      "updated_at": "2026-02-15T15:11:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2809534130",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2809534130"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2811317674",
      "pull_request_review_id": 3807383837,
      "id": 2811317674,
      "node_id": "PRRC_kwDOABII586nkU2q",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`optional` doesn't strictly mean \"found/not found\", IMO it's closer to \"may be set or not\". `Submit()` is not a query type function, we are submitting to a thread pool and should be getting a `std::future` back.\r\n\r\nThe user-code and messages here immediately draw the conclusion that failure to submit means we are shutting down, so it is not *that* unexpected. Having a string as the error approaches stringly typed coding which should also be avoided (potentially returning different strings for different error conditions makes user code worse).\r\n\r\nAs long as we only have one combined error condition (not started *or* interrupted), I think `optional` makes the most sense. If we separate the two I think `util::Unexpected{enum SubmitError { NotStarted, Interrupted }}` makes more sense.\r\n\r\nPS. I'm sorry if this feels nit-picky, I would probably let it slide if it was more of a leaf-type component.",
      "created_at": "2026-02-16T08:59:35Z",
      "updated_at": "2026-02-16T09:06:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2811317674",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2811317674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813012276",
      "pull_request_review_id": 3809291766,
      "id": 2813012276,
      "node_id": "PRRC_kwDOABII586nqyk0",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I went one step back and asked myself why added the submission exception in the first place (3.5 years ago). Should have remembered the reasoning sooner and not gotten obnubilated by our new shiny `util::Expected` toy.. sorry.\r\n\r\nThread pools are a well-studied structure, and most languages and libraries handle submission errors in the same way:\r\n* Java's ExecutorService throws `RejectedExecutionException` after shutdown().\r\n* Python's `ThreadPoolExecutor` raises a `RuntimeError` after shutdown().\r\n* Boost.Asio treats submission after stop or shutdown as misuse.\r\n\r\nSo, the principle is the same everywhere: a thread pool is a resource with a lifecycle. Once you cross the shutdown boundary, submitting work isn't normal control flow anymore, and it should be treated differently.\r\n\r\nFor us, that means:\r\n* \"Pool not started\": that's a bug in the calling code. We can either Assume it or throw a `logic_error`. Callers can't recover from this anyway.\r\n* \"Pool interrupted\": is a hard lifecycle boundary. Submitting after `Interrupt()` should throw a dedicated `interrupted_exception`. Not everyone has to worry about this.\r\n* Otherwise: strong guarantee. If you get a future back, your task will run.\r\n\r\nWill re-accommodate the code to follow this principles again. I'm inclined towards being consistent with existing libraries and not reinvent the wheel.\r\n\r\nLet me know if you guys have any reservation about this.",
      "created_at": "2026-02-16T15:36:58Z",
      "updated_at": "2026-02-16T15:37:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813012276",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813012276"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813039981",
      "pull_request_review_id": 3809321408,
      "id": 2813039981,
      "node_id": "PRRC_kwDOABII586nq5Vt",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In \"threadpool: make Submit return Expected instead of throwing\" 818e2edadc11dca226539ddee945f0acf6e53814\n\nThis introduces inconsistency. In `Start`, we throw a runtime error as a result of multiple calls to `Start`, or possibly an exception could occur when thread creation fails for some reason. \n\n I'm also a bit conflicted here. Why are we using `util::Expected`? Shouldn't the client be patched to handle throws when interacting with the thread pool? It's likely that we throw for some cases, and still back to an issue like the unclean shutdown we are fixing here?\n",
      "created_at": "2026-02-16T15:42:43Z",
      "updated_at": "2026-02-16T15:44:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813039981",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813039981"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813062353",
      "pull_request_review_id": 3809346741,
      "id": 2813062353,
      "node_id": "PRRC_kwDOABII586nq-zR",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": 2813039981,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes. Please see https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813012276. Same conclusion there. I'm changing the current PR approach now. I shouldn't have gotten obnubilated by our shiny new `util::Expected` toy.",
      "created_at": "2026-02-16T15:47:20Z",
      "updated_at": "2026-02-16T15:54:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813062353",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813062353"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813096660",
      "pull_request_review_id": 3809383901,
      "id": 2813096660,
      "node_id": "PRRC_kwDOABII586nrHLU",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think the way Java and Python throw exceptions is dated. It's what got us into the situation with this PR in the first place, returning an error by value is a safer pattern IMO. That's why Rust opted to not support exceptions.",
      "created_at": "2026-02-16T15:55:13Z",
      "updated_at": "2026-02-16T15:55:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813096660",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813096660"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813111158",
      "pull_request_review_id": 3809401258,
      "id": 2813111158,
      "node_id": "PRRC_kwDOABII586nrKt2",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": 2813039981,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`Start()` could probably `Assume()` or `assert()` instead of throw, it seems to be a bit of a logic error to `Start()` twice without stopping.",
      "created_at": "2026-02-16T15:58:47Z",
      "updated_at": "2026-02-16T15:58:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813111158",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813111158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813190132",
      "pull_request_review_id": 3809484395,
      "id": 2813190132,
      "node_id": "PRRC_kwDOABII586nrd_0",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I think the way Java and Python throw exceptions is dated. It's what got us into the situation with this PR in the first place, returning an error by value is a safer pattern IMO. That's why Rust opted to not support exceptions.\r\n\r\nIt seems low-level Rust panics/aborts when submitting a task to an interrupted pool. What they have is a `try_spawn` wrapper (`TrySubmit` for us) that behaves in the way you describe. See [rusty_pool](https://docs.rs/rusty_pool/latest/rusty_pool/struct.ThreadPool.html#method.spawn) or [tokio-threadpool](https://docs.rs/tokio-threadpool/latest/tokio_threadpool/struct.ThreadPool.html#method.spawn).\r\n\r\n>  It's what got us into the situation with this PR in the first place\r\n\r\nWell, realistically speaking, the race was already there. We were returning the wrong error message before. The exception actually helped us catch it.",
      "created_at": "2026-02-16T16:18:22Z",
      "updated_at": "2026-02-16T16:29:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813190132",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813190132"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813299121",
      "pull_request_review_id": 3809597779,
      "id": 2813299121,
      "node_id": "PRRC_kwDOABII586nr4mx",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Agree with @hodlinator. Changing to exceptions is a step backwards. Modern error handling should use `std::expected`, which we can't use yet.\r\nAlso agree to use an enum for the different error cases, instead of using a std::optional. It's ok if we don't check the value yet in production code, but we can update the test cases to assert the proper error.",
      "created_at": "2026-02-16T16:46:51Z",
      "updated_at": "2026-02-16T16:46:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813299121",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813299121"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813307479",
      "pull_request_review_id": 3809607457,
      "id": 2813307479,
      "node_id": "PRRC_kwDOABII586nr6pX",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": 2813039981,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> obnubilated\r\n\r\nlol\r\n\r\nThrowing exceptions should be deprecated IMO, and we should aim to use the more modern `Expected` approach for errors. If an error is unrecoverable, `abort` instead of throwing an exception.",
      "created_at": "2026-02-16T16:48:54Z",
      "updated_at": "2026-02-16T16:48:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813307479",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813307479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813382892",
      "pull_request_review_id": 3809686328,
      "id": 2813382892,
      "node_id": "PRRC_kwDOABII586nsNDs",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Well, realistically speaking, the race was already there. We were returning the wrong error message before. The exception actually helped us catch it.\r\n\r\nThe previous race would return an error to the caller. The exception caused the node to crash. Using `Expected` prevents this kind of error from occurring because the caller is forced to handle the error instead of forgetting to wrap in try/catch.",
      "created_at": "2026-02-16T17:10:29Z",
      "updated_at": "2026-02-16T17:10:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813382892",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813382892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813492557",
      "pull_request_review_id": 3809834071,
      "id": 2813492557,
      "node_id": "PRRC_kwDOABII586nsn1N",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": 2813039981,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Throwing exceptions should be deprecated IMO\n\nI disagree with this as a general statement. For example, throwing an exception is the standard way to indicate an error in a constructor, as utilized all over the standard library. We also use the standard library very extensively, which makes extensive use of exceptions, and will require us to handle them for as long as we use it.",
      "created_at": "2026-02-16T17:45:24Z",
      "updated_at": "2026-02-16T17:45:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2813492557",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813492557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2814200745",
      "pull_request_review_id": 3810703337,
      "id": 2814200745,
      "node_id": "PRRC_kwDOABII586nvUup",
      "diff_hunk": "@@ -17,6 +18,7 @@\n #include <queue>\n #include <stdexcept>\n #include <thread>\n+#include <type_traits>\n #include <utility>\n #include <vector>\n ",
      "path": "src/util/threadpool.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "818e2edadc11dca226539ddee945f0acf6e53814",
      "in_reply_to_id": 2813039981,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Right, we can't return an `Expected` from a constructor like we can return a `Result` in Rust when creating an object. Other than that, though, I don't think there's a need to throw an exception. We still need to catch exceptions, of course. I didn't suggest we stop doing that!",
      "created_at": "2026-02-16T22:15:37Z",
      "updated_at": "2026-02-16T22:15:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2814200745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2814200745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2814519485",
      "pull_request_review_id": 3811097297,
      "id": 2814519485,
      "node_id": "PRRC_kwDOABII586nwii9",
      "diff_hunk": "@@ -276,7 +276,11 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }",
      "path": "src/httpserver.cpp",
      "position": 28,
      "original_position": 27,
      "commit_id": "881568b39b686f0a418e02972c28c050c76de059",
      "original_commit_id": "b95e40359568d964c0ed1341c91ce8ed97c78d62",
      "in_reply_to_id": 2806053342,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> The previous race would return an error to the caller. The exception caused the node to crash. Using Expected prevents this kind of error from occurring because the caller is forced to handle the error instead of forgetting to wrap in try/catch.\r\n\r\nYes, thatâ€™s pretty much the PR description. What I meant above is that itâ€™s great weâ€™re here, because it means weâ€™ve caught something new. That comment at least wasn't a pro exceptions argument. It was a pro thread pool inclusion argument really.",
      "created_at": "2026-02-17T00:50:05Z",
      "updated_at": "2026-02-17T00:50:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2814519485",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2814519485"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": 279,
      "original_start_line": 279,
      "start_side": "RIGHT",
      "line": 284,
      "original_line": 283,
      "side": "RIGHT"
    }
  ]
}
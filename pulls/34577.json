{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577",
    "id": 3277895355,
    "node_id": "PR_kwDOABII587DYLa7",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34577",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34577.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34577.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
    "number": 34577,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "http: fix submission during shutdown race",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Fixes #34573.\r\n\r\nAs mentioned in https://github.com/bitcoin/bitcoin/issues/34573#issuecomment-3891596958, the ThreadPool PR (#33689) revealed an existing issue.\r\n\r\nBefore that PR, we were returning an incorrect error \"Request rejected because http work queue depth exceeded\" during shutdown for unhandled requests (we were not differentiating between \"queue depth exceeded\" and \"server interrupted\" errors). Now, with the ThreadPool inclusion, we return the proper error but we don't handle it properly.\r\n\r\nThis PR improves exactly that. Handling the missing error and properly returning it to the user.\r\n\r\nThe race can be reproduced as follows:\r\n\r\n1) The server receives an http request.\r\n2) Processing of the request is delayed, and shutdown is triggered in the meantime.\r\n3) During shutdown, the libevent callback is unregistered and the threadpool interrupted.\r\n4) The delayed request (step 2) resumes and tries to submit a task to the now-interrupted server.\r\n\r\n\r\nAlso, to prevent this kind of issue from happening again, this PR changes task submission\r\nto return the error as part of the function's return value using `util::Expected` instead of\r\nthrowing the exception. Unlike exceptions, which require extra try-catch blocks and can be\r\nignored, returning `Expected` forces callers to explicitly handle failures, and attributes\r\nlike `[[nodiscard]]` allow us catch unhandled ones at compile time.\r\n\r\n",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      }
    ],
    "created_at": "2026-02-12T19:52:35Z",
    "updated_at": "2026-02-12T22:56:51Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "c99ac7c79650801e3a410a57c1701b1417eb1cd5",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2026_http_submission_error",
      "ref": "2026_http_submission_error",
      "sha": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 447751,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-12T22:56:49Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2026-02-07T21:37:50Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38906,
        "stargazers_count": 88091,
        "watchers_count": 88091,
        "size": 303642,
        "default_branch": "master",
        "open_issues_count": 733,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-12T09:43:32Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-12T22:17:56Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 43,
    "deletions": 31,
    "changed_files": 4,
    "commits": 2,
    "review_comments": 7,
    "comments": 4
  },
  "events": [
    {
      "event": "labeled",
      "id": 22746199637,
      "node_id": "LE_lADOABII587qd6NDzwAAAAVLx3ZV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746199637",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T19:52:39Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "commented",
      "id": 3893067383,
      "node_id": "IC_kwDOABII587oC353",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893067383",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T19:52:59Z",
      "updated_at": "2026-02-12T21:01:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3793381996) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893067383",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22746449751,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVLy0dX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746449751",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/5326821cbffbef388421af082d43c7bc6bcc48f7",
      "created_at": "2026-02-12T20:02:29Z"
    },
    {
      "event": "labeled",
      "id": 22746465878,
      "node_id": "LE_lADOABII587qd6NDzwAAAAVLy4ZW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22746465878",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:03:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3893112838,
      "node_id": "IC_kwDOABII587oDDAG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893112838",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:03:19Z",
      "updated_at": "2026-02-12T20:03:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `No wallet`: https://github.com/bitcoin/bitcoin/actions/runs/21961944156/job/63441463470</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed in fuzz/threadpool.cpp: Submit returns util::Expected<future<void>, string> which cannot be assigned to std::future<void>, causing build errors.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893112838",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "commented",
      "id": 3893242863,
      "node_id": "IC_kwDOABII587oDivv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893242863",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:31:52Z",
      "updated_at": "2026-02-12T20:31:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "> The race can be reproduced as follows:\r\n\r\nCan this be made into a functional regression test?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893242863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "commented",
      "id": 3893331956,
      "node_id": "IC_kwDOABII587oD4f0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3893331956",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T20:53:36Z",
      "updated_at": "2026-02-12T21:13:39Z",
      "author_association": "MEMBER",
      "body": "> Can this be made into a functional regression test?\r\n\r\nThe \"processing request is delayed\" step means manually placing a `sleep()` inside the libevent callback `http_request_cb()` to progress on the server shutdown concurrently. Then we need to `sleep()` during shutdown, just after `InterruptHTTPServer()`, to resume the request processing before shutdown occurs.\r\nSo, the short answer is no. Sadly races aren't easy to replicate deterministically in functional tests.\r\nWe will surely be able to exercise more scenarios like this one, in unit tests, after the new http server inclusion (libevent removal path), which will bring better encapsulation.\r\n\r\nThat being said, could provide a `sleep()`-based patch to replicate it locally.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#issuecomment-3893331956",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34577"
    },
    {
      "event": "reviewed",
      "id": 3793381996,
      "node_id": "PRR_kwDOABII587iGmps",
      "url": null,
      "actor": null,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-12T21:01:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 5326821cbffbef388421af082d43c7bc6bcc48f7",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#pullrequestreview-3793381996",
      "submitted_at": "2026-02-12T21:01:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
    },
    {
      "event": "unlabeled",
      "id": 22748279893,
      "node_id": "UNLE_lADOABII587qd6NDzwAAAAVL5zRV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22748279893",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T21:16:37Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY2OGVhYTRhYjQwNjBkOWYwZjZjOTU1Njc5Yzk1ZDllYTYxNDk5ZTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
      "tree": {
        "sha": "352b168e981b963cfa1a2977d1c7acaa35a76e6c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/352b168e981b963cfa1a2977d1c7acaa35a76e6c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 352b168e981b963cfa1a2977d1c7acaa35a76e6c\nparent 07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b\nauthor furszy <matiasfurszyfer@protonmail.com> 1770923302 -0500\ncommitter furszy <matiasfurszyfer@protonmail.com> 1770936819 -0500\n\nthreadpool: make Submit return Expected instead of throwing\n\nUnlike exceptions, which can be ignored as they require extra try-catch\nblocks, returning expected errors forces callers to always handle\nsubmission failures.\n\nNot throwing an exception also fixes an unclean shutdown bug\n#34573 since we no longer throw when attempting to Submit()\nfrom the libevent callback http_request_cb().\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmmOWfQACgkQXdI8zGhq\npiMJlRAAivnTnfIHMXnxlJsusmtz2jBDurSTVgdDRtQWPfngRiYFSS0A0JB/OmQz\nUOXfPkrdliww0+B8K/m+b2wR/EBGFt24M7sNcTak7LoLMwuKUuDihfAxeGHrJ43f\njXx1OAPMkCUIXtSJiOahjOPFC7uQRYrEYq0ZSE98586+n/lbuSRmlbzFTkbhvbqE\nOPXyg3nIZeJGdVW5NrK971unlm92zW3TU6F5vVa9NOKqrOBCUx0ZlNj4vM/l6LmN\nY0LA14X1AKW4zcPpT+TObMjky9pqnURTDG4YtjnaUidQP31B/o68056lk1ddoK5m\nGCw9TKyiPlE4wJ/crH+tI4bP47tf36vUhLxmgJNnUdqGPyJEMViz6ZSjda6x+4Z7\nTmOaTlifb9j1+KRzz9lnLdeFHDXnZH5Tw92O9MOVYEWo5/kdcmWFqfUaJiqmKpHO\nHyeCqLWnWXxoK0OL8zobLWFn0L48Qcr5MD6Y9MoB0v3hoBeWG4OGj/Gx5WqDPiCP\nkabfweUNGcyYlqqh5s16Zu8PFGJOKvst/9m6BLBRRbZxsFLeF7jXlU7RiiWhjxyp\nQmLc8PsxzJwS/mtEVhySEp5KvElmw794wJ5Mn7xgpJZo1qxCgGZxJdtMWAEqF72k\n2PHDxLKNjBs8TYr7tlMfOylRD+LuOVP46EKy+UNEbjVXUeYfHnI=\n=7TTi\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b",
          "sha": "07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b"
        }
      ],
      "message": "threadpool: make Submit return Expected instead of throwing\n\nUnlike exceptions, which can be ignored as they require extra try-catch\nblocks, returning expected errors forces callers to always handle\nsubmission failures.\n\nNot throwing an exception also fixes an unclean shutdown bug\n#34573 since we no longer throw when attempting to Submit()\nfrom the libevent callback http_request_cb().",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T22:53:39Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T19:08:22Z"
      },
      "sha": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ2YWE0MGVkZDIzY2RkOGYzYjQ5Y2Y4MmNhOGE3OTU1M2ZkZTljNzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "tree": {
        "sha": "1fa6f9823b2a3cd9097c0a353015279f1faf33ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1fa6f9823b2a3cd9097c0a353015279f1faf33ad"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1fa6f9823b2a3cd9097c0a353015279f1faf33ad\nparent 668eaa4ab4060d9f0f6c955679c95d9ea61499e0\nauthor furszy <matiasfurszyfer@protonmail.com> 1770923302 -0500\ncommitter furszy <matiasfurszyfer@protonmail.com> 1770936913 -0500\n\nhttp: properly respond to HTTP request during shutdown\n\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\nthe thread pool during server shutdown.\n\nRoughly what happens:\n\n1) The server receives an HTTP request and starts calling http_request_cb().\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\n   and unregisters libevent http_request_cb() callback and interrupts the thread pool.\n3) The request (step 1) resumes and tries to submit a task to the now-interrupted server.\n\nThis fix detects failed submissions immediately, and the server responds with\nHTTP_SERVICE_UNAVAILABLE.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmmOWlEACgkQXdI8zGhq\npiPFog/+MMIrWifP3RUrbVBYNoewpJRYFU1pdjlkOy7idYcs18PMu7kGTAqZ2/4i\n7o8YXFqbB75yERf9J8MzStVJsbMQCdrA3A2jx8dLepSZKf9w6868Tk6mpf5RrZBd\nItzH8181AouekPJdlk84yc7YvRO/jB9v+CqB3DAT6sx83nq7OV3zc64SaTUv6ONb\nPiJX3BKhiFxhvXjQg6zAHwTGiZPbQAtrcEGHEaCt7+0qmoMjozlHbqwT+GNUZ84w\nXAekcSgTSsUawkO6VMrImLaSNjWOjLq2NkexvZJDSdYRN8eC4gCy0FUYGyNEe63H\nwf9Kqh484FEsLImx8iHqzhAyKIFW9fjjYA7yTExC2SRx+VqaT9BoulYuJH1EBrVt\nciRMmV+P9Ue/YZZ5eugPeIz2V89vmI3JRho6vA4ZywoMiypx02yaWz7zYcUHNZxO\ncoShC+5QoihRbP540DxMHmprl8liAh7d7kkE5Cs9Q7VfTjDdf6UZSmDNDu8slnS7\nb1r5uiEPXe3q/F78xb912WjVDltKnZegrsEvIPhqXqVqe2B5kK1fHjB2tRvBeUOE\nSjDzh70J/LRNBCGGIeDxMW0SHjlCZdCtKilRnVBxB9HOicJTvTTYR7/WwpO611CO\n8JUZZ5G75HZcExv59Nw9gW7srq4+bILWZuEBk3Kwf4diH/zjeX0=\n=Mz6F\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
          "sha": "668eaa4ab4060d9f0f6c955679c95d9ea61499e0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/668eaa4ab4060d9f0f6c955679c95d9ea61499e0"
        }
      ],
      "message": "http: properly respond to HTTP request during shutdown\n\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\nthe thread pool during server shutdown.\n\nRoughly what happens:\n\n1) The server receives an HTTP request and starts calling http_request_cb().\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\n   and unregisters libevent http_request_cb() callback and interrupts the thread pool.\n3) The request (step 1) resumes and tries to submit a task to the now-interrupted server.\n\nThis fix detects failed submissions immediately, and the server responds with\nHTTP_SERVICE_UNAVAILABLE.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T22:55:13Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2026-02-12T19:08:22Z"
      },
      "sha": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22750337843,
      "node_id": "HRFPE_lADOABII587qd6NDzwAAAAVMBpsz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22750337843",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "created_at": "2026-02-12T22:56:51Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800844092",
      "pull_request_review_id": 3793381996,
      "id": 2800844092,
      "node_id": "PRRC_kwDOABII586m8X08",
      "diff_hunk": "@@ -44,6 +44,13 @@ BOOST_FIXTURE_TEST_SUITE(threadpool_tests, ThreadPoolFixture)\n         }                                                                         \\\n     } while (0)\n \n+// Helper to unwrap a valid pool submission\n+template <typename F> [[nodiscard]]\n+auto Submit(ThreadPool& pool, F&& fn)",
      "path": "src/test/threadpool_tests.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "original_commit_id": "0b2d12f83c96ac9f838412f1ea6634f5eea66d4e",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nice helper! Was actually experimenting with changing `ThreadPool::Submit()` to return `util::Expected` yesterday (suffering from lack of knowledge of `std::invoke_result_t<F>` though). It was *so* cumbersome to adapt these test without realizing a helper would be useful. :)\r\n \r\nnit: The going style seems to be `[[nodiscard]]` on the same line as the return type:\r\n\r\n```C++\r\ntemplate <typename F>\r\n[[nodiscard]] auto Submit(ThreadPool& pool, F&& fn)\r\n```\r\n\r\nExamples from master:\r\nhttps://github.com/bitcoin/bitcoin/blob/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b/src/util/overflow.h#L14-L15\r\nhttps://github.com/bitcoin/bitcoin/blob/07b924775e4ff5dbfb9f2e7549fd13db8ec5c61b/src/test/fuzz/util.h#L84-L85\r\n\r\nSame style nit goes for `ThreadPool::Submit()`.\r\n",
      "created_at": "2026-02-12T20:09:07Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800844092",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800844092"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 48,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800886683",
      "pull_request_review_id": 3793381996,
      "id": 2800886683,
      "node_id": "PRRC_kwDOABII586m8iOb",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");\n             }\n             m_work_queue.emplace(std::move(task));\n         }\n         m_cv.notify_one();\n-        return future;\n+        return util::Expected<decltype(future), std::string>(std::move(future));",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 38,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Can replace with:\n```C++\n        return {std::move(future)};\n```",
      "created_at": "2026-02-12T20:19:50Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800886683",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800886683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": 167,
      "start_side": "LEFT",
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800890119",
      "pull_request_review_id": 3793381996,
      "id": 2800890119,
      "node_id": "PRRC_kwDOABII586m8jEH",
      "diff_hunk": "@@ -151,20 +153,20 @@ class ThreadPool\n      * Note: Ignoring the returned future requires guarding the task against\n      * uncaught exceptions, as they would otherwise be silently discarded.\n      */\n-    template <class F> [[nodiscard]] EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n-    auto Submit(F&& fn)\n+    template <class F> [[nodiscard]]\n+    util::Expected<std::future<std::invoke_result_t<F>>, std::string> Submit(F&& fn) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n     {\n-        std::packaged_task task{std::forward<F>(fn)};\n+        std::packaged_task<std::invoke_result_t<F>()> task{std::forward<F>(fn)};\n         auto future{task.get_future()};\n         {\n             LOCK(m_mutex);\n             if (m_interrupt || m_workers.empty()) {\n-                throw std::runtime_error(\"No active workers; cannot accept new tasks\");\n+                return util::Unexpected<std::string>(\"No active workers; cannot accept new tasks\");",
      "path": "src/util/threadpool.h",
      "position": 1,
      "original_position": 32,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: No need to specify `Unexpected` template arg:\r\n ```suggestion\r\n                 return util::Unexpected{\"No active workers; cannot accept new tasks\"};\r\n```",
      "created_at": "2026-02-12T20:20:40Z",
      "updated_at": "2026-02-12T21:01:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800890119",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800890119"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 164,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800913416",
      "pull_request_review_id": 3793381996,
      "id": 2800913416,
      "node_id": "PRRC_kwDOABII586m8owI",
      "diff_hunk": "@@ -276,7 +276,12 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             req->WriteReply(HTTP_INTERNAL_SERVER_ERROR, err_msg);\n         };\n \n-        [[maybe_unused]] auto _{g_threadpool_http.Submit(std::move(item))};\n+        if (auto res = g_threadpool_http.Submit(std::move(item)); !res.has_value()) {\n+            LogWarning(\"Request rejected during server shutdown\");\n+            hreq->WriteReply(HTTP_SERVICE_UNAVAILABLE, \"Request rejected during server shutdown\");\n+            return;\n+        }\n+",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 28,
      "commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "meganit: Superfluous newline after `if`-block before end of outer block.\n\n```suggestion\n```",
      "created_at": "2026-02-12T20:26:58Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800913416",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800913416"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 284,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800934226",
      "pull_request_review_id": 3793381996,
      "id": 2800934226,
      "node_id": "PRRC_kwDOABII586m8t1S",
      "diff_hunk": "@@ -211,7 +211,7 @@ static void http_request_cb(struct evhttp_request* req, void* arg)\n             }\n         }\n     }\n-    auto hreq{std::make_unique<HTTPRequest>(req, *static_cast<const util::SignalInterrupt*>(arg))};\n+    auto hreq{std::make_shared<HTTPRequest>(req, *static_cast<const util::SignalInterrupt*>(arg))};",
      "path": "src/httpserver.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "remark: Was experimenting with having `ThreadPool::Submit()` take a \"task_creator\" lambda that only gets called when no error condition in `Submit` occurs, it would then return the inner lambda which would take ownership of the `unique_ptr` as on master. Even though I have a distaste for `shared_ptr`, your version is more elegant.",
      "created_at": "2026-02-12T20:32:36Z",
      "updated_at": "2026-02-12T21:01:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2800934226",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800934226"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 214,
      "original_line": 214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801004334",
      "pull_request_review_id": 3793381996,
      "id": 2801004334,
      "node_id": "PRRC_kwDOABII586m8-8u",
      "diff_hunk": "",
      "path": "src/test/fuzz/threadpool.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "original_commit_id": "241367d021d210f25e427e7bb35c676b293ff28a",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Commit message suggestion for 241367d021d210f25e427e7bb35c676b293ff28a:\r\n```diff\r\nthreadpool: make Submit return Expected instead of throwing\r\n\r\nUnlike exceptions, which can be ignored as they require extra try-catch\r\nblocks, returning expected errors forces callers to always handle\r\nsubmission failures.\r\n\r\n+ Not throwing an exception also happens to fix unclean shutdown bug\r\n+ #34573 since we no longer throw when attempting to Submit() from http_request_cb().\r\n```",
      "created_at": "2026-02-12T20:51:06Z",
      "updated_at": "2026-02-12T21:02:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801004334",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801004334"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801017120",
      "pull_request_review_id": 3793381996,
      "id": 2801017120,
      "node_id": "PRRC_kwDOABII586m9CEg",
      "diff_hunk": "",
      "path": "src/httpserver.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "d6aa40edd23cdd8f3b49cf82ca8a79553fde9c75",
      "original_commit_id": "5326821cbffbef388421af082d43c7bc6bcc48f7",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Commit message suggestion for 5326821cbffbef388421af082d43c7bc6bcc48f7:\r\n\r\nGiven that I think the unclean shutdown is already fixed in the first commit by using `util::Expected` instead of throwing exceptions, I think this is somewhat more correct for the second:\r\n```\r\nhttp: properly respond to HTTP request during shutdown\r\n\r\nMakes sure we respond to the client as the HTTP request attempts to submit a task to\r\nthe threadpool during server shutdown.\r\n\r\nRoughly what happens:\r\n\r\n1) The server receives an HTTP request and starts calling http_request_cb().\r\n2) Meanwhile on another thread, shutdown is triggered which calls InterruptHTTPServer()\r\n   and unregisters http_request_cb() and interrupts the thread pool.\r\n3) The request (step 1) resumes and tries to submit a task\r\n   to the now-interrupted server.\r\n\r\nThis fix detects failed submissions immediately, and the server\r\nresponds with HTTP_SERVICE_UNAVAILABLE.\r\n```\r\nI don't think it's necessary to classify this as a race condition. I guess it depends on how you define it.",
      "created_at": "2026-02-12T20:54:37Z",
      "updated_at": "2026-02-12T21:02:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34577#discussion_r2801017120",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801017120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34577"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124",
    "id": 1652698484,
    "node_id": "PR_kwDOABII585igi10",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29124",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29124.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29124.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/bdcd435b48d4979751e6dd74cb996073721e5c9d",
    "number": 29124,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Automatically repair corrupted metadata with doubled derivation path",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "A bug in 0.21.x and 22.x resulted in some wallets storing invalid derivation paths that are the concatenation of two derivation paths. This corruption follows a rigid pattern and can be easily detected and repaired.\r\n\r\nThe bug that resulted in such wallets was fixed in #23304 but wallets that already ran into it would still have bad data stored. This PR should fix such wallets.\r\n\r\nFixes #29109",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2023-12-20T20:47:16Z",
    "updated_at": "2025-04-17T18:02:27Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "d3909cc3f81ec8ed3c4120f60e96668c2d931c66",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "achow101:fix-double-keypath",
      "ref": "fix-double-keypath",
      "sha": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 8,
        "stargazers_count": 41,
        "watchers_count": 41,
        "size": 293773,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-17T17:40:57Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2025-02-15T19:03:22Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b8cefeb221490868d62b7a0695f8b5ea392d3654",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37072,
        "stargazers_count": 82933,
        "watchers_count": 82933,
        "size": 279879,
        "default_branch": "master",
        "open_issues_count": 702,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-17T17:51:44Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-04-17T17:51:51Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 134,
    "deletions": 24,
    "changed_files": 3,
    "commits": 2,
    "review_comments": 41,
    "comments": 5
  },
  "events": [
    {
      "event": "commented",
      "id": 1865118295,
      "node_id": "IC_kwDOABII585vK3JX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1865118295",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T20:47:19Z",
      "updated_at": "2025-04-17T02:45:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/29124.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2760231054) |\n| Concept ACK | [murchandamus](https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2737699751) |\n| Stale ACK | [furszy](https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2194035447) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31250](https://github.com/bitcoin/bitcoin/pull/31250) (wallet: Disable creating and loading legacy wallets by achow101)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#issuecomment-1865118295",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124"
    },
    {
      "event": "labeled",
      "id": 11307298854,
      "node_id": "LE_lADOABII5856Q4PezwAAAAKh97Am",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11307298854",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T20:47:21Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11307315222,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAKh9_AW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11307315222",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "925ca2fd0051b14f7fb24fd9aee8bab6dd6caf66",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/925ca2fd0051b14f7fb24fd9aee8bab6dd6caf66",
      "created_at": "2023-12-20T20:49:06Z"
    },
    {
      "event": "labeled",
      "id": 11307619445,
      "node_id": "LE_lADOABII5856Q4PezwAAAAKh_JR1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11307619445",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T21:25:07Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11307826367,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAKh_7y_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11307826367",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "0b54aab6b9e4234dad7dfaa7d0dbabd5e43e5cd3",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/0b54aab6b9e4234dad7dfaa7d0dbabd5e43e5cd3",
      "created_at": "2023-12-20T21:51:56Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11317318921,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAKikJUJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11317318921",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ac3170ecbf909bb557d9557a403ad4527ba247df",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/ac3170ecbf909bb557d9557a403ad4527ba247df",
      "created_at": "2023-12-21T16:05:51Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11317616481,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAKilR9h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11317616481",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c4c65cc0fe88a7e3a3bb4a51f33c362f34468c73",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/c4c65cc0fe88a7e3a3bb4a51f33c362f34468c73",
      "created_at": "2023-12-21T16:33:18Z"
    },
    {
      "event": "unlabeled",
      "id": 11318145590,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAKinTI2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11318145590",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-21T17:22:26Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 11491444496,
      "node_id": "LE_lADOABII5856Q4PezwAAAAKs8YcQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11491444496",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-15T19:08:55Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2039161257,
      "node_id": "IC_kwDOABII5855iyGp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2039161257",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-05T07:42:15Z",
      "updated_at": "2024-04-05T07:42:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Could rebase for fresh CI, if still relevant?",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#issuecomment-2039161257",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12375899835,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAALhqT67",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12375899835",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "078c2d74c2779dd459e42daf67ab450fbf223506",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/078c2d74c2779dd459e42daf67ab450fbf223506",
      "created_at": "2024-04-05T15:18:35Z"
    },
    {
      "event": "unlabeled",
      "id": 12378333592,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAALhzmGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12378333592",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-05T19:10:14Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2071488793,
      "node_id": "PRR_kwDOABII5857eGkZ",
      "url": null,
      "actor": null,
      "commit_id": "078c2d74c2779dd459e42daf67ab450fbf223506",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 078c2d74c2779dd459e42daf67ab450fbf223506. Nothing blocking, just tiny nits.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2071488793",
      "submitted_at": "2024-05-22T14:54:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13043076054,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAMJbYvW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13043076054",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9f1f899ac0c7d334ada11f335286faf74dd8c582",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/9f1f899ac0c7d334ada11f335286faf74dd8c582",
      "created_at": "2024-06-04T23:54:34Z"
    },
    {
      "event": "labeled",
      "id": 13044505500,
      "node_id": "LE_lADOABII5856Q4PezwAAAAMJg1uc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13044505500",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-05T03:21:17Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2148780714,
      "node_id": "IC_kwDOABII586AE8qq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2148780714",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-05T03:21:18Z",
      "updated_at": "2024-06-05T03:21:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/25814613888</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#issuecomment-2148780714",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13044539322,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAMJg9-6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13044539322",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9db2d8b3a07c55563f5d579cdf6fba91d0ca5e68",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/9db2d8b3a07c55563f5d579cdf6fba91d0ca5e68",
      "created_at": "2024-06-05T03:28:16Z"
    },
    {
      "event": "reviewed",
      "id": 2099269310,
      "node_id": "PRR_kwDOABII5859IE6-",
      "url": null,
      "actor": null,
      "commit_id": "9db2d8b3a07c55563f5d579cdf6fba91d0ca5e68",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 9db2d8b",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2099269310",
      "submitted_at": "2024-06-05T13:50:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "unlabeled",
      "id": 13068261272,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAMK7deY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13068261272",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-06T15:01:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 13474539614,
      "node_id": "LE_lADOABII5856Q4PezwAAAAMjJShe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13474539614",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T16:40:25Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13606926903,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAMrCTo3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13606926903",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1c3462e908994f0d63c1f39b5908f48d083dd10e",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/1c3462e908994f0d63c1f39b5908f48d083dd10e",
      "created_at": "2024-07-22T21:13:01Z"
    },
    {
      "event": "unlabeled",
      "id": 13606956795,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAMrCa77",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13606956795",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-22T21:16:29Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2194035447,
      "node_id": "PRR_kwDOABII586CxlL3",
      "url": null,
      "actor": null,
      "commit_id": "1c3462e908994f0d63c1f39b5908f48d083dd10e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 1c3462e908994f0d63c1f39b5908f48d083dd10e\r\n\r\nCould minimize the first commit diff https://github.com/furszy/bitcoin-core/commit/145737e46e71859608334ab738817f7b323df367.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2194035447",
      "submitted_at": "2024-07-23T13:42:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "labeled",
      "id": 14155281998,
      "node_id": "LE_lADOABII5856Q4PezwAAAANLuHZO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14155281998",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-06T02:02:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14205047218,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAANOr9Gy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14205047218",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "66b851d7f28c2b914fc7a8d96c0ccd24dc4bc854",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/66b851d7f28c2b914fc7a8d96c0ccd24dc4bc854",
      "created_at": "2024-09-10T20:02:05Z"
    },
    {
      "event": "unlabeled",
      "id": 14214100157,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAANPOfS9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14214100157",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-11T11:00:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "review_requested",
      "id": 14660351474,
      "node_id": "RRE_lADOABII5856Q4PezwAAAANp0zXy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14660351474",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-15T15:53:33Z",
      "requested_reviewer": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 2414410272,
      "node_id": "IC_kwDOABII586P6Pog",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2414410272",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-15T15:53:41Z",
      "updated_at": "2024-10-15T15:53:41Z",
      "author_association": "MEMBER",
      "body": "cc @davidgumberg ",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#issuecomment-2414410272",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124"
    },
    {
      "event": "mentioned",
      "id": 14660353925,
      "node_id": "MEE_lADOABII5856Q4PezwAAAANp0z-F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14660353925",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-15T15:53:43Z"
    },
    {
      "event": "subscribed",
      "id": 14660353941,
      "node_id": "SE_lADOABII5856Q4PezwAAAANp0z-V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14660353941",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-15T15:53:43Z"
    },
    {
      "event": "labeled",
      "id": 14751236619,
      "node_id": "LE_lADOABII5856Q4PezwAAAANvPgIL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14751236619",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-20T14:03:41Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 14856690131,
      "node_id": "LE_lADOABII5856Q4PezwAAAAN1hxnT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14856690131",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-24T18:22:01Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14859535886,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAN1soYO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14859535886",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "created_at": "2024-10-24T22:36:16Z"
    },
    {
      "event": "unlabeled",
      "id": 14859587397,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAN1s09F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14859587397",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-24T22:44:50Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14860237642,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAN1vTtK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14860237642",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-25T00:41:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2589566638,
      "node_id": "PRR_kwDOABII586aWaau",
      "url": null,
      "actor": null,
      "commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Build and tests successful at e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc\r\nSome initial comments, will give it another pass again.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2589566638",
      "submitted_at": "2025-02-03T11:58:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "reviewed",
      "id": 2592149096,
      "node_id": "PRR_kwDOABII586agQ5o",
      "url": null,
      "actor": null,
      "commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc\r\n\r\nThanks for this PR, I enjoyed reviewing it. I ran the tests and debugged the compatibility test.\r\n\r\nCan / Will this also be back-ported to the affected version or is the affected version too far back to be back-ported into?",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2592149096",
      "submitted_at": "2025-02-04T10:53:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "review_requested",
      "id": 16176266552,
      "node_id": "RRE_lADOABII5856Q4PezwAAAAPELj04",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16176266552",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T10:53:13Z",
      "requested_reviewer": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16253953283,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAPIz6UD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16253953283",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "2bf3c0b31b1a1626549115e72d073009fec4b60b",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/2bf3c0b31b1a1626549115e72d073009fec4b60b",
      "created_at": "2025-02-10T20:01:26Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16253963782,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAPIz84G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16253963782",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "6d2fa25a15364a2ea46762bc0737f23d78768858",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/6d2fa25a15364a2ea46762bc0737f23d78768858",
      "created_at": "2025-02-10T20:02:20Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16256257121,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAPI8sxh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16256257121",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "created_at": "2025-02-10T22:48:39Z"
    },
    {
      "event": "commented",
      "id": 2649431826,
      "node_id": "IC_kwDOABII586d6x8S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2649431826",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-10T22:48:56Z",
      "updated_at": "2025-02-10T22:48:56Z",
      "author_association": "MEMBER",
      "body": "Updated this to work even after the legacy wallet is deleted.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#issuecomment-2649431826",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29124"
    },
    {
      "event": "reviewed",
      "id": 2611618216,
      "node_id": "PRR_kwDOABII586bqiGo",
      "url": null,
      "actor": null,
      "commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "reACK 78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421\r\n\r\nI reviewed the range diff.\r\n```\r\ngit range-diff e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc...78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421\r\n```\r\n\r\nNewer changes are related to using the constant `LAST_KEYPOOL_INDEX` as suggested and use `migratewallet` instead of `restorewallet` due to which the format of `good_deriv_path` is changed from `'` to 'h'. Using `migratewallet` is fine because it also ends up calling `LoadLegacyWalletRecords` internally where the bug fix lies, and additionally it also ensures the fix works for the newer wallets. ",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2611618216",
      "submitted_at": "2025-02-13T08:52:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "reviewed",
      "id": 2737699751,
      "node_id": "PRR_kwDOABII586jLfun",
      "url": null,
      "actor": null,
      "commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2737699751",
      "submitted_at": "2025-04-02T22:17:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "reviewed",
      "id": 2746902572,
      "node_id": "PRR_kwDOABII586jumgs",
      "url": null,
      "actor": null,
      "commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2746902572",
      "submitted_at": "2025-04-07T14:07:20Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "labeled",
      "id": 17197957078,
      "node_id": "LE_lADOABII5856Q4PezwAAAAQBE__W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17197957078",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-10T01:28:41Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17198902292,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAQBImwU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17198902292",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b81b1ab1ce5a0631cf9ecb6a43b98e7d0d8de8bf",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/b81b1ab1ce5a0631cf9ecb6a43b98e7d0d8de8bf",
      "created_at": "2025-04-10T03:58:13Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17198923263,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAQBIr3_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17198923263",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "85e758134aed6ca1c5a7937582d136de8072e864",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/85e758134aed6ca1c5a7937582d136de8072e864",
      "created_at": "2025-04-10T04:01:19Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFmY2UxNDFjMTc0ZGYxZDA3ZmI3MzU3YzNiMTgxZjYwYmE2ZWJjMWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/afce141c174df1d07fb7357c3b181f60ba6ebc1f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/afce141c174df1d07fb7357c3b181f60ba6ebc1f",
      "tree": {
        "sha": "c8944b2b47900926d3e4e75fa288989468c6e853",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c8944b2b47900926d3e4e75fa288989468c6e853"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b8cefeb221490868d62b7a0695f8b5ea392d3654",
          "sha": "b8cefeb221490868d62b7a0695f8b5ea392d3654",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b8cefeb221490868d62b7a0695f8b5ea392d3654"
        }
      ],
      "message": "walletdb: Repair corrupted doubled derivation paths\n\nA bug in 0.21.x and 22.x resulted in some wallets having invalid\nderivation paths that are the concatenation of two derivation paths.\nThis corruption follows a rigid pattern and can be easily detected and\nrepaired.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-04-10T04:02:22Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2023-12-20T20:44:13Z"
      },
      "sha": "afce141c174df1d07fb7357c3b181f60ba6ebc1f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17198931282,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAQBIt1S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17198931282",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "13efc2db1524ab4074952e793fcff832c7641663",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/13efc2db1524ab4074952e793fcff832c7641663",
      "created_at": "2025-04-10T04:02:28Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJkY2Q0MzViNDhkNDk3OTc1MWU2ZGQ3NGNiOTk2MDczNzIxZTVjOWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "tree": {
        "sha": "e143e654878f2644d48f1efc046742fb89a89f42",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e143e654878f2644d48f1efc046742fb89a89f42"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/afce141c174df1d07fb7357c3b181f60ba6ebc1f",
          "sha": "afce141c174df1d07fb7357c3b181f60ba6ebc1f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/afce141c174df1d07fb7357c3b181f60ba6ebc1f"
        }
      ],
      "message": "tests: Test that bad inactive chain derivation path is cleaned up",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-04-10T04:12:18Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2023-12-20T19:08:57Z"
      },
      "sha": "bdcd435b48d4979751e6dd74cb996073721e5c9d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17198994090,
      "node_id": "HRFPE_lADOABII5856Q4PezwAAAAQBI9Kq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17198994090",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "commit_url": "https://api.github.com/repos/achow101/bitcoin/commits/bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "created_at": "2025-04-10T04:12:28Z"
    },
    {
      "event": "unlabeled",
      "id": 17199690311,
      "node_id": "UNLE_lADOABII5856Q4PezwAAAAQBLnJH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17199690311",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-10T05:39:35Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2760231054,
      "node_id": "PRR_kwDOABII586khciO",
      "url": null,
      "actor": null,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK bdcd435b48d4979751e6dd74cb996073721e5c9d\r\n\r\nBuild and functional tests good, I left few clarification nits if you end up retouching.\r\n\r\nThe main change detects bad derivation paths when loading the metadata within legacy wallet records, updates the metadata in the legacy SPKM, and then writes the updated metadata in the DB. \r\n\r\n> git range-diff 78cb0df...bdcd435\r\n\r\nNewer changes are improving the bad derivation path detection inline comments that makes it easier to follow by appearing consistent with the code right below, reusing `LAST_KEYPOOL_INDEX` in the node setup of the functional test and rebase changes - using `HasLegacyRecords()`, using an updated functional test node count.\r\n\r\nThe addition of the detection of the bad derivation path in the `LoadFunc` is slightly distracting when I read the `LoadLegacyWalletRecords()` as a whole but I have not suggested changes because this is legacy wallet and intended to be used less now. \r\n\r\nThe comprehensive functional test covers the buggy scenario along with its resolution. Also, the original issue #29109 is resolved for the user after using this fix that gives more confidence as well.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2760231054",
      "submitted_at": "2025-04-11T13:44:30Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "review_requested",
      "id": 17224184486,
      "node_id": "RRE_lADOABII5856Q4PezwAAAAQCpDKm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17224184486",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-11T13:44:35Z",
      "requested_reviewer": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2775988164,
      "node_id": "PRR_kwDOABII586ldjfE",
      "url": null,
      "actor": null,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#pullrequestreview-2775988164",
      "submitted_at": "2025-04-17T16:03:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
    },
    {
      "event": "review_requested",
      "id": 17308624050,
      "node_id": "RRE_lADOABII5856Q4PezwAAAAQHrKSy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17308624050",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T16:03:09Z",
      "requested_reviewer": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610125269",
      "pull_request_review_id": 2071488793,
      "id": 1610125269,
      "node_id": "PRRC_kwDOABII585f-I_V",
      "diff_hunk": "@@ -669,10 +688,23 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyScriptPubKeyMan()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (updated_metas.size()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: `!updated_metas.empty()`",
      "created_at": "2024-05-22T14:40:45Z",
      "updated_at": "2024-05-22T14:54:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1610125269",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610125269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 699,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610134627",
      "pull_request_review_id": 2071488793,
      "id": 1610134627,
      "node_id": "PRRC_kwDOABII585f-LRj",
      "diff_hunk": "@@ -527,7 +527,7 @@ static LoadResult LoadRecords(CWallet* pwallet, DatabaseBatch& batch, const std:\n     return LoadRecords(pwallet, batch, key, prefix, load_func);\n }\n \n-static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, WalletBatch& w_batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Non-blocking because it is the only way now but it is kinda unnatural to provide `batch` and `w_batch` when `w_batch` contains the `batch` object.",
      "created_at": "2024-05-22T14:46:08Z",
      "updated_at": "2024-05-22T14:54:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1610134627",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610134627"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 530,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610135840",
      "pull_request_review_id": 2071488793,
      "id": 1610135840,
      "node_id": "PRRC_kwDOABII585f-Lkg",
      "diff_hunk": "@@ -669,10 +688,23 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyScriptPubKeyMan()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (updated_metas.size()) {\n+        LegacyScriptPubKeyMan* spkm = pwallet->GetLegacyScriptPubKeyMan();\n+        Assert(spkm);\n+        LOCK(spkm->cs_KeyStore);\n+        for (const auto& pubkey : updated_metas) {\n+            w_batch.WriteKeyMetadata(spkm->mapKeyMetadata.at(pubkey.GetID()), pubkey, true);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 82,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: should check `WriteKeyMetadata` return value.",
      "created_at": "2024-05-22T14:46:52Z",
      "updated_at": "2024-05-22T14:54:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1610135840",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610135840"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 704,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626757956",
      "pull_request_review_id": 2097598480,
      "id": 1626757956,
      "node_id": "PRRC_kwDOABII585g9ltE",
      "diff_hunk": "@@ -669,10 +688,23 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyScriptPubKeyMan()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (updated_metas.size()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 77,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": 1610125269,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2024-06-04T23:54:46Z",
      "updated_at": "2024-06-04T23:54:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1626757956",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626757956"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 699,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626758407",
      "pull_request_review_id": 2097599015,
      "id": 1626758407,
      "node_id": "PRRC_kwDOABII585g9l0H",
      "diff_hunk": "@@ -527,7 +527,7 @@ static LoadResult LoadRecords(CWallet* pwallet, DatabaseBatch& batch, const std:\n     return LoadRecords(pwallet, batch, key, prefix, load_func);\n }\n \n-static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, WalletBatch& w_batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": 1610134627,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I've made `m_batch` public so that we can just pass the `WalletBatch` but still use the underlying batch object. However I'm not sure if that's something we want to do in the long term, but I think it should be okay.",
      "created_at": "2024-06-04T23:55:25Z",
      "updated_at": "2024-06-04T23:56:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1626758407",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626758407"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 530,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626758476",
      "pull_request_review_id": 2097599115,
      "id": 1626758476,
      "node_id": "PRRC_kwDOABII585g9l1M",
      "diff_hunk": "@@ -669,10 +688,23 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyScriptPubKeyMan()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (updated_metas.size()) {\n+        LegacyScriptPubKeyMan* spkm = pwallet->GetLegacyScriptPubKeyMan();\n+        Assert(spkm);\n+        LOCK(spkm->cs_KeyStore);\n+        for (const auto& pubkey : updated_metas) {\n+            w_batch.WriteKeyMetadata(spkm->mapKeyMetadata.at(pubkey.GetID()), pubkey, true);",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 82,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": 1610135840,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2024-06-04T23:55:32Z",
      "updated_at": "2024-06-04T23:55:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1626758476",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1626758476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 704,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1627825496",
      "pull_request_review_id": 2099269310,
      "id": 1627825496,
      "node_id": "PRRC_kwDOABII585hBqVY",
      "diff_hunk": "@@ -527,7 +527,7 @@ static LoadResult LoadRecords(CWallet* pwallet, DatabaseBatch& batch, const std:\n     return LoadRecords(pwallet, batch, key, prefix, load_func);\n }\n \n-static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)\n+static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch, WalletBatch& w_batch, int last_client) EXCLUSIVE_LOCKS_REQUIRED(pwallet->cs_wallet)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "627216a174f23f37338c86ec9890d1393fd6dc18",
      "in_reply_to_id": 1610134627,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I've made `m_batch` public so that we can just pass the `WalletBatch` but still use the underlying batch object. However I'm not sure if that's something we want to do in the long term, but I think it should be okay.\r\n\r\nYeah.. I'm not happy reading all the the `batch.m_batch` usages neither but np.",
      "created_at": "2024-06-05T13:49:54Z",
      "updated_at": "2024-06-05T13:50:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1627825496",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1627825496"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 530,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939186315",
      "pull_request_review_id": 2589566638,
      "id": 1939186315,
      "node_id": "PRRC_kwDOABII585zlaKL",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 42,
      "original_position": 37,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "For others, reference: https://github.com/bitcoin/bitcoin/blob/28.x/src/wallet/rpc/wallet.cpp#L521",
      "created_at": "2025-02-03T10:58:18Z",
      "updated_at": "2025-02-03T11:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939186315",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939186315"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": 150,
      "original_start_line": 154,
      "start_side": "RIGHT",
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939203297",
      "pull_request_review_id": 2589566638,
      "id": 1939203297,
      "node_id": "PRRC_kwDOABII585zleTh",
      "diff_hunk": "@@ -629,13 +629,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "92f4ab6dd76564cd4b0bafe48c8f0055f87f3216",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I had been wondering why such a path can't occur besides this case, this comment in `DeriveNewChildKey` function answers it: https://github.com/bitcoin/bitcoin/blob/dbc450c1b59b24421ba93f3e21faa8c673c0df4c/src/wallet/scriptpubkeyman.cpp#L1129",
      "created_at": "2025-02-03T11:11:48Z",
      "updated_at": "2025-04-07T14:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939203297",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939203297"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 641,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 650,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939235210",
      "pull_request_review_id": 2589566638,
      "id": 1939235210,
      "node_id": "PRRC_kwDOABII585zlmGK",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 34,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I spent some time trying to understand why this one is picked here only to realise later that 9 is the last index at this chain because of keypool size set to 10 at the top of this test here: https://github.com/bitcoin/bitcoin/pull/29124/commits/e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc#diff-b5055a65809b46e2775f6e28aa6eb8171e3fcc7a535cce5687a548b9ff233669R44\r\n\r\nThis 9 and 10 can be tied to each other with a constant for better readability. ",
      "created_at": "2025-02-03T11:37:58Z",
      "updated_at": "2025-02-03T11:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939235210",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939235210"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939235575",
      "pull_request_review_id": 2589566638,
      "id": 1939235575,
      "node_id": "PRRC_kwDOABII585zlmL3",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 34,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can this happen for internal keychain as well?",
      "created_at": "2025-02-03T11:38:17Z",
      "updated_at": "2025-02-03T11:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939235575",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939235575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939237181",
      "pull_request_review_id": 2589566638,
      "id": 1939237181,
      "node_id": "PRRC_kwDOABII585zlmk9",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 51,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Similar tying to a constant here if possible.",
      "created_at": "2025-02-03T11:39:39Z",
      "updated_at": "2025-02-03T11:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939237181",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939237181"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939245322",
      "pull_request_review_id": 2589566638,
      "id": 1939245322,
      "node_id": "PRRC_kwDOABII585zlokK",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 40,
      "original_position": 35,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Reference for line format: https://github.com/bitcoin/bitcoin/blob/28.x/src/wallet/rpc/backup.cpp#L778-L802",
      "created_at": "2025-02-03T11:46:43Z",
      "updated_at": "2025-02-03T11:58:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1939245322",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1939245322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940759007",
      "pull_request_review_id": 2592149096,
      "id": 1940759007,
      "node_id": "PRRC_kwDOABII585zraHf",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 34,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": 1939235575,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, it can as per this comment in the issue: https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863241394\r\nThe cpp code condition covers it as well though.",
      "created_at": "2025-02-04T08:58:46Z",
      "updated_at": "2025-02-04T10:53:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1940759007",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940759007"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940811082",
      "pull_request_review_id": 2592149096,
      "id": 1940811082,
      "node_id": "PRRC_kwDOABII585zrm1K",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(12)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 67,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm realising that tying these constants up to the keypool size would make it easier to reason about this test.",
      "created_at": "2025-02-04T09:30:53Z",
      "updated_at": "2025-02-04T10:53:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1940811082",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940811082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 185,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940815278",
      "pull_request_review_id": 2592149096,
      "id": 1940815278,
      "node_id": "PRRC_kwDOABII585zrn2u",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(12)\n+        assert_equal(verify_wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)\n+\n+        # Load into master, the path should now be fixed\n+        backup_path = node_v22.wallets_path / f\"{wallet_name}.bak\"\n+        wallet.backupwallet(backup_path)\n+        with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"]):\n+            node_master.restorewallet(wallet_name, backup_path)\n+        wallet_master = node_master.get_wallet_rpc(wallet_name)\n+        assert_equal(wallet_master.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)\n+\n+        # Check persistence\n+        wallet_master.unloadwallet()\n+        with node_master.assert_debug_log(expected_msgs=[], unexpected_msgs=[\"Repairing derivation path for\"]):\n+            node_master.loadwallet(wallet_name)\n+        assert_equal(wallet_master.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 90,
      "original_position": 82,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nice touch testing for persistence by loading it again!",
      "created_at": "2025-02-04T09:33:11Z",
      "updated_at": "2025-02-04T10:53:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1940815278",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940815278"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": 195,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940933737",
      "pull_request_review_id": 2592149096,
      "id": 1940933737,
      "node_id": "PRRC_kwDOABII585zsExp",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(12)\n+        assert_equal(verify_wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)\n+\n+        # Load into master, the path should now be fixed\n+        backup_path = node_v22.wallets_path / f\"{wallet_name}.bak\"\n+        wallet.backupwallet(backup_path)\n+        with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"]):\n+            node_master.restorewallet(wallet_name, backup_path)\n+        wallet_master = node_master.get_wallet_rpc(wallet_name)\n+        assert_equal(wallet_master.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 84,
      "original_position": 76,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```\r\n'pubkey': '029edc63efe154f7f0da891f0def969b65cc4706893f8277580093eccbd09cb11d', 'ischange': True, 'timestamp': 1738665397, 'hdkeypath': \"m/0'/0'/10'\",\r\n```\r\n\r\nI found it a little weird that an external keychain address is categorised as change. I am assuming that internal keychain addresses are for changes.",
      "created_at": "2025-02-04T10:45:48Z",
      "updated_at": "2025-02-04T10:53:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1940933737",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940933737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940941450",
      "pull_request_review_id": 2592149096,
      "id": 1940941450,
      "node_id": "PRRC_kwDOABII585zsGqK",
      "diff_hunk": "@@ -302,8 +302,8 @@ class WalletBatch\n     //! Registers db txn callback functions\n     void RegisterTxnListener(const DbTxnListener& l);\n \n-private:\n     std::unique_ptr<DatabaseBatch> m_batch;\n+private:",
      "path": "src/wallet/walletdb.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "92f4ab6dd76564cd4b0bafe48c8f0055f87f3216",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit: This change and the corresponding function call updates can be the first commit followed by the actual repairing. But I can understand if it's a bit much for this PR given its limited focus area.",
      "created_at": "2025-02-04T10:50:29Z",
      "updated_at": "2025-02-04T10:53:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1940941450",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940941450"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": 306,
      "original_start_line": 305,
      "start_side": "LEFT",
      "line": 307,
      "original_line": 307,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949743176",
      "pull_request_review_id": 2606927638,
      "id": 1949743176,
      "node_id": "PRRC_kwDOABII5850NrhI",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(12)\n+        assert_equal(verify_wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)\n+\n+        # Load into master, the path should now be fixed\n+        backup_path = node_v22.wallets_path / f\"{wallet_name}.bak\"\n+        wallet.backupwallet(backup_path)\n+        with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"]):\n+            node_master.restorewallet(wallet_name, backup_path)\n+        wallet_master = node_master.get_wallet_rpc(wallet_name)\n+        assert_equal(wallet_master.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 84,
      "original_position": 76,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": 1940933737,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`ischange` does not actually look at the derivation path. Instead it looks at some heuristics which result in derived-but-not-yet-requested external addresses being identified as change.",
      "created_at": "2025-02-10T19:19:48Z",
      "updated_at": "2025-02-10T19:19:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1949743176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949743176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949743508",
      "pull_request_review_id": 2606928271,
      "id": 1949743508,
      "node_id": "PRRC_kwDOABII5850NrmU",
      "diff_hunk": "@@ -302,8 +302,8 @@ class WalletBatch\n     //! Registers db txn callback functions\n     void RegisterTxnListener(const DbTxnListener& l);\n \n-private:\n     std::unique_ptr<DatabaseBatch> m_batch;\n+private:",
      "path": "src/wallet/walletdb.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "92f4ab6dd76564cd4b0bafe48c8f0055f87f3216",
      "in_reply_to_id": 1940941450,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Going to leave this as is.",
      "created_at": "2025-02-10T19:20:08Z",
      "updated_at": "2025-02-10T19:20:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1949743508",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949743508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": 306,
      "original_start_line": 305,
      "start_side": "LEFT",
      "line": 307,
      "original_line": 307,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801025",
      "pull_request_review_id": 2607026571,
      "id": 1949801025,
      "node_id": "PRRC_kwDOABII5850N5pB",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 34,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": 1939235210,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added a constant.",
      "created_at": "2025-02-10T20:01:46Z",
      "updated_at": "2025-02-10T20:01:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1949801025",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801025"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801147",
      "pull_request_review_id": 2607026785,
      "id": 1949801147,
      "node_id": "PRRC_kwDOABII5850N5q7",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 51,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": 1939237181,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-02-10T20:01:54Z",
      "updated_at": "2025-02-10T20:01:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1949801147",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801147"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801345",
      "pull_request_review_id": 2607027095,
      "id": 1949801345,
      "node_id": "PRRC_kwDOABII5850N5uB",
      "diff_hunk": "@@ -128,6 +128,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        if self.options.descriptors:\n+            return\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if \"hdkeypath=m/0'/0'/9'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = \"m/0'/0'/9'/0'/0'/10'\"\n+        good_deriv_path = \"m/0'/0'/10'\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(12)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 67,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "e92dc1a3d36be02a8b16eed26159a43cfbe3dbcc",
      "in_reply_to_id": 1940811082,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-02-10T20:02:03Z",
      "updated_at": "2025-02-10T20:02:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1949801345",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1949801345"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 185,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1952466689",
      "pull_request_review_id": 2611618216,
      "id": 1952466689,
      "node_id": "PRRC_kwDOABII5850YEcB",
      "diff_hunk": "@@ -41,7 +41,7 @@ def set_test_params(self):\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v25.0\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v24.0.1\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v23.0\n-            [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v22.0\n+            [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\", \"-keypool=10\"], # v22.0",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 5,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I had in mind tying this 10 to the constant as well. Consider if you end up retouching, otherwise it's fine.",
      "created_at": "2025-02-12T11:26:16Z",
      "updated_at": "2025-02-13T08:52:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1952466689",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1952466689"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 44,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1954042039",
      "pull_request_review_id": 2611618216,
      "id": 1954042039,
      "node_id": "PRRC_kwDOABII5850eFC3",
      "diff_hunk": "@@ -128,6 +128,79 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        LAST_KEYPOOL_INDEX = 9 # Index of the last derived address with the keypool size of 10\n+\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 6]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath=m/0'/0'/{LAST_KEYPOOL_INDEX}'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = f\"m/0'/0'/{LAST_KEYPOOL_INDEX}'/0'/0'/{LAST_KEYPOOL_INDEX + 1}'\"\n+        good_deriv_path = f\"m/0h/0h/{LAST_KEYPOOL_INDEX + 1}h\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(LAST_KEYPOOL_INDEX + 2)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 72,
      "original_position": 66,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This was using 12 earlier, now 11. Fine since the test passes.",
      "created_at": "2025-02-13T08:30:04Z",
      "updated_at": "2025-02-13T08:52:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r1954042039",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1954042039"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 181,
      "original_line": 181,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2025665964",
      "pull_request_review_id": 2737699751,
      "id": 2025665964,
      "node_id": "PRRC_kwDOABII5854vTWs",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Isnâ€™t the line 648 in contradiction with line 649?\r\n\r\nLooking at https://github.com/bitcoin/bitcoin/issues/29109, Iâ€™m thinking that the indices are referring to the elements separated by \"/\" after \"m\" of the hdkeypath variable here.\r\n\r\n```diff\r\n-[..] hdkeypath=m/0'/0'/299'/0'/0'/300'\r\n+[..] hdkeypath=m/0'/0'/300'\r\n```\r\n\r\nI am wondering whether this should be:\r\n\r\n```suggestion\r\n                    // - path[5] == path[2] + 1\r\n                    // - path[0:1] == path[3:4]\r\n```",
      "created_at": "2025-04-02T22:05:35Z",
      "updated_at": "2025-04-02T22:17:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2025665964",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2025665964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2025670416",
      "pull_request_review_id": 2737699751,
      "id": 2025670416,
      "node_id": "PRRC_kwDOABII5854vUcQ",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If we only have six indexes, should this perhaps be path[3:5]?\r\n\r\n```suggestion\r\n                    // - path[3:5] matches hdKeypath\r\n```",
      "created_at": "2025-04-02T22:10:45Z",
      "updated_at": "2025-04-02T22:17:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2025670416",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2025670416"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 650,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2029073684",
      "pull_request_review_id": 2743500828,
      "id": 2029073684,
      "node_id": "PRRC_kwDOABII58548TUU",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": 2025665964,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Oh, are these ranges meant to be exclusive of the second parameter?",
      "created_at": "2025-04-04T15:54:32Z",
      "updated_at": "2025-04-04T15:54:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2029073684",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2029073684"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031289046",
      "pull_request_review_id": 2746902572,
      "id": 2031289046,
      "node_id": "PRRC_kwDOABII5855EwLW",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": 2025665964,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, I believe from the comments standpoint, they are exclusive of the second parameter, which is quite confusing now that I re-read this diff after some time, the code below used hard-coded indices that are inclusive of the second parameter (except in case of `end()`).\r\n\r\nConsistency between code and comments would make it easier to read.",
      "created_at": "2025-04-07T13:48:43Z",
      "updated_at": "2025-04-07T14:07:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2031289046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031289046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031320059",
      "pull_request_review_id": 2746902572,
      "id": 2031320059,
      "node_id": "PRRC_kwDOABII5855E3v7",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath\n+                    if (keyMeta.key_origin.path.size() == 6\n+                        && keyMeta.key_origin.path[5] == keyMeta.key_origin.path[2] + 1\n+                        && keyMeta.key_origin.path[0] == keyMeta.key_origin.path[3]\n+                        && keyMeta.key_origin.path[1] == keyMeta.key_origin.path[4]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Before suggesting, I checked whether this function is going to stick around after the legacy wallet removal but after taking a cursory look at https://github.com/bitcoin/bitcoin/pull/28710, I see it will.\r\n\r\nIn which case, I feel going at these checks in order would be slightly easier on the eyes. Might be nitty but easier for me at least.\r\n\r\n```diff\r\n-                        && keyMeta.key_origin.path[5] == keyMeta.key_origin.path[2] + 1\r\n-                        && keyMeta.key_origin.path[0] == keyMeta.key_origin.path[3]\r\n-                        && keyMeta.key_origin.path[1] == keyMeta.key_origin.path[4]\r\n+                        && keyMeta.key_origin.path[3] == keyMeta.key_origin.path[0]\r\n+                        && keyMeta.key_origin.path[4] == keyMeta.key_origin.path[1]\r\n+                        && keyMeta.key_origin.path[5] == keyMeta.key_origin.path[2] + 1\r\n```",
      "created_at": "2025-04-07T14:01:44Z",
      "updated_at": "2025-04-07T14:07:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2031320059",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031320059"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 652,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 654,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031330122",
      "pull_request_review_id": 2746902572,
      "id": 2031330122,
      "node_id": "PRRC_kwDOABII5855E6NK",
      "diff_hunk": "@@ -629,13 +629,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "92f4ab6dd76564cd4b0bafe48c8f0055f87f3216",
      "in_reply_to_id": 1939203297,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Could be helpful to add a comment here either referring it or copy-pasting the linked comment.",
      "created_at": "2025-04-07T14:06:51Z",
      "updated_at": "2025-04-07T14:07:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2031330122",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2031330122"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 641,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 650,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036445669",
      "pull_request_review_id": 2755246510,
      "id": 2036445669,
      "node_id": "PRRC_kwDOABII5855YbHl",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": 2025665964,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, it is pythonic",
      "created_at": "2025-04-10T03:46:09Z",
      "updated_at": "2025-04-10T03:46:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2036445669",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036445669"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036453923",
      "pull_request_review_id": 2755258770,
      "id": 2036453923,
      "node_id": "PRRC_kwDOABII5855YdIj",
      "diff_hunk": "@@ -629,13 +629,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "92f4ab6dd76564cd4b0bafe48c8f0055f87f3216",
      "in_reply_to_id": 1939203297,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Expanded the comment a little bit.",
      "created_at": "2025-04-10T03:58:38Z",
      "updated_at": "2025-04-10T03:58:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2036453923",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036453923"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 641,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 650,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454062",
      "pull_request_review_id": 2755258960,
      "id": 2036454062,
      "node_id": "PRRC_kwDOABII5855YdKu",
      "diff_hunk": "@@ -41,7 +41,7 @@ def set_test_params(self):\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v25.0\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v24.0.1\n             [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v23.0\n-            [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\"], # v22.0\n+            [\"-nowallet\", \"-walletrbf=1\", \"-addresstype=bech32\", \"-whitelist=noban@127.0.0.1\", \"-keypool=10\"], # v22.0",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": null,
      "original_position": 5,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "78cb0df4d5b9cc30dbe60a6cf24ab6cac5d3f421",
      "in_reply_to_id": 1952466689,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-04-10T03:58:51Z",
      "updated_at": "2025-04-10T03:58:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2036454062",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454062"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 44,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454293",
      "pull_request_review_id": 2755259267,
      "id": 2036454293,
      "node_id": "PRRC_kwDOABII5855YdOV",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 91,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": 2025665964,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Changed as suggested. Also added a bit more of an explainer to the comment that should make it clearer.",
      "created_at": "2025-04-10T03:59:13Z",
      "updated_at": "2025-04-10T03:59:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2036454293",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454293"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454393",
      "pull_request_review_id": 2755259380,
      "id": 2036454393,
      "node_id": "PRRC_kwDOABII5855YdP5",
      "diff_hunk": "@@ -634,13 +634,32 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n             uint32_t index = 0;\n             if (keyMeta.hdKeypath != \"s\" && keyMeta.hdKeypath != \"m\") {\n                 std::vector<uint32_t> path;\n-                if (keyMeta.has_key_origin) {\n-                    // We have a key origin, so pull it from its path vector\n-                    path = keyMeta.key_origin.path;\n-                } else {\n-                    // No key origin, have to parse the string\n-                    if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n-                        strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                // Always parse the path string\n+                if (!ParseHDKeypath(keyMeta.hdKeypath, path)) {\n+                    strErr = \"Error reading wallet database: keymeta with invalid HD keypath\";\n+                    return DBErrors::NONCRITICAL_ERROR;\n+                }\n+                // If there is a key origin, make sure that path matches\n+                if (keyMeta.has_key_origin && path != keyMeta.key_origin.path) {\n+                    // Detect if this metadata has a bad derivation path from a bug in inactive hd key derivation that was present in 0.21 and 22.x\n+                    // See https://github.com/bitcoin/bitcoin/issues/29109\n+                    // Markers for bad derivation:\n+                    // - 6 indexes\n+                    // - path[5] == path[2] + 1\n+                    // - path[0:2] == path[3:5]\n+                    // - path[3:6] matches hdKeypath\n+                    if (keyMeta.key_origin.path.size() == 6\n+                        && keyMeta.key_origin.path[5] == keyMeta.key_origin.path[2] + 1\n+                        && keyMeta.key_origin.path[0] == keyMeta.key_origin.path[3]\n+                        && keyMeta.key_origin.path[1] == keyMeta.key_origin.path[4]",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "2eaa7e2de65227895d32639ec8e99bf6597b5cb6",
      "in_reply_to_id": 2031320059,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-04-10T03:59:21Z",
      "updated_at": "2025-04-10T03:59:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2036454393",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036454393"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": 652,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 654,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039486932",
      "pull_request_review_id": 2760231054,
      "id": 2039486932,
      "node_id": "PRRC_kwDOABII5855kBnU",
      "diff_hunk": "@@ -126,6 +127,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 5]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath=m/0'/0'/{LAST_KEYPOOL_INDEX}'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = f\"m/0'/0'/{LAST_KEYPOOL_INDEX}'/0'/0'/{LAST_KEYPOOL_INDEX + 1}'\"\n+        good_deriv_path = f\"m/0h/0h/{LAST_KEYPOOL_INDEX + 1}h\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\n+        node_v22.createwallet(wallet_name=\"path_verify\", descriptors=False, blank=True)\n+        verify_wallet = node_v22.get_wallet_rpc(\"path_verify\")\n+        verify_wallet.sethdseed(True, seed)\n+        # Bad addr is after keypool, so need to generate it by refilling\n+        verify_wallet.keypoolrefill(LAST_KEYPOOL_INDEX + 2)\n+        assert_equal(verify_wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], good_deriv_path.replace(\"h\", \"'\"))\n+\n+        # Load into master, the path should now be fixed\n+        backup_path = node_v22.wallets_path / f\"{wallet_name}.bak\"\n+        wallet.backupwallet(backup_path)\n+        wallet_dir_master = os.path.join(node_master.wallets_path, wallet_name)\n+        os.makedirs(wallet_dir_master, exist_ok=True)\n+        shutil.copy(backup_path, os.path.join(wallet_dir_master, \"wallet.dat\"))\n+        with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"]):",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 81,
      "original_position": 81,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit if you end up retouching:\r\n\r\n```diff\r\n- with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"]):\r\n+ with node_master.assert_debug_log(expected_msgs=[\"Repairing derivation path for\"], unexpected_msgs=[\"Unable to write repaired keymeta for\"]):\r\n```",
      "created_at": "2025-04-11T12:36:58Z",
      "updated_at": "2025-04-11T13:44:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2039486932",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039486932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 190,
      "original_line": 190,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039559544",
      "pull_request_review_id": 2760231054,
      "id": 2039559544,
      "node_id": "PRRC_kwDOABII5855kTV4",
      "diff_hunk": "@@ -126,6 +127,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 5]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 30,
      "original_position": 30,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit if retouched:\r\n\r\n```diff\r\n- wallet = node_v22.get_wallet_rpc(wallet_name)\r\n+ bad_deriv_wallet = node_v22.get_wallet_rpc(wallet_name)\r\n```\r\n\r\nFor easy identification because this wallet is used across the whole test where other wallets are also created later down.",
      "created_at": "2025-04-11T13:23:14Z",
      "updated_at": "2025-04-11T13:44:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2039559544",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039559544"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 139,
      "original_line": 139,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039560557",
      "pull_request_review_id": 2760231054,
      "id": 2039560557,
      "node_id": "PRRC_kwDOABII5855kTlt",
      "diff_hunk": "@@ -126,6 +127,77 @@ def test_v19_addmultisigaddress(self):\n         wallet = node_v19.get_wallet_rpc(\"w1_v19\")\n         assert wallet.getaddressinfo(address_18075)[\"solvable\"]\n \n+\n+    def test_v22_inactivehdchain_path(self):\n+        self.log.info(\"Testing inactive hd chain bad derivation path cleanup\")\n+        # 0.21.x and 22.x would both produce bad derivation paths when topping up an inactive hd chain\n+        # Make sure that this is being detected and automatically cleaned up\n+        node_master = self.nodes[1]\n+        node_v22 = self.nodes[self.num_nodes - 5]\n+        wallet_name = \"bad_deriv_path\"\n+        node_v22.createwallet(wallet_name=wallet_name, descriptors=False)\n+        wallet = node_v22.get_wallet_rpc(wallet_name)\n+\n+        # Make a dump of the wallet to get an unused address\n+        dump_path = node_v22.wallets_path / f\"{wallet_name}.dump\"\n+        wallet.dumpwallet(dump_path)\n+        addr = None\n+        seed = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath=m/0'/0'/{LAST_KEYPOOL_INDEX}'\" in line:\n+                    addr = line.split(\" \")[4].split(\"=\")[1]\n+                elif \" hdseed=1 \" in line:\n+                    seed = line.split(\" \")[0]\n+        assert addr is not None\n+        assert seed is not None\n+        # Rotate seed and unload\n+        wallet.sethdseed()\n+        wallet.unloadwallet()\n+        # Receive at addr to trigger inactive chain topup on next load\n+        self.nodes[0].sendtoaddress(addr, 1)\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+        self.sync_all(nodes=[self.nodes[0], node_master, node_v22])\n+        node_v22.loadwallet(wallet_name)\n+\n+        # Dump again to find bad hd keypath\n+        bad_deriv_path = f\"m/0'/0'/{LAST_KEYPOOL_INDEX}'/0'/0'/{LAST_KEYPOOL_INDEX + 1}'\"\n+        good_deriv_path = f\"m/0h/0h/{LAST_KEYPOOL_INDEX + 1}h\"\n+        os.unlink(dump_path)\n+        wallet.dumpwallet(dump_path)\n+        bad_path_addr = None\n+        with open(dump_path, encoding=\"utf8\") as f:\n+            for line in f:\n+                if f\"hdkeypath={bad_deriv_path}\" in line:\n+                    bad_path_addr = line.split(\" \")[4].split(\"=\")[1]\n+        assert bad_path_addr is not None\n+        assert_equal(wallet.getaddressinfo(bad_path_addr)[\"hdkeypath\"], bad_deriv_path)\n+\n+        # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed",
      "path": "test/functional/wallet_backwards_compatibility.py",
      "position": 67,
      "original_position": 67,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```diff\r\n- # Verify that this addr is actually at m/0'/0'/10' by making a new wallet with the same seed\r\n+ # Verify that this bad derivation path addr is actually at m/0'/0'/10' by making a new wallet with the same seed but with a higher keypool size",
      "created_at": "2025-04-11T13:23:56Z",
      "updated_at": "2025-04-11T13:44:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2039560557",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2039560557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 176,
      "original_line": 176,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2049089569",
      "pull_request_review_id": 2775988164,
      "id": 2049089569,
      "node_id": "PRRC_kwDOABII5856IqAh",
      "diff_hunk": "@@ -697,10 +717,26 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyDataSPKM()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (!updated_metas.empty()) {\n+        LegacyDataSPKM* spkm = pwallet->GetLegacyDataSPKM();\n+        Assert(spkm);\n+        LOCK(spkm->cs_KeyStore);\n+        for (const auto& pubkey : updated_metas) {\n+            if (!batch.WriteKeyMetadata(spkm->mapKeyMetadata.at(pubkey.GetID()), pubkey, true)) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 125,
      "original_position": 125,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "afce141c174df1d07fb7357c3b181f60ba6ebc1f",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "it would be better to use `find()` instead of `at()` in case the key metadata is not in the wallet. E.g. an edge case.. could probably happen when `hdKeypath` path matches the 0.21 bug pattern but fails the hardened bits checks (this requires user's manual intervention to occur).",
      "created_at": "2025-04-17T14:29:52Z",
      "updated_at": "2025-04-17T16:03:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2049089569",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2049089569"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 733,
      "original_line": 733,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2049429573",
      "pull_request_review_id": 2776554184,
      "id": 2049429573,
      "node_id": "PRRC_kwDOABII5856J9BF",
      "diff_hunk": "@@ -697,10 +717,26 @@ static DBErrors LoadLegacyWalletRecords(CWallet* pwallet, DatabaseBatch& batch,\n                 chain.nExternalChainCounter = std::max(chain.nExternalChainCounter, index + 1);\n             }\n         }\n+\n+        pwallet->GetOrCreateLegacyDataSPKM()->LoadKeyMetadata(vchPubKey.GetID(), keyMeta);\n+\n         return DBErrors::LOAD_OK;\n     });\n     result = std::max(result, keymeta_res.m_result);\n \n+    // Update any changed metadata\n+    if (!updated_metas.empty()) {\n+        LegacyDataSPKM* spkm = pwallet->GetLegacyDataSPKM();\n+        Assert(spkm);\n+        LOCK(spkm->cs_KeyStore);\n+        for (const auto& pubkey : updated_metas) {\n+            if (!batch.WriteKeyMetadata(spkm->mapKeyMetadata.at(pubkey.GetID()), pubkey, true)) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 125,
      "original_position": 125,
      "commit_id": "bdcd435b48d4979751e6dd74cb996073721e5c9d",
      "original_commit_id": "afce141c174df1d07fb7357c3b181f60ba6ebc1f",
      "in_reply_to_id": 2049089569,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Also, another nit; could batch the db writes and fail if commit fails.",
      "created_at": "2025-04-17T18:02:27Z",
      "updated_at": "2025-04-17T18:02:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29124#discussion_r2049429573",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2049429573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 733,
      "original_line": 733,
      "side": "RIGHT"
    }
  ]
}
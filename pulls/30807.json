{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30807",
    "id": 2052252939,
    "node_id": "PR_kwDOABII5856UuUL",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30807",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30807.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30807.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30807",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30807/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30807/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30807/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/381e05212f1d980b516c5359b5a1cd8cc1d99f1f",
    "number": 30807,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Fix peers abruptly disconnecting from AssumeUTXO nodes during IBD",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Context:\r\nAssumeUTXO nodes prioritize tip synchronization first, meaning they advertise\r\nknowledge of all blocks posterior to the snapshot base block hash. This, in\r\nconjunction with the current protocol behavior where nodes request blocks\r\nfrom peers that directly advertise them or their descendants, causes honest\r\npeers trying to synchronize historical blocks from AssumeUTXO nodes to\r\nforcibly disconnect, after stalling for ~10 minutes, due to a `getdata` lack\r\nof response while the AssumeUTXO node is synchronizing the tip chain or the\r\nbackground chain.\r\n\r\nThis lack of response happens because nodes ignore `getdata` requests when\r\nthey don’t have the block data available (further discussion on this can be found\r\nin #30385).\r\n\r\nFix this by refraining from signaling full-node service support while the\r\nbackground chain is being synced. During this period, the node will only\r\nsignal `NODE_NETWORK_LIMITED` support. Then, full-node (`NODE_NETWORK`)\r\nsupport will be re-enabled once the background chain sync is completed.\r\n\r\nThanks mzumsande for a post-#30385 convo too.\r\n\r\nTesting notes:\r\nJust cherry-pick the second commit (381e05212f1d980b516c5359b5a1cd8cc1d99f1f) on master.\r\nIt will fail there, due to the IBD node requesting historical blocks to the snapshot\r\nnode, and pass here.",
    "labels": [],
    "created_at": "2024-09-03T23:37:43Z",
    "updated_at": "2024-09-03T23:45:09Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "b13df5f3bdd12ad17def4f563cddb3b7ed507f0b",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2024_net_assumeUTXO_service",
      "ref": "2024_net_assumeUTXO_service",
      "sha": "381e05212f1d980b516c5359b5a1cd8cc1d99f1f",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 412520,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-03T23:29:55Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2024-09-02T20:45:53Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "94c307b3c0746a08c6135ff38d6f1ad1ed6693bb",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35815,
        "stargazers_count": 77790,
        "watchers_count": 77790,
        "size": 267598,
        "default_branch": "master",
        "open_issues_count": 670,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-03T21:27:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-03T23:34:42Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30807"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 146,
    "deletions": 11,
    "changed_files": 7,
    "commits": 2,
    "review_comments": 0,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFmOTFhYmNjMmM1ZDBiM2FhYzIwOTcyMzk4YWI1ZDExZGUzY2MyMTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1f91abcc2c5d0b3aac20972398ab5d11de3cc217",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1f91abcc2c5d0b3aac20972398ab5d11de3cc217",
      "tree": {
        "sha": "c17abe41fdadb75ae4adcafb26d8c9d99a509e06",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c17abe41fdadb75ae4adcafb26d8c9d99a509e06"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c17abe41fdadb75ae4adcafb26d8c9d99a509e06\nparent a74bdeea1b8e27b2335f0f7da78006e87ecfb235\nauthor furszy <matiasfurszyfer@protonmail.com> 1725372055 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1725406179 -0300\n\nassumeUTXO: fix peers disconnection during sync\n\nContext:\nAssumeUTXO nodes prioritize tip synchronization first, meaning they advertise\nknowledge of all blocks posterior to the snapshot base block hash. This, in\nconjunction with the current protocol behavior where nodes request blocks\nfrom peers that directly advertise them or their descendants, causes honest\npeers trying to synchronize historical blocks from AssumeUTXO nodes to\nforcibly disconnect, after stalling for ~10 minutes, due to a getdata lack\nof response while the AssumeUTXO node is synchronizing the tip chain or the\nbackground chain.\n\nThis lack of response happens because nodes ignore getdata requests when they\ndon’t have the block data available (further discussion on this can be found\nin #30385).\n\nFix this by refraining from signaling full-node service support while the\nbackground chain is being synced. During this period, the node will only\nsignal 'NODE_NETWORK_LIMITED' support. Then, full-node ('NODE_NETWORK')\nsupport will be re-enabled once the background chain sync is completed.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmbXm+MACgkQXdI8zGhq\npiOZ2A//c7vC0u9JZ26S1tIWxsk06thk/VUg259I7sXARWXsUne2aEnu0GoewYTH\nqVjubx3knh670WIap+QAarzR6lWXmUKb/Q3NQGwEreSMd1/pNURbPAM7S8+N2S/u\n5/0ZPT85Z3sPXcH6v5YkwAOF9wDyl8YYZrrU7YQ+u+OFJPWPZ5++4ML2c52/9S4b\nPIuqoFoK0XInjQpbNLdu40uEuJjRJ+PdNdJ2pZvftxzbgQjc2IXDzHPN3bHZJt7y\no/QXYbmSGJzJ9IKByj9Sm8WcZB5XuvUrALj6i+r88YBZtSQ2KUROJoljdpZFBANf\n5y5JLiRINz+5gOlaHw79phm77Ir+424NMU21gVqjWk2Dj7hmO+xpHtgGSqzro8DT\nDgeJ75I83uQDTIWX4e0XWeGQu7sJRCCjAD06VDqF1Mv7W88tlbK2fmOrpoPkLRSb\nbCUskbOxPHiGbFpNsNU6VH3e8H4Xt9LMaM+JsY0b8EUqSu6zo7dB2i7Z7B0yBwgL\nPkPvRTdxXzqZaMyO3IOxOJBbLEedTqd4YVZTjTJd8IXCa8c5tvLRHuJVLtJnxlSf\nVealEkxGaBdr8rIwY25V0ou2ZCNlbnd6jxYEw6+Y7+EwDeJenAobDyZOGFjrIT5h\n+6Y8Q+3oig05sDJ5bRgqEcAuFZO3O+zsedJLik2M4FkzArhgPfc=\n=zFL0\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a74bdeea1b8e27b2335f0f7da78006e87ecfb235",
          "sha": "a74bdeea1b8e27b2335f0f7da78006e87ecfb235",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a74bdeea1b8e27b2335f0f7da78006e87ecfb235"
        }
      ],
      "message": "assumeUTXO: fix peers disconnection during sync\n\nContext:\nAssumeUTXO nodes prioritize tip synchronization first, meaning they advertise\nknowledge of all blocks posterior to the snapshot base block hash. This, in\nconjunction with the current protocol behavior where nodes request blocks\nfrom peers that directly advertise them or their descendants, causes honest\npeers trying to synchronize historical blocks from AssumeUTXO nodes to\nforcibly disconnect, after stalling for ~10 minutes, due to a getdata lack\nof response while the AssumeUTXO node is synchronizing the tip chain or the\nbackground chain.\n\nThis lack of response happens because nodes ignore getdata requests when they\ndon’t have the block data available (further discussion on this can be found\nin #30385).\n\nFix this by refraining from signaling full-node service support while the\nbackground chain is being synced. During this period, the node will only\nsignal 'NODE_NETWORK_LIMITED' support. Then, full-node ('NODE_NETWORK')\nsupport will be re-enabled once the background chain sync is completed.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-09-03T23:29:39Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-09-03T14:00:55Z"
      },
      "sha": "1f91abcc2c5d0b3aac20972398ab5d11de3cc217"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM4MWUwNTIxMmYxZDk4MGI1MTZjNTM1OWI1YTFjZDhjYzFkOTlmMWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/381e05212f1d980b516c5359b5a1cd8cc1d99f1f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/381e05212f1d980b516c5359b5a1cd8cc1d99f1f",
      "tree": {
        "sha": "ef13afeffb2e005536f811c4ce831685a297a4af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ef13afeffb2e005536f811c4ce831685a297a4af"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ef13afeffb2e005536f811c4ce831685a297a4af\nparent 1f91abcc2c5d0b3aac20972398ab5d11de3cc217\nauthor furszy <matiasfurszyfer@protonmail.com> 1720534049 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1725406180 -0300\n\ntest: add coverage for assumeUTXO honest peers disconnection\n\nExercises a fresh node on IBD refraining from requesting historical\nblocks to an AssumeUTXO node that is synchronizing the background\nchain.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmbXm+QACgkQXdI8zGhq\npiNijBAAkqQjJdRV9tsLPJr88xHdmqRtiJ+mlsDTJUAM18xypchrbVZ0HZTYHnoS\nxI7yxC5B2mRUvMWuctjOF7F8K7ZG3SCHr/JelbaQFIKlH1hAtxVi3uJpBaZO7j+F\nSHdONs7DdxdhUvNqbtSJxXYjHTjjCECEo8X1RugMkQHWKh+5rVObdsfCWIDdaS5t\n3D5vfal8A0O437h4Ev5Xj+T+kiVmznA2eMuovN36Jr9xtDGr0qUvGvDdS9G357g+\nIcajxKhtQI/S6Bq0h4d84P8SewB85iE8NPrAtP8zu1kVlLeAA+IR5wUIeIHe4wfQ\nmdINDZFfZkpdYfDG1VYesT6BYQmXIcOpFg3GM+ZaDpqCO64Ekr4WbhJ5zqBYI8ws\n59qbA9QLfWbaCxvJ7uyY5i/CMLyrvwQcOE/mtzb604yaP6qBAc24r4/oaIgifZAI\nhHCFjuFxXe4Cmjihua8nbQhb/PbHlr4fS93KRwl3SSH8A51gzFJJTJ2NU6tE1sYm\ndWrwfUAdZoOfC4AvZsSjwTFOSwVKxlieh88nS2DsP+x08XW4jfx96JY312xiepNM\nV8uYqZuZL9ZKVbTr9tt4actHBR4PD2NS7WAfa1gv0FlxbSJWhAMiuQYZwKVuBvWr\n/b3semWRKJkYPNp3pn0jzYID9BW/48f9fReGZH7MrWf1aa0YGxQ=\n=AuAK\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1f91abcc2c5d0b3aac20972398ab5d11de3cc217",
          "sha": "1f91abcc2c5d0b3aac20972398ab5d11de3cc217",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1f91abcc2c5d0b3aac20972398ab5d11de3cc217"
        }
      ],
      "message": "test: add coverage for assumeUTXO honest peers disconnection\n\nExercises a fresh node on IBD refraining from requesting historical\nblocks to an AssumeUTXO node that is synchronizing the background\nchain.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-09-03T23:29:40Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-07-09T14:07:29Z"
      },
      "sha": "381e05212f1d980b516c5359b5a1cd8cc1d99f1f"
    },
    {
      "event": "commented",
      "id": 2327630235,
      "node_id": "IC_kwDOABII586KvNGb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2327630235",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-03T23:37:45Z",
      "updated_at": "2024-09-03T23:37:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30807).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30807#issuecomment-2327630235",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30807"
    }
  ],
  "comments": []
}
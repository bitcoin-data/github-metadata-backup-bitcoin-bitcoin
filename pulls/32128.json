{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128",
    "id": 2412718360,
    "node_id": "PR_kwDOABII586PzykY",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32128",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32128.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32128.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/18b2c263aab12c49350b20fa2bef407d8a9eff61",
    "number": 32128,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Draft: CCoinMap Experiments",
    "user": {
      "login": "martinus",
      "id": 14386,
      "node_id": "MDQ6VXNlcjE0Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinus",
      "html_url": "https://github.com/martinus",
      "followers_url": "https://api.github.com/users/martinus/followers",
      "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
      "organizations_url": "https://api.github.com/users/martinus/orgs",
      "repos_url": "https://api.github.com/users/martinus/repos",
      "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/martinus/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This is a draft PR to show various possible optimizations for `CCoinsMap`. In my benchmark, all these changes lead to a statistically significant speed improvement for `-reindex-chainstate`. \r\n\r\n```\r\nBenchmark 1: ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = ac188b573c8)\r\n  Time (mean Â± Ïƒ):     2089.253 s Â± 23.737 s    [User: 2110.111 s, System: 299.197 s]\r\n  Range (min â€¦ max):   2062.751 s â€¦ 2108.561 s    3 runs\r\n\r\nBenchmark 2: ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = 7113095b3cd)\r\n  Time (mean Â± Ïƒ):     2431.028 s Â± 17.544 s    [User: 2439.746 s, System: 284.994 s]\r\n  Range (min â€¦ max):   2415.408 s â€¦ 2450.009 s    3 runs\r\n\r\nBenchmark 3: ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = 7370e13d93d)\r\n  Time (mean Â± Ïƒ):     2530.955 s Â± 21.575 s    [User: 2539.882 s, System: 285.890 s]\r\n  Range (min â€¦ max):   2512.525 s â€¦ 2554.687 s    3 runs\r\n\r\nBenchmark 4: ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = e568c1dd134)\r\n  Time (mean Â± Ïƒ):     2839.864 s Â±  9.993 s    [User: 2850.112 s, System: 287.916 s]\r\n  Range (min â€¦ max):   2830.073 s â€¦ 2850.047 s    3 runs\r\n\r\nSummary\r\n  ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = ac188b573c8) ran\r\n    1.16 Â± 0.02 times faster than ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = 7113095b3cd)\r\n    1.21 Â± 0.02 times faster than ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = 7370e13d93d)\r\n    1.36 Â± 0.02 times faster than ./build/bin/bitcoind -stopatheight=600000 -dbcache=5000 -printtoconsole=0 -reindex-chainstate -noconnect -connect=192.168.8.118 (COMMIT = e568c1dd134)\r\n```\r\n\r\n",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-03-24T06:02:30Z",
    "updated_at": "2025-08-26T01:07:56Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "martinus:2025-03-scheduler-destroy-in-separate-thread-experiment",
      "ref": "2025-03-scheduler-destroy-in-separate-thread-experiment",
      "sha": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 107273866,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMDcyNzM4NjY=",
        "name": "bitcoin",
        "full_name": "martinus/bitcoin",
        "owner": {
          "login": "martinus",
          "id": 14386,
          "node_id": "MDQ6VXNlcjE0Mzg2",
          "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/martinus",
          "html_url": "https://github.com/martinus",
          "followers_url": "https://api.github.com/users/martinus/followers",
          "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
          "organizations_url": "https://api.github.com/users/martinus/orgs",
          "repos_url": "https://api.github.com/users/martinus/repos",
          "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/martinus/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/martinus/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/martinus/bitcoin",
        "archive_url": "https://api.github.com/repos/martinus/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/martinus/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/martinus/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/martinus/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/martinus/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/martinus/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/martinus/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/martinus/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/martinus/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/martinus/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/martinus/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/martinus/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/martinus/bitcoin/events",
        "forks_url": "https://api.github.com/repos/martinus/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/martinus/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/martinus/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/martinus/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/martinus/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/martinus/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/martinus/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/martinus/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/martinus/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/martinus/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/martinus/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/martinus/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/martinus/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/martinus/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/martinus/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/martinus/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:martinus/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/martinus/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/martinus/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/martinus/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/martinus/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/martinus/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/martinus/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/martinus/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/martinus/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/martinus/bitcoin/hooks",
        "svn_url": "https://github.com/martinus/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 283141,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-17T09:45:18Z",
        "created_at": "2017-10-17T13:40:13Z",
        "updated_at": "2025-07-17T09:45:53Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "74c23f80abbe72c1cc00604ec438498e6a20d3e6",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37662,
        "stargazers_count": 85198,
        "watchers_count": 85198,
        "size": 291722,
        "default_branch": "master",
        "open_issues_count": 758,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-08-25T21:12:06Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-08-26T01:42:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 111,
    "deletions": 31,
    "changed_files": 9,
    "commits": 3,
    "review_comments": 12,
    "comments": 6
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDEwNGQ1ZGQ3NzhlN2JhY2JhOTYxM2Q3MGFmYzQyMmZmNjc2ZTUxMTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/104d5dd778e7bacba9613d70afc422ff676e5111",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/104d5dd778e7bacba9613d70afc422ff676e5111",
      "tree": {
        "sha": "ae11c155544e04a86f8ff5a48913c14ccea5bdb0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ae11c155544e04a86f8ff5a48913c14ccea5bdb0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e568c1dd134e0318c46113cb7dfc23b40e2829e8",
          "sha": "e568c1dd134e0318c46113cb7dfc23b40e2829e8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e568c1dd134e0318c46113cb7dfc23b40e2829e8"
        }
      ],
      "message": "SaltedOutpointHasher uses rapidhash\n\nSipHashUint256Extra is rather slow. For the purpose of generating a hash\nfrom a COutPoint and some seed that is only used inside a hashmap, it is\nsufficient to use a non-cryptographic hash. rapidhash [1] is a well tested\nand very fast hash function. This implementation strips down this hash\nfunction, originally implemented for a memory buffer, to be used with\nthe COutPoint + 2*64bit seed as the input.\n\n[1] https://github.com/Nicoshev/rapidhash",
      "committer": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-24T05:45:43Z"
      },
      "author": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-22T14:16:17Z"
      },
      "sha": "104d5dd778e7bacba9613d70afc422ff676e5111"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcyM2M0OWI2M2JiMTBkYTg0M2ZiYjZlZmM2OTI4ZGNhNDE1Y2M0N2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/723c49b63bb10da843fbb6efc6928dca415cc47f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/723c49b63bb10da843fbb6efc6928dca415cc47f",
      "tree": {
        "sha": "c5443f362a46db52bfb0790c9262d6b3f6429415",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c5443f362a46db52bfb0790c9262d6b3f6429415"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/104d5dd778e7bacba9613d70afc422ff676e5111",
          "sha": "104d5dd778e7bacba9613d70afc422ff676e5111",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/104d5dd778e7bacba9613d70afc422ff676e5111"
        }
      ],
      "message": "CCoinsViewCache::BatchWrite lookup optimization\n\nIn the case when parent cache does not have an entry while child cache does,\nthis reduces the double hash lookup (find + try_emplace) with a single\ntry_emplace.",
      "committer": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-24T05:49:41Z"
      },
      "author": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-22T17:24:33Z"
      },
      "sha": "723c49b63bb10da843fbb6efc6928dca415cc47f"
    },
    {
      "event": "commented",
      "id": 2746982454,
      "node_id": "IC_kwDOABII586ju6A2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2746982454",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T06:02:33Z",
      "updated_at": "2025-05-08T06:00:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32128.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32313](https://github.com/bitcoin/bitcoin/pull/32313) (coins: fix `cachedCoinsUsage` accounting in `CCoinsViewCache` by l0rinc)\n* [#32043](https://github.com/bitcoin/bitcoin/pull/32043) ([IBD] Tracking PR for speeding up Initial Block Download by l0rinc)\n* [#31895](https://github.com/bitcoin/bitcoin/pull/31895) (doc: Improve `dependencies.md` by NicolaLS)\n* [#30442](https://github.com/bitcoin/bitcoin/pull/30442) ([IBD] precalculate SipHash constant salt calculations by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-2746982454",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    },
    {
      "event": "commented",
      "id": 2747060993,
      "node_id": "IC_kwDOABII586jvNMB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2747060993",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T06:51:03Z",
      "updated_at": "2025-03-24T06:51:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/39270918766</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-2747060993",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    },
    {
      "event": "labeled",
      "id": 16949567798,
      "node_id": "LE_lADOABII586vXNcTzwAAAAPyReE2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16949567798",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T06:51:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2710273401,
      "node_id": "PRR_kwDOABII586hi315",
      "url": null,
      "actor": null,
      "commit_id": "1ae27634509d00bf39d0ed21100ae708591db6a0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-03-25T08:28:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "Welcome back @martinus, we missed you! :)\r\nI will measure these changes separately until 890k blocks soon.\r\nI have included this change a tracking PR where we have other similar experiments: https://github.com/bitcoin/bitcoin/pull/32043\r\n\r\nEdit: is the name of the branch an easter egg for what to expect next?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#pullrequestreview-2710273401",
      "submitted_at": "2025-03-24T13:05:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
    },
    {
      "event": "commented",
      "id": 2748556101,
      "node_id": "IC_kwDOABII586j06NF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2748556101",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T15:36:42Z",
      "updated_at": "2025-03-24T15:36:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Welcome back @martinus, we missed you! :) I will measure these changes separately until 890k blocks soon. I have included this change a tracking PR where we have other similar experiments: #32043\r\n\r\nI have not done any programming in half a year, looking forward to getting back :)",
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-2748556101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    },
    {
      "event": "mentioned",
      "id": 16958300234,
      "node_id": "MEE_lADOABII586vXNcTzwAAAAPyyyBK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16958300234",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T15:36:43Z"
    },
    {
      "event": "subscribed",
      "id": 16958300278,
      "node_id": "SE_lADOABII586vXNcTzwAAAAPyyyB2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16958300278",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T15:36:43Z"
    },
    {
      "event": "reviewed",
      "id": 2712576304,
      "node_id": "PRR_kwDOABII586hrqEw",
      "url": null,
      "actor": null,
      "commit_id": "1ae27634509d00bf39d0ed21100ae708591db6a0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-03-25T06:46:30Z",
      "author_association": "NONE",
      "user": {
        "login": "chellas2wp",
        "id": 190247492,
        "node_id": "U_kgDOC1byRA",
        "avatar_url": "https://avatars.githubusercontent.com/u/190247492?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chellas2wp",
        "html_url": "https://github.com/chellas2wp",
        "followers_url": "https://api.github.com/users/chellas2wp/followers",
        "following_url": "https://api.github.com/users/chellas2wp/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chellas2wp/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chellas2wp/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chellas2wp/subscriptions",
        "organizations_url": "https://api.github.com/users/chellas2wp/orgs",
        "repos_url": "https://api.github.com/users/chellas2wp/repos",
        "events_url": "https://api.github.com/users/chellas2wp/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chellas2wp/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#pullrequestreview-2712576304",
      "submitted_at": "2025-03-25T06:46:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
    },
    {
      "event": "labeled",
      "id": 16992423066,
      "node_id": "LE_lADOABII586vXNcTzwAAAAP008ya",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16992423066",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T13:07:01Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 2755672096,
      "node_id": "IC_kwDOABII586kQDgg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2755672096",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T20:26:36Z",
      "updated_at": "2025-03-27T19:27:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "I have measured these commits separately against a baseline (undoing each commit, to measure them independently).\r\n* 1d281daf86 `Merge bitcoin/bitcoin#32095: doc: clarify that testnet min-difficulty` is the **baseline**\r\n* 1112433318 `SaltedOutpointHasher uses rapidhash` is **5%** faster than 1d281daf86\r\n* e00d828362 `CCoinsViewCache::BatchWrite lookup optimization` is **0.5%** faster than 1d281daf86\r\n* 1630e368d1 `Use boost::unordered_node_map for CCoinsMap` is **7.4%** faster than 1d281daf86\r\n\r\n<details>\r\n<summary>Reindex-chainstate until block 888888</summary>\r\n\r\n```bash\r\n1d281daf86 (HEAD, origin/master, origin/HEAD) Merge bitcoin/bitcoin#32095: doc: clarify that testnet min-difficulty is not optional\r\n1112433318 SaltedOutpointHasher uses rapidhash\r\ne00d828362 CCoinsViewCache::BatchWrite lookup optimization\r\n1630e368d1 (l0rinc/detached186) Use boost::unordered_node_map for CCoinsMap\r\nBenchmark 1: COMPILER=gcc COMMIT=1d281daf8613a3cb7a26759c351ffb34dab0f656 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n  Time (abs â‰¡):        25746.852 s               [User: 24476.673 s, System: 1096.263 s]\r\n \r\nBenchmark 2: COMPILER=gcc COMMIT=1112433318cbb096fec0cc83d2c424db652c126f ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n  Time (abs â‰¡):        24511.624 s               [User: 23046.157 s, System: 1074.909 s]\r\n \r\nBenchmark 3: COMPILER=gcc COMMIT=e00d8283624f3d937f1222cb2c1540655045b095 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n  Time (abs â‰¡):        25616.379 s               [User: 24209.459 s, System: 1088.005 s]\r\n \r\nBenchmark 4: COMPILER=gcc COMMIT=1630e368d190a75870399cc38af3c6023faaf2d9 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n  Time (abs â‰¡):        23966.508 s               [User: 22294.996 s, System: 1082.040 s]\r\n \r\nSummary\r\n  COMPILER=gcc COMMIT=1630e368d190a75870399cc38af3c6023faaf2d9 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0 ran\r\n    1.02 times faster than COMPILER=gcc COMMIT=1112433318cbb096fec0cc83d2c424db652c126f ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n    1.07 times faster than COMPILER=gcc COMMIT=e00d8283624f3d937f1222cb2c1540655045b095 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n    1.07 times faster than COMPILER=gcc COMMIT=1d281daf8613a3cb7a26759c351ffb34dab0f656 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n```\r\n\r\n</details>\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-2755672096",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE4YjJjMjYzYWFiMTJjNDkzNTBiMjBmYTJiZWY0MDdkOGE5ZWZmNjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "tree": {
        "sha": "bc50b8b627610576f64d8d476ad15384852d3c14",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc50b8b627610576f64d8d476ad15384852d3c14"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/723c49b63bb10da843fbb6efc6928dca415cc47f",
          "sha": "723c49b63bb10da843fbb6efc6928dca415cc47f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/723c49b63bb10da843fbb6efc6928dca415cc47f"
        }
      ],
      "message": "Use boost::unordered_node_map for CCoinsMap\n\nboost::unordered_node_map is a highly optimized hashmap, available since\nboost 1.82, that is API compatible to std::unordered_map for our use case.\nIt also can use the existing PoolAllocator.",
      "committer": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-27T18:55:37Z"
      },
      "author": {
        "name": "Martin Leitner-Ankerl",
        "email": "martin.ankerl@gmail.com",
        "date": "2025-03-23T10:27:25Z"
      },
      "sha": "18b2c263aab12c49350b20fa2bef407d8a9eff61"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17020467837,
      "node_id": "HRFPE_lADOABII586vXNcTzwAAAAP2f7p9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17020467837",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "commit_url": "https://api.github.com/repos/martinus/bitcoin/commits/18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "created_at": "2025-03-27T18:56:00Z"
    },
    {
      "event": "labeled",
      "id": 17675766431,
      "node_id": "LE_lADOABII586vXNcTzwAAAAQdjsqf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17675766431",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T16:31:19Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2884425993,
      "node_id": "IC_kwDOABII586r7NkJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2884425993",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T16:31:20Z",
      "updated_at": "2025-05-15T16:31:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nðŸ™ This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-2884425993",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    },
    {
      "event": "commented",
      "id": 3222209141,
      "node_id": "IC_kwDOABII587ADwJ1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3222209141",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T01:07:56Z",
      "updated_at": "2025-08-26T01:07:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\nâŒ› There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? âž¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? âž¡ï¸ Please close.\n* Did the author lose interest or time to work on this? âž¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#issuecomment-3222209141",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32128"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010119858",
      "pull_request_review_id": 2710273401,
      "id": 2010119858,
      "node_id": "PRRC_kwDOABII5853z_6y",
      "diff_hunk": "@@ -221,12 +222,12 @@ struct CCoinsCacheEntry\n  * Using an additional sizeof(void*)*4 for MAX_BLOCK_SIZE_BYTES should thus be sufficient so that\n  * all implementations can allocate the nodes from the PoolAllocator.\n  */\n-using CCoinsMap = std::unordered_map<COutPoint,\n-                                     CCoinsCacheEntry,\n-                                     SaltedOutpointHasher,\n-                                     std::equal_to<COutPoint>,\n-                                     PoolAllocator<CoinsCachePair,\n-                                                   sizeof(CoinsCachePair) + sizeof(void*) * 4>>;\n+using CCoinsMap = boost::unordered_node_map<COutPoint,",
      "path": "src/coins.h",
      "position": 18,
      "original_position": 18,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "1ae27634509d00bf39d0ed21100ae708591db6a0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "My understanding is that we're trying to get away from external dependencies, so if this does improve performance, we may want to copy it over.\r\n\r\nFor the record, similar attempts have been made before: https://github.com/bitcoin/bitcoin/pull/22640\r\n\r\n@andrewtoth suggested we try your [`unordered_dense`](https://github.com/martinus/unordered_dense) here as well.\r\n\r\nMy understanding is that this will likely require retesting our memory related assumption so far.",
      "created_at": "2025-03-24T12:49:58Z",
      "updated_at": "2025-03-24T13:05:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2010119858",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010119858"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 225,
      "original_line": 225,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010125143",
      "pull_request_review_id": 2710273401,
      "id": 2010125143,
      "node_id": "PRRC_kwDOABII58530BNX",
      "diff_hunk": "@@ -186,30 +186,34 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n         if (!it->second.IsDirty()) {\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n+        CCoinsMap::iterator itUs;\n+        bool isInserted = false;\n+        if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n+            std::tie(itUs, isInserted) = cacheCoins.try_emplace(it->first);",
      "path": "src/coins.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "723c49b63bb10da843fbb6efc6928dca415cc47f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This seems similar to https://github.com/bitcoin/bitcoin/pull/30326 - I'm surprised this has a measurable effect (and that I haven't found it so far :D)",
      "created_at": "2025-03-24T12:53:22Z",
      "updated_at": "2025-03-24T13:05:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2010125143",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010125143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 192,
      "original_line": 192,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010137339",
      "pull_request_review_id": 2710273401,
      "id": 2010137339,
      "node_id": "PRRC_kwDOABII58530EL7",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I have also measured this being a bottleneck very often (https://github.com/bitcoin/bitcoin/pull/30442), and @sipa mentioned originally that we can swap it out with something better later: https://github.com/bitcoin/bitcoin/pull/8020#issuecomment-219569508\r\n\r\nDo we need to account for collision attacks here, given that inclusion into the map is not for free?",
      "created_at": "2025-03-24T13:01:08Z",
      "updated_at": "2025-03-24T15:38:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2010137339",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2010137339"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2011428282",
      "pull_request_review_id": 2712576304,
      "id": 2011428282,
      "node_id": "PRRC_kwDOABII58534_W6",
      "diff_hunk": "@@ -18,7 +18,7 @@ Bitcoin Core requires one of the following compilers.\n | Dependency | Releases | Version used | Minimum required | Runtime |\n | --- | --- | --- | --- | --- |\n | CMake | [link](https://cmake.org/) | N/A | [3.22](https://github.com/bitcoin/bitcoin/pull/30454) | No |\n-| [Boost](../depends/packages/boost.mk) | [link](https://www.boost.org/users/download/) | [1.81.0](https://github.com/bitcoin/bitcoin/pull/26557) | [1.73.0](https://github.com/bitcoin/bitcoin/pull/29066) | No |",
      "path": "doc/dependencies.md",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "1ae27634509d00bf39d0ed21100ae708591db6a0",
      "in_reply_to_id": null,
      "user": {
        "login": "chellas2wp",
        "id": 190247492,
        "node_id": "U_kgDOC1byRA",
        "avatar_url": "https://avatars.githubusercontent.com/u/190247492?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chellas2wp",
        "html_url": "https://github.com/chellas2wp",
        "followers_url": "https://api.github.com/users/chellas2wp/followers",
        "following_url": "https://api.github.com/users/chellas2wp/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/chellas2wp/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/chellas2wp/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/chellas2wp/subscriptions",
        "organizations_url": "https://api.github.com/users/chellas2wp/orgs",
        "repos_url": "https://api.github.com/users/chellas2wp/repos",
        "events_url": "https://api.github.com/users/chellas2wp/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/chellas2wp/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Starting process/approval request/apply specifications.",
      "created_at": "2025-03-25T06:46:11Z",
      "updated_at": "2025-03-25T08:14:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2011428282",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2011428282"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 21,
      "original_line": 21,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017405150",
      "pull_request_review_id": 2723049711,
      "id": 2017405150,
      "node_id": "PRRC_kwDOABII5854Pyje",
      "diff_hunk": "@@ -221,12 +222,12 @@ struct CCoinsCacheEntry\n  * Using an additional sizeof(void*)*4 for MAX_BLOCK_SIZE_BYTES should thus be sufficient so that\n  * all implementations can allocate the nodes from the PoolAllocator.\n  */\n-using CCoinsMap = std::unordered_map<COutPoint,\n-                                     CCoinsCacheEntry,\n-                                     SaltedOutpointHasher,\n-                                     std::equal_to<COutPoint>,\n-                                     PoolAllocator<CoinsCachePair,\n-                                                   sizeof(CoinsCachePair) + sizeof(void*) * 4>>;\n+using CCoinsMap = boost::unordered_node_map<COutPoint,",
      "path": "src/coins.h",
      "position": 18,
      "original_position": 18,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "1ae27634509d00bf39d0ed21100ae708591db6a0",
      "in_reply_to_id": 2010119858,
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think boost maps might be a better choice, I believe they are better tested, and might be faster as well. Also for `boost::unordered_node_map` references are stable, which is not the case for `unordered_dense`, so it is easier to have this as a drop-in replacement without worrying about pointer stability.",
      "created_at": "2025-03-27T18:24:47Z",
      "updated_at": "2025-03-27T18:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2017405150",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017405150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 225,
      "original_line": 225,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017406465",
      "pull_request_review_id": 2723051986,
      "id": 2017406465,
      "node_id": "PRRC_kwDOABII5854Py4B",
      "diff_hunk": "@@ -186,30 +186,34 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n         if (!it->second.IsDirty()) {\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n+        CCoinsMap::iterator itUs;\n+        bool isInserted = false;\n+        if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n+            std::tie(itUs, isInserted) = cacheCoins.try_emplace(it->first);",
      "path": "src/coins.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "723c49b63bb10da843fbb6efc6928dca415cc47f",
      "in_reply_to_id": 2010125143,
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It seems it has far less of an effect in your test, maybe I should also run the benchmark on my machine until block 890k for comparison",
      "created_at": "2025-03-27T18:25:48Z",
      "updated_at": "2025-03-27T18:25:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2017406465",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017406465"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 192,
      "original_line": 192,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017408749",
      "pull_request_review_id": 2723055492,
      "id": 2017408749,
      "node_id": "PRRC_kwDOABII5854Pzbt",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": 2010137339,
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think collision attacks can't be an issue because the hash implementation still uses the random seed, and the hash itself is of good quality.",
      "created_at": "2025-03-27T18:27:24Z",
      "updated_at": "2025-03-27T18:27:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2017408749",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017408749"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017460739",
      "pull_request_review_id": 2723145824,
      "id": 2017460739,
      "node_id": "PRRC_kwDOABII5854QAID",
      "diff_hunk": "@@ -186,30 +186,34 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n         if (!it->second.IsDirty()) {\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n+        CCoinsMap::iterator itUs;\n+        bool isInserted = false;\n+        if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n+            std::tie(itUs, isInserted) = cacheCoins.try_emplace(it->first);",
      "path": "src/coins.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "723c49b63bb10da843fbb6efc6928dca415cc47f",
      "in_reply_to_id": 2010125143,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Or maybe these are only measurable after the other changes are in place - I have compared all commits independently.",
      "created_at": "2025-03-27T19:06:47Z",
      "updated_at": "2025-03-27T19:06:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2017460739",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017460739"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 192,
      "original_line": 192,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017482800",
      "pull_request_review_id": 2723182954,
      "id": 2017482800,
      "node_id": "PRRC_kwDOABII5854QFgw",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": 2010137339,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm pretty skeptical about that claim. If the hash isn't of cryptographic quality, I don't know how I'd reason about an attacker's ability to control the buckets, even with a secret random seed.\r\n\r\nTo be clear, it's entirely reasonable that this may be safe, but I don't know how I'd convince myself that it is definitely safe.",
      "created_at": "2025-03-27T19:25:04Z",
      "updated_at": "2025-03-27T20:05:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2017482800",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2017482800"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2018784600",
      "pull_request_review_id": 2725731535,
      "id": 2018784600,
      "node_id": "PRRC_kwDOABII5854VDVY",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": 2010137339,
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "@sipa thanks, you are of course right; I should have read a bit more about that before... Nevertheless I think it's at least interesting to see what difference a fast hash would make.",
      "created_at": "2025-03-28T14:26:03Z",
      "updated_at": "2025-03-28T14:26:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2018784600",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2018784600"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2113859955",
      "pull_request_review_id": 2878134655,
      "id": 2113859955,
      "node_id": "PRRC_kwDOABII5859_vFz",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": 2010137339,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`SipHash` is decent (I tried several other candidates and most were slower), but not particularly fast (even a general SHA256-shani is in the same ball-park).\r\n`RapidHash` is much simpler and, on short inputs, dramatically faster:\r\n|             ns/byte |              byte/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                0.06 |   16,529,344,089.83 |    0.2% |     11.00 | `RapidHash_32b`\r\n|                0.96 |    1,043,368,577.00 |    0.1% |     11.01 | `Sha256Shani_32b using the 'arm_shani(1way,2way)' SHA256 implementation`\r\n|                0.39 |    2,547,686,515.00 |    0.2% |     10.98 | `SipHash_32b`\r\n\r\n<details>\r\n<summary>Benchmarks</summary>\r\n\r\n```patch\r\ndiff --git a/src/bench/crypto_hash.cpp b/src/bench/crypto_hash.cpp\r\nindex 2f1ff56438..cab34169a5 100644\r\n--- a/src/bench/crypto_hash.cpp\r\n+++ b/src/bench/crypto_hash.cpp\r\n@@ -195,11 +195,108 @@ static void SipHash_32b(benchmark::Bench& bench)\r\n     FastRandomContext rng{/*fDeterministic=*/true};\r\n     auto k0{rng.rand64()}, k1{rng.rand64()};\r\n     auto val{rng.rand256()};\r\n+    auto extra{rng.rand32()};\r\n     auto i{0U};\r\n-    bench.run([&] {\r\n-        ankerl::nanobench::doNotOptimizeAway(SipHashUint256(k0, k1, val));\r\n+    bench.batch(uint256::size() + sizeof(uint32_t) / 8).unit(\"byte\").run([&] {\r\n+        ankerl::nanobench::doNotOptimizeAway(SipHashUint256Extra(k0, k1, val, extra));\r\n         ++k0;\r\n         ++k1;\r\n+        ++extra;\r\n+        ++i;\r\n+        val.data()[i % uint256::size()] ^= i & 0xFF;\r\n+    });\r\n+}\r\n+\r\n+static void Sha256Shani_32b(benchmark::Bench& bench)\r\n+{\r\n+    FastRandomContext rng{/*fDeterministic=*/true};\r\n+    auto k0{rng.rand64()}, k1{rng.rand64()};\r\n+    auto val{rng.rand256()};\r\n+    auto extra{rng.rand32()};\r\n+    auto i{0U};\r\n+    uint8_t hash[CSHA256::OUTPUT_SIZE];\r\n+\r\n+    bench.name(strprintf(\"%s using the '%s' SHA256 implementation\", __func__, SHA256AutoDetect(sha256_implementation::USE_SSE4_AND_SHANI)));\r\n+    uint8_t digest[CSHA256::OUTPUT_SIZE];\r\n+    bench.batch(uint256::size() + sizeof(uint32_t) / 8).unit(\"byte\").run([&] {\r\n+        CSHA256()\r\n+            .Write(reinterpret_cast<const uint8_t*>(&k0), sizeof(k0))\r\n+            .Write(reinterpret_cast<const uint8_t*>(&k1), sizeof(k1))\r\n+            .Write(val.data(), val.size())\r\n+            .Write(reinterpret_cast<const uint8_t*>(&extra), sizeof(extra))\r\n+            .Finalize(hash);\r\n+\r\n+        ankerl::nanobench::doNotOptimizeAway(digest[0]);\r\n+        ++k0;\r\n+        ++k1;\r\n+        ++extra;\r\n+        ++i;\r\n+        val.data()[i % uint256::size()] ^= i & 0xFF;\r\n+    });\r\n+    SHA256AutoDetect();\r\n+}\r\n+\r\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra)\r\n+{\r\n+    auto const rapid_mum = [](uint64_t* a, uint64_t* b) {\r\n+#if defined(__SIZEOF_INT128__)\r\n+        __uint128_t r = *a;\r\n+        r *= *b;\r\n+        *a = (uint64_t)r;\r\n+        *b = (uint64_t)(r >> 64);\r\n+#elif defined(_MSC_VER) && (defined(_WIN64) || defined(_M_HYBRID_CHPE_ARM64))\r\n+#if defined(_M_X64)\r\n+        *a = _umul128(*a, *b, b);\r\n+#else\r\n+        uint64_t c = __umulh(*a, *b);\r\n+        *a = *a * *b;\r\n+        *b = c;\r\n+#endif\r\n+#else\r\n+        uint64_t ha = *a >> 32, hb = *b >> 32, la = (uint32_t)*a, lb = (uint32_t)*b, hi, lo;\r\n+        uint64_t rh = ha * hb, rm0 = ha * lb, rm1 = hb * la, rl = la * lb, t = rl + (rm0 << 32), c = t < rl;\r\n+        lo = t + (rm1 << 32);\r\n+        c += lo < t;\r\n+        hi = rh + (rm0 >> 32) + (rm1 >> 32) + c;\r\n+        *a = lo;\r\n+        *b = hi;\r\n+#endif\r\n+    };\r\n+\r\n+    auto const rapid_mix = [&rapid_mum](uint64_t a, uint64_t b) -> uint64_t {\r\n+        rapid_mum(&a, &b);\r\n+        return a ^ b;\r\n+    };\r\n+\r\n+    // This effectifely behaves like rapidhash with that input:\r\n+    // seed: k0, data: [val, k1, extra]\r\n+    // So it hashes 32+8+4 = 44 bytes, plus uses the 8 byte as seed.\r\n+\r\n+    // Default secret parameters.\r\n+    static constexpr uint64_t secret[3] = {0x2d358dccaa6c78a5ull, 0x8bb84b93962eacc9ull, 0x4b33a62ed433d4a3ull};\r\n+\r\n+    // no need to mix the seed itself, as it is purely random.\r\n+    uint64_t seed = k0;\r\n+    seed = rapid_mix(val.GetUint64(0) ^ secret[2], val.GetUint64(1) ^ seed ^ secret[1]);\r\n+    seed = rapid_mix(val.GetUint64(2) ^ secret[2], val.GetUint64(3) ^ seed);\r\n+    uint64_t a = k1 ^ secret[1];\r\n+    uint64_t b = extra ^ seed;\r\n+    rapid_mum(&a, &b);\r\n+    return rapid_mix(a ^ secret[0], b ^ secret[1]);\r\n+}\r\n+\r\n+static void RapidHash_32b(benchmark::Bench& bench)\r\n+{\r\n+    FastRandomContext rng{/*fDeterministic=*/true};\r\n+    auto k0{rng.rand64()}, k1{rng.rand64()};\r\n+    auto val{rng.rand256()};\r\n+    auto extra{rng.rand32()};\r\n+    auto i{0U};\r\n+    bench.batch(uint256::size() + sizeof(uint32_t) / 8).unit(\"byte\").run([&] {\r\n+        ankerl::nanobench::doNotOptimizeAway(ModifiedRapidHash(k0, k1, val, extra));\r\n+        ++k0;\r\n+        ++k1;\r\n+        ++extra;\r\n         ++i;\r\n         val.data()[i % uint256::size()] ^= i & 0xFF;\r\n     });\r\n@@ -276,6 +373,8 @@ BENCHMARK(SHA256_32b_SSE4, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SHA256_32b_AVX2, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SHA256_32b_SHANI, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SipHash_32b, benchmark::PriorityLevel::HIGH);\r\n+BENCHMARK(Sha256Shani_32b, benchmark::PriorityLevel::HIGH);\r\n+BENCHMARK(RapidHash_32b, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SHA256D64_1024_STANDARD, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SHA256D64_1024_SSE4, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(SHA256D64_1024_AVX2, benchmark::PriorityLevel::HIGH);\r\n@@ -286,3 +385,4 @@ BENCHMARK(MuHashMul, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(MuHashDiv, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(MuHashPrecompute, benchmark::PriorityLevel::HIGH);\r\n BENCHMARK(MuHashFinalize, benchmark::PriorityLevel::HIGH);\r\n+\r\n\r\n```\r\n\r\n</details>\r\n\r\n[RapidHash v3](https://github.com/Nicoshev/rapidhash/releases/tag/rapidhash_v3) was released only two days ago, so numbers may improve further.\r\n\r\n> If the hash isn't of cryptographic quality, I don't know how I'd reason about an attacker's ability to control the buckets\r\n\r\nHow do we reason about the same currently, given that [some sources](https://doc.rust-lang.org/std/hash/struct.SipHasher.html) refer to it as *not* cryptographic quality either:\r\n> Although the SipHash algorithm is considered to be generally strong, it is not intended for cryptographic purposes. As such, all cryptographic uses of this implementation are strongly discouraged.\r\n\r\nThe `RapidHash` benchmarks and studies also indicate that it has an [ideal avalanche score](https://github.com/Nicoshev/rapidhash/tree/master?tab=readme-ov-file#collision-based-hash-quality-study) - is there any other test we could do that would [increase our confidence](https://gitlab.com/fwojcik/smhasher3/-/blob/main/results/README.md#passing-hashes)? Would a more seasoned hash be more welcome, such as [`HighwayHash`](https://arxiv.org/abs/1612.06257) or other ones with no known attacks and SIMD-enabled design, e.g. the ones from https://www.haikel-fazzani.eu.org/blog/post/siphash-alternatives-hash-algorithms with \"Good\" security?\r\n\r\nI would like to understand the exact threat model here, is my understanding correct that:\r\n\r\n* we fear collisions because of linear bucket iteration for identical hashes, in case of a brute-force attack, right? If this is just a worst-case scenario (not a likely outcome), we could probably choose a map which stores colliding entries in a balanced tree instead of a linked list;\r\n* we expect natural collisions to be rare, and deliberate ones to require significant effort;\r\n* as long as the attackers cannot pre-compute exactly which coins will end up in the exact same bucket, we would be fine;\r\n* we don't store unconfirmed transactions in the coins cache, only outputs that are already mined;\r\n* the inputs are really difficult to tweak, given that one of them is already a dSHA256, not a value the attacker can cheaply set to any custom value;\r\n* colliding entries will likely depend on the coins-cache size - randomizing the default slightly might help;\r\n* most likely (worst-case?) outcome is a local slowdown;\r\n* once an attack is detected, we will likely have time to mitigate it in the next version.\r\n\r\n---\r\n\r\nBut zooming out, isn't the main problem here that the dbcache is resized too often, triggering many unnecessary rehashes?\r\nWouldn't SipHash suffice here if we just pre-sized the coins cache during IBD more precisely and only recreated and shrank it after we've reached the tip (to reclaim memory)?\r\nAlso, [SaltedOutpointHasher `noexcept`](https://github.com/bitcoin/bitcoin/pull/16957) seems to have caused many of these rehashes - and I have tried reverting it and all my measurements show that we'd be faster without that change - see my preliminary measurements: https://github.com/bitcoin-dev-tools/benchcoin/pull/163\r\n",
      "created_at": "2025-05-29T12:38:43Z",
      "updated_at": "2025-05-29T17:16:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2113859955",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2113859955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2114434674",
      "pull_request_review_id": 2879083702,
      "id": 2114434674,
      "node_id": "PRRC_kwDOABII585-B7Zy",
      "diff_hunk": "@@ -44,5 +44,6 @@ class CSipHasher\n  */\n uint64_t SipHashUint256(uint64_t k0, uint64_t k1, const uint256& val);\n uint64_t SipHashUint256Extra(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);\n+uint64_t ModifiedRapidHash(uint64_t k0, uint64_t k1, const uint256& val, uint32_t extra);",
      "path": "src/crypto/siphash.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "18b2c263aab12c49350b20fa2bef407d8a9eff61",
      "original_commit_id": "104d5dd778e7bacba9613d70afc422ff676e5111",
      "in_reply_to_id": 2010137339,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Perhaps I shouldn't have used the term \"cryptographic\"; I see it's referred to as \"secure\" instead of \"cryptographic\" in some places.\r\n\r\nThere are two properties that a (keyed) hash function needs to be cryptographic:\r\n* Indistinguishable from a random function\r\n* Have larger enough output to resist practical brute-force preimage or collision attacks.\r\n\r\nRapidHash has neither. SipHash has the first (it was designed by cryptographers, and investigated cryptanalytically). HMAC-SHA256 has both.\r\n\r\nHowever, for the purpose of hash table indexing, the second property is irrelevant, as the result is taken modulo the hash table size anyway (or otherwise mapped into the range of the table size), so a large output is a lost cause anyway. However, the attacker does not get to observe the key or the hash output, which makes it much less of a concern.\r\n\r\nSo in a way, I think of SipHash as a hash function that has all properties of a cryptographic one, except for the fact that it's restricted to a 64-bit output.",
      "created_at": "2025-05-29T17:32:01Z",
      "updated_at": "2025-05-29T18:33:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32128#discussion_r2114434674",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2114434674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32128"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 47,
      "original_line": 47,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957",
    "id": 1040244326,
    "node_id": "PR_kwDOABII584-AN5m",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/25957",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/25957.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/25957.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
    "number": 25957,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "wallet: fast rescan with BIP157 block filters for descriptor wallets",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "## Description\r\n\r\nThis PR is another take of using BIP 157 block filters (enabled by `-blockfilterindex=1`) for faster wallet rescans and is a modern revival of #15845. For reviewers new to this topic I can highly recommend to read the corresponding PR review club (https://bitcoincore.reviews/15845). \r\n\r\nThe basic idea is to skip blocks for deeper inspection (i.e. looking at every single tx for matches) if our block filter doesn't match any of the block's spent or created UTXOs are relevant for our wallet. Note that there can be false-positives (see https://bitcoincore.reviews/15845#l-199 for a PR review club discussion about false-positive rates), but no false-negatives, i.e. it is safe to skip blocks if the filter doesn't match; if the filter *does* match even though there are no wallet-relevant txs in the block, no harm is done, only a little more time is spent extra.\r\n\r\nIn contrast to #15845, this solution only supports descriptor wallets, which are way more widespread now than back in the time >3 years ago. With that approach, we don't have to ever derive the relevant scriptPubKeys ourselves from keys before populating the filter, and can instead shift the full responsibility to that to the `DescriptorScriptPubKeyMan` which already takes care of that automatically. Compared to legacy wallets, the `IsMine` logic for descriptor wallets is as trivial as checking if a scriptPubKey is included in the ScriptPubKeyMan's set of scriptPubKeys (`m_map_script_pub_keys`): https://github.com/bitcoin/bitcoin/blob/e191fac4f3c37820f0618f72f0a8e8b524531ab8/src/wallet/scriptpubkeyman.cpp#L1703-L1710\r\n\r\nOne of the unaddressed issues of #15845 was that [the filter was only created once outside the loop](https://github.com/bitcoin/bitcoin/pull/15845#discussion_r343265997) and as such didn't take into account possible top-ups that have happened. This is solved here by keeping a state of ranged `DescriptorScriptPubKeyMan`'s descriptor end ranges and check at each iteration whether that range has increased since last time. If yes, we update the filter with all scriptPubKeys that have been added since the last filter update with a range index equal or higher than the last end range. Note that finding new scriptPubKeys could be made more efficient than linearly iterating through the whole `m_script_pub_keys` map (e.g. by introducing a bidirectional map), but this would mean introducing additional complexity and state and it's probably not worth it at this time, considering that the performance gain is already significant.\r\n\r\nOutput scripts from non-ranged `DescriptorScriptPubKeyMan`s (i.e. ones with a fixed set of output scripts that is never extended) are added only once when the filter is created first.\r\n\r\n## Benchmark results\r\n\r\nObviously, the speed-up indirectly correlates with the wallet tx frequency in the scanned range: the more blocks contain wallet-related transactions, the less blocks can be skipped due to block filter detection.\r\n\r\nIn a [simple benchmark](https://github.com/theStack/bitcoin/blob/fast_rescan_functional_test_benchmark/test/functional/pr25957_benchmark.py), a regtest chain with 1008 blocks (corresponding to 1 week) is mined with 20000 scriptPubKeys contained (25 txs * 800 outputs) each. The blocks each have a weight of ~2500000 WUs and hence are about 62.5% full. A global constant `WALLET_TX_BLOCK_FREQUENCY` defines how often wallet-related txs are included in a block. The created descriptor wallet (default setting of `keypool=1000`, we have 8*1000 = 8000 scriptPubKeys at the start) is backuped via the `backupwallet` RPC before the mining starts and imported via `restorewallet` RPC after. The measured time for taking this import process (which involves a rescan) once with block filters (`-blockfilterindex=1`) and once without block filters (`-blockfilterindex=0`) yield the relevant result numbers for the benchmark.\r\n\r\nThe following table lists the results, sorted from worst-case (all blocks contain wallte-relevant txs, 0% can be skipped) to best-case (no blocks contain walltet-relevant txs, 100% can be skipped) where the frequencies have been picked arbitrarily:\r\n\r\nwallet-related tx frequency; 1 tx per...    | ratio of irrelevant blocks  | w/o filters | with filters | speed gain\r\n--------------------------------------------|-----------------------------|-------------|--------------|-------------\r\n~ 10 minutes (every block)                  |              0%             |   56.806s   |   63.554s    |  ~0.9x\r\n~ 20 minutes (every 2nd block)              |           50% (1/2)         |   58.896s   |   36.076s    |  ~1.6x\r\n~ 30 minutes (every 3rd block)              |          66.67% (2/3)       |   56.781s   |   25.430s    |  ~2.2x\r\n~ 1 hour (every 6th block)                  |          83.33% (5/6)       |   58.193s   |   15.786s    |  ~3.7x\r\n~ 6 hours (every 36th block)                |          97.22% (35/36)     |   57.500s   |    6.935s    |  ~8.3x\r\n~ 1 day (every 144th block)                 |         99.31% (143/144)    |   68.881s   |    6.107s    | ~11.3x\r\n  (no txs)                                  |              100%           |   58.529s   |    5.630s    | ~10.4x\r\n\r\n\r\nSince even the (rather unrealistic) worst-case scenario of having wallet-related txs in _every_ block of the rescan range obviously doesn't take significantly longer, I'd argue it's reasonable to always take advantage of block filters if they are available and there's no need to provide an option for the user.\r\n\r\nFeedback about the general approach (but also about details like naming, where I struggled a lot) would be greatly appreciated. Thanks fly out to furszy for discussing this subject and patiently answering basic question about descriptor wallets!",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2022-08-29T22:04:41Z",
    "updated_at": "2023-11-12T12:18:22Z",
    "closed_at": "2022-10-26T15:19:51Z",
    "mergeable_state": "unknown",
    "merged_at": "2022-10-26T15:19:50Z",
    "merge_commit_sha": "48af307481af3b3e9455596b515e8ecb001672ef",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "theStack:202208-speedup_descriptor_wallet_rescan_with_block_filters",
      "ref": "202208-speedup_descriptor_wallet_rescan_with_block_filters",
      "sha": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 204970720,
        "node_id": "MDEwOlJlcG9zaXRvcnkyMDQ5NzA3MjA=",
        "name": "bitcoin",
        "full_name": "theStack/bitcoin",
        "owner": {
          "login": "theStack",
          "id": 91535,
          "node_id": "MDQ6VXNlcjkxNTM1",
          "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/theStack",
          "html_url": "https://github.com/theStack",
          "followers_url": "https://api.github.com/users/theStack/followers",
          "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
          "organizations_url": "https://api.github.com/users/theStack/orgs",
          "repos_url": "https://api.github.com/users/theStack/repos",
          "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/theStack/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/theStack/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/theStack/bitcoin",
        "archive_url": "https://api.github.com/repos/theStack/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/theStack/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/theStack/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/theStack/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/theStack/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/theStack/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/theStack/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/theStack/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/theStack/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/theStack/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/theStack/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/theStack/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/theStack/bitcoin/events",
        "forks_url": "https://api.github.com/repos/theStack/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/theStack/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/theStack/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/theStack/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/theStack/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/theStack/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/theStack/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/theStack/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/theStack/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/theStack/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/theStack/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/theStack/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/theStack/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/theStack/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/theStack/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/theStack/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:theStack/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/theStack/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/theStack/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/theStack/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/theStack/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/theStack/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/theStack/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/theStack/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/theStack/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/theStack/bitcoin/hooks",
        "svn_url": "https://github.com/theStack/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 226456,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-11-09T13:09:06Z",
        "created_at": "2019-08-28T15:59:29Z",
        "updated_at": "2022-12-07T18:05:55Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "bfce05cc341113a1e7c685950b175dee3aaf2354",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35945,
        "stargazers_count": 72139,
        "watchers_count": 72139,
        "size": 244642,
        "default_branch": "master",
        "open_issues_count": 639,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-11-12T11:48:36Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-11-12T12:23:45Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 264,
    "deletions": 34,
    "changed_files": 11,
    "commits": 8,
    "review_comments": 107,
    "comments": 28
  },
  "events": [
    {
      "event": "labeled",
      "id": 7282716135,
      "node_id": "LE_lADOABII585QwnfQzwAAAAGyFW3n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7282716135",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-29T23:09:23Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "commented",
      "id": 1230961273,
      "node_id": "IC_kwDOABII585JXvp5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1230961273",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-29T23:11:25Z",
      "updated_at": "2022-10-19T15:48:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1230961273",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-30T03:24:45Z",
      "updated_at": "2022-08-30T03:24:45Z",
      "source": {
        "issue": {
          "id": 1263730107,
          "node_id": "PR_kwDOABII5845REBZ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25297",
          "number": 25297,
          "state": "open",
          "state_reason": null,
          "title": "wallet: group independent db writes on single batched db transaction",
          "body": "The block connection process, same as many other wallet processes, contains plenty individual db writes.\r\n\r\nThis PR batches all the db transaction that occurs along each wallet workflow. Dumping all the information to disk at once atomically at the end of the process.\r\n\r\nThen, for BDB, fixed places where we are flushing to db directly on individual writes. e.g we do it in the in the chain sync/scan process, when an output that belongs to the wallet is found if the address is not inside the address book.â€¨\r\n\r\nPlus, in several places across the wallet flows, we create new `WalletBatch` objects. Which, internally, mean: Increasing the db references number, try to open the db and, for SQLite, setup and bind the statements.\r\nThis PR avoids all this overhead by sharing the same db handler instance through each entire workflow.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25297",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25297",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25297.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25297.patch"
          },
          "created_at": "2022-06-07T18:55:49Z",
          "updated_at": "2023-11-11T01:49:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-30T09:59:29Z",
      "updated_at": "2022-08-30T09:59:29Z",
      "source": {
        "issue": {
          "id": 666560839,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDU3MzgyMzM0",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19602",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19602/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19602/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19602/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19602",
          "number": 19602,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: Migrate legacy wallets to descriptor wallets",
          "body": "This PR adds a new `migratewallet` RPC which migrates a legacy wallet to a descriptor wallet. Migrated wallets will need a new backup. If a wallet has watchonly stuff in it, a new watchonly descriptor wallet will be created containing those watchonly things. The related transactions, labels, and descriptors for those watchonly things will be removed from the original wallet. Migrated wallets will not have any of the legacy things be available for fetching from `getnewaddress` or `getrawchangeaddress`. Wallets that have private keys enabled will have newly generated descriptors. Wallets with private keys disabled will not have any active `ScriptPubKeyMan`s.\r\n\r\nFor the basic HD wallet case of just generated keys, in addition to the standard descriptor wallet descriptors using the master key derived from the pre-existing hd seed, the migration will also create 3 descriptors for each HD chain in: a ranged combo external, a ranged combo internal, and a single key combo for the seed (the seed is a valid key that we can receive coins at!). The migrated wallet will then have newly generated descriptors as the active `ScriptPubKeyMan`s. This is equivalent to creating a new descriptor wallet and importing the 3 descriptors for each HD chain. For wallets containing non-HD keys, each key will have its own combo descriptor.\r\n\r\nThere are also tests.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "milestone": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/54",
            "html_url": "https://github.com/bitcoin/bitcoin/milestone/54",
            "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/54/labels",
            "id": 7150037,
            "node_id": "MI_kwDOABII584AbRnV",
            "number": 54,
            "state": "closed",
            "title": "24.0",
            "description": "",
            "creator": {
              "login": "laanwj",
              "id": 126646,
              "node_id": "MDQ6VXNlcjEyNjY0Ng==",
              "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/laanwj",
              "html_url": "https://github.com/laanwj",
              "followers_url": "https://api.github.com/users/laanwj/followers",
              "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
              "organizations_url": "https://api.github.com/users/laanwj/orgs",
              "repos_url": "https://api.github.com/users/laanwj/repos",
              "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/laanwj/received_events",
              "type": "User",
              "site_admin": false
            },
            "open_issues": 0,
            "closed_issues": 159,
            "created_at": "2021-09-14T08:27:02Z",
            "updated_at": "2022-11-29T15:44:44Z",
            "closed_at": "2022-11-29T15:44:44Z"
          },
          "locked": false,
          "comments": 50,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19602",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19602",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19602.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19602.patch"
          },
          "closed_at": "2022-09-01T19:44:11Z",
          "created_at": "2020-07-27T20:22:25Z",
          "updated_at": "2023-03-13T22:00:30Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1232855764,
      "node_id": "IC_kwDOABII585Je-LU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1232855764",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-31T12:12:57Z",
      "updated_at": "2022-08-31T12:38:34Z",
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nLimiting the functionality to descriptor wallets is fine. We could add an argument to `loadwallet` that prevents a rescan, so a user can migrate (#19602) to a descriptor wallet and then rescan.\r\n\r\nIs there anything in @jamesob's #23549 you can reuse here?\r\n\r\nThe `rescanwallet` RPC help should mention that having `-blockfilterindex=1` dramatically speeds things up. It might also be good to have log message somewhere that it's using the block filter.\r\n\r\nI tried a rescan from genesis on a simple mainnet wallet. It was blazing fast (in comparison) and it found all transactions. It's  also slightly faster than the little helper script I wrote for [#23549](https://github.com/bitcoin/bitcoin/pull/23549#issuecomment-1149904391).\r\n\r\nBonus feature for a followup: fetch any matching pruned blocks.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1232855764",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7295858030,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAGy3fVu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7295858030",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-31T12:14:08Z"
    },
    {
      "event": "subscribed",
      "id": 7295858036,
      "node_id": "SE_lADOABII585QwnfQzwAAAAGy3fV0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7295858036",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-31T12:14:08Z"
    },
    {
      "event": "labeled",
      "id": 7308714242,
      "node_id": "LE_lADOABII585QwnfQzwAAAAGzoiEC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7308714242",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-01T21:15:25Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7314407832,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAGz-QGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314407832",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:06:51Z"
    },
    {
      "event": "unlabeled",
      "id": 7314440065,
      "node_id": "UNLE_lADOABII585QwnfQzwAAAAGz-X-B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314440065",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:12:09Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1235691177,
      "node_id": "IC_kwDOABII585Jpyap",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1235691177",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:23:16Z",
      "updated_at": "2022-09-02T16:23:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased on master, with a few changes and an extra commit (see below).\r\n\r\n@Sjors:\r\n\r\nThanks for your initial feedback, much appreciated!\r\n\r\n> Limiting the functionality to descriptor wallets is fine. We could add an argument to `loadwallet` that prevents a rescan, so a user can migrate (#19602) to a descriptor wallet and then rescan.\r\n\r\nAgree, I think this sounds like a useful follow-up idea.\r\n\r\n> Is there anything in @jamesob's #23549 you can reuse here?\r\n\r\nNot that I could see; on contrast to scanblocks, the filter set is created from wallet-internal source rather than external user input and also has to be updated continuously.\r\n\r\n> The `rescanwallet` RPC help should mention that having `-blockfilterindex=1` dramatically speeds things up. It might also be good to have log message somewhere that it's using the block filter.\r\n\r\nDone, added [an extra commit](https://github.com/bitcoin/bitcoin/pull/25957/commits/d0114e02cddd9bf1cc8760ebe95941f80609259b) that documents the speedup possibilty for all RPCs that work on descriptor wallet and (possibly) involve a rescan (`rescanblockchain`, `importdescriptors`, `restorewallet` and `loadwallet`; did I miss any?). Also extended the \"Rescan started from block...\" debug message, showing if the fast or slow variant is used.\r\n\r\n> \r\n> I tried a rescan from genesis on a simple mainnet wallet. It was blazing fast (in comparison) and it found all transactions. It's also slightly faster than the little helper script I wrote for [#23549](https://github.com/bitcoin/bitcoin/pull/23549#issuecomment-1149904391).\r\n\r\nðŸš€ ðŸš€ ðŸš€ \r\n\r\n> \r\n> Bonus feature for a followup: fetch any matching pruned blocks.\r\n\r\nSounds like a charming idea ðŸ‘Œ \r\n\r\nNote that this PR is covered in the [PR review club for next wednesday](https://bitcoincore.reviews/25957), hosted by LarryRuane.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1235691177",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7314502885,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAGz-nTl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314502885",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:23:17Z"
    },
    {
      "event": "subscribed",
      "id": 7314502890,
      "node_id": "SE_lADOABII585QwnfQzwAAAAGz-nTq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314502890",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:23:17Z"
    },
    {
      "event": "mentioned",
      "id": 7314502910,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAGz-nT-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314502910",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:23:17Z"
    },
    {
      "event": "subscribed",
      "id": 7314502918,
      "node_id": "SE_lADOABII585QwnfQzwAAAAGz-nUG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7314502918",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-02T16:23:17Z"
    },
    {
      "event": "reviewed",
      "id": 1096463603,
      "node_id": "PRR_kwDOABII585BWrTz",
      "url": null,
      "actor": null,
      "commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nIt might be too controversial to be part of this PR, but I wonder (not suggesting, yet) if after this PR we should enable blockfilterindex by default when a user has at least one descriptor wallet? ",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1096463603",
      "submitted_at": "2022-09-05T15:23:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1095833132,
      "node_id": "PRR_kwDOABII585BURYs",
      "url": null,
      "actor": null,
      "commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, I'll try to do a more complete code review in the next few days.",
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1095833132",
      "submitted_at": "2022-09-05T19:35:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7330926455,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG09Q93",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7330926455",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:17:21Z"
    },
    {
      "event": "commented",
      "id": 1238241095,
      "node_id": "IC_kwDOABII585Jzg9H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238241095",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:35:39Z",
      "updated_at": "2022-09-06T14:35:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed with most of the suggestions from @stickies-v and @LarryRuane. Thanks for your reviews, very good points!",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1238241095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7331100758,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG097hW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7331100758",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:35:39Z"
    },
    {
      "event": "subscribed",
      "id": 7331100768,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG097hg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7331100768",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:35:39Z"
    },
    {
      "event": "mentioned",
      "id": 7331100780,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG097hs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7331100780",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:35:39Z"
    },
    {
      "event": "subscribed",
      "id": 7331100793,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG097h5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7331100793",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T14:35:39Z"
    },
    {
      "event": "commented",
      "id": 1238408812,
      "node_id": "IC_kwDOABII585J0J5s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238408812",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T16:50:09Z",
      "updated_at": "2022-09-06T16:50:09Z",
      "author_association": "MEMBER",
      "body": "Suggest renaming to \"turbo rescan\" for more review :-)",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1238408812",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "commented",
      "id": 1238538441,
      "node_id": "IC_kwDOABII585J0pjJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1238538441",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-06T19:01:15Z",
      "updated_at": "2022-09-06T19:01:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Performance test report: With the master branch, and an empty wallet (which is the best case for this PR), on mainnet, the `rescanblockchain` time was 90 minutes. With this PR, it was 10 minutes. This ratio of 9x is pretty close to the last row in the table in the description. \r\n\r\nOn signet, the PR branch is actually slower; this is probably due to the fact that so many blocks are empty or nearly empty; the time needed to check the filter is greater than the time to check the block directly.\r\n\r\nBut of course, mainnet is what really matters.",
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1238538441",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1098357284,
      "node_id": "PRR_kwDOABII585Bd5ok",
      "url": null,
      "actor": null,
      "commit_id": "f9052af3988304a3903da085296552e60c184431",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "Concept ACK,\r\nThis looks like it is over my head but I'm going to give this a shot for the pr review club.",
      "user": {
        "login": "amovfx",
        "id": 45839100,
        "node_id": "MDQ6VXNlcjQ1ODM5MTAw",
        "avatar_url": "https://avatars.githubusercontent.com/u/45839100?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amovfx",
        "html_url": "https://github.com/amovfx",
        "followers_url": "https://api.github.com/users/amovfx/followers",
        "following_url": "https://api.github.com/users/amovfx/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amovfx/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amovfx/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amovfx/subscriptions",
        "organizations_url": "https://api.github.com/users/amovfx/orgs",
        "repos_url": "https://api.github.com/users/amovfx/repos",
        "events_url": "https://api.github.com/users/amovfx/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amovfx/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1098357284",
      "submitted_at": "2022-09-06T23:30:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T05:51:02Z",
      "updated_at": "2022-09-08T05:51:02Z",
      "source": {
        "issue": {
          "id": 627836673,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDI1NTMxMDg4",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19116",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19116/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19116/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19116/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19116",
          "number": 19116,
          "state": "closed",
          "state_reason": null,
          "title": "[WIP] wallet: use BlockFilterIndex in ScanForWalletTransactions",
          "body": "goal is to improve rescan performance significantly, lots more work to do",
          "user": {
            "login": "pstratem",
            "id": 620611,
            "node_id": "MDQ6VXNlcjYyMDYxMQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pstratem",
            "html_url": "https://github.com/pstratem",
            "followers_url": "https://api.github.com/users/pstratem/followers",
            "following_url": "https://api.github.com/users/pstratem/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/pstratem/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/pstratem/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
            "organizations_url": "https://api.github.com/users/pstratem/orgs",
            "repos_url": "https://api.github.com/users/pstratem/repos",
            "events_url": "https://api.github.com/users/pstratem/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/pstratem/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 13,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19116",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19116",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19116.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19116.patch"
          },
          "closed_at": "2022-03-21T13:59:04Z",
          "created_at": "2020-05-30T22:24:46Z",
          "updated_at": "2023-09-08T12:10:21Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7349621465,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG2ElLZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349621465",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:50:00Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7349626608,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG2Embw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349626608",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:50:43Z"
    },
    {
      "event": "commented",
      "id": 1240976766,
      "node_id": "IC_kwDOABII585J981-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1240976766",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:56:33Z",
      "updated_at": "2022-09-08T16:56:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed again with the following changes:\r\n* took @stickies-v's suggestion to overload `DescriptorScriptPubKeyMan::GetScriptPubKeys(...)` in order to deduplicate code (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964632557)\r\n* removed the adaption (earlier first commit) of `wallet_import_rescan.py`: as @LarryRuane found out, this test only works for legacy wallets (it uses RPCs like `importprivkey`, `importaddress` etc.) and hence is at this stage not useful for testing this PR\r\n* added a new test `wallet_fast_rescan.py` which tests the top-up detection by repeatedly creating txs sending to the address of each wallet descriptor's range end, and then comparing the found wallet txs after slow and fast rescan each",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1240976766",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7349670084,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG2ExDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349670084",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:56:34Z"
    },
    {
      "event": "subscribed",
      "id": 7349670089,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG2ExDJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349670089",
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:56:34Z"
    },
    {
      "event": "mentioned",
      "id": 7349670111,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG2ExDf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349670111",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:56:34Z"
    },
    {
      "event": "subscribed",
      "id": 7349670119,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG2ExDn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349670119",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T16:56:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7349723191,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG2E-A3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7349723191",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-08T17:04:02Z"
    },
    {
      "event": "reviewed",
      "id": 1101562458,
      "node_id": "PRR_kwDOABII585BqIJa",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "I don't have the skill to really review this. But I ran this over testnet and def got a speed improvement. 3:08.55 vs 3:50.80. This looks like a win.\r\n\r\nblockfilterindex=1\r\n`\r\n{\r\n  \"start_height\": 0,\r\n  \"stop_height\": 2345883\r\n}\r\n/Users/andrewoseen/git/bitcoin/build/src/bitcoin-cli -chain=test   0.00s user 0.00s system 0% cpu 3:08.55 total`\r\n\r\nblockfilterindex=0\r\n`\r\n{\r\n  \"start_height\": 0,\r\n  \"stop_height\": 2345883\r\n}\r\n/Users/andrewoseen/git/bitcoin/build/src/bitcoin-cli -chain=test   0.00s user 0.00s system 0% cpu 3:50.80 total\r\n`",
      "user": {
        "login": "amovfx",
        "id": 45839100,
        "node_id": "MDQ6VXNlcjQ1ODM5MTAw",
        "avatar_url": "https://avatars.githubusercontent.com/u/45839100?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amovfx",
        "html_url": "https://github.com/amovfx",
        "followers_url": "https://api.github.com/users/amovfx/followers",
        "following_url": "https://api.github.com/users/amovfx/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amovfx/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amovfx/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amovfx/subscriptions",
        "organizations_url": "https://api.github.com/users/amovfx/orgs",
        "repos_url": "https://api.github.com/users/amovfx/repos",
        "events_url": "https://api.github.com/users/amovfx/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amovfx/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1101562458",
      "submitted_at": "2022-09-09T00:39:29Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "commented",
      "id": 1241412647,
      "node_id": "IC_kwDOABII585J_nQn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1241412647",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-09T01:58:19Z",
      "updated_at": "2022-09-09T01:58:19Z",
      "author_association": "MEMBER",
      "body": ">We could add an argument to loadwallet that prevents a rescan, so a user can migrate (#19602) to a descriptor wallet and then rescan.\r\n\r\nFeels like a footgun. Would rather a param that migrates without \"loading\". But I suspect extending this to support legacy wallets (outside the scope of this PR) wouldn't be very hard either.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1241412647",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1101601457,
      "node_id": "PRR_kwDOABII585BqRqx",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1101601457",
      "submitted_at": "2022-09-09T01:58:29Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1104388445,
      "node_id": "PRR_kwDOABII585B06Fd",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1104388445",
      "submitted_at": "2022-09-12T16:21:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1104755402,
      "node_id": "PRR_kwDOABII585B2TrK",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1104755402",
      "submitted_at": "2022-09-12T19:54:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1104453139,
      "node_id": "PRR_kwDOABII585B1J4T",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1104453139",
      "submitted_at": "2022-09-12T22:13:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1105753065,
      "node_id": "PRR_kwDOABII585B6HPp",
      "url": null,
      "actor": null,
      "commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1105753065",
      "submitted_at": "2022-09-13T12:59:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1105779173,
      "node_id": "PRR_kwDOABII585B6Nnl",
      "url": null,
      "actor": null,
      "commit_id": "df89e3c0c4007c73f241808674bc799ab6fec490",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1105779173",
      "submitted_at": "2022-09-13T13:14:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7377553574,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG3vIim",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7377553574",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-13T14:59:13Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7377616798,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG3vX-e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7377616798",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-13T15:05:54Z"
    },
    {
      "event": "commented",
      "id": 1245625925,
      "node_id": "IC_kwDOABII585KPr5F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1245625925",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-13T16:05:37Z",
      "updated_at": "2022-09-13T16:05:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed with most reviewer's suggestions taken into account (thanks a lot!). Most significantly, the std::map key type for storing the end ranges was changed from `DescriptorPubKeyMan` pointers to SPK-Man IDs. This leads to a little more code (and unnecessary re-computation of IDs after filter repopulation), but seems to be the more clean design choice; see also discussion https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968875953.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1245625925",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1106661913,
      "node_id": "PRR_kwDOABII585B9lIZ",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK https://github.com/bitcoin/bitcoin/pull/25957/commits/0d611a80b43be1246047d60d93288e0648e8aeb8",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1106661913",
      "submitted_at": "2022-09-14T02:06:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1110709321,
      "node_id": "PRR_kwDOABII585CNBRJ",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Could make 1b6b09e3 simpler by removing the second `if (!skip_block) {` and adding it only inside the else path (this works because the `block` is null).\r\n\r\n```c++\r\n} else if (!skip_block) {\r\n    // could not scan block, keep scanning but record this block as the most recent failure\r\n    result.last_failed_block = block_hash;\r\n    result.status = ScanResult::FAILURE;\r\n}\r\n```\r\n\r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1110709321",
      "submitted_at": "2022-09-16T13:43:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1110730675,
      "node_id": "PRR_kwDOABII585CNGez",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1110730675",
      "submitted_at": "2022-09-16T13:56:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1110766232,
      "node_id": "PRR_kwDOABII585CNPKY",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "As the purpose of the `FastWalletRescanFilter` is track the descriptors to update the filter set structure, what about renaming the class to something like `FilterSetTracker`?",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1110766232",
      "submitted_at": "2022-09-16T14:19:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1120005419,
      "node_id": "PRR_kwDOABII585Cwe0r",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1120005419",
      "submitted_at": "2022-09-26T11:04:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1123671424,
      "node_id": "PRR_kwDOABII585C-d2A",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1123671424",
      "submitted_at": "2022-09-28T21:51:19Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1124847220,
      "node_id": "PRR_kwDOABII585DC850",
      "url": null,
      "actor": null,
      "commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code for 0d611a80b43be1246047d60d93288e0648e8aeb8 looks good modulo potential overflow issue in https://github.com/bitcoin/bitcoin/pull/25957/commits/ae320ebc5ec857e783064ea8188b95cdd4b8a5ee#r982393105\r\n\r\nHowever the top up doesn't seem to work for me, e.g. when I set keypool=20 it misses at least one address (with a receive and send on it) that had index 21. (`getaddressinfo` knows about it, so it's not an import mistake)\r\n\r\n_Update 1_: actually I tested an older version, trying again...\r\n_Update 2_: ~no, it's really missing stuff, including a transaction received on a `wpkh()` descriptor with index 2.~\r\n_Update 3_ no, it's not, I had a few super stingy transactions in the mempool for several weeks, so the order is different. Maybe I should just sort by amount to compare.\r\n_Update 4_ I set `keypool=10` and it found a transaction received at index 9, but not at index 10.\r\n_Update 5_ I initially imported with `\"range\": [0-3]` but with a higher `keypool` value. I tried again, this time dropping the range argument entirely. But I still get the same issue. The two transactions are many blocks apart.\r\n\r\nReview pro tip:\r\n1. export descriptors from an existing wallet with `listdescriptors`\r\n2. put them in a file, strip the newlines, remove `{\"descriptors\": ...}` and only keep the array, drop `range` and `next` (_do not drop the range for inactive descriptors_)\r\n3. launch with `keypool=3`, create a watch-only wallet\r\n4. `cat tmp | src/bitcoin-cli -rpcwallet=... -stdin importdescriptors`\r\n\r\nWith QT it's easy to compare the wallets by switching between them in the transaction list. Only the labels should change. Some timetamps will change because the original wallet saw them enter the mempool, while the rescan only knows what block it was in.\r\n\r\nYou may need larger number for `keypool` if something is missing (`keypool is effectively the [gap limit](https://bitcoin.stackexchange.com/a/87552)). But don't set it too high, because then you won't test the on the fly topup mechanism.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1124847220",
      "submitted_at": "2022-09-30T09:18:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1126557919,
      "node_id": "PRR_kwDOABII585DJejf",
      "url": null,
      "actor": null,
      "commit_id": "1b6b09e399773c4bac56afead60e4d29e7fbb010",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1126557919",
      "submitted_at": "2022-09-30T09:41:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7500212837,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG_DCpl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500212837",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T10:55:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7500215041,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAG_DDMB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500215041",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T10:57:33Z"
    },
    {
      "event": "commented",
      "id": 1264325950,
      "node_id": "IC_kwDOABII585LXBU-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264325950",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T10:58:09Z",
      "updated_at": "2022-10-01T10:58:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the detailled reviews, much appreciated! Force-pushed with the following changes:\r\n- introduced a new commit which removes the unneeded \"const\" return value qualifier from the `ScriptPubKeyMan::GetScriptPubKeys()` interface and overruled methods (could also be done in the same commit extending the method for descriptor SPKs, but I think it's good practice to not mix refactor commits with ones introducing new functionality) (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979865164)\r\n- fixed potential overflow in `DescriptorScriptPubKeyMan::GetScriptPubKeys(...)` by casting `m_map_script_pub_keys.size()` result to int32_t (I'd argue that the overflow risk for this cast is neglectable, considering that we'd need > 2 billion entries for it to hit) (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982393105)\r\n- assert `desc_spkm` after dynamic casting to `DescriptorScriptPubKeyMan` (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979863337)\r\n- use `const auto&` in iteration loop of the last range ends (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979863823)\r\n- rename `matches_result` to `matches_block` and using the dereference operator for value access (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982873205)\r\n- introduced a commit for showing a log message for each block that is _not_ skipped (can either be if our filter matches, or if the block filter is not found), if we use fast rescan (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r984412126)\r\n  \r\nThe following suggestions I think would be good candidates for follow-ups:\r\n- encapsulate the fast rescan block filter update and matching logic into an own method in `FastWalletRescanFilter` (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982871332)\r\n- change the `FastWalletRescanFilter` interface by letting user pass in descriptor SPKs (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r984347822)\r\n- introduce new logging category like e.g. \"scan\" (this could be seen as controversial and probably needs more detailled work, e.g. \"do we really need an extra logging category for this?\" / \"what other messages have to be in this category?\")\r\n\r\n> However the top up doesn't seem to work for me, e.g. when I set keypool=20 it misses at least one address (with a receive and send on it) that had index 21. (getaddressinfo knows about it, so it's not an import mistake)\r\n\r\n@Sjors: interesting, could you share more details about the specific test-case (either here, or if preferred, in private via IRC)? Were any of the addresses on indices 0-20 used before in earlier blocks? (Do you think it's possible to easily reproduce this scenario by simply modifying the functional test in the last commit?)",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1264325950",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7500215867,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_DDY7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500215867",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T10:58:09Z"
    },
    {
      "event": "subscribed",
      "id": 7500215869,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_DDY9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500215869",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T10:58:09Z"
    },
    {
      "event": "commented",
      "id": 1264355646,
      "node_id": "IC_kwDOABII585LXIk-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1264355646",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T12:54:18Z",
      "updated_at": "2022-10-01T12:54:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm responsing to @furszy's review comments directly here as they were not given in code-review discussion threads:\r\n> Could make [1b6b09e](https://github.com/bitcoin/bitcoin/commit/1b6b09e399773c4bac56afead60e4d29e7fbb010) simpler by removing the second `if (!skip_block) {` and adding it only inside the else path (this works because the `block` is null).\r\n> \r\n> ```c++\r\n> } else if (!skip_block) {\r\n>     // could not scan block, keep scanning but record this block as the most recent failure\r\n>     result.last_failed_block = block_hash;\r\n>     result.status = ScanResult::FAILURE;\r\n> }\r\n> ```\r\n\r\nDid consider your suggestion, and I agree that it reduces the diff complexity (wouldn't need to alter indenation), but preferred the current version of as I think it's slightly more readable to surround the whole logic with the `!skip_block` condition (having the condition only at the else-branch could lead to confusion)\r\n\r\n> As the purpose of the `FastWalletRescanFilter` is track the descriptors to update the filter set structure, what about renaming the class to something like `FilterSetTracker`?\r\n\r\nI think that rename would fit along well with Sjor's idea of changing the class interface to be more generic (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r984347822), for a potential follow-up.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1264355646",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7500374732,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_DqLM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500374732",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T12:54:18Z"
    },
    {
      "event": "subscribed",
      "id": 7500374736,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_DqLQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7500374736",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-01T12:54:18Z"
    },
    {
      "event": "commented",
      "id": 1265163696,
      "node_id": "IC_kwDOABII585LaN2w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265163696",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T09:19:47Z",
      "updated_at": "2022-10-03T11:20:34Z",
      "author_association": "MEMBER",
      "body": "> Were any of the addresses on indices 0-20 used before in earlier blocks?\r\n\r\nYes, the number was ficitious, but the wallet received coins on index `keypoolsize - 1` and then many blocks later on `keypoolsize`. The latter did not get picked up, suggesting the topup didn't happen.\r\n\r\n(still the case as of c6c08603a334c1f2cd13023c878b9e42418f9b13)\r\n\r\nI'll see if I can reproduce with a test case or with a doxxable wallet.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265163696",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1128111895,
      "node_id": "PRR_kwDOABII585DPZ8X",
      "url": null,
      "actor": null,
      "commit_id": "c6c08603a334c1f2cd13023c878b9e42418f9b13",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1128111895",
      "submitted_at": "2022-10-03T10:04:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "commented",
      "id": 1265224042,
      "node_id": "IC_kwDOABII585Laclq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265224042",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T10:10:59Z",
      "updated_at": "2022-10-03T11:10:20Z",
      "author_association": "MEMBER",
      "body": "> introduce new logging category like e.g. \"scan\" (this could be seen as controversial and probably needs more detailled work, e.g. \"do we really need an extra logging category for this?\" / \"what other messages have to be in this category?\")\r\n\r\nAdding a log category is not that much overhead. They've been added on an ad hoc basis before. See [git blame](https://github.com/bitcoin/bitcoin/blame/7281fac2e0a41685adff024669b44c5d6586e941/src/logging.cpp#L152-L184), with not much drama. E.g. #23235 added four new categories with just the motivation that the main log was too noisy.\r\n\r\nI'm concept meh on 5eb58340b21f6f7814eaee626e2263f1f1e95564. It seems fine to keep it const, unless someone has a good reason to edit the filter set.\r\n\r\n\r\n> * fixed potential overflow in `DescriptorScriptPubKeyMan::GetScriptPubKeys(...)` by casting `m_map_script_pub_keys.size()` result to int32_t (I'd argue that the overflow risk for this cast is neglectable, considering that we'd need > 2 billion entries for it to hit)\r\n\r\nIt's probably not neglible for a determined fuzzer :-)\r\n\r\n[BIP32 allows](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#extended-keys ) 2^32 child keys, but because a descriptor can't be both hardened and unhardened, the maximum for a regular descriptor is 2^31. Combo descriptors return 4 `script_pub_keys`. This reveals two problems:\r\n\r\n1. `m_map_script_pub_keys` size should be treated as a 64 bit (with a max of 33 bit)\r\n2. We should not assume a 1 on 1 relation between the maximum _index_ and the size of `m_map_script_pub_keys`, only `m_map_script_pub_keys[script]` can be used to determine an index.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265224042",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "commented",
      "id": 1265318499,
      "node_id": "IC_kwDOABII585Lazpj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265318499",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T11:42:40Z",
      "updated_at": "2022-10-03T11:49:09Z",
      "author_association": "MEMBER",
      "body": "In the test `KEYPOOL_SIZE` was larger than `NUM_BLOCKS` ~so it would not actually top up~ (actually it did topup). I ~also~ refactored the test to use the \"natural\" wallet topup mechanism through `getnewaddress`, which I find easier to follow.\r\n\r\nThis unfortunately doesn't reproduce the problem... https://github.com/bitcoin/bitcoin/commit/81324b9b5c617d01e64d25a37ec5b1345b6ae9d1",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265318499",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "commented",
      "id": 1265346460,
      "node_id": "IC_kwDOABII585La6ec",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265346460",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T12:08:33Z",
      "updated_at": "2022-10-03T12:11:38Z",
      "author_association": "MEMBER",
      "body": "Aaah, oops. This was an `inactive` descriptor. There's an open question* on how to deal with inactive descriptors when restoring a backup, but that's orthogonal to this PR.\r\n\r\n* = if it's a regular backup, then if the backup was made when the descriptor was active, it will topup and find new transactions. If the backup was made when it was inactive, the backup would have the right `range`. The only problem is when importing the descriptors directly. When _importing_ a descriptor that's inactive we should probably top up it anyway (perhaps unless the user explicitly sets a range for an inactive descriptor?)",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265346460",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "commented",
      "id": 1265457828,
      "node_id": "IC_kwDOABII585LbVqk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265457828",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T13:40:24Z",
      "updated_at": "2022-10-03T13:40:24Z",
      "author_association": "MEMBER",
      "body": " > The only problem is when importing the descriptors directly. When _importing_ a descriptor that's inactive we should probably top up it anyway (perhaps unless the user explicitly sets a range for an inactive descriptor?)\r\n\r\n@Sjors, have you checked `CWallet::AddWalletDescriptor`?, imported descriptors are topped up right before adding them to the wallet there (before setting them as active or inactive). \r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265457828",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7507392630,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_ebh2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7507392630",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T13:40:24Z"
    },
    {
      "event": "subscribed",
      "id": 7507392646,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_ebiG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7507392646",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T13:40:24Z"
    },
    {
      "event": "commented",
      "id": 1265532489,
      "node_id": "IC_kwDOABII585Lbn5J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265532489",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:29:38Z",
      "updated_at": "2022-10-03T14:29:38Z",
      "author_association": "MEMBER",
      "body": "@furszy that's only once. The example inactive descriptor I imported would need ongoing topups.  But I think the slow rescan would have the same issue.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265532489",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7507865271,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_gO63",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7507865271",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:29:38Z"
    },
    {
      "event": "subscribed",
      "id": 7507865279,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_gO6_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7507865279",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:29:38Z"
    },
    {
      "event": "commented",
      "id": 1265564579,
      "node_id": "IC_kwDOABII585Lbvuj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1265564579",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:43:55Z",
      "updated_at": "2022-10-03T14:45:15Z",
      "author_association": "MEMBER",
      "body": "> @furszy that's only once. The example inactive descriptor I imported would need ongoing topups. But I think the slow rescan would have the same issue.\r\n\r\nGuess that you are deriving keys externally, that are outside of the pre-generated keypool range?\r\n\r\nBecause otherwise the wallet should detect them, we don't differentiate active from inactive descriptors for the, per block, used keys top up.\r\n\r\nedit, just saw https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1124847220..",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265564579",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7508003807,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_gwvf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7508003807",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:43:55Z"
    },
    {
      "event": "subscribed",
      "id": 7508003819,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_gwvr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7508003819",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-03T14:43:55Z"
    },
    {
      "event": "commented",
      "id": 1266767745,
      "node_id": "IC_kwDOABII585LgVeB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266767745",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T10:55:05Z",
      "updated_at": "2022-10-04T10:55:05Z",
      "author_association": "CONTRIBUTOR",
      "body": "@Sjors: Thanks, I can confirm that running `importdescriptors` with a range descriptor that is inactive (which is the default if `active` is not explicitly specified) misses transactions for fast wallet rescan in the current version, while the slow rescan finds them all. See the following functional test patch to reproduce (slow rescan finds all 48 txs, while the fast rescan only finds 8, failing the assertion `assert_equal(len(txids_fast), NUM_DESCRIPTORS * NUM_BLOCKS)`):\r\n<details>\r\n<summary>Patch to reproduce top-up issue</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/wallet_fast_rescan.py b/test/functional/wallet_fast_rescan.py\r\nindex d3a62dbc0b..9180bd2aab 100755\r\n--- a/test/functional/wallet_fast_rescan.py\r\n+++ b/test/functional/wallet_fast_rescan.py\r\n@@ -41,7 +41,8 @@ class WalletFastRescanTest(BitcoinTestFramework):\r\n         WALLET_BACKUP_FILENAME = os.path.join(node.datadir, 'wallet.bak')\r\n         node.createwallet(wallet_name='topup_test', descriptors=True)\r\n         w = node.get_wallet_rpc('topup_test')\r\n-        assert_equal(len(w.listdescriptors()['descriptors']), NUM_DESCRIPTORS)\r\n+        descriptors = w.listdescriptors()['descriptors']\r\n+        assert_equal(len(descriptors), NUM_DESCRIPTORS)\r\n         w.backupwallet(WALLET_BACKUP_FILENAME)\r\n\r\n         self.log.info(f\"Create txs sending to end range address of each descriptor, triggering top-ups\")\r\n@@ -56,14 +57,18 @@ class WalletFastRescanTest(BitcoinTestFramework):\r\n             self.generate(node, 1)\r\n\r\n         self.log.info(\"Import wallet backup with block filter index\")\r\n+        node.createwallet(wallet_name='rescan_fast', descriptors=True, disable_private_keys=True, blank=True)\r\n+        w = node.get_wallet_rpc('rescan_fast')\r\n         with node.assert_debug_log(['fast variant using block filters']):\r\n-            node.restorewallet('rescan_fast', WALLET_BACKUP_FILENAME)\r\n+            res = w.importdescriptors([{\"desc\": descriptor['desc'], \"timestamp\": 0} for descriptor in descriptors])\r\n         txids_fast = self.get_wallet_txids(node, 'rescan_fast')\r\n\r\n         self.restart_node(0, [f'-keypool={KEYPOOL_SIZE}', '-blockfilterindex=0'])\r\n         self.log.info(\"Import wallet backup w/o block filter index\")\r\n+        node.createwallet(wallet_name='rescan_slow', descriptors=True, disable_private_keys=True, blank=True)\r\n+        w = node.get_wallet_rpc('rescan_slow')\r\n         with node.assert_debug_log(['slow variant inspecting all blocks']):\r\n-            node.restorewallet(\"rescan_slow\", WALLET_BACKUP_FILENAME)\r\n+            res = w.importdescriptors([{\"desc\": descriptor['desc'], \"timestamp\": 0} for descriptor in descriptors])\r\n         txids_slow = self.get_wallet_txids(node, 'rescan_slow')\r\n\r\n         assert_equal(len(txids_slow), NUM_DESCRIPTORS * NUM_BLOCKS)\r\n```\r\n\r\n</details>\r\n\r\nThe obvious solution is to not only take active SPKMs for potential filter top-ups into account, but simply all SPKMs with range descriptors (which was proposed already earlier by @furszy: https://github.com/bitcoin/bitcoin/pull/25957#discussion_r973054394). Will tackle this and other code-review comments (w.r.t. logging, overflow handling) in a bit.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1266767745",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7515183646,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_8Joe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7515183646",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T10:55:06Z"
    },
    {
      "event": "subscribed",
      "id": 7515183656,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_8Joo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7515183656",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T10:55:06Z"
    },
    {
      "event": "mentioned",
      "id": 7515183670,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAG_8Jo2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7515183670",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T10:55:06Z"
    },
    {
      "event": "subscribed",
      "id": 7515183675,
      "node_id": "SE_lADOABII585QwnfQzwAAAAG_8Jo7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7515183675",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T10:55:06Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7518317276,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAHAIGrc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7518317276",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T16:36:59Z"
    },
    {
      "event": "commented",
      "id": 1267271756,
      "node_id": "IC_kwDOABII585LiQhM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1267271756",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T16:37:05Z",
      "updated_at": "2022-10-04T16:42:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed with the following changes (can be easily reviewed via `$ git range-diff c6c08603...4fbbb9ff`):\r\n* fixed the potential overflow issue by ~~removing the `script_pub_keys.reserve()` call completely~~ reserving the worst-case of `m_map_scriptPubKeys.size()` (as in master now), considering \r\n> \"We should not assume a 1 on 1 relation between the maximum index and the size of m_map_script_pub_keys, only m_map_script_pub_keys[script] can be used to determine an index.\"\r\n\r\n(see https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265224042; also, following the principle of _\"premature optimization is the root of all evil\"_ here; compared to the performance boost by fast rescans (i.e. skipping blocks), the time spent for collecting the scriptPubKeys for top-up into a `std::unordered_set` every now and then seems to be small enough to be neglectable and not bother optimizing hash-table buckets) \r\n* fixed the [missing top-ups](https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1124847220) for non-active SPKMs by taking all SPKMs with range descriptors into account, instead of only active SPKMs\r\n* introduced new logging category `BCLog::SCAN` (`\"scan\"`) that is used for showing messages for each block that is not skipped in the course of a fast rescan (https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1265224042)\r\n* extended the functional test with the case of \"import non-active range descriptors\" (which is fixed above)\r\n\r\n> I'm concept meh on https://github.com/bitcoin/bitcoin/commit/5eb58340b21f6f7814eaee626e2263f1f1e95564. It seems fine to keep it const, unless someone has a good reason to edit the filter set.\r\n\r\nUsing `const` for return-by-value types is AFAIK pretty pointless (note that we are not returning a pointer or reference here) or at least obsolete advice, see e.g.: https://stackoverflow.com/a/8406966 / https://stackoverflow.com/a/8716406",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1267271756",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7518353939,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAHAIPoT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7518353939",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T16:42:12Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-06T19:00:53Z",
      "updated_at": "2022-10-06T19:00:53Z",
      "source": {
        "issue": {
          "id": 1045818438,
          "node_id": "PR_kwDOABII584uJavG",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23443",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23443/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23443/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23443/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/23443",
          "number": 23443,
          "state": "closed",
          "state_reason": null,
          "title": "p2p: Erlay support signaling",
          "body": "This is a part of the Erlay project:\r\n- [parent PR](https://github.com/bitcoin/bitcoin/pull/21515)\r\n- [associated BIP-330](https://github.com/bitcoin/bips/pull/1376).\r\n\r\n-------\r\n\r\nThis PR adds a new p2p message `sendtxrcncl` signaling for reconciliation support.\r\nBefore sending that message, a node is supposed to \"pre-register\" the peer by generating and storing an associated reconciliation salt component.\r\nOnce the salts are exchanged within this new message, nodes \"register\" each other for future reconciliations by computing and storing the aggregate salt, along with the reconciliation parameters based on the connection direction.",
          "user": {
            "login": "naumenkogs",
            "id": 7975071,
            "node_id": "MDQ6VXNlcjc5NzUwNzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/naumenkogs",
            "html_url": "https://github.com/naumenkogs",
            "followers_url": "https://api.github.com/users/naumenkogs/followers",
            "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
            "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
            "repos_url": "https://api.github.com/users/naumenkogs/repos",
            "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "comments": 33,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23443",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/23443",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/23443.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/23443.patch"
          },
          "closed_at": "2022-10-17T17:11:41Z",
          "created_at": "2021-11-05T12:51:10Z",
          "updated_at": "2023-10-25T12:15:46Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 7545415781,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHBvehl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7545415781",
      "actor": {
        "login": "kouloumos",
        "id": 18506343,
        "node_id": "MDQ6VXNlcjE4NTA2MzQz",
        "avatar_url": "https://avatars.githubusercontent.com/u/18506343?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kouloumos",
        "html_url": "https://github.com/kouloumos",
        "followers_url": "https://api.github.com/users/kouloumos/followers",
        "following_url": "https://api.github.com/users/kouloumos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kouloumos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kouloumos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kouloumos/subscriptions",
        "organizations_url": "https://api.github.com/users/kouloumos/orgs",
        "repos_url": "https://api.github.com/users/kouloumos/repos",
        "events_url": "https://api.github.com/users/kouloumos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kouloumos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "88edf52153767aa66ecd96ff3bba2fadfa097dbe",
      "commit_url": "https://api.github.com/repos/kouloumos/review-club-summaries/commits/88edf52153767aa66ecd96ff3bba2fadfa097dbe",
      "created_at": "2022-10-07T17:40:41Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-08T16:15:15Z",
      "updated_at": "2022-10-08T16:15:15Z",
      "source": {
        "issue": {
          "id": 1401856133,
          "node_id": "PR_kwDOABII585AbffS",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26283",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26283/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26283/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26283/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26283",
          "number": 26283,
          "state": "closed",
          "state_reason": null,
          "title": "p2p: Fill reconciliation sets and request reconciliation (Erlay)",
          "body": "*See #28765*\r\n\r\nFirst, this PR enables keeping track of per-peer reconciliation sets, containing those transactions which we intend to exchange efficiently. The remaining transactions are announced via flooding, as usual.\r\n\r\nSecond, this PR enables periodically initiating a reconciliation round via a new p2p message.\r\n\r\nErlay Project Tracking: #28646",
          "user": {
            "login": "naumenkogs",
            "id": 7975071,
            "node_id": "MDQ6VXNlcjc5NzUwNzE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/naumenkogs",
            "html_url": "https://github.com/naumenkogs",
            "followers_url": "https://api.github.com/users/naumenkogs/followers",
            "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
            "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
            "repos_url": "https://api.github.com/users/naumenkogs/repos",
            "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26283",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26283",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26283.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26283.patch"
          },
          "closed_at": "2023-11-01T09:07:31Z",
          "created_at": "2022-10-08T07:29:52Z",
          "updated_at": "2023-11-01T20:41:48Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7580484493,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAHD1QON",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7580484493",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-13T11:48:00Z"
    },
    {
      "event": "commented",
      "id": 1277486053,
      "node_id": "IC_kwDOABII585MJOPl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1277486053",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-13T11:50:04Z",
      "updated_at": "2022-10-13T15:10:05Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed again with the following changes (`git range-diff 4fbbb9ffa4...21763d8717`), inspired by feedback from @achow101:\r\n* removed `IsRangeDescriptor` helper, use already available `IsHDEnabled` method instead\r\n  for checking if a SPKM is containing a ranged descriptor\r\n* removed `GetDescriptorRangeEnd` helper, introduce a SPKM method `GetRangeEnd` method\r\n  instead that returns the m_max_cached_index field (plus one) to avoid inspecting the\r\n  actual descriptor object\r\n* removed the commit that got rid of the `const` qualifier from `GetScriptPubKeys`, since\r\n  it was seen as controversial and is not really related to this PR (can be done as a follow-up).\r\n\r\nWe now don't need to grab the lock `cs_desc_man` anymore for retrieving information about\r\nthe descriptor (ranged property, end range).",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1277486053",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7580499557,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAHD1T5l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7580499557",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-13T11:50:04Z"
    },
    {
      "event": "subscribed",
      "id": 7580499572,
      "node_id": "SE_lADOABII585QwnfQzwAAAAHD1T50",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7580499572",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-13T11:50:04Z"
    },
    {
      "event": "labeled",
      "id": 7604518658,
      "node_id": "LE_lADOABII585QwnfQzwAAAAHFQ78C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7604518658",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-17T17:46:04Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7615969884,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAHF8npc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7615969884",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-18T22:51:20Z"
    },
    {
      "event": "commented",
      "id": 1283100956,
      "node_id": "IC_kwDOABII585MepEc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1283100956",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-18T22:52:12Z",
      "updated_at": "2022-10-18T22:52:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased on master.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1283100956",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "unlabeled",
      "id": 7615996904,
      "node_id": "UNLE_lADOABII585QwnfQzwAAAAHF8uPo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7615996904",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-18T22:58:51Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1285476214,
      "node_id": "IC_kwDOABII585Mns92",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1285476214",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-20T12:40:53Z",
      "updated_at": "2022-10-20T12:40:53Z",
      "author_association": "MEMBER",
      "body": "re-tACK 6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79\r\n\r\nUsing a small `-keypool` I was able to import my non-active descriptors without the need to provide a range hint.\r\n\r\nAnother benefit I just noticed / realised: when re-opening an old wallet it now catches up a lot faster.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1285476214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1153235780,
      "node_id": "PRR_kwDOABII585EvPtE",
      "url": null,
      "actor": null,
      "commit_id": "6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1153235780",
      "submitted_at": "2022-10-24T14:58:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "reviewed",
      "id": 1153591652,
      "node_id": "PRR_kwDOABII585Ewmlk",
      "url": null,
      "actor": null,
      "commit_id": "6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1153591652",
      "submitted_at": "2022-10-24T18:51:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "commented",
      "id": 1289458513,
      "node_id": "IC_kwDOABII585M25NR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1289458513",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-24T18:54:37Z",
      "updated_at": "2022-10-24T18:54:37Z",
      "author_association": "MEMBER",
      "body": "> Output scripts from inactive `DescriptorScriptPubKeyMan`s (i.e. ones with a fixed set of output scripts that is never extended) are added only once when the filter is created first.\r\n\r\nThat's not correct, nor what this PR does. Inactive DescriptorSPKMs can still be ranged and be derived from like the active descriptors. Inactive just means that it is not being used for new addresses. However this PR does handle inactive ranged descriptor correctly.\r\n\r\nWhat this should say is that non-ranged descriptors are added only once when the filter is created. There should also be a test for this case as there currently is not.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1289458513",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "commented",
      "id": 1289880366,
      "node_id": "IC_kwDOABII585M4gMu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1289880366",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T02:09:17Z",
      "updated_at": "2022-10-25T02:09:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "> > Output scripts from inactive `DescriptorScriptPubKeyMan`s (i.e. ones with a fixed set of output scripts that is never extended) are added only once when the filter is created first.\r\n> \r\n> That's not correct, nor what this PR does. Inactive DescriptorSPKMs can still be ranged and be derived from like the active descriptors. Inactive just means that it is not being used for new addresses. However this PR does handle inactive ranged descriptor correctly.\r\n\r\nIndeed, corrected that in the PR description. In an earlier phase of the PR I had a misconception on what \"active\"/\"inactive\" descriptors really mean (unfortunately also leading to incorrect code that missed non-active ranged descriptor top-ups, as found by Sjors) and forgot to update the PR description after the logic was fixed to track ranged descriptors for top-ups, rather than only active ones.\r\n\r\nThanks for the thorough review, will also tackle the nits and the missing test for non-ranged descriptors in a bit. ",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1289880366",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1154579367,
      "node_id": "PRR_kwDOABII585E0Xun",
      "url": null,
      "actor": null,
      "commit_id": "6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I benchmarked the PR using a testnet miner address.\r\nI imported a watchonly address of a testnet miner (`addr(tb1qcq670zweall6zz4f96flfrefhr8myfxz9ll9l2)#whefl5al`).\r\n\r\nWithout `blockfilterindex`: Rescan completed in 601714ms\r\nWith `blockfilterindex`: Rescan completed in 84442ms\r\n~7 times faster :rocket:",
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1154579367",
      "submitted_at": "2022-10-25T10:43:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA4OGUzOGQzYmJlYTk2OTRiMzE5YmMzNGUwZDJlNzBkMjEwYzM4YjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/088e38d3bbea9694b319bc34e0d2e70d210c38b4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/088e38d3bbea9694b319bc34e0d2e70d210c38b4",
      "tree": {
        "sha": "526394755d33b599c6ee1e1e7a200ab8ace56755",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/526394755d33b599c6ee1e1e7a200ab8ace56755"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7a0e9627196655be5aa6c2738d4b57646a03726",
          "sha": "e7a0e9627196655be5aa6c2738d4b57646a03726",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e7a0e9627196655be5aa6c2738d4b57646a03726"
        }
      ],
      "message": "add chain interface methods for using BIP 157 block filters\n\nThis is useful for speeding up wallet rescans and is based on an\nearlier version from PR #15845 (\"wallet: Fast rescan with BIP157 block\nfilters\"), which was never merged.\n\nCo-authored-by: MacroFake <falke.marco@gmail.com>",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:28Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-08-23T14:10:59Z"
      },
      "sha": "088e38d3bbea9694b319bc34e0d2e70d210c38b4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg0NTI3OTEzMmI0OTRmMDNiODRkNjg5YzY2NmZkY2ZhZDM3ZjVhNDI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/845279132b494f03b84d689c666fdcfad37f5a42",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/845279132b494f03b84d689c666fdcfad37f5a42",
      "tree": {
        "sha": "b0b555f84f04e094678fec400db7e489db412931",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b0b555f84f04e094678fec400db7e489db412931"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/088e38d3bbea9694b319bc34e0d2e70d210c38b4",
          "sha": "088e38d3bbea9694b319bc34e0d2e70d210c38b4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/088e38d3bbea9694b319bc34e0d2e70d210c38b4"
        }
      ],
      "message": "wallet: support fetching scriptPubKeys with minimum descriptor range index\n\nThis extra method will be needed for updating the filter set for\nfaster wallet rescans; after an internal top-up has happened, we only\nwant to add the newly created scriptPubKeys.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:38Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-08-26T00:34:55Z"
      },
      "sha": "845279132b494f03b84d689c666fdcfad37f5a42"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMwNTEwMjY1ODZmYjI2OTU4NGJjYmE0MWRlOGE0YTkwMjgwZjVhN2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c051026586fb269584bcba41de8a4a90280f5a7e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c051026586fb269584bcba41de8a4a90280f5a7e",
      "tree": {
        "sha": "be64f6813b588793709ef980bbb35c25690b7012",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/be64f6813b588793709ef980bbb35c25690b7012"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/845279132b494f03b84d689c666fdcfad37f5a42",
          "sha": "845279132b494f03b84d689c666fdcfad37f5a42",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/845279132b494f03b84d689c666fdcfad37f5a42"
        }
      ],
      "message": "wallet: add method for retrieving the end range for a ScriptPubKeyMan",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:38Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-12T17:25:22Z"
      },
      "sha": "c051026586fb269584bcba41de8a4a90280f5a7e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcwYjM1MTM5MDQwYTIzNTFjODQ1YTFjZWMxZGFmZDJmYmNkMTZlOTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70b35139040a2351c845a1cec1dafd2fbcd16e93",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/70b35139040a2351c845a1cec1dafd2fbcd16e93",
      "tree": {
        "sha": "c4bde3097f34256cf3a5d4e27d86d42a749c96b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c4bde3097f34256cf3a5d4e27d86d42a749c96b3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c051026586fb269584bcba41de8a4a90280f5a7e",
          "sha": "c051026586fb269584bcba41de8a4a90280f5a7e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c051026586fb269584bcba41de8a4a90280f5a7e"
        }
      ],
      "message": "wallet: add `FastWalletRescanFilter` class for speeding up rescans\n\nThis only supports wallet descriptors right now.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:38Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-08-25T23:41:01Z"
      },
      "sha": "70b35139040a2351c845a1cec1dafd2fbcd16e93"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkzNWM2YzRiMjM0YmJiMDU2NWNkYTZmNThlZTI5ODA0ODg1NmFjYWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/935c6c4b234bbb0565cda6f58ee298048856acae",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/935c6c4b234bbb0565cda6f58ee298048856acae",
      "tree": {
        "sha": "ef4327a213934240c8bdcce011185e45370b39e4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ef4327a213934240c8bdcce011185e45370b39e4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70b35139040a2351c845a1cec1dafd2fbcd16e93",
          "sha": "70b35139040a2351c845a1cec1dafd2fbcd16e93",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/70b35139040a2351c845a1cec1dafd2fbcd16e93"
        }
      ],
      "message": "wallet: take use of `FastWalletRescanFilter`\n\nCan be reviewed with `--ignore-all-space`.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:38Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-08-26T00:57:41Z"
      },
      "sha": "935c6c4b234bbb0565cda6f58ee298048856acae"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM0NDk4ODBiNDk5ZDU0YmZiY2Y2Y2FlZWQ1Mjg1MWNlNTUyNTllZDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3449880b499d54bfbcf6caeed52851ce55259ed7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3449880b499d54bfbcf6caeed52851ce55259ed7",
      "tree": {
        "sha": "2bc425f70886fe8c8cf3803a00784516db2138a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2bc425f70886fe8c8cf3803a00784516db2138a4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/935c6c4b234bbb0565cda6f58ee298048856acae",
          "sha": "935c6c4b234bbb0565cda6f58ee298048856acae",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/935c6c4b234bbb0565cda6f58ee298048856acae"
        }
      ],
      "message": "wallet: fast rescan: show log message for every non-skipped block\n\nFor that purpose, a new logging category BCLog::SCAN is introduced.",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:38Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-01T10:23:59Z"
      },
      "sha": "3449880b499d54bfbcf6caeed52851ce55259ed7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhNDhhNDY5NGY3M2U1YmU4Zjk3MWFlNDgyZWJjMmNjZTRjYWVmNDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca48a4694f73e5be8f971ae482ebc2cce4caef44",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca48a4694f73e5be8f971ae482ebc2cce4caef44",
      "tree": {
        "sha": "3c7b3417c14f9e490ea9c8429ed1bd67e1218877",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3c7b3417c14f9e490ea9c8429ed1bd67e1218877"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3449880b499d54bfbcf6caeed52851ce55259ed7",
          "sha": "3449880b499d54bfbcf6caeed52851ce55259ed7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3449880b499d54bfbcf6caeed52851ce55259ed7"
        }
      ],
      "message": "rpc: doc: mention rescan speedup using `blockfilterindex=1` in affected wallet RPCs",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:39Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-09-02T16:02:53Z"
      },
      "sha": "ca48a4694f73e5be8f971ae482ebc2cce4caef44"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA1ODI5MzIyNjBlN2RlNGU4YWJhMDFkNjNlN2M4YTlkZGI5YzM2ODU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "tree": {
        "sha": "b159dab102a5bb5e3a489eabdee5b2b97bb98a71",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b159dab102a5bb5e3a489eabdee5b2b97bb98a71"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca48a4694f73e5be8f971ae482ebc2cce4caef44",
          "sha": "ca48a4694f73e5be8f971ae482ebc2cce4caef44",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ca48a4694f73e5be8f971ae482ebc2cce4caef44"
        }
      ],
      "message": "test: add test for fast rescan using block filters (top-up detection)",
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-10-25T13:57:39Z"
      },
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2022-09-08T16:27:54Z"
      },
      "sha": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7664181046,
      "node_id": "HRFPE_lADOABII585QwnfQzwAAAAHI0h82",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7664181046",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:28:32Z"
    },
    {
      "event": "commented",
      "id": 1290667493,
      "node_id": "IC_kwDOABII585M7gXl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1290667493",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:42:37Z",
      "updated_at": "2022-10-25T14:42:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed with the review suggestions from @furszy and @achow101 taken into account ([range-diff](https://github.com/bitcoin/bitcoin/compare/6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79..0582932260e7de4e8aba01d63e7c8a9ddb9c3685)):\r\n- return-value of `LookupBlockIndex` is now checked against `nullptr` (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003378783)\r\n- change the block inspect/skip boolean variable to indicate whether the block should be inspected rather than if the block should be skipped (s/skip_block/fetch_block/) (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003628912), move construction and reading of CBlock into `if (fetch_block) { ... }` code block (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003629894)\r\n- improved RPC documentation for calls that are affected by the fast rescan (https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003633631, https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003635619)\r\n- updated the functional test to also include a fixed non-ranged descriptor (we simply send to the same address in each block)\r\n\r\nRe-review would be much appreciated!",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1290667493",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "mentioned",
      "id": 7664318947,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAHI1Dnj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7664318947",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:42:38Z"
    },
    {
      "event": "subscribed",
      "id": 7664318961,
      "node_id": "SE_lADOABII585QwnfQzwAAAAHI1Dnx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7664318961",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:42:38Z"
    },
    {
      "event": "mentioned",
      "id": 7664318975,
      "node_id": "MEE_lADOABII585QwnfQzwAAAAHI1Dn_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7664318975",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:42:38Z"
    },
    {
      "event": "subscribed",
      "id": 7664318991,
      "node_id": "SE_lADOABII585QwnfQzwAAAAHI1DoP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7664318991",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T14:42:38Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T15:34:47Z",
      "updated_at": "2022-10-25T15:34:47Z",
      "source": {
        "issue": {
          "id": 1206247497,
          "node_id": "PR_kwDOABII5842Uktn",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24897",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24897/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24897/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24897/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24897",
          "number": 24897,
          "state": "closed",
          "state_reason": null,
          "title": "[Draft / POC] Silent Payments",
          "body": "This PR proposes an early version of [Silent Payment](https://gist.github.com/RubenSomsen/c43b79517e7cb701ebf77eec6dbb46b8) (author:@RubenSomsen).\r\nIn this scheme, the recipient generates a public address, but the sender tweaks the address and the recipient detects the payment by verifying all transactions on the blockchain. An example use case would be private donations.\r\n\r\nThe purpose of this PR is not a final version, but to start the discussion and get benchmarks based on a real implementation.\r\n\r\nThis version is built on top of [#994](https://github.com/bitcoin-core/secp256k1/pull/994) (bitcoin-core/secp256k1) for x-only ECDH support and #23480 (bitcoin/bitcoin) for `rawtr()`. Each new silent transaction detected is stored in wallet as a `rawtr()` descriptor. \r\n\r\nIn this implementation, the sender can tweak the recipient address by passing the `silent_payment` option to send RPC. The transaction output will be different from the address entered.\r\n\r\nFor example `./src/bitcoin-cli -regtest -named send outputs=\"[{\\\"bcrt1pwlh5xuyrpgfunwyww8cfu78yfs2yqyevl7yturavahh5kgxwdd2q5hzgfu\\\": 1.1}]\" fee_rate=1 options=\"{ \\\"silent_payment\\\": true}\"`.\r\n\r\nwill generate `vout` with completely unrelated outputs:\r\n\r\n```\r\n\"vout\": [\r\n    {\r\n      \"value\": 1.10000000,\r\n      \"n\": 0,\r\n      \"scriptPubKey\": {\r\n        \"desc\": \"rawtr(65b19890c5ca40edb816d26f5f48cd9f3ed51121613b1c2405adc1a6dbbc824a)#8myx9tcu\",\r\n        \"address\": \"bcrt1pvkce3yx9efqwmwqk6fh47jxdnuld2yfpvya3cfq94hq6dkausf9qrfjkgz\",\r\n\r\n      }\r\n    },\r\n    {\r\n      \"value\": 2.02499835,\r\n      \"n\": 1,\r\n      \"scriptPubKey\": {\r\n        \"desc\": \"rawtr(c45cb3d500bbf8f0c8841e8e011b008781d826c16ee348edb822c0f97419bc4d)#26hcce63\",\r\n        \"address\": \"bcrt1pc3wt84gqh0u0pjyyr68qzxcqs7qasfkpdm353mdcytq0jaqeh3xsuvlykg\",\r\n      }\r\n    }\r\n  ]\r\n```\r\n\r\nAny wallet, as long as it has access to private keys, can send silent payments. Thus, this excludes watch-only wallets or wallets with external signers .\r\n\r\nBut the recipient's wallet needs a new flag called `SILENT_PAYMENT`. This flag allows an additional scan that verifies that the wallet keys match the silent payment scheme. When it detects a silent payment that belongs to the wallet, it is stored in a `rawtr()` descriptor.\r\n\r\n`./src/bitcoin-cli -regtest -named createwallet wallet_name=\"recipient\" silent_payment=true`\r\n\r\nTherefore, scanning each address for each transaction is potentially prohibitive overhead, so the node can be initialized with `keypool=1` or a descriptor with range [0,1] can be imported into a blank wallet. Until there is more benchmark data, it is the safest option. The proposal recommends one static address.\r\n\r\nI've been running some silent payments on signet using wallets with default keypool and default range, I haven't noticed any relevant performance drops on the signet node.\r\nApparently this implementation is working as expected but I can't guarantee that the scheme is implemented correctly or safely, so I'm opening this PR for reviews, modifications and improvements.\r\n\r\nThere is a new functional test (`test/functional/wallet_silentpayment.py`) that can help to better understand the implementation.",
          "user": {
            "login": "w0xlt",
            "id": 94266259,
            "node_id": "U_kgDOBZ5jkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/w0xlt",
            "html_url": "https://github.com/w0xlt",
            "followers_url": "https://api.github.com/users/w0xlt/followers",
            "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
            "organizations_url": "https://api.github.com/users/w0xlt/orgs",
            "repos_url": "https://api.github.com/users/w0xlt/repos",
            "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/w0xlt/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 61889416,
              "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
              "name": "Build system",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 159815356,
              "node_id": "MDU6TGFiZWwxNTk4MTUzNTY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Upstream",
              "name": "Upstream",
              "color": "bfd4f2",
              "default": false
            },
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 1482182044,
              "node_id": "MDU6TGFiZWwxNDgyMTgyMDQ0",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Descriptors",
              "name": "Descriptors",
              "description": "",
              "color": "e9f76c",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 86,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24897",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24897",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24897.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24897.patch"
          },
          "closed_at": "2023-06-05T13:18:14Z",
          "created_at": "2022-04-17T00:37:23Z",
          "updated_at": "2023-06-27T11:03:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1291073227,
      "node_id": "IC_kwDOABII585M9DbL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1291073227",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-25T20:03:56Z",
      "updated_at": "2022-10-25T20:03:56Z",
      "author_association": "MEMBER",
      "body": "ACK 0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1291073227",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1155686417,
      "node_id": "PRR_kwDOABII585E4mAR",
      "url": null,
      "actor": null,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 0582932260e7de4e8aba01d63e7c8a9ddb9c3685 - minor changes, documentation and updated test since last review",
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1155686417",
      "submitted_at": "2022-10-25T23:54:02Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "commented",
      "id": 1292134698,
      "node_id": "IC_kwDOABII585NBGkq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1292134698",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T14:25:09Z",
      "updated_at": "2022-10-26T14:25:09Z",
      "author_association": "MEMBER",
      "body": "re-utACK 0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1292134698",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25957"
    },
    {
      "event": "reviewed",
      "id": 1156674107,
      "node_id": "PRR_kwDOABII585E8XI7",
      "url": null,
      "actor": null,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK https://github.com/bitcoin/bitcoin/pull/25957/commits/0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#pullrequestreview-1156674107",
      "submitted_at": "2022-10-26T14:51:35Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
    },
    {
      "event": "merged",
      "id": 7673933475,
      "node_id": "ME_lADOABII585QwnfQzwAAAAHJZu6j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7673933475",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "48af307481af3b3e9455596b515e8ecb001672ef",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/48af307481af3b3e9455596b515e8ecb001672ef",
      "created_at": "2022-10-26T15:19:50Z"
    },
    {
      "event": "closed",
      "id": 7673933530,
      "node_id": "CE_lADOABII585QwnfQzwAAAAHJZu7a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7673933530",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T15:19:51Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 7674088454,
      "node_id": "HRDE_lADOABII585QwnfQzwAAAAHJaUwG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7674088454",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T15:37:29Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-26T23:15:54Z",
      "updated_at": "2022-10-26T23:15:54Z",
      "source": {
        "issue": {
          "id": 1075972531,
          "node_id": "I_kwDOABII585AIgmz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23727",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23727/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23727/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23727/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/23727",
          "number": 23727,
          "state": "closed",
          "state_reason": "completed",
          "title": "Make rescans faster",
          "body": "This issue aggregates ideas for making wallet rescans substantially faster.\r\n\r\nUsing compact block filters, when available, could substantially speed up wallet rescans although it is not clear to me how this might work for non-descriptor-based (legacy) wallets.\r\n\r\nCurrently, #20664 proposes to add an RPC that will use compact block filters to scan for blocks relevant to a given script descriptor. This gives a listing of blocks that correspond to the descriptor, but the user then has to do something with that list of blocks to find transactions relevant to their wallet. \r\n\r\nIt would be nice to integrate scanblocks' use of block filters opaquely into `rescanblockchain` (wallet rescanning) so that if block filters are available, the faster method of consulting them could be used instead of scanning the entire chain, or forcing the user to do something more roundabout with the output of `scanblocks`.\r\n\r\n\r\nFrom @sipa: \r\n> regarding faster rescanning, i think there is some lower-hanging fruit, like (a) rescanning all wallets at startup in parallel rather than one by one and (b) building a set of scriptPubKeys to look for and using that for (legacy wallet) rescanning, instead of calling IsMine for each (especially with achow101's migrate-to-descriptor code, i think there should be a way of computing that set for legacy wallets too)\r\n\r\n### Possible changes\r\n\r\n- [ ] integrate compact block filter usage into `rescanblockchain` to allow faster rescans when the compact block index is available, otherwise falling back to the standard scanning method. A first approach could possibly use filters only when dealing with a non-legacy descriptor wallet\r\n    - Currently proposed in https://github.com/bitcoin/bitcoin/pull/23549\r\n- [ ] allow pruned nodes with the block filter index to rescan quickly by getting a list of relevant blocks to the wallet, requesting the download of blocks, and then parsing the blocks for relevant transactions\r\n- [ ] rescanning all wallets at startup in parallel (instead of one-by-one): https://github.com/bitcoin/bitcoin/issues/11756\r\n- [ ] building a set of scriptPubKeys to look for when using a legacy wallet based on @achow101's migrate-to-descriptor code",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "comments": 8,
          "closed_at": "2022-10-27T11:35:12Z",
          "created_at": "2021-12-09T20:20:02Z",
          "updated_at": "2023-10-27T12:16:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 7677836252,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHJonvc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7677836252",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c570842516cfd06d37a394e48001828e3d6c7e8c",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/c570842516cfd06d37a394e48001828e3d6c7e8c",
      "created_at": "2022-10-27T00:55:10Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "vnprc",
        "id": 9425366,
        "node_id": "MDQ6VXNlcjk0MjUzNjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/9425366?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vnprc",
        "html_url": "https://github.com/vnprc",
        "followers_url": "https://api.github.com/users/vnprc/followers",
        "following_url": "https://api.github.com/users/vnprc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vnprc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vnprc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vnprc/subscriptions",
        "organizations_url": "https://api.github.com/users/vnprc/orgs",
        "repos_url": "https://api.github.com/users/vnprc/repos",
        "events_url": "https://api.github.com/users/vnprc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vnprc/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-27T13:43:13Z",
      "updated_at": "2022-10-27T13:43:13Z",
      "source": {
        "issue": {
          "id": 1422411609,
          "node_id": "I_kwDOGW9Qmc5UyEdZ",
          "url": "https://api.github.com/repos/TriangleBitDevs/TriangleBitDevs.github.io/issues/2",
          "repository_url": "https://api.github.com/repos/TriangleBitDevs/TriangleBitDevs.github.io",
          "labels_url": "https://api.github.com/repos/TriangleBitDevs/TriangleBitDevs.github.io/issues/2/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/TriangleBitDevs/TriangleBitDevs.github.io/issues/2/comments",
          "events_url": "https://api.github.com/repos/TriangleBitDevs/TriangleBitDevs.github.io/issues/2/events",
          "html_url": "https://github.com/TriangleBitDevs/TriangleBitDevs.github.io/issues/2",
          "number": 2,
          "state": "closed",
          "state_reason": "completed",
          "title": "Socratic Seminar 12 Topics",
          "body": "Please post here to add any topics you would like to discuss at the next socratic seminar.\r\n\r\n\r\n## Leftover topics\r\n\r\n### Lightning\r\n\r\n#### Taro Skepticism\r\n\r\nA critical look at the [scalability properties](https://bitcoinmagazine.com/technical/scaling-problem-for-lightning-labs-taro) of the Taro protocol if deployed on the bitcoin blockchain\r\n\r\n#### Advances in Channel Jamming Research\r\n\r\nThe prolifically productive dream team Gleb Naumenko and Antoine Riard have released a series of research reports examining [channel jamming](https://bitcoinops.org/en/topics/channel-jamming-attacks/). Read the [lightning-dev post](https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-August/003673.html) for a brief summary or dive into the [gitbook](https://jamming-dev.github.io/book/) and read the whole shebang.\r\n\r\n#### Taproot Errwhere\r\n\r\nVery exciting PR https://github.com/lightningnetwork/lnd/pull/6810 for sweeping funds, funding channels, and sending blobs to watch towers.\r\n\r\n### Scaling\r\n\r\n#### Coinpool\r\n\r\nGleb and Antoine propose [Coinpool](https://coinpool.dev/v0.1.pdf), a new shared UTXO ownership model. Coinpool requires three new OP codes to be soft forked into bitcoin script, so donâ€™t hold your breath. It is recommended that you first grok [Eltoo](https://bitcoinops.org/en/topics/eltoo/) since coinpool builds upon the eltoo protocol to add new capabilities.\r\n\r\n\r\n## Member requests:\r\n\r\n#### Taproot address adoption\r\n\r\nHow can the addresses be added to a wallet? What is the difference between taproot and bech32? Does taproot save on costs? How much?\r\nNew website launched [When Taproot?](https://whentaproot.org/)",
          "user": {
            "login": "jesseaam",
            "id": 18119820,
            "node_id": "MDQ6VXNlcjE4MTE5ODIw",
            "avatar_url": "https://avatars.githubusercontent.com/u/18119820?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jesseaam",
            "html_url": "https://github.com/jesseaam",
            "followers_url": "https://api.github.com/users/jesseaam/followers",
            "following_url": "https://api.github.com/users/jesseaam/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jesseaam/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jesseaam/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jesseaam/subscriptions",
            "organizations_url": "https://api.github.com/users/jesseaam/orgs",
            "repos_url": "https://api.github.com/users/jesseaam/repos",
            "events_url": "https://api.github.com/users/jesseaam/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jesseaam/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "COLLABORATOR",
          "locked": false,
          "comments": 6,
          "closed_at": "2023-07-05T15:44:36Z",
          "created_at": "2022-10-25T12:49:08Z",
          "updated_at": "2023-07-05T15:44:36Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-08T01:38:43Z",
      "updated_at": "2022-11-08T01:38:43Z",
      "source": {
        "issue": {
          "id": 813494821,
          "node_id": "MDU6SXNzdWU4MTM0OTQ4MjE=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21267",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21267/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21267/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21267/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/21267",
          "number": 21267,
          "state": "open",
          "state_reason": null,
          "title": "Allow for rescan using block filters with pruned node",
          "body": "After #15946 it should be possible to do a rescan using block filters with a pruned node. Blocks that are not stored could be requested from peers.",
          "user": {
            "login": "benthecarman",
            "id": 15256660,
            "node_id": "MDQ6VXNlcjE1MjU2NjYw",
            "avatar_url": "https://avatars.githubusercontent.com/u/15256660?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/benthecarman",
            "html_url": "https://github.com/benthecarman",
            "followers_url": "https://api.github.com/users/benthecarman/followers",
            "following_url": "https://api.github.com/users/benthecarman/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/benthecarman/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/benthecarman/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/benthecarman/subscriptions",
            "organizations_url": "https://api.github.com/users/benthecarman/orgs",
            "repos_url": "https://api.github.com/users/benthecarman/repos",
            "events_url": "https://api.github.com/users/benthecarman/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/benthecarman/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 11,
          "created_at": "2021-02-22T13:19:46Z",
          "updated_at": "2023-06-22T22:43:03Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-28T17:08:16Z",
      "updated_at": "2022-11-28T17:08:16Z",
      "source": {
        "issue": {
          "id": 1120958552,
          "node_id": "PR_kwDOABII584x6sdb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
          "number": 24230,
          "state": "open",
          "state_reason": null,
          "title": "indexes: Stop using node internal types and locking cs_main, improve sync logic",
          "body": "This PR lets indexing code mostly run outside of the node process. It also improves indexing sync logic, which is moved out of indexing code to a new [`node::SyncChain()`](https://github.com/ryanofsky/bitcoin/blob/8d8cdcb37005030f646ba3c45f7f54f556efb8bf/src/node/chain.h#L24-L39) function.\r\n\r\nAlmost all the commits in this PR are small refactoring changes that move code from `src/index/` to `src/node/`, or replace references to node types like `CBlockIndex`, `CChain`, `CChainState` in index code. There are only two commits affecting indexing sync logic which make complicated or substantive changes:\r\n\r\n- [`8746b35301c5` indexes: Rewrite chain sync logic, remove racy init](https://github.com/bitcoin/bitcoin/pull/24230/commits/8746b35301c5f65ff3200555fb2b82417fd2c758)\r\n- [`ad88f50ddd12` indexes: Initialize indexes without holding cs_main](https://github.com/bitcoin/bitcoin/pull/24230/commits/ad88f50ddd129dddd974bbf9fd7d86ec86b65508)\r\n\r\n\r\nThe commit messages have more details about these and other changes. Followups to this PR will reuse indexing sync code for wallets (#15719, #11756) and let indexes run in separate processes (#10102)",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 39,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24230",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24230.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24230.patch"
          },
          "created_at": "2022-02-01T16:56:28Z",
          "updated_at": "2023-09-26T13:52:37Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 8311600395,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHvaPUL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8311600395",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "783288334c98844ffce1f8ffa0e64a9fdb0c1c13",
      "commit_url": "https://api.github.com/repos/theStack/bitcoin/commits/783288334c98844ffce1f8ffa0e64a9fdb0c1c13",
      "created_at": "2023-01-19T12:41:29Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T12:43:56Z",
      "updated_at": "2023-01-19T12:43:56Z",
      "source": {
        "issue": {
          "id": 1549081836,
          "node_id": "PR_kwDOABII585IHtWK",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26920",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26920/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26920/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26920/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26920",
          "number": 26920,
          "state": "closed",
          "state_reason": null,
          "title": "doc: add release note for #25957 (fast wallet rescan)",
          "body": "This PR adds a missing release note for #25957.",
          "user": {
            "login": "theStack",
            "id": 91535,
            "node_id": "MDQ6VXNlcjkxNTM1",
            "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/theStack",
            "html_url": "https://github.com/theStack",
            "followers_url": "https://api.github.com/users/theStack/followers",
            "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
            "organizations_url": "https://api.github.com/users/theStack/orgs",
            "repos_url": "https://api.github.com/users/theStack/repos",
            "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/theStack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 148216,
              "node_id": "MDU6TGFiZWwxNDgyMTY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Docs",
              "name": "Docs",
              "color": "02d7e1",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26920",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26920",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26920.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26920.patch"
          },
          "closed_at": "2023-01-19T13:40:41Z",
          "created_at": "2023-01-19T12:43:56Z",
          "updated_at": "2023-01-19T13:43:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 8312130884,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHvcQ1E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8312130884",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "234388621733a919802553972580aa2428c7e07e",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/234388621733a919802553972580aa2428c7e07e",
      "created_at": "2023-01-19T13:40:40Z"
    },
    {
      "event": "referenced",
      "id": 8313379357,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHvhBod",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8313379357",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d87235f70f8ff5336e19dcf13feeeab24facc391",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/d87235f70f8ff5336e19dcf13feeeab24facc391",
      "created_at": "2023-01-19T15:42:24Z"
    },
    {
      "event": "referenced",
      "id": 8376379040,
      "node_id": "REFE_lADOABII585QwnfQzwAAAAHzRWag",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8376379040",
      "actor": {
        "login": "aguycalled",
        "id": 24814046,
        "node_id": "MDQ6VXNlcjI0ODE0MDQ2",
        "avatar_url": "https://avatars.githubusercontent.com/u/24814046?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aguycalled",
        "html_url": "https://github.com/aguycalled",
        "followers_url": "https://api.github.com/users/aguycalled/followers",
        "following_url": "https://api.github.com/users/aguycalled/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aguycalled/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aguycalled/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aguycalled/subscriptions",
        "organizations_url": "https://api.github.com/users/aguycalled/orgs",
        "repos_url": "https://api.github.com/users/aguycalled/repos",
        "events_url": "https://api.github.com/users/aguycalled/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aguycalled/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "118485613302a7dc200673544a48ffa64fb63ec5",
      "commit_url": "https://api.github.com/repos/navcoin/navcoin/commits/118485613302a7dc200673544a48ffa64fb63ec5",
      "created_at": "2023-01-27T19:20:48Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-13T17:37:30Z",
      "updated_at": "2023-02-13T17:37:30Z",
      "source": {
        "issue": {
          "id": 217385623,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MTEyODQ2NDMx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10102",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10102/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10102/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/10102/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/10102",
          "number": 10102,
          "state": "open",
          "state_reason": null,
          "title": "Multiprocess bitcoin",
          "body": "**This is a draft PR because it is based on #28721.** The non-base commits are:\r\n\r\n- [`dc0a2a6726bb` depends: Update libmultiprocess library](https://github.com/bitcoin/bitcoin/pull/10102/commits/dc0a2a6726bbd3e197c64db93eaead76897e5fe3)\r\n- [`4a95a333717e` Increase feature_block.py and feature_taproot.py timeouts](https://github.com/bitcoin/bitcoin/pull/10102/commits/4a95a333717ed59b18de2759a4b5e6119c9efd9d)\r\n- [`debf07da817d` Add util::Result workaround to be compatible with libmultiprocess](https://github.com/bitcoin/bitcoin/pull/10102/commits/debf07da817dbfa60248a9527ba65a206799ab75)\r\n- [`21abaa9bba14` Add capnp serialization code for bitcoin types](https://github.com/bitcoin/bitcoin/pull/10102/commits/21abaa9bba1499a8134064a1ab31fbf789a43ef9)\r\n- [`12bbaf7c53f8` Add capnp wrapper for Handler interface](https://github.com/bitcoin/bitcoin/pull/10102/commits/12bbaf7c53f84e49a7f7a1c79371dd6e347cdc4e)\r\n- [`82fdd6b35a7d` Add capnp wrapper for Chain interface](https://github.com/bitcoin/bitcoin/pull/10102/commits/82fdd6b35a7d844a88194b1c1477144a5498bdf9)\r\n- [`4138a284cd68` Add capnp wrapper for Wallet interface](https://github.com/bitcoin/bitcoin/pull/10102/commits/4138a284cd68bfe9a6c3b39c584fb2443a54c44c)\r\n- [`69df67fee50d` Add capnp wrapper for Node interface](https://github.com/bitcoin/bitcoin/pull/10102/commits/69df67fee50dd396e9ae5354f499b4c879ae08e0)\r\n- [`0debb3a35abc` Make bitcoin-gui spawn a bitcoin-node process](https://github.com/bitcoin/bitcoin/pull/10102/commits/0debb3a35abce272de9c232bc1f8ede785ebe5c6)\r\n- [`c36072badafa` Make bitcoin-node spawn a bitcoin-wallet process](https://github.com/bitcoin/bitcoin/pull/10102/commits/c36072badafaaebf1b29db6ee76536adc11e9bb2)\r\n- [`0d151661f3bf` multiprocess: Add debug.log .wallet/.gui suffixes](https://github.com/bitcoin/bitcoin/pull/10102/commits/0d151661f3bf04fc6a6ae1d9560770a74681653d)\r\n- [`75fa53129e8d` doc: Multiprocess misc doc and comment updates](https://github.com/bitcoin/bitcoin/pull/10102/commits/75fa53129e8dfae3b043329895014ee3ef82fcb1)\r\n- [`18d382f4f8a7` combine_logs: Handle multiprocess wallet log files](https://github.com/bitcoin/bitcoin/pull/10102/commits/18d382f4f8a74612ae0e91efd8a2b83bb665e081)\r\n\r\n---\r\n\r\nThis PR adds an `--enable-multiprocess` configure option which builds new `bitcoin-node`, `bitcoin-wallet`, and `bitcoin-gui` executables with relevant functionality isolated into different processes. See [doc/design/multiprocess.md](https://github.com/ryanofsky/bitcoin/tree/pr/ipc/doc/design/multiprocess.md) for usage details and future plans.\r\n\r\nThe change is implemented by adding a new [`Init`](https://github.com/ryanofsky/bitcoin/blob/pr/ipc/src/interfaces/init.h) interface that spawns new wallet and node subprocesses that can be controlled over a [socketpair](http://man7.org/linux/man-pages/man2/socketpair.2.html) by calling [`Node`](https://github.com/ryanofsky/bitcoin/blob/pr/ipc/src/interfaces/node.h), [`Wallet`](https://github.com/ryanofsky/bitcoin/blob/pr/ipc/src/interfaces/wallet.h), and [`ChainClient`](https://github.com/ryanofsky/bitcoin/blob/pr/ipc/src/interfaces/chain.h) methods. When running with split processes, you can see the IPC messages going back and forth in `-debug=1` output. Followup PR's #19460 and #19461 add `-ipcbind` and `-ipcconnect` options that allow more flexibility in how processes are connected.\r\n\r\nThe IPC protocol used is Cap'n Proto, but this could be swapped out for another protocol. Cap'n Proto types and libraries are only accessed in the [src/ipc/capnp/](https://github.com/ryanofsky/bitcoin/tree/pr/ipc/src/ipc/capnp) directory, and not in any public headers or other parts of bitcoin code.\r\n\r\nSlides from a presentation describing this change are available on [google drive](https://docs.google.com/presentation/d/1AeJ-7gD-dItUgs5yH-HoEzLvXaEWe_2ZiGUUxYIXcws/edit). Demo code used in the presentation was from an older version this PR (tag [ipc.21](https://github.com/ryanofsky/bitcoin/releases/tag/pr%2Fipc.21), [commits](https://github.com/ryanofsky/bitcoin/compare/master...pr/ipc.21)).\r\n\r\n---\r\n\r\nThis PR is part of the [process separation project](https://github.com/bitcoin/bitcoin/issues/28722).\r\n",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135946,
              "node_id": "MDU6TGFiZWwxMzU5NDY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/GUI",
              "name": "GUI",
              "color": "02d7e1",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 82,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/10102",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/10102",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/10102.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/10102.patch"
          },
          "created_at": "2017-03-27T21:48:26Z",
          "updated_at": "2023-11-09T22:18:23Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T10:48:18Z",
      "updated_at": "2023-05-24T10:48:18Z",
      "source": {
        "issue": {
          "id": 1723527379,
          "node_id": "I_kwDOABII585muvDT",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27736",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27736/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27736/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27736/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/27736",
          "number": 27736,
          "state": "closed",
          "state_reason": "completed",
          "title": "25.0 RC Testing Guide Feedback",
          "body": "This issue is to discuss the [25.0 Release Candidate Testing Guide](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/25.0-Release-Candidate-Testing-Guide). If you have any issues with or feedback on the document, please leave a comment here.\r\n\r\nNote: this is for feedback on the document, not on Bitcoin Core or on the 25.0 changes. Please see the [#27621](https://github.com/bitcoin/bitcoin/issues/27621) for instructions on how to report bug/results.\r\n\r\nThank you for your feedback",
          "user": {
            "login": "ismaelsadeeq",
            "id": 48946461,
            "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ismaelsadeeq",
            "html_url": "https://github.com/ismaelsadeeq",
            "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
            "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
            "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
            "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
            "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 9,
          "closed_at": "2023-05-26T14:46:43Z",
          "created_at": "2023-05-24T09:12:56Z",
          "updated_at": "2023-05-29T08:40:25Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 10934400425,
      "node_id": "LOE_lADOABII585QwnfQzwAAAAKLvbWp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10934400425",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-12T12:18:22Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962466047",
      "pull_request_review_id": 1095833132,
      "id": 962466047,
      "node_id": "PRRC_kwDOABII5845XhD_",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d0114e02cddd9bf1cc8760ebe95941f80609259b nit\r\n```suggestion\r\n            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\r\n```",
      "created_at": "2022-09-05T04:27:22Z",
      "updated_at": "2022-09-05T19:35:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962466047",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962466047"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 275,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962912290",
      "pull_request_review_id": 1096463603,
      "id": 962912290,
      "node_id": "PRRC_kwDOABII5845ZOAi",
      "diff_hunk": "@@ -143,6 +144,13 @@ class Chain\n     //! or one of its ancestors.\n     virtual std::optional<int> findLocatorFork(const CBlockLocator& locator) = 0;\n \n+    //! Returns whether a block filter index is available.\n+    virtual bool haveBlockFilterIndex() = 0;",
      "path": "src/interfaces/chain.h",
      "position": null,
      "original_position": 13,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Some methods here are called `has...`, others `have...`. I'm not sure where the `have...` comes from, but it sounds weird. Could you change that to `hasBlockFilterIndex()` ?\r\n```suggestion\r\n    virtual bool hasBlockFilterIndex() = 0;\r\n```",
      "created_at": "2022-09-05T13:31:48Z",
      "updated_at": "2022-09-05T15:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962912290",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962912290"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962921746",
      "pull_request_review_id": 1096463603,
      "id": 962921746,
      "node_id": "PRRC_kwDOABII5845ZQUS",
      "diff_hunk": "@@ -536,6 +537,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool haveBlockFilterIndex() override",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There's a bit of an interface inconsistency here (and in `blockFilterMatchesAny `) in that so far most of the blockfilter functions don't assume the type to be basic but rather expect them to be passed. Have you considered this? One alternative could be add \"basic\" in the function name, which can then be refactored later if/when we have more filtertypes, but at least then it'll be more explicit? At first glance, I _think_ I'd prefer just passing the `FilterType::BASIC` to stay consistent but no strong view (yet).",
      "created_at": "2022-09-05T13:42:13Z",
      "updated_at": "2022-09-05T15:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962921746",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962921746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 540,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962928271",
      "pull_request_review_id": 1096463603,
      "id": 962928271,
      "node_id": "PRRC_kwDOABII5845ZR6P",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is a lot of code duplication from `GetScriptPubKeys`. At first sight, I don't really see why this couldn't be an overloaded function or default parameter?",
      "created_at": "2022-09-05T13:49:36Z",
      "updated_at": "2022-09-07T08:01:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962928271",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962928271"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962937400",
      "pull_request_review_id": 1096463603,
      "id": 962937400,
      "node_id": "PRRC_kwDOABII5845ZUI4",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorSPKRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorSPKRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeysWithMinIndex(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 48,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Maybe a brief docstring would be helpful here? The name is not immediately obvious imo.",
      "created_at": "2022-09-05T13:59:24Z",
      "updated_at": "2022-09-05T15:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962937400",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962937400"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962939320",
      "pull_request_review_id": 1096463603,
      "id": 962939320,
      "node_id": "PRRC_kwDOABII5845ZUm4",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorSPKRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorSPKRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeysWithMinIndex(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    static int32_t GetDescriptorSPKRangeEnd(const DescriptorScriptPubKeyMan& desc_spkm)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Do we need `SPK` in the name here? `GetDescriptorRangeEnd` seems to describe it accurately?",
      "created_at": "2022-09-05T14:01:25Z",
      "updated_at": "2022-09-05T15:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r962939320",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/962939320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 310,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963091332",
      "pull_request_review_id": 1095833132,
      "id": 963091332,
      "node_id": "PRRC_kwDOABII5845Z5uE",
      "diff_hunk": "@@ -1775,9 +1833,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }\n+\n         // Read block data\n         CBlock block;\n-        chain().findBlock(block_hash, FoundBlock().data(block));\n+        if (!skip_block) chain().findBlock(block_hash, FoundBlock().data(block));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d0114e02cddd9bf1cc8760ebe95941f80609259b nit, here we construct a `CBlock` that isn't used if `skip_block` is true (we can use the block filter). I wonder if it would be worth the performance improvement to avoid the construction.\r\n```suggestion\r\n        std::unique_ptr<CBlock> block;\r\n        if (!skip_block) {\r\n            block = std::make_unique<CBlock>();\r\n            chain().findBlock(block_hash, FoundBlock().data(*block));\r\n        }\r\n```\r\nYou would also have to change 3 occurrences of `block.` to `block->` since it now would be a pointer.",
      "created_at": "2022-09-05T18:52:08Z",
      "updated_at": "2022-09-05T19:35:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963091332",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963091332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1849,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1867,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963094901",
      "pull_request_review_id": 1095833132,
      "id": 963094901,
      "node_id": "PRRC_kwDOABII5845Z6l1",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 12,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": null,
      "user": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d0114e02cddd9bf1cc8760ebe95941f80609259b Because of the `index >= minimum_index` guard (just below, line 2662), could this reserve many more entries than needed? I would probably let `std::vector` increase the capacity as needed.",
      "created_at": "2022-09-05T19:04:23Z",
      "updated_at": "2022-09-05T19:35:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963094901",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963094901"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2655,
      "original_line": 2655,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963767587",
      "pull_request_review_id": 1097679270,
      "id": 963767587,
      "node_id": "PRRC_kwDOABII5845ce0j",
      "diff_hunk": "@@ -143,6 +144,13 @@ class Chain\n     //! or one of its ancestors.\n     virtual std::optional<int> findLocatorFork(const CBlockLocator& locator) = 0;\n \n+    //! Returns whether a block filter index is available.\n+    virtual bool haveBlockFilterIndex() = 0;",
      "path": "src/interfaces/chain.h",
      "position": null,
      "original_position": 13,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962912290,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agree that naming the method `has...` reads more fluent, considering that \"chain\" is singular. Done.",
      "created_at": "2022-09-06T14:17:16Z",
      "updated_at": "2022-09-06T14:17:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963767587",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963767587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963767824",
      "pull_request_review_id": 1097679686,
      "id": 963767824,
      "node_id": "PRRC_kwDOABII5845ce4Q",
      "diff_hunk": "@@ -536,6 +537,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool haveBlockFilterIndex() override",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962921746,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point. To be frank I was just lazy and assumed that there won't be any other block-filter types than \"basic\" for a long time anyways ðŸ˜… Fully agree though that passing the filter type is more consistent. Done for both methods.",
      "created_at": "2022-09-06T14:17:28Z",
      "updated_at": "2022-09-06T14:17:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963767824",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963767824"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 540,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963773560",
      "pull_request_review_id": 1097688294,
      "id": 963773560,
      "node_id": "PRRC_kwDOABII5845cgR4",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorSPKRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorSPKRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeysWithMinIndex(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 48,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962937400,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done.",
      "created_at": "2022-09-06T14:22:13Z",
      "updated_at": "2022-09-06T14:22:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963773560",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963773560"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963774096",
      "pull_request_review_id": 1097689012,
      "id": 963774096,
      "node_id": "PRRC_kwDOABII5845cgaQ",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorSPKRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorSPKRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeysWithMinIndex(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    static int32_t GetDescriptorSPKRangeEnd(const DescriptorScriptPubKeyMan& desc_spkm)",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962939320,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agree that having the \"SPK\" in there is not really needed. Done.",
      "created_at": "2022-09-06T14:22:36Z",
      "updated_at": "2022-09-06T14:22:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963774096",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963774096"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 310,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963775594",
      "pull_request_review_id": 1097691356,
      "id": 963775594,
      "node_id": "PRRC_kwDOABII5845cgxq",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962928271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In an earlier version the method `GetScriptPubKeys` was indeed simply extended with a default parameter (`minimum_index = 0`). After the latest rebase however, this method is now part of the base class `ScriptPubKeyMan` interface:\r\nhttps://github.com/bitcoin/bitcoin/blob/5291933fedceb9df16eb9e4627b1d7386b53ba07/src/wallet/scriptpubkeyman.h#L246\r\nPassing a minimum index only makes sense for `DescriptorScriptPubKeyMan`s, that's why I refrained from imposing a new parameter; overloading the method _only_ for this class also seemed wrong to me, that's why I chose to use a more explicit naming. Happy to overload though if other's wish that too (maybe it's not as problematic as I think :)).",
      "created_at": "2022-09-06T14:23:53Z",
      "updated_at": "2022-09-06T14:23:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963775594",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963775594"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963775855",
      "pull_request_review_id": 1097691799,
      "id": 963775855,
      "node_id": "PRRC_kwDOABII5845cg1v",
      "diff_hunk": "@@ -260,6 +260,60 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto* desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962466047,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done.",
      "created_at": "2022-09-06T14:24:08Z",
      "updated_at": "2022-09-06T14:24:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963775855",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963775855"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 275,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963779873",
      "pull_request_review_id": 1097697686,
      "id": 963779873,
      "node_id": "PRRC_kwDOABII5845ch0h",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 12,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 963094901,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch! We actually know how large the resulting vector should be (`m_map_script_pub_keys.size()` minus the passed minimum index); changed that accordingly and clamped to a minimum of zero to avoid potential integer underflow issues (if e.g. the caller would pass a minimum index higher than the current ~~end range~~ count of scriptPubKeys).",
      "created_at": "2022-09-06T14:27:18Z",
      "updated_at": "2022-09-06T14:47:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963779873",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963779873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2655,
      "original_line": 2655,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963785994",
      "pull_request_review_id": 1097706767,
      "id": 963785994,
      "node_id": "PRRC_kwDOABII5845cjUK",
      "diff_hunk": "@@ -1775,9 +1833,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }\n+\n         // Read block data\n         CBlock block;\n-        chain().findBlock(block_hash, FoundBlock().data(block));\n+        if (!skip_block) chain().findBlock(block_hash, FoundBlock().data(block));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 963091332,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "After some consideration, I decided to keep as it is for now to keep the code simpler, as I think default-ctoring a `CBlock` is neglectible here compared to other operations (didn't do any benchmarking or look deeper into it though). Happy to follow-up here though, will keep this conversation open. (Maybe also a topic to discuss for PR review club tomorrow, in case there is some time at the end?).",
      "created_at": "2022-09-06T14:32:14Z",
      "updated_at": "2022-09-06T14:32:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r963785994",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/963785994"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1849,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1867,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964549852",
      "pull_request_review_id": 1098757006,
      "id": 964549852,
      "node_id": "PRRC_kwDOABII5845fdzc",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962928271,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't really see the issue with overloading a child class function, especially with an optional parameter? Definitely beats the code duplication in my view, but yeah would be nice to hear others' thoughts.",
      "created_at": "2022-09-07T08:34:05Z",
      "updated_at": "2022-09-07T08:34:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964549852",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964549852"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964582588",
      "pull_request_review_id": 1098803994,
      "id": 964582588,
      "node_id": "PRRC_kwDOABII5845fly8",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962928271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If the method of the child class has a different number of parameters than the method of the base class, the override doesn't work. E.g., the following doesn't compile:\r\n```c++\r\nclass Base {\r\npublic:\r\n    virtual int get_foobar() const { return 1; }\r\n};\r\n\r\nclass Inherited : public Base {\r\n    int get_foobar(int param = 0) const override { return 2; }\r\n};\r\n```\r\n```\r\n$ clang++ -c /tmp/override.cpp\r\n/tmp/override.cpp:7:45: error: non-virtual member function marked 'override' hides virtual member function\r\n        int get_foobar(int param = 0) const override { return 2; }\r\n                                            ^\r\n/tmp/override.cpp:3:25: note: hidden overloaded virtual function 'Base::get_foobar' declared here: different number of parameters (0 vs 1)\r\n            virtual int get_foobar() const { return 1; }\r\n                        ^\r\n```\r\n\r\nThe only way to avoid code deduplication would be to also introduce the `minimum_index` parameter to the `GetScriptPubKeys` method of the base class interface, but that seemed excessive to me, considering that we would only evaluate that parameter in DescriptorScriptPubKeyMans.",
      "created_at": "2022-09-07T09:04:05Z",
      "updated_at": "2022-09-07T09:04:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964582588",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964582588"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964632557",
      "pull_request_review_id": 1098875073,
      "id": 964632557,
      "node_id": "PRRC_kwDOABII5845fx_t",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962928271,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There's no need to `override` it, I'm just talking about overloading it for `DescriptorScriptPubKeyMan`. For example, I think the below could work (not sure if the vector return type was required, just kept it to an unordered_set here for minimal diff):\r\n\r\n<details>\r\n\r\n```diff\r\ndiff --git a/src/wallet/scriptpubkeyman.cpp b/src/wallet/scriptpubkeyman.cpp\r\nindex f7d7f99b8..4c42ef8e0 100644\r\n--- a/src/wallet/scriptpubkeyman.cpp\r\n+++ b/src/wallet/scriptpubkeyman.cpp\r\n@@ -2642,24 +2642,17 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\r\n \r\n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\r\n {\r\n-    LOCK(cs_desc_man);\r\n-    std::unordered_set<CScript, SaltedSipHasher> script_pub_keys;\r\n-    script_pub_keys.reserve(m_map_script_pub_keys.size());\r\n-\r\n-    for (auto const& script_pub_key: m_map_script_pub_keys) {\r\n-        script_pub_keys.insert(script_pub_key.first);\r\n-    }\r\n-    return script_pub_keys;\r\n+    return GetScriptPubKeys(0);\r\n }\r\n \r\n-const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\r\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const\r\n {\r\n     LOCK(cs_desc_man);\r\n-    std::vector<CScript> script_pub_keys;\r\n+    std::unordered_set<CScript, SaltedSipHasher> script_pub_keys;\r\n     script_pub_keys.reserve(std::max<size_t>(m_map_script_pub_keys.size() - minimum_index, 0));\r\n \r\n     for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\r\n-        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\r\n+        if (index >= minimum_index) script_pub_keys.insert(script_pub_key);\r\n     }\r\n     return script_pub_keys;\r\n }\r\ndiff --git a/src/wallet/scriptpubkeyman.h b/src/wallet/scriptpubkeyman.h\r\nindex ac44de0e4..4ff7fdb15 100644\r\n--- a/src/wallet/scriptpubkeyman.h\r\n+++ b/src/wallet/scriptpubkeyman.h\r\n@@ -643,7 +643,7 @@ public:\r\n \r\n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\r\n     const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys() const override;\r\n-    const std::vector<CScript> GetScriptPubKeysWithMinIndex(int32_t minimum_index) const;\r\n+    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index) const;\r\n \r\n     bool GetDescriptorString(std::string& out, const bool priv) const;\r\n \r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex d79d9e76f..d327ab021 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -289,7 +289,7 @@ public:\r\n         for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\r\n             int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\r\n             if (current_range_end > last_range_end) {\r\n-                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeysWithMinIndex(last_range_end)) {\r\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\r\n                     m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\r\n                 }\r\n                 m_last_range_ends.at(desc_spkm) = current_range_end;\r\n```\r\n\r\n</details>",
      "created_at": "2022-09-07T09:51:10Z",
      "updated_at": "2022-09-07T09:51:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964632557",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964632557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964649158",
      "pull_request_review_id": 1098899253,
      "id": 964649158,
      "node_id": "PRRC_kwDOABII5845f2DG",
      "diff_hunk": "@@ -2652,6 +2652,18 @@ const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::Ge\n     return script_pub_keys;\n }\n \n+const std::vector<CScript> DescriptorScriptPubKeyMan::GetScriptPubKeysWithMinIndex(int32_t minimum_index) const\n+{\n+    LOCK(cs_desc_man);\n+    std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+\n+    for (auto const& [script_pub_key, index] : m_map_script_pub_keys) {\n+        if (index >= minimum_index) script_pub_keys.emplace_back(script_pub_key);\n+    }\n+    return script_pub_keys;\n+}",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "d0114e02cddd9bf1cc8760ebe95941f80609259b",
      "in_reply_to_id": 962928271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, now I fully understand what you mean, looks good at a first glance and should work. Somehow I missed the simple idea of just calling the overloaded method with from the one that is overrided (i.e. `GetScriptPubKeys(0)`) and was too focused on solving it with default parameter. Returning a `std::unordered_set` rather than `std::vector` should also be fine for our purposes. Will try that out in a bit ðŸ‘ ",
      "created_at": "2022-09-07T10:07:46Z",
      "updated_at": "2022-09-07T10:07:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964649158",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/964649158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 2655,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2661,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966553271",
      "pull_request_review_id": 1101601457,
      "id": 966553271,
      "node_id": "PRRC_kwDOABII5845nG63",
      "diff_hunk": "@@ -198,7 +198,9 @@ static RPCHelpMan loadwallet()\n     return RPCHelpMan{\"loadwallet\",\n                 \"\\nLoads a wallet from a wallet file or directory.\"\n                 \"\\nNote that all wallet command-line options used when starting bitcoind will be\"\n-                \"\\napplied to the new wallet.\\n\",\n+                \"\\napplied to the new wallet.\"\n+                \"\\nThe rescan is significantly faster if a descriptor wallet is loaded\"\n+                \"\\nand block filters are available (bitcoind option \\\"-blockfilterindex=1\\\").\\n\",",
      "path": "src/wallet/rpc/wallet.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not sure it makes sense to talk about rescans on `loadwallet`. It can happen, but hopefully shouldn't be very often.",
      "created_at": "2022-09-09T01:51:01Z",
      "updated_at": "2022-09-09T01:58:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r966553271",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966553271"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 202,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 203,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966553892",
      "pull_request_review_id": 1101601457,
      "id": 966553892,
      "node_id": "PRRC_kwDOABII5845nHEk",
      "diff_hunk": "@@ -643,6 +643,7 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n \n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n     const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys() const override;\n+    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index) const;",
      "path": "src/wallet/scriptpubkeyman.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index = 0) const;\r\n```",
      "created_at": "2022-09-09T01:52:50Z",
      "updated_at": "2022-09-09T01:58:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r966553892",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966553892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": 645,
      "original_start_line": 645,
      "start_side": "RIGHT",
      "line": 646,
      "original_line": 646,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966554589",
      "pull_request_review_id": 1101601457,
      "id": 966554589,
      "node_id": "PRRC_kwDOABII5845nHPd",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 89,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n```",
      "created_at": "2022-09-09T01:54:46Z",
      "updated_at": "2022-09-09T01:58:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r966554589",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/966554589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1847,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968587412",
      "pull_request_review_id": 1104388445,
      "id": 968587412,
      "node_id": "PRRC_kwDOABII5845u3iU",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each active descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    static int32_t GetDescriptorRangeEnd(const DescriptorScriptPubKeyMan& desc_spkm)\n+    {\n+        LOCK(desc_spkm.cs_desc_man);\n+        return desc_spkm.GetWalletDescriptor().range_end;\n+    }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1daead3b4adb5a54b8999bdd1cece9cccf152499",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What about using `desc_spkm->m_max_cached_index` directly in the caller side instead?",
      "created_at": "2022-09-12T15:51:11Z",
      "updated_at": "2022-09-12T16:21:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968587412",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968587412"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 316,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968631594",
      "pull_request_review_id": 1104453139,
      "id": 968631594,
      "node_id": "PRRC_kwDOABII5845vCUq",
      "diff_hunk": "@@ -8,6 +8,7 @@\n #include <chainparams.h>\n #include <deploymentstatus.h>\n #include <external_signer.h>\n+#include <index/blockfilterindex.h>",
      "path": "src/node/interfaces.cpp",
      "position": 9,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think you also need to include blockfilter.h here.",
      "created_at": "2022-09-12T16:33:40Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968631594",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968631594"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 12,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968875953",
      "pull_request_review_id": 1104755402,
      "id": 968875953,
      "node_id": "PRRC_kwDOABII5845v9-x",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each active descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1daead3b4adb5a54b8999bdd1cece9cccf152499",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think that pointers are a good design choice for map keys. Would rather use the spkm id:\r\n```suggestion\r\n    std::map<uint256, int32_t> m_last_range_ends;\r\n```",
      "created_at": "2022-09-12T19:54:20Z",
      "updated_at": "2022-09-12T19:54:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968875953",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968875953"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968930318",
      "pull_request_review_id": 1104453139,
      "id": 968930318,
      "node_id": "PRRC_kwDOABII5845wLQO",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: structure\r\n```suggestion\r\n            // save each active ScriptPubKeyMans's range end for possible future filter updates\r\n```",
      "created_at": "2022-09-12T21:05:10Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968930318",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968930318"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 279,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968944391",
      "pull_request_review_id": 1104453139,
      "id": 968944391,
      "node_id": "PRRC_kwDOABII5845wOsH",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: {} list initialization (in a few other places too)\r\n```suggestion\r\n        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\r\n```",
      "created_at": "2022-09-12T21:22:54Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968944391",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968944391"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 273,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968951824",
      "pull_request_review_id": 1104453139,
      "id": 968951824,
      "node_id": "PRRC_kwDOABII5845wQgQ",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You could put this into its own function, e.g. `FastWalletRescanFilter::AddScriptPubKeys(DescriptorScriptPubKeyMan* desc_spkm, int32_t last_range_end = 0)`, so you can avoid the duplication in `UpdateIfNeeded()`? I think it'd be a bit more readable too (not that it's bad now)",
      "created_at": "2022-09-12T21:32:01Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968951824",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968951824"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 276,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 278,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968956532",
      "pull_request_review_id": 1104453139,
      "id": 968956532,
      "node_id": "PRRC_kwDOABII5845wRp0",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not very familiar with the wallet rescanning process, but I wonder if we should also check if there are any new spkms? If so, and if you would then want to track `active_spkms` as an internal member, you could extend `FastWalletRescanFilter::AddScriptPubKeys` from my other comment and have it update `m_last_range_ends` too for more deduplication.",
      "created_at": "2022-09-12T21:39:19Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968956532",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968956532"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 289,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968961724",
      "pull_request_review_id": 1104453139,
      "id": 968961724,
      "node_id": "PRRC_kwDOABII5845wS68",
      "diff_hunk": "@@ -1748,7 +1808,11 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     uint256 block_hash = start_block;\n     ScanResult result;\n \n-    WalletLogPrintf(\"Rescan started from block %s...\\n\", start_block.ToString());\n+    std::unique_ptr<FastWalletRescanFilter> fast_rescan_filter;\n+    if (!IsLegacy() && chain().hasBlockFilterIndex(BlockFilterType::BASIC)) fast_rescan_filter.reset(new FastWalletRescanFilter(*this));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should include blockfilter.h",
      "created_at": "2022-09-12T21:47:16Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968961724",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968961724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968963378",
      "pull_request_review_id": 1104453139,
      "id": 968963378,
      "node_id": "PRRC_kwDOABII5845wTUy",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            if (match_result.value_or(false)) {\r\n```",
      "created_at": "2022-09-12T21:50:02Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968963378",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968963378"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968964566",
      "pull_request_review_id": 1104453139,
      "id": 968964566,
      "node_id": "PRRC_kwDOABII5845wTnW",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 89,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966554589,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm quite confused by this comment, so +1 on removing or clarifying. \"Block does not match filter, mark it as scanned so ...\"",
      "created_at": "2022-09-12T21:52:12Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968964566",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968964566"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1847,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968972271",
      "pull_request_review_id": 1104453139,
      "id": 968972271,
      "node_id": "PRRC_kwDOABII5845wVfv",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What do you think about putting this in a separate function that returns `bool skip_block`? `CWallet::ScanForWalletTransactions()` is already quite bloated, I think we should try not to add to it?",
      "created_at": "2022-09-12T22:03:41Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968972271",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968972271"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968977557",
      "pull_request_review_id": 1104453139,
      "id": 968977557,
      "node_id": "PRRC_kwDOABII5845wWyV",
      "diff_hunk": "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that fast rescan using block filters for descriptor wallets detects\n+   top-ups correctly and finds the same transactions than the slow variant.\"\"\"\n+import os\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+from test_framework.wallet import MiniWallet\n+\n+\n+KEYPOOL_SIZE = 100   # smaller than default size to speed-up test\n+NUM_DESCRIPTORS = 8  # number of descriptors on a fresh wallet created by default\n+NUM_BLOCKS = 6       # number of blocks to mine\n+\n+\n+class WalletFastRescanTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[f'-keypool={KEYPOOL_SIZE}', '-blockfilterindex=1']]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def get_wallet_txids(self, node, wallet_name):",
      "path": "test/functional/wallet_fast_rescan.py",
      "position": null,
      "original_position": 28,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: PEP484\r\n```suggestion\r\n    def get_wallet_txids(self, node: TestNode, wallet_name: str) -> List[str]:\r\n```",
      "created_at": "2022-09-12T22:10:57Z",
      "updated_at": "2022-09-12T22:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r968977557",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/968977557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969026772",
      "pull_request_review_id": 1104961889,
      "id": 969026772,
      "node_id": "PRRC_kwDOABII5845wizU",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968956532,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not needed. Every import command checks if a rescan is being performed prior execution (it's the `WalletRescanReserver` purpose).",
      "created_at": "2022-09-13T00:03:14Z",
      "updated_at": "2022-09-13T00:03:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969026772",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969026772"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 289,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969462249",
      "pull_request_review_id": 1105560530,
      "id": 969462249,
      "node_id": "PRRC_kwDOABII5845yNHp",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968956532,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for clarifying. At first sight, that seems quite a fragile assumption since it's implicit and requires every user of FastWalletRescanFilter to do that check voluntarily. Some kind of assertion would be nice but would go at the cost of performance to call and cast all spkms after every block, so maybe not worth it.",
      "created_at": "2022-09-13T10:46:19Z",
      "updated_at": "2022-09-13T10:46:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969462249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969462249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 289,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969484725",
      "pull_request_review_id": 1105590992,
      "id": 969484725,
      "node_id": "PRRC_kwDOABII5845ySm1",
      "diff_hunk": "@@ -643,6 +643,7 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n \n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n     const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys() const override;\n+    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index) const;",
      "path": "src/wallet/scriptpubkeyman.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966553892,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In that case, it would be also need to change `LegacyScriptPubKeyMan::GetScriptPubKeys` to `LegacyScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index)`",
      "created_at": "2022-09-13T11:10:08Z",
      "updated_at": "2022-09-13T11:10:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969484725",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969484725"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": 645,
      "original_start_line": 645,
      "start_side": "RIGHT",
      "line": 646,
      "original_line": 646,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969540182",
      "pull_request_review_id": 1105670135,
      "id": 969540182,
      "node_id": "PRRC_kwDOABII5845ygJW",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each active descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    static int32_t GetDescriptorRangeEnd(const DescriptorScriptPubKeyMan& desc_spkm)\n+    {\n+        LOCK(desc_spkm.cs_desc_man);\n+        return desc_spkm.GetWalletDescriptor().range_end;\n+    }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1daead3b4adb5a54b8999bdd1cece9cccf152499",
      "in_reply_to_id": 968587412,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`m_max_cached_index` is a private member and therefore not accessible from the outside. Not sure if it's worth it to extend the descriptor SPK-man interface and add a corresponding getter member function (e.g. `DescriptorScriptPubKeyMan::GetMaxCachedIndex()`) only for this use-case. ",
      "created_at": "2022-09-13T12:08:51Z",
      "updated_at": "2022-09-13T12:08:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969540182",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969540182"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 316,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 323,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969546305",
      "pull_request_review_id": 1105679130,
      "id": 969546305,
      "node_id": "PRRC_kwDOABII5845yhpB",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think that's logically equivalent. \r\n* \"we have a result, and the result is negative\" (PR), versus\r\n* \"we have a result, and the result is positive\" (your suggestion)\r\n\r\n(according to https://en.cppreference.com/w/cpp/utility/optional/value_or: \"Returns the **contained value** if *this has a value, otherwise returns default_value.\")",
      "created_at": "2022-09-13T12:15:09Z",
      "updated_at": "2022-09-13T12:15:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969546305",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969546305"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969588599",
      "pull_request_review_id": 1105744404,
      "id": 969588599,
      "node_id": "PRRC_kwDOABII5845yr93",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You're right, I should have inversed it. This should be equivalent though:\r\n\r\n```suggestion\r\n            if (!match_result.value_or(true)) {\r\n```",
      "created_at": "2022-09-13T12:54:39Z",
      "updated_at": "2022-09-13T12:54:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969588599",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969588599"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969594441",
      "pull_request_review_id": 1105753065,
      "id": 969594441,
      "node_id": "PRRC_kwDOABII5845ytZJ",
      "diff_hunk": "@@ -536,6 +537,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool hasBlockFilterIndex(BlockFilterType filter_type) override\n+    {\n+        return GetBlockFilterIndex(filter_type) != nullptr;\n+    }\n+    std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(filter_type);\n+        if (!block_filter_index) return std::nullopt;\n+\n+        BlockFilter filter;\n+        const CBlockIndex* index = WITH_LOCK(::cs_main, return chainman().m_blockman.LookupBlockIndex(block_hash));\n+        if (!block_filter_index->LookupFilter(index, filter)) return std::nullopt;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No need to add `block_filter_index->BlockUntilSyncedToCurrentChain` ?\r\nCurrently it seems to assume the chain is already synced.\r\n\r\n```suggestion\r\n        if (!block_filter_index->BlockUntilSyncedToCurrentChain() || !block_filter_index->LookupFilter(index, filter)) return std::nullopt;\r\n```",
      "created_at": "2022-09-13T12:59:30Z",
      "updated_at": "2022-09-13T12:59:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969594441",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969594441"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 552,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969612249",
      "pull_request_review_id": 1105779173,
      "id": 969612249,
      "node_id": "PRRC_kwDOABII5845yxvZ",
      "diff_hunk": "@@ -1846,35 +1862,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n         uint256 next_block_hash;\n         chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(next_block_hash)));\n \n-        if (!block.IsNull()) {\n-            LOCK(cs_wallet);\n-            if (!block_still_active) {\n-                // Abort scan if current block is no longer active, to prevent\n-                // marking transactions as coming from the wrong block.\n-                result.last_failed_block = block_hash;\n-                result.status = ScanResult::FAILURE;\n-                break;\n-            }\n-            for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, static_cast<int>(posInBlock)}, fUpdate, /*rescanning_old_block=*/true);\n-            }\n-            // scan succeeded, record block as most recent successfully scanned\n-            result.last_scanned_block = block_hash;\n-            result.last_scanned_height = block_height;\n+        if (!skip_block) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "df89e3c0c4007c73f241808674bc799ab6fec490",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Doesn't ` if (!skip_block) chain().findBlock(block_hash, FoundBlock().data(block));` guarantee that the block will be null if `skip_block` is true ?",
      "created_at": "2022-09-13T13:14:38Z",
      "updated_at": "2022-09-13T13:14:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969612249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969612249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1876,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969677247",
      "pull_request_review_id": 1105875235,
      "id": 969677247,
      "node_id": "PRRC_kwDOABII5845zBm_",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each active descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1daead3b4adb5a54b8999bdd1cece9cccf152499",
      "in_reply_to_id": 968875953,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Valid point, I struggled with the key type choice a lot. In an earlier version (before the PR was opened) I even used IDs at keys, but the drawback of this is that it leads to more code, as we (artificially?) need to convert between SPKM-Id and DescriptorScriptPubKey* pointers again and again, i.e. needing to call `CWallet::GetScriptPubKeyMan(const uint256& id)` (+casting the result to `DescriptorScriptPubKeyMan*`) at every iteration of the map and call `DescriptorScriptPubKeyMan::GetID()` before every insertion into the map. Considering that the result is always the same, it seems a bit excessive to recalculate the ID (involving creation of a string and hashing it, see `DescriptorScriptPubKeyMan::GetID()`) again and again. As long as we are sure that the different pointers are constant and unique, using them as keys should be okay? (At least, I couldn't find anything stating that it should be avoided, as long as we know what we are doing; e.g. https://stackoverflow.com/questions/25122932/pointers-as-keys-in-map-c-stl).\r\n\r\nAny thoughts?",
      "created_at": "2022-09-13T14:06:53Z",
      "updated_at": "2022-09-13T14:06:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969677247",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969677247"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969742529",
      "pull_request_review_id": 1105972131,
      "id": 969742529,
      "node_id": "PRRC_kwDOABII5845zRjB",
      "diff_hunk": "@@ -198,7 +198,9 @@ static RPCHelpMan loadwallet()\n     return RPCHelpMan{\"loadwallet\",\n                 \"\\nLoads a wallet from a wallet file or directory.\"\n                 \"\\nNote that all wallet command-line options used when starting bitcoind will be\"\n-                \"\\napplied to the new wallet.\\n\",\n+                \"\\napplied to the new wallet.\"\n+                \"\\nThe rescan is significantly faster if a descriptor wallet is loaded\"\n+                \"\\nand block filters are available (bitcoind option \\\"-blockfilterindex=1\\\").\\n\",",
      "path": "src/wallet/rpc/wallet.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966553271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, restored the original help text for `loadwallet` on the latest force-push.",
      "created_at": "2022-09-13T14:59:36Z",
      "updated_at": "2022-09-13T14:59:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969742529",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969742529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 202,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 203,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969744751",
      "pull_request_review_id": 1105975371,
      "id": 969744751,
      "node_id": "PRRC_kwDOABII5845zSFv",
      "diff_hunk": "@@ -643,6 +643,7 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n \n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n     const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys() const override;\n+    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index) const;",
      "path": "src/wallet/scriptpubkeyman.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966553892,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> In that case, it would be also need to change `LegacyScriptPubKeyMan::GetScriptPubKeys` to `LegacyScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index)`\r\n\r\nYes, we would need to impose the parameter on the base class, which I think wouldn't make much sense (the `minimum_index` for this method is only useful for descriptor wallets). Also see the discussion here: https://github.com/bitcoin/bitcoin/pull/25957#discussion_r964582588",
      "created_at": "2022-09-13T15:01:24Z",
      "updated_at": "2022-09-13T15:01:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969744751",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969744751"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": 645,
      "original_start_line": 645,
      "start_side": "RIGHT",
      "line": 646,
      "original_line": 646,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745183",
      "pull_request_review_id": 1105976037,
      "id": 969745183,
      "node_id": "PRRC_kwDOABII5845zSMf",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 89,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966554589,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, removed it.",
      "created_at": "2022-09-13T15:01:46Z",
      "updated_at": "2022-09-13T15:01:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969745183",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745183"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1847,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745394",
      "pull_request_review_id": 1105976397,
      "id": 969745394,
      "node_id": "PRRC_kwDOABII5845zSPy",
      "diff_hunk": "@@ -8,6 +8,7 @@\n #include <chainparams.h>\n #include <deploymentstatus.h>\n #include <external_signer.h>\n+#include <index/blockfilterindex.h>",
      "path": "src/node/interfaces.cpp",
      "position": 9,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968631594,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-09-13T15:01:58Z",
      "updated_at": "2022-09-13T15:01:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969745394",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 12,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745528",
      "pull_request_review_id": 1105976601,
      "id": 969745528,
      "node_id": "PRRC_kwDOABII5845zSR4",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968930318,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-09-13T15:02:05Z",
      "updated_at": "2022-09-13T15:02:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969745528",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745528"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 279,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745892",
      "pull_request_review_id": 1105977184,
      "id": 969745892,
      "node_id": "PRRC_kwDOABII5845zSXk",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968944391,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to list initialization in all commits (hope I didn't miss any instances).",
      "created_at": "2022-09-13T15:02:24Z",
      "updated_at": "2022-09-13T15:02:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969745892",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969745892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 273,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969746610",
      "pull_request_review_id": 1105978238,
      "id": 969746610,
      "node_id": "PRRC_kwDOABII5845zSiy",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968951824,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good idea, introduced a new private method `AddScriptPubKeys` as suggested.",
      "created_at": "2022-09-13T15:02:59Z",
      "updated_at": "2022-09-13T15:02:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969746610",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969746610"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 276,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 278,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969747034",
      "pull_request_review_id": 1105978838,
      "id": 969747034,
      "node_id": "PRRC_kwDOABII5845zSpa",
      "diff_hunk": "@@ -1748,7 +1808,11 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     uint256 block_hash = start_block;\n     ScanResult result;\n \n-    WalletLogPrintf(\"Rescan started from block %s...\\n\", start_block.ToString());\n+    std::unique_ptr<FastWalletRescanFilter> fast_rescan_filter;\n+    if (!IsLegacy() && chain().hasBlockFilterIndex(BlockFilterType::BASIC)) fast_rescan_filter.reset(new FastWalletRescanFilter(*this));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 73,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968961724,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done.",
      "created_at": "2022-09-13T15:03:20Z",
      "updated_at": "2022-09-13T15:03:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969747034",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969747034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969748698",
      "pull_request_review_id": 1105981245,
      "id": 969748698,
      "node_id": "PRRC_kwDOABII5845zTDa",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "While I agree that this is now logically equivalent, I doubt that it's more readable.",
      "created_at": "2022-09-13T15:04:46Z",
      "updated_at": "2022-09-13T15:04:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969748698",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969748698"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969749083",
      "pull_request_review_id": 1105981809,
      "id": 969749083,
      "node_id": "PRRC_kwDOABII5845zTJb",
      "diff_hunk": "@@ -0,0 +1,73 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test that fast rescan using block filters for descriptor wallets detects\n+   top-ups correctly and finds the same transactions than the slow variant.\"\"\"\n+import os\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import assert_equal\n+from test_framework.wallet import MiniWallet\n+\n+\n+KEYPOOL_SIZE = 100   # smaller than default size to speed-up test\n+NUM_DESCRIPTORS = 8  # number of descriptors on a fresh wallet created by default\n+NUM_BLOCKS = 6       # number of blocks to mine\n+\n+\n+class WalletFastRescanTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[f'-keypool={KEYPOOL_SIZE}', '-blockfilterindex=1']]\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+        self.skip_if_no_sqlite()\n+\n+    def get_wallet_txids(self, node, wallet_name):",
      "path": "test/functional/wallet_fast_rescan.py",
      "position": null,
      "original_position": 28,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968977557,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-09-13T15:05:05Z",
      "updated_at": "2022-09-13T15:05:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969749083",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969749083"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969759874",
      "pull_request_review_id": 1105996619,
      "id": 969759874,
      "node_id": "PRRC_kwDOABII5845zVyC",
      "diff_hunk": "@@ -260,6 +260,66 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms = m_wallet.GetActiveScriptPubKeyMans();\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm = dynamic_cast<DescriptorScriptPubKeyMan*>(spkm);\n+            for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys()) {\n+                m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+            }\n+            // save active ScriptPubKeyMans's end ranges for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm, GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm, last_range_end] : m_last_range_ends) {\n+            int32_t current_range_end = GetDescriptorRangeEnd(*desc_spkm);\n+            if (current_range_end > last_range_end) {\n+                for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+                    m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+                }\n+                m_last_range_ends.at(desc_spkm) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each active descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<const DescriptorScriptPubKeyMan*, int32_t> m_last_range_ends;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1daead3b4adb5a54b8999bdd1cece9cccf152499",
      "in_reply_to_id": 968875953,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Decided to use SPKM-IDs, as I think it's indeed the clearer design choice -- the recalculation of the IDs only happens on repopulation of the filter (due to detected top-up), and shouldn't affect the performance at all. Leaving this conversation open for further discussion though, if anyone has objections.",
      "created_at": "2022-09-13T15:13:42Z",
      "updated_at": "2022-09-13T15:13:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969759874",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969759874"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969778740",
      "pull_request_review_id": 1106022585,
      "id": 969778740,
      "node_id": "PRRC_kwDOABII5845zaY0",
      "diff_hunk": "@@ -536,6 +537,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool hasBlockFilterIndex(BlockFilterType filter_type) override\n+    {\n+        return GetBlockFilterIndex(filter_type) != nullptr;\n+    }\n+    std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(filter_type);\n+        if (!block_filter_index) return std::nullopt;\n+\n+        BlockFilter filter;\n+        const CBlockIndex* index = WITH_LOCK(::cs_main, return chainman().m_blockman.LookupBlockIndex(block_hash));\n+        if (!block_filter_index->LookupFilter(index, filter)) return std::nullopt;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 969594441,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Have to look deeper into the details here, but I think if we are not fully synced yet, it's still better to use block filters for a (possibly small) subset of the chain rather to not use them at all?",
      "created_at": "2022-09-13T15:28:16Z",
      "updated_at": "2022-09-13T15:28:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969778740",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969778740"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 552,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969807967",
      "pull_request_review_id": 1106063575,
      "id": 969807967,
      "node_id": "PRRC_kwDOABII5845zhhf",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968972271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thought about that already and agree that bloat should be avoided, but couldn't come up with a satisfying function name yet (`CanBlockBeSkippedDueToFastRescanFilter`?) and was concerned that the \"fast rescan\" functionality in the wallet would become too scattered. One class and once place where to use this class seems to be more compact and self-contained than class + function (that passes the class instance) + another function where this is called.\r\n\r\nAny conrete suggestions there? Happy to follow-up. (Another possible variant would be to put the check directly into `FastWalletRescanFilter`, as a method? Not sure.)",
      "created_at": "2022-09-13T15:53:45Z",
      "updated_at": "2022-09-13T15:53:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969807967",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969807967"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969820543",
      "pull_request_review_id": 1106080989,
      "id": 969820543,
      "node_id": "PRRC_kwDOABII5845zkl_",
      "diff_hunk": "@@ -1846,35 +1862,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n         uint256 next_block_hash;\n         chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(next_block_hash)));\n \n-        if (!block.IsNull()) {\n-            LOCK(cs_wallet);\n-            if (!block_still_active) {\n-                // Abort scan if current block is no longer active, to prevent\n-                // marking transactions as coming from the wrong block.\n-                result.last_failed_block = block_hash;\n-                result.status = ScanResult::FAILURE;\n-                break;\n-            }\n-            for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, static_cast<int>(posInBlock)}, fUpdate, /*rescanning_old_block=*/true);\n-            }\n-            // scan succeeded, record block as most recent successfully scanned\n-            result.last_scanned_block = block_hash;\n-            result.last_scanned_height = block_height;\n+        if (!skip_block) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "df89e3c0c4007c73f241808674bc799ab6fec490",
      "in_reply_to_id": 969612249,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Note that the `if (!block.IsNull()) { ... }` block has an else-condition below that we don't want to reach (it sets `ScanResult::FAILURE`) if we skipped the block due to the fast rescan filter. Reviewing with `--ignore-all-space` should show the diff a bit more clearly to see it. (Or did I interpret your comment wrongly and you meant something else?)",
      "created_at": "2022-09-13T16:05:04Z",
      "updated_at": "2022-09-13T16:05:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969820543",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969820543"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1876,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969829282",
      "pull_request_review_id": 1106090942,
      "id": 969829282,
      "node_id": "PRRC_kwDOABII5845zmui",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe it's me, but for some reason I'm often confused by `!` for negating in general, including in the second hand of the original version (as per my initial wrong suggestion, apparently). What about `match_result.value_or(true) == false)`? I think that's concise and clear. I'm just not a fan of \"re-implementing\" the `value_or()` when it's so common.\r\n\r\nDon't want to bikeshed over this obviously, so as you see fit - no further comment.",
      "created_at": "2022-09-13T16:11:43Z",
      "updated_at": "2022-09-13T16:11:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969829282",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969829282"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969872030",
      "pull_request_review_id": 1106150569,
      "id": 969872030,
      "node_id": "PRRC_kwDOABII5845zxKe",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968972271,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I like the idea of moving (part of the logic) to `FastWalletRescanFilter`, yeah. What do you think about the below diff? I didn't test it very carefully (tests pass though) but it seems equivalent and imo more readable?\r\n\r\n<details>\r\n\r\n```diff\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex d3f1fb418..fdc5fdc7f 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -282,6 +282,14 @@ public:\r\n         }\r\n     }\r\n \r\n+    bool BlockNotInFilter(uint256 block_hash)\r\n+    {\r\n+        UpdateIfNeeded();\r\n+        auto block_in_filter{MatchesBlock(block_hash)};\r\n+        return block_in_filter.value_or(true) == false;\r\n+    }\r\n+\r\n+private:\r\n     void UpdateIfNeeded()\r\n     {\r\n         // repopulate filter with new scripts if top-up has happened since last iteration\r\n@@ -300,7 +308,6 @@ public:\r\n         return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\r\n     }\r\n \r\n-private:\r\n     const CWallet& m_wallet;\r\n     /** Map for keeping track of each active descriptor's last seen end range.\r\n       * This information is used to detect whether new addresses were derived\r\n@@ -1843,16 +1850,7 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\r\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\r\n         }\r\n \r\n-        bool skip_block{false};\r\n-        if (fast_rescan_filter) {\r\n-            fast_rescan_filter->UpdateIfNeeded();\r\n-            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\r\n-            if (match_result.has_value() && !match_result.value()) {\r\n-                result.last_scanned_block = block_hash;\r\n-                result.last_scanned_height = block_height;\r\n-                skip_block = true;\r\n-            }\r\n-        }\r\n+        bool skip_block{fast_rescan_filter ? fast_rescan_filter->BlockNotInFilter(block_hash) : false};\r\n \r\n         // Read block data\r\n         CBlock block;\r\n@@ -1865,7 +1863,10 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\r\n         uint256 next_block_hash;\r\n         chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(next_block_hash)));\r\n \r\n-        if (!skip_block) {\r\n+        if (skip_block) {\r\n+            result.last_scanned_block = block_hash;\r\n+            result.last_scanned_height = block_height;\r\n+        } else {\r\n             if (!block.IsNull()) {\r\n                 LOCK(cs_wallet);\r\n                 if (!block_still_active) {\r\n\r\n```\r\n\r\n</details>\r\n\r\nEdit: not blocking of course, can be a follow-up too.",
      "created_at": "2022-09-13T16:54:37Z",
      "updated_at": "2022-09-14T10:13:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969872030",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/969872030"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970212322",
      "pull_request_review_id": 1106625970,
      "id": 970212322,
      "node_id": "PRRC_kwDOABII58451EPi",
      "diff_hunk": "@@ -1846,35 +1862,37 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n         uint256 next_block_hash;\n         chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(next_block_hash)));\n \n-        if (!block.IsNull()) {\n-            LOCK(cs_wallet);\n-            if (!block_still_active) {\n-                // Abort scan if current block is no longer active, to prevent\n-                // marking transactions as coming from the wrong block.\n-                result.last_failed_block = block_hash;\n-                result.status = ScanResult::FAILURE;\n-                break;\n-            }\n-            for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                SyncTransaction(block.vtx[posInBlock], TxStateConfirmed{block_hash, block_height, static_cast<int>(posInBlock)}, fUpdate, /*rescanning_old_block=*/true);\n-            }\n-            // scan succeeded, record block as most recent successfully scanned\n-            result.last_scanned_block = block_hash;\n-            result.last_scanned_height = block_height;\n+        if (!skip_block) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "df89e3c0c4007c73f241808674bc799ab6fec490",
      "in_reply_to_id": 969612249,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Got it. Originally if the block is null, this is a reason for failure. With `skip_block`, this can happen if the filter was applied.",
      "created_at": "2022-09-14T01:26:38Z",
      "updated_at": "2022-09-14T01:26:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r970212322",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970212322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1876,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970213784",
      "pull_request_review_id": 1106627907,
      "id": 970213784,
      "node_id": "PRRC_kwDOABII58451EmY",
      "diff_hunk": "@@ -536,6 +537,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool hasBlockFilterIndex(BlockFilterType filter_type) override\n+    {\n+        return GetBlockFilterIndex(filter_type) != nullptr;\n+    }\n+    std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(filter_type);\n+        if (!block_filter_index) return std::nullopt;\n+\n+        BlockFilter filter;\n+        const CBlockIndex* index = WITH_LOCK(::cs_main, return chainman().m_blockman.LookupBlockIndex(block_hash));\n+        if (!block_filter_index->LookupFilter(index, filter)) return std::nullopt;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 969594441,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Reviewing the code again, it seems to me that if the index not fully synced, the wallet will normally scan the remaining blocks. In this case, this change is really not necessary.",
      "created_at": "2022-09-14T01:30:34Z",
      "updated_at": "2022-09-14T01:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r970213784",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/970213784"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 552,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973054394",
      "pull_request_review_id": 1110730675,
      "id": 973054394,
      "node_id": "PRRC_kwDOABII5845_6G6",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can remove the `active_spkms` lookup by using `desc_spkm->IsRange()`.\r\nE.g.\r\n```c++\r\nfor (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\r\n     auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\r\n     AddScriptPubKeys(desc_spkm);\r\n     // save each spkm range end for possible future filter updates\r\n     if (desc_spkm->IsRange()) {\r\n         m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\r\n     }\r\n}\r\n```\r\n\r\nNote: `IsRange()` can be a simple:\r\n```c++\r\nbool DescriptorScriptPubKeyMan::IsRange()\r\n{\r\n   return WITH_LOCK(cs_desc_man, return GetWalletDescriptor().descriptor->IsRange());\r\n}\r\n```",
      "created_at": "2022-09-16T13:56:41Z",
      "updated_at": "2022-09-16T14:03:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r973054394",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/973054394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 274,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978723539",
      "pull_request_review_id": 1118547156,
      "id": 978723539,
      "node_id": "PRRC_kwDOABII5846ViLT",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm still not convinced, as I think there is more mental effort needed for a reader to grasp exactly what the \"block skip condition\" is. \"the filter matching routine returned a result, _and_ that result is negative\" is expressed more closely with the PR variant IMHO. Will still leave the discussion open for a while in case anyone wants to chime in. Maybe it's more a matter of taste and I have a bad one ðŸ˜› ",
      "created_at": "2022-09-23T14:16:42Z",
      "updated_at": "2022-09-23T14:16:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978723539",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978723539"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978725623",
      "pull_request_review_id": 1118551192,
      "id": 978725623,
      "node_id": "PRRC_kwDOABII5846Vir3",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968972271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Would prefer that for a follow-up, could possibly even be a larger one that generally tries to divide up `CWallet::ScanForWalletTransactions()` into more functions to reduce bloat. Just one thing about naming, though I also unfortunately don't have a better idea: `BlockNotInFilter` suggests that this method only retrieves information and as such doesn't have any side-effects (but it does, due to the `UpdateIfNeeded` call).",
      "created_at": "2022-09-23T14:18:34Z",
      "updated_at": "2022-09-23T14:18:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978725623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978725623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978731097",
      "pull_request_review_id": 1118559639,
      "id": 978731097,
      "node_id": "PRRC_kwDOABII5846VkBZ",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": 973054394,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Similar to the rationale in https://github.com/bitcoin/bitcoin/pull/25957#discussion_r969540182, I'd prefer to not extend the SPK-man interface with new methods unless absolutely needed, if I don't even know if it would be useful outside of this PR (which is \"only\" an optimization and doesn't add any functionality of its own). Only for saving one line of code in the ctor I don't think it's worth it.",
      "created_at": "2022-09-23T14:24:06Z",
      "updated_at": "2022-09-23T14:24:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978731097",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978731097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 274,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978740716",
      "pull_request_review_id": 1118575175,
      "id": 978740716,
      "node_id": "PRRC_kwDOABII5846VmXs",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As we are not using the returned optional value (which, if nullopt denotes that we don't have the filter index for it) and we only want to know if the set matches the block filter, could change `MatchesBlock` to return a simple boolean instead.\r\n\r\nSomething like:\r\n```c++\r\nstd::optional<bool> MatchesBlock(const uint256& block_hash) const\r\n{\r\n    auto matches{m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set)};\r\n    return matches && *matches;\r\n}\r\n```\r\n\r\nAnd then this specific line would just be:\r\n```suggestion\r\n            if (match_result) {\r\n```",
      "created_at": "2022-09-23T14:32:32Z",
      "updated_at": "2022-09-23T14:32:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978740716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978740716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978950432",
      "pull_request_review_id": 1118878931,
      "id": 978950432,
      "node_id": "PRRC_kwDOABII5846WZkg",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@furszy: Unfortunately that doesn't work. Remember that the condition for skipping a block if the filter does _not_ match  the block. If we just use `!match_result` as condition (I guess in your suggested change your just forgot the negation operator `!`), then we would also skip a block if the match function didn't return a result (e.g. because the block filter is not available), which is incorrect.",
      "created_at": "2022-09-23T18:10:15Z",
      "updated_at": "2022-09-23T18:10:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978950432",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978950432"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978987367",
      "pull_request_review_id": 1118932995,
      "id": 978987367,
      "node_id": "PRRC_kwDOABII5846Wiln",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I guess in your suggested change your just forgot the negation operator !\r\n\r\nit was a `!match_result`, yeah.\r\n\r\n> then we would also skip a block if the match function didn't return a result (e.g. because the block filter is not available), which is incorrect.\r\n\r\nThat is guarded by the `fast_rescan_filter` object existence (before create the object, you check if the filter index exist). If there isn't a filter index, then the object is never created, there by this line is never called.\r\n\r\nAs block filters are created with blocks (on the same connection signal), we shouldn't need to check for filter existence at this point of the code.\r\n\r\nStill.. there is still a tiny window of time for a race condition.. when a block gets stored and we are still creating the block filter..\r\nSo.. better to check the filter existence on every loop. And forget all what I just said :p",
      "created_at": "2022-09-23T19:05:33Z",
      "updated_at": "2022-09-23T19:05:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r978987367",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978987367"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979863337",
      "pull_request_review_id": 1120005419,
      "id": 979863337,
      "node_id": "PRRC_kwDOABII5846Z4cp",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm_id, last_range_end] : m_last_range_ends) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(m_wallet.GetScriptPubKeyMan(desc_spkm_id))};\n+            int32_t current_range_end{GetDescriptorRangeEnd(*desc_spkm)};",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "make sure `desc_spkm` is not `nullptr` before dereferencing",
      "created_at": "2022-09-26T10:58:30Z",
      "updated_at": "2022-09-26T11:04:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979863337",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979863337"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979863823",
      "pull_request_review_id": 1120005419,
      "id": 979863823,
      "node_id": "PRRC_kwDOABII5846Z4kP",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm_id, last_range_end] : m_last_range_ends) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        for (const auto& [desc_spkm_id, last_range_end] : m_last_range_ends) {\r\n```",
      "created_at": "2022-09-26T10:59:07Z",
      "updated_at": "2022-09-26T11:04:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979863823",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979863823"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979865164",
      "pull_request_review_id": 1120005419,
      "id": 979865164,
      "node_id": "PRRC_kwDOABII5846Z45M",
      "diff_hunk": "@@ -2641,13 +2641,18 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "it is returned by value anyway\r\n```suggestion\r\nstd::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const\r\n```",
      "created_at": "2022-09-26T11:00:44Z",
      "updated_at": "2022-09-26T11:04:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r979865164",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/979865164"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2651,
      "original_line": 2651,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982393105",
      "pull_request_review_id": 1123671424,
      "id": 982393105,
      "node_id": "PRRC_kwDOABII5846jiER",
      "diff_hunk": "@@ -2641,13 +2641,18 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const\n {\n     LOCK(cs_desc_man);\n     std::unordered_set<CScript, SaltedSipHasher> script_pub_keys;\n-    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+    script_pub_keys.reserve(std::max<size_t>(m_map_script_pub_keys.size() - minimum_index, 0));",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 13,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Since you're subtracting from an unsigned, `minimum_index` gets cast to unsigned and the expression overflows if `minimum_index` > `m_map_script_pub_keys.size()`.\r\n\r\n```suggestion\r\n    script_pub_keys.reserve(std::max(static_cast<int32_t>(m_map_script_pub_keys.size()) - minimum_index, 0));\r\n```\r\n\r\n(Note: the `static_cast<int32_t>` may overflow too)",
      "created_at": "2022-09-28T13:16:16Z",
      "updated_at": "2022-09-28T21:51:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982393105",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982393105"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2652,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982871332",
      "pull_request_review_id": 1123671424,
      "id": 982871332,
      "node_id": "PRRC_kwDOABII5846lW0k",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968972271,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Initially I agreed with your view (and had the same consideration when proposing) about `BlockNotInFilter` having side-effects. However, in this case upon further thinking I'm not sure that's a problem:\r\n- both `BlockNotInFilter()` and `UpdateIfNeeded()` are idempotent, we don't need to be concerned about running it \"too often\". `UpdateIfNeeded()` only has internal side-effects.\r\n- `UpdateIfNeeded()` is a separate/manual function to improve performance, so we don't continuously need to monitor/update the filter when it's not needed. All it does, is ensure the filter works _as expected_. From that perspective, I don't think `BlockNotInFilter()` has the kind of side-effects we should normally be worried about.",
      "created_at": "2022-09-28T21:19:11Z",
      "updated_at": "2022-09-28T21:51:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982871332",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982871332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982873205",
      "pull_request_review_id": 1123671424,
      "id": 982873205,
      "node_id": "PRRC_kwDOABII5846lXR1",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "A less controversial idea to improve readability: I think if the name represents what true/false means, it becomes clearer: for example `matches_block` instead of `match_result`. Also in this case, I think dereferencing is clearer than using `.value()`\r\n\r\n<details>\r\n<summary>git diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex d3f1fb418..2c2f80cfa 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -1846,8 +1846,8 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\r\n         bool skip_block{false};\r\n         if (fast_rescan_filter) {\r\n             fast_rescan_filter->UpdateIfNeeded();\r\n-            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\r\n-            if (match_result.has_value() && !match_result.value()) {\r\n+            auto matches_block{fast_rescan_filter->MatchesBlock(block_hash)};\r\n+            if (matches_block.has_value() && !*matches_block) {\r\n                 result.last_scanned_block = block_hash;\r\n                 result.last_scanned_height = block_height;\r\n                 skip_block = true;\r\n///\r\n\r\n</details>",
      "created_at": "2022-09-28T21:21:55Z",
      "updated_at": "2022-09-28T21:51:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r982873205",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982873205"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983223295",
      "pull_request_review_id": 1124847220,
      "id": 983223295,
      "node_id": "PRRC_kwDOABII5846msv_",
      "diff_hunk": "@@ -143,6 +144,13 @@ class Chain\n     //! or one of its ancestors.\n     virtual std::optional<int> findLocatorFork(const CBlockLocator& locator) = 0;\n \n+    //! Returns whether a block filter index is available.\n+    virtual bool hasBlockFilterIndex(BlockFilterType filter_type) = 0;\n+\n+    //! Returns whether any of the elements match the block via a BIP 157 block filter\n+    //! or std::nullopt if the block filter for this block couldn't be found.\n+    virtual std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) = 0;",
      "path": "src/interfaces/chain.h",
      "position": 17,
      "original_position": 17,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "f83bc26a5d2c93ff6d11e41b766e61cc8df7b45c",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "f83bc26a5d2c93ff6d11e41b766e61cc8df7b45c @ryanofsky does `GCSFilter::ElementSet` present any problems for #10102?",
      "created_at": "2022-09-29T08:20:47Z",
      "updated_at": "2022-09-30T09:18:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r983223295",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983223295"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983309189",
      "pull_request_review_id": 1124847220,
      "id": 983309189,
      "node_id": "PRRC_kwDOABII5846nBuF",
      "diff_hunk": "@@ -643,6 +643,7 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n \n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n     const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys() const override;\n+    const std::unordered_set<CScript, SaltedSipHasher> GetScriptPubKeys(int32_t minimum_index) const;",
      "path": "src/wallet/scriptpubkeyman.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 966553892,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Legacy wallets have similiar topup functionality, but only for the keypool. `LegacyScriptPubKeyMan::GetScriptPubKeys` on the other hands gets it keys from places like `KeyMap mapKeys` in `FillableSigningProvider`, which is an `std::map<CScriptID, CScript>`. There's no obvious way to get the first N keys for legacy without significant refactoring, afaik you'd have to look up the metadata for that which some ancient wallets don't have? \r\n\r\nSo I agree with having `GetScriptPubKeys(int32_t minimum_index)` for `DescriptorScriptPubKeyMan` only.",
      "created_at": "2022-09-29T09:36:11Z",
      "updated_at": "2022-09-30T09:18:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r983309189",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983309189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": 645,
      "original_start_line": 645,
      "start_side": "RIGHT",
      "line": 646,
      "original_line": 646,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983315923",
      "pull_request_review_id": 1124847220,
      "id": 983315923,
      "node_id": "PRRC_kwDOABII5846nDXT",
      "diff_hunk": "@@ -2641,13 +2641,18 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const\n {\n     LOCK(cs_desc_man);\n     std::unordered_set<CScript, SaltedSipHasher> script_pub_keys;\n-    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+    script_pub_keys.reserve(std::max<size_t>(m_map_script_pub_keys.size() - minimum_index, 0));",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 13,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": 982393105,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Or we could check `m_map_script_pub_keys.size() >= minimum_index` and return early if not. ",
      "created_at": "2022-09-29T09:42:32Z",
      "updated_at": "2022-09-30T09:18:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r983315923",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983315923"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2652,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984347822",
      "pull_request_review_id": 1124847220,
      "id": 984347822,
      "node_id": "PRRC_kwDOABII5846q_Su",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)",
      "path": "src/wallet/wallet.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "456097763d4bdf7ba35de2b3eb33d2160c8024c1: alternatively, maybe have the caller pass in a bunch of `DescriptorScriptPubKeyMan`s (separate argument for active and inactive / all)? Then you might not need the `assert` and `dynamic_cast`. In that case I'd rename it to `FastRescanFilterSPKM`. It would also make this class more reusable for a non-wallet descriptor rescan, like #23549.\r\n\r\nOn the other hand, it would just move a bunch of complexity into 1b6b09e399773c4bac56afead60e4d29e7fbb010.",
      "created_at": "2022-09-30T08:31:30Z",
      "updated_at": "2022-09-30T09:18:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r984347822",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984347822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984412126",
      "pull_request_review_id": 1126557919,
      "id": 984412126,
      "node_id": "PRRC_kwDOABII5846rO_e",
      "diff_hunk": "@@ -1839,9 +1843,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (match_result.has_value() && !match_result.value()) {\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1b6b09e399773c4bac56afead60e4d29e7fbb010",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1b6b09e399773c4bac56afead60e4d29e7fbb010: it may be worth adding a new log category `scan` (in `src/logging.cpp`) that outputs which blocks are _not_ skipped. That way I can look up the block hash for missing transactions and see if the problem was the filter or some other step.\r\n\r\nIn addition, this should log when a block doesn't have a filter (but filters have been enabled).",
      "created_at": "2022-09-30T09:41:04Z",
      "updated_at": "2022-09-30T09:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r984412126",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984412126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1853,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085333",
      "pull_request_review_id": 1127516149,
      "id": 985085333,
      "node_id": "PRRC_kwDOABII5846tzWV",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm_id, last_range_end] : m_last_range_ends) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(m_wallet.GetScriptPubKeyMan(desc_spkm_id))};\n+            int32_t current_range_end{GetDescriptorRangeEnd(*desc_spkm)};",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": 979863337,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done (in both loops).",
      "created_at": "2022-10-01T10:58:32Z",
      "updated_at": "2022-10-01T10:58:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985085333",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085333"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 291,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085358",
      "pull_request_review_id": 1127516166,
      "id": 985085358,
      "node_id": "PRRC_kwDOABII5846tzWu",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // fast rescanning via block filters is only supported by descriptor wallets right now\n+        assert(!m_wallet.IsLegacy());\n+\n+        // create initial filter with scripts from both active and non-active ScriptPubKeyMans\n+        auto active_spkms{m_wallet.GetActiveScriptPubKeyMans()};\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            AddScriptPubKeys(desc_spkm);\n+            // save each active ScriptPubKeyMans's range end for possible future filter updates\n+            if (active_spkms.find(spkm) != active_spkms.end()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), GetDescriptorRangeEnd(*desc_spkm));\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (auto [desc_spkm_id, last_range_end] : m_last_range_ends) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": 979863823,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-10-01T10:58:41Z",
      "updated_at": "2022-10-01T10:58:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985085358",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085358"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085438",
      "pull_request_review_id": 1127516250,
      "id": 985085438,
      "node_id": "PRRC_kwDOABII5846tzX-",
      "diff_hunk": "@@ -2641,13 +2641,18 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": 979865164,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done with a preparatory extra refactoring commit which changes the `ScriptPubKeyMan::GetScriptPubKeys()` interface (which imposes this on us).",
      "created_at": "2022-10-01T10:59:42Z",
      "updated_at": "2022-10-01T10:59:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985085438",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085438"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2651,
      "original_line": 2651,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085683",
      "pull_request_review_id": 1127516492,
      "id": 985085683,
      "node_id": "PRRC_kwDOABII5846tzbz",
      "diff_hunk": "@@ -2641,13 +2641,18 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const\n {\n     LOCK(cs_desc_man);\n     std::unordered_set<CScript, SaltedSipHasher> script_pub_keys;\n-    script_pub_keys.reserve(m_map_script_pub_keys.size());\n+    script_pub_keys.reserve(std::max<size_t>(m_map_script_pub_keys.size() - minimum_index, 0));",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": null,
      "original_position": 13,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0d611a80b43be1246047d60d93288e0648e8aeb8",
      "in_reply_to_id": 982393105,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Excellent find, thanks! Decided for the proposed solution of casting the `.size()` return value to int32_t.\r\n\r\n> Or we could check m_map_script_pub_keys.size() >= minimum_index and return early if not.\r\n\r\nThe comparison suffers from the same problem I think (i.e. signed value `minimum_index` could overflow in the course of getting casted to unsigned)?",
      "created_at": "2022-10-01T11:02:33Z",
      "updated_at": "2022-10-01T11:02:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985085683",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985085683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2652,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985090623",
      "pull_request_review_id": 1127520870,
      "id": 985090623,
      "node_id": "PRRC_kwDOABII5846t0o_",
      "diff_hunk": "@@ -1839,9 +1843,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (match_result.has_value() && !match_result.value()) {\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1b6b09e399773c4bac56afead60e4d29e7fbb010",
      "in_reply_to_id": 984412126,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done. As for now, I didn't introduce a new log category, but print it unconditionally via `WalletLogPrintf`.",
      "created_at": "2022-10-01T11:54:50Z",
      "updated_at": "2022-10-01T11:54:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985090623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985090623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1853,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985092563",
      "pull_request_review_id": 1127522572,
      "id": 985092563,
      "node_id": "PRRC_kwDOABII5846t1HT",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done ðŸ‘Œ  I agree this is more readable than the previous version.",
      "created_at": "2022-10-01T12:13:31Z",
      "updated_at": "2022-10-01T12:13:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985092563",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985092563"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985092996",
      "pull_request_review_id": 1127523002,
      "id": 985092996,
      "node_id": "PRRC_kwDOABII5846t1OE",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)",
      "path": "src/wallet/wallet.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": 984347822,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sounds like an interesting idea that is worth to be followed-up, primarily for the reusability argument. I think in the end we'd not get rid of the `assert` and `dynamic_cast` though, instead it's just shifted to the caller? (I don't see a way of avoiding the cast, since the wallet class methods `GetAllScriptPubKeyMans()` and `GetActiveScriptPubKeyMans()` only give us the SPKmans with the base class interface `ScriptPubKeyMan*`).",
      "created_at": "2022-10-01T12:18:31Z",
      "updated_at": "2022-10-01T12:18:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985092996",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985092996"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985095244",
      "pull_request_review_id": 1127525006,
      "id": 985095244,
      "node_id": "PRRC_kwDOABII5846t1xM",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {\n+                // Block is skipped, pretend that we found it successfully\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968972271,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good valid points, I tend to agree that in this case the side-effect is acceptable and we shouldn't worry. With the current version of the PR that introduced logging messages on two cases of the tri-state result (block filter not found or wallet filter matches block), as suggested by Sjors, it get's maybe a bit more difficult to put all this logic into a single method though; the logging would also need to be part of the method, if we want to distinguish between the concrete reason of why we don't skip a block. That said, I'm of course still open though for a potential follow-up that reduces `ScanForWalletTransaction` bloat.",
      "created_at": "2022-10-01T12:42:54Z",
      "updated_at": "2022-10-01T12:42:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985095244",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985095244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 1842,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1863,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985599495",
      "pull_request_review_id": 1128107422,
      "id": 985599495,
      "node_id": "PRRC_kwDOABII5846vw4H",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)",
      "path": "src/wallet/wallet.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": 984347822,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "While writing the suggestion, I implicitly assumed that a CWallet rescan function would call rescan on individual DescriptorScriptPubKeyMans, which would have removed the need for any casting. But scanning is done globally, which makes sense because otherwise you'd have to scan the blocks many times over.\r\n\r\nA larger refactor might add `MaybeMatch()` to the SPKM interface, which would return `true` for legacy and would use the filter for descriptors. But this would mean having N separate filters. Not sure how that impacts the overall false-positive rate.",
      "created_at": "2022-10-03T09:57:57Z",
      "updated_at": "2022-10-03T09:58:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985599495",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985599495"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985604707",
      "pull_request_review_id": 1128111895,
      "id": 985604707,
      "node_id": "PRRC_kwDOABII5846vyJj",
      "diff_hunk": "@@ -1781,9 +1851,26 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto matches_block{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (matches_block.has_value()) {\n+                if (*matches_block) {\n+                    WalletLogPrintf(\"Fast rescan: inspect block %d (filter matched)\\n\", block_height);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 103,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "c6c08603a334c1f2cd13023c878b9e42418f9b13",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can you add the hash here? (more useful when trying to see if a given block was matched)",
      "created_at": "2022-10-03T10:01:25Z",
      "updated_at": "2022-10-03T10:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985604707",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985604707"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1860,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985609287",
      "pull_request_review_id": 1128111895,
      "id": 985609287,
      "node_id": "PRRC_kwDOABII5846vzRH",
      "diff_hunk": "@@ -1839,9 +1843,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (match_result.has_value() && !match_result.value()) {\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1b6b09e399773c4bac56afead60e4d29e7fbb010",
      "in_reply_to_id": 984412126,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's probably a bit too much noise for a default log, and also confusing for anyone not familiar with these filters (and not trying to debug them). On the mainnet wallet I'm testing with (which has slightly more descriptors than the default) I get hundreds of these messages for every `Still rescanning` line.",
      "created_at": "2022-10-03T10:04:51Z",
      "updated_at": "2022-10-03T10:05:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985609287",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985609287"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1853,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985660957",
      "pull_request_review_id": 1128191666,
      "id": 985660957,
      "node_id": "PRRC_kwDOABII5846v_4d",
      "diff_hunk": "@@ -1775,9 +1839,21 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block = false;\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result = fast_rescan_filter->MatchesBlock(block_hash);\n+            if (match_result.has_value() && !match_result.value()) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "137347fad5b0c532f58d049ddee8a33ebf89dbf5",
      "in_reply_to_id": 968963378,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The next commit aa613697e9c0b9005d411562bfdf8bd727c0b02f makes things more readable anyway because both the `true` and `false` case are handled for logging.",
      "created_at": "2022-10-03T11:09:22Z",
      "updated_at": "2022-10-03T11:09:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r985660957",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985660957"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1850,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987116815",
      "pull_request_review_id": 1130301846,
      "id": 987116815,
      "node_id": "PRRC_kwDOABII58461jUP",
      "diff_hunk": "@@ -1781,9 +1851,26 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto matches_block{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (matches_block.has_value()) {\n+                if (*matches_block) {\n+                    WalletLogPrintf(\"Fast rescan: inspect block %d (filter matched)\\n\", block_height);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 103,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "c6c08603a334c1f2cd13023c878b9e42418f9b13",
      "in_reply_to_id": 985604707,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-10-04T16:44:55Z",
      "updated_at": "2022-10-04T16:44:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r987116815",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987116815"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1860,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987118075",
      "pull_request_review_id": 1130303564,
      "id": 987118075,
      "node_id": "PRRC_kwDOABII58461jn7",
      "diff_hunk": "@@ -1839,9 +1843,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto match_result{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (match_result.has_value() && !match_result.value()) {\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1b6b09e399773c4bac56afead60e4d29e7fbb010",
      "in_reply_to_id": 984412126,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agree, I ended up following the suggestion of adding a new log category `scan` now.",
      "created_at": "2022-10-04T16:46:11Z",
      "updated_at": "2022-10-04T16:46:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r987118075",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987118075"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1853,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003378783",
      "pull_request_review_id": 1153235780,
      "id": 1003378783,
      "node_id": "PRRC_kwDOABII5847zlhf",
      "diff_hunk": "@@ -536,6 +538,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool hasBlockFilterIndex(BlockFilterType filter_type) override\n+    {\n+        return GetBlockFilterIndex(filter_type) != nullptr;\n+    }\n+    std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index{GetBlockFilterIndex(filter_type)};\n+        if (!block_filter_index) return std::nullopt;\n+\n+        BlockFilter filter;\n+        const CBlockIndex* index{WITH_LOCK(::cs_main, return chainman().m_blockman.LookupBlockIndex(block_hash))};\n+        if (!block_filter_index->LookupFilter(index, filter)) return std::nullopt;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0141e0ab4895e06a02f826d443598c20b25c2dd3",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As `LookupBlockIndex` can return a nullptr, better if we check it. (Currently, it cannot fail due our single use case but it might fail in the future)",
      "created_at": "2022-10-24T14:23:18Z",
      "updated_at": "2022-10-24T14:58:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003378783",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003378783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 551,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 552,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003416408",
      "pull_request_review_id": 1153235780,
      "id": 1003416408,
      "node_id": "PRRC_kwDOABII5847zutY",
      "diff_hunk": "@@ -260,6 +261,69 @@ std::shared_ptr<CWallet> LoadWalletInternal(WalletContext& context, const std::s\n         return nullptr;\n     }\n }\n+\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)",
      "path": "src/wallet/wallet.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "456097763d4bdf7ba35de2b3eb33d2160c8024c1",
      "in_reply_to_id": 984347822,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> A larger refactor might add MaybeMatch() to the SPKM interface, which would return true for legacy and would use the filter for descriptors. But this would mean having N separate filters. Not sure how that impacts the overall false-positive rate.\r\n\r\nI actually have this coded in a separated branch for an on-going project that have (will push the milestone PR soon..).\r\nBut essentially, Each spkm have their own elements set, and the update is signal-based instead of have to poll at every block.\r\n\r\nI think that, as we will get another use case for it, it might be better to add it in follow-up PR.",
      "created_at": "2022-10-24T14:54:12Z",
      "updated_at": "2022-10-24T14:58:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003416408",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003416408"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003626740",
      "pull_request_review_id": 1153591652,
      "id": 1003626740,
      "node_id": "PRRC_kwDOABII58470iD0",
      "diff_hunk": "@@ -1814,7 +1814,11 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     uint256 block_hash = start_block;\n     ScanResult result;\n \n-    WalletLogPrintf(\"Rescan started from block %s...\\n\", start_block.ToString());\n+    std::unique_ptr<FastWalletRescanFilter> fast_rescan_filter;\n+    if (!IsLegacy() && chain().hasBlockFilterIndex(BlockFilterType::BASIC)) fast_rescan_filter.reset(new FastWalletRescanFilter(*this));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "73964bc1590f0ba1113ecda7895744bd5f870ee5",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 73964bc1590f0ba1113ecda7895744bd5f870ee5 \"wallet: take use of `FastWalletRescanFilter`\"\r\n\r\nnit: I think we prefer to use `make_unique`\r\n\r\n```suggestion\r\n    if (!IsLegacy() && chain().hasBlockFilterIndex(BlockFilterType::BASIC)) fast_rescan_filter = std::make_unique<FastWalletRescanFilter>(*this);\r\n```",
      "created_at": "2022-10-24T18:29:59Z",
      "updated_at": "2022-10-24T18:51:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003626740",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003626740"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003628912",
      "pull_request_review_id": 1153591652,
      "id": 1003628912,
      "node_id": "PRRC_kwDOABII58470ilw",
      "diff_hunk": "@@ -1841,9 +1845,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "73964bc1590f0ba1113ecda7895744bd5f870ee5",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 73964bc1590f0ba1113ecda7895744bd5f870ee5 \"wallet: take use of `FastWalletRescanFilter`\"\r\n\r\nnit: Since only `skip_block`'s negation is checked, this could perhaps be clearer as `bool fetch_block{true}`, so that we are checking whether a block should be fetched and scanned, rather than whether a block should not be skipped.",
      "created_at": "2022-10-24T18:32:39Z",
      "updated_at": "2022-10-24T18:51:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003628912",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003628912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1848,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003629894",
      "pull_request_review_id": 1153591652,
      "id": 1003629894,
      "node_id": "PRRC_kwDOABII58470i1G",
      "diff_hunk": "@@ -1841,9 +1845,20 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n             WalletLogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", block_height, progress_current);\n         }\n \n+        bool skip_block{false};\n+        if (fast_rescan_filter) {\n+            fast_rescan_filter->UpdateIfNeeded();\n+            auto matches_block{fast_rescan_filter->MatchesBlock(block_hash)};\n+            if (matches_block.has_value() && !*matches_block) {\n+                result.last_scanned_block = block_hash;\n+                result.last_scanned_height = block_height;\n+                skip_block = true;\n+            }\n+        }\n+\n         // Read block data\n         CBlock block;\n-        chain().findBlock(block_hash, FoundBlock().data(block));\n+        if (!skip_block) chain().findBlock(block_hash, FoundBlock().data(block));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "73964bc1590f0ba1113ecda7895744bd5f870ee5",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 73964bc1590f0ba1113ecda7895744bd5f870ee5 \"wallet: take use of `FastWalletRescanFilter`\"\r\n\r\nThis could be inside of the `if (!skip_block)` below, and thus avoid having to construct a `CBlock` when we aren't going to use it.",
      "created_at": "2022-10-24T18:33:54Z",
      "updated_at": "2022-10-24T18:51:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003629894",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003629894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1861,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003633631",
      "pull_request_review_id": 1153591652,
      "id": 1003633631,
      "node_id": "PRRC_kwDOABII58470jvf",
      "diff_hunk": "@@ -1589,7 +1589,8 @@ RPCHelpMan importdescriptors()\n     return RPCHelpMan{\"importdescriptors\",\n                 \"\\nImport descriptors. This will trigger a rescan of the blockchain based on the earliest timestamp of all descriptors being imported. Requires a new wallet backup.\\n\"\n             \"\\nNote: This call can take over an hour to complete if using an early timestamp; during that time, other rpc calls\\n\"\n-            \"may report that the imported keys, addresses or scripts exist but related transactions are still missing.\\n\",\n+            \"may report that the imported keys, addresses or scripts exist but related transactions are still missing.\\n\"\n+            \"The rescan is significantly faster if block filters are available (bitcoind option \\\"-blockfilterindex=1\\\").\\n\",",
      "path": "src/wallet/rpc/backup.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1f0198a3fe58d42dce9e8ddaa09dc2ba8171930e",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 1f0198a3fe58d42dce9e8ddaa09dc2ba8171930e \"rpc: doc: mention rescan speedup using `blockfilterindex=1` in affected wallet RPCs\"\r\n\r\nI think we generally try to avoid using our binary names directly in help text like this.\r\n\r\n```suggestion\r\n            \"The rescan is significantly faster if block filters are available (Using startup option \\\"-blockfilterindex=1\\\").\\n\",\r\n```",
      "created_at": "2022-10-24T18:38:25Z",
      "updated_at": "2022-10-24T18:51:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003633631",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003633631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1593,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003635619",
      "pull_request_review_id": 1153591652,
      "id": 1003635619,
      "node_id": "PRRC_kwDOABII58470kOj",
      "diff_hunk": "@@ -839,7 +839,9 @@ RPCHelpMan rescanblockchain()\n {\n     return RPCHelpMan{\"rescanblockchain\",\n                 \"\\nRescan the local blockchain for wallet related transactions.\\n\"\n-                \"Note: Use \\\"getwalletinfo\\\" to query the scanning progress.\\n\",\n+                \"Note: Use \\\"getwalletinfo\\\" to query the scanning progress.\\n\"\n+                \"The rescan is significantly faster if a descriptor wallet is loaded\\n\"",
      "path": "src/wallet/rpc/transactions.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "1f0198a3fe58d42dce9e8ddaa09dc2ba8171930e",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 1f0198a3fe58d42dce9e8ddaa09dc2ba8171930e \"rpc: doc: mention rescan speedup using `blockfilterindex=1` in affected wallet RPCs\"\r\n\r\nSince `rescanblockchain` operates per-wallet, this should that it is faster when used on a descriptor wallet, as saying \"if a descriptor wallet is loaded\" incorrectly suggests that it may be faster for a legacy wallet if a descriptor wallet was also loaded at the same time.\r\n\r\n```suggestion\r\n                \"The rescan is significantly faster when used on a descriptor wallet\\n\"\r\n```",
      "created_at": "2022-10-24T18:40:52Z",
      "updated_at": "2022-10-24T18:51:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1003635619",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003635619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004313896",
      "pull_request_review_id": 1154579367,
      "id": 1004313896,
      "node_id": "PRRC_kwDOABII58473J0o",
      "diff_hunk": "@@ -2644,17 +2644,27 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79",
      "in_reply_to_id": null,
      "user": {
        "login": "aureleoules",
        "id": 22493292,
        "node_id": "MDQ6VXNlcjIyNDkzMjky",
        "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aureleoules",
        "html_url": "https://github.com/aureleoules",
        "followers_url": "https://api.github.com/users/aureleoules/followers",
        "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
        "organizations_url": "https://api.github.com/users/aureleoules/orgs",
        "repos_url": "https://api.github.com/users/aureleoules/repos",
        "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/aureleoules/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Thanks, done with a preparatory extra refactoring commit which changes the ScriptPubKeyMan::GetScriptPubKeys() interface (which imposes this on us).\r\n\r\n`const` is still there",
      "created_at": "2022-10-25T10:42:07Z",
      "updated_at": "2022-10-25T10:44:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1004313896",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004313896"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2651,
      "original_line": 2651,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566006",
      "pull_request_review_id": 1154927383,
      "id": 1004566006,
      "node_id": "PRRC_kwDOABII58474HX2",
      "diff_hunk": "@@ -536,6 +538,20 @@ class ChainImpl : public Chain\n         }\n         return std::nullopt;\n     }\n+    bool hasBlockFilterIndex(BlockFilterType filter_type) override\n+    {\n+        return GetBlockFilterIndex(filter_type) != nullptr;\n+    }\n+    std::optional<bool> blockFilterMatchesAny(BlockFilterType filter_type, const uint256& block_hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index{GetBlockFilterIndex(filter_type)};\n+        if (!block_filter_index) return std::nullopt;\n+\n+        BlockFilter filter;\n+        const CBlockIndex* index{WITH_LOCK(::cs_main, return chainman().m_blockman.LookupBlockIndex(block_hash))};\n+        if (!block_filter_index->LookupFilter(index, filter)) return std::nullopt;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 28,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "0141e0ab4895e06a02f826d443598c20b25c2dd3",
      "in_reply_to_id": 1003378783,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good find, thanks, done. Now `index == nullptr` is another criteria for returning std::nullopt.",
      "created_at": "2022-10-25T14:29:05Z",
      "updated_at": "2022-10-25T14:29:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1004566006",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566006"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": 551,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 552,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566261",
      "pull_request_review_id": 1154927755,
      "id": 1004566261,
      "node_id": "PRRC_kwDOABII58474Hb1",
      "diff_hunk": "@@ -1814,7 +1814,11 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n     uint256 block_hash = start_block;\n     ScanResult result;\n \n-    WalletLogPrintf(\"Rescan started from block %s...\\n\", start_block.ToString());\n+    std::unique_ptr<FastWalletRescanFilter> fast_rescan_filter;\n+    if (!IsLegacy() && chain().hasBlockFilterIndex(BlockFilterType::BASIC)) fast_rescan_filter.reset(new FastWalletRescanFilter(*this));",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "73964bc1590f0ba1113ecda7895744bd5f870ee5",
      "in_reply_to_id": 1003626740,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, done.",
      "created_at": "2022-10-25T14:29:16Z",
      "updated_at": "2022-10-25T14:29:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1004566261",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004566261"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004572531",
      "pull_request_review_id": 1154937000,
      "id": 1004572531,
      "node_id": "PRRC_kwDOABII58474I9z",
      "diff_hunk": "@@ -2644,17 +2644,27 @@ const WalletDescriptor DescriptorScriptPubKeyMan::GetWalletDescriptor() const\n }\n \n const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    return GetScriptPubKeys(0);\n+}\n+\n+const std::unordered_set<CScript, SaltedSipHasher> DescriptorScriptPubKeyMan::GetScriptPubKeys(int32_t minimum_index) const",
      "path": "src/wallet/scriptpubkeyman.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "0582932260e7de4e8aba01d63e7c8a9ddb9c3685",
      "original_commit_id": "6fc1f5f92b4fed2ec0c92ba34ef83ab710876d79",
      "in_reply_to_id": 1004313896,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> > Thanks, done with a preparatory extra refactoring commit which changes the ScriptPubKeyMan::GetScriptPubKeys() interface (which imposes this on us).\r\n> \r\n> `const` is still there\r\n\r\nSee https://github.com/bitcoin/bitcoin/pull/25957#issuecomment-1277486053:\r\n> removed the commit that got rid of the const qualifier from GetScriptPubKeys, since it was seen as controversial and is not really related to this PR (can be done as a follow-up).",
      "created_at": "2022-10-25T14:34:07Z",
      "updated_at": "2022-10-25T14:34:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25957#discussion_r1004572531",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1004572531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25957"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2651,
      "original_line": 2651,
      "side": "RIGHT"
    }
  ]
}
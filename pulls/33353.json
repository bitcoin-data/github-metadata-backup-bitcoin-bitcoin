{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353",
    "id": 2812998776,
    "node_id": "PR_kwDOABII586nqvR4",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33353",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33353.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33353.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33353",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33353/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d7de5b109f69293b375729363b4e5038f3fb6b15",
    "number": 33353,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "log: show reindex progress in `ImportBlocks`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "### Summary\r\n\r\nWhen triggering a reindex, users have no indication of progress.\r\n\r\n### Fix\r\n\r\nThis patch precomputes the total number of block files so progress can be shown.\r\nInstead of only displaying which block file is being processed, it now shows the percent complete.\r\n\r\n### Reproducer + expected results\r\n\r\n```bash\r\ncmake -B build -DCMAKE_BUILD_TYPE=Release && make -C build -j && ./build/bin/bitcoind -datadir=demo -reindex\r\n```\r\n\r\nBefore, the block files were shown one-by-one, there's no way to see how much work is left:\r\n```\r\nReindexing block file blk00000.dat...\r\nLoaded 119920 blocks from external file in 1228ms\r\nReindexing block file blk00001.dat...\r\nLoaded 10671 blocks from external file in 284ms\r\nReindexing block file blk00002.dat...\r\nLoaded 5459 blocks from external file in 263ms\r\nReindexing block file blk00003.dat...\r\nLoaded 5595 blocks from external file in 267ms\r\n```\r\n\r\nAfter the change we add a percentage:\r\n```\r\nReindexing block file blk00000.dat (0% complete)...\r\nLoaded 119920 blocks from external file in 1255ms\r\nReindexing block file blk00001.dat (1% complete)...\r\nLoaded 10671 blocks from external file in 303ms\r\nReindexing block file blk00002.dat (2% complete)...\r\nLoaded 5459 blocks from external file in 278ms\r\nReindexing block file blk00003.dat (3% complete)...\r\nLoaded 5595 blocks from external file in 285ms\r\n```",
    "labels": [
      {
        "id": 241832923,
        "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
        "name": "Utils/log/libs",
        "description": "",
        "color": "5319e7",
        "default": false
      }
    ],
    "created_at": "2025-09-09T19:08:37Z",
    "updated_at": "2025-10-15T14:39:17Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "648eac2b2ccc2432fecd20409646e8535df71c9f",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/show-reindex-progress",
      "ref": "l0rinc/show-reindex-progress",
      "sha": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 274273,
        "default_branch": "master",
        "open_issues_count": 12,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-15T14:36:55Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-10-14T18:31:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2c8a478db4b84e03cc376e52f463b828ab9366f6",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38032,
        "stargazers_count": 86185,
        "watchers_count": 86185,
        "size": 294954,
        "default_branch": "master",
        "open_issues_count": 824,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-15T14:01:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-15T14:26:37Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 8,
    "deletions": 7,
    "changed_files": 1,
    "commits": 1,
    "review_comments": 8,
    "comments": 2
  },
  "events": [
    {
      "event": "commented",
      "id": 3271954887,
      "node_id": "IC_kwDOABII587DBhHH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3271954887",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-09T19:08:42Z",
      "updated_at": "2025-10-15T14:39:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33353.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [Raimo33](https://github.com/bitcoin/bitcoin/pull/33353#issuecomment-3288490603), [enirox001](https://github.com/bitcoin/bitcoin/pull/33353#pullrequestreview-3231320525) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#issuecomment-3271954887",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33353"
    },
    {
      "event": "renamed",
      "id": 19596892461,
      "node_id": "RTE_lADOABII587KohAgzwAAAASQENkt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19596892461",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-09T19:08:44Z",
      "rename": {
        "from": "logs: show reindex progress in `ImportBlocks`",
        "to": "log: show reindex progress in `ImportBlocks`"
      }
    },
    {
      "event": "labeled",
      "id": 19596895378,
      "node_id": "LE_lADOABII587KohAgzwAAAASQEOSS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19596895378",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-09T19:08:55Z",
      "label": {
        "name": "Utils/log/libs",
        "color": "5319e7"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ3ZGU1YjEwOWY2OTI5M2IzNzU3MjkzNjNiNGU1MDM4ZjNmYjZiMTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d7de5b109f69293b375729363b4e5038f3fb6b15",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d7de5b109f69293b375729363b4e5038f3fb6b15",
      "tree": {
        "sha": "1b2ab2343203863b970b2d843172b6c63bccdf82",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1b2ab2343203863b970b2d843172b6c63bccdf82"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c8a478db4b84e03cc376e52f463b828ab9366f6",
          "sha": "2c8a478db4b84e03cc376e52f463b828ab9366f6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c8a478db4b84e03cc376e52f463b828ab9366f6"
        }
      ],
      "message": "logs: show reindex progress in `ImportBlocks`\n\n### Summary\n\nWhen triggering a reindex, users had no indication of how many files remained or how far along the process was.\n\n### Fix\n\nThis patch prefetches the target file block file count to be able to show progress information.\nInstead of just displaying which block file is being processed, it now indicates how many files remain.\n\n### Reproducer + expected results\n\nRunning\n```bash\ncmake -B build && make -C build -DCMAKE_BUILD_TYPE=Release && ./build/bin/bitcoind -datadir=demo -reindex\n```\nShows the block files one-by-one currently, there's no way to see how much work is left:\n```\nReindexing block file blk00000.dat...\nLoaded 119920 blocks from external file in 1228ms\nReindexing block file blk00001.dat...\nLoaded 10671 blocks from external file in 284ms\nReindexing block file blk00002.dat...\nLoaded 5459 blocks from external file in 263ms\nReindexing block file blk00003.dat...\nLoaded 5595 blocks from external file in 267ms\n```\n\nAfter the change:\n```\nReindexing block file blk00000.dat (0% complete)...\nLoaded 119920 blocks from external file in 1255ms\nReindexing block file blk00001.dat (1% complete)...\nLoaded 10671 blocks from external file in 303ms\nReindexing block file blk00002.dat (2% complete)...\nLoaded 5459 blocks from external file in 278ms\nReindexing block file blk00003.dat (3% complete)...\nLoaded 5595 blocks from external file in 285ms\n```",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-09-09T22:31:55Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-06-10T14:14:22Z"
      },
      "sha": "d7de5b109f69293b375729363b4e5038f3fb6b15"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19600080458,
      "node_id": "HRFPE_lADOABII587KohAgzwAAAASQQX5K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19600080458",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/d7de5b109f69293b375729363b4e5038f3fb6b15",
      "created_at": "2025-09-09T22:33:47Z"
    },
    {
      "event": "reviewed",
      "id": 3220953199,
      "node_id": "PRR_kwDOABII586_-9hv",
      "url": null,
      "actor": null,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-13T14:51:11Z",
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#pullrequestreview-3220953199",
      "submitted_at": "2025-09-13T14:51:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
    },
    {
      "event": "commented",
      "id": 3288490603,
      "node_id": "IC_kwDOABII587EAmJr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3288490603",
      "actor": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-13T14:52:33Z",
      "updated_at": "2025-09-13T14:52:33Z",
      "author_association": "NONE",
      "body": "Concept ACK",
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#issuecomment-3288490603",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33353"
    },
    {
      "event": "reviewed",
      "id": 3231320525,
      "node_id": "PRR_kwDOABII587AmgnN",
      "url": null,
      "actor": null,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-16T19:18:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK d7de5b1\r\n\r\nI tested this locally, the percentage logging provides a clear indication of progress during reindex and is useful visibility while the node processes block files.\r\n\r\nI have left a few non-blocking nits for consideration.",
      "user": {
        "login": "enirox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/enirox001",
        "html_url": "https://github.com/enirox001",
        "followers_url": "https://api.github.com/users/enirox001/followers",
        "following_url": "https://api.github.com/users/enirox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/enirox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/enirox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/enirox001/subscriptions",
        "organizations_url": "https://api.github.com/users/enirox001/orgs",
        "repos_url": "https://api.github.com/users/enirox001/repos",
        "events_url": "https://api.github.com/users/enirox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/enirox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#pullrequestreview-3231320525",
      "submitted_at": "2025-09-16T19:18:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
    },
    {
      "event": "reviewed",
      "id": 3237781768,
      "node_id": "PRR_kwDOABII587A_KEI",
      "url": null,
      "actor": null,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-09-18T07:26:11Z",
      "author_association": "MEMBER",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#pullrequestreview-3237781768",
      "submitted_at": "2025-09-18T07:26:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2346773084",
      "pull_request_review_id": 3220953199,
      "id": 2346773084,
      "node_id": "PRRC_kwDOABII586L4Opc",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": null,
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "precompute the division?",
      "created_at": "2025-09-13T14:50:39Z",
      "updated_at": "2025-09-13T14:51:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2346773084",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2346773084"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353403899",
      "pull_request_review_id": 3231320525,
      "id": 2353403899,
      "node_id": "PRRC_kwDOABII586MRhf7",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": null,
      "user": {
        "login": "enirox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/enirox001",
        "html_url": "https://github.com/enirox001",
        "followers_url": "https://api.github.com/users/enirox001/followers",
        "following_url": "https://api.github.com/users/enirox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/enirox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/enirox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/enirox001/subscriptions",
        "organizations_url": "https://api.github.com/users/enirox001/orgs",
        "repos_url": "https://api.github.com/users/enirox001/repos",
        "events_url": "https://api.github.com/users/enirox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/enirox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Consider computing the progress as `(nFile + 1) * 100 / total_files` so the indicator advances past 0% on the first file. Is there a reason we intentionally show 0% initially?",
      "created_at": "2025-09-16T19:08:33Z",
      "updated_at": "2025-09-16T19:18:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2353403899",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353403899"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353404361",
      "pull_request_review_id": 3231320525,
      "id": 2353404361,
      "node_id": "PRRC_kwDOABII586MRhnJ",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": 2353403899,
      "user": {
        "login": "enirox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/enirox001",
        "html_url": "https://github.com/enirox001",
        "followers_url": "https://api.github.com/users/enirox001/followers",
        "following_url": "https://api.github.com/users/enirox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/enirox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/enirox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/enirox001/subscriptions",
        "organizations_url": "https://api.github.com/users/enirox001/orgs",
        "repos_url": "https://api.github.com/users/enirox001/repos",
        "events_url": "https://api.github.com/users/enirox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/enirox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Use a defensive guard when computing percent, e.g. `total_files ? (100 * (nFile + 1) / total_files) : 0`, to avoid accidental divide-by-zero after future refactors.",
      "created_at": "2025-09-16T19:08:51Z",
      "updated_at": "2025-09-16T19:18:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2353404361",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353404361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353411309",
      "pull_request_review_id": 3231320525,
      "id": 2353411309,
      "node_id": "PRRC_kwDOABII586MRjTt",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": 2353403899,
      "user": {
        "login": "enirox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/enirox001",
        "html_url": "https://github.com/enirox001",
        "followers_url": "https://api.github.com/users/enirox001/followers",
        "following_url": "https://api.github.com/users/enirox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/enirox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/enirox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/enirox001/subscriptions",
        "organizations_url": "https://api.github.com/users/enirox001/orgs",
        "repos_url": "https://api.github.com/users/enirox001/repos",
        "events_url": "https://api.github.com/users/enirox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/enirox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Would it make sense to log `nFile+1/total_files` (e.g. `4/125`) alongside the percent? That gives clearer, more granular progress than an integer percent alone.",
      "created_at": "2025-09-16T19:12:26Z",
      "updated_at": "2025-09-16T19:18:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2353411309",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353411309"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353681440",
      "pull_request_review_id": 3231740565,
      "id": 2353681440,
      "node_id": "PRRC_kwDOABII586MSlQg",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": 2353403899,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks @enirox001, I think the 0% is fine and we've just calculated `total_files`, no need to guard and the percentage is the same as the `nFile+1/total_files`, I don't see the need to duplicate it.",
      "created_at": "2025-09-16T21:18:06Z",
      "updated_at": "2025-09-16T21:18:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2353681440",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2353681440"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2357830141",
      "pull_request_review_id": 3237781768,
      "id": 2357830141,
      "node_id": "PRRC_kwDOABII586MiaH9",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Files are not necessarily the same size/complexity...",
      "created_at": "2025-09-18T07:26:11Z",
      "updated_at": "2025-09-18T07:26:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2357830141",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2357830141"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2360199070",
      "pull_request_review_id": 3240855440,
      "id": 2360199070,
      "node_id": "PRRC_kwDOABII586Mrcee",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": 2357830141,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It's just an approximation - or do you think `Reindexing block file blk%05u.dat (5/123)...` would be clearer? We have progress in blocks as well, they're all just approximations...",
      "created_at": "2025-09-18T16:32:41Z",
      "updated_at": "2025-09-18T16:32:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2360199070",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2360199070"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2360208827",
      "pull_request_review_id": 3240867411,
      "id": 2360208827,
      "node_id": "PRRC_kwDOABII586Mre27",
      "diff_hunk": "@@ -1220,26 +1220,27 @@ void ImportBlocks(ChainstateManager& chainman, std::span<const fs::path> import_\n \n     // -reindex\n     if (!chainman.m_blockman.m_blockfiles_indexed) {\n-        int nFile = 0;\n+        int total_files{0};\n+        while (fs::exists(chainman.m_blockman.GetBlockPosFilename(FlatFilePos(total_files, 0)))) {\n+            total_files++;\n+        }\n+\n         // Map of disk positions for blocks with unknown parent (only used for reindex);\n         // parent hash -> child disk position, multiple children can have the same parent.\n         std::multimap<uint256, FlatFilePos> blocks_with_unknown_parent;\n-        while (true) {\n+\n+        for (int nFile{0}; nFile < total_files; ++nFile) {\n             FlatFilePos pos(nFile, 0);\n-            if (!fs::exists(chainman.m_blockman.GetBlockPosFilename(pos))) {\n-                break; // No block files left to reindex\n-            }\n             AutoFile file{chainman.m_blockman.OpenBlockFile(pos, /*fReadOnly=*/true)};\n             if (file.IsNull()) {\n                 break; // This error is logged in OpenBlockFile\n             }\n-            LogInfo(\"Reindexing block file blk%05u.dat...\", (unsigned int)nFile);\n+            LogInfo(\"Reindexing block file blk%05u.dat (%d%% complete)...\", (unsigned int)nFile, nFile * 100 / total_files);",
      "path": "src/node/blockstorage.cpp",
      "position": 25,
      "original_position": 25,
      "commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "original_commit_id": "d7de5b109f69293b375729363b4e5038f3fb6b15",
      "in_reply_to_id": 2357830141,
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "i think percentage is fine. it just means % of blocks instead of % of time",
      "created_at": "2025-09-18T16:34:39Z",
      "updated_at": "2025-09-18T16:34:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33353#discussion_r2360208827",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2360208827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33353"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1238,
      "original_line": 1238,
      "side": "RIGHT"
    }
  ]
}
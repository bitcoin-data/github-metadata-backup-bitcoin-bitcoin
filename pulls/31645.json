{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645",
    "id": 2272673972,
    "node_id": "PR_kwDOABII586HdkC0",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31645",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31645.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31645.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
    "number": 31645,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "[IBD] coins: increase default UTXO flush batch size to 32 MiB",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This change is part of [[IBD] - Tracking PR for speeding up Initial Block Download](https://github.com/bitcoin/bitcoin/pull/32043)\r\n\r\n### Summary\r\n\r\nWhen the in-memory UTXO set is flushed to LevelDB (after IBD or AssumeUTXO load), it does so in batches to manage memory usage during the flush.\r\nA hidden -dbbatchsize config option exists to modify this value. This PR only changes the default from 16 MiB to 32 MiB.\r\nUsing a larger default reduces the overhead of many small writes and improves I/O efficiency (especially on HDDs). It may also help LevelDB optimize writes more effectively (e.g., via internal ordering).\r\n\r\n### Context\r\n\r\nThe UTXO set has grown significantly since [2017](https://github.com/bitcoin/bitcoin/pull/10148/files#diff-d102b6032635ce90158c1e6e614f03b50e4449aa46ce23370da5387a658342fdR26-R27), when the original fixed 16 MiB batch size was chosen.\r\n\r\nWith the current multi-gigabyte UTXO set and the common practice of using larger `-dbcache` values, the fixed 16 MiB batch size leads to several inefficiencies:\r\n\r\n* Flushing the entire UTXO set often requires thousands of separate 16 MiB write operations.\r\n* Particularly on HDDs, the cumulative disk seek time and per-operation overhead from numerous small writes significantly slow down the flushing process.\r\n* Each `WriteBatch` call incurs internal LevelDB overhead (e.g., MemTable handling, compaction triggering logic). More frequent, smaller batches amplify this cumulative overhead.\r\n\r\nFlush times of 20-30 minutes are not uncommon, even on capable hardware.\r\n\r\n### Considerations\r\n\r\nAs [noted by sipa](https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587500105), flushing involves a temporary memory usage increase as the batch is prepared. A larger batch size naturally leads to a larger peak during this phase. Crashing due to OOM during a flush is highly undesirable, but now that [#30611](https://github.com/bitcoin/bitcoin/pull/30611) is merged, the most we'd lose is the first hour of IBD.\r\n\r\n\r\nIncreasing the LevelDB write batch size from 16 to 32 MiB raised the measured peaks by ~70 MiB in my tests during UTXO dump. The option remains hidden, and users can always override it. \r\n \r\nThe increased peak memory usage (detailed below) is primarily attributed to LevelDB's `leveldb::Arena` (backing MemTables) and the temporary storage of serialized batch data (e.g., `std::string` in `CDBBatch::WriteImpl`).\r\n\r\nPerformance gains are most pronounced on systems with slower I/O (HDDs), but some SSDs also show measurable improvements.\r\n\r\n### Measurements:\r\n\r\nAssumeUTXO proxy, multiple runs with error bars (flushing time is faster that the measured loading + flushing):\r\n* Raspberry Pi, dbcache=500: ~30% faster with 32 MiB vs 16 MiB, peak +~75 MiB and still < 1 GiB.\r\n* i7 + HDD: results vary by dbcache, but 32 MiB usually beats 16 MiB and tracks close to 64 MiB without the larger peak.\r\n* i9 + fast NVMe: roughly flat across 16/32/64 MiB. The goal here is to avoid regressions, which holds.\r\n\r\n### Reproducer:\r\n\r\n```bash\r\n# Set up a clean demo environment\r\nmkdir -p demo && rm -rfd demo\r\n\r\n# Build Bitcoin Core\r\ncmake -B build -DCMAKE_BUILD_TYPE=Release && cmake --build build -j$(nproc)\r\n\r\n# Start bitcoind with minimal settings without mempool and internet connection\r\nbuild/bin/bitcoind -datadir=demo -stopatheight=1\r\nbuild/bin/bitcoind -datadir=demo -blocksonly=1 -connect=0 -dbcache=30000 -daemon\r\n\r\n# Load the AssumeUTXO snapshot, making sure the path is correct\r\n# Expected output includes `\"coins_loaded\": 184821030`\r\nbuild/bin/bitcoin-cli -datadir=demo -rpcclienttimeout=0 loadtxoutset ~/utxo-880000.dat\r\n\r\n# Stop the daemon and verify snapshot flushes in the logs\r\nbuild/bin/bitcoin-cli -datadir=demo stop\r\ngrep \"FlushSnapshotToDisk: completed\" demo/debug.log\r\n```\r\n\r\n---\r\n\r\nThis PR originally proposed 64 MiB, then a dynamic size, but both were dropped: 64 MiB increased peaks more than desired on low-RAM systems, and the dynamic variant underperformed across mixed hardware. 32 MiB is a simpler default that captures most of the gains with a modest peak increase.\r\n\r\nFor more details see: https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-3234329502\r\n---\r\n\r\nWhile the PR isn't about IBD in general, rather about a critical section of it, I have measured a reindex-chainstate until 900k blocks, showing a 1% overall speedup:\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```python\r\nCOMMITS=\"e6bfd95d5012fa1d91f83bf4122cb292afd6277f af653f321b135a59e38794b537737ed2f4a0040b\"; \\\r\nSTOP=900000; DBCACHE=10000; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\\r\n  --sort command \\\r\n  --runs 1 \\\r\n  --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$STOP-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind 2>/dev/null; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard && \\\r\n    cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release && ninja -C build bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=1000 -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=$DBCACHE -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0\"\r\n\r\ne6bfd95d50 Merge bitcoin-core/gui#881: Move `FreespaceChecker` class into its own module\r\naf653f321b coins: derive `batch_write_bytes` from `-dbcache` when unspecified\r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=900000 -dbcache=10000 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = e6bfd95d5012fa1d91f83bf4122cb292afd6277f)\r\n  Time (abs â‰¡):        25016.346 s               [User: 30333.911 s, System: 826.463 s]\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=900000 -dbcache=10000 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = af653f321b135a59e38794b537737ed2f4a0040b)\r\n  Time (abs â‰¡):        24801.283 s               [User: 30328.665 s, System: 834.110 s]\r\n \r\nRelative speed comparison\r\n        1.01          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=900000 -dbcache=10000 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = e6bfd95d5012fa1d91f83bf4122cb292afd6277f)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=900000 -dbcache=10000 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = af653f321b135a59e38794b537737ed2f4a0040b)\r\n```\r\n\r\n</details>",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-01-12T20:08:03Z",
    "updated_at": "2025-08-29T18:53:02Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "8ae00d7a6fe4f64976098a5b599f200e6e0e4651",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/utxo-dump-batching",
      "ref": "l0rinc/utxo-dump-batching",
      "sha": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 271731,
        "default_branch": "master",
        "open_issues_count": 7,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-08-29T09:27:42Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-08-26T05:20:54Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "6ca6f3b37b992591726bd13b494369bee3bd6468",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37687,
        "stargazers_count": 85245,
        "watchers_count": 85245,
        "size": 291764,
        "default_branch": "master",
        "open_issues_count": 759,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-08-28T23:10:55Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-08-29T18:03:40Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 8,
    "deletions": 8,
    "changed_files": 3,
    "commits": 2,
    "review_comments": 49,
    "comments": 27
  },
  "events": [
    {
      "event": "commented",
      "id": 2585900399,
      "node_id": "IC_kwDOABII586aIbVv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2585900399",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-12T20:11:26Z",
      "updated_at": "2025-03-15T12:03:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "Visual representation of the AssumeUTXO 840k measurements (16MiB was the previous default, 64MiB is the proposed one):\r\n\r\n<img width=\"780\" alt=\"image\" src=\"https://github.com/user-attachments/assets/93ab3fff-385b-4093-8016-ab2a251cf92a\" />\r\n\r\n<details>\r\n<summary>Bash script to run assumeUTXO with differenty values</summary>\r\n\r\n```bash\r\nset -e\r\n\r\nkillall bitcoind 2>/dev/null || true\r\ncd /mnt/my_storage/bitcoin\r\nmkdir -p demo\r\n\r\nfor i in 1 2; do\r\n  for dbcache in 440 5000 30000; do\r\n    for dbbatchsize in 4194304 8388608 16777216 33554432 67108864 134217728 268435456; do\r\n      cmake -B build -DCMAKE_BUILD_TYPE=Release > /dev/null 2>&1\r\n      cmake --build build -j\"$(nproc)\" > /dev/null 2>&1\r\n\r\n      build/bin/bitcoin-cli -datadir=demo stop 2>/dev/null || true\r\n      killall bitcoind 2>/dev/null || true\r\n      sleep 10\r\n\r\n      rm -rfd demo/chainstate demo/chainstate_snapshot\r\n      build/bin/bitcoind -datadir=demo -stopatheight=1 -printtoconsole=0 && rm -f demo/debug.log\r\n\r\n      echo \"Starting bitcoind with dbcache=$dbcache\"\r\n      build/bin/bitcoind -datadir=demo -blocksonly=1 -connect=0 -dbcache=\"$dbcache\" -dbbatchsize=\"$dbbatchsize\" -daemon -printtoconsole=0\r\n      sleep 10\r\n\r\n      echo \"Loading UTXO snapshot...\"\r\n      build/bin/bitcoin-cli -datadir=demo -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat | grep -q '\"coins_loaded\": 184821030' || { echo \"ERROR: Wrong number of coins loaded\"; exit 1; }\r\n      build/bin/bitcoin-cli -datadir=demo stop\r\n      killall bitcoind 2>/dev/null || true\r\n      sleep 10\r\n\r\n      out_file=\"results_i_${i}_dbcache_${dbcache}_dbbatchsize_${dbbatchsize}.log\"\r\n      echo \"Collecting logs in ${out_file}\"\r\n      grep \"FlushSnapshotToDisk: completed\" demo/debug.log | tee -a \"${out_file}\"\r\n      echo \"---\" >> \"${out_file}\"\r\n\r\n      echo \"Done with i=${i}, dbcache=${dbcache}, dbbatchsize=${dbbatchsize}\"\r\n      echo\r\n    done\r\n  done\r\ndone\r\n\r\necho \"All runs complete. Logs are saved in results_dbcache*.log files.\"\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Python file to sum the flush times</summary>\r\n\r\n```py\r\nimport re\r\nimport sys\r\n\r\n\r\ndef parse_bitcoin_debug_log(file_path):\r\n    results = []\r\n\r\n    flush_sum = 0.0\r\n    flush_count = 0\r\n\r\n    version_pattern = re.compile(r\"Bitcoin Core version\")\r\n    flush_pattern = re.compile(r'FlushSnapshotToDisk: completed \\(([\\d.]+)ms\\)')\r\n\r\n    def finalize_current_block():\r\n        nonlocal flush_sum, flush_count\r\n        if flush_count > 0:\r\n            results.append((flush_sum, flush_count))\r\n        flush_sum = 0.0\r\n        flush_count = 0\r\n\r\n    try:\r\n        with open(file_path, 'r') as file:\r\n            for line in file:\r\n                if version_pattern.search(line):\r\n                    finalize_current_block()\r\n                    continue\r\n\r\n                match_flush = flush_pattern.search(line)\r\n                if match_flush:\r\n                    flush_ms = float(match_flush.group(1))\r\n                    flush_sum += flush_ms\r\n                    flush_count += 1\r\n    except Exception as e:\r\n        print(f\"Error reading file: {e}\")\r\n        sys.exit(1)\r\n\r\n    finalize_current_block()\r\n\r\n    return results\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    if len(sys.argv) < 2:\r\n        print(\"Usage: python3 script.py <path_to_debug_log>\")\r\n        sys.exit(1)\r\n\r\n    file_path = sys.argv[1]\r\n    parsed_results = parse_bitcoin_debug_log(file_path)\r\n\r\n    for total_flush_time, total_flush_calls in parsed_results:\r\n        print(f\"{total_flush_time:.2f},{total_flush_calls}\")\r\n```\r\n\r\n</details>\r\n\r\n\r\n---\r\n\r\nEdit: \r\nReran the benchmarks on a Hetzner Linux machine with the new AssumeUTXO 880k set, parsing the logged flush times and plotting the results.\r\nFor different `dbcache` (440, 5000, 30000) and `dbbatchsize` (4-256MiB range, 16MiB (current) and 64MiB (proposed) are highlighted and trendline is added for clarity), each one twice for stability:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/bb1a51f0-1c2f-441a-8ed0-3c3eadc45a6f\" />\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/61bcf0f4-0723-4406-8a68-2d7d53e04902\" />\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/aaeb5311-c34e-4b3b-aba1-c30f5a967de5\" />\r\n\r\n---\r\n\r\n\r\nSorting the same measurements (and calculating the sums) might give us a better understanding of the trends:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/ce56cfba-a59f-4360-a6d7-2cc3e74959a3\" />\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/6e612bb6-b3b0-43b7-a542-0f4ec42eefa8\" />\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b151cabd-f7b0-401b-8623-9f29bc3a5a46\" />\r\n\r\n\r\n\r\n\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2585900399",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2585900409,
      "node_id": "IC_kwDOABII586aIbV5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2585900409",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-12T20:11:29Z",
      "updated_at": "2025-08-29T18:53:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31645.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2764965493), [jonatack](https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3099124347), [hodlinator](https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3128539265) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32427](https://github.com/bitcoin/bitcoin/pull/32427) ((RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2585900409",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "labeled",
      "id": 15904783083,
      "node_id": "LE_lADOABII586l3CxmzwAAAAOz_7rr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15904783083",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T13:15:15Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 2587500105,
      "node_id": "IC_kwDOABII586aOh5J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2587500105",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T15:52:27Z",
      "updated_at": "2025-01-13T15:52:27Z",
      "author_association": "MEMBER",
      "body": "FWIW, the reason for the existence of the batch size behavior (as opposed to just writing everything at once) is that it causes a memory usage spike at flush time. If that spike exceeds the memory the process can allocate it causes a crash, at a particularly bad time (may require a replay to fix, which may be slower than just reprocessing the blocks).\r\n\r\nGiven that changing this appears to improve performance it's worth considering of course, but it is essentially a trade-off between speed and memory usage spiking.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587500105",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2587807448,
      "node_id": "IC_kwDOABII586aPs7Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2587807448",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:00:34Z",
      "updated_at": "2025-07-31T19:15:28Z",
      "author_association": "NONE",
      "body": "If there are tradeoffs (speed, memory usage etc.) involved in changing default batch size, then it could remain the same.\r\n\r\nMaybe a config option can be provided to change it.",
      "user": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587807448",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2587815370,
      "node_id": "IC_kwDOABII586aPu3K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2587815370",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:02:58Z",
      "updated_at": "2025-01-13T18:02:58Z",
      "author_association": "MEMBER",
      "body": "There is a config option. This is about changing the dedault.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587815370",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2587860455,
      "node_id": "IC_kwDOABII586aP53n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2587860455",
      "actor": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:12:29Z",
      "updated_at": "2025-07-31T19:15:28Z",
      "author_association": "NONE",
      "body": "> There is a config option. This is about changing the dedault.\r\n\r\nJust realized [`dbbatchsize`](https://github.com/bitcoin/bitcoin/blob/35bf426e02210c1bbb04926f4ca2e0285fbfcd11/src/init.cpp#L489) already exists. ",
      "user": {
        "login": "1440000bytes",
        "id": 147166694,
        "node_id": "U_kgDOCMWV5g",
        "avatar_url": "https://avatars.githubusercontent.com/u/147166694?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/1440000bytes",
        "html_url": "https://github.com/1440000bytes",
        "followers_url": "https://api.github.com/users/1440000bytes/followers",
        "following_url": "https://api.github.com/users/1440000bytes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/1440000bytes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/1440000bytes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/1440000bytes/subscriptions",
        "organizations_url": "https://api.github.com/users/1440000bytes/orgs",
        "repos_url": "https://api.github.com/users/1440000bytes/repos",
        "events_url": "https://api.github.com/users/1440000bytes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/1440000bytes/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587860455",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2587954338,
      "node_id": "IC_kwDOABII586aQQyi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2587954338",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:58:27Z",
      "updated_at": "2025-01-13T18:58:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "> If that spike exceeds the memory the process can allocate it causes a crash\r\n\r\nThanks for the context, @sipa.\r\nOn the positive side, the extra allocation is constant (or at least non-proportional with the usage) and it's narrowing the window for other crashes during flushing (https://github.com/bitcoin/bitcoin/pull/30611 will also likely help here).\r\nThis change may also enable another one (that I'm currently re-measuring to be sure), which seems to halve the remaining flush time again (by sorting the values in descending order before adding them to the batch), e.g. from 30 minutes (on master) to 10 (with this change included).",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2587954338",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "mentioned",
      "id": 15910921721,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAO0XWX5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15910921721",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:58:29Z"
    },
    {
      "event": "subscribed",
      "id": 15910921729,
      "node_id": "SE_lADOABII586l3CxmzwAAAAO0XWYB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15910921729",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-13T18:58:29Z"
    },
    {
      "event": "commented",
      "id": 2591184498,
      "node_id": "IC_kwDOABII586aclZy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2591184498",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-14T21:55:38Z",
      "updated_at": "2025-01-14T21:55:38Z",
      "author_association": "MEMBER",
      "body": "Can we predict the memory usage spike size? Presumably as we flush, that releases memory, which allows for a larger and larger batch size?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2591184498",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2595151977,
      "node_id": "IC_kwDOABII586aruBp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2595151977",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T10:32:15Z",
      "updated_at": "2025-01-16T10:32:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Since profilers may not catch these short-lived spikes, I've instrumented the code, loaded the UTXO set (as described the in the PR), parsed the logged flushing times and memory usages and plotted them against each other to see the effect of the batch size increase.\r\n\r\n<details>\r\n<summary>txdb.cpp flush time and memory instrumentation:</summary>\r\n\r\n```patch\r\ndiff --git a/src/txdb.cpp b/src/txdb.cpp\r\n--- a/src/txdb.cpp\t(revision d249a353be58868d41d2a7c57357038ffd779eba)\r\n+++ b/src/txdb.cpp\t(revision bae884969d35469320ed9967736eb15b5d87edff)\r\n@@ -90,7 +90,81 @@\r\n     return vhashHeadBlocks;\r\n }\r\n\r\n+/*\r\n+ * Author:  David Robert Nadeau\r\n+ * Site:    http://NadeauSoftware.com/\r\n+ * License: Creative Commons Attribution 3.0 Unported License\r\n+ *          http://creativecommons.org/licenses/by/3.0/deed.en_US\r\n+ */\r\n+#if defined(_WIN32)\r\n+#include <windows.h>\r\n+#include <psapi.h>\r\n+\r\n+#elif defined(__unix__) || defined(__unix) || defined(unix) || (defined(__APPLE__) && defined(__MACH__))\r\n+#include <unistd.h>\r\n+#include <sys/resource.h>\r\n+\r\n+#if defined(__APPLE__) && defined(__MACH__)\r\n+#include <mach/mach.h>\r\n+\r\n+#elif (defined(_AIX) || defined(__TOS__AIX__)) || (defined(__sun__) || defined(__sun) || defined(sun) && (defined(__SVR4) || defined(__svr4__)))\r\n+#include <fcntl.h>\r\n+#include <procfs.h>\r\n+\r\n+#elif defined(__linux__) || defined(__linux) || defined(linux) || defined(__gnu_linux__)\r\n+#include <stdio.h>\r\n+\r\n+#endif\r\n+\r\n+#else\r\n+#error \"Cannot define  getCurrentRSS( ) for an unknown OS.\"\r\n+#endif\r\n+\r\n+/**\r\n+ * Returns the current resident set size (physical memory use) measured\r\n+ * in bytes, or zero if the value cannot be determined on this OS.\r\n+ */\r\n+size_t getCurrentRSS( )\r\n+{\r\n+#if defined(_WIN32)\r\n+    /* Windows -------------------------------------------------- */\r\n+    PROCESS_MEMORY_COUNTERS info;\r\n+    GetProcessMemoryInfo( GetCurrentProcess( ), &info, sizeof(info) );\r\n+    return (size_t)info.WorkingSetSize;\r\n+\r\n+#elif defined(__APPLE__) && defined(__MACH__)\r\n+    /* OSX ------------------------------------------------------ */\r\n+    struct mach_task_basic_info info;\r\n+    mach_msg_type_number_t infoCount = MACH_TASK_BASIC_INFO_COUNT;\r\n+    if ( task_info( mach_task_self( ), MACH_TASK_BASIC_INFO,\r\n+        (task_info_t)&info, &infoCount ) != KERN_SUCCESS )\r\n+        return (size_t)0L;      /* Can't access? */\r\n+    return (size_t)info.resident_size;\r\n+\r\n+#elif defined(__linux__) || defined(__linux) || defined(linux) || defined(__gnu_linux__)\r\n+    /* Linux ---------------------------------------------------- */\r\n+    long rss = 0L;\r\n+    FILE* fp = NULL;\r\n+    if ( (fp = fopen( \"/proc/self/statm\", \"r\" )) == NULL )\r\n+        return (size_t)0L;      /* Can't open? */\r\n+    if ( fscanf( fp, \"%*s%ld\", &rss ) != 1 )\r\n+    {\r\n+        fclose( fp );\r\n+        return (size_t)0L;      /* Can't read? */\r\n+    }\r\n+    fclose( fp );\r\n+    return (size_t)rss * (size_t)sysconf( _SC_PAGESIZE);\r\n+\r\n+#else\r\n+    /* AIX, BSD, Solaris, and Unknown OS ------------------------ */\r\n+    return (size_t)0L;          /* Unsupported. */\r\n+#endif\r\n+}\r\n+\r\n bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) {\r\n+    const auto start = std::chrono::steady_clock::now();\r\n+    size_t max_mem{getCurrentRSS()};\r\n+\r\n     CDBBatch batch(*m_db);\r\n     size_t count = 0;\r\n     size_t changed = 0;\r\n@@ -129,7 +203,11 @@\r\n         it = cursor.NextAndMaybeErase(*it);\r\n         if (batch.SizeEstimate() > m_options.batch_write_bytes) {\r\n             LogDebug(BCLog::COINDB, \"Writing partial batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n+\r\n+            max_mem = std::max(max_mem, getCurrentRSS());\r\n             m_db->WriteBatch(batch);\r\n+            max_mem = std::max(max_mem, getCurrentRSS());\r\n+\r\n             batch.Clear();\r\n             if (m_options.simulate_crash_ratio) {\r\n                 static FastRandomContext rng;\r\n@@ -146,8 +224,16 @@\r\n     batch.Write(DB_BEST_BLOCK, hashBlock);\r\n\r\n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n+\r\n+    max_mem = std::max(max_mem, getCurrentRSS());\r\n     bool ret = m_db->WriteBatch(batch);\r\n+    max_mem = std::max(max_mem, getCurrentRSS());\r\n+\r\n     LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\r\n+    if (changed > 0) {\r\n+        const auto end{std::chrono::steady_clock::now()};\r\n+        LogInfo(\"BatchWrite took=%dms, maxMem=%dMiB\", duration_cast<std::chrono::milliseconds>(end - start).count(), max_mem >> 20);\r\n+    }\r\n     return ret;\r\n }\r\n ```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Python script to load the utxo set, parse the logs and create the flush and memory plots</summary>\r\n\r\n```python\r\nimport os\r\nimport re\r\nimport shutil\r\nimport statistics\r\nimport subprocess\r\nimport time\r\nimport datetime\r\nimport argparse\r\nimport matplotlib.pyplot as plt  # python3.12 -m pip install matplotlib --break-system-packages\r\n\r\n# Regex to parse logs\r\nBATCHWRITE_REGEX = re.compile(r\"^(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z) BatchWrite took=(\\d+)ms, maxMem=(\\d+)MiB\")\r\n\r\n\r\ndef parse_log(archive):\r\n    \"\"\"Parse the log file to extract elapsed times, flush times, and memory usage.\"\"\"\r\n    start_time = None\r\n    elapsed, batchwrite_times, usage_snapshots = [], [], []\r\n    with open(archive, \"r\") as f:\r\n        for line in f:\r\n            if m := BATCHWRITE_REGEX.search(line):\r\n                dt = datetime.datetime.strptime(m.group(1), \"%Y-%m-%dT%H:%M:%SZ\")\r\n                if start_time is None:\r\n                    start_time = dt\r\n                elapsed.append((dt - start_time).total_seconds())\r\n                batchwrite_times.append(int(m.group(2)))\r\n                usage_snapshots.append(int(m.group(3)))\r\n    return elapsed, batchwrite_times, usage_snapshots\r\n\r\n\r\ndef plot_results(results, output_dir):\r\n    \"\"\"Create separate plots for flush times and memory usage.\"\"\"\r\n    if len(results) != 2:\r\n        print(\"plot_results() requires exactly 2 runs for comparison.\")\r\n        return\r\n\r\n    (dbbatch0, elapsed0, flush0, mem0) = results[0]\r\n    (dbbatch1, elapsed1, flush1, mem1) = results[1]\r\n\r\n    # Compute percentage differences\r\n    avg_flush0, avg_flush1 = statistics.mean(flush0), statistics.mean(flush1)\r\n    max_mem0, max_mem1 = max(mem0), max(mem1)\r\n    flush_improvement = round(((avg_flush0 - avg_flush1) / avg_flush0) * 100, 1)\r\n    mem_increase = round(((max_mem1 - max_mem0) / max_mem0) * 100, 1)\r\n\r\n    # Plot flush times\r\n    plt.figure(figsize=(16, 8))\r\n    plt.plot(elapsed0, flush0, color=\"red\", linestyle=\"-\", label=f\"Flush Times (dbbatch={dbbatch0})\")\r\n    plt.axhline(y=avg_flush0, color=\"red\", linestyle=\"--\", alpha=0.5, label=f\"Mean ({dbbatch0})={avg_flush0:.1f}ms\")\r\n    plt.plot(elapsed1, flush1, color=\"orange\", linestyle=\"-\", label=f\"Flush Times (dbbatch={dbbatch1})\")\r\n    plt.axhline(y=avg_flush1, color=\"orange\", linestyle=\"--\", alpha=0.5, label=f\"Mean ({dbbatch1})={avg_flush1:.1f}ms\")\r\n    plt.title(f\"Flush Times (dbbatch {dbbatch0} vs {dbbatch1}) â€” {abs(flush_improvement)}% {'faster' if flush_improvement > 0 else 'slower'}\")\r\n    plt.xlabel(\"Elapsed Time (seconds)\")\r\n    plt.ylabel(\"Flush Times (ms)\")\r\n    plt.legend()\r\n    plt.grid(True)\r\n    plt.tight_layout()\r\n    flush_out_file = os.path.join(output_dir, \"plot_flush_times.png\")\r\n    plt.savefig(flush_out_file)\r\n    print(f\"Flush Times plot saved as {flush_out_file}\")\r\n    plt.close()\r\n\r\n    # Plot memory usage\r\n    plt.figure(figsize=(16, 8))\r\n    plt.plot(elapsed0, mem0, color=\"blue\", linestyle=\"-\", label=f\"Memory (dbbatch={dbbatch0})\")\r\n    plt.axhline(y=max_mem0, color=\"blue\", linestyle=\"--\", alpha=0.5, label=f\"Max Mem ({dbbatch0})={max_mem0}MiB\")\r\n    plt.plot(elapsed1, mem1, color=\"green\", linestyle=\"-\", label=f\"Memory (dbbatch={dbbatch1})\")\r\n    plt.axhline(y=max_mem1, color=\"green\", linestyle=\"--\", alpha=0.5, label=f\"Max Mem ({dbbatch1})={max_mem1}MiB\")\r\n    plt.title(f\"Memory Usage (dbbatch {dbbatch0} vs {dbbatch1}) â€” {abs(mem_increase)}% {'higher' if mem_increase > 0 else 'lower'}\")\r\n    plt.xlabel(\"Elapsed Time (seconds)\")\r\n    plt.ylabel(\"Memory Usage (MiB)\")\r\n    plt.legend()\r\n    plt.grid(True)\r\n    plt.tight_layout()\r\n    mem_out_file = os.path.join(output_dir, \"plot_memory_usage.png\")\r\n    plt.savefig(mem_out_file)\r\n    print(f\"Memory Usage plot saved as {mem_out_file}\")\r\n    plt.close()\r\n\r\n\r\ndef loadtxoutset(dbbatchsize, datadir, bitcoin_cli, bitcoind, utxo_file):\r\n    \"\"\"Load the UTXO set and run the Bitcoin node.\"\"\"\r\n    archive = os.path.join(datadir, f\"results_dbbatch-{dbbatchsize}.log\")\r\n\r\n    # Skip if logs already exist\r\n    if os.path.exists(archive):\r\n        print(f\"Log file {archive} already exists. Skipping loadtxoutset for dbbatchsize={dbbatchsize}.\")\r\n        return\r\n\r\n    os.makedirs(datadir, exist_ok=True)\r\n    debug_log = os.path.join(datadir, \"debug.log\")\r\n\r\n    try:\r\n        print(\"Cleaning up previous run\")\r\n        for subdir in [\"chainstate\", \"chainstate_snapshot\"]:\r\n            shutil.rmtree(os.path.join(datadir, subdir), ignore_errors=True)\r\n\r\n        print(\"Preparing UTXO load\")\r\n        subprocess.run([bitcoind, f\"-datadir={datadir}\", \"-stopatheight=1\"], cwd=bitcoin_core_path)\r\n        os.remove(debug_log)\r\n\r\n        print(f\"Starting bitcoind with dbbatchsize={dbbatchsize}\")\r\n        subprocess.run([bitcoind, f\"-datadir={datadir}\", \"-daemon\", \"-blocksonly=1\", \"-connect=0\", f\"-dbbatchsize={dbbatchsize}\", f\"-dbcache={440}\"], cwd=bitcoin_core_path)\r\n        time.sleep(5)\r\n\r\n        print(\"Loading UTXO set\")\r\n        subprocess.run([bitcoin_cli, f\"-datadir={datadir}\", \"loadtxoutset\", utxo_file], cwd=bitcoin_core_path)\r\n    except Exception as e:\r\n        print(f\"Error during loadtxoutset for dbbatchsize={dbbatchsize}: {e}\")\r\n        raise\r\n    finally:\r\n        print(\"Stopping bitcoind...\")\r\n        subprocess.run([bitcoin_cli, f\"-datadir={datadir}\", \"stop\"], cwd=bitcoin_core_path, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)\r\n        time.sleep(5)\r\n\r\n    shutil.copy2(debug_log, archive)\r\n    print(f\"Archived logs to {archive}\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    # Parse script arguments\r\n    parser = argparse.ArgumentParser(description=\"Benchmark Bitcoin dbbatchsize configurations.\")\r\n    parser.add_argument(\"--utxo-file\", required=True, help=\"Path to the UTXO snapshot file.\")\r\n    parser.add_argument(\"--bitcoin-core-path\", required=True, help=\"Path to the Bitcoin Core project directory.\")\r\n    args = parser.parse_args()\r\n\r\n    utxo_file = args.utxo_file\r\n    bitcoin_core_path = args.bitcoin_core_path\r\n    datadir = os.path.join(bitcoin_core_path, \"demo\")\r\n    debug_log = os.path.join(datadir, \"debug.log\")\r\n    bitcoin_cli = os.path.join(bitcoin_core_path, \"build/src/bitcoin-cli\")\r\n    bitcoind = os.path.join(bitcoin_core_path, \"build/src/bitcoind\")\r\n\r\n    # Build Bitcoin Core\r\n    print(\"Building Bitcoin Core...\")\r\n    subprocess.run([\"cmake\", \"-B\", \"build\", \"-DCMAKE_BUILD_TYPE=Release\"], cwd=bitcoin_core_path, check=True)\r\n    subprocess.run([\"cmake\", \"--build\", \"build\", \"-j\", str(os.cpu_count())], cwd=bitcoin_core_path, check=True)\r\n\r\n    # Run tests for each dbbatchsize\r\n    results = []\r\n    for dbbatchsize in [16777216, 67108864]:  # Original and proposed\r\n        loadtxoutset(dbbatchsize, datadir, bitcoin_cli, bitcoind, utxo_file)\r\n        archive = os.path.join(datadir, f\"results_dbbatch-{dbbatchsize}.log\")\r\n        elapsed, batchwrite_times, usage_snapshots = parse_log(archive)\r\n        results.append((dbbatchsize, elapsed, batchwrite_times, usage_snapshots))\r\n\r\n    # Plot results\r\n    plot_results(results, bitcoin_core_path)\r\n    print(\"All configurations processed.\")\r\n\r\n```\r\n\r\n</details>\r\n\r\n-----\r\n\r\nFor standard dbcache values the results are very close (though the memory measurements aren't as scientific as I'd like them to be (probably because there is still enough memory), some runs even indicate that 16MiB consumes a bit more memory than the 64MiB version), but the trend seems to be clear from the produced plots: the batch writes are faster (and seem more predictable) with bigger batches, while the memory usage is only slightly higher.\r\n\r\n![plot_flush_times](https://github.com/user-attachments/assets/3d7684e8-df49-471f-9cef-f7311e5680fd)\r\n![plot_memory_usage](https://github.com/user-attachments/assets/ee70565a-80a8-446f-9d5c-485b61c6b910)\r\n\r\nIs there any other way that you'd like me to test this @sipa, @luke-jr, @1440000bytes?\r\n\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2595151977",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "mentioned",
      "id": 15955314389,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAO3AsbV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15955314389",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T10:32:16Z"
    },
    {
      "event": "subscribed",
      "id": 15955314405,
      "node_id": "SE_lADOABII586l3CxmzwAAAAO3Asbl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15955314405",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T10:32:16Z"
    },
    {
      "event": "mentioned",
      "id": 15955314419,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAO3Asbz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15955314419",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T10:32:16Z"
    },
    {
      "event": "subscribed",
      "id": 15955314431,
      "node_id": "SE_lADOABII586l3CxmzwAAAAO3Asb_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15955314431",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T10:32:16Z"
    },
    {
      "event": "labeled",
      "id": 15963315995,
      "node_id": "LE_lADOABII586l3CxmzwAAAAO3fN8b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15963315995",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T15:11:12Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15963502062,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAO3f7Xu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15963502062",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "868413340f8d6058d74186b65ac3498d6b7f254a",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/868413340f8d6058d74186b65ac3498d6b7f254a",
      "created_at": "2025-01-16T15:24:03Z"
    },
    {
      "event": "commented",
      "id": 2597073268,
      "node_id": "IC_kwDOABII586azDF0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2597073268",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-16T22:56:58Z",
      "updated_at": "2025-01-16T22:56:58Z",
      "author_association": "MEMBER",
      "body": "I think those graphs need to be on height rather than seconds. The larger dbbatchsize making it faster means it gets further in the chain, leading to the higher max at the end...\r\n\r\nI would expect both lines to be essentially overlapping except during flushes.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2597073268",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2597893092,
      "node_id": "IC_kwDOABII586a2LPk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2597893092",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-17T10:14:28Z",
      "updated_at": "2025-01-17T10:14:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I would expect both lines to be essentially overlapping except during flushes.\r\n\r\nI was only measuring the memory here *during* flushes. There is no direct height available there, but if we instrument `UpdateTipLog` instead (and fetch some data from the assumeUTXO height), we'd get:\r\n\r\n> dbbatchsize=16MiB:\r\n\r\n![image](https://github.com/user-attachments/assets/a164d34a-6f10-4d74-bb8e-155f237ab565)\r\n\r\n> dbbatchsize=64MiB (+ experimental sorting):\r\n\r\n![image](https://github.com/user-attachments/assets/60c8debf-67f2-4424-b44a-50811606ecbb)\r\n\r\n----\r\n\r\noverlapped (blue 16, green 64):\r\n![image](https://github.com/user-attachments/assets/af87c9b1-9376-4e88-8688-9e48413558e6)\r\n\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2597893092",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "unlabeled",
      "id": 15977244154,
      "node_id": "UNLE_lADOABII586l3CxmzwAAAAO4UWX6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15977244154",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-01-17T13:08:11Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 16415797543,
      "node_id": "REFE_lADOABII586l3CxmzwAAAAPSdTEn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16415797543",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "aa56eaaa78211b5eb9cbe00801133395f3114888",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/aa56eaaa78211b5eb9cbe00801133395f3114888",
      "created_at": "2025-02-22T21:04:40Z"
    },
    {
      "event": "renamed",
      "id": 16715994213,
      "node_id": "RTE_lADOABII586l3CxmzwAAAAPkWdRl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16715994213",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T15:22:25Z",
      "rename": {
        "from": "optimization: increase default LevelDB write batch size to 64 MiB",
        "to": "[IBD] Flush UXTOs in bigger batches"
      }
    },
    {
      "event": "mentioned",
      "id": 16715995113,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAPkWdfp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16715995113",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T15:22:28Z"
    },
    {
      "event": "subscribed",
      "id": 16715995144,
      "node_id": "SE_lADOABII586l3CxmzwAAAAPkWdgI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16715995144",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T15:22:28Z"
    },
    {
      "event": "renamed",
      "id": 16717039508,
      "node_id": "RTE_lADOABII586l3CxmzwAAAAPkaceU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16717039508",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-12T16:22:06Z",
      "rename": {
        "from": "[IBD] Flush UXTOs in bigger batches",
        "to": "[IBD] flush UXTOs in bigger batches"
      }
    },
    {
      "event": "reviewed",
      "id": 2679668648,
      "node_id": "PRR_kwDOABII586fuH-o",
      "url": null,
      "actor": null,
      "commit_id": "868413340f8d6058d74186b65ac3498d6b7f254a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-03-12T19:32:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 868413340f8d6058d74186b65ac3498d6b7f254a\r\n\r\n> If that spike exceeds the memory the process can allocate it causes a crash, at a particularly bad time (may require a replay to fix, which may be slower than just reprocessing the blocks).\r\n\r\nIt is difficult for me to have a sense of how safe this change is but I'd hope we are not currently pushing systems so close to the edge that using an extra 48mb will cause them to start crashing. This does seem like a nice performance improvment if it doesn't cause crashes.\r\n\r\nIn theory, we could dynamically limit the batch size based on available memory to mitigate the risk of crashes. However, since the batch size is already small and further increases donâ€™t provide much additional benefit (per the commit message), that added complexity probably isnâ€™t worth it here.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2679668648",
      "submitted_at": "2025-03-12T19:32:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "reviewed",
      "id": 2682568821,
      "node_id": "PRR_kwDOABII586f5MB1",
      "url": null,
      "actor": null,
      "commit_id": "868413340f8d6058d74186b65ac3498d6b7f254a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-03-13T16:36:17Z",
      "author_association": "MEMBER",
      "body": "Concept ACK on raising the default from 16 to 67 megabytes (note that `-dbbatchsize` is a hidden `-help-debug` config option). Testing.\r\n\r\n```\r\n$ ./build/bin/bitcoind -help-debug | grep -A2 dbbatch\r\n  -dbbatchsize\r\n       Maximum database write batch size in bytes (default: 67108864)\r\n\r\n```",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2682568821",
      "submitted_at": "2025-03-13T16:08:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "unsubscribed",
      "id": 16744002095,
      "node_id": "UE_lADOABII586l3CxmzwAAAAPmBTIv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16744002095",
      "actor": {
        "login": "Joven24",
        "id": 173459179,
        "node_id": "U_kgDOClbG6w",
        "avatar_url": "https://avatars.githubusercontent.com/u/173459179?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Joven24",
        "html_url": "https://github.com/Joven24",
        "followers_url": "https://api.github.com/users/Joven24/followers",
        "following_url": "https://api.github.com/users/Joven24/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Joven24/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Joven24/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Joven24/subscriptions",
        "organizations_url": "https://api.github.com/users/Joven24/orgs",
        "repos_url": "https://api.github.com/users/Joven24/repos",
        "events_url": "https://api.github.com/users/Joven24/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Joven24/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-13T16:16:45Z"
    },
    {
      "event": "commented",
      "id": 2722607551,
      "node_id": "IC_kwDOABII586iR7G_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2722607551",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-13T20:22:25Z",
      "updated_at": "2025-03-13T20:22:25Z",
      "author_association": "MEMBER",
      "body": "Review and testing-under-way ACK 868413340f8d6058d74186b65ac3498d6b7f254a\r\n\r\nAs described in the pull description, this value was set in 2017 in #10148 and hasn't been changed since.\r\n\r\n> Maybe a config option can be provided to change it.\r\n\r\n> Just realized [`dbbatchsize`](https://github.com/bitcoin/bitcoin/blob/35bf426e02210c1bbb04926f4ca2e0285fbfcd11/src/init.cpp#L489) already exists.\r\n\r\nThis is a hidden config option and the rationale might be https://github.com/bitcoin/bitcoin/pull/10148#discussion_r110097256:\r\n\r\n\"the relevant constraint is the memory usage peak from allocating the batch, which depends on the batch memory usage, not dbcache memory usage. Also, I don't think anyone will need to change this property (except for tests, where it's very useful to get much more frequent partial flushes).\"\r\n\r\nThough, if an older machine might be constrained in memory during IBD after upgrading bitcoin core, that might be an argument to unhide `-dbbatchsize` with the larger default (and document its use in the conf file; I don't recall if conf file doc gen is automated yet).",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2722607551",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2724691617,
      "node_id": "IC_kwDOABII586iZ36h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2724691617",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T13:24:12Z",
      "updated_at": "2025-03-19T17:33:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "Reran the benchmarks on a Hetzner Linux machine using GCC with the new AssumeUTXO 880k set, parsing the logged flush times and plotting the results.\r\nFor different `dbcache` (440, 5000, 30000) and `dbbatchsize` (4-256MiB range, 16MiB (current) and 64MiB (proposed) are highlighted and trendline is added for clarity) sizes, each one twice for stability:\r\n\r\nSorting the same measurements (+ sums) might give us a better understanding of the trends:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/ce56cfba-a59f-4360-a6d7-2cc3e74959a3\" />\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b151cabd-f7b0-401b-8623-9f29bc3a5a46\" />\r\n\r\n----\r\n\r\nEdit: running it on my Mac M4 Max gives more varied results in general:\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/9de2e6df-d965-457e-9710-4c8279b3dffa\" />\r\n\r\n---\r\n\r\n\r\nI will investigate if it depends on the compiler and operating system - can anyone else check Windows?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2724691617",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2740766215,
      "node_id": "IC_kwDOABII586jXMYH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2740766215",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-20T15:01:05Z",
      "updated_at": "2025-03-21T05:42:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "I used `valgrind --tool=massif` [valgrind massif](https://valgrind.org/docs/manual/ms-manual.html) to profile memory usage of bitcoin-core IBD(840002 to 850000) for 16MiB and 64MiB batch sizes. Tested on an Ubuntu  22.04 Server and compiled with GCC 11.4.0.\r\n\r\n## Memory Usage Tests\r\n\r\n### Method\r\n```\r\nmkdir demo\r\nbuild/bin/bitcoind -datadir=demo -stopatheight=1\r\nbuild/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -stopatheight=840001\r\nbuild/bin/bitcoin-cli -datadir=demo -rpcclienttimeout=0 loadtxoutset ~/utxo-840000.dat\r\nmkdir demo-backup\r\ncp -r demo/* demo-backup\r\n\r\nvalgrind --tool=massif build/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -dbbatchsize=16777216 -stopatheight=850000\r\n\r\nrm -rf demo\r\nmkdir demo\r\ncp -r demo-backup/* demo\r\n\r\nvalgrind --tool=massif build/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -dbbatchsize=67108864 -stopatheight=850000\r\n```\r\n\r\n### Results\r\nRunning `ms_print` on the massif output files produces\r\n```\r\n--------------------------------------------------------------------------------\r\nCommand:            build/bin/bitcoind -datadir=../demo -daemon -blocksonly=1 -dbbatchsize=16777216 -stopatheight=850000\r\nMassif arguments:   (none)\r\nms_print arguments: massif.out.674977\r\n--------------------------------------------------------------------------------\r\n\r\n\r\n    MB\r\n811.4^        #                                                               \r\n     |     :: #                                                       :       \r\n     |     :  #                                                       :       \r\n     |     :  #             ::               ::                       :       \r\n     |  :  :  # @           :                :           :   :        :       \r\n     |  :  :  # @          ::  :   ::        :   @@      :   :   :    :  ::  @\r\n     |  :  : :# @   :  ::  ::  :   :        ::   @   :   :   :   :    :  :   @\r\n     | ::  : :# @ :::  :   ::  :   :  ::    ::   @   :   :  ::   :  :::  :   @\r\n     | ::  : :# @ : :  :  :::  :   :  :   :::: ::@   :  ::  ::   :  : :  :   @\r\n     | ::  : :#:@:: :  :  :::  : :::  :   : :: : @   :  ::  :: :::  : :  :   @\r\n     | ::::: :#:@:: :  :  ::: @: : :  :   : :: : @   :  ::  :: : :  : ::::   @\r\n     | ::: : :#:@:: :::: :::: @: : : ::   : :: : @   :  :::::: : :::: :: : ::@\r\n     | ::: : :#:@:: :: : :::: @: : : :: ::: :: : @   :@@::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ :::@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n     | ::: : :#:@:: :: : :::: @::: : :: : : :: : @ : :@ ::: :::: :: : :: : : @\r\n   0 +----------------------------------------------------------------------->Ti\r\n     0                                                                   8.610\r\n\r\n```\r\n```\r\n--------------------------------------------------------------------------------\r\nCommand:            build/bin/bitcoind -datadir=../demo -daemon -blocksonly=1 -dbbatchsize=67108864 -stopatheight=850000\r\nMassif arguments:   (none)\r\nms_print arguments: massif.out.682470\r\n--------------------------------------------------------------------------------\r\n\r\n\r\n    GB\r\n1.005^          ##                                                            \r\n     |          #                        ::                                   \r\n     |          #               :        :   ::                               \r\n     |          #               :        :   :                        :       \r\n     |          #               :        :   :                        :       \r\n     |          #               :        :   :                        :      :\r\n     |          #               :        :   :        :               :      :\r\n     |  :  ::   #      :    :   :        :  ::   :    : ::   :   ::   :   :: :\r\n     |  :  : @  #      :    :  ::  :   :::  ::   :    : :    :   :  :::   :  @\r\n     |  :  : @  # ::   :    : :::  :   : : :::  ::  ::: :  :::  ::  : : :::  @\r\n     |  :  : @  # :   ::  ::: :::  :   : : :::  ::  : : :  : :  ::  : : : : :@\r\n     | ::::: @::# :   ::  : : :::  :  :: : ::: :::  : :::  : :  :: :: ::: : :@\r\n     | ::: : @: # :   ::  : : ::::::  :: : ::: :::  : :::  : :  :: :: ::: : :@\r\n     | ::: : @: # : ::::  : :::::: :  :: : ::: :::::: :::  : ::::: :: ::: : :@\r\n     | ::: : @: # : : ::::: :::::: ::::: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n     | ::: : @: # : : ::: : :::::: :: :: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n     | ::: : @: # : : ::: : :::::: :: :: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n     | ::: : @: # : : ::: : :::::: :: :: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n     | ::: : @: # : : ::: : :::::: :: :: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n     | ::: : @: # : : ::: : :::::: :: :: : ::: :::: : ::: :: :: :: :: ::: : :@\r\n   0 +----------------------------------------------------------------------->Ti\r\n     0                                                                   8.477\r\n```\r\n\r\nThe graphs show that with the default dbcache size, bitcoin-core memory usage peaks at 811.4MB for 16MiB `dbbatchsize` and 1.005GB for 64MiB `dbbatchsize` . \r\n\r\nIf I'm not mistaken, Bitcoin-core runs on really small devices like Raspberry Pi with only 1GB RAM, if we raise the default  `dbbatchsize` to 64GB, there's a chance that Bitcoin-core could OOM if there's not enough Swap space. \r\nAlso note that if the bitcoin-core process uses swap space, it will run slower thereby negating potential speed gains from raising the `dbbatchsize`.\r\n\r\n## Speed Tests\r\n### Method\r\nApply the following diff to output Batch write time data to `debug.log`.\r\n```diff\r\ndiff --git a/src/txdb.cpp b/src/txdb.cpp\r\nindex 1622039d63..ef73378ce6 100644\r\n--- a/src/txdb.cpp\r\n+++ b/src/txdb.cpp\r\n@@ -91,6 +91,7 @@ std::vector<uint256> CCoinsViewDB::GetHeadBlocks() const {\r\n }\r\n \r\n bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) {\r\n+    const auto start = std::chrono::steady_clock::now();\r\n     CDBBatch batch(*m_db);\r\n     size_t count = 0;\r\n     size_t changed = 0;\r\n@@ -147,7 +148,9 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\r\n \r\n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n     bool ret = m_db->WriteBatch(batch);\r\n+    const auto end{std::chrono::steady_clock::now()};\r\n     LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\r\n+    LogDebug(BCLog::COINDB, \"BatchWrite: completed in %dms\\n\", duration_cast<std::chrono::milliseconds>(end - start).count());\r\n     return ret;\r\n }\r\n```\r\n\r\n```\r\nmkdir demo\r\nbuild/bin/bitcoind -datadir=demo -stopatheight=1\r\nbuild/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -stopatheight=840001\r\nbuild/bin/bitcoin-cli -datadir=demo -rpcclienttimeout=0 loadtxoutset ~/utxo-840000.dat\r\nmkdir demo-backup\r\ncp -r demo/* demo-backup\r\n\r\nbuild/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -dbbatchsize=16777216 -stopatheight=850000 -debug=coindb\r\ncp demo/debug.log defaultcache_16MiB_dbbatchsize.log\r\n\r\nrm -rf demo\r\nmkdir demo\r\ncp -r demo-backup/* demo\r\n\r\nbuild/bin/bitcoind -datadir=demo -daemon -blocksonly=1 -dbbatchsize=67108864 -stopatheight=850000 -debug=coindb\r\ncp demo/debug.log defaultcache_64MiB_dbbatchsize.log\r\n\r\n// Parse log files using https://github.com/Eunovo/31645-data/blob/main/extract_batch_write_data.py\r\ncat defaultcache_64MiB_dbbatchsize.log | grep \"BatchWrite\" -B 1 | xargs ./extract_batch_write_data.py > defaultcache_64MiB_dbbatchsize.result\r\n```\r\n\r\n### Results\r\n```\r\nLogfile: defaultcache_16MiB_dbbatchsize.log\r\n--------------------------------------------\r\nAverage num_txouts_per_ms: 1018.2494977251025\r\n--------------------------------------------\r\nnum_txouts,write_times_ms,num_txouts_per_ms\r\n2862776,2830,1011.5816254416961\r\n2934562,2851,1029.3097158891617\r\n2921143,2753,1061.0762804213584\r\n2940809,2861,1027.8954910870325\r\n2948759,2870,1027.4421602787456\r\n2979042,2967,1004.0586450960566\r\n2956426,2917,1013.5159410353102\r\n3048466,3060,996.2307189542483\r\n2978184,2940,1012.9877551020409\r\n2944033,2945,999.6716468590832\r\n2973528,2970,1001.1878787878788\r\n2970816,2889,1028.3198338525442\r\n2982352,2898,1029.1069703243616\r\n2960008,2776,1066.28530259366\r\n3016540,2952,1021.8631436314363\r\n3007010,3033,991.4309264754369\r\n2976775,2982,998.2478202548625\r\n3084773,3085,999.92641815235\r\n2069630,2016,1026.6021825396826\r\n```\r\n\r\n```\r\nLogfile: defaultcache_64MiB_dbbatchsize.log\r\n--------------------------------------------\r\nAverage num_txouts_per_ms: 735.7374156918239\r\n--------------------------------------------\r\nnum_txouts,write_times_ms,num_txouts_per_ms\r\n2862776,3881,737.6387528987375\r\n2895729,3942,734.5837138508372\r\n2941575,3704,794.161717062635\r\n2941158,3924,749.5305810397554\r\n2965901,4129,718.3097602325018\r\n2978043,4095,727.2388278388279\r\n2946445,4041,729.1375897055184\r\n3034443,4319,702.5799953692984\r\n2993584,4154,720.6509388541165\r\n2947744,4113,716.6895210308777\r\n2979400,4072,731.679764243615\r\n2968346,3819,777.2573972244043\r\n2991885,3932,760.9066632756867\r\n2960911,3844,770.2682101977107\r\n2942739,4000,735.68475\r\n3031336,4282,707.9252685660906\r\n3007839,4118,730.4125789218067\r\n3057094,4257,718.133427296218\r\n2137921,2985,716.2214405360133\r\n```\r\n\r\nRunning with 64MiB `dbbatchsize` turns out to be about 27% slower. I was only able to oberserve a speedup when doing a large flush which doesn't happen often with the default 450MiB cache size. ",
      "user": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2740766215",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2740896169,
      "node_id": "IC_kwDOABII586jXsGp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2740896169",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-20T15:41:37Z",
      "updated_at": "2025-03-20T15:41:37Z",
      "author_association": "MEMBER",
      "body": "Maybe it's a better approach to scale the (default) batch size in function of the dbcache itself? That way, people who have configured their node to run with a low memory footprint to begin with will have relatively small flushing spikes, but people who run on beefy systems and thus likely can tolerate bigger spikes too get to enjoy the performance benefit those may be provide?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2740896169",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "renamed",
      "id": 16974111123,
      "node_id": "RTE_lADOABII586l3CxmzwAAAAPzvGGT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16974111123",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-25T12:58:13Z",
      "rename": {
        "from": "[IBD] flush UXTOs in bigger batches",
        "to": "[IBD] flush UTXOs in bigger batches"
      }
    },
    {
      "event": "commented",
      "id": 2754814130,
      "node_id": "IC_kwDOABII586kMyCy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2754814130",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T15:23:16Z",
      "updated_at": "2025-03-26T15:24:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for your measurements @Eunovo!\r\n\r\nI'm not sure if we support 1GiB of total memory or not, but [even 8 years ago](https://github.com/bitcoin/bitcoin/issues/11752#issuecomment-346451450) that required a lower dbcache that 450MiB.\r\n\r\nIt took me a bit, but I finally finished comparing the 16 and 64 MiB batches with `valgrind --tool=massif` for full IBD until block 888888.\r\n\r\n<details>\r\n<summary>Benchmarks</summary>\r\n\r\n```bash\r\nCOMMITS=\"998386d4462f5e06412303ba559791da83b913fb 5cefc4bbadaa06f22089dd7991fac17ed5b283ca\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=1000; \\\r\nC_COMPILER=gcc; CXX_COMPILER=g++; \\\r\nDATA_DIR=\"/mnt/my_storage/BitcoinData\"; \\\r\nLOG_DIR=\"/mnt/my_storage/logs\"; \\\r\nmkdir -p $LOG_DIR; \\\r\nfor COMMIT in $COMMITS; do \\\r\n  git fetch --all -q && git fetch origin $COMMIT && git log -1 --oneline $COMMIT && \\\r\n  killall bitcoind || true && \\\r\n  rm -rf $DATA_DIR/* && \\\r\n  git checkout $COMMIT && \\\r\n  git clean -fxd && \\\r\n  git reset --hard && \\\r\n  cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF -DCMAKE_C_COMPILER=$C_COMPILER -DCMAKE_CXX_COMPILER=$CXX_COMPILER && \\\r\n  cmake --build build -j$(nproc) --target bitcoind && \\\r\n  ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=1 || true && \\\r\n  valgrind --tool=massif --time-unit=ms \\\r\n    --massif-out-file=\"$LOG_DIR/massif-$COMMIT-$STOP_HEIGHT-$DBCACHE.out\" \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR \\\r\n    -stopatheight=$STOP_HEIGHT \\\r\n    -dbcache=$DBCACHE \\\r\n    -blocksonly=1 \\\r\n    -printtoconsole=1 && \\\r\n  cp $DATA_DIR/debug.log \"$LOG_DIR/debug-$COMMIT-$STOP_HEIGHT-$DBCACHE.log\" && \\\r\n  ms_print \"$LOG_DIR/massif-$COMMIT-$STOP_HEIGHT-$DBCACHE.out\" | tee \"$LOG_DIR/massif-$COMMIT-$STOP_HEIGHT-$DBCACHE.txt\"; \\\r\ndone\r\n```\r\n\r\n</details>\r\n\r\nThe memory difference is measurable and non-negligible (~200MiB, seems the buffer may be copied 4 times), especially for small memory usecases.\r\nI have opened https://github.com/google/leveldb/pull/1259 to enable pre-sizing the memory, which might help us in reducing the spikes slightly.\r\n\r\n16 >> 10 with 1GiB `dbcache`:\r\n<img width=\"1000\" alt=\"16\" src=\"https://github.com/user-attachments/assets/78fb32ee-91f8-40ca-9ddc-18f136ae2540\" />\r\n\r\n64 >> 10 with 1GiB `dbcache`:\r\n<img width=\"1000\" alt=\"64\" src=\"https://github.com/user-attachments/assets/57def2e4-ffea-4aa4-ac19-431b7d992336\" />\r\n\r\n----\r\n\r\nI like @sipa's suggestion of making the batch size depend on cache size, I also thought of that while investigating it, but that may mean that the hidden `dbbatchsize` has to be changed.\r\nBasically we could have a fixed number of batch fills, currently 28 GiB is batched into 16 MiB chunks, we could set it to 1000 fixed writes - or something similar, I'll investigate.\r\n\r\n----\r\n\r\nAnd about the speedups, I found that on Mac the differences were tiny (see attachments), but on Linux they were basically always faster, regardless of the dbcache size. We have to find out in which case it's faster and when it's slower, thanks for helping me with that.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2754814130",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "mentioned",
      "id": 16995217833,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAP0_nGp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16995217833",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T15:23:18Z"
    },
    {
      "event": "subscribed",
      "id": 16995217876,
      "node_id": "SE_lADOABII586l3CxmzwAAAAP0_nHU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16995217876",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T15:23:18Z"
    },
    {
      "event": "mentioned",
      "id": 16995217923,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAP0_nID",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16995217923",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T15:23:18Z"
    },
    {
      "event": "subscribed",
      "id": 16995217973,
      "node_id": "SE_lADOABII586l3CxmzwAAAAP0_nI1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16995217973",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-26T15:23:18Z"
    },
    {
      "event": "commented",
      "id": 2756833986,
      "node_id": "IC_kwDOABII586kUfLC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2756833986",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T06:05:09Z",
      "updated_at": "2025-03-27T06:05:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "> The memory difference is measurable and non-negligible (~200MiB, seems the buffer may be copied 4 times), especially for small memory usecases.\r\n> I have opened [google/leveldb#1259](https://github.com/google/leveldb/pull/1259) to enable pre-sizing the memory, which might help us in reducing the spikes slightly.\r\n\r\n@l0rinc  you can also check `leveldb.approximate-memory-usage`. [Use db.GetProperty](https://github.com/google/leveldb/blob/main/include/leveldb/db.h#L122) before and after batch writes. I noticed that it shows a non-negligible spike in memory usage. Could be useful to quickly check if https://github.com/google/leveldb/pull/1259 works",
      "user": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2756833986",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "mentioned",
      "id": 17005679975,
      "node_id": "MEE_lADOABII586l3CxmzwAAAAP1nhVn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17005679975",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T06:05:10Z"
    },
    {
      "event": "subscribed",
      "id": 17005679985,
      "node_id": "SE_lADOABII586l3CxmzwAAAAP1nhVx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17005679985",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T06:05:10Z"
    },
    {
      "event": "convert_to_draft",
      "id": 17048071471,
      "node_id": "CTDE_lADOABII586l3CxmzwAAAAP4JO0v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17048071471",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-30T14:13:30Z"
    },
    {
      "event": "commented",
      "id": 2764621216,
      "node_id": "IC_kwDOABII586kyMWg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2764621216",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-30T15:47:45Z",
      "updated_at": "2025-04-08T22:00:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "I've experimented a bit with changing the fixed write batch size to a dynamic value that scales with dbcache size, basically something like:\r\n```C++\r\nstatic int64_t GetDefaultDbBatchSize(int64_t dbcache_bytes) {\r\n    return std::min<int64_t>(\r\n        MAX_DB_CACHE_BATCH, // 512 MiB upper limit\r\n        std::max<int64_t>(\r\n            MIN_DB_CACHE,   // 4 MiB lower limit\r\n            dbcache_bytes * DEFAULT_KERNEL_CACHE_BATCH_SIZE / DEFAULT_KERNEL_CACHE\r\n        )\r\n    );\r\n}\r\n```\r\n\r\nCorresponding to:\r\n\r\n| dbcache (MiB) | Before (Fixed) |  | After (Dynamic) |  |\r\n|---------------|----------------|-----------------|----------------|-----------------|\r\n|               | **Batch Size** | **Batch Count** | **Batch Size** | **Batch Count** |\r\n| 4             | 16 MiB         | 1,546           | 4 MiB          | 3,111           |\r\n| 10            | 16 MiB         | 1,546           | 4 MiB          | 3,090           |\r\n| 45            | 16 MiB         | 780             | 4 MiB          | 3,090           |\r\n| 100           | 16 MiB         | 929             | 4 MiB          | 3,085           |\r\n| 450 (default) | 16 MiB         | 775             | 19.6 MiB       | 646             |\r\n| 1,000         | 16 MiB         | 788             | 44 MiB         | 285             |\r\n| 4,500         | 16 MiB         | 774             | 200 MiB        | 69              |\r\n| 10,000        | 16 MiB         | 772             | 444 MiB        | 33              |\r\n| 45,000        | 16 MiB         | 771             | 512 MiB        | 28              |\r\n\r\nThis would:\r\n* Provide smaller batches (4 MiB) for memory-constrained systems (likely making them a bit slower).\r\n* Maintains a similar batch size for default dbcache (20 MiB instead of 16 MiB, making it a bit faster, using a bit more memory).\r\n* Scales to larger batches for high-memory systems (up to 512 MiB, making it a lot faster, using a lot more memory).\r\n\r\n-----\r\n\r\nThe chart illustrates how the dynamic batch sizing maintains approximately a 1:22 ratio (~4.5%) between batch size and dbcache size, while capping at 4 MiB minimum for memory-constrained systems and 512 MiB maximum for high-memory systems (I chose this simply to maintain a similar batch size for the default value (20 MiB instead of 16 MiB for dbcache=440) while scaling linearly for other values).\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/cf237a62-e303-4bbb-aa28-d3fc7aaa0b9f\" />\r\n\r\nI have drafted the PR until I fine-tune these values based on performance and memory usage.\r\n\r\n\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2764621216",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17178568392,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_7CbI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178568392",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "cc8d5446a6ca5f5e0566f062ab2e15ae5b6186c4",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/cc8d5446a6ca5f5e0566f062ab2e15ae5b6186c4",
      "created_at": "2025-04-08T22:10:33Z"
    },
    {
      "event": "commented",
      "id": 2787771040,
      "node_id": "IC_kwDOABII586mKgKg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2787771040",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T22:11:40Z",
      "updated_at": "2025-04-08T22:11:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "TLDR: new version has dynamic batch size, memory and performance stays the same for the default `-dbcache=450` and below.\r\nThe memory and performance increase gradually for higher `dbcache` values.\r\nMeasured memory peaks don't exceed 12% of dbcache, batch size is capped at 256MiB, AssumeUTXO speedup is ~10-20%, reindex-chainstate and IBD performance is measured collectively in https://github.com/bitcoin/bitcoin/pull/32043.\r\nPR description was rewritten from scratch, PR is ready for review again.\r\n\r\n---\r\n\r\nEnded up with keeping the `16 MiB` batch size for `dbcache` sizes below-or-equal to the default (this should simplify things):\r\n\r\n$$\r\n\\text{GetDbBatchSize}(dbcache)\r\n= \\max\\Bigl(16\\mathrm{MiB},\\\r\n   \\min\\bigl(256\\mathrm{MiB},\\\r\n     \\frac{dbcache}{450\\mathrm{MiB}} \\times 16\\mathrm{MiB}\r\n   \\bigr)\r\n\\Bigr).\r\n$$\r\n\r\nWhich produces:\r\n\r\n<details>\r\n<summary>dbcache (MiB) | Batch Size (MiB) | Batches </summary>\r\n\r\n```bash\r\n           4 |          16.0 |     832\r\n          10 |          16.0 |     832\r\n          45 |          16.0 |     832\r\n         100 |          16.0 |     832\r\n         450 |          16.0 |     832\r\n        1000 |          35.6 |     375\r\n        2000 |          71.1 |     188\r\n        4500 |         160.0 |      84\r\n       10000 |         256.0 |      52\r\n       45000 |         256.0 |      52\r\n```\r\n\r\n</details>\r\n\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f9a779e4-a8d6-43fc-be75-958aede9fb31\" />\r\n\r\nWhich corresponds to the following peak memory increase per `dbcache`:\r\n\r\n<details>\r\n<summary>dbcache (MiB) | Before (GB) | After (GB) | Increase (GB) | Increase (%) | Batch Size (Before â†’ After)</summary>\r\n\r\n```bash\r\n         450 |     0.753 |    0.755 |       0.001 |       0.2% | 16 MiB â†’ 16 MiB\r\n        1000 |     1.240 |    1.313 |       0.073 |       5.9% | 16 MiB â†’ 35 MiB\r\n        4500 |     4.564 |    5.109 |       0.545 |      11.9% | 16 MiB â†’ 128 MiB\r\n       10000 |     9.785 |   10.770 |       0.985 |      10.1% | 16 MiB â†’ 256 MiB\r\n```\r\n\r\n</details>\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f80ecfd9-8505-48b8-aefc-6b1bcc4f31b1\" />\r\n\r\n256MiB was chosen as the top value because bigger batches didn't show any further improvement:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/ead0ef81-e90b-4eb8-8202-ab942a7ce4af\" />\r\n\r\nSpeedup depends on the dbcache size now - more available memory allows bigger batches:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/9fbc42de-74b8-493a-8962-3020f2a5d7ea\" />\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2787771040",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "ready_for_review",
      "id": 17178590405,
      "node_id": "RFRE_lADOABII586l3CxmzwAAAAP_7HzF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178590405",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T22:13:07Z"
    },
    {
      "event": "renamed",
      "id": 17178610254,
      "node_id": "RTE_lADOABII586l3CxmzwAAAAP_7MpO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178610254",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T22:15:13Z",
      "rename": {
        "from": "[IBD] flush UTXOs in bigger batches",
        "to": "[IBD] flush UTXOs in bigger batches based on dbcache size"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17178656152,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_7X2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178656152",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9012c91efc8eb6c47e723f741bf55d891a3dc419",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/9012c91efc8eb6c47e723f741bf55d891a3dc419",
      "created_at": "2025-04-08T22:21:04Z"
    },
    {
      "event": "labeled",
      "id": 17178656840,
      "node_id": "LE_lADOABII586l3CxmzwAAAAP_7YBI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178656840",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T22:21:09Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2787784018,
      "node_id": "IC_kwDOABII586mKjVS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2787784018",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T22:21:10Z",
      "updated_at": "2025-04-08T22:21:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40211589754</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2787784018",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17178837508,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_8EIE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17178837508",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "5da4003c613b1700a9326187b85b20d50faeaa02",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/5da4003c613b1700a9326187b85b20d50faeaa02",
      "created_at": "2025-04-08T22:45:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17179020507,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_8wzb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17179020507",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9d6765fdfa940ea341c9104135c53632f77d80d3",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/9d6765fdfa940ea341c9104135c53632f77d80d3",
      "created_at": "2025-04-08T23:13:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17179192082,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_9asS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17179192082",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1180ce3e1c93aef682d0efcff9df45b98f3889ae",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/1180ce3e1c93aef682d0efcff9df45b98f3889ae",
      "created_at": "2025-04-08T23:40:26Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17179255825,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAP_9qQR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17179255825",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c7d329cb11f1338e529680e1ea65deb964f6ef7e",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/c7d329cb11f1338e529680e1ea65deb964f6ef7e",
      "created_at": "2025-04-08T23:45:18Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17183616306,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQAOS0y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17183616306",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b0c9a8d074950d1e0debd2ce8869af2acd2d582f",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b0c9a8d074950d1e0debd2ce8869af2acd2d582f",
      "created_at": "2025-04-09T07:32:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17183962403,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQAPnUj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17183962403",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "973bc3686b43687e712b0b57eae0a95c5d3ee02e",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/973bc3686b43687e712b0b57eae0a95c5d3ee02e",
      "created_at": "2025-04-09T07:56:37Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17184082034,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQAQEhy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17184082034",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c4f528ff257f4fcd2253c54711bc8209656561dd",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/c4f528ff257f4fcd2253c54711bc8209656561dd",
      "created_at": "2025-04-09T08:04:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17184528361,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQARxfp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17184528361",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "06beb420cea1fc65c109f554f486202e5a22b80c",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/06beb420cea1fc65c109f554f486202e5a22b80c",
      "created_at": "2025-04-09T08:30:56Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17184808746,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQAS18q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17184808746",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "created_at": "2025-04-09T08:47:23Z"
    },
    {
      "event": "commented",
      "id": 2788863803,
      "node_id": "IC_kwDOABII586mOq87",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2788863803",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-09T09:00:03Z",
      "updated_at": "2025-04-09T09:00:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "Seems `\"\"_MiB` is explicitly failing for large values - even if I'm just using it for test calculations which end up fitting into 32 bits anyway - so I ended up excluding those tests on 32 bit system since we can't have `dbcache` that large there anyway: https://github.com/bitcoin/bitcoin/compare/cc8d5446a6ca5f5e0566f062ab2e15ae5b6186c4..31f8394f6d5c22aa8d38dc479a6c02e887b8e790#diff-3d0856e8b7f136c588b229e0cbd3b2e2c309cd097ade0879521daba4e1bb2a33R1089-R1094",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2788863803",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "unlabeled",
      "id": 17186428620,
      "node_id": "UNLE_lADOABII586l3CxmzwAAAAQAZBbM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17186428620",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-09T10:00:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "review_requested",
      "id": 17196186237,
      "node_id": "RRE_lADOABII586l3CxmzwAAAAQA-Pp9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17196186237",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-09T21:14:22Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 17196186511,
      "node_id": "RRE_lADOABII586l3CxmzwAAAAQA-PuP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17196186511",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-09T21:14:24Z",
      "requested_reviewer": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2764965493,
      "node_id": "PRR_kwDOABII586kzgZ1",
      "url": null,
      "actor": null,
      "commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-04-14T17:19:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 31f8394f6d5c22aa8d38dc479a6c02e887b8e790. I don't have much insight into the performance / stability tradeoff but implementation of this seems very reasonable and should avoid affecting memory constrainted systems.\r\n\r\nLeft some suggestions about the implementation below but none are very important.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2764965493",
      "submitted_at": "2025-04-14T17:19:35Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "review_requested",
      "id": 17277246050,
      "node_id": "RRE_lADOABII586l3CxmzwAAAAQFzdpi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17277246050",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T21:37:44Z",
      "requested_reviewer": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2769961187,
      "node_id": "PRR_kwDOABII586lGkDj",
      "url": null,
      "actor": null,
      "commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-04-15T21:38:08Z",
      "author_association": "MEMBER",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2769961187",
      "submitted_at": "2025-04-15T21:38:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17287140914,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQGZNYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17287140914",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ce9dd67b1b905a02bee258722ab150e088fb79c1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/ce9dd67b1b905a02bee258722ab150e088fb79c1",
      "created_at": "2025-04-16T11:10:03Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17303720399,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQHYdHP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17303720399",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1ec68cf25367c9d9e4d3fdee1bff64f6f01db231",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/1ec68cf25367c9d9e4d3fdee1bff64f6f01db231",
      "created_at": "2025-04-17T10:18:11Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17303954405,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQHZWPl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17303954405",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "4b4dee0460470ebeef575a446b0696c87893a640",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/4b4dee0460470ebeef575a446b0696c87893a640",
      "created_at": "2025-04-17T10:37:16Z"
    },
    {
      "event": "labeled",
      "id": 17303956162,
      "node_id": "LE_lADOABII586l3CxmzwAAAAQHZWrC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17303956162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T10:37:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2812462892,
      "node_id": "IC_kwDOABII586noscs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2812462892",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T10:37:25Z",
      "updated_at": "2025-04-17T10:37:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40717139109</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2812462892",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "unlabeled",
      "id": 17307346909,
      "node_id": "UNLE_lADOABII586l3CxmzwAAAAQHmSfd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17307346909",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T14:36:51Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17329423799,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAAQI6gW3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17329423799",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "created_at": "2025-04-19T18:45:24Z"
    },
    {
      "event": "renamed",
      "id": 17329427489,
      "node_id": "RTE_lADOABII586l3CxmzwAAAAQI6hQh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17329427489",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-19T18:47:45Z",
      "rename": {
        "from": "[IBD] flush UTXOs in bigger batches based on dbcache size",
        "to": "[IBD] flush UTXO set in batches proportional to `dbcache` size"
      }
    },
    {
      "event": "reviewed",
      "id": 2784731899,
      "node_id": "PRR_kwDOABII586l-6L7",
      "url": null,
      "actor": null,
      "commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-04-22T17:02:40Z",
      "author_association": "MEMBER",
      "body": "ACK 8fd522b223fc1405e70ca93c7e2d5a39f3f826fb\r\n\r\nA few nits, feel free to pick/choose/ignore.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-2784731899",
      "submitted_at": "2025-04-22T17:02:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "review_requested",
      "id": 17357374778,
      "node_id": "RRE_lADOABII586l3CxmzwAAAAQKlIU6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17357374778",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-22T17:02:44Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 2859840062,
      "node_id": "IC_kwDOABII586qdbI-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2859840062",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T18:38:56Z",
      "updated_at": "2025-05-07T18:38:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "Now that https://github.com/bitcoin/bitcoin/pull/30611 is merged, I'm drafting this PR until https://github.com/bitcoin/bitcoin/pull/32414 is also merged, since they eliminate the max memory usecase I've been optimizing for - and I have to remeasure the usecases to see if this is still the optimum.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2859840062",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "convert_to_draft",
      "id": 17561697932,
      "node_id": "CTDE_lADOABII586l3CxmzwAAAAQWwj6M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17561697932",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T18:39:00Z"
    },
    {
      "event": "commented",
      "id": 2919900895,
      "node_id": "IC_kwDOABII586uCibf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2919900895",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-29T16:14:31Z",
      "updated_at": "2025-05-29T16:14:31Z",
      "author_association": "MEMBER",
      "body": "I'm not sure it makes sense to adjust this based on dbcache size. Won't a given batch size use the same amount of memory regardless of the size of the dbcache?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2919900895",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "commented",
      "id": 2919940651,
      "node_id": "IC_kwDOABII586uCsIr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2919940651",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-29T16:30:25Z",
      "updated_at": "2025-05-29T16:30:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Won't a given batch size use the same amount of memory regardless of the size of the dbcache\r\n\r\nIt would, the assumption was that the user should be able to signal how much leftover memory they have - if they start the app with dbcache of 40MiB, allocating an extra 16MiB can be acceptable, but allocating an extra 64MiB can push the node over the edge. Even though we're not (yet?) preallocating the batch string, doubling the size to accommodate the content would end up with a similar size.\r\nHowever, if you're starting with a dbcache of 30GiB, you signal that even 256MiB of extra memory is fine. I.e. there should be a way to lower memory as much as possible, which wouldn't be the case if the batch size were fixed.\r\n\r\nNote, however, that this has changed slightly with the merge of https://github.com/bitcoin/bitcoin/pull/30611, since there's no significant difference between flushing with a dbcache of 4.5GiB and one with 45GiB (since we're flushing regularly now).\r\n\r\nI'm open to suggestions for which direction to take from here.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-2919940651",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "referenced",
      "id": 18028072253,
      "node_id": "REFE_lADOABII586l3CxmzwAAAAQyjo09",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18028072253",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "2104df320969e4368d7a33279d8337fe37fd3603",
      "commit_url": "https://api.github.com/repos/luke-jr/bitcoin/commits/2104df320969e4368d7a33279d8337fe37fd3603",
      "created_at": "2025-06-06T19:49:26Z"
    },
    {
      "event": "labeled",
      "id": 18156055418,
      "node_id": "LE_lADOABII586l3CxmzwAAAAQ6L2t6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18156055418",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-15T13:01:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 18209969453,
      "node_id": "UNLE_lADOABII586l3CxmzwAAAAQ9ZhUt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18209969453",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T12:52:55Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18906757569,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAARm7jnB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18906757569",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "af653f321b135a59e38794b537737ed2f4a0040b",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/af653f321b135a59e38794b537737ed2f4a0040b",
      "created_at": "2025-07-30T20:05:54Z"
    },
    {
      "event": "ready_for_review",
      "id": 18911304659,
      "node_id": "RFRE_lADOABII586l3CxmzwAAAARnM5vT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18911304659",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T04:07:09Z"
    },
    {
      "event": "commented",
      "id": 3138505865,
      "node_id": "IC_kwDOABII5867EcyJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3138505865",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T04:14:22Z",
      "updated_at": "2025-07-31T04:14:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased, the PR is ready for review again!\r\n\r\nThe batch size for UTXO set writes is now calculated based on the maximum `dbcache` size to ensure that with the default values, memory usage doesn't increase, while reducing flushing time when there is enough memory available.\r\nThe change reduces the IBD time by a fixed amount, it's speeding up a critical part of saving the state for long-term storage.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-3138505865",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19024027715,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAARt66BD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19024027715",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/956a6b454704120ba4c482d7157db89c20130e75",
      "created_at": "2025-08-07T00:34:55Z"
    },
    {
      "event": "reviewed",
      "id": 3094683562,
      "node_id": "PRR_kwDOABII5864dR-q",
      "url": null,
      "actor": null,
      "commit_id": "af653f321b135a59e38794b537737ed2f4a0040b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-07T00:34:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "Pushed the remaining nits that I promised a long time ago :)\r\n\r\nRe-rebased, you can re-review with `git range-diff af653f3...956a6b4`",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3094683562",
      "submitted_at": "2025-08-07T00:34:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "reviewed",
      "id": 3099124347,
      "node_id": "PRR_kwDOABII5864uOJ7",
      "url": null,
      "actor": null,
      "commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-08T00:42:25Z",
      "author_association": "MEMBER",
      "body": "ACK 956a6b454704120ba4c482d7157db89c20130e75\r\n\r\n- Note that https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-3138505865 refers to a change of approach from several months ago, prior to my previous review -- in that context, I found the comment confusing\r\n- I would suggest not rebasing if there is no merge conflict; this eases reviewing the diff (and after, I'll usually rebase the PR branch to master locally anyway)\r\n- Happy to re-ack if you take the review suggestions",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3099124347",
      "submitted_at": "2025-08-08T00:42:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "reviewed",
      "id": 3121890966,
      "node_id": "PRR_kwDOABII5866FEaW",
      "url": null,
      "actor": null,
      "commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-14T20:02:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 956a6b454704120ba4c482d7157db89c20130e75\r\n\r\nHave not confirmed the improvements in IBD speedup.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3121890966",
      "submitted_at": "2025-08-14T20:02:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "reviewed",
      "id": 3128539265,
      "node_id": "PRR_kwDOABII5866ebiB",
      "url": null,
      "actor": null,
      "commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-26T08:16:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 956a6b454704120ba4c482d7157db89c20130e75\r\n\r\nChange scales hidden `-dbbatchsize` by the `-dbcache` setting if unset.\r\n\r\nCompared IBD until block 910'000 from local peer in 3 variations (both nodes on SSD, edit: both on NVMe); PR change for `-dbcache` of 450 vs 45'000, and base commit for PR with 45'000.\r\n\r\n* Baseline of `-dbcache=450` averaged 267mins across 3 runs.\r\n* `-dbcache=45000` without this PR averaged 241mins across 3 runs (these were probably the runs where I was doing the least work on the other node).\r\n* `-dbcache=45000` with this PR averaged 233mins across 3 runs.\r\n\r\nThat looks like at least an average 3% improvement in the `-dbcache=45000` case for me. Still nice.\r\n\r\nEdit: Did another run with PR and `-dbcache=45000` and without working on any of the nodes, got a wall time of **218min**. Strengthening the impression that this PR is beneficial.\r\n\r\n<details>\r\n<summary>\r\nRun log\r\n</summary>\r\n\r\nWith PR changes (956a6b454704120ba4c482d7157db89c20130e75):\r\n\r\n```\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=45000 -stopatheight=910000\r\n\r\nreal\t238m57.330s\r\nuser\t527m48.667s\r\nsys\t19m49.001s\r\n\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=450 -stopatheight=910000\r\n\r\nreal\t266m16.473s\r\nuser\t636m6.859s\r\nsys\t32m59.252s\r\n\r\nrepeated:\r\n\r\nreal\t273m25.548s\r\nuser\t640m5.442s\r\nsys\t31m58.674s\r\n\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=45000 -stopatheight=910000\r\n\r\nreal\t228m12.943s\r\nuser\t509m52.682s\r\nsys\t17m10.000s\r\n\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=450 -stopatheight=910000\r\n\r\nreal\t261m47.071s\r\nuser\t631m42.243s\r\nsys\t31m34.241s\r\n```\r\n\r\nPR base (d767503b6a2618e0c99407acf98f3bd19fb7defd):\r\n\r\n```\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=45000 -stopatheight=910000\r\n\r\nreal\t246m56.108s\r\nuser\t522m46.642s\r\nsys\t20m24.343s\r\n\r\nagain:\r\n\r\nreal\t232m41.467s\r\nuser\t508m7.763s\r\nsys\t19m16.589s\r\n\r\nagain:\r\n\r\nreal\t242m17.316s\r\nuser\t506m25.625s\r\nsys\t18m45.029s\r\n```\r\n\r\n=> 241\r\n\r\nAgain on PR:\r\n```\r\nrm -rf ~/.bitcoin && time ./build/bin/bitcoind -connect=workstation.lan -dbcache=45000 -stopatheight=910000\r\n\r\nreal\t232m37.784s\r\nuser\t490m58.944s\r\nsys\t18m3.817s\r\n```\r\nAverages:\r\n```\r\n450 runs:\r\n266+273+262 = 267mins\r\n\r\n45'000 without PR runs:\r\n247+233+242 / 3 = 241min\r\n\r\n45'000 with PR runs:\r\n239+228+233 / 3 = 233min\r\n```\r\n\r\n</details>",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#pullrequestreview-3128539265",
      "submitted_at": "2025-08-25T12:29:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhiYmI3YjhiZjhlM2IyYjY0NjVmMzE4ZWMxMDJjYzUyNzVlNWJmOGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c",
      "tree": {
        "sha": "ad7cd39373385036f4843111ee879851e0d7545c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ad7cd39373385036f4843111ee879851e0d7545c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6ca6f3b37b992591726bd13b494369bee3bd6468",
          "sha": "6ca6f3b37b992591726bd13b494369bee3bd6468",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6ca6f3b37b992591726bd13b494369bee3bd6468"
        }
      ],
      "message": "refactor: Extract default batch size into kernel\n\nThe constant for the default batch size is moved to `kernel/caches.h` to consolidate kernel-related cache constants.",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-08-28T17:09:32Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-08-28T04:20:35Z"
      },
      "sha": "8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI2ZjhjNDg5NDZjYmZjZWIwNjZkZTY2MGM0ODVhZTFiZDJjMjdjYzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "tree": {
        "sha": "14995848ff226a2a9817b5aabf5e28cecdd25b3e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/14995848ff226a2a9817b5aabf5e28cecdd25b3e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c",
          "sha": "8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8bbb7b8bf8e3b2b6465f318ec102cc5275e5bf8c"
        }
      ],
      "message": "coins: increase default `dbbatchsize` to 32 MiB\n\nThe default database write batch size is increased from 16 MiB to 32 MiB to improve I/O efficiency and performance during UTXO flushes, particularly during Initial Block Download and `assumeutxo` loads.\n\nOn systems with slower I/O, a larger batch size reduces overhead from numerous small writes. Measurements show this change provides a modest performance improvement on most hardware during a critical section, with a minimal peak memory increase (approx. 75 MiB on default settings).",
      "committer": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-08-28T17:09:32Z"
      },
      "author": {
        "name": "LÅ‘rinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-08-28T04:24:51Z"
      },
      "sha": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1"
    },
    {
      "event": "renamed",
      "id": 19396353438,
      "node_id": "RTE_lADOABII586l3CxmzwAAAASEHN2e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396353438",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:20:10Z",
      "rename": {
        "from": "[IBD] flush UTXO set in batches proportional to `dbcache` size",
        "to": "[IBD] coins: increase default UTXO flush batch size to 32 MiB"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19396402502,
      "node_id": "HRFPE_lADOABII586l3CxmzwAAAASEHZ1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396402502",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "created_at": "2025-08-28T17:23:23Z"
    },
    {
      "event": "commented",
      "id": 3234329502,
      "node_id": "IC_kwDOABII587Ax_Oe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3234329502",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:23:27Z",
      "updated_at": "2025-08-28T23:20:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks a lot for testing this @hodlinator and @Eunovo.\r\n\r\nIt seems that different configurations behave differently here, so I've retested a few scenarios on a few different platforms to understand what the performance increase depends on exactly. It's not even a linear speedup (i.e. sometimes 32 MiB is faster, sometimes it's 64 MiB), some `dbcache` values reliably produce a lot faster results, while others reliably produce slower results for the same config (i.e. the before-after-plot for different `dbcache` values doesn't look like two parallel lines).\r\n\r\n<details>\r\n<summary>Novo's measurement results showing barely any speedup for `dbcache=1000`</summary>\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/8367a5ce-8f31-479b-a3b6-838bb5557d79\" />\r\n\r\n</details>\r\n\r\n----\r\n\r\n\r\nMy recent measurement used `assumeutxo` loading as a proxy (previous measurements indicated that it's a realistic proxy for dumping utxos), and I ran each independent `dbcache` size 5 times to have proper error bars.\r\n\r\nFirst, on raspberry pi the difference is obviously a lot better with a bigger batch, even with a tiny memory increase:\r\n\r\n![bitcoin_benchmark_comparison-batch_pi](https://github.com/user-attachments/assets/ad9d98fe-01c6-48cb-9126-a6cfa7dcf24e)\r\n\r\n<details>\r\n<summary>for very small dbcache, 64 MiB batch size would make `assumeutxo` load and dump ~59% faster on average on a Pi for 500 MB dbcache, 32 MiB would make it 30% faster</summary>\r\n\r\n```\r\ndbcache=500 MB (dynamic batch size would be 17.8 MB)\r\n  371bece67f: 2215.101Â±198.228 s  use fixed 64_MiB\r\n  0a77b9eee6: 2698.961Â±108.559 s  use fixed 32_MiB\r\n  1c88f34884: 2880.934Â±137.068 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 3513.171Â±761.674 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=2500 MB (dynamic batch size would be 88.9 MB)\r\n  0a77b9eee6: 2202.481Â±100.896 s  use fixed 32_MiB\r\n  6ca6f3b37b: 2277.482Â±131.931 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 2313.098Â±202.818 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  371bece67f: 2360.670Â±73.818 s  use fixed 64_MiB\r\n```\r\n\r\n</details>\r\n\r\n-----\r\n\r\nFor a relatively performant i7 processor with HDD, I'm getting values are all over the place, but it's obvious that the current batch size isn't the best. Looks like dynamic sizing isn't as performant as powers-of-two. The 32 MiB version seems pretty good though.\r\n\r\n![bitcoin_benchmark_comparison-batch_i7](https://github.com/user-attachments/assets/26bd4ef9-1637-4630-8cfc-79057fc1a112)\r\n\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```\r\ndbcache=500 MB (dynamic batch size would be 17.8 MB)\r\n  371bece67f: 723.753Â±74.142 s  use fixed 64_MiB\r\n  0a77b9eee6: 872.229Â±19.075 s  use fixed 32_MiB\r\n  6ca6f3b37b: 924.901Â±34.220 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 927.929Â±20.000 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n\r\ndbcache=1000 MB (dynamic batch size would be 35.6 MB)\r\n  371bece67f: 763.976Â±18.272 s  use fixed 64_MiB\r\n  0a77b9eee6: 780.121Â±21.817 s  use fixed 32_MiB\r\n  6ca6f3b37b: 850.142Â±53.788 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 865.503Â±48.942 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n\r\ndbcache=1500 MB (dynamic batch size would be 53.3 MB)\r\n  0a77b9eee6: 741.196Â±42.555 s  use fixed 32_MiB\r\n  371bece67f: 753.405Â±23.264 s  use fixed 64_MiB\r\n  1c88f34884: 835.422Â±16.123 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 841.494Â±27.479 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=2000 MB (dynamic batch size would be 71.1 MB)\r\n  371bece67f: 726.012Â±25.313 s  use fixed 64_MiB\r\n  6ca6f3b37b: 799.339Â±29.058 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 820.236Â±29.547 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  0a77b9eee6: 858.368Â±16.452 s  use fixed 32_MiB\r\n\r\ndbcache=2500 MB (dynamic batch size would be 88.9 MB)\r\n  371bece67f: 707.112Â±55.839 s  use fixed 64_MiB\r\n  1c88f34884: 749.380Â±35.179 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 768.356Â±33.643 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  0a77b9eee6: 781.631Â±25.348 s  use fixed 32_MiB\r\n\r\ndbcache=3000 MB (dynamic batch size would be 106.7 MB)\r\n  371bece67f: 704.683Â±36.839 s  use fixed 64_MiB\r\n  0a77b9eee6: 749.494Â±14.230 s  use fixed 32_MiB\r\n  6ca6f3b37b: 802.988Â±29.282 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 812.413Â±14.338 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n\r\ndbcache=3500 MB (dynamic batch size would be 124.4 MB)\r\n  371bece67f: 747.208Â±31.524 s  use fixed 64_MiB\r\n  0a77b9eee6: 756.109Â±9.717 s  use fixed 32_MiB\r\n  1c88f34884: 769.228Â±35.585 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 783.391Â±43.066 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=4000 MB (dynamic batch size would be 142.2 MB)\r\n  0a77b9eee6: 742.536Â±13.438 s  use fixed 32_MiB\r\n  1c88f34884: 752.711Â±21.669 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 753.414Â±15.107 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  371bece67f: 759.595Â±15.312 s  use fixed 64_MiB\r\n\r\ndbcache=4500 MB (dynamic batch size would be 160.0 MB)\r\n  371bece67f: 722.305Â±22.894 s  use fixed 64_MiB\r\n  0a77b9eee6: 738.573Â±28.200 s  use fixed 32_MiB\r\n  1c88f34884: 743.053Â±12.117 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 747.821Â±16.638 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=5000 MB (dynamic batch size would be 177.8 MB)\r\n  6ca6f3b37b: 707.499Â±23.626 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 708.064Â±21.035 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  0a77b9eee6: 713.495Â±18.264 s  use fixed 32_MiB\r\n  371bece67f: 723.671Â±18.868 s  use fixed 64_MiB\r\n\r\ndbcache=5500 MB (dynamic batch size would be 195.6 MB)\r\n  371bece67f: 697.942Â±15.469 s  use fixed 64_MiB\r\n  0a77b9eee6: 705.869Â±15.561 s  use fixed 32_MiB\r\n  6ca6f3b37b: 797.158Â±15.429 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 797.677Â±17.496 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n```\r\n\r\n* I reran 32_MiB for `dbcache=2000` and got the same result again, it doesn't seem to be a measurement error\r\n\r\n</details>\r\n\r\n-----\r\n\r\nAlso measured on a very performant i9 with a really fast NVMe - making the difference between memory and background storage more blurry.\r\nHere a bigger `dbcache` doesn't even increase the overall speed, `assumeutxo` is basically the same speed whatever we do - here the goal is to keep the current speed.\r\n\r\n![bitcoin_benchmark_comparison-batch_i9](https://github.com/user-attachments/assets/b25d6aec-2fbf-41e7-bb3e-076eb322f506)\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\ndbcache=500 MB (dynamic batch size would be 17.8 MB)\r\n  371bece67f: 409.650Â±1.656 s  use fixed 64_MiB\r\n  0a77b9eee6: 411.217Â±4.367 s  use fixed 32_MiB\r\n  1c88f34884: 455.376Â±1.326 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 455.975Â±1.697 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=1000 MB (dynamic batch size would be 35.6 MB)\r\n  371bece67f: 416.379Â±1.989 s  use fixed 64_MiB\r\n  1c88f34884: 448.944Â±6.389 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  0a77b9eee6: 449.627Â±1.714 s  use fixed 32_MiB\r\n  6ca6f3b37b: 456.552Â±27.444 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n\r\ndbcache=1500 MB (dynamic batch size would be 53.3 MB)\r\n  371bece67f: 400.644Â±1.372 s  use fixed 64_MiB\r\n  6ca6f3b37b: 430.214Â±3.485 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 430.987Â±4.601 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  0a77b9eee6: 442.139Â±9.970 s  use fixed 32_MiB\r\n\r\ndbcache=2000 MB (dynamic batch size would be 71.1 MB)\r\n  371bece67f: 435.944Â±2.428 s  use fixed 64_MiB\r\n  6ca6f3b37b: 443.443Â±3.007 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 446.855Â±2.847 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  0a77b9eee6: 467.190Â±4.509 s  use fixed 32_MiB\r\n\r\ndbcache=2500 MB (dynamic batch size would be 88.9 MB)\r\n  6ca6f3b37b: 431.099Â±1.968 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 431.577Â±3.782 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  371bece67f: 435.850Â±9.648 s  use fixed 64_MiB\r\n  0a77b9eee6: 461.795Â±4.254 s  use fixed 32_MiB\r\n\r\ndbcache=3000 MB (dynamic batch size would be 106.7 MB)\r\n  6ca6f3b37b: 428.011Â±3.228 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  1c88f34884: 429.848Â±2.192 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  371bece67f: 431.654Â±5.198 s  use fixed 64_MiB\r\n  0a77b9eee6: 445.446Â±5.815 s  use fixed 32_MiB\r\n\r\ndbcache=3500 MB (dynamic batch size would be 124.4 MB)\r\n  1c88f34884: 453.404Â±4.046 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 455.361Â±3.817 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  371bece67f: 469.343Â±2.369 s  use fixed 64_MiB\r\n  0a77b9eee6: 474.821Â±12.205 s  use fixed 32_MiB\r\n\r\ndbcache=4000 MB (dynamic batch size would be 142.2 MB)\r\n  1c88f34884: 443.378Â±5.214 s  coins: introduce dynamic batch size calculator based on `dbcache` value\r\n  6ca6f3b37b: 443.661Â±4.678 s  Merge bitcoin/bitcoin#33241: Update libmultiprocess subtree to fix build issues\r\n  371bece67f: 457.182Â±5.747 s  use fixed 64_MiB\r\n  0a77b9eee6: 471.365Â±8.131 s  use fixed 32_MiB\r\n\r\n</details>\r\n\r\n-----\r\n\r\nSo the dynamic scaling seems like a needless complication and 64 MiB seems to add too much extra memory.\r\n\r\nThe above tests indicate that a constant `32 MiB` bump (without any differentiation based on `dbcache`) is usually faster for most system with most dbcache values than the current one of `16 MiB` (even if usually not as fast as the `64 MiB` alternative).\r\n\r\nComparing the `massif` memory usage of the current `16 MiB`:\r\n```\r\n    MB\r\n744.4^                            :\r\n     |# :::: :  ::: ::  :::::  ::@:::::   ::::::::@@\r\n     |# : :: :  ::: ::  : ::   ::@:: ::   ::: ::: @\r\n     |#:: :: :  ::: ::  : ::   ::@:: ::   ::: ::: @\r\n     |#:: :: :  ::: ::  : ::   ::@:: :: ::::: ::: @\r\n     |#:: :: :  ::: ::  : ::   ::@:: :: : ::: ::: @\r\n     |#:: :: :  ::: ::  : ::   ::@:: :::: ::: ::: @\r\n     |#:: :: :::::: ::  : ::   ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::: ::::: :: ::::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ ::::::::@@::@::::::::::@::\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ : : : : @ ::@:::: :::::@::\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ : : : : @ ::@:::: :::::@::\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ : : : : @ ::@:::: :::::@::\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ : : : : @ ::@:::: :::::@::\r\n     |#:: ::::: ::::::: : :: : ::@:: :::: ::: ::: @ : : : : @ ::@:::: :::::@::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.603\r\n```\r\nvs the new proposed fix `32 MiB`:\r\n```\r\n    MB\r\n819.6^      ##\r\n     | :    #       :      :  :           :\r\n     | :  ::# :::@@:::::::::  :  @:::::: :::::::\r\n     | :  : # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :: : # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :: : # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :: : # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :::: # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :::: # :: @ ::: :: ::  :  @:: ::  :::: :\r\n     | :::: # :: @ ::: :: :::::  @:: ::  :::: :\r\n     | :::: # :: @ ::: :: ::: :::@:: ::  :::: :\r\n     | :::: # :: @ ::: :: ::: :: @:: ::  :::: :\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: :\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: :\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : :::::::::::@::::@::::@:::::::@\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : : : :::::: @::::@::::@:::::::@\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : : : :::::: @::::@::::@:::::::@\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : : : :::::: @::::@::::@:::::::@\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : : : :::::: @::::@::::@:::::::@\r\n     | :::: # :: @ ::: :: ::: :: @:: :: ::::: : : : :::::: @::::@::::@:::::::@\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.484\r\n```\r\nReveals that we're still a lot below 1GiB, the peak memory only increased by `75 MiB` in total (and only during dumping the UTXO set), while the total time decreased from `1.6h` to `1.48h` (8% faster).\r\n\r\n<details>\r\n<summary>What about dbcache=4500?! it's 65 MiB bigger and 3% faster</summary>\r\n\r\nI was interested in the total memory usage of `dbcache=4500` as well:\r\n```\r\n    GB\r\n4.705^                                 :\r\n     | ##::  :::::  ::@:::  :@::: :@::::\r\n     | # ::  : :::  ::@: :  :@::: :@: ::\r\n     | # ::  : :::  ::@: :  :@::: :@: ::\r\n     | # ::  : :::  ::@: :  :@::: :@: ::\r\n     | # :: :: :::  ::@: : ::@::: :@: ::\r\n     | # :: :: :::  ::@: : ::@::: :@: ::\r\n     | # :: :: :::  ::@: : ::@::: :@: ::\r\n     | # :: :: :::  ::@: : ::@::: :@: :::::::\r\n     | # :: :: :::  ::@: : ::@::: :@: ::: ::\r\n     | # :: :: ::: :::@: : ::@::: :@: ::: ::\r\n     | # :: :: ::: :::@: : ::@::: :@: ::: ::\r\n     | # :: :: ::: :::@: : ::@::: :@: ::: ::\r\n     | # :: :: ::: :::@: : ::@::: :@: ::: ::\r\n     | # ::::: ::: :::@: : ::@::: :@: ::: ::\r\n     |@# ::::: ::: :::@: : ::@::: :@: ::: ::\r\n     |@# ::::: :::@:::@: : ::@::: :@: ::: ::\r\n     |@# ::::: :::@:::@: : ::@::: :@: ::: ::\r\n     |@# ::::: :::@:::@: : ::@::: :@: ::: ::\r\n     |@# ::::: :::@:::@: ::::@:::::@: ::: :: @@::@:::@:::::::::@::::::@::::::@\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.294\r\n```\r\n\r\nvs master:\r\n```\r\n    GB\r\n4.640^                       ::\r\n     |  #::  :::@@:  ::@:   :@ @::: @:::\r\n     |  #:   :: @ :  ::@:  @:@ @ :: @: :\r\n     |  #:   :: @ :  ::@:  @:@ @ :: @: :\r\n     |  #:   :: @ :  ::@:  @:@ @ :::@: :\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: :\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: :\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: :\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: : :::\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: : :::\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: : :::\r\n     |  #:  ::: @ : :::@:  @:@ @ :::@: : :::\r\n     | :#:  ::: @ :@:::@:  @:@ @ :::@: : :::\r\n     | :#:  ::: @ :@:::@:  @:@ @ :::@: :::::\r\n     | :#:  ::: @ :@:::@:  @:@ @ :::@: :::::\r\n     | :#:  ::: @ :@:::@:::@:@ @ :::@: :::::\r\n     | :#:  ::: @ :@:::@:: @:@ @ :::@: :::::\r\n     | :#:  ::: @ :@:::@:: @:@ @ :::@: :::::\r\n     | :#: :::: @ :@:::@:: @:@ @ :::@: :::::\r\n     | :#: :::: @ :@:::@:: @:@ @ :::@: :::::::::::::::::::::::::::::::::::@:::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.338\r\n ```\r\n\r\n</details>\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#issuecomment-3234329502",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31645"
    },
    {
      "event": "mentioned",
      "id": 19396403644,
      "node_id": "MEE_lADOABII586l3CxmzwAAAASEHaG8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396403644",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:23:28Z"
    },
    {
      "event": "subscribed",
      "id": 19396403665,
      "node_id": "SE_lADOABII586l3CxmzwAAAASEHaHR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396403665",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:23:28Z"
    },
    {
      "event": "mentioned",
      "id": 19396403691,
      "node_id": "MEE_lADOABII586l3CxmzwAAAASEHaHr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396403691",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:23:28Z"
    },
    {
      "event": "subscribed",
      "id": 19396403716,
      "node_id": "SE_lADOABII586l3CxmzwAAAASEHaIE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19396403716",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T17:23:28Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042523272",
      "pull_request_review_id": 2764965493,
      "id": 2042523272,
      "node_id": "PRRC_kwDOABII5855vm6I",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));\n+    }\n+\n+    void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 19,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"coins: introduce dynamic batch size calculator based on dbcache value\" (b249239c1747a5425e5161974d2b9c9c5be17dab)\r\n\r\nWould be better to restore previous indentation and follow the \"4 space indentation (no tabs) for every block except namespaces\" rule in developer notes. Namespaces reflect directory paths and project organization beyond the scope of an individual file and are not intended to effect indentation within files.\r\n\r\n\r\n",
      "created_at": "2025-04-14T16:46:39Z",
      "updated_at": "2025-04-14T17:20:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2042523272",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042523272"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 21,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042530712",
      "pull_request_review_id": 2764965493,
      "id": 2042530712,
      "node_id": "PRRC_kwDOABII5855vouY",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"coins: introduce dynamic batch size calculator based on dbcache value\" (b249239c1747a5425e5161974d2b9c9c5be17dab)\r\n\r\nNot important, but seems like this could be simplified with std::clamp\r\n\r\n```c++\r\nreturn std::clamp(target, MIN_DB_CACHE_BATCH, MAX_DB_CACHE_BATCH);\r\n```",
      "created_at": "2025-04-14T16:51:34Z",
      "updated_at": "2025-04-14T17:19:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2042530712",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042530712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042535961",
      "pull_request_review_id": 2764965493,
      "id": 2042535961,
      "node_id": "PRRC_kwDOABII5855vqAZ",
      "diff_hunk": "@@ -16,6 +16,10 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+static constexpr size_t MIN_DB_CACHE_BATCH{16_MiB};\n+static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB}; // The batch size of DEFAULT_KERNEL_CACHE",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"coins: introduce dynamic batch size calculator based on dbcache value\" (b249239c1747a5425e5161974d2b9c9c5be17dab)\r\n\r\nMaybe there should be a test or static assert somewhere that `DEFAULT_DB_CACHE_BATCH == GetDbBatchSize(DEFAULT_KERNEL_CACHE)`",
      "created_at": "2025-04-14T16:55:27Z",
      "updated_at": "2025-04-14T17:19:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2042535961",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042535961"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042574513",
      "pull_request_review_id": 2764965493,
      "id": 2042574513,
      "node_id": "PRRC_kwDOABII5855vzax",
      "diff_hunk": "@@ -16,6 +16,10 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+static constexpr size_t MIN_DB_CACHE_BATCH{16_MiB};",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"coins: introduce dynamic batch size calculator based on dbcache value\" (b249239c1747a5425e5161974d2b9c9c5be17dab)\r\n\r\nName suggests this is a minimum size, but value is actually ignored if `-dbbatchsize` is specified, so is not an enforced minimum. Would suggest calling it a \"minimum default\" value instead of a \"minimum\" value to be more accurate. Or it might be better to just drop `MIN_DB_CACHE_BATCH` and `MAX_DB_CACHE_BATCH` here and just inline these in the `GetDbBatchSize` function since they are not used anywhere outside it.\r\n\r\n\r\n",
      "created_at": "2025-04-14T17:09:13Z",
      "updated_at": "2025-04-14T17:19:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2042574513",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042574513"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042579877",
      "pull_request_review_id": 2764965493,
      "id": 2042579877,
      "node_id": "PRRC_kwDOABII5855v0ul",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"coins: introduce dynamic batch size calculator based on dbcache value\" (b249239c1747a5425e5161974d2b9c9c5be17dab)\r\n\r\nBecause division is happening before multiplication here, target will be 0 for any value below DEFAULT_KERNEL_CACHE, instead of scaling smoothly. This works well enough for current code because MIN_DB_CACHE_BATCH and DEFAULT_DB_CACHE_BATCH are equal, but if the minimum was less, this would return a discontinuous result instead of scaling smoothly. Would suggest either adding a conditional to handle this case or just using the default as the minimum explicitly here.",
      "created_at": "2025-04-14T17:12:53Z",
      "updated_at": "2025-04-14T17:19:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2042579877",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2042579877"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045577212",
      "pull_request_review_id": 2769961187,
      "id": 2045577212,
      "node_id": "PRRC_kwDOABII58557Qf8",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Possibly naive suggestion: could this help doc indicate what value will be used by default, based on the actual dbcache value (if there isn't an initialization order issue, didn't check). Currently this only returns the following, which makes it difficult to know what will change if a value is provided by the user:\r\n\r\n```\r\n$ ./build/bin/bitcoind -help-debug | grep -C2 dbbatchsize\r\n  -dbbatchsize\r\n       Maximum database write batch size in bytes (calculated dynamically by\r\n       default)\r\n```\r\n",
      "created_at": "2025-04-15T21:38:08Z",
      "updated_at": "2025-04-15T21:59:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2045577212",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045577212"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045579770",
      "pull_request_review_id": 2769964762,
      "id": 2045579770,
      "node_id": "PRRC_kwDOABII58557RH6",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "You mean we should add the formula to the doc?\r\n\r\n$$\r\n\\text{GetDbBatchSize}(dbcache)\r\n= \\max\\Bigl(16\\mathrm{MiB},\\\r\n   \\min\\bigl(256\\mathrm{MiB},\\\r\n     \\frac{dbcache}{450\\mathrm{MiB}} \\times 16\\mathrm{MiB}\r\n   \\bigr)\r\n\\Bigr).\r\n$$",
      "created_at": "2025-04-15T21:39:47Z",
      "updated_at": "2025-04-15T21:39:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2045579770",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045579770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045584758",
      "pull_request_review_id": 2769974177,
      "id": 2045584758,
      "node_id": "PRRC_kwDOABII58557SV2",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "-dbcache is a config option set only on init, so my thinking was that maybe this help doc might use that value and give the actual amount.",
      "created_at": "2025-04-15T21:44:17Z",
      "updated_at": "2025-04-15T21:44:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2045584758",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045584758"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045591774",
      "pull_request_review_id": 2769985603,
      "id": 2045591774,
      "node_id": "PRRC_kwDOABII58557UDe",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The user shouldn't really set this, it's a hidden, `ArgsManager::DEBUG_ONLY` arg.\r\nI'm not sure if it's possible to set it dynamically, can you give me a patch if it is? ",
      "created_at": "2025-04-15T21:50:18Z",
      "updated_at": "2025-04-15T21:50:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2045591774",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045591774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045594058",
      "pull_request_review_id": 2769990092,
      "id": 2045594058,
      "node_id": "PRRC_kwDOABII58557UnK",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, but the config option is presumably there for developers to use or test with (otherwise it can be removed), and ISTM that it shouldn't require code review or customization to know what value will be used by default. I could be wrong, though.",
      "created_at": "2025-04-15T21:52:03Z",
      "updated_at": "2025-04-16T19:01:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2045594058",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045594058"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046694611",
      "pull_request_review_id": 2772129688,
      "id": 2046694611,
      "node_id": "PRRC_kwDOABII5855_hTT",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "You mean something like:\r\n```C++\r\nstrprintf(\"Maximum database write batch size in bytes (default: %u)\", node::GetDbBatchSize(argsman.GetIntArg(\"-dbcache\", DEFAULT_DB_CACHE)))\r\n```\r\n\r\nIt seems `dbcache` isn't available here yet (it always gets the default `DEFAULT_KERNEL_CACHE`):\r\n```\r\n./build/bin/bitcoind -dbcache=1000 -help-debug | grep -A1 dbbatchsize\r\n  -dbbatchsize\r\n       Maximum database write batch size in bytes (default: 16777216)\r\n```\r\n\r\nPlease correct me if this isn't what you meant.\r\n",
      "created_at": "2025-04-16T11:10:26Z",
      "updated_at": "2025-04-16T11:13:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046694611",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046694611"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695287",
      "pull_request_review_id": 2772130714,
      "id": 2046695287,
      "node_id": "PRRC_kwDOABII5855_hd3",
      "diff_hunk": "@@ -16,6 +16,10 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+static constexpr size_t MIN_DB_CACHE_BATCH{16_MiB};",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2042574513,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Inlined max and eliminated `min` (replaced with default)",
      "created_at": "2025-04-16T11:10:53Z",
      "updated_at": "2025-04-16T11:10:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046695287",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695287"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695435",
      "pull_request_review_id": 2772130945,
      "id": 2046695435,
      "node_id": "PRRC_kwDOABII5855_hgL",
      "diff_hunk": "@@ -16,6 +16,10 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+static constexpr size_t MIN_DB_CACHE_BATCH{16_MiB};\n+static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB}; // The batch size of DEFAULT_KERNEL_CACHE",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042535961,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added it to the test as:\r\n```C++\r\nBOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\r\n```",
      "created_at": "2025-04-16T11:10:59Z",
      "updated_at": "2025-04-16T11:10:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046695435",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695435"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695523",
      "pull_request_review_id": 2772131092,
      "id": 2046695523,
      "node_id": "PRRC_kwDOABII5855_hhj",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042530712,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Indeed, a lot cleaner this way, I can even inline `target` now, thanks!",
      "created_at": "2025-04-16T11:11:03Z",
      "updated_at": "2025-04-16T11:11:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046695523",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695523"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695619",
      "pull_request_review_id": 2772131251,
      "id": 2046695619,
      "node_id": "PRRC_kwDOABII5855_hjD",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));\n+    }\n+\n+    void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 19,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042523272,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Sure, done",
      "created_at": "2025-04-16T11:11:08Z",
      "updated_at": "2025-04-16T11:11:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046695619",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046695619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 21,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046696984",
      "pull_request_review_id": 2772133567,
      "id": 2046696984,
      "node_id": "PRRC_kwDOABII5855_h4Y",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2042579877,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Since division needs to be before multiplication to avoid overflow of `size_t` on 32 bits, the simplest solution I found was to eliminate the min and use default as the min value for calculation instead:\r\n```C++\r\nstatic constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\r\n{\r\n    return std::clamp(\r\n        (dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH,\r\n        /*lo=*/DEFAULT_DB_CACHE_BATCH,\r\n        /*hi=*/256_MiB\r\n    );\r\n}\r\n```\r\n\r\nAdded test for the min value to correspond to the default:\r\n```C++\r\nBOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\r\n```\r\n\r\nUpdated the commit message with:\r\n> The minimum coincides with the default to prevent performance degradation for small caches and avoid discontinuities from integer division.\r\n\r\nWhat do you think?",
      "created_at": "2025-04-16T11:12:11Z",
      "updated_at": "2025-04-16T11:12:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2046696984",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2046696984"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047759939",
      "pull_request_review_id": 2773854024,
      "id": 2047759939,
      "node_id": "PRRC_kwDOABII5856DlZD",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Hm. Not sure how we can obtain `-dbcache` here. If not, as a fallback maybe indeed something like:\r\n\r\n```diff\r\n@@ -48,6 +48,7 @@\r\n #include <node/chainstatemanager_args.h>\r\n+#include <node/coins_view_args.h>\r\n #include <node/context.h>\r\n #include <node/interface_ui.h>\r\n #include <node/kernel_notifications.h>\r\n@@ -487,7 +488,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\r\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\r\n-    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\r\n+    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (calculated per <...formula...>, default: %u with the default -dbcache of %u)\", node::GetDbBatchSize(DEFAULT_DB_CACHE), DEFAULT_DB_CACHE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\r\n```\r\n\r\n(Not sure I'm plugging in the correct constant in that example)",
      "created_at": "2025-04-16T21:03:17Z",
      "updated_at": "2025-04-16T21:05:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2047759939",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047759939"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047765203",
      "pull_request_review_id": 2773862594,
      "id": 2047765203,
      "node_id": "PRRC_kwDOABII5856DmrT",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Is this important? I would prefer not duplicating the logic in a comment.\r\nBut it might be a good idea to log the calculated value based on the provided `dbbatchsize` - would that work for you instead?",
      "created_at": "2025-04-16T21:08:13Z",
      "updated_at": "2025-04-16T21:08:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2047765203",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047765203"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047778849",
      "pull_request_review_id": 2773884220,
      "id": 2047778849,
      "node_id": "PRRC_kwDOABII5856DqAh",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Providing the default -dbbatchsize given the default -dbcache seems good to provide for an idea, while also informing that the calculation is partially based on the -dbcache value (unsure about \"dynamically\" as -dbcache is set on startup). Maybe something like\r\n\r\n```\r\nMaximum database write batch size in bytes (calculated using -dbcache, default: %u with the default -dbcache of %u)\r\n```\r\n",
      "created_at": "2025-04-16T21:21:02Z",
      "updated_at": "2025-04-16T21:21:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2047778849",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2047778849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2048662881",
      "pull_request_review_id": 2775269099,
      "id": 2048662881,
      "node_id": "PRRC_kwDOABII5856HB1h",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks, ended up with:\r\n```C++\r\nargsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: calculated from the provided `-dbcache` value or %u if none are provided)\", node::GetDbBatchSize(DEFAULT_DB_CACHE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\r\n```\r\nwhich prints:\r\n```bash\r\n./build/bin/bitcoind -dbcache=1000 -help-debug | grep -A2 dbbatchsize\r\n  -dbbatchsize\r\n       Maximum database write batch size in bytes (default: calculated from the\r\n       provided `-dbcache` value or 16777216 if none are provided)\r\n```\r\n\r\nWhat do you think?",
      "created_at": "2025-04-17T10:18:13Z",
      "updated_at": "2025-04-17T10:18:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2048662881",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2048662881"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051237644",
      "pull_request_review_id": 2779611487,
      "id": 2051237644,
      "node_id": "PRRC_kwDOABII5856Q2cM",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "LGTM, suggestion s/are/is/ and drop one of the two \"provided\"s\r\n\r\n\"(default: calculated from the `-dbcache` value, or 16777216 if none is provided)\"",
      "created_at": "2025-04-18T23:18:09Z",
      "updated_at": "2025-04-18T23:18:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2051237644",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051237644"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051409131",
      "pull_request_review_id": 2779884807,
      "id": 2051409131,
      "node_id": "PRRC_kwDOABII5856RgTr",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I wrote \"are\", since we can set two values which would override the default.",
      "created_at": "2025-04-19T06:25:28Z",
      "updated_at": "2025-04-19T06:25:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2051409131",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051409131"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051557904",
      "pull_request_review_id": 2780071693,
      "id": 2051557904,
      "node_id": "PRRC_kwDOABII5856SEoQ",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Updated it and rebased to fix build - please re-review.",
      "created_at": "2025-04-19T18:45:45Z",
      "updated_at": "2025-04-19T18:45:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2051557904",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2051557904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054492337",
      "pull_request_review_id": 2784731899,
      "id": 2054492337,
      "node_id": "PRRC_kwDOABII5856dRCx",
      "diff_hunk": "@@ -5,10 +5,22 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n+namespace node\n+{\n+static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+{\n+    return std::clamp(\n+        (dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH,\n+        /*lo=*/DEFAULT_DB_CACHE_BATCH,\n+        /*hi=*/256_MiB\n+    );",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 18,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Might be good to add a comment for this magic value, i.e. (from the PR description):\r\n\r\n`Capped at 256 MiB, as gains are barely measurable for bigger batches (see PR 31645)`\r\n\r\nalso, clang-format\r\n\r\n```diff\r\n-        /*hi=*/256_MiB\r\n-    );\r\n+        /*hi=*/256_MiB);\r\n```\r\n\r\nand unneeded braces line 18\r\n\r\n```diff\r\n-        (dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH,\r\n+        dbcache_bytes / DEFAULT_KERNEL_CACHE * DEFAULT_DB_CACHE_BATCH,\r\n```",
      "created_at": "2025-04-22T16:51:51Z",
      "updated_at": "2025-04-22T17:02:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2054492337",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054492337"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054494446",
      "pull_request_review_id": 2784731899,
      "id": 2054494446,
      "node_id": "PRRC_kwDOABII5856dRju",
      "diff_hunk": "@@ -20,6 +20,7 @@\n #include <vector>\n \n #include <boost/test/unit_test.hpp>\n+#include <node/coins_view_args.h>",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This seems to be the most frequently seen order:\r\n\r\n```diff\r\n #include <coins.h>\r\n+#include <node/coins_view_args.h>\r\n #include <streams.h>\r\n@@ -20,7 +21,6 @@\r\n #include <vector>\r\n \r\n #include <boost/test/unit_test.hpp>\r\n-#include <node/coins_view_args.h>\r\n \r\n using namespace util::hex_literals;\r\n```",
      "created_at": "2025-04-22T16:53:23Z",
      "updated_at": "2025-04-22T17:02:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2054494446",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054494446"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054497017",
      "pull_request_review_id": 2784731899,
      "id": 2054497017,
      "node_id": "PRRC_kwDOABII5856dSL5",
      "diff_hunk": "@@ -10,7 +12,9 @@\n namespace node {\n void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options)\n {\n-    if (auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n-    if (auto value = args.GetIntArg(\"-dbcrashratio\")) options.simulate_crash_ratio = *value;\n+    if (const auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n+    else options.batch_write_bytes = GetDbBatchSize(args.GetIntArg(\"-dbcache\", DEFAULT_KERNEL_CACHE));",
      "path": "src/node/coins_view_args.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Feel free to ignore, but the following would be more readable and follow the most frequent convention in this codebase:\r\n\r\n```diff\r\n-    if (const auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\r\n-    else options.batch_write_bytes = GetDbBatchSize(args.GetIntArg(\"-dbcache\", DEFAULT_KERNEL_CACHE));\r\n+    if (const auto value = args.GetIntArg(\"-dbbatchsize\")) {\r\n+        options.batch_write_bytes = *value;\r\n+    } else {\r\n+        options.batch_write_bytes = GetDbBatchSize(args.GetIntArg(\"-dbcache\", DEFAULT_KERNEL_CACHE));\r\n+    }\r\n```",
      "created_at": "2025-04-22T16:55:05Z",
      "updated_at": "2025-04-22T17:02:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2054497017",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054497017"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054511132",
      "pull_request_review_id": 2784762185,
      "id": 2054511132,
      "node_id": "PRRC_kwDOABII5856dVoc",
      "diff_hunk": "@@ -487,7 +487,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", \"Maximum database write batch size in bytes (calculated dynamically by default)\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "31f8394f6d5c22aa8d38dc479a6c02e887b8e790",
      "in_reply_to_id": 2045577212,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "lgtm (thanks for updating)\r\n\r\n```\r\n$ ./build/bin/bitcoind -help-debug | grep -A2 dbbatchsize       \r\n  -dbbatchsize\r\n       Maximum database write batch size in bytes (default: calculated from the\r\n       `-dbcache` value or 16777216 if not set)\r\n```",
      "created_at": "2025-04-22T17:03:46Z",
      "updated_at": "2025-04-22T17:03:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2054511132",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2054511132"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055779247",
      "pull_request_review_id": 2786854252,
      "id": 2055779247,
      "node_id": "PRRC_kwDOABII5856iLOv",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042530712,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "https://en.cppreference.com/w/cpp/algorithm/clamp states that\r\n> If lo is greater than hi, the behavior is undefined.\r\n\r\n(cc: @hodlinator)\r\nShould we add an explicit `assert` somewhere that this isn't the case? Though it's implied currently from the tests...",
      "created_at": "2025-04-23T10:47:19Z",
      "updated_at": "2025-04-23T10:47:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2055779247",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055779247"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055801774",
      "pull_request_review_id": 2786889022,
      "id": 2055801774,
      "node_id": "PRRC_kwDOABII5856iQuu",
      "diff_hunk": "@@ -10,7 +12,9 @@\n namespace node {\n void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options)\n {\n-    if (auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n-    if (auto value = args.GetIntArg(\"-dbcrashratio\")) options.simulate_crash_ratio = *value;\n+    if (const auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n+    else options.batch_write_bytes = GetDbBatchSize(args.GetIntArg(\"-dbcache\", DEFAULT_KERNEL_CACHE));",
      "path": "src/node/coins_view_args.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054497017,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Will do if I repush.",
      "created_at": "2025-04-23T11:00:07Z",
      "updated_at": "2025-04-23T11:00:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2055801774",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055801774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055801848",
      "pull_request_review_id": 2786889130,
      "id": 2055801848,
      "node_id": "PRRC_kwDOABII5856iQv4",
      "diff_hunk": "@@ -20,6 +20,7 @@\n #include <vector>\n \n #include <boost/test/unit_test.hpp>\n+#include <node/coins_view_args.h>",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054494446,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "you mean we usually ignore the folder when sorting? I found examples for all sorts of includes (pun, intended) - I'll adjust if I have to push again.",
      "created_at": "2025-04-23T11:00:09Z",
      "updated_at": "2025-04-23T11:00:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2055801848",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055801848"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055802001",
      "pull_request_review_id": 2786889309,
      "id": 2055802001,
      "node_id": "PRRC_kwDOABII5856iQyR",
      "diff_hunk": "@@ -5,10 +5,22 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n+namespace node\n+{\n+static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+{\n+    return std::clamp(\n+        (dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH,\n+        /*lo=*/DEFAULT_DB_CACHE_BATCH,\n+        /*hi=*/256_MiB\n+    );",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 18,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054492337,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Capped at 256 MiB, as gains are barely measurable for bigger batches (see PR 31645)\r\n\r\nI don't mind adding, but a simple blame would immediately reveal that\r\n\r\n> unneeded braces line 18\r\n\r\nThey may be implied, but I want to emphasize that mathematically this isn't associative, i.e. not the same as \r\n```C++\r\ndbcache_bytes / (DEFAULT_KERNEL_CACHE * DEFAULT_DB_CACHE_BATCH)\r\n```\r\n",
      "created_at": "2025-04-23T11:00:14Z",
      "updated_at": "2025-04-23T11:00:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2055802001",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2055802001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056032514",
      "pull_request_review_id": 2787274175,
      "id": 2056032514,
      "node_id": "PRRC_kwDOABII5856jJEC",
      "diff_hunk": "@@ -20,6 +20,7 @@\n #include <vector>\n \n #include <boost/test/unit_test.hpp>\n+#include <node/coins_view_args.h>",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054494446,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> you mean we usually ignore the folder when sorting?\r\n\r\nThink it's a case of keeping our headers separate from external dependencies/libraries.",
      "created_at": "2025-04-23T13:15:42Z",
      "updated_at": "2025-04-23T13:15:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2056032514",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056032514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056049582",
      "pull_request_review_id": 2787306006,
      "id": 2056049582,
      "node_id": "PRRC_kwDOABII5856jNOu",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042530712,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think it might make sense to introduce our own version of `clamp` that includes such an `assert` since the standard library has no guarantees if cppreference is to be believed. (Or just start off with an `assert`/`Assume` before the call for now).",
      "created_at": "2025-04-23T13:23:27Z",
      "updated_at": "2025-04-23T13:23:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2056049582",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056049582"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056598543",
      "pull_request_review_id": 2788242420,
      "id": 2056598543,
      "node_id": "PRRC_kwDOABII5856lTQP",
      "diff_hunk": "@@ -20,6 +20,7 @@\n #include <vector>\n \n #include <boost/test/unit_test.hpp>\n+#include <node/coins_view_args.h>",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054494446,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Makes sense, will do next time I push",
      "created_at": "2025-04-23T17:44:55Z",
      "updated_at": "2025-04-23T17:44:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2056598543",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056598543"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579061",
      "pull_request_review_id": 3094683562,
      "id": 2258579061,
      "node_id": "PRRC_kwDOABII586Gny51",
      "diff_hunk": "@@ -10,7 +12,9 @@\n namespace node {\n void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options)\n {\n-    if (auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n-    if (auto value = args.GetIntArg(\"-dbcrashratio\")) options.simulate_crash_ratio = *value;\n+    if (const auto value = args.GetIntArg(\"-dbbatchsize\")) options.batch_write_bytes = *value;\n+    else options.batch_write_bytes = GetDbBatchSize(args.GetIntArg(\"-dbcache\", DEFAULT_KERNEL_CACHE));",
      "path": "src/node/coins_view_args.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054497017,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added braces",
      "created_at": "2025-08-07T00:15:11Z",
      "updated_at": "2025-08-07T00:34:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2258579061",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579061"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579473",
      "pull_request_review_id": 3094683562,
      "id": 2258579473,
      "node_id": "PRRC_kwDOABII586GnzAR",
      "diff_hunk": "@@ -5,10 +5,22 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n+namespace node\n+{\n+static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+{\n+    return std::clamp(\n+        (dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH,\n+        /*lo=*/DEFAULT_DB_CACHE_BATCH,\n+        /*hi=*/256_MiB\n+    );",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 18,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054492337,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Extracted min/max and added some comments",
      "created_at": "2025-08-07T00:15:38Z",
      "updated_at": "2025-08-07T00:34:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2258579473",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579473"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579567",
      "pull_request_review_id": 3094683562,
      "id": 2258579567,
      "node_id": "PRRC_kwDOABII586GnzBv",
      "diff_hunk": "@@ -20,6 +20,7 @@\n #include <vector>\n \n #include <boost/test/unit_test.hpp>\n+#include <node/coins_view_args.h>",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "8fd522b223fc1405e70ca93c7e2d5a39f3f826fb",
      "in_reply_to_id": 2054494446,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-08-07T00:15:45Z",
      "updated_at": "2025-08-07T00:34:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2258579567",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258579567"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258580736",
      "pull_request_review_id": 3094683562,
      "id": 2258580736,
      "node_id": "PRRC_kwDOABII586GnzUA",
      "diff_hunk": "@@ -5,11 +5,20 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n-void ReadCoinsViewArgs(const ArgsManager& args, CoinsViewOptions& options);\n+namespace node\n+{\n+    static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+    {\n+        const auto target{(dbcache_bytes / DEFAULT_KERNEL_CACHE) * DEFAULT_DB_CACHE_BATCH};\n+        return std::max<size_t>(MIN_DB_CACHE_BATCH, std::min<size_t>(MAX_DB_CACHE_BATCH, target));",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "b249239c1747a5425e5161974d2b9c9c5be17dab",
      "in_reply_to_id": 2042530712,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ended up with extracting min/max and adding an assert",
      "created_at": "2025-08-07T00:17:19Z",
      "updated_at": "2025-08-07T00:34:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2258580736",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2258580736"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261690810",
      "pull_request_review_id": 3099124347,
      "id": 2261690810,
      "node_id": "PRRC_kwDOABII586Gzqm6",
      "diff_hunk": "@@ -5,10 +5,25 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <cassert>\n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n+namespace node\n+{\n+static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+{\n+    const auto [min, max]{std::pair{DEFAULT_DB_CACHE_BATCH, 256_MiB}};\n+    assert(min < max); // std::clamp is undefined if `lo` is greater than `hi`",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 6fa584fde601dd8fc966fa2496084203c9503215, min can be equal to max (and perhaps align use of min/max vs lo/hi)\r\n\r\n```suggestion\r\n    assert(min <= max); // std::clamp is undefined if `min` is greater than `max`\r\n```",
      "created_at": "2025-08-08T00:24:23Z",
      "updated_at": "2025-08-08T00:44:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2261690810",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261690810"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261692629",
      "pull_request_review_id": 3099124347,
      "id": 2261692629,
      "node_id": "PRRC_kwDOABII586GzrDV",
      "diff_hunk": "@@ -16,6 +16,9 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+//! The batch size of DEFAULT_KERNEL_CACHE\n+static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB};\n+",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 6,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 6fa584fde601dd8fc966fa2496084203c9503215, seems it would make sense to place these two together.\r\n\r\n```diff\r\n  //! Suggested default amount of cache reserved for the kernel (bytes)\r\n static constexpr size_t DEFAULT_KERNEL_CACHE{450_MiB};\r\n+//! Batch size of DEFAULT_KERNEL_CACHE\r\n+static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB};\r\n //! Max memory allocated to block tree DB specific cache (bytes)\r\n static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\r\n //! Max memory allocated to coin DB specific cache (bytes)\r\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\r\n \r\n-//! The batch size of DEFAULT_KERNEL_CACHE\r\n-static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB};\r\n-\r\n namespace kernel {\r\n struct CacheSizes {\r\n```",
      "created_at": "2025-08-08T00:25:59Z",
      "updated_at": "2025-08-08T00:42:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2261692629",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261692629"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 21,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261750708",
      "pull_request_review_id": 3099228021,
      "id": 2261750708,
      "node_id": "PRRC_kwDOABII586Gz5O0",
      "diff_hunk": "@@ -5,10 +5,25 @@\n #ifndef BITCOIN_NODE_COINS_VIEW_ARGS_H\n #define BITCOIN_NODE_COINS_VIEW_ARGS_H\n \n+#include <cassert>\n+#include <kernel/caches.h>\n+\n class ArgsManager;\n struct CoinsViewOptions;\n \n-namespace node {\n+namespace node\n+{\n+static constexpr size_t GetDbBatchSize(const size_t dbcache_bytes)\n+{\n+    const auto [min, max]{std::pair{DEFAULT_DB_CACHE_BATCH, 256_MiB}};\n+    assert(min < max); // std::clamp is undefined if `lo` is greater than `hi`",
      "path": "src/node/coins_view_args.h",
      "position": 1,
      "original_position": 16,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2261690810,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "* the `lo` and `hi` refer to the clamp argument names\r\n* if min == max the whole method could be eliminated",
      "created_at": "2025-08-08T01:32:28Z",
      "updated_at": "2025-08-08T01:32:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2261750708",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261750708"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261751607",
      "pull_request_review_id": 3099229024,
      "id": 2261751607,
      "node_id": "PRRC_kwDOABII586Gz5c3",
      "diff_hunk": "@@ -16,6 +16,9 @@ static constexpr size_t MAX_BLOCK_DB_CACHE{2_MiB};\n //! Max memory allocated to coin DB specific cache (bytes)\n static constexpr size_t MAX_COINS_DB_CACHE{8_MiB};\n \n+//! The batch size of DEFAULT_KERNEL_CACHE\n+static constexpr size_t DEFAULT_DB_CACHE_BATCH{16_MiB};\n+",
      "path": "src/kernel/caches.h",
      "position": 1,
      "original_position": 6,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2261692629,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We could, I'll do it next time I push",
      "created_at": "2025-08-08T01:33:25Z",
      "updated_at": "2025-08-08T01:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2261751607",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2261751607"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 21,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277553496",
      "pull_request_review_id": 3121890966,
      "id": 2277553496,
      "node_id": "PRRC_kwDOABII586HwLVY",
      "diff_hunk": "@@ -1085,4 +1085,26 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n }\n \n+BOOST_AUTO_TEST_CASE(db_batch_sizes)\n+{\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\n+\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 19,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: Could motivate the min value:\r\n```suggestion\r\n    static_assert(MIN_DB_CACHE == 4_MiB);\r\n    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);\r\n```",
      "created_at": "2025-08-14T19:34:47Z",
      "updated_at": "2025-08-14T20:02:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2277553496",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277553496"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1093,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277573485",
      "pull_request_review_id": 3121890966,
      "id": 2277573485,
      "node_id": "PRRC_kwDOABII586HwQNt",
      "diff_hunk": "@@ -1085,4 +1085,26 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n }\n \n+BOOST_AUTO_TEST_CASE(db_batch_sizes)\n+{\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\n+\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(100_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(450_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(1000_MiB), 33'554'432);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(2000_MiB), 67'108'864);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(3000_MiB), 100'663'296);\n+\n+#if SIZE_MAX > UINT32_MAX\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4500_MiB), 167'772'160);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(7000_MiB), 251'658'240);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10000_MiB), 268'435'456);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45000_MiB), 268'435'456);\n+#endif\n+}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 34,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Might as well make use of `constexpr`?\r\n```suggestion\r\n// Verify DB batch sizes:\r\nstatic_assert(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE) == DEFAULT_DB_CACHE_BATCH);\r\nstatic_assert(node::GetDbBatchSize(0_MiB) == DEFAULT_DB_CACHE_BATCH);\r\n\r\nstatic_assert(node::GetDbBatchSize(4_MiB) == 16'777'216);\r\nstatic_assert(node::GetDbBatchSize(10_MiB) == 16'777'216);\r\nstatic_assert(node::GetDbBatchSize(45_MiB) == 16'777'216);\r\nstatic_assert(node::GetDbBatchSize(100_MiB) == 16'777'216);\r\nstatic_assert(node::GetDbBatchSize(450_MiB) == 16'777'216);\r\nstatic_assert(node::GetDbBatchSize(1000_MiB) == 33'554'432);\r\nstatic_assert(node::GetDbBatchSize(2000_MiB) == 67'108'864);\r\nstatic_assert(node::GetDbBatchSize(3000_MiB) == 100'663'296);\r\n\r\n#if SIZE_MAX > UINT32_MAX\r\nstatic_assert(node::GetDbBatchSize(4500_MiB) == 167'772'160);\r\nstatic_assert(node::GetDbBatchSize(7000_MiB) == 251'658'240);\r\nstatic_assert(node::GetDbBatchSize(10000_MiB) == 268'435'456);\r\nstatic_assert(node::GetDbBatchSize(45000_MiB) == 268'435'456);\r\n#endif\r\n```",
      "created_at": "2025-08-14T19:45:59Z",
      "updated_at": "2025-08-14T20:02:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2277573485",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277573485"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": 1088,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277581892",
      "pull_request_review_id": 3121890966,
      "id": 2277581892,
      "node_id": "PRRC_kwDOABII586HwSRE",
      "diff_hunk": "@@ -484,7 +485,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: calculated from the `-dbcache` value or %u if not set)\", node::GetDbBatchSize(DEFAULT_DB_CACHE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Curious what made you decide on the current version vs:\r\n```suggestion\r\n    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: calculated from the `-dbcache` value or %u if not set)\", DEFAULT_DB_CACHE_BATCH), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\r\n```\r\n?\r\n\r\nFor the commits I would have leaned towards:\r\n* Only doing the rename + moving the constant (nDefaultDbBatchSize -> DEFAULT_DB_CACHE_BATCH) in the first.\r\n* Introducing `GetDbBatchSize()` and the rest in the second.\r\n\r\nBut if you have a strong preference for using `GetDbBatchSize()` for the default value here that would mean touching the line twice which is annoying.",
      "created_at": "2025-08-14T19:50:31Z",
      "updated_at": "2025-08-14T20:02:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2277581892",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277581892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277737212",
      "pull_request_review_id": 3122138436,
      "id": 2277737212,
      "node_id": "PRRC_kwDOABII586Hw4L8",
      "diff_hunk": "@@ -1085,4 +1085,26 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n }\n \n+BOOST_AUTO_TEST_CASE(db_batch_sizes)\n+{\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\n+\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(100_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(450_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(1000_MiB), 33'554'432);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(2000_MiB), 67'108'864);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(3000_MiB), 100'663'296);\n+\n+#if SIZE_MAX > UINT32_MAX\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4500_MiB), 167'772'160);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(7000_MiB), 251'658'240);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10000_MiB), 268'435'456);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45000_MiB), 268'435'456);\n+#endif\n+}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 34,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2277573485,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm not a fan of compile time tests, they're usually harder to debug, when needed.\r\nAnd these are as fast as they get, we wouldn't be saving any time. So it would be inconsistent with other tests, while being slightly harder to debug and not any faster.\r\nDo you think there's any tangible advantage there?",
      "created_at": "2025-08-14T21:15:24Z",
      "updated_at": "2025-08-14T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2277737212",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277737212"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": 1088,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277740168",
      "pull_request_review_id": 3122142379,
      "id": 2277740168,
      "node_id": "PRRC_kwDOABII586Hw46I",
      "diff_hunk": "@@ -484,7 +485,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n     argsman.AddArg(\"-coinstatsindex\", strprintf(\"Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)\", DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-conf=<file>\", strprintf(\"Specify path to read-only configuration file. Relative paths will be prefixed by datadir location (only useable from command line, not configuration file) (default: %s)\", BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);\n     argsman.AddArg(\"-datadir=<dir>\", \"Specify data directory\", ArgsManager::ALLOW_ANY | ArgsManager::DISALLOW_NEGATION, OptionsCategory::OPTIONS);\n-    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: %u)\", nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);\n+    argsman.AddArg(\"-dbbatchsize\", strprintf(\"Maximum database write batch size in bytes (default: calculated from the `-dbcache` value or %u if not set)\", node::GetDbBatchSize(DEFAULT_DB_CACHE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);",
      "path": "src/init.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2277581892,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This was specifically requested by @jonatack in https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2047759939.\r\nI personally don't really mind either way.",
      "created_at": "2025-08-14T21:17:35Z",
      "updated_at": "2025-08-14T21:17:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2277740168",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2277740168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2282516167",
      "pull_request_review_id": 3128539265,
      "id": 2282516167,
      "node_id": "PRRC_kwDOABII586IDG7H",
      "diff_hunk": "@@ -1085,4 +1085,26 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n }\n \n+BOOST_AUTO_TEST_CASE(db_batch_sizes)\n+{\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\n+\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(100_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(450_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(1000_MiB), 33'554'432);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(2000_MiB), 67'108'864);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(3000_MiB), 100'663'296);\n+\n+#if SIZE_MAX > UINT32_MAX\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4500_MiB), 167'772'160);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(7000_MiB), 251'658'240);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10000_MiB), 268'435'456);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45000_MiB), 268'435'456);\n+#endif\n+}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 34,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2277573485,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I would just default to testing at compile time:\r\n* No need to (re)run ctest/test_bitcoin to exercise checks.\r\n* Only run when compilation unit is (re)built. Not re-run when iterating on test code in other compilation units.\r\n* Inconsistency might push other tests towards being converted to compile time, which I would say is a positive effect.",
      "created_at": "2025-08-18T14:05:12Z",
      "updated_at": "2025-08-25T12:29:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2282516167",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2282516167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": 1088,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298621307",
      "pull_request_review_id": 3152309557,
      "id": 2298621307,
      "node_id": "PRRC_kwDOABII586JAi17",
      "diff_hunk": "@@ -1085,4 +1085,26 @@ BOOST_AUTO_TEST_CASE(coins_resource_is_used)\n     PoolResourceTester::CheckAllDataAccountedFor(resource);\n }\n \n+BOOST_AUTO_TEST_CASE(db_batch_sizes)\n+{\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(DEFAULT_KERNEL_CACHE), DEFAULT_DB_CACHE_BATCH);\n+    BOOST_REQUIRE_EQUAL(node::GetDbBatchSize(0_MiB), DEFAULT_DB_CACHE_BATCH);\n+\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(100_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(450_MiB), 16'777'216);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(1000_MiB), 33'554'432);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(2000_MiB), 67'108'864);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(3000_MiB), 100'663'296);\n+\n+#if SIZE_MAX > UINT32_MAX\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(4500_MiB), 167'772'160);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(7000_MiB), 251'658'240);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(10000_MiB), 268'435'456);\n+    BOOST_CHECK_EQUAL(node::GetDbBatchSize(45000_MiB), 268'435'456);\n+#endif\n+}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 34,
      "commit_id": "b6f8c48946cbfceb066de660c485ae1bd2c27cc1",
      "original_commit_id": "956a6b454704120ba4c482d7157db89c20130e75",
      "in_reply_to_id": 2277573485,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "These are extremely fast tests, keeping the usual test format has more advantages in my opinion.\r\nIf you have a string preference or if other reviewers prefer that, I don't mind changing, but I don't think the current one has measurable disadvantages compared to the suggestion - while being more in-line with how we usually test, making `GetDbBatchSize` easily debuggable (often helps with understanding if you can step through it).",
      "created_at": "2025-08-25T16:56:28Z",
      "updated_at": "2025-08-25T16:56:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31645#discussion_r2298621307",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298621307"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31645"
        }
      },
      "start_line": null,
      "original_start_line": 1088,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1108,
      "side": "RIGHT"
    }
  ]
}
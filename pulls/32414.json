{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414",
    "id": 2496849559,
    "node_id": "PR_kwDOABII586U0uaX",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32414",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32414.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32414.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/c1e554d3e5834a140f2a53854018499a3bfe6822",
    "number": 32414,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: periodically flush dbcache during reindex-chainstate",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "After #30611 we periodically do a non-erasing flush of the dbcache to disk roughly every hour during IBD.\r\nThe intention was to also do this periodic flush during reindex-chainstate, so we would not risk losing progress during a system failure when reindexing with a high dbcache value.\r\n\r\nIt was discovered that reindex-chainstate does not perform a PERIODIC flush until it has already reached the tip. Since reindexing to tip usually happens within 24 hours, this behaviour was unnoticed with the previous periodic flush interval. Note that reindex-chainstate still does IF_NEEDED flushes during `ConnectBlock`, so this also would not be noticed when running with a lower dbcache value.\r\n\r\nThis patch moves the PERIODIC flush from after the outer loop in `ActivateBestChain` to inside the outer loop after we release `cs_main`. This will periodically flush during IBD, reindex-chainstate, and steady state.",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2025-05-03T12:55:59Z",
    "updated_at": "2025-10-25T03:49:59Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "2e9e15caffa818f4fd43db244eb1203989403bce",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:reindex-flush",
      "ref": "reindex-flush",
      "sha": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 287684,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-24T21:36:24Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38073,
        "stargazers_count": 86391,
        "watchers_count": 86391,
        "size": 295240,
        "default_branch": "master",
        "open_issues_count": 741,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-24T20:25:13Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-25T01:34:57Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 75,
    "deletions": 13,
    "changed_files": 2,
    "commits": 3,
    "review_comments": 25,
    "comments": 10
  },
  "events": [
    {
      "event": "commented",
      "id": 2848616859,
      "node_id": "IC_kwDOABII586pynGb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2848616859",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:56:03Z",
      "updated_at": "2025-10-25T03:49:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32414.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2872303093) |\n| Concept ACK | [shahsb](https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813733894) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2848616859",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "labeled",
      "id": 17507760415,
      "node_id": "LE_lADOABII5861CvchzwAAAAQTizkf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17507760415",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:56:09Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 2848617247,
      "node_id": "IC_kwDOABII586pynMf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2848617247",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:57:20Z",
      "updated_at": "2025-05-03T12:57:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks to @l0rinc for discovering this behaviour, and @mzumsande for the suggested fix.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2848617247",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "mentioned",
      "id": 17507762927,
      "node_id": "MEE_lADOABII5861CvchzwAAAAQTi0Lv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17507762927",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:57:22Z"
    },
    {
      "event": "subscribed",
      "id": 17507762932,
      "node_id": "SE_lADOABII5861CvchzwAAAAQTi0L0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17507762932",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:57:22Z"
    },
    {
      "event": "mentioned",
      "id": 17507762935,
      "node_id": "MEE_lADOABII5861CvchzwAAAAQTi0L3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17507762935",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:57:22Z"
    },
    {
      "event": "subscribed",
      "id": 17507762938,
      "node_id": "SE_lADOABII5861CvchzwAAAAQTi0L6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17507762938",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T12:57:22Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17508059163,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTj8gb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17508059163",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "created_at": "2025-05-03T15:18:49Z"
    },
    {
      "event": "reviewed",
      "id": 2813262035,
      "node_id": "PRR_kwDOABII586nrvjT",
      "url": null,
      "actor": null,
      "commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-03T16:20:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'm verifying is this fixes things or not, whether it slows down anything - or if it changes caching behavior in any other way.\r\n\r\nRegardless, I think we should cover this with a test - do you think we could extend e.g. https://github.com/bitcoin/bitcoin/blob/master/test/functional/feature_reindex.py with an `assert_debug_log` checking the periodic write logs of https://github.com/bitcoin/bitcoin/pull/32404?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813262035",
      "submitted_at": "2025-05-03T16:20:29Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
    },
    {
      "event": "commented",
      "id": 2848739902,
      "node_id": "IC_kwDOABII586pzFI-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2848739902",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T18:07:00Z",
      "updated_at": "2025-05-03T18:07:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "I can confirm that this fixes the periodic flushes for `-reindex-chainstate`:\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```\r\ncat debug-7fc8d7f9c1f0fe3795b397327e38465ee6f76b83-1746277780.log | grep FlushStateToDisk\r\n2025-05-03T14:14:56Z [coindb] FlushStateToDisk write: flush mode=PERIODIC, prune=0, cache_large=0, cache_critical=0, periodic=1\r\n2025-05-03T15:16:31Z [coindb] FlushStateToDisk write: flush mode=PERIODIC, prune=0, cache_large=0, cache_critical=0, periodic=1\r\n2025-05-03T16:16:31Z [coindb] FlushStateToDisk write: flush mode=PERIODIC, prune=0, cache_large=0, cache_critical=0, periodic=1\r\n2025-05-03T16:36:48Z [coindb] FlushStateToDisk write: flush mode=ALWAYS, prune=0, cache_large=0, cache_critical=0, periodic=0\r\n2025-05-03T16:39:20Z [coindb] FlushStateToDisk write: flush mode=ALWAYS, prune=0, cache_large=0, cache_critical=0, periodic=0\r\n```\r\n\r\n</details>\r\n\r\n![height_vs_time](https://github.com/user-attachments/assets/36076de9-44a9-4dd5-96bd-3a6152e68aee)\r\n![cache_vs_time](https://github.com/user-attachments/assets/536494bb-8397-41d1-b371-570214583d7f)\r\n\r\n\r\n----\r\n\r\nNit: is this comment still accurate? https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2782 Guess it just refers to the size based trigger, not the time based - which is probably fine given its small context.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2848739902",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "reviewed",
      "id": 2813302067,
      "node_id": "PRR_kwDOABII586nr5Uz",
      "url": null,
      "actor": null,
      "commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-03T20:40:07Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813302067",
      "submitted_at": "2025-05-03T20:40:07Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
    },
    {
      "event": "labeled",
      "id": 17508927841,
      "node_id": "LE_lADOABII5861CvchzwAAAAQTnQlh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17508927841",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T23:33:52Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2848858157,
      "node_id": "IC_kwDOABII586pziAt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2848858157",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T23:33:54Z",
      "updated_at": "2025-05-03T23:33:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/41595509701</sub>\n<sub>LLM reason (✨ experimental): The CI failure is caused by a trailing whitespace error detected during the lint check.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2848858157",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17508929612,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTnRBM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17508929612",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "0f089bd64116ad45b35aba0a38a2f131f01253ed",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/0f089bd64116ad45b35aba0a38a2f131f01253ed",
      "created_at": "2025-05-03T23:35:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17508936717,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTnSwN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17508936717",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "da4090eedf8aea5d4d05bb51c6325e4291209f1a",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/da4090eedf8aea5d4d05bb51c6325e4291209f1a",
      "created_at": "2025-05-03T23:40:06Z"
    },
    {
      "event": "commented",
      "id": 2848863531,
      "node_id": "IC_kwDOABII586pzjUr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2848863531",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T23:55:19Z",
      "updated_at": "2025-05-03T23:56:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "> is this comment still accurate? https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2782 Guess it just refers to the size based trigger, not the time based - which is probably fine given its small context.\r\n\r\nI think it's still accurate, and #30611 doesn't make it stale. I think the comment https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L2861 describes the behavior.\r\n\r\n> Regardless, I think we should cover this with a test - do you think we could extend e.g. https://github.com/bitcoin/bitcoin/blob/master/test/functional/feature_reindex.py with an assert_debug_log checking the periodic write logs of https://github.com/bitcoin/bitcoin/pull/32404?\r\n\r\nHmm I was wondering if we could do something with mocktime and validation interface to confirm it flushes. ",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2848863531",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "closed",
      "id": 17508955171,
      "node_id": "CE_lADOABII5861CvchzwAAAAQTnXQj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17508955171",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-03T23:55:19Z"
    },
    {
      "event": "commented",
      "id": 2849074101,
      "node_id": "IC_kwDOABII586p0Wu1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2849074101",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-04T08:12:59Z",
      "updated_at": "2025-05-04T08:12:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "You didn't mean to close it, right?\r\n\r\n------\r\n\r\nI can confirm that this change retains the flushing behavior during IBD as well as far as I can tell from the plots:\r\n![height_vs_time](https://github.com/user-attachments/assets/1998e3fe-6fbb-460e-9739-87cde10f9e4e)\r\n\r\n![cache_coins_vs_time](https://github.com/user-attachments/assets/b657672e-1ecc-4083-b8ae-a7684b145201)\r\n\r\n---\r\n\r\n\r\nI'll compare the `reindex-chainstate` performance next, before & after, let's see if there's a regression (we do expect a 4% slowdown for max cache, like in IBD).\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2849074101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "reopened",
      "id": 17510587334,
      "node_id": "REE_lADOABII5861CvchzwAAAAQTtlvG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17510587334",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-04T14:07:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17510587885,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTtl3t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17510587885",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "created_at": "2025-05-04T14:08:09Z"
    },
    {
      "event": "unlabeled",
      "id": 17510743600,
      "node_id": "UNLE_lADOABII5861CvchzwAAAAQTuL4w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17510743600",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-04T15:11:48Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg0ODIwNTYxZGNiMmQxNTZkMWExMTUxYTQ4MGZjMWJlNjY0OWNhZTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84820561dcb2d156d1a1151a480fc1be6649cae4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/84820561dcb2d156d1a1151a480fc1be6649cae4",
      "tree": {
        "sha": "03a066b6b0cb810a61e1febe0bfe424fe75a303d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/03a066b6b0cb810a61e1febe0bfe424fe75a303d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
          "sha": "eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eba5f9c4b63fe46261fbb3e71b9a94832d105b23"
        }
      ],
      "message": "validation: periodically flush dbcache during reindex-chainstate\n\nMove the periodic flush inside the outer loop of ActivateBestChain.\nFor very long activations, such as with reindex-chainstate, this\ncalls periodic flushes so progress can be saved to disk.\n\nCo-Authored-By: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-04T17:23:14Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-03T12:41:02Z"
      },
      "sha": "84820561dcb2d156d1a1151a480fc1be6649cae4"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17511073672,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTvceI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17511073672",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e4fbf33c05ac614bc6195f3331b9efd68f032c0d",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/e4fbf33c05ac614bc6195f3331b9efd68f032c0d",
      "created_at": "2025-05-04T17:35:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17511084085,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTvfA1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17511084085",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "created_at": "2025-05-04T17:40:11Z"
    },
    {
      "event": "reviewed",
      "id": 2813522966,
      "node_id": "PRR_kwDOABII586nsvQW",
      "url": null,
      "actor": null,
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-04T18:22:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nThanks for fixing it!\r\nI need a bit mor explanation to be able to fully ack",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813522966",
      "submitted_at": "2025-05-04T18:22:21Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQxNDc5ZWQxZDIzZWE3NTJkMGNlMTRjMmNmNTYyN2Y0M2JjZWI3MjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/41479ed1d23ea752d0ce14c2cf5627f43bceb722",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/41479ed1d23ea752d0ce14c2cf5627f43bceb722",
      "tree": {
        "sha": "55b4c0ca7993bb50d99c37fb36b6e734bf2f164f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/55b4c0ca7993bb50d99c37fb36b6e734bf2f164f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84820561dcb2d156d1a1151a480fc1be6649cae4",
          "sha": "84820561dcb2d156d1a1151a480fc1be6649cae4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/84820561dcb2d156d1a1151a480fc1be6649cae4"
        }
      ],
      "message": "test: add test for periodic flush inside ActivateBestChain",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-04T19:00:50Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-04T17:34:29Z"
      },
      "sha": "41479ed1d23ea752d0ce14c2cf5627f43bceb722"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMxZTU1NGQzZTU4MzRhMTQwZjJhNTM4NTQwMTg0OTlhM2JmZTY4MjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c1e554d3e5834a140f2a53854018499a3bfe6822",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c1e554d3e5834a140f2a53854018499a3bfe6822",
      "tree": {
        "sha": "c6359bc4a970a544cb9fc56725e622249fed2aae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c6359bc4a970a544cb9fc56725e622249fed2aae"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/41479ed1d23ea752d0ce14c2cf5627f43bceb722",
          "sha": "41479ed1d23ea752d0ce14c2cf5627f43bceb722",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/41479ed1d23ea752d0ce14c2cf5627f43bceb722"
        }
      ],
      "message": "refactor: consolidate 3 separate locks into one block\n\nThe main lock needs to be taken 3 separate times.\nIt simplifies readability to take it once, and is more efficient.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-04T19:00:50Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-05-04T17:35:29Z"
      },
      "sha": "c1e554d3e5834a140f2a53854018499a3bfe6822"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17511260073,
      "node_id": "HRFPE_lADOABII5861CvchzwAAAAQTwJ-p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17511260073",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/c1e554d3e5834a140f2a53854018499a3bfe6822",
      "created_at": "2025-05-04T19:01:01Z"
    },
    {
      "event": "reviewed",
      "id": 2813539202,
      "node_id": "PRR_kwDOABII586nszOC",
      "url": null,
      "actor": null,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-04T19:15:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK - I'm still running the reindex / IBD benchmarks to see if this changed anything unexpected.\r\n\r\nDo you think I should stop and restart after the locking changes?\r\n\r\n<details>\r\n<summary>nits</summary>\r\n\r\n```patch\r\ndiff --git a/src/test/chainstate_write_tests.cpp b/src/test/chainstate_write_tests.cpp\r\nindex e1b82ebc12..44257d5591 100644\r\n--- a/src/test/chainstate_write_tests.cpp\r\n+++ b/src/test/chainstate_write_tests.cpp\r\n@@ -16,7 +16,8 @@ BOOST_AUTO_TEST_SUITE(chainstate_write_tests)\r\n \r\n BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\r\n {\r\n-    struct TestSubscriber final : CValidationInterface {\r\n+    struct TestSubscriber final : CValidationInterface\r\n+    {\r\n         bool m_did_flush{false};\r\n         void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\r\n         {\r\n@@ -34,13 +35,12 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\r\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\r\n     BOOST_CHECK(!sub->m_did_flush);\r\n \r\n-    // The periodic flush interval is between 50 and 70 minutes (inclusive)\r\n-    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MIN - 1min);\r\n+    SetMockTime(GetMockTime() + DATABASE_WRITE_INTERVAL_MIN - 1min);\r\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\r\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\r\n     BOOST_CHECK(!sub->m_did_flush);\r\n \r\n-    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MAX);\r\n+    SetMockTime(GetMockTime() + DATABASE_WRITE_INTERVAL_MAX);\r\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\r\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\r\n     BOOST_CHECK(sub->m_did_flush);\r\n@@ -59,7 +59,8 @@ BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\r\n         {\r\n             m_flushed_at_block = m_tip;\r\n         }\r\n-        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\r\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override\r\n+        {\r\n             m_tip = block_index;\r\n         }\r\n     };\r\n@@ -82,7 +83,6 @@ BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\r\n     // Set m_next_write to current time\r\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\r\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\r\n-    // The periodic flush interval is between 50 and 70 minutes (inclusive)\r\n     // The next call to a PERIODIC write will flush\r\n     SetMockTime(GetMockTime() + DATABASE_WRITE_INTERVAL_MAX);\r\n ```\r\n\r\n</details>",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813539202",
      "submitted_at": "2025-05-04T19:15:35Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
    },
    {
      "event": "reviewed",
      "id": 2813733894,
      "node_id": "PRR_kwDOABII586ntiwG",
      "url": null,
      "actor": null,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-05T03:11:46Z",
      "author_association": "NONE",
      "body": "Concept ACK",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#pullrequestreview-2813733894",
      "submitted_at": "2025-05-05T03:11:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
    },
    {
      "event": "commented",
      "id": 2854283411,
      "node_id": "IC_kwDOABII586qIOiT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2854283411",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-06T11:49:56Z",
      "updated_at": "2025-05-06T11:49:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "Finished measuring `reindex-chainstate` performance for max dbcache (best case scenario), where this PR shines most (i.e. to avoid the worst-case scenario of doing everything in-memory and crashing at the end without anything saved).\r\n\r\nMeasured it on an HDD with i7 processor, so disk writes are expensive here - would likely be better on SSD.\r\nUnfortunately this change results in a 11% slowdown for scenarios that were hoarding memory, since it has to flush intermediary results regularly, so the invalidations happen on disk now instead of in-memory.\r\n\r\n<details>\r\n<summary>Benchmark</summary>\r\n\r\n```bash\r\nCOMMITS=\"eba5f9c4b63fe46261fbb3e71b9a94832d105b23 b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0\"; \\                                \r\nSTOP_HEIGHT=888888; DBCACHE=45000; \\                                                                                                                                                      \r\nCC=gcc; CXX=g++; \\                                                                                                                                                                        \r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\                                                                                                 \r\n(echo \"\"; for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done; echo \"\") && \\                                                            \r\nhyperfine \\                                                                                                                                                                               \r\n  --sort 'command' \\                                                                                                                                                                      \r\n  --runs 2 \\                                                                                                                                                                              \r\n  --export-json \"$BASE_DIR/rdx-${COMMITS// /-}-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\                                                                                                          \r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=5000 -printtoconsole=0; sleep 100\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=$DBCACHE\"\r\n```\r\n\r\n> eba5f9c4b6 Merge bitcoin/bitcoin#32403: test: remove Boost SIGCHLD workaround.\r\n> b56a7e2e98 validation: periodically flush dbcache during reindex-chainstate\r\n\r\n```python\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = eba5f9c4b63fe46261fbb3e71b9a94832d105b23) \r\n  Time (mean ± σ):     22404.449 s ± 77.811 s    [User: 20909.449 s, System: 563.985 s]\r\n  Range (min … max):   22349.428 s … 22459.469 s    2 runs\r\n  \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0) \r\n  Time (mean ± σ):     24821.312 s ± 19.392 s    [User: 22218.160 s, System: 746.676 s]\r\n  Range (min … max):   24807.600 s … 24835.024 s    2 runs\r\n```\r\n\r\n```python\r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = eba5f9c4b63fe46261fbb3e71b9a94832d105b23)\r\n        1.11 ±  0.00  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0)\r\n```\r\n\r\n</details>\r\n\r\nIt's unfortunate to lose this much performance, as suggested before, maybe the change from 24 hours to 1 hour was too big - what if we tried an average of 100 minutes instead?\r\n\r\nWill measure IBD with latest changes now.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2854283411",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "commented",
      "id": 2855056187,
      "node_id": "IC_kwDOABII586qLLM7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2855056187",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-06T15:38:04Z",
      "updated_at": "2025-05-06T15:38:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It's unfortunate to lose this much performance, as suggested before, maybe the change from 24 hours to 1 hour was too big - what if we tried an average of 100 minutes instead?\r\n\r\nI'm not sure it's worth bike shedding over the amount of time to periodically flush. The difference with an HDD is 6 hours 13 minutes vs 6 hours 53 minutes. So we could be saving a maximum of 40 minutes over something that takes over 6 hours anyways.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2855056187",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "commented",
      "id": 2857833155,
      "node_id": "IC_kwDOABII586qVxLD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2857833155",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T09:24:55Z",
      "updated_at": "2025-05-07T09:24:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I'll compare the reindex-chainstate performance next, before & after, let's see if there's a regression (we do expect a 4% slowdown for max cache, like in IBD).\r\n\r\nIBD seems to be basically the same as before, this change indeed only affects `reindex-chainstate`.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```bash\r\nCOMMITS=\"baa848b8d38187ce6b24a57cfadf1ea180209711 c822dd1f355b6f403191072cdd3c9c3e234bbcaa\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=45000; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 1 \\\r\n  --export-json \"$BASE_DIR/ibd-${COMMITS// /-}-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -rf $DATA_DIR/*; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -blocksonly -printtoconsole=0 -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE\"\r\n```\r\n\r\n> baa848b8d3 Merge bitcoin/bitcoin#32405: build: replace header checks with `__has_include`\r\n> c822dd1f35 refactor: consolidate 3 separate locks into one block\r\n\r\n```python\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -blocksonly -printtoconsole=0 -stopatheight=888888 -dbcache=45000 (COMMIT = baa848b8d38187ce6b24a57cfadf1ea180209711)\r\n  Time (abs ≡):        38323.520 s               [User: 36485.235 s, System: 2391.492 s]\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -blocksonly -printtoconsole=0 -stopatheight=888888 -dbcache=45000 (COMMIT = c822dd1f355b6f403191072cdd3c9c3e234bbcaa)\r\n  Time (abs ≡):        38063.544 s               [User: 35628.341 s, System: 1952.398 s]\r\n```\r\n\r\n```python \r\nRelative speed comparison\r\n        1.01          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -blocksonly -printtoconsole=0 -stopatheight=888888 -dbcache=45000 (COMMIT = baa848b8d38187ce6b24a57cfadf1ea180209711)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -blocksonly -printtoconsole=0 -stopatheight=888888 -dbcache=45000 (COMMIT = c822dd1f355b6f403191072cdd3c9c3e234bbcaa)\r\n```\r\n\r\n</details>\r\n\r\n> So we could be saving a maximum of 40 minutes\r\n\r\nYes, it's a significant difference. I'll retry it with 100 minutes to see if it would fix the situation.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2857833155",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "commented",
      "id": 2872303093,
      "node_id": "IC_kwDOABII586rM931",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2872303093",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-12T12:07:57Z",
      "updated_at": "2025-05-12T12:07:57Z",
      "author_association": "CONTRIBUTOR",
      "body": ">  I'll retry it with 100 minutes to see if it would fix the situation.\r\n\r\nWith 100 mins it's **7%** slower instead of **11%** - still quite bad, but we shouldn't have to choose between performance and persistence, so let's find ways to reduce that. And IBD is the usecase that matters most anyway.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```bash\r\nCOMMITS=\"59d3e4ed34eb55cb40928d524cb0bd5e183ed85a cf75a7b599fe459935b7aa4776e91526fcfb0fcc\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=45000; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 2 \\\r\n  --export-json \"$BASE_DIR/rdx-${COMMITS// /-}-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=5000 -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=$DBCACHE\"\r\n````\r\n\r\n> 59d3e4ed34 Merge bitcoin/bitcoin#32415: scripted-diff: adapt script error constant names in feature_taproot.py\r\n> cf75a7b599 DATABASE_WRITE_INTERVAL ~100min\r\n\r\n```python\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = 59d3e4ed34eb55cb40928d524cb0bd5e183ed85a)\r\n  Time (mean ± σ):     22098.816 s ±  5.810 s    [User: 20814.326 s, System: 557.473 s]\r\n  Range (min … max):   22094.707 s … 22102.924 s    2 runs\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = cf75a7b599fe459935b7aa4776e91526fcfb0fcc)\r\n  Time (mean ± σ):     23737.633 s ± 159.720 s    [User: 21704.678 s, System: 682.595 s]\r\n  Range (min … max):   23624.694 s … 23850.572 s    2 runs\r\n```\r\n\r\n```python\r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = 59d3e4ed34eb55cb40928d524cb0bd5e183ed85a)\r\n        1.07 ±  0.01  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 -dbcache=45000 (COMMIT = cf75a7b599fe459935b7aa4776e91526fcfb0fcc)\r\n```\r\n\r\n</details>\r\n\r\nACK c1e554d3e5834a140f2a53854018499a3bfe6822\r\n\r\nNit: I'd squash the first two commits, they should be split by features, not by files.\r\nThe test demonstrates the need for the solution, it's weird to have the answer first, followed by the question.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#issuecomment-2872303093",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32414"
    },
    {
      "event": "review_requested",
      "id": 17615388527,
      "node_id": "RRE_lADOABII5861CvchzwAAAAQZ9X9v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17615388527",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-12T12:08:02Z",
      "requested_reviewer": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "referenced",
      "id": 18009947741,
      "node_id": "REFE_lADOABII5861CvchzwAAAAQxef5d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18009947741",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ac7c0590ef1b611ffd97e1893bbaf8d7a792108d",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/ac7c0590ef1b611ffd97e1893bbaf8d7a792108d",
      "created_at": "2025-06-05T20:52:57Z"
    },
    {
      "event": "referenced",
      "id": 18009947765,
      "node_id": "REFE_lADOABII5861CvchzwAAAAQxef51",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18009947765",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "52f71e12d46da98cc5639bce1dbdcd3aa2f0e5fd",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/52f71e12d46da98cc5639bce1dbdcd3aa2f0e5fd",
      "created_at": "2025-06-05T20:52:57Z"
    },
    {
      "event": "review_requested",
      "id": 18928036815,
      "node_id": "RRE_lADOABII5861CvchzwAAAARoMuvP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18928036815",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T22:57:54Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_request_removed",
      "id": 18928168626,
      "node_id": "RRRE_lADOABII5861CvchzwAAAARoNO6y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18928168626",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T23:13:10Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_request_removed",
      "id": 18928168645,
      "node_id": "RRRE_lADOABII5861CvchzwAAAARoNO7F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18928168645",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T23:13:10Z",
      "requested_reviewer": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 20433208207,
      "node_id": "RRE_lADOABII5861CvchzwAAAATB6gOP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20433208207",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-22T14:46:43Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 20433208253,
      "node_id": "RRE_lADOABII5861CvchzwAAAATB6gO9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20433208253",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-22T14:46:43Z",
      "requested_reviewer": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 20433209214,
      "node_id": "RRE_lADOABII5861CvchzwAAAATB6gd-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20433209214",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-22T14:46:46Z",
      "requested_reviewer": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "referenced",
      "id": 20492985067,
      "node_id": "REFE_lADOABII5861CvchzwAAAATFeiLr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20492985067",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f54ffb4bc141ffcc6fffe574edbcbbb21f001476",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f54ffb4bc141ffcc6fffe574edbcbbb21f001476",
      "created_at": "2025-10-24T20:25:14Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072462850",
      "pull_request_review_id": 2813302067,
      "id": 2072462850,
      "node_id": "PRRC_kwDOABII5857h0YC",
      "diff_hunk": "@@ -3587,15 +3587,15 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         // caused an assert() failure during interrupt in such cases as the UTXO DB flushing checks\n         // that the best block hash is non-null.\n         if (m_chainman.m_interrupt) break;\n+\n+        // Write changes periodically to disk, after relay.\n+        if (!FlushStateToDisk(state, FlushStateMode::PERIODIC)) {",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Previously we didn't flush before calling `CheckBlockIndex`, but I don't think that would degrade the usefulness of the check. I am not sure though about taking the lock here again. If I read this right the lock is taken three times now on every iteration of the loop with little work being done in between. Might it be useful to consolidate these?",
      "created_at": "2025-05-03T20:40:07Z",
      "updated_at": "2025-05-03T20:40:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072462850",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072462850"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3592,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072482783",
      "pull_request_review_id": 2813320087,
      "id": 2072482783,
      "node_id": "PRRC_kwDOABII5857h5Pf",
      "diff_hunk": "@@ -3587,15 +3587,15 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         // caused an assert() failure during interrupt in such cases as the UTXO DB flushing checks\n         // that the best block hash is non-null.\n         if (m_chainman.m_interrupt) break;\n+\n+        // Write changes periodically to disk, after relay.\n+        if (!FlushStateToDisk(state, FlushStateMode::PERIODIC)) {",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "in_reply_to_id": 2072462850,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Previously we didn't flush before calling `CheckBlockIndex`\r\n\r\nWe do flush for every block via `ActivateBestChain` -> `ActivateBestChainStep` -> `ConnectTip` -> `FlushStateToDisk`. However, it is only flushed `IF_NEEDED`, and here we do it `PERIODIC`.\r\n",
      "created_at": "2025-05-03T23:21:55Z",
      "updated_at": "2025-05-03T23:21:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072482783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072482783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3592,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072484132",
      "pull_request_review_id": 2813321012,
      "id": 2072484132,
      "node_id": "PRRC_kwDOABII5857h5kk",
      "diff_hunk": "@@ -3587,15 +3587,15 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         // caused an assert() failure during interrupt in such cases as the UTXO DB flushing checks\n         // that the best block hash is non-null.\n         if (m_chainman.m_interrupt) break;\n+\n+        // Write changes periodically to disk, after relay.\n+        if (!FlushStateToDisk(state, FlushStateMode::PERIODIC)) {",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "in_reply_to_id": 2072462850,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> If I read this right the lock is taken three times now on every iteration of the loop with little work being done in between. Might it be useful to consolidate these?\r\n\r\nNot a bad idea. How does da4090eedf8aea5d4d05bb51c6325e4291209f1a look?",
      "created_at": "2025-05-03T23:32:23Z",
      "updated_at": "2025-05-03T23:40:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072484132",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072484132"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3592,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072487540",
      "pull_request_review_id": 2813324099,
      "id": 2072487540,
      "node_id": "PRRC_kwDOABII5857h6Z0",
      "diff_hunk": "@@ -3587,15 +3587,15 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         // caused an assert() failure during interrupt in such cases as the UTXO DB flushing checks\n         // that the best block hash is non-null.\n         if (m_chainman.m_interrupt) break;\n+\n+        // Write changes periodically to disk, after relay.\n+        if (!FlushStateToDisk(state, FlushStateMode::PERIODIC)) {",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "in_reply_to_id": 2072462850,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Actually we can't do that because the lock can't be held for `m_chainman.snapshot_download_completed();` :/.",
      "created_at": "2025-05-04T00:05:06Z",
      "updated_at": "2025-05-04T00:05:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072487540",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072487540"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3592,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072670546",
      "pull_request_review_id": 2813522966,
      "id": 2072670546,
      "node_id": "PRRC_kwDOABII5857inFS",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "moving `DATABASE_WRITE_INTERVAL_MAX` to the header might be overkill for this, but now that we're repeating it here in multiple tests, consider adding a copy to this file as well.\r\n\r\nNit: I've renamed it to `DB_WRITE_INTERVAL_MAX` in https://github.com/bitcoin/bitcoin/pull/32404/commits/d415f242a6f45229543fabe81d5a6b8b4234c9a6#diff-97c3a52bc5fad452d82670a7fd291800bae20c7bc35bb82686c2c0a4ea7b5b98R98",
      "created_at": "2025-05-04T17:40:39Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072670546",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072670546"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072674552",
      "pull_request_review_id": 2813522966,
      "id": 2072674552,
      "node_id": "PRRC_kwDOABII5857ioD4",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);\n+\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+\n+    // ActivateBestChain back to tip\n+    chainstate.ActivateBestChain(state_dummy, nullptr);\n+    BOOST_CHECK(tip == chainstate.m_chain.Tip());",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n    BOOST_CHECK_EQUAL(tip, chainstate.m_chain.Tip());\r\n```\r\n\r\n(and a few others, though displaying the pointer values isn't very useful, unless one of the is a `nullptr`)",
      "created_at": "2025-05-04T18:02:23Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072674552",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072674552"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072674865",
      "pull_request_review_id": 2813522966,
      "id": 2072674865,
      "node_id": "PRRC_kwDOABII5857ioIx",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "After we've initialized the mock time we might as well use that as the basis (it also gets rid of the type hint):\r\n```suggestion\r\n    SetMockTime(GetMockTime() + 70min);\r\n```",
      "created_at": "2025-05-04T18:04:36Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072674865",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072674865"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072675369",
      "pull_request_review_id": 2813522966,
      "id": 2072675369,
      "node_id": "PRRC_kwDOABII5857ioQp",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit - [developer notes suggests](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md?plain=1#L70-L71) to put the braces to new lines:\r\n```md\r\n  - Braces on new lines for classes, functions, methods.\r\n```",
      "created_at": "2025-05-04T18:07:57Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072675369",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072675369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072675975",
      "pull_request_review_id": 2813522966,
      "id": 2072675975,
      "node_id": "PRRC_kwDOABII5857ioaH",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);\n+\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+\n+    // ActivateBestChain back to tip\n+    chainstate.ActivateBestChain(state_dummy, nullptr);\n+    BOOST_CHECK(tip == chainstate.m_chain.Tip());\n+    // Check that we flushed inside ActivateBestChain while we were at the\n+    // second block from tip, since FlushStateToDisk is called with PERIODIC\n+    // inside the outer loop.\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    BOOST_CHECK(sub->m_flushed_at_block == second_from_tip);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 55,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "👍 I can confirm that this passes after the PR and fails without the PERIODIC flushing moved inside the loop",
      "created_at": "2025-05-04T18:11:44Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072675975",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072675975"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072676586",
      "pull_request_review_id": 2813522966,
      "id": 2072676586,
      "node_id": "PRRC_kwDOABII5857iojq",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 30,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "My understanding this is equivalent to:\r\n```suggestion\r\n        LOCK2(m_node.chainman->GetMutex(), chainstate.MempoolMutex());\r\n```",
      "created_at": "2025-05-04T18:15:43Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072676586",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072676586"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": 70,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072677126",
      "pull_request_review_id": 2813522966,
      "id": 2072677126,
      "node_id": "PRRC_kwDOABII5857iosG",
      "diff_hunk": "",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "original_commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can you please explain where the 3 separate locks were that we're replacing (I only see 2, but don't yet have experience with how we're locking exactly)?",
      "created_at": "2025-05-04T18:19:19Z",
      "updated_at": "2025-05-04T18:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072677126",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072677126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072678126",
      "pull_request_review_id": 2813530996,
      "id": 2072678126,
      "node_id": "PRRC_kwDOABII5857io7u",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072675369,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What about structs?",
      "created_at": "2025-05-04T18:23:56Z",
      "updated_at": "2025-05-04T18:23:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072678126",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072678126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072683803",
      "pull_request_review_id": 2813536793,
      "id": 2072683803,
      "node_id": "PRRC_kwDOABII5857iqUb",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072675369,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`AfterStruct` seems to fall back to `AfterClass` if unspecified https://github.com/bitcoin/bitcoin/blob/master/src/.clang-format#L19",
      "created_at": "2025-05-04T18:51:27Z",
      "updated_at": "2025-05-04T18:51:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072683803",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072683803"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072685646",
      "pull_request_review_id": 2813538321,
      "id": 2072685646,
      "node_id": "PRRC_kwDOABII5857iqxO",
      "diff_hunk": "",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "original_commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "in_reply_to_id": 2072677126,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "1. https://github.com/bitcoin/bitcoin/pull/32414/files#diff-97c3a52bc5fad452d82670a7fd291800bae20c7bc35bb82686c2c0a4ea7b5b98L3566\r\n2. https://github.com/bitcoin/bitcoin/pull/32414/files#diff-97c3a52bc5fad452d82670a7fd291800bae20c7bc35bb82686c2c0a4ea7b5b98L3570\r\n3. FlushStateToDisk",
      "created_at": "2025-05-04T18:59:37Z",
      "updated_at": "2025-05-04T18:59:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072685646",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072685646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072685989",
      "pull_request_review_id": 2813538634,
      "id": 2072685989,
      "node_id": "PRRC_kwDOABII5857iq2l",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072674865,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-05-04T19:01:07Z",
      "updated_at": "2025-05-04T19:01:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072685989",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072685989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686009",
      "pull_request_review_id": 2813538664,
      "id": 2072686009,
      "node_id": "PRRC_kwDOABII5857iq25",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 30,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072676586,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-05-04T19:01:17Z",
      "updated_at": "2025-05-04T19:01:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686009",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686009"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": 70,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686020",
      "pull_request_review_id": 2813538682,
      "id": 2072686020,
      "node_id": "PRRC_kwDOABII5857iq3E",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072675369,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-05-04T19:01:26Z",
      "updated_at": "2025-05-04T19:01:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686020",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686020"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686031",
      "pull_request_review_id": 2813538698,
      "id": 2072686031,
      "node_id": "PRRC_kwDOABII5857iq3P",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);\n+\n+    const auto sub{std::make_shared<TestSubscriber>()};\n+    m_node.validation_signals->RegisterSharedValidationInterface(sub);\n+\n+    // ActivateBestChain back to tip\n+    chainstate.ActivateBestChain(state_dummy, nullptr);\n+    BOOST_CHECK(tip == chainstate.m_chain.Tip());",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072674552,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-05-04T19:01:34Z",
      "updated_at": "2025-05-04T19:01:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686031",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686031"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686068",
      "pull_request_review_id": 2813538719,
      "id": 2072686068,
      "node_id": "PRRC_kwDOABII5857iq30",
      "diff_hunk": "@@ -42,4 +42,58 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK(m_node.chainman->GetMutex());\n+        LOCK(chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK(second_from_tip->pprev == chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    SetMockTime(GetTime());\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)\n+    // The next call to a PERIODIC write will flush\n+    SetMockTime(GetTime<std::chrono::minutes>() + 70min);",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "6f77517845f821ca7c1a2fc80a75dd5fb7249f14",
      "in_reply_to_id": 2072670546,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-05-04T19:01:43Z",
      "updated_at": "2025-05-04T19:01:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686068",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686230",
      "pull_request_review_id": 2813538850,
      "id": 2072686230,
      "node_id": "PRRC_kwDOABII5857iq6W",
      "diff_hunk": "",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "original_commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "in_reply_to_id": 2072677126,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yeah, but isn't the locking kept in `FlushStateToDisk`? So we're reducing 3 locks to 2 locks, right? That's not what I understand from the commit message",
      "created_at": "2025-05-04T19:02:30Z",
      "updated_at": "2025-05-04T19:02:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686230",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686230"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686476",
      "pull_request_review_id": 2813539202,
      "id": 2072686476,
      "node_id": "PRRC_kwDOABII5857iq-M",
      "diff_hunk": "@@ -31,15 +35,68 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(!sub->m_did_flush);\n \n     // The periodic flush interval is between 50 and 70 minutes (inclusive)\n-    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MIN - 1min);\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\n     BOOST_CHECK(!sub->m_did_flush);\n \n-    SetMockTime(GetTime<std::chrono::minutes>() + 70min);\n+    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MAX);\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 33,
      "original_position": 33,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: if you edit again please reformat `TestSubscriber` and `UpdatedBlockTip` as well",
      "created_at": "2025-05-04T19:04:26Z",
      "updated_at": "2025-05-04T19:16:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686476",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686596",
      "pull_request_review_id": 2813539202,
      "id": 2072686596,
      "node_id": "PRRC_kwDOABII5857irAE",
      "diff_hunk": "@@ -31,15 +35,68 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(!sub->m_did_flush);\n \n     // The periodic flush interval is between 50 and 70 minutes (inclusive)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "now that we have the constants these comments don't really add anything",
      "created_at": "2025-05-04T19:05:04Z",
      "updated_at": "2025-05-04T19:15:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 37,
      "original_line": 37,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686728",
      "pull_request_review_id": 2813539465,
      "id": 2072686728,
      "node_id": "PRRC_kwDOABII5857irCI",
      "diff_hunk": "@@ -3587,15 +3587,15 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         // caused an assert() failure during interrupt in such cases as the UTXO DB flushing checks\n         // that the best block hash is non-null.\n         if (m_chainman.m_interrupt) break;\n+\n+        // Write changes periodically to disk, after relay.\n+        if (!FlushStateToDisk(state, FlushStateMode::PERIODIC)) {",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "b56a7e2e983c78eca9acdf12a77f60a3cc6b53a0",
      "in_reply_to_id": 2072462850,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done in c1e554d3e5834a140f2a53854018499a3bfe6822. I had to move `FlushStateToDisk` above possibly calling `m_chainman.snapshot_download_completed()` and breaking or breaking on `m_chainman.m_interrupt`, but that order should not make a difference.",
      "created_at": "2025-05-04T19:05:46Z",
      "updated_at": "2025-05-04T19:05:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686728",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686728"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3592,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686734",
      "pull_request_review_id": 2813539202,
      "id": 2072686734,
      "node_id": "PRRC_kwDOABII5857irCO",
      "diff_hunk": "@@ -31,15 +35,68 @@ BOOST_FIXTURE_TEST_CASE(chainstate_write_interval, TestingSetup)\n     BOOST_CHECK(!sub->m_did_flush);\n \n     // The periodic flush interval is between 50 and 70 minutes (inclusive)\n-    SetMockTime(GetTime<std::chrono::minutes>() + 49min);\n+    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MIN - 1min);\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\n     BOOST_CHECK(!sub->m_did_flush);\n \n-    SetMockTime(GetTime<std::chrono::minutes>() + 70min);\n+    SetMockTime(GetTime<std::chrono::minutes>() + DATABASE_WRITE_INTERVAL_MAX);\n     chainstate.FlushStateToDisk(state_dummy, FlushStateMode::PERIODIC);\n     m_node.validation_signals->SyncWithValidationInterfaceQueue();\n     BOOST_CHECK(sub->m_did_flush);\n }\n \n+// Test that we do PERIODIC flushes inside ActivateBestChain.\n+// This is necessary for reindex-chainstate to be able to periodically flush\n+// before reaching chain tip.\n+BOOST_FIXTURE_TEST_CASE(write_during_multiblock_activation, TestChain100Setup)\n+{\n+    struct TestSubscriber final : CValidationInterface\n+    {\n+        const CBlockIndex* m_tip{nullptr};\n+        const CBlockIndex* m_flushed_at_block{nullptr};\n+        void ChainStateFlushed(ChainstateRole, const CBlockLocator&) override\n+        {\n+            m_flushed_at_block = m_tip;\n+        }\n+        void UpdatedBlockTip(const CBlockIndex* block_index, const CBlockIndex*, bool) override {\n+            m_tip = block_index;\n+        }\n+    };\n+\n+    auto& chainstate{Assert(m_node.chainman)->ActiveChainstate()};\n+    BlockValidationState state_dummy{};\n+\n+    // Pop two blocks from the tip\n+    const CBlockIndex* tip{chainstate.m_chain.Tip()};\n+    CBlockIndex* second_from_tip{tip->pprev};\n+\n+    {\n+        LOCK2(m_node.chainman->GetMutex(), chainstate.MempoolMutex());\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+        chainstate.DisconnectTip(state_dummy, nullptr);\n+    }\n+\n+    BOOST_CHECK_EQUAL(second_from_tip->pprev, chainstate.m_chain.Tip());\n+\n+    // Set m_next_write to current time\n+    chainstate.FlushStateToDisk(state_dummy, FlushStateMode::ALWAYS);\n+    m_node.validation_signals->SyncWithValidationInterfaceQueue();\n+    // The periodic flush interval is between 50 and 70 minutes (inclusive)",
      "path": "src/test/chainstate_write_tests.cpp",
      "position": 64,
      "original_position": 64,
      "commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "original_commit_id": "c1e554d3e5834a140f2a53854018499a3bfe6822",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "same, can be removed now I think (and 70 minutes isn't inclusive anymore, right?)",
      "created_at": "2025-05-04T19:05:47Z",
      "updated_at": "2025-05-04T19:15:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072686734",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072686734"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 85,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072687088",
      "pull_request_review_id": 2813539989,
      "id": 2072687088,
      "node_id": "PRRC_kwDOABII5857irHw",
      "diff_hunk": "",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "original_commit_id": "8d1e9fedb333dcfc82b7522b1979a318adfa4210",
      "in_reply_to_id": 2072677126,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If we kept the code as is, and `exited_ibd` is `true` and `m_disabled` is `false`, then we would be releasing and acquiring the lock 3 times after we release it for the inner loop.",
      "created_at": "2025-05-04T19:08:52Z",
      "updated_at": "2025-05-04T19:08:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32414#discussion_r2072687088",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2072687088"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32414"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165",
    "id": 3133212525,
    "node_id": "PR_kwDOABII5866wQdt",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34165",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34165.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34165.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8e074187a57220c596eb124091714302903a07cc",
    "number": 34165,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: don't mutate main cache when connecting block",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This is a slightly modified version of the second commit of #31132, which can be merged as an independent change. It has a small benefit on its own, but will help in moving the parent PR forward.\r\n\r\nWhen accessing coins via the `CCoinsViewCache`, the const methods like `GetCoin` actually mutate `cacheCoins` internally to cache entries when they are pulled from the backing db. This is generally a performance improvement for single threaded access patterns, but it precludes us from accessing entries in a `CCoinsViewCache` from multiple threads without a lock.\r\n\r\nAnother aspect is that when we add an ephemeral `CCoinsViewCache` view backed by the main cache for use in `ConnectBlock()`, we will insert entries into the main cache even if the block is determined to be invalid. This is not the biggest concern, since an invalid block requires proof-of-work. But, an attacker could craft multiple invalid blocks to fill the main cache. This would make us `Flush` the cache more often than necessary. Obviously this would be very expensive to do on mainnet.\r\n\r\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads coins without mutating the underlying cache via `FetchCoin()`.\r\n\r\nAdd `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\r\n\r\nThis is the foundation for async input fetching, where worker threads must not mutate shared state.\r\n",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-12-28T20:32:34Z",
    "updated_at": "2026-01-26T01:00:16Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "57b1f01fa53f19b75e7c95aa5a1c9d657ce72621",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:dont-mutate-cache",
      "ref": "dont-mutate-cache",
      "sha": "8e074187a57220c596eb124091714302903a07cc",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 295212,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-26T00:02:08Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2025-11-13T15:07:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5f66fca633c88700c4a71c5d5b307c8cc5575913",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38805,
        "stargazers_count": 87774,
        "watchers_count": 87774,
        "size": 302252,
        "default_branch": "master",
        "open_issues_count": 753,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-25T14:23:23Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-25T23:26:02Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 272,
    "deletions": 3,
    "changed_files": 9,
    "commits": 3,
    "review_comments": 20,
    "comments": 7
  },
  "events": [
    {
      "event": "labeled",
      "id": 21771410954,
      "node_id": "LE_lADOABII587geGK_zwAAAAURrV4K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771410954",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T20:32:37Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3695028300,
      "node_id": "IC_kwDOABII587cPahM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3695028300",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T20:32:40Z",
      "updated_at": "2026-01-26T00:02:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34165.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3733769971) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34320](https://github.com/bitcoin/bitcoin/pull/34320) (coins: replace remaining `HaveCoin` calls with `GetCoin` by l0rinc)\n* [#34164](https://github.com/bitcoin/bitcoin/pull/34164) (validation: add reusable coins view for ConnectBlock by andrewtoth)\n* [#34132](https://github.com/bitcoin/bitcoin/pull/34132) (refactor: inline `CCoinsViewErrorCatcher` into `CCoinsViewDB` by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3695028300",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3623089900,
      "node_id": "PRR_kwDOABII587X8_bs",
      "url": null,
      "actor": null,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-02T18:50:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "The implementation talks about block connection but the implementation was added to block disconnect. I don't yet know if we should apply it there or not, but I find it very likely that we should do it for block connection.\r\nA lot of tests were added for testing the new cache in isolation and they all passed while it was applied to the wrong place as far as I can tell.\r\n\r\nWe should add a new integration test that actually checks that invalid blocks don't pollute the underlying cache:\r\n```patch\r\ndiff --git a/src/test/validation_chainstate_tests.cpp b/src/test/validation_chainstate_tests.cpp\r\n--- a/src/test/validation_chainstate_tests.cpp\t(revision 20f0b8304d089d641060f693d3284e69524fbcbe)\r\n+++ b/src/test/validation_chainstate_tests.cpp\t(date 1767360120004)\r\n@@ -3,10 +3,12 @@\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n //\r\n #include <chainparams.h>\r\n+#include <consensus/amount.h>\r\n #include <consensus/validation.h>\r\n #include <node/kernel_notifications.h>\r\n #include <random.h>\r\n #include <rpc/blockchain.h>\r\n+#include <script/script.h>\r\n #include <sync.h>\r\n #include <test/util/chainstate.h>\r\n #include <test/util/coins.h>\r\n@@ -63,6 +65,30 @@\r\n     }\r\n }\r\n \r\n+BOOST_FIXTURE_TEST_CASE(connect_tip_does_not_cache_inputs_on_failed_connect, TestChain100Setup)\r\n+{\r\n+    Chainstate& chainstate = Assert(m_node.chainman)->ActiveChainstate();\r\n+\r\n+    COutPoint outpoint;\r\n+    {\r\n+        LOCK(cs_main);\r\n+        outpoint = AddTestCoin(m_rng, chainstate.CoinsTip());\r\n+        chainstate.CoinsTip().Flush(/*will_reuse_cache=*/false);\r\n+    }\r\n+\r\n+    CMutableTransaction tx;\r\n+    tx.vin.emplace_back(outpoint);\r\n+    tx.vout.emplace_back(MAX_MONEY, CScript{} << OP_TRUE);\r\n+\r\n+    const auto tip{WITH_LOCK(cs_main, return chainstate.m_chain.Tip()->GetBlockHash())};\r\n+    CBlock block = CreateBlock({tx}, CScript{} << OP_TRUE, chainstate);\r\n+    Assert(m_node.chainman)->ProcessNewBlock(std::make_shared<CBlock>(block), true, true, nullptr);\r\n+\r\n+    LOCK(cs_main);\r\n+    BOOST_CHECK_EQUAL(tip, chainstate.m_chain.Tip()->GetBlockHash()); // block rejected\r\n+    BOOST_CHECK(!chainstate.CoinsTip().HaveCoinInCache(outpoint));    // input not cached\r\n+}\r\n+\r\n //! Test UpdateTip behavior for both active and background chainstates.\r\n //!\r\n //! When run on the background chainstate, UpdateTip should do a subset\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\n--- a/src/validation.cpp\t(revision 20f0b8304d089d641060f693d3284e69524fbcbe)\r\n+++ b/src/validation.cpp\t(date 1767360154724)\r\n@@ -3102,7 +3102,7 @@\r\n     LogDebug(BCLog::BENCH, \"  - Load block from disk: %.2fms\\n\",\r\n              Ticks<MillisecondsDouble>(time_2 - time_1));\r\n     {\r\n-        CCoinsViewCache view(&CoinsTip());\r\n+        CoinsViewCacheNonMutating view(&CoinsTip());\r\n         bool rv = ConnectBlock(*block_to_connect, state, pindexNew, view);\r\n         if (m_chainman.m_options.signals) {\r\n             m_chainman.m_options.signals->BlockChecked(block_to_connect, state);\r\n```\r\n\r\nConcept ACK (edited to remove the nack).",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3623089900",
      "submitted_at": "2026-01-02T13:28:49Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21828410981,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVEx5l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828410981",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7cd938b16ac031d1a03a2551bef1e33991586887",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7cd938b16ac031d1a03a2551bef1e33991586887",
      "created_at": "2026-01-02T14:59:07Z"
    },
    {
      "event": "commented",
      "id": 3705536098,
      "node_id": "IC_kwDOABII587c3f5i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3705536098",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:46Z",
      "updated_at": "2026-01-02T15:00:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thank you @l0rinc, I have taken your integration test. I had unit tests for this behavior but the integration test is a great idea.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3705536098",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 21828428452,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUVE2Kk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828428452",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:48Z"
    },
    {
      "event": "subscribed",
      "id": 21828428465,
      "node_id": "SE_lADOABII587geGK_zwAAAAUVE2Kx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828428465",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:48Z"
    },
    {
      "event": "referenced",
      "id": 21830726717,
      "node_id": "REFE_lADOABII587geGK_zwAAAAUVNnQ9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21830726717",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d3a7723aa8c0467ca4de45ead076db3f4170a2a7",
      "commit_url": "https://api.github.com/repos/l0rinc/DrahtBot/commits/d3a7723aa8c0467ca4de45ead076db3f4170a2a7",
      "created_at": "2026-01-02T18:43:05Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837549734,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVnpCm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837549734",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "410a01460f0897ed5c938ab437b8086f1fffecdc",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/410a01460f0897ed5c938ab437b8086f1fffecdc",
      "created_at": "2026-01-03T19:01:19Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837652092,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVoCB8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837652092",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "created_at": "2026-01-03T19:21:58Z"
    },
    {
      "event": "labeled",
      "id": 21837654722,
      "node_id": "LE_lADOABII587geGK_zwAAAAUVoCrC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837654722",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T19:22:32Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3707294486,
      "node_id": "IC_kwDOABII587c-NMW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3707294486",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T19:22:37Z",
      "updated_at": "2026-01-03T19:22:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS native`: https://github.com/bitcoin/bitcoin/actions/runs/20681569759/job/59376499348</sub>\n<sub>LLM reason (âœ¨ experimental): Blockchain tests aborted due to a DisconnectTip failure during tip/disconnect handling (BLOCK_FAILED_VALID), causing the CI run to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3707294486",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "unlabeled",
      "id": 21837946886,
      "node_id": "UNLE_lADOABII587geGK_zwAAAAUVpKAG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837946886",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T20:39:07Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837998867,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVpWsT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837998867",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "created_at": "2026-01-03T20:54:04Z"
    },
    {
      "event": "reviewed",
      "id": 3624557779,
      "node_id": "PRR_kwDOABII587YClzT",
      "url": null,
      "actor": null,
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-03T20:59:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'll run a reindex-chainstate on these to see how they behave - as long as they don't slow down anything, I would be fine with them.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3624557779",
      "submitted_at": "2026-01-03T20:59:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21843019121,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUV8gVx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21843019121",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "created_at": "2026-01-04T19:54:39Z"
    },
    {
      "event": "referenced",
      "id": 21843717038,
      "node_id": "REFE_lADOABII587geGK_zwAAAAUV_Kuu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21843717038",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "15c56be893e5fbf57c3c761fe4814906a0171aa3",
      "commit_url": "https://api.github.com/repos/l0rinc/DrahtBot/commits/15c56be893e5fbf57c3c761fe4814906a0171aa3",
      "created_at": "2026-01-04T22:47:09Z"
    },
    {
      "event": "reviewed",
      "id": 3628136296,
      "node_id": "PRR_kwDOABII587YQPdo",
      "url": null,
      "actor": null,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-05T20:37:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3628136296",
      "submitted_at": "2026-01-05T20:37:46Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21964109990,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUdKbim",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21964109990",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "created_at": "2026-01-10T15:34:46Z"
    },
    {
      "event": "commented",
      "id": 3733769971,
      "node_id": "IC_kwDOABII587ejM7z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3733769971",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T00:53:39Z",
      "updated_at": "2026-01-11T00:53:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Ran a `reindex-chainstate`, no measurable change compared to master: ðŸ‘\r\n\r\nACK 2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3733769971",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3697832211,
      "node_id": "PRR_kwDOABII587caHET",
      "url": null,
      "actor": null,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-23T14:50:45Z",
      "author_association": "MEMBER",
      "body": "Nice carve-out from #31132.\r\n\r\nLeft a comment about whether we want to add a CoinsViewErrorCatcher wrapper for PeekCoin, but otherwise looks good to me.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3697832211",
      "submitted_at": "2026-01-23T14:50:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22264693921,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUvFESh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264693921",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "created_at": "2026-01-24T16:25:20Z"
    },
    {
      "event": "commented",
      "id": 3795054037,
      "node_id": "IC_kwDOABII587iM-3V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795054037",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:08Z",
      "updated_at": "2026-01-24T16:45:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thank you for your review @willcl-ark. Addressed https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721462578 and https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721476346, and added `noexcept` to `PeekCoin`.\r\n\r\n`git diff 2e67c5b604d2cf2e56db6b5d2906391d22113941..3a2cfbea1957f1eed6d97b6f8924f13100e11b1c`",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3795054037",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 22264849459,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUvFqQz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264849459",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:10Z"
    },
    {
      "event": "subscribed",
      "id": 22264849469,
      "node_id": "SE_lADOABII587geGK_zwAAAAUvFqQ9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264849469",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:10Z"
    },
    {
      "event": "commented",
      "id": 3797209009,
      "node_id": "IC_kwDOABII587iVM-x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3797209009",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-25T20:40:28Z",
      "updated_at": "2026-01-25T20:40:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I have taken your integration test.\r\n\r\nWas it removed since?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3797209009",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3704233057,
      "node_id": "PRR_kwDOABII587cyhxh",
      "url": null,
      "actor": null,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-25T21:05:37Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3704233057",
      "submitted_at": "2026-01-25T21:05:37Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkxMmUwY2ExZjMyZDhkYTlhYjY4ZmUyNmFkNDMwMzMzNTJhMzY5ZGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/912e0ca1f32d8da9ab68fe26ad43033352a369dc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/912e0ca1f32d8da9ab68fe26ad43033352a369dc",
      "tree": {
        "sha": "0634936e432f66d6c2ba7303b0fd3ea5a75ee7f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0634936e432f66d6c2ba7303b0fd3ea5a75ee7f5"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0634936e432f66d6c2ba7303b0fd3ea5a75ee7f5\nparent ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb\nauthor Andrew Toth <andrewstoth@gmail.com> 1766559610 +0200\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769385408 -0500\n\ncoins: add PeekCoin()\n\nIntroduce a helper to look up a Coin through a stack of CCoinsViewCache layers without populating parent caches.\n\nThis is useful for ephemeral views (e.g. during ConnectBlock) that want to avoid polluting CoinsTip() when validating invalid blocks.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml2rcAACgkQYAB6/Ik4\nsBi2TQ//Yx5wTowc50Sg4jzAU5ivV82NEHO1I+Ngrkbl8gwes+t/zuZ2YAqYr9+b\nL1CYVAYtny1NeSUZY/Z7r3Ape3k6KJnfwjUUaJirwhtX60Exd484okRV9SGZVkru\nTZBxSj2j6rtoib3V+2lAhqNL8FSY3oMU3dKzVwKTGFn/xPwxM4/nCd/h3CQR4r+n\n3sojaiwQFZFTfM8SzY8GSdp/gCc0v/6dQ/NclYkVVkj80SFak2lPCnOMPqVulHLy\nhAUv/UzapiTCbf/c29SqPu9h5SPdtYs9m1eVJ0fiJDooc7lYmC4A8Qamti123eEf\nRnqJmXIWhO8wag9Ttfj+LWDAnKATiNpFPhO4ydiX3VTtc8hJzDonREJAYSoI7bOk\nt2uLRLJYEtnPT89jl7NC8hPkPkr9K6o6nu5/RtykDsvGaVT6orP6INSwe3TsPMc2\nY5In4/C1m201AbA7RNERkqw3e9tyPxYWSnwUiQ8+t3IPy65WcIRJ2MZORDo+GCS1\n7WsSfo3tYLlhOpCyLPtS8CPdO9fK8dhpake27wYmWLZAG7KH6gLntwkXHbsKdFEN\nxUfBeujYqamrrmc5qL127N+f/g6OC6O/vtHMK8XOSeg3hC+xls2gtekXy1EyF6M1\n6IsZN6KJDYXJyFqVuSYbrfqU2C/ObDLI3dyr/J69YnDPztT4vo8=\n=pmaH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb",
          "sha": "ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb"
        }
      ],
      "message": "coins: add PeekCoin()\n\nIntroduce a helper to look up a Coin through a stack of CCoinsViewCache layers without populating parent caches.\n\nThis is useful for ephemeral views (e.g. during ConnectBlock) that want to avoid polluting CoinsTip() when validating invalid blocks.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-25T23:56:48Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-24T07:00:10Z"
      },
      "sha": "912e0ca1f32d8da9ab68fe26ad43033352a369dc"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22278106560,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUv4O3A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278106560",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "created_at": "2026-01-26T00:01:08Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMxYTRlZDM5ZWJjOWI2YzExMGQ4MWY1NTBlNDljZTc4MDAwOGNmMWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c1a4ed39ebc9b6c110d81f550e49ce780008cf1c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c1a4ed39ebc9b6c110d81f550e49ce780008cf1c",
      "tree": {
        "sha": "428f890a7756d9ce9ec02d0d05d399cce9ddccbe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/428f890a7756d9ce9ec02d0d05d399cce9ddccbe"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 428f890a7756d9ce9ec02d0d05d399cce9ddccbe\nparent 912e0ca1f32d8da9ab68fe26ad43033352a369dc\nauthor Andrew Toth <andrewstoth@gmail.com> 1766449159 -0500\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769385724 -0500\n\ncoins: don't mutate main cache when connecting block\n\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads\ncoins without mutating the underlying cache via `FetchCoin()`.\n\nUse `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\n\nThis is the foundation for async input fetching, where worker threads must not\nmutate shared state.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml2rvwACgkQYAB6/Ik4\nsBh1BxAAh2Zfzat5RBxIq1gBT+2tO/HXkkfb5nn2xxL91fbHN9Ysz4vI/RPt9+Zk\n2D2xwIwGpedmHbBcri7eS/ho8Q1H/5qM1ObTnya79VJL04tetDtiWBeLXW7gLmvr\nxwtBE6AlfMd47dj2KSrlMToi+Kw+ch56oZXyvGAazEWYZf/4GMPfeOvvrAQNYIhH\n3QmDrDJJ82H72Zejli6lFGXcw+e5uDg1Gl1eKYuHi+hkRs3tJ2QPbKQn6CdfQ3Qh\ngLLog9JnjbEl1YKWOy0YUVdBYYGAms48E1xHBv89beSm6OpirzhnbpnWB69bBdzC\nSOCSj+r4OBN4HU/DWGU0MQtaQFon4qh4EMHg+5AbZhNsljgVLnI11PaJX5eytSVK\nSxGFDK4n54exuE2WkFlVORy+Izhrp9U5WwMWy+7/+k4lQ+twzaumOtucUSK0AsE+\nJo7Ai9x+Dzi56xgsRxl43sAPVmaIDWizKWnxWNi3pFrRXOsGL+sk1/Qjdj0bgZgs\nv1rTxpK0DYGguaOVU4qverrUEP0V+svAP8QTYNyO1sAS/9r+bVgKClJptPkw7QeL\nurXt+cz9GtC+EkjcP292m7F4gTi7m5/GOAJpvSLxFIbgxPveIXOfOJ43B4jRcG3+\npH7X4FgHWq/P4YTW8Bexslhhr6ujXNkQNRKZ6L6ulA3YocNgQEs=\n=t1zj\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/912e0ca1f32d8da9ab68fe26ad43033352a369dc",
          "sha": "912e0ca1f32d8da9ab68fe26ad43033352a369dc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/912e0ca1f32d8da9ab68fe26ad43033352a369dc"
        }
      ],
      "message": "coins: don't mutate main cache when connecting block\n\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads\ncoins without mutating the underlying cache via `FetchCoin()`.\n\nUse `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\n\nThis is the foundation for async input fetching, where worker threads must not\nmutate shared state.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-26T00:02:04Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-23T00:19:19Z"
      },
      "sha": "c1a4ed39ebc9b6c110d81f550e49ce780008cf1c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhlMDc0MTg3YTU3MjIwYzU5NmViMTI0MDkxNzE0MzAyOTAzYTA3Y2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8e074187a57220c596eb124091714302903a07cc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8e074187a57220c596eb124091714302903a07cc",
      "tree": {
        "sha": "9484028a913c7ff71e6551ada69738758d3ca856",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9484028a913c7ff71e6551ada69738758d3ca856"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9484028a913c7ff71e6551ada69738758d3ca856\nparent c1a4ed39ebc9b6c110d81f550e49ce780008cf1c\nauthor Andrew Toth <andrewstoth@gmail.com> 1769385221 -0500\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769385725 -0500\n\ntest: assert CoinsTip is not mutated after invalid ConnectBlock\n\nAdd a new integration test to verify that using\nCoinsViewCacheNonMutating does indeed not mutate the main cache\nduring validation for an invalid block.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml2rv0ACgkQYAB6/Ik4\nsBgqZA//V3Xn1FEgxdkHfdq9K5axkPE3XbD8twoZbPlBvj0wYbGLchB4F0yz+14a\n1lZj1RU+Rn5w4bRVe8edZg3N2wGhVw1VMmmaKpalwq5ABLVVr8kn1+r49NMmGIfr\nuP+p27FrNmPP8/dM2DT0aFa+Tcngg8IS7avVOvs1R51HiefWDAYoSEMRzdoNvKFL\nlq+6kfkENCgdOyzPPLoXVzIrwChkU4Jjd3rokpc47lztH9Qpkrn7yAIHuscDZC52\nVP64nJZr8Edz3zVrsk7juYALs8moglxHfA9kdVNnPfLRZgdv6bK2P11N6tdSQAPH\nWdf+LeHOX/2IQP18atuXA2lLyNUURvDtotwtuI31bPDn/Sbsc0wuxJ5MbWkm7hYD\nUP7qrcoxnbv3+W1i5X3TmgKsQKkJPpKP7mKMxhgVqrbRVEmvSk5JErznkdxEBnWd\nrGfdCxLk4NAErs0dUm3IRkr3C9jbCzcJqXZvZaY+TbVXmNicjGQWjxHffN628U/q\n0OLDLc0yTJGyK8CUCB3OWY+pq2y3CwAbXqZ+5frfq2kcwu19GOrlClNX9AZghwyj\nhCzXFairbR2t4aZYKJWybo6zTqYLe56xkN0vohCTMNQyy2q4yPXJJejjkoDmEaMh\n0E0plSivArR7rNO/gtMTy5yV31oEeajvvsE4D4aGoWyW6Dp/UeA=\n=+YUt\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c1a4ed39ebc9b6c110d81f550e49ce780008cf1c",
          "sha": "c1a4ed39ebc9b6c110d81f550e49ce780008cf1c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c1a4ed39ebc9b6c110d81f550e49ce780008cf1c"
        }
      ],
      "message": "test: assert CoinsTip is not mutated after invalid ConnectBlock\n\nAdd a new integration test to verify that using\nCoinsViewCacheNonMutating does indeed not mutate the main cache\nduring validation for an invalid block.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-26T00:02:05Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-25T23:53:41Z"
      },
      "sha": "8e074187a57220c596eb124091714302903a07cc"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22278111828,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUv4QJU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278111828",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8e074187a57220c596eb124091714302903a07cc",
      "created_at": "2026-01-26T00:02:09Z"
    },
    {
      "event": "labeled",
      "id": 22278115130,
      "node_id": "LE_lADOABII587geGK_zwAAAAUv4Q86",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278115130",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:02:46Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3797439043,
      "node_id": "IC_kwDOABII587iWFJD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3797439043",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:50Z",
      "updated_at": "2026-01-26T00:10:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "@l0rinc thanks for your review. I have taken most of your suggestions. I have added the integration test back as a separate commit.\r\n\r\n`git diff 3a2cfbea1957f1eed6d97b6f8924f13100e11b1c..8e074187a57220c596eb124091714302903a07cc`\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3797439043",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 22278175152,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUv4fmw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278175152",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:52Z"
    },
    {
      "event": "subscribed",
      "id": 22278175181,
      "node_id": "SE_lADOABII587geGK_zwAAAAUv4fnN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278175181",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:52Z"
    },
    {
      "event": "unlabeled",
      "id": 22278601998,
      "node_id": "UNLE_lADOABII587geGK_zwAAAAUv6H0O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278601998",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T01:00:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657681365",
      "pull_request_review_id": 3623089900,
      "id": 2657681365,
      "node_id": "PRRC_kwDOABII586eaP_V",
      "diff_hunk": "@@ -2978,7 +2979,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n     // Apply the block atomically to the chain state.\n     const auto time_start{SteadyClock::now()};\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "original_commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I tried understanding why this was added to `DisconnectTip`, since every indication was that this is about block connection:\r\n> * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\r\n\r\nSo how are the new tests passing if the implementation is completely broken? It seems we're only testing `CoinsViewCacheNonMutating` in isolation but there are no tests added to check it's actual integration.",
      "created_at": "2026-01-02T13:01:04Z",
      "updated_at": "2026-01-02T13:28:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2657681365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657681365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657863730",
      "pull_request_review_id": 3623301877,
      "id": 2657863730,
      "node_id": "PRRC_kwDOABII586ea8gy",
      "diff_hunk": "@@ -2978,7 +2979,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n     // Apply the block atomically to the chain state.\n     const auto time_start{SteadyClock::now()};\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "original_commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "in_reply_to_id": 2657681365,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was an oopsie.\r\nAdded `CoinsViewCacheNonMutating` to `ConnectBlock` and removed from `DisconnectBlock`.",
      "created_at": "2026-01-02T15:00:09Z",
      "updated_at": "2026-01-02T15:00:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2657863730",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657863730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659143724",
      "pull_request_review_id": 3624557779,
      "id": 2659143724,
      "node_id": "PRRC_kwDOABII586ef1As",
      "diff_hunk": "@@ -0,0 +1,143 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    Txid prevhash{Txid::FromUint256(uint256{1})};\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        prevhash = tx.GetHash();",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 1,
      "original_position": 37,
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "original_commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This seems like a leftover.",
      "created_at": "2026-01-03T20:49:54Z",
      "updated_at": "2026-01-03T20:59:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2659143724",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659143724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 37,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659145764",
      "pull_request_review_id": 3624557779,
      "id": 2659145764,
      "node_id": "PRRC_kwDOABII586ef1gk",
      "diff_hunk": "@@ -0,0 +1,143 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 1,
      "original_position": 23,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I understand that we want this to be realistic, but we could simplify considerably if we just returned the outpoints here:\n```C++\nstatic std::vector<COutPoint> CreateOutpoints() noexcept\n{\n    static constexpr uint32_t NUM_OUTPOINTS{100};\n    std::vector<COutPoint> outpoints;\n    outpoints.reserve(NUM_OUTPOINTS);\n\n    for (const auto i : std::views::iota(uint32_t{1}, NUM_OUTPOINTS + 1)) {\n        outpoints.emplace_back(Txid::FromUint256(uint256(i)), /*nIn=*/0);\n    }\n\n    return outpoints;\n}\n```\n\nIf you disagree, just resolve without a comment.",
      "created_at": "2026-01-03T20:54:49Z",
      "updated_at": "2026-01-03T20:59:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2659145764",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659145764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662558942",
      "pull_request_review_id": 3628136296,
      "id": 2662558942,
      "node_id": "PRRC_kwDOABII586es2ze",
      "diff_hunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    {\n+        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n+        if (!inserted) return ret;",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 22,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hmm, we're we're duplicating the `FetchCoin` implementation here - and also making it virtual which introduces a slight regression on the hot path.\nCould we extract only the part that changes?\nI think we can simplify it by adding a virtual `GetCoinFromBase` which either calls `base->GetCoin(outpoint)` (default impl) or in `CoinsViewCacheNonMutating` it could be overwritten with the new `base->PeekCoin(outpoint)`. That way only the `if (inserted)` branch would pay for virtual dispatch and there would be no duplicated `FetchCoin` logic, something like:\n```patch\ndiff --git a/src/coins.cpp b/src/coins.cpp\n--- a/src/coins.cpp\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coins.cpp\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -59,10 +59,15 @@\n     return memusage::DynamicUsage(cacheCoins) + cachedCoinsUsage;\n }\n \n+std::optional<Coin> CCoinsViewCache::GetCoinFromBase(const COutPoint& outpoint) const\n+{\n+    return base->GetCoin(outpoint);\n+}\n+\n CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const {\n     const auto [ret, inserted] = cacheCoins.try_emplace(outpoint);\n     if (inserted) {\n-        if (auto coin{base->GetCoin(outpoint)}) {\n+        if (auto coin{GetCoinFromBase(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n             if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins\ndiff --git a/src/coins.h b/src/coins.h\n--- a/src/coins.h\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coins.h\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -382,6 +382,8 @@\n     /* Cached dynamic memory usage for the inner Coin objects. */\n     mutable size_t cachedCoinsUsage{0};\n \n+    virtual std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const;\n+\n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n \n@@ -489,7 +491,7 @@\n      * @note this is marked const, but may actually append to `cacheCoins`, increasing\n      * memory usage.\n      */\n-    virtual CCoinsMap::iterator FetchCoin(const COutPoint &outpoint) const;\n+    CCoinsMap::iterator FetchCoin(const COutPoint &outpoint) const;\n };\n \n //! Utility function to add all of a transaction's outputs to a cache.\ndiff --git a/src/coinsviewcachenonmutating.h b/src/coinsviewcachenonmutating.h\n--- a/src/coinsviewcachenonmutating.h\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coinsviewcachenonmutating.h\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -9,28 +9,16 @@\n #include <primitives/transaction.h>\n \n /**\n- * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * CCoinsViewCache subclass that does not call GetCoin on base, so base will not be mutated before Flush.\n  * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n- * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ * It provides the same interface as CCoinsViewCache, overriding GetCoinFromBase().\n  */\n class CoinsViewCacheNonMutating : public CCoinsViewCache\n {\n private:\n-    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const override\n     {\n-        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n-        if (!inserted) return ret;\n-\n-        // TODO: Remove spent checks once we no longer return spent coins in coinscache_sim CoinsViewBottom.\n-        if (auto coin{base->PeekCoin(outpoint)}; coin && !coin->IsSpent()) {\n-            ret->second.coin = std::move(*coin);\n-        } else {\n-            cacheCoins.erase(ret);\n-            return cacheCoins.end();\n-        }\n-\n-        cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-        return ret;\n+        return base->PeekCoin(outpoint);\n     }\n \n public:\n```",
      "created_at": "2026-01-05T19:21:58Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662558942",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662558942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": 21,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662620903",
      "pull_request_review_id": 3628136296,
      "id": 2662620903,
      "node_id": "PRRC_kwDOABII586etF7n",
      "diff_hunk": "@@ -3098,7 +3099,7 @@ bool Chainstate::ConnectTip(\n     LogDebug(BCLog::BENCH, \"  - Load block from disk: %.2fms\\n\",\n              Ticks<MillisecondsDouble>(time_2 - time_1));\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 73,
      "original_position": 13,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "here or in a follow-up we could add this to `TestBlockValidity` as well, where it would be even more relevant since itâ€™s invoked with without PoW checks (so your PR arguments apply here even more)",
      "created_at": "2026-01-05T19:48:37Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662620903",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662620903"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3102,
      "original_line": 3102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662733404",
      "pull_request_review_id": 3628136296,
      "id": 2662733404,
      "node_id": "PRRC_kwDOABII586ethZc",
      "diff_hunk": "@@ -0,0 +1,140 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+}",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 107,
      "original_position": 92,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Checked the coverage of this and compared it with the suggested `CCoinsViewCache::GetCoinFromBase` - existing `FetchCoin` is covered that way.\nWe could extend the coverage with `HaveCoin()`/`GetCoin()` as well, to check that they also do not populate the parent cache when reading inputs from disk, and that flushing an ephemeral `CoinsViewCacheNonMutating` layer propagates spentness to its parent:\n```patch\ndiff --git a/src/test/coinsviewcachenonmutating_tests.cpp b/src/test/coinsviewcachenonmutating_tests.cpp\n--- a/src/test/coinsviewcachenonmutating_tests.cpp\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n+++ b/src/test/coinsviewcachenonmutating_tests.cpp\t(revision 3e8676d49ecf9e3c12cd641ce655e74f85f3a6e6)\n@@ -82,6 +82,13 @@\n     PopulateView(block, db);\n     CCoinsViewCache main_cache{&db};\n     CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n     CheckCache(block, view);\n     // Check that no coins have been moved up to main cache from db\n     for (const auto& tx : block.vtx) {\n@@ -89,6 +96,12 @@\n             BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n         }\n     }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n }\n \n BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n```\n",
      "created_at": "2026-01-05T20:35:53Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662733404",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662733404"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": 82,
      "original_start_line": 78,
      "start_side": "RIGHT",
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2678764767",
      "pull_request_review_id": 3646995468,
      "id": 2678764767,
      "node_id": "PRRC_kwDOABII586fqrTf",
      "diff_hunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    {\n+        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n+        if (!inserted) return ret;",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 22,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": 2662558942,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nice, done.",
      "created_at": "2026-01-10T15:40:37Z",
      "updated_at": "2026-01-10T15:40:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2678764767",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2678764767"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": 21,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721462578",
      "pull_request_review_id": 3697832211,
      "id": 2721462578,
      "node_id": "PRRC_kwDOABII586iNjky",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Do we want to add a `CCoinsViewErrorCatcher` overrid for `PeekCoin` as we do for [`GetCoin` and `HaveCoin`](https://github.com/andrewtoth/bitcoin/blob/2e67c5b604d2cf2e56db6b5d2906391d22113941/src/coins.cpp#L380-L406) or is this omitted intentionally?",
      "created_at": "2026-01-23T14:35:58Z",
      "updated_at": "2026-01-23T14:50:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721462578",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721462578"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721476346",
      "pull_request_review_id": 3697832211,
      "id": 2721476346,
      "node_id": "PRRC_kwDOABII586iNm76",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\"overriding the GetCoinFromBase method.\"?",
      "created_at": "2026-01-23T14:39:12Z",
      "updated_at": "2026-01-23T14:50:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721476346",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721476346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724347964",
      "pull_request_review_id": 3701986936,
      "id": 2724347964,
      "node_id": "PRRC_kwDOABII586iYkA8",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good catch :smile:! Added, thanks.",
      "created_at": "2026-01-24T16:44:02Z",
      "updated_at": "2026-01-24T16:44:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2724347964",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724347964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724358983",
      "pull_request_review_id": 3702028045,
      "id": 2724358983,
      "node_id": "PRRC_kwDOABII586iYmtH",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Note that `CCoinsViewErrorCatcher` will be removed in https://github.com/bitcoin/bitcoin/pull/34132. So whichever is merged first will have to rebase.",
      "created_at": "2026-01-24T16:53:29Z",
      "updated_at": "2026-01-24T16:53:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2724358983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724358983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725907704",
      "pull_request_review_id": 3704233057,
      "id": 2725907704,
      "node_id": "PRRC_kwDOABII586iegz4",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Not sure I understand why this was needed, the only way this has database access is through `GetCoin`:\r\n```\r\n\tframe #0: 0x000000010381616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at txdb.cpp:70:14\r\n    frame #1: 0x000000010419da40 test_bitcoin`CCoinsView::PeekCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at coins.cpp:17:93\r\n    frame #2: 0x000000010419dea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:36:18\r\n    frame #3: 0x00000001041a3ee4 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0::operator()(this=0x000000016dc23918) const at coins.cpp:413:87\r\n    frame #4: 0x00000001041a12e0 test_bitcoin`std::__1::optional<Coin> ExecuteBackedWrapper<std::__1::optional<Coin>, CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0>(func=(unnamed class) @ 0x000000016dc23918, err_callbacks=size=0) at coins.cpp:387:16\r\n    frame #5: 0x00000001041a1250 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:413:12\r\n    frame #6: 0x000000010419e2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x000000010954aae0, outpoint=0x000000016dc24a6c) const at coins.cpp:51:18\r\n    frame #7: 0x0000000102640b38 test_bitcoin`CoinsViewCacheNonMutating::GetCoinFromBase(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coinsviewcachenonmutating.h:22:22\r\n    frame #8: 0x000000010419e8b8 test_bitcoin`CCoinsViewCache::FetchCoin(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coins.cpp:73:23\r\n    frame #9: 0x000000010419f994 test_bitcoin`CCoinsViewCache::HaveCoin(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coins.cpp:189:36\r\n```\r\nand without this error catcher we're basically getting the same:\r\n```\r\n\tframe #0: 0x000000010447616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at txdb.cpp:70:14\r\n    frame #1: 0x0000000104dfda40 test_bitcoin`CCoinsView::PeekCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at coins.cpp:19:12\r\n    frame #2: 0x0000000104dfdea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010a14ab38, outpoint=0x000000016cfc4a6c) const at coins.cpp:39:18\r\n    frame #3: 0x0000000104dfe2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x0000000846008c00, outpoint=0x000000016cfc4a6c) const at coins.cpp:54:18\r\n    frame #4: 0x00000001032a0b38 test_bitcoin`CoinsViewCacheNonMutating::GetCoinFromBase(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coinsviewcachenonmutating.h:22:22\r\n    frame #5: 0x0000000104dfe8b8 test_bitcoin`CCoinsViewCache::FetchCoin(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coins.cpp:76:23\r\n    frame #6: 0x0000000104dff994 test_bitcoin`CCoinsViewCache::HaveCoin(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coins.cpp:192:36\r\n```\r\n(except that the frames are a lot cleaner)",
      "created_at": "2026-01-25T20:46:54Z",
      "updated_at": "2026-01-25T21:05:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725907704",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725907704"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917004",
      "pull_request_review_id": 3704233057,
      "id": 2725917004,
      "node_id": "PRRC_kwDOABII586iejFM",
      "diff_hunk": "@@ -14,6 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n+std::optional<Coin> CCoinsView::PeekCoin(const COutPoint& outpoint) const noexcept { return GetCoin(outpoint); }",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I have mixed feelings about adding `noexcept` here, since DB reads can still throw `dbwrapper_error` - which should be fatal, but `noexcept` muddies it a bit since this can theoretically `std::terminate` before `CCoinsViewErrorCatcher` has a chance to react.\n\nInstead of adding it only here (and not to the equivalent `GetCoin`), I suggest we add it only after https://github.com/bitcoin/bitcoin/pull/34132 is merged (I can add it there as a last commit if you agree it belongs there)",
      "created_at": "2026-01-25T20:59:28Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725917004",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917004"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917466",
      "pull_request_review_id": 3704233057,
      "id": 2725917466,
      "node_id": "PRRC_kwDOABII586iejMa",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 112,
      "original_position": 108,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "would it make sense to have at least one that's not in memory, just to have some variety?",
      "created_at": "2026-01-25T21:00:08Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725917466",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917466"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725918044",
      "pull_request_review_id": 3704233057,
      "id": 2725918044,
      "node_id": "PRRC_kwDOABII586iejVc",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 43,
      "original_position": 41,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: these helpers could go to anonymous namespace to avoid global linkage in the test binary.",
      "created_at": "2026-01-25T21:01:00Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725918044",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725918044"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725919735",
      "pull_request_review_id": 3704233057,
      "id": 2725919735,
      "node_id": "PRRC_kwDOABII586iejv3",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase private method.",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "GetCoinFromBase is protected now: https://github.com/bitcoin/bitcoin/pull/34165/changes#diff-095ce1081a930998a10b37358fae5499ac47f8cb6f25f5df5d88e920a54e0341R386",
      "created_at": "2026-01-25T21:03:26Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725919735",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725919735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039192",
      "pull_request_review_id": 3704334887,
      "id": 2726039192,
      "node_id": "PRRC_kwDOABII586ifA6Y",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ah true, it is not needed. So, reverted adding it. This way we won't conflict with #34132.",
      "created_at": "2026-01-26T00:02:38Z",
      "updated_at": "2026-01-26T00:02:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726039192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039348",
      "pull_request_review_id": 3704335012,
      "id": 2726039348,
      "node_id": "PRRC_kwDOABII586ifA80",
      "diff_hunk": "@@ -14,6 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n+std::optional<Coin> CCoinsView::PeekCoin(const COutPoint& outpoint) const noexcept { return GetCoin(outpoint); }",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": 2725917004,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Removed noexcept for PeekCoin.",
      "created_at": "2026-01-26T00:02:51Z",
      "updated_at": "2026-01-26T00:02:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726039348",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039348"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726043535",
      "pull_request_review_id": 3704339159,
      "id": 2726043535,
      "node_id": "PRRC_kwDOABII586ifB-P",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 112,
      "original_position": 108,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": 2725917466,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure about this. These are unit tests specific to the `CoinsViewCacheNonMutating`, not for the `CCoinsViewDB`. We should probably have unit tests specific to `CCoinsViewDB` and test them for in-memory and not.",
      "created_at": "2026-01-26T00:08:56Z",
      "updated_at": "2026-01-26T00:08:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726043535",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726043535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    }
  ]
}
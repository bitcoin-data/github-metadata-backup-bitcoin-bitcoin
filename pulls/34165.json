{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165",
    "id": 3133212525,
    "node_id": "PR_kwDOABII5866wQdt",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34165",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34165.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34165.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/2f100b16b7bb09572ed3b04aa1484523af7509d9",
    "number": 34165,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: don't mutate main cache when connecting block",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This is a slightly modified version of the second commit of #31132, which can be merged as an independent change. It has a small benefit on its own, but will help in moving the parent PR forward.\r\n\r\nWhen accessing coins via the `CCoinsViewCache`, methods like `GetCoin` can call `FetchCoin` which actually mutate `cacheCoins` internally to cache entries when they are pulled from the backing db. This is generally a performance improvement for single threaded access patterns, but it precludes us from accessing entries in a `CCoinsViewCache` from multiple threads without a lock.\r\n\r\nAnother aspect is that when we add an ephemeral `CCoinsViewCache` view backed by the main cache for use in `ConnectBlock()`, we will insert entries into the main cache even if the block is determined to be invalid. This is not the biggest concern, since an invalid block requires proof-of-work. But, an attacker could craft multiple invalid blocks to fill the main cache. This would make us `Flush` the cache more often than necessary. Obviously this would be very expensive to do on mainnet.\r\n\r\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads coins without mutating the underlying cache via `FetchCoin()`.\r\n\r\nAdd `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\r\n\r\nThis is the foundation for async input fetching, where worker threads must not mutate shared state.\r\n",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-12-28T20:32:34Z",
    "updated_at": "2026-01-27T20:24:00Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "05984cc10b7e3947618bb71b0c9e14bd1b8236f5",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:dont-mutate-cache",
      "ref": "dont-mutate-cache",
      "sha": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 295214,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-27T05:02:18Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2025-11-13T15:07:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "34a5ecadd7203121b03ac692d22a752d2a364111",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38810,
        "stargazers_count": 87793,
        "watchers_count": 87793,
        "size": 302329,
        "default_branch": "master",
        "open_issues_count": 754,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-27T17:32:44Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-27T20:49:34Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 278,
    "deletions": 3,
    "changed_files": 9,
    "commits": 3,
    "review_comments": 35,
    "comments": 9
  },
  "events": [
    {
      "event": "labeled",
      "id": 21771410954,
      "node_id": "LE_lADOABII587geGK_zwAAAAURrV4K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771410954",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T20:32:37Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3695028300,
      "node_id": "IC_kwDOABII587cPahM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3695028300",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T20:32:40Z",
      "updated_at": "2026-01-27T20:24:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34165.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3804058832) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34320](https://github.com/bitcoin/bitcoin/pull/34320) (coins: replace remaining `HaveCoin` calls with `GetCoin` by l0rinc)\n* [#34164](https://github.com/bitcoin/bitcoin/pull/34164) (validation: add reusable coins view for ConnectBlock by andrewtoth)\n* [#34132](https://github.com/bitcoin/bitcoin/pull/34132) (refactor: inline `CCoinsViewErrorCatcher` into `CCoinsViewDB` by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3695028300",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3623089900,
      "node_id": "PRR_kwDOABII587X8_bs",
      "url": null,
      "actor": null,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-02T18:50:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "The implementation talks about block connection but the implementation was added to block disconnect. I don't yet know if we should apply it there or not, but I find it very likely that we should do it for block connection.\r\nA lot of tests were added for testing the new cache in isolation and they all passed while it was applied to the wrong place as far as I can tell.\r\n\r\nWe should add a new integration test that actually checks that invalid blocks don't pollute the underlying cache:\r\n```patch\r\ndiff --git a/src/test/validation_chainstate_tests.cpp b/src/test/validation_chainstate_tests.cpp\r\n--- a/src/test/validation_chainstate_tests.cpp\t(revision 20f0b8304d089d641060f693d3284e69524fbcbe)\r\n+++ b/src/test/validation_chainstate_tests.cpp\t(date 1767360120004)\r\n@@ -3,10 +3,12 @@\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n //\r\n #include <chainparams.h>\r\n+#include <consensus/amount.h>\r\n #include <consensus/validation.h>\r\n #include <node/kernel_notifications.h>\r\n #include <random.h>\r\n #include <rpc/blockchain.h>\r\n+#include <script/script.h>\r\n #include <sync.h>\r\n #include <test/util/chainstate.h>\r\n #include <test/util/coins.h>\r\n@@ -63,6 +65,30 @@\r\n     }\r\n }\r\n \r\n+BOOST_FIXTURE_TEST_CASE(connect_tip_does_not_cache_inputs_on_failed_connect, TestChain100Setup)\r\n+{\r\n+    Chainstate& chainstate = Assert(m_node.chainman)->ActiveChainstate();\r\n+\r\n+    COutPoint outpoint;\r\n+    {\r\n+        LOCK(cs_main);\r\n+        outpoint = AddTestCoin(m_rng, chainstate.CoinsTip());\r\n+        chainstate.CoinsTip().Flush(/*will_reuse_cache=*/false);\r\n+    }\r\n+\r\n+    CMutableTransaction tx;\r\n+    tx.vin.emplace_back(outpoint);\r\n+    tx.vout.emplace_back(MAX_MONEY, CScript{} << OP_TRUE);\r\n+\r\n+    const auto tip{WITH_LOCK(cs_main, return chainstate.m_chain.Tip()->GetBlockHash())};\r\n+    CBlock block = CreateBlock({tx}, CScript{} << OP_TRUE, chainstate);\r\n+    Assert(m_node.chainman)->ProcessNewBlock(std::make_shared<CBlock>(block), true, true, nullptr);\r\n+\r\n+    LOCK(cs_main);\r\n+    BOOST_CHECK_EQUAL(tip, chainstate.m_chain.Tip()->GetBlockHash()); // block rejected\r\n+    BOOST_CHECK(!chainstate.CoinsTip().HaveCoinInCache(outpoint));    // input not cached\r\n+}\r\n+\r\n //! Test UpdateTip behavior for both active and background chainstates.\r\n //!\r\n //! When run on the background chainstate, UpdateTip should do a subset\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\n--- a/src/validation.cpp\t(revision 20f0b8304d089d641060f693d3284e69524fbcbe)\r\n+++ b/src/validation.cpp\t(date 1767360154724)\r\n@@ -3102,7 +3102,7 @@\r\n     LogDebug(BCLog::BENCH, \"  - Load block from disk: %.2fms\\n\",\r\n              Ticks<MillisecondsDouble>(time_2 - time_1));\r\n     {\r\n-        CCoinsViewCache view(&CoinsTip());\r\n+        CoinsViewCacheNonMutating view(&CoinsTip());\r\n         bool rv = ConnectBlock(*block_to_connect, state, pindexNew, view);\r\n         if (m_chainman.m_options.signals) {\r\n             m_chainman.m_options.signals->BlockChecked(block_to_connect, state);\r\n```\r\n\r\nConcept ACK (edited to remove the nack).",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3623089900",
      "submitted_at": "2026-01-02T13:28:49Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21828410981,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVEx5l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828410981",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7cd938b16ac031d1a03a2551bef1e33991586887",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7cd938b16ac031d1a03a2551bef1e33991586887",
      "created_at": "2026-01-02T14:59:07Z"
    },
    {
      "event": "commented",
      "id": 3705536098,
      "node_id": "IC_kwDOABII587c3f5i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3705536098",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:46Z",
      "updated_at": "2026-01-02T15:00:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thank you @l0rinc, I have taken your integration test. I had unit tests for this behavior but the integration test is a great idea.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3705536098",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 21828428452,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUVE2Kk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828428452",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:48Z"
    },
    {
      "event": "subscribed",
      "id": 21828428465,
      "node_id": "SE_lADOABII587geGK_zwAAAAUVE2Kx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21828428465",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-02T15:00:48Z"
    },
    {
      "event": "referenced",
      "id": 21830726717,
      "node_id": "REFE_lADOABII587geGK_zwAAAAUVNnQ9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21830726717",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d3a7723aa8c0467ca4de45ead076db3f4170a2a7",
      "commit_url": "https://api.github.com/repos/l0rinc/DrahtBot/commits/d3a7723aa8c0467ca4de45ead076db3f4170a2a7",
      "created_at": "2026-01-02T18:43:05Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837549734,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVnpCm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837549734",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "410a01460f0897ed5c938ab437b8086f1fffecdc",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/410a01460f0897ed5c938ab437b8086f1fffecdc",
      "created_at": "2026-01-03T19:01:19Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837652092,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVoCB8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837652092",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "created_at": "2026-01-03T19:21:58Z"
    },
    {
      "event": "labeled",
      "id": 21837654722,
      "node_id": "LE_lADOABII587geGK_zwAAAAUVoCrC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837654722",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T19:22:32Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3707294486,
      "node_id": "IC_kwDOABII587c-NMW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3707294486",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T19:22:37Z",
      "updated_at": "2026-01-03T19:22:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS native`: https://github.com/bitcoin/bitcoin/actions/runs/20681569759/job/59376499348</sub>\n<sub>LLM reason (âœ¨ experimental): Blockchain tests aborted due to a DisconnectTip failure during tip/disconnect handling (BLOCK_FAILED_VALID), causing the CI run to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3707294486",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "unlabeled",
      "id": 21837946886,
      "node_id": "UNLE_lADOABII587geGK_zwAAAAUVpKAG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837946886",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T20:39:07Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21837998867,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUVpWsT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21837998867",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "created_at": "2026-01-03T20:54:04Z"
    },
    {
      "event": "reviewed",
      "id": 3624557779,
      "node_id": "PRR_kwDOABII587YClzT",
      "url": null,
      "actor": null,
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-03T20:59:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "I'll run a reindex-chainstate on these to see how they behave - as long as they don't slow down anything, I would be fine with them.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3624557779",
      "submitted_at": "2026-01-03T20:59:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21843019121,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUV8gVx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21843019121",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "created_at": "2026-01-04T19:54:39Z"
    },
    {
      "event": "referenced",
      "id": 21843717038,
      "node_id": "REFE_lADOABII587geGK_zwAAAAUV_Kuu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21843717038",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "15c56be893e5fbf57c3c761fe4814906a0171aa3",
      "commit_url": "https://api.github.com/repos/l0rinc/DrahtBot/commits/15c56be893e5fbf57c3c761fe4814906a0171aa3",
      "created_at": "2026-01-04T22:47:09Z"
    },
    {
      "event": "reviewed",
      "id": 3628136296,
      "node_id": "PRR_kwDOABII587YQPdo",
      "url": null,
      "actor": null,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-05T20:37:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3628136296",
      "submitted_at": "2026-01-05T20:37:46Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21964109990,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUdKbim",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21964109990",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "created_at": "2026-01-10T15:34:46Z"
    },
    {
      "event": "commented",
      "id": 3733769971,
      "node_id": "IC_kwDOABII587ejM7z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3733769971",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T00:53:39Z",
      "updated_at": "2026-01-11T00:53:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "Ran a `reindex-chainstate`, no measurable change compared to master: ðŸ‘\r\n\r\nACK 2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3733769971",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3697832211,
      "node_id": "PRR_kwDOABII587caHET",
      "url": null,
      "actor": null,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-23T14:50:45Z",
      "author_association": "MEMBER",
      "body": "Nice carve-out from #31132.\r\n\r\nLeft a comment about whether we want to add a CoinsViewErrorCatcher wrapper for PeekCoin, but otherwise looks good to me.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3697832211",
      "submitted_at": "2026-01-23T14:50:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22264693921,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUvFESh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264693921",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "created_at": "2026-01-24T16:25:20Z"
    },
    {
      "event": "commented",
      "id": 3795054037,
      "node_id": "IC_kwDOABII587iM-3V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795054037",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:08Z",
      "updated_at": "2026-01-24T16:45:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thank you for your review @willcl-ark. Addressed https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721462578 and https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721476346, and added `noexcept` to `PeekCoin`.\r\n\r\n`git diff 2e67c5b604d2cf2e56db6b5d2906391d22113941..3a2cfbea1957f1eed6d97b6f8924f13100e11b1c`",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3795054037",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 22264849459,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUvFqQz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264849459",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:10Z"
    },
    {
      "event": "subscribed",
      "id": 22264849469,
      "node_id": "SE_lADOABII587geGK_zwAAAAUvFqQ9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22264849469",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T16:45:10Z"
    },
    {
      "event": "commented",
      "id": 3797209009,
      "node_id": "IC_kwDOABII587iVM-x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3797209009",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-25T20:40:28Z",
      "updated_at": "2026-01-25T20:40:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I have taken your integration test.\r\n\r\nWas it removed since?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3797209009",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "reviewed",
      "id": 3704233057,
      "node_id": "PRR_kwDOABII587cyhxh",
      "url": null,
      "actor": null,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-25T21:05:37Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3704233057",
      "submitted_at": "2026-01-25T21:05:37Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22278106560,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUv4O3A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278106560",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "created_at": "2026-01-26T00:01:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22278111828,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUv4QJU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278111828",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8e074187a57220c596eb124091714302903a07cc",
      "created_at": "2026-01-26T00:02:09Z"
    },
    {
      "event": "labeled",
      "id": 22278115130,
      "node_id": "LE_lADOABII587geGK_zwAAAAUv4Q86",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278115130",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:02:46Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3797439043,
      "node_id": "IC_kwDOABII587iWFJD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3797439043",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:50Z",
      "updated_at": "2026-01-26T00:10:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "@l0rinc thanks for your review. I have taken most of your suggestions. I have added the integration test back as a separate commit.\r\n\r\n`git diff 3a2cfbea1957f1eed6d97b6f8924f13100e11b1c..8e074187a57220c596eb124091714302903a07cc`\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3797439043",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 22278175152,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUv4fmw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278175152",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:52Z"
    },
    {
      "event": "subscribed",
      "id": 22278175181,
      "node_id": "SE_lADOABII587geGK_zwAAAAUv4fnN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278175181",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T00:10:52Z"
    },
    {
      "event": "unlabeled",
      "id": 22278601998,
      "node_id": "UNLE_lADOABII587geGK_zwAAAAUv6H0O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22278601998",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-26T01:00:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3706829514,
      "node_id": "PRR_kwDOABII587c8brK",
      "url": null,
      "actor": null,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-26T16:48:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for fixing it so quickly. \r\nI think we should remove the `noexcept` from `GetCoinFromBase` as well because the underlying `PeekCoin` -> `GetCoin` path can still throw.\r\nAnd since `PeekCoin` **does** actually call `GetCoin`, I think we need to update the PR description and comments and commit messages to accurately reflect that we're using `PeekCoin` to avoid `FetchCoin`'s `try_emplace` on the parent.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#pullrequestreview-3706829514",
      "submitted_at": "2026-01-26T16:47:45Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE3YzA3YzhiYmRiYTE1ZWQ0MGI3YTM4NzA3N2JhNGE4NWYwOTgyMWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/17c07c8bbdba15ed40b7a387077ba4a85f09821c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/17c07c8bbdba15ed40b7a387077ba4a85f09821c",
      "tree": {
        "sha": "74cc70c80159028799c5abc0cadf9fc06d4e3c47",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/74cc70c80159028799c5abc0cadf9fc06d4e3c47"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 74cc70c80159028799c5abc0cadf9fc06d4e3c47\nparent ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb\nauthor Andrew Toth <andrewstoth@gmail.com> 1766559610 +0200\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769490112 -0500\n\ncoins: add PeekCoin()\n\nIntroduce a helper to look up a Coin through a stack of CCoinsViewCache layers without populating parent caches.\n\nThis is useful for ephemeral views (e.g. during ConnectBlock) that want to avoid polluting CoinsTip() when validating invalid blocks.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml4RsAACgkQYAB6/Ik4\nsBiSHBAAoloTk1l0r/I9L5FgHHZe3O0TNXbtwpk1m7OAJRj/Cn7LocPzjty0gc6l\n9OIqeBSIq2m4zngI5RlT2kV/WGDhGE5LOC4gTOOTWR7pYLVB6UUYAy6LBgY87idn\nnqUDwYjqr1u8/nTFZI5KeieyBSoAevQyTRAptzZnIRj0bnt9BmpnOADIrdG5+V4H\nzpSwIRSvPwoVTB6ClzY+OJYOWxEygOsqc9LTEglH+AxOtDRW9M9KM7sdZjEU3w4K\nH+4UCBwlTF+STBTVRlbwV55f+kAI2xKUpgDsdE3keR+GzSzrYaVsKGUpnS49LbVd\nyFhTnnvqGm21HT2vKu+kBP2KpdcZ2RksCSKUpdYC1bU1mIej5NGm0h1JOGBOV1qD\n84O+1WYKVj1Qkx8H6EbbzByOYUKegDhtKOsb6+b6MneI/c5w3HK5zYXeLV7Q5Go2\njT9JtbUzjAnU82SexJS4bR1Ky48HKZ8U6lJnnpLN2F5KgLwv17dYR9Iq1Z/Wjgwh\nqSu5/XT6xWYxzWtW5/L7loD7L2WhCkMFypZ0XVVziLHujzPqkJs0u5fAl26anRsR\npjm0jWppGkMyxWW0JwLKEA5RNClFgpYnRc/I6nWWKx0Z8dyY8ErboFcfPXEhh89w\nWJPVBfIMptSvuUGmX+mUrHSFLkiFx09YtSZo8ltAYERcha8xoWk=\n=idyQ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb",
          "sha": "ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ab233255d444ccf6ffe4a45cb02bfc3e5fb71bdb"
        }
      ],
      "message": "coins: add PeekCoin()\n\nIntroduce a helper to look up a Coin through a stack of CCoinsViewCache layers without populating parent caches.\n\nThis is useful for ephemeral views (e.g. during ConnectBlock) that want to avoid polluting CoinsTip() when validating invalid blocks.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-27T05:01:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-24T07:00:10Z"
      },
      "sha": "17c07c8bbdba15ed40b7a387077ba4a85f09821c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ5ZGFhZTU0ZjExMTU2OGFlODIyMGFjNzZiYzVjYTc4OTgxOTJlYWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9daae54f111568ae8220ac76bc5ca7898192eae",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d9daae54f111568ae8220ac76bc5ca7898192eae",
      "tree": {
        "sha": "c0c6263520f192afcd3972c333cd0ab88a17ecae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0c6263520f192afcd3972c333cd0ab88a17ecae"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0c6263520f192afcd3972c333cd0ab88a17ecae\nparent 17c07c8bbdba15ed40b7a387077ba4a85f09821c\nauthor Andrew Toth <andrewstoth@gmail.com> 1766449159 -0500\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769490112 -0500\n\ncoins: don't mutate main cache when connecting block\n\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads\ncoins without mutating the underlying cache via `FetchCoin()`.\n\nUse `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\n\nThis is the foundation for async input fetching, where worker threads must not\nmutate shared state.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml4RsAACgkQYAB6/Ik4\nsBiazw//clhpHSP+jU5NBG0waiwpWzF/hBDh8MjnacuWpAVxV0tASesyNPbGZOA/\n2Bx20eYAyeIgufNyvb6wGvTGH6xigajb9hBhpBcNIVlpfdLfaYRUQZ2o4mM54tKw\nJDEGvjjgzb6f1T1lKWO9ybILKXDWEOwtfz9rIanMFrPgiLsQMBPmD/SomOLQb9EH\nvSdOg36TpBWV3lHdMH6P3sZOF6DxPaCN/wNTAUIOs5VqWWjTJ3tkbEdc3+Jean3S\nHa/DZcNJ5dmkpqypWCD1z1gBEpU3dThT6fX9U9GlAOG5iCjowCjn7sGDVEPNFjCh\nYeIzP+K2inLvxgiPyk0CcP0Z6kZvP7rPuXL/Sz4kx8zz64nLXCDTr9QtCGGuVtCP\n1MjYjxmsqWYPK+ojJhOCpGtcNpCMvQFRtPSF/B1JpK3WaOXOb+nL9adw5qabzkea\nBFRBAFOKcV1GhMAEs9twS4btvYvoLv+bxpq4A0K4gmqcFRuJMrX/WXlnzV8rdfUu\nBZIhBpuKwVj3B2tmWkaE0eX+dX7nQMYOrfj452y9cJUQvO2HGViu4sDs5RkYWyzq\n7HQ9Yu74hAsPLQEHL6GUTjoXbVmZ/ev1LERH5o4DGnCeXGuNh/aby/RmgU28p//P\nbTOdeTKImij5Y5Mudg/0TFXIj9Oef7E/z/CrIxIK52MQlu8bDPs=\n=Wgi4\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/17c07c8bbdba15ed40b7a387077ba4a85f09821c",
          "sha": "17c07c8bbdba15ed40b7a387077ba4a85f09821c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/17c07c8bbdba15ed40b7a387077ba4a85f09821c"
        }
      ],
      "message": "coins: don't mutate main cache when connecting block\n\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads\ncoins without mutating the underlying cache via `FetchCoin()`.\n\nUse `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\n\nThis is the foundation for async input fetching, where worker threads must not\nmutate shared state.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-27T05:01:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-12-23T00:19:19Z"
      },
      "sha": "d9daae54f111568ae8220ac76bc5ca7898192eae"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJmMTAwYjE2YjdiYjA5NTcyZWQzYjA0YWExNDg0NTIzYWY3NTA5ZDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "tree": {
        "sha": "a7bd16ef9ee508acaddf57bd4b2770712531da43",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a7bd16ef9ee508acaddf57bd4b2770712531da43"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a7bd16ef9ee508acaddf57bd4b2770712531da43\nparent d9daae54f111568ae8220ac76bc5ca7898192eae\nauthor Andrew Toth <andrewstoth@gmail.com> 1769385221 -0500\ncommitter Andrew Toth <andrewstoth@gmail.com> 1769490112 -0500\n\ntest: assert CoinsTip is not mutated after invalid ConnectBlock\n\nAdd a new integration test to verify that using\nCoinsViewCacheNonMutating does indeed not mutate the main cache\nduring validation for an invalid block.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAml4RsAACgkQYAB6/Ik4\nsBiS4A/+NHmc3b0I0pw1z2jmhrV9+w2Y2J5uvNSWKuAPKZ/G/3IQMDq2NoWbkSCv\nT4CP9eQ4ib1KmV2DXxc89MELhT3T6cbf5LDjvisHiFlZBPW0308Mb5eCwdssDtpF\nXowaAbqszaV28ASxrZcBHhBUMaETfg0/Bn/QH/AK2BXM5Qt7gex5+5GT7+18E/zP\n35LEBNF1ZuQLk57Fwf4LREm8XaJ+nCwJtruutwIh5E0NtswjGa/oX3VG06zN2Fd8\nLCfexMWLe99Fr3X1BZM9vxmUuJUI4rYXvJgGpAjRotRd4TKxHC5zhac2FBUhgyst\nM4mmSWx7/VwoI+OA7VxnBkwzYF1OrQwxmzGqMXIYnhnDhHKi/+kT4HDwwBPZqe77\nuxbVGNXZtvYyq5YlzjxBmy4e1xOJXeIX/Q7XuMVGXnhvaXvc61p6mgQ96f0FtvVs\nGRHufLlnFwF9pX329GfJfWUGOfYruWKq1KlfUQYiKPslPitxMS7tf7Km2viJRBYr\nTSkM6ck6duvR/MJqC+MciQ5Hup18yULyBNM/4FtooFHRbx1UXRu54XRGKQ1GMixc\nUwJDsAijS+V5ob42SLFjIq1GpwcdvNPb6Vt1TYTGDVXUbgKU876A10Sz8C5gUKPW\n4kIq4pu6DItUuUxQGEE8gpgqP3EMzuxGpAXRzlQT/7tVD2y68Mg=\n=EbCX\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9daae54f111568ae8220ac76bc5ca7898192eae",
          "sha": "d9daae54f111568ae8220ac76bc5ca7898192eae",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d9daae54f111568ae8220ac76bc5ca7898192eae"
        }
      ],
      "message": "test: assert CoinsTip is not mutated after invalid ConnectBlock\n\nAdd a new integration test to verify that using\nCoinsViewCacheNonMutating does indeed not mutate the main cache\nduring validation for an invalid block.\n\nCo-authored-by: l0rinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-27T05:01:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2026-01-25T23:53:41Z"
      },
      "sha": "2f100b16b7bb09572ed3b04aa1484523af7509d9"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22307060936,
      "node_id": "HRFPE_lADOABII587geGK_zwAAAAUxmrzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22307060936",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "created_at": "2026-01-27T05:02:19Z"
    },
    {
      "event": "commented",
      "id": 3803134477,
      "node_id": "IC_kwDOABII587irzoN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3803134477",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T05:03:59Z",
      "updated_at": "2026-01-27T05:03:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks again for your review @l0rinc. I took most of your suggestions. I also re-added `CCoinsViewErrorCatcher::PeekCoin` (thanks @willcl-ark).\r\n\r\n`git diff 8e074187a57220c596eb124091714302903a07cc..2f100b16b7bb09572ed3b04aa1484523af7509d9`",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3803134477",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    },
    {
      "event": "mentioned",
      "id": 22307084852,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUxmxo0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22307084852",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T05:04:01Z"
    },
    {
      "event": "subscribed",
      "id": 22307084863,
      "node_id": "SE_lADOABII587geGK_zwAAAAUxmxo_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22307084863",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T05:04:01Z"
    },
    {
      "event": "mentioned",
      "id": 22307084879,
      "node_id": "MEE_lADOABII587geGK_zwAAAAUxmxpP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22307084879",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T05:04:01Z"
    },
    {
      "event": "subscribed",
      "id": 22307084888,
      "node_id": "SE_lADOABII587geGK_zwAAAAUxmxpY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22307084888",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T05:04:01Z"
    },
    {
      "event": "commented",
      "id": 3804058832,
      "node_id": "IC_kwDOABII587ivVTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3804058832",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T09:22:06Z",
      "updated_at": "2026-01-27T09:22:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 2f100b16b7bb09572ed3b04aa1484523af7509d9\r\n\r\nIntegration test was added to validate on a higher level that rejected blocks don't cache, error catcher (temporarily?) extended with `PeekCoin`, doc updated to clarify that `FetchCoin` fills the cache, and test helpers are hidden behind anonymous namespace to avoid pollution.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3804058832",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34165"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657681365",
      "pull_request_review_id": 3623089900,
      "id": 2657681365,
      "node_id": "PRRC_kwDOABII586eaP_V",
      "diff_hunk": "@@ -2978,7 +2979,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n     // Apply the block atomically to the chain state.\n     const auto time_start{SteadyClock::now()};\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "original_commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I tried understanding why this was added to `DisconnectTip`, since every indication was that this is about block connection:\r\n> * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\r\n\r\nSo how are the new tests passing if the implementation is completely broken? It seems we're only testing `CoinsViewCacheNonMutating` in isolation but there are no tests added to check it's actual integration.",
      "created_at": "2026-01-02T13:01:04Z",
      "updated_at": "2026-01-02T13:28:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2657681365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657681365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657863730",
      "pull_request_review_id": 3623301877,
      "id": 2657863730,
      "node_id": "PRRC_kwDOABII586ea8gy",
      "diff_hunk": "@@ -2978,7 +2979,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n     // Apply the block atomically to the chain state.\n     const auto time_start{SteadyClock::now()};\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "original_commit_id": "9739ce6b10314b098b16886418781275548dbdcc",
      "in_reply_to_id": 2657681365,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was an oopsie.\r\nAdded `CoinsViewCacheNonMutating` to `ConnectBlock` and removed from `DisconnectBlock`.",
      "created_at": "2026-01-02T15:00:09Z",
      "updated_at": "2026-01-02T15:00:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2657863730",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2657863730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2982,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659143724",
      "pull_request_review_id": 3624557779,
      "id": 2659143724,
      "node_id": "PRRC_kwDOABII586ef1As",
      "diff_hunk": "@@ -0,0 +1,143 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    Txid prevhash{Txid::FromUint256(uint256{1})};\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        prevhash = tx.GetHash();",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 1,
      "original_position": 37,
      "commit_id": "9a37b19538a423ea1e15f85700cff5b9a7ea2e3c",
      "original_commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This seems like a leftover.",
      "created_at": "2026-01-03T20:49:54Z",
      "updated_at": "2026-01-03T20:59:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2659143724",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659143724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 37,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659145764",
      "pull_request_review_id": 3624557779,
      "id": 2659145764,
      "node_id": "PRRC_kwDOABII586ef1gk",
      "diff_hunk": "@@ -0,0 +1,143 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 1,
      "original_position": 23,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "7a6e6160cbdc4a0a9e5c7afac3c73e7ce1221e94",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I understand that we want this to be realistic, but we could simplify considerably if we just returned the outpoints here:\n```C++\nstatic std::vector<COutPoint> CreateOutpoints() noexcept\n{\n    static constexpr uint32_t NUM_OUTPOINTS{100};\n    std::vector<COutPoint> outpoints;\n    outpoints.reserve(NUM_OUTPOINTS);\n\n    for (const auto i : std::views::iota(uint32_t{1}, NUM_OUTPOINTS + 1)) {\n        outpoints.emplace_back(Txid::FromUint256(uint256(i)), /*nIn=*/0);\n    }\n\n    return outpoints;\n}\n```\n\nIf you disagree, just resolve without a comment.",
      "created_at": "2026-01-03T20:54:49Z",
      "updated_at": "2026-01-03T20:59:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2659145764",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2659145764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662558942",
      "pull_request_review_id": 3628136296,
      "id": 2662558942,
      "node_id": "PRRC_kwDOABII586es2ze",
      "diff_hunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    {\n+        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n+        if (!inserted) return ret;",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 22,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hmm, we're we're duplicating the `FetchCoin` implementation here - and also making it virtual which introduces a slight regression on the hot path.\nCould we extract only the part that changes?\nI think we can simplify it by adding a virtual `GetCoinFromBase` which either calls `base->GetCoin(outpoint)` (default impl) or in `CoinsViewCacheNonMutating` it could be overwritten with the new `base->PeekCoin(outpoint)`. That way only the `if (inserted)` branch would pay for virtual dispatch and there would be no duplicated `FetchCoin` logic, something like:\n```patch\ndiff --git a/src/coins.cpp b/src/coins.cpp\n--- a/src/coins.cpp\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coins.cpp\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -59,10 +59,15 @@\n     return memusage::DynamicUsage(cacheCoins) + cachedCoinsUsage;\n }\n \n+std::optional<Coin> CCoinsViewCache::GetCoinFromBase(const COutPoint& outpoint) const\n+{\n+    return base->GetCoin(outpoint);\n+}\n+\n CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const {\n     const auto [ret, inserted] = cacheCoins.try_emplace(outpoint);\n     if (inserted) {\n-        if (auto coin{base->GetCoin(outpoint)}) {\n+        if (auto coin{GetCoinFromBase(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n             if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins\ndiff --git a/src/coins.h b/src/coins.h\n--- a/src/coins.h\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coins.h\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -382,6 +382,8 @@\n     /* Cached dynamic memory usage for the inner Coin objects. */\n     mutable size_t cachedCoinsUsage{0};\n \n+    virtual std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const;\n+\n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n \n@@ -489,7 +491,7 @@\n      * @note this is marked const, but may actually append to `cacheCoins`, increasing\n      * memory usage.\n      */\n-    virtual CCoinsMap::iterator FetchCoin(const COutPoint &outpoint) const;\n+    CCoinsMap::iterator FetchCoin(const COutPoint &outpoint) const;\n };\n \n //! Utility function to add all of a transaction's outputs to a cache.\ndiff --git a/src/coinsviewcachenonmutating.h b/src/coinsviewcachenonmutating.h\n--- a/src/coinsviewcachenonmutating.h\t(revision 85b20448640f8209e453019c3e1494c1ae229d74)\n+++ b/src/coinsviewcachenonmutating.h\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n@@ -9,28 +9,16 @@\n #include <primitives/transaction.h>\n \n /**\n- * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * CCoinsViewCache subclass that does not call GetCoin on base, so base will not be mutated before Flush.\n  * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n- * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ * It provides the same interface as CCoinsViewCache, overriding GetCoinFromBase().\n  */\n class CoinsViewCacheNonMutating : public CCoinsViewCache\n {\n private:\n-    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const override\n     {\n-        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n-        if (!inserted) return ret;\n-\n-        // TODO: Remove spent checks once we no longer return spent coins in coinscache_sim CoinsViewBottom.\n-        if (auto coin{base->PeekCoin(outpoint)}; coin && !coin->IsSpent()) {\n-            ret->second.coin = std::move(*coin);\n-        } else {\n-            cacheCoins.erase(ret);\n-            return cacheCoins.end();\n-        }\n-\n-        cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-        return ret;\n+        return base->PeekCoin(outpoint);\n     }\n \n public:\n```",
      "created_at": "2026-01-05T19:21:58Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662558942",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662558942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": 21,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662620903",
      "pull_request_review_id": 3628136296,
      "id": 2662620903,
      "node_id": "PRRC_kwDOABII586etF7n",
      "diff_hunk": "@@ -3098,7 +3099,7 @@ bool Chainstate::ConnectTip(\n     LogDebug(BCLog::BENCH, \"  - Load block from disk: %.2fms\\n\",\n              Ticks<MillisecondsDouble>(time_2 - time_1));\n     {\n-        CCoinsViewCache view(&CoinsTip());\n+        CoinsViewCacheNonMutating view(&CoinsTip());",
      "path": "src/validation.cpp",
      "position": 177,
      "original_position": 13,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "here or in a follow-up we could add this to `TestBlockValidity` as well, where it would be even more relevant since itâ€™s invoked with without PoW checks (so your PR arguments apply here even more)",
      "created_at": "2026-01-05T19:48:37Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662620903",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662620903"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3102,
      "original_line": 3102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662733404",
      "pull_request_review_id": 3628136296,
      "id": 2662733404,
      "node_id": "PRRC_kwDOABII586ethZc",
      "diff_hunk": "@@ -0,0 +1,140 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+}",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 107,
      "original_position": 92,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Checked the coverage of this and compared it with the suggested `CCoinsViewCache::GetCoinFromBase` - existing `FetchCoin` is covered that way.\nWe could extend the coverage with `HaveCoin()`/`GetCoin()` as well, to check that they also do not populate the parent cache when reading inputs from disk, and that flushing an ephemeral `CoinsViewCacheNonMutating` layer propagates spentness to its parent:\n```patch\ndiff --git a/src/test/coinsviewcachenonmutating_tests.cpp b/src/test/coinsviewcachenonmutating_tests.cpp\n--- a/src/test/coinsviewcachenonmutating_tests.cpp\t(revision c3b34ec796a3fd6e34e0dfb862c61bc298ba8d6f)\n+++ b/src/test/coinsviewcachenonmutating_tests.cpp\t(revision 3e8676d49ecf9e3c12cd641ce655e74f85f3a6e6)\n@@ -82,6 +82,13 @@\n     PopulateView(block, db);\n     CCoinsViewCache main_cache{&db};\n     CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n     CheckCache(block, view);\n     // Check that no coins have been moved up to main cache from db\n     for (const auto& tx : block.vtx) {\n@@ -89,6 +96,12 @@\n             BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n         }\n     }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n }\n \n BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n```\n",
      "created_at": "2026-01-05T20:35:53Z",
      "updated_at": "2026-01-05T20:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2662733404",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2662733404"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": 82,
      "original_start_line": 78,
      "start_side": "RIGHT",
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2678764767",
      "pull_request_review_id": 3646995468,
      "id": 2678764767,
      "node_id": "PRRC_kwDOABII586fqrTf",
      "diff_hunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via FetchCoin, so base will not be mutated before Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    CCoinsMap::iterator FetchCoin(const COutPoint& outpoint) const override\n+    {\n+        auto [ret, inserted]{cacheCoins.try_emplace(outpoint)};\n+        if (!inserted) return ret;",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 22,
      "commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "original_commit_id": "7fab35c24d7a88d45710491e275f2aaf6532e7d0",
      "in_reply_to_id": 2662558942,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nice, done.",
      "created_at": "2026-01-10T15:40:37Z",
      "updated_at": "2026-01-10T15:40:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2678764767",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2678764767"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": 21,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721462578",
      "pull_request_review_id": 3697832211,
      "id": 2721462578,
      "node_id": "PRRC_kwDOABII586iNjky",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Do we want to add a `CCoinsViewErrorCatcher` overrid for `PeekCoin` as we do for [`GetCoin` and `HaveCoin`](https://github.com/andrewtoth/bitcoin/blob/2e67c5b604d2cf2e56db6b5d2906391d22113941/src/coins.cpp#L380-L406) or is this omitted intentionally?",
      "created_at": "2026-01-23T14:35:58Z",
      "updated_at": "2026-01-23T14:50:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721462578",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721462578"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721476346",
      "pull_request_review_id": 3697832211,
      "id": 2721476346,
      "node_id": "PRRC_kwDOABII586iNm76",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the FetchCoin private method.",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\"overriding the GetCoinFromBase method.\"?",
      "created_at": "2026-01-23T14:39:12Z",
      "updated_at": "2026-01-23T14:50:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2721476346",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2721476346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724347964",
      "pull_request_review_id": 3701986936,
      "id": 2724347964,
      "node_id": "PRRC_kwDOABII586iYkA8",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good catch :smile:! Added, thanks.",
      "created_at": "2026-01-24T16:44:02Z",
      "updated_at": "2026-01-24T16:44:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2724347964",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724347964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724358983",
      "pull_request_review_id": 3702028045,
      "id": 2724358983,
      "node_id": "PRRC_kwDOABII586iYmtH",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Note that `CCoinsViewErrorCatcher` will be removed in https://github.com/bitcoin/bitcoin/pull/34132. So whichever is merged first will have to rebase.",
      "created_at": "2026-01-24T16:53:29Z",
      "updated_at": "2026-01-24T16:53:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2724358983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2724358983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725907704",
      "pull_request_review_id": 3704233057,
      "id": 2725907704,
      "node_id": "PRRC_kwDOABII586iegz4",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Not sure I understand why this was needed, the only way this has database access is through `GetCoin`:\r\n```\r\n\tframe #0: 0x000000010381616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at txdb.cpp:70:14\r\n    frame #1: 0x000000010419da40 test_bitcoin`CCoinsView::PeekCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at coins.cpp:17:93\r\n    frame #2: 0x000000010419dea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:36:18\r\n    frame #3: 0x00000001041a3ee4 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0::operator()(this=0x000000016dc23918) const at coins.cpp:413:87\r\n    frame #4: 0x00000001041a12e0 test_bitcoin`std::__1::optional<Coin> ExecuteBackedWrapper<std::__1::optional<Coin>, CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0>(func=(unnamed class) @ 0x000000016dc23918, err_callbacks=size=0) at coins.cpp:387:16\r\n    frame #5: 0x00000001041a1250 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:413:12\r\n    frame #6: 0x000000010419e2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x000000010954aae0, outpoint=0x000000016dc24a6c) const at coins.cpp:51:18\r\n    frame #7: 0x0000000102640b38 test_bitcoin`CoinsViewCacheNonMutating::GetCoinFromBase(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coinsviewcachenonmutating.h:22:22\r\n    frame #8: 0x000000010419e8b8 test_bitcoin`CCoinsViewCache::FetchCoin(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coins.cpp:73:23\r\n    frame #9: 0x000000010419f994 test_bitcoin`CCoinsViewCache::HaveCoin(this=0x000000016dc251e8, outpoint=0x000000016dc24a6c) const at coins.cpp:189:36\r\n```\r\nand without this error catcher we're basically getting the same:\r\n```\r\n\tframe #0: 0x000000010447616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at txdb.cpp:70:14\r\n    frame #1: 0x0000000104dfda40 test_bitcoin`CCoinsView::PeekCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at coins.cpp:19:12\r\n    frame #2: 0x0000000104dfdea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010a14ab38, outpoint=0x000000016cfc4a6c) const at coins.cpp:39:18\r\n    frame #3: 0x0000000104dfe2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x0000000846008c00, outpoint=0x000000016cfc4a6c) const at coins.cpp:54:18\r\n    frame #4: 0x00000001032a0b38 test_bitcoin`CoinsViewCacheNonMutating::GetCoinFromBase(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coinsviewcachenonmutating.h:22:22\r\n    frame #5: 0x0000000104dfe8b8 test_bitcoin`CCoinsViewCache::FetchCoin(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coins.cpp:76:23\r\n    frame #6: 0x0000000104dff994 test_bitcoin`CCoinsViewCache::HaveCoin(this=0x000000016cfc51e8, outpoint=0x000000016cfc4a6c) const at coins.cpp:192:36\r\n```\r\n(except that the frames are a lot cleaner)",
      "created_at": "2026-01-25T20:46:54Z",
      "updated_at": "2026-01-25T21:05:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725907704",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725907704"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917004",
      "pull_request_review_id": 3704233057,
      "id": 2725917004,
      "node_id": "PRRC_kwDOABII586iejFM",
      "diff_hunk": "@@ -14,6 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n+std::optional<Coin> CCoinsView::PeekCoin(const COutPoint& outpoint) const noexcept { return GetCoin(outpoint); }",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I have mixed feelings about adding `noexcept` here, since DB reads can still throw `dbwrapper_error` - which should be fatal, but `noexcept` muddies it a bit since this can theoretically `std::terminate` before `CCoinsViewErrorCatcher` has a chance to react.\n\nInstead of adding it only here (and not to the equivalent `GetCoin`), I suggest we add it only after https://github.com/bitcoin/bitcoin/pull/34132 is merged (I can add it there as a last commit if you agree it belongs there)",
      "created_at": "2026-01-25T20:59:28Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725917004",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917004"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917466",
      "pull_request_review_id": 3704233057,
      "id": 2725917466,
      "node_id": "PRRC_kwDOABII586iejMa",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 112,
      "original_position": 108,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "would it make sense to have at least one that's not in memory, just to have some variety?",
      "created_at": "2026-01-25T21:00:08Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725917466",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725917466"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725918044",
      "pull_request_review_id": 3704233057,
      "id": 2725918044,
      "node_id": "PRRC_kwDOABII586iejVc",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 43,
      "original_position": 41,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: these helpers could go to anonymous namespace to avoid global linkage in the test binary.",
      "created_at": "2026-01-25T21:01:00Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725918044",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725918044"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725919735",
      "pull_request_review_id": 3704233057,
      "id": 2725919735,
      "node_id": "PRRC_kwDOABII586iejv3",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase private method.",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 15,
      "commit_id": "0ab4fca17353546abb8f5552c0c94a4b093b4d15",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "GetCoinFromBase is protected now: https://github.com/bitcoin/bitcoin/pull/34165/changes#diff-095ce1081a930998a10b37358fae5499ac47f8cb6f25f5df5d88e920a54e0341R386",
      "created_at": "2026-01-25T21:03:26Z",
      "updated_at": "2026-01-25T21:05:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725919735",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2725919735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039192",
      "pull_request_review_id": 3704334887,
      "id": 2726039192,
      "node_id": "PRRC_kwDOABII586ifA6Y",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ah true, it is not needed. So, reverted adding it. This way we won't conflict with #34132.",
      "created_at": "2026-01-26T00:02:38Z",
      "updated_at": "2026-01-26T00:02:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726039192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039348",
      "pull_request_review_id": 3704335012,
      "id": 2726039348,
      "node_id": "PRRC_kwDOABII586ifA80",
      "diff_hunk": "@@ -14,6 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n+std::optional<Coin> CCoinsView::PeekCoin(const COutPoint& outpoint) const noexcept { return GetCoin(outpoint); }",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": 2725917004,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Removed noexcept for PeekCoin.",
      "created_at": "2026-01-26T00:02:51Z",
      "updated_at": "2026-01-26T00:02:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726039348",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726039348"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726043535",
      "pull_request_review_id": 3704339159,
      "id": 2726043535,
      "node_id": "PRRC_kwDOABII586ifB-P",
      "diff_hunk": "@@ -0,0 +1,157 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <coins.h>\n+#include <coinsviewcachenonmutating.h>\n+#include <primitives/block.h>\n+#include <primitives/transaction.h>\n+#include <primitives/transaction_identifier.h>\n+#include <txdb.h>\n+#include <uint256.h>\n+#include <util/byte_units.h>\n+#include <util/hasher.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+#include <cstdint>\n+#include <cstring>\n+#include <ranges>\n+\n+BOOST_AUTO_TEST_SUITE(coinsviewcachenonmutating_tests)\n+\n+static CBlock CreateBlock() noexcept\n+{\n+    static constexpr auto NUM_TXS{100};\n+    CBlock block;\n+    CMutableTransaction coinbase;\n+    coinbase.vin.emplace_back();\n+    block.vtx.push_back(MakeTransactionRef(coinbase));\n+\n+    for (const auto i : std::views::iota(1, NUM_TXS)) {\n+        CMutableTransaction tx;\n+        Txid txid{Txid::FromUint256(uint256(i))};\n+        tx.vin.emplace_back(txid, 0);\n+        block.vtx.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    return block;\n+}\n+\n+void PopulateView(const CBlock& block, CCoinsView& view, bool spent = false)\n+{\n+    CCoinsViewCache cache{&view};\n+    cache.SetBestBlock(uint256::ONE);\n+\n+    for (const auto& tx : block.vtx | std::views::drop(1)) {\n+        for (const auto& in : tx->vin) {\n+            Coin coin{};\n+            if (!spent) coin.out.nValue = 1;\n+            cache.EmplaceCoinInternalDANGER(COutPoint{in.prevout}, std::move(coin));\n+        }\n+    }\n+\n+    cache.Flush();\n+}\n+\n+void CheckCache(const CBlock& block, const CCoinsViewCache& cache)\n+{\n+    uint32_t counter{0};\n+\n+    for (const auto& tx : block.vtx) {\n+        if (tx->IsCoinBase()) {\n+            BOOST_CHECK(!cache.HaveCoinInCache(tx->vin[0].prevout));\n+        } else {\n+            for (const auto& in : tx->vin) {\n+                const auto& outpoint{in.prevout};\n+                const auto& first{cache.AccessCoin(outpoint)};\n+                const auto& second{cache.AccessCoin(outpoint)};\n+                BOOST_CHECK_EQUAL(&first, &second);\n+                ++counter;\n+                BOOST_CHECK(cache.HaveCoinInCache(outpoint));\n+            }\n+        }\n+    }\n+    BOOST_CHECK_EQUAL(cache.GetCacheSize(), counter);\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_db)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    PopulateView(block, db);\n+    CCoinsViewCache main_cache{&db};\n+    CoinsViewCacheNonMutating view{&main_cache};\n+    const auto& outpoint{block.vtx[1]->vin[0].prevout};\n+\n+    BOOST_CHECK(view.HaveCoin(outpoint));\n+    BOOST_CHECK(view.GetCoin(outpoint).has_value());\n+    BOOST_CHECK(!main_cache.HaveCoinInCache(outpoint));\n+\n+    CheckCache(block, view);\n+    // Check that no coins have been moved up to main cache from db\n+    for (const auto& tx : block.vtx) {\n+        for (const auto& in : tx->vin) {\n+            BOOST_CHECK(!main_cache.HaveCoinInCache(in.prevout));\n+        }\n+    }\n+\n+    view.SetBestBlock(uint256::ONE);\n+    BOOST_CHECK(view.SpendCoin(outpoint));\n+    view.Flush();\n+    BOOST_CHECK(!main_cache.PeekCoin(outpoint).has_value());\n+}\n+\n+BOOST_AUTO_TEST_CASE(fetch_inputs_from_cache)\n+{\n+    const auto block{CreateBlock()};\n+    CCoinsViewDB db{{.path = \"\", .cache_bytes = 1_MiB, .memory_only = true}, {}};",
      "path": "src/test/coinsviewcachenonmutating_tests.cpp",
      "position": 112,
      "original_position": 108,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "3a2cfbea1957f1eed6d97b6f8924f13100e11b1c",
      "in_reply_to_id": 2725917466,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure about this. These are unit tests specific to the `CoinsViewCacheNonMutating`, not for the `CCoinsViewDB`. We should probably have unit tests specific to `CCoinsViewDB` and test them for in-memory and not.",
      "created_at": "2026-01-26T00:08:56Z",
      "updated_at": "2026-01-26T00:08:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2726043535",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2726043535"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728275219",
      "pull_request_review_id": 3706829514,
      "id": 2728275219,
      "node_id": "PRRC_kwDOABII586ini0T",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase protected method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const noexcept override",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 20,
      "original_position": 20,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think we should also remove the `noexcept` from this for the same reasons: https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2725917004",
      "created_at": "2026-01-26T16:19:04Z",
      "updated_at": "2026-01-26T16:47:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728275219",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728275219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728301335",
      "pull_request_review_id": 3706829514,
      "id": 2728301335,
      "node_id": "PRRC_kwDOABII586inpMX",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Is it fair to state that `GetCoin` is not called when in fact what we're avoiding is `FetchCoin`\nhttps://github.com/bitcoin/bitcoin/blob/1cc58d3a0c653ac30df04d1010a3cf84c6bc307a/src/coins.cpp#L52-L53\n\nBut we *are* calling `GetCoin` from `PeekCoin`, see:\n```bash\n  frame #0: 0x000000010447616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at txdb.cpp:70:14                                                  \n  frame #1: 0x0000000104dfda40 test_bitcoin`CCoinsView::PeekCoin(this=0x000000010a14aaf0, outpoint=0x000000016cfc4a6c) const at coins.cpp:19:12                                                  \n  frame #2: 0x0000000104dfdea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010a14ab38, outpoint=0x000000016cfc4a6c) const at coins.cpp:39:18                                            \n  frame #3: 0x0000000104dfe2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x0000000846008c00, outpoint=0x000000016cfc4a6c) const at coins.cpp:54:18 \n```\n\n```suggestion\n * CCoinsViewCache subclass that uses PeekCoin instead of GetCoin when fetching from base, avoiding FetchCoin mutation on parent cache layers.\n```\n(obviously a few other changes are needed besides this line, if you agree with my observation)",
      "created_at": "2026-01-26T16:25:03Z",
      "updated_at": "2026-01-26T16:47:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728301335",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728301335"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728478422",
      "pull_request_review_id": 3707063122,
      "id": 2728478422,
      "node_id": "PRRC_kwDOABII586ioUbW",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase protected method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const noexcept override",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 20,
      "original_position": 20,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728275219,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can you clarify the reasoning in the parent comment please?\r\n\r\n> since DB reads can still throw dbwrapper_error - which should be fatal, but noexcept muddies it a bit since this can theoretically std::terminate before CCoinsViewErrorCatcher has a chance to react.\r\n\r\nI'm not sure I understand this. The db reads will be caught by the error catcher and we abort before returning here.",
      "created_at": "2026-01-26T17:08:13Z",
      "updated_at": "2026-01-26T17:08:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728478422",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728478422"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728484550",
      "pull_request_review_id": 3707070241,
      "id": 2728484550,
      "node_id": "PRRC_kwDOABII586ioV7G",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "That comment update is an improvement. What other changes are needed?",
      "created_at": "2026-01-26T17:09:42Z",
      "updated_at": "2026-01-26T17:09:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728484550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728484550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728604236",
      "pull_request_review_id": 3707206140,
      "id": 2728604236,
      "node_id": "PRRC_kwDOABII586iozJM",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase protected method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const noexcept override",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 20,
      "original_position": 20,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728275219,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I might be completely wrong here, but based on previous frames:\r\n```\r\nframe #0: 0x000000010381616c test_bitcoin`CCoinsViewDB::GetCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at txdb.cpp:70:14\r\nframe #1: 0x000000010419da40 test_bitcoin`CCoinsView::PeekCoin(this=0x0000000109549fe0, outpoint=0x000000016dc24a6c) const at coins.cpp:17:93\r\nframe #2: 0x000000010419dea0 test_bitcoin`CCoinsViewBacked::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:36:18\r\nframe #3: 0x00000001041a3ee4 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0::operator()(this=0x000000016dc23918) const at coins.cpp:413:87\r\nframe #4: 0x00000001041a12e0 test_bitcoin`std::__1::optional<Coin> ExecuteBackedWrapper<std::__1::optional<Coin>, CCoinsViewErrorCatcher::PeekCoin(COutPoint const&) const::$_0>(func=(unnamed class) @ 0x000000016dc23918, err_callbacks=size=0) at coins.cpp:387:16\r\nframe #5: 0x00000001041a1250 test_bitcoin`CCoinsViewErrorCatcher::PeekCoin(this=0x000000010954a028, outpoint=0x000000016dc24a6c) const at coins.cpp:413:12\r\nframe #6: 0x000000010419e2d0 test_bitcoin`CCoinsViewCache::PeekCoin(this=0x000000010954aae0, outpoint=0x000000016dc24a6c) const at coins.cpp:51:18\r\n```\r\n\r\nit seemed to me the error catcher can be earlier in the stack (not sure it applies to `GetCoinFromBase` as well), so it cannot catch calls that convert the exceptions to `std::terminate` on later child-frames - but if it doesn't, please ignore this.",
      "created_at": "2026-01-26T17:42:42Z",
      "updated_at": "2026-01-26T17:42:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728604236",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728604236"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728608839",
      "pull_request_review_id": 3707212131,
      "id": 2728608839,
      "node_id": "PRRC_kwDOABII586io0RH",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can you please check PR description and commit messages? I have just finished the reviews, can only do it myself tomorrow.",
      "created_at": "2026-01-26T17:43:41Z",
      "updated_at": "2026-01-26T17:43:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728608839",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728608839"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728653332",
      "pull_request_review_id": 3707264773,
      "id": 2728653332,
      "node_id": "PRRC_kwDOABII586io_IU",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "They all look ok to me, they mention not calling `FetchCoin` instead of `GetCoin`.",
      "created_at": "2026-01-26T17:56:30Z",
      "updated_at": "2026-01-26T18:04:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728653332",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728653332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728690651",
      "pull_request_review_id": 3707312538,
      "id": 2728690651,
      "node_id": "PRRC_kwDOABII586ipIPb",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> the const methods like GetCoin actually mutate cacheCoins internally\r\n\r\nI think these should also be updated, since it not all GetCoin implementations that are doing that, e.g. the database GetCoin doesn't, which is what PeekCoin is calling",
      "created_at": "2026-01-26T18:08:07Z",
      "updated_at": "2026-01-26T18:08:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728690651",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728690651"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728730206",
      "pull_request_review_id": 3707365033,
      "id": 2728730206,
      "node_id": "PRRC_kwDOABII586ipR5e",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think that sentence is pretty clear that it is describing the behavior of `CCoinsViewCache` and not `CCoinsView` subclasses in general. What would you prefer it gets changed to?",
      "created_at": "2026-01-26T18:18:43Z",
      "updated_at": "2026-01-26T18:18:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728730206",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728730206"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728771225",
      "pull_request_review_id": 3707414816,
      "id": 2728771225,
      "node_id": "PRRC_kwDOABII586ipb6Z",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Oh hmm it seems I misunderstood. From your frames @l0rinc it looks like we don't go through the error catcher all the way down to CCoinsViewDB::GetCoin. So, if `CCoinsViewDB::GetCoin` throws there it will bubble up all the way to `CCoinsViewCache::HaveCoin` caller and not abort inside the catcher as intended. Does that make sense?\r\n\r\nI will re-add the `PeekCoin` override in the error catcher.",
      "created_at": "2026-01-26T18:32:11Z",
      "updated_at": "2026-01-26T18:32:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2728771225",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2728771225"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2729014318",
      "pull_request_review_id": 3707714279,
      "id": 2729014318,
      "node_id": "PRRC_kwDOABII586iqXQu",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It's just that GetCoin isn't necessarily a problem, the eventual FetchCoin call is:\r\n```patch\r\n-When accessing coins via the CCoinsViewCache, the const methods like GetCoin actually mutate cacheCoins internally to cache entries when they are pulled from the backing db.\r\n+When accessing coins via the CCoinsViewCache, methods like GetCoin can call FetchCoin which actually mutate cacheCoins internally to cache entries when they are pulled from the backing db.\r\n```",
      "created_at": "2026-01-26T19:51:43Z",
      "updated_at": "2026-01-26T19:51:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2729014318",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2729014318"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2729146397",
      "pull_request_review_id": 3707872468,
      "id": 2729146397,
      "node_id": "PRRC_kwDOABII586iq3gd",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "You're right, we need it temporarily until https://github.com/bitcoin/bitcoin/pull/34132/changes#diff-cafbe1353eff6084b73fd3b6c3dee603e0827348fdd2fe12dfad1e01003a84edR69 migrates it to `CCoinsViewDB` - so we can add it here for safety and we can hopefully remove it in #34132 again.\r\nBut even in that case I wouldn't add `noexcept` to `PeekCoin` and `GetCoinFromBase` here - only after the database `GetCoin` is itself a `noexcept` (will add that to #34132).",
      "created_at": "2026-01-26T20:30:45Z",
      "updated_at": "2026-01-26T20:30:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2729146397",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2729146397"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730264200",
      "pull_request_review_id": 3709131001,
      "id": 2730264200,
      "node_id": "PRRC_kwDOABII586ivIaI",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 1,
      "original_position": 12,
      "commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728301335,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2026-01-27T05:04:10Z",
      "updated_at": "2026-01-27T05:04:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2730264200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730264200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730268602",
      "pull_request_review_id": 3709135428,
      "id": 2730268602,
      "node_id": "PRRC_kwDOABII586ivJe6",
      "diff_hunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_COINSVIEWCACHENONMUTATING_H\n+#define BITCOIN_COINSVIEWCACHENONMUTATING_H\n+\n+#include <coins.h>\n+#include <primitives/transaction.h>\n+\n+/**\n+ * CCoinsViewCache subclass that does not call GetCoin on base via GetCoinFromBase, so base will not be mutated before\n+ * Flush.\n+ * Only used in ConnectBlock to pass as an ephemeral view that can be reset if the block is invalid.\n+ * It provides the same interface as CCoinsViewCache, overriding the GetCoinFromBase protected method.\n+ */\n+class CoinsViewCacheNonMutating : public CCoinsViewCache\n+{\n+private:\n+    std::optional<Coin> GetCoinFromBase(const COutPoint& outpoint) const noexcept override",
      "path": "src/coinsviewcachenonmutating.h",
      "position": 20,
      "original_position": 20,
      "commit_id": "2f100b16b7bb09572ed3b04aa1484523af7509d9",
      "original_commit_id": "8e074187a57220c596eb124091714302903a07cc",
      "in_reply_to_id": 2728275219,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "From the frames you are showing, `CCoinsViewCache::PeekCoin` goes through `CCoinsViewErrorCatcher::PeekCoin` which will catch whatever is thrown in `CCoinsViewDB::GetCoin`. `GetCoinFromBase` is only available in `CCoinsViewCache`, which calls through `CCoinsViewErrorCatcher` for both `GetCoin` and `PeekCoin` and will therefore never throw an exception.",
      "created_at": "2026-01-27T05:06:33Z",
      "updated_at": "2026-01-27T05:06:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2730268602",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730268602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730270875",
      "pull_request_review_id": 3709138275,
      "id": 2730270875,
      "node_id": "PRRC_kwDOABII586ivKCb",
      "diff_hunk": "@@ -38,6 +40,14 @@ void CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& h\n std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n \n+std::optional<Coin> CCoinsViewCache::PeekCoin(const COutPoint& outpoint) const",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "2e67c5b604d2cf2e56db6b5d2906391d22113941",
      "original_commit_id": "725c7503450f9e891306d5cec0911f5cf1335d80",
      "in_reply_to_id": 2721462578,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I've removed `noexcept` from `PeekCoin` but opted to keep it for `GetCoinFromBase` (see https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2730268602).",
      "created_at": "2026-01-27T05:07:47Z",
      "updated_at": "2026-01-27T05:07:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34165#discussion_r2730270875",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2730270875"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34165"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515",
    "id": 984143455,
    "node_id": "PR_kwDOABII5846qNZf",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/25515",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/25515.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/25515.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/9c04c32101cd458c336de1d66ad296dc7f1cf35d",
    "number": 25515,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "net, test: Virtualise CConnman and add initial PeerManager unit tests",
    "user": {
      "login": "dergoegge",
      "id": 8077169,
      "node_id": "MDQ6VXNlcjgwNzcxNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dergoegge",
      "html_url": "https://github.com/dergoegge",
      "followers_url": "https://api.github.com/users/dergoegge/followers",
      "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
      "organizations_url": "https://api.github.com/users/dergoegge/orgs",
      "repos_url": "https://api.github.com/users/dergoegge/repos",
      "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dergoegge/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR creates an abstract `ConnectionsInterface` class that is used as an interface for interacting with the connection manager. The `PeerManager` is made to hold a reference to a `ConnectionsInterface` instead of `CConnman`, which makes it possible for us to mock the connection manager in the newly introduced `PeerManager` unit tests. Two initial unit tests are added for the version handshake and ping/pong logic.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2022-06-30T18:04:58Z",
    "updated_at": "2024-08-09T13:03:54Z",
    "closed_at": "2023-08-10T14:23:28Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "a99eb00855d762f2f466432d738c2fc40290b2fb",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "dergoegge:2022-06-virt-connman",
      "ref": "2022-06-virt-connman",
      "sha": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 315023492,
        "node_id": "MDEwOlJlcG9zaXRvcnkzMTUwMjM0OTI=",
        "name": "bitcoin",
        "full_name": "dergoegge/bitcoin",
        "owner": {
          "login": "dergoegge",
          "id": 8077169,
          "node_id": "MDQ6VXNlcjgwNzcxNjk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/dergoegge",
          "html_url": "https://github.com/dergoegge",
          "followers_url": "https://api.github.com/users/dergoegge/followers",
          "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
          "organizations_url": "https://api.github.com/users/dergoegge/orgs",
          "repos_url": "https://api.github.com/users/dergoegge/repos",
          "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/dergoegge/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/dergoegge/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/dergoegge/bitcoin",
        "archive_url": "https://api.github.com/repos/dergoegge/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/dergoegge/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/dergoegge/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/dergoegge/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/dergoegge/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/dergoegge/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/dergoegge/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/dergoegge/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/dergoegge/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/dergoegge/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/dergoegge/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/dergoegge/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/dergoegge/bitcoin/events",
        "forks_url": "https://api.github.com/repos/dergoegge/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/dergoegge/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/dergoegge/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/dergoegge/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/dergoegge/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/dergoegge/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/dergoegge/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/dergoegge/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/dergoegge/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/dergoegge/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/dergoegge/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/dergoegge/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/dergoegge/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/dergoegge/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/dergoegge/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/dergoegge/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:dergoegge/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/dergoegge/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/dergoegge/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/dergoegge/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/dergoegge/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/dergoegge/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/dergoegge/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/dergoegge/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/dergoegge/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/dergoegge/bitcoin/hooks",
        "svn_url": "https://github.com/dergoegge/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 251361,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-07T15:08:02Z",
        "created_at": "2020-11-22T11:41:30Z",
        "updated_at": "2024-08-07T07:50:14Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "6d4048468430d9d1fe5e7c5fcda13708879d1083",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35982,
        "stargazers_count": 77785,
        "watchers_count": 77785,
        "size": 265054,
        "default_branch": "master",
        "open_issues_count": 661,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-09T13:52:52Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-08-09T13:35:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
      }
    },
    "author_association": "MEMBER",
    "draft": true,
    "additions": 397,
    "deletions": 67,
    "changed_files": 5,
    "commits": 4,
    "review_comments": 25,
    "comments": 12
  },
  "events": [
    {
      "event": "labeled",
      "id": 6912967288,
      "node_id": "LE_lADOABII585M6xw_zwAAAAGcC4J4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6912967288",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-30T18:05:13Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 1171614818,
      "node_id": "IC_kwDOABII585F1Wxi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1171614818",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-30T19:50:44Z",
      "updated_at": "2023-04-19T16:12:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rajarshimaitra](https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1152333262) |\n| Concept ACK | [jnewbery](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1173474399), [jamesob](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1175229773), [naumenkogs](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1226927000), [fanquake](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1266933218), [theStack](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1279056559), [hernanmarino](https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1190434606), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1190475886), [jonatack](https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1515003669) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26837](https://github.com/bitcoin/bitcoin/pull/26837) (I2P network optimizations by vasild)\n* [#26441](https://github.com/bitcoin/bitcoin/pull/26441) (rpc, p2p: add `addpermissionflags` RPC and allow whitelisting outbound by brunoerg)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n* [#24748](https://github.com/bitcoin/bitcoin/pull/24748) (test/BIP324: functional tests for v2 P2P encryption by stratospher)\n* [#24545](https://github.com/bitcoin/bitcoin/pull/24545) (BIP324: Enable v2 P2P encrypted transport by dhruv)\n* [#24170](https://github.com/bitcoin/bitcoin/pull/24170) (p2p, rpc: Manual block-relay-only connections with addnode by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1171614818",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6914313313,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGcIAxh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6914313313",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-30T22:09:29Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6918128158,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGcWkIe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6918128158",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-01T12:22:44Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6918577596,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGcYR28",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6918577596",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-01T13:29:55Z"
    },
    {
      "event": "commented",
      "id": 1173474399,
      "node_id": "IC_kwDOABII585F8cxf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1173474399",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-04T07:51:28Z",
      "updated_at": "2022-07-04T07:51:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "Obvious concept ACK from me. This was one of the big motivators for #19398.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1173474399",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "labeled",
      "id": 6930127672,
      "node_id": "LE_lADOABII585M6xw_zwAAAAGdEVs4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6930127672",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-04T21:06:21Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6935520223,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGdY6Pf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6935520223",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T15:35:33Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6935556187,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGdZDBb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6935556187",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T15:40:28Z"
    },
    {
      "event": "unlabeled",
      "id": 6935670702,
      "node_id": "UNLE_lADOABII585M6xw_zwAAAAGdZe-u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6935670702",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T15:55:57Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1175229773,
      "node_id": "IC_kwDOABII585GDJVN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1175229773",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T16:03:58Z",
      "updated_at": "2022-07-05T16:03:58Z",
      "author_association": "MEMBER",
      "body": "Nice, concept ACK",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1175229773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "labeled",
      "id": 6978564796,
      "node_id": "LE_lADOABII585M6xw_zwAAAAGf9HK8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6978564796",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-12T15:14:34Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 7017805143,
      "node_id": "REFE_lADOABII585M6xw_zwAAAAGiSzVX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7017805143",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2bdce7f7adbdec018405cb993d16cecb5fb429f6",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2bdce7f7adbdec018405cb993d16cecb5fb429f6",
      "created_at": "2022-07-19T06:33:53Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7020172879,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAGib1ZP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7020172879",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T12:16:24Z"
    },
    {
      "event": "renamed",
      "id": 7020231311,
      "node_id": "RTE_lADOABII585M6xw_zwAAAAGicDqP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7020231311",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T12:24:27Z",
      "rename": {
        "from": "[draft] PeerManager unit tests",
        "to": "net, test: Virtualise CConnman and add initial PeerManager unit tests"
      }
    },
    {
      "event": "ready_for_review",
      "id": 7020238441,
      "node_id": "RFRE_lADOABII585M6xw_zwAAAAGicFZp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7020238441",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T12:25:27Z"
    },
    {
      "event": "commented",
      "id": 1188989697,
      "node_id": "IC_kwDOABII585G3osB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1188989697",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T12:26:57Z",
      "updated_at": "2022-07-19T12:26:57Z",
      "author_association": "MEMBER",
      "body": "This PR is ready for review!",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1188989697",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "unlabeled",
      "id": 7020427945,
      "node_id": "UNLE_lADOABII585M6xw_zwAAAAGiczqp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7020427945",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T12:51:31Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1226927000,
      "node_id": "IC_kwDOABII585JIWuY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1226927000",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-25T08:10:19Z",
      "updated_at": "2022-08-25T08:10:19Z",
      "author_association": "MEMBER",
      "body": "Concept ACK, light code review ACK 87fd3609ba87a74fa6ca74c56ffbdb39fd941ebf",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1226927000",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7385858814,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAG4O0L-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7385858814",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-14T13:24:52Z"
    },
    {
      "event": "commented",
      "id": 1246762839,
      "node_id": "IC_kwDOABII585KUBdX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1246762839",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-14T13:25:26Z",
      "updated_at": "2022-09-14T13:25:26Z",
      "author_association": "MEMBER",
      "body": "Rebased.",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1246762839",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRmMjUzM2M1ZmQxOGFlYThhZjg2NjIzYjI5MDRlN2Y5ODc0NjVhNTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4f2533c5fd18aea8af86623b2904e7f987465a59",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4f2533c5fd18aea8af86623b2904e7f987465a59",
      "tree": {
        "sha": "dd9a1730570e961b09136eccd6149d3622db64d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dd9a1730570e961b09136eccd6149d3622db64d1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9fcdb9f3a044330d3d7515fa35709102c98534d2",
          "sha": "9fcdb9f3a044330d3d7515fa35709102c98534d2",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9fcdb9f3a044330d3d7515fa35709102c98534d2"
        }
      ],
      "message": "[net] Define ConnectionsInterface",
      "committer": {
        "name": "dergoegge",
        "email": "n.goeggi@gmail.com",
        "date": "2022-09-27T11:52:23Z"
      },
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2022-02-10T10:52:40Z"
      },
      "sha": "4f2533c5fd18aea8af86623b2904e7f987465a59"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDllZmNkOTY2OGQxNDNhZmEyZTgyMTNhN2JhY2Y5NGRhN2Y2NDVlNGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9efcd9668d143afa2e8213a7bacf94da7f645e4c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9efcd9668d143afa2e8213a7bacf94da7f645e4c",
      "tree": {
        "sha": "d367232e65dec8728c886090cbfe4e44101e0359",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d367232e65dec8728c886090cbfe4e44101e0359"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4f2533c5fd18aea8af86623b2904e7f987465a59",
          "sha": "4f2533c5fd18aea8af86623b2904e7f987465a59",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4f2533c5fd18aea8af86623b2904e7f987465a59"
        }
      ],
      "message": "[net processing] PeerManager holds a ConnectionsInterface&, not a CConnman&",
      "committer": {
        "name": "dergoegge",
        "email": "n.goeggi@gmail.com",
        "date": "2022-09-27T11:52:23Z"
      },
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2022-03-29T13:56:08Z"
      },
      "sha": "9efcd9668d143afa2e8213a7bacf94da7f645e4c"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7467924678,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAG9H3zG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7467924678",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-09-27T12:10:03Z"
    },
    {
      "event": "review_requested",
      "id": 7516092812,
      "node_id": "RRE_lADOABII585M6xw_zwAAAAG__nmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7516092812",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T12:39:45Z",
      "requested_reviewer": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1266933218,
      "node_id": "IC_kwDOABII585Lg93i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1266933218",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-04T12:40:18Z",
      "updated_at": "2022-10-04T12:40:18Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1266933218",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "commented",
      "id": 1279056559,
      "node_id": "IC_kwDOABII585MPNqv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1279056559",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-14T14:05:46Z",
      "updated_at": "2022-10-14T14:05:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1279056559",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "reviewed",
      "id": 1144030805,
      "node_id": "PRR_kwDOABII585EMIZV",
      "url": null,
      "actor": null,
      "commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK.. I made a first pass and changes look good to me.. I believe its helpful to separate out the interface, and possibly add more thorough unit testing later on? \r\n\r\nI will go through the test logic more thoroughly, for now just two observations. ",
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1144030805",
      "submitted_at": "2022-10-17T12:30:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1148067232,
      "node_id": "PRR_kwDOABII585Ebh2g",
      "url": null,
      "actor": null,
      "commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tested ACK ðŸ‘",
      "user": {
        "login": "hernanmarino",
        "id": 87907936,
        "node_id": "MDQ6VXNlcjg3OTA3OTM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/87907936?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hernanmarino",
        "html_url": "https://github.com/hernanmarino",
        "followers_url": "https://api.github.com/users/hernanmarino/followers",
        "following_url": "https://api.github.com/users/hernanmarino/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hernanmarino/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hernanmarino/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hernanmarino/subscriptions",
        "organizations_url": "https://api.github.com/users/hernanmarino/orgs",
        "repos_url": "https://api.github.com/users/hernanmarino/repos",
        "events_url": "https://api.github.com/users/hernanmarino/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hernanmarino/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1148067232",
      "submitted_at": "2022-10-19T18:10:27Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1147655474,
      "node_id": "PRR_kwDOABII585EZ9Uy",
      "url": null,
      "actor": null,
      "commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "One more question.. ",
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1147655474",
      "submitted_at": "2022-10-19T18:36:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJkZmUxMzRlZDZiMTNlNjliZWNjNDNjOWUwYThmOTU4ZTg5MzFiMGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "tree": {
        "sha": "88886c1346370bab85591387bcc16da6178ebd9f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/88886c1346370bab85591387bcc16da6178ebd9f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9efcd9668d143afa2e8213a7bacf94da7f645e4c",
          "sha": "9efcd9668d143afa2e8213a7bacf94da7f645e4c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9efcd9668d143afa2e8213a7bacf94da7f645e4c"
        }
      ],
      "message": "[test] Add unit test for version handshake",
      "committer": {
        "name": "dergoegge",
        "email": "n.goeggi@gmail.com",
        "date": "2022-10-21T13:13:18Z"
      },
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2022-02-10T22:11:57Z"
      },
      "sha": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDljMDRjMzIxMDFjZDQ1OGMzMzZkZTFkNjZhZDI5NmRjN2YxY2YzNWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "tree": {
        "sha": "63561a1ddbccaa8ecc04d9d34fd605b3e0f28863",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/63561a1ddbccaa8ecc04d9d34fd605b3e0f28863"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
          "sha": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bdfe134ed6b13e69becc43c9e0a8f958e8931b0a"
        }
      ],
      "message": "[test] Add unit test for ping/pong logic",
      "committer": {
        "name": "dergoegge",
        "email": "n.goeggi@gmail.com",
        "date": "2022-10-21T13:13:18Z"
      },
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2022-02-12T12:12:02Z"
      },
      "sha": "9c04c32101cd458c336de1d66ad296dc7f1cf35d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7640610985,
      "node_id": "HRFPE_lADOABII585M6xw_zwAAAAHHanip",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7640610985",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-21T13:17:46Z"
    },
    {
      "event": "reviewed",
      "id": 1152333262,
      "node_id": "PRR_kwDOABII585ErzXO",
      "url": null,
      "actor": null,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK 9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1152333262",
      "submitted_at": "2022-10-23T16:33:56Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1152716506,
      "node_id": "PRR_kwDOABII585EtQ7a",
      "url": null,
      "actor": null,
      "commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1152716506",
      "submitted_at": "2022-10-24T08:17:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1167285173,
      "node_id": "PRR_kwDOABII585Fk1u1",
      "url": null,
      "actor": null,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Reviewed up to 9efcd9668d143afa2e8213a7bacf94da7f645e4c, still have to look a bit deeper how the unit tests exactly work. To get the ball rolling, maybe it's worth it to split up the PR into two, one for virtualising CConnman (which is I think is way easier to review and could be merged pretty fast), and one for the unit tests?\r\n\r\nFor the latter, [as Marco pointed out](https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1003010273), it seems like there is potential for deduplication with the routines in `test/util/net.cpp`. Left also two minor review comments below.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1167285173",
      "submitted_at": "2022-11-03T16:44:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1166581907,
      "node_id": "PRR_kwDOABII585FiKCT",
      "url": null,
      "actor": null,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1166581907",
      "submitted_at": "2022-11-04T15:00:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1190434606,
      "node_id": "PRR_kwDOABII585G9Jcu",
      "url": null,
      "actor": null,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "cr 9c04c32101cd458c336de1d66ad296dc7f1cf35d . Mostly ACK in my opinion, but i agree with some of the others suggestions ( most of @vasild 's and some other's I marked with a thumbs up)",
      "user": {
        "login": "hernanmarino",
        "id": 87907936,
        "node_id": "MDQ6VXNlcjg3OTA3OTM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/87907936?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hernanmarino",
        "html_url": "https://github.com/hernanmarino",
        "followers_url": "https://api.github.com/users/hernanmarino/followers",
        "following_url": "https://api.github.com/users/hernanmarino/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hernanmarino/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hernanmarino/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hernanmarino/subscriptions",
        "organizations_url": "https://api.github.com/users/hernanmarino/orgs",
        "repos_url": "https://api.github.com/users/hernanmarino/repos",
        "events_url": "https://api.github.com/users/hernanmarino/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hernanmarino/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1190434606",
      "submitted_at": "2022-11-22T16:40:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "reviewed",
      "id": 1190475886,
      "node_id": "PRR_kwDOABII585G9Thu",
      "url": null,
      "actor": null,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Tested ACK.\r\n\r\nI'm not very comfortable using `friend class` as it breaks encapsulation, perhaps it's something we could avoid at some point looking forward.",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1190475886",
      "submitted_at": "2022-11-22T17:05:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "convert_to_draft",
      "id": 7934595986,
      "node_id": "CTDE_lADOABII585M6xw_zwAAAAHY8FOS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7934595986",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-01T18:29:12Z"
    },
    {
      "event": "labeled",
      "id": 8584297356,
      "node_id": "LE_lADOABII585M6xw_zwAAAAH_qfuM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8584297356",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-22T18:47:26Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1440611051,
      "node_id": "IC_kwDOABII585V3frr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440611051",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-22T18:47:27Z",
      "updated_at": "2023-02-22T18:47:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nðŸ™ This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1440611051",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "reviewed",
      "id": 1339941979,
      "node_id": "PRR_kwDOABII585P3eRb",
      "url": null,
      "actor": null,
      "commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#pullrequestreview-1339941979",
      "submitted_at": "2023-03-14T17:49:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
    },
    {
      "event": "commented",
      "id": 1515003669,
      "node_id": "IC_kwDOABII585aTR8V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1515003669",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-19T16:12:23Z",
      "updated_at": "2023-04-19T16:12:23Z",
      "author_association": "MEMBER",
      "body": "Concept ACK on adding testing modulo the comments above and https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1171566094. Built and ran a green make check on each commit. Needs rebase.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1515003669",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "commented",
      "id": 1639167459,
      "node_id": "IC_kwDOABII585hs7Xj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1639167459",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-18T02:05:54Z",
      "updated_at": "2023-07-18T02:05:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? âž¡ï¸ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? âž¡ï¸ Please close.\n* Did the author lose interest or time to work on this? âž¡ï¸ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1639167459",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "commented",
      "id": 1673322410,
      "node_id": "IC_kwDOABII585jvN-q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1673322410",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-10T14:23:28Z",
      "updated_at": "2023-08-10T14:23:28Z",
      "author_association": "MEMBER",
      "body": "Closing for now, I want to do some interface work before adding the tests and will open a large meta PR soon that includes all the refactoring + tests at the end.",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#issuecomment-1673322410",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25515"
    },
    {
      "event": "closed",
      "id": 10060155676,
      "node_id": "CE_lADOABII585M6xw_zwAAAAJXocsc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10060155676",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-10T14:23:28Z"
    },
    {
      "event": "locked",
      "id": 13820614072,
      "node_id": "LOE_lADOABII585M6xw_zwAAAAM3xdW4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13820614072",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-09T13:03:54Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996975101",
      "pull_request_review_id": 1144030805,
      "id": 996975101,
      "node_id": "PRRC_kwDOABII5847bKH9",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));",
      "path": "src/test/peerman_tests.cpp",
      "position": null,
      "original_position": 87,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": null,
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe I am missing something, but shouldn't this be `sending message %s to peer %d`?? ",
      "created_at": "2022-10-17T12:03:30Z",
      "updated_at": "2022-10-17T12:30:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r996975101",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996975101"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 87,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996987379",
      "pull_request_review_id": 1144030805,
      "id": 996987379,
      "node_id": "PRRC_kwDOABII5847bNHz",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                              // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services), // their service flags\n+                GetTime(),                                     // dummy time\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // dummy\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // ignored\n+                uint64_t{1},                                   // dummy nonce\n+                std::string{},                                 // dummy subver\n+                int32_t{},                                     // dummy starting_height\n+                true),                                         // fRelay\n+    };\n+    SendMessage(connman, peerman, node, msg_version);\n+    BOOST_CHECK(!node.fDisconnect);\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    CNodeStateStats stats;\n+    bool ret = peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(ret, true);\n+    BOOST_CHECK_EQUAL(stats.their_services, their_services);\n+\n+    pre_verack_hook(connman, peerman, node);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    SendMessage(connman, peerman, node, msg_verack);\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();\n+}\n+\n+BOOST_AUTO_TEST_CASE(version_handshake)\n+{\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n+    CNode node{/*id=*/0, /*sock=*/nullptr, addr1, /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::FEEFILTER], 1);\n+\n+    peerman->FinalizeNode(node);\n+}\n+\n+static void CheckPingTimes(CNode& node, PeerManager& peerman,\n+                           std::chrono::microseconds min_ping_time, std::chrono::microseconds last_ping_time, std::chrono::microseconds ping_wait)\n+{\n+    // Check min and last ping times\n+    BOOST_CHECK_EQUAL(node.m_min_ping_time.load().count(), min_ping_time.count());\n+    BOOST_CHECK_EQUAL(node.m_last_ping_time.load().count(), last_ping_time.count());\n+\n+    // Check if and how long current ping has been pending\n+    CNodeStateStats stats;\n+    peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\n+}\n+\n+static void SendPong(CNode& node, ConnectionsInterfaceMock& connman,\n+                     PeerManager& peerman, std::optional<int64_t> nonce = {})\n+{\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_pong = nonce ? mm.Make(NetMsgType::PONG, nonce.value()) : mm.Make(NetMsgType::PONG);\n+    SendMessage(connman, peerman, node, msg_pong);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)\n+{\n+    // See PING_INTERVAL in net_processing.cpp\n+    constexpr int64_t PING_INTERVAL{2 * 60};\n+\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CNode node{/*id=*/0, /*sock=*/nullptr, CAddress(), /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    // Use mock time to control pings from node\n+    SetMockTime(GetTime());\n+\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_TEST_MESSAGE(\"Advanced mocktime and check that ping is sent after connection is established\");\n+    AdvanceMockTime(1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::PING], 1);\n+\n+    // The ping nonce should be non-zero\n+    BOOST_CHECK(connman->m_ping_nonce != 0);\n+\n+    // No pong response has been received yet, and current ping is outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 1s);\n+\n+    BOOST_TEST_MESSAGE(\"Reply without nonce cancels ping\");\n+    SendPong(node, *connman, *peerman, std::nullopt);\n+\n+    // Ping metrics have not been updated on the CNode object, and there is no ping outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 0us);\n+\n+    BOOST_TEST_MESSAGE(\"Reply without ping\");\n+    SendPong(node, *connman, *peerman, 0);\n+\n+    // Ping metrics have not been updated on the CNode object, and there is no ping outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 0us);\n+\n+    // Wait for next ping\n+    AdvanceMockTime(PING_INTERVAL + 1);\n+    connman->m_message_types_sent[NetMsgType::PING] = 0;\n+    WITH_LOCK(NetEventsInterface::g_msgproc_mutex, peerman->SendMessages(&node));\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::PING], 1);\n+\n+    BOOST_TEST_MESSAGE(\"Reply with wrong nonce does not cancel ping\");\n+    SendPong(node, *connman, *peerman, connman->m_ping_nonce + 1);\n+    AdvanceMockTime(1);\n+\n+    // Ping metrics have not been updated on the CNode object, and there is a ping outstandgin",
      "path": "src/test/peerman_tests.cpp",
      "position": null,
      "original_position": 282,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": null,
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit:\r\n```suggestion\r\n    // Ping metrics have not been updated on the CNode object, and there is a ping outstanding\r\n```",
      "created_at": "2022-10-17T12:17:05Z",
      "updated_at": "2022-10-17T12:30:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r996987379",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/996987379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 282,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999513116",
      "pull_request_review_id": 1147655474,
      "id": 999513116,
      "node_id": "PRRC_kwDOABII5847k1wc",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));",
      "path": "src/test/peerman_tests.cpp",
      "position": 102,
      "original_position": 102,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": null,
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do we need to pass in the `complete` flag here?? Seems like we are overriding it anyway into `node.ReceiveMsgBytes`.. So can't we just initiate it locally??",
      "created_at": "2022-10-19T14:09:54Z",
      "updated_at": "2022-10-19T18:36:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r999513116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/999513116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 100,
      "original_start_line": 100,
      "start_side": "RIGHT",
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001774399",
      "pull_request_review_id": 1150940516,
      "id": 1001774399,
      "node_id": "PRRC_kwDOABII5847td0_",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));",
      "path": "src/test/peerman_tests.cpp",
      "position": 102,
      "original_position": 102,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": 999513116,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could you suggest a change? I don't understand what you mean.\r\n\r\n`complete` is passed by reference and modified by `ReceiveMsgBytes`.",
      "created_at": "2022-10-21T13:16:24Z",
      "updated_at": "2022-10-21T13:16:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1001774399",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001774399"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 100,
      "original_start_line": 100,
      "start_side": "RIGHT",
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001776338",
      "pull_request_review_id": 1150943430,
      "id": 1001776338,
      "node_id": "PRRC_kwDOABII5847teTS",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));",
      "path": "src/test/peerman_tests.cpp",
      "position": null,
      "original_position": 87,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": 996975101,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, `PushMessage` is called to send a message to a peer. Done.",
      "created_at": "2022-10-21T13:18:15Z",
      "updated_at": "2022-10-21T13:18:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1001776338",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001776338"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 87,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001861582",
      "pull_request_review_id": 1151065564,
      "id": 1001861582,
      "node_id": "PRRC_kwDOABII5847tzHO",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));",
      "path": "src/test/peerman_tests.cpp",
      "position": 102,
      "original_position": 102,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": 999513116,
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think we could simplify `ReceiveMsgBytes` by not passing `complete` as reference and using the `bool` that this function returns. Does it make sense?\r\n\r\n",
      "created_at": "2022-10-21T14:32:20Z",
      "updated_at": "2022-10-21T14:32:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1001861582",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1001861582"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 100,
      "original_start_line": 100,
      "start_side": "RIGHT",
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002733109",
      "pull_request_review_id": 1152330274,
      "id": 1002733109,
      "node_id": "PRRC_kwDOABII5847xH41",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"received message %s from peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));",
      "path": "src/test/peerman_tests.cpp",
      "position": 102,
      "original_position": 102,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "f98a4e8d891dd7374ef7dc4c723797bf0705075f",
      "in_reply_to_id": 999513116,
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think I would retrace back my comment.. These signatures are part of the interface itself.. So there might be valid reasons for them.. \r\n\r\nThough it seems like we are ultimately dropping the `bool` here in test case in .. The only place its used is inside `NodeReceiveMsgBytes`. So at first look passing in a value that we are internally processing and then dropping in final return  (in the line `(void)connman.ReceiveMsgFrom(node, msg);`) was confusing me.. I am probably still confused but my suggestion doesn't make any sense as it will modify the interface.. ",
      "created_at": "2022-10-23T16:06:46Z",
      "updated_at": "2022-10-23T16:06:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1002733109",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1002733109"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 100,
      "original_start_line": 100,
      "start_side": "RIGHT",
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003010273",
      "pull_request_review_id": 1152716506,
      "id": 1003010273,
      "node_id": "PRRC_kwDOABII5847yLjh",
      "diff_hunk": "@@ -0,0 +1,188 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const",
      "path": "src/test/peerman_tests.cpp",
      "position": 98,
      "original_position": 98,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason to duplicate this from the test util? Are there plans to de-duplicate this?",
      "created_at": "2022-10-24T08:17:50Z",
      "updated_at": "2022-10-24T08:17:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1003010273",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1003010273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012691719",
      "pull_request_review_id": 1166581907,
      "id": 1012691719,
      "node_id": "PRRC_kwDOABII5848XHMH",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}",
      "path": "src/test/peerman_tests.cpp",
      "position": 98,
      "original_position": 98,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`OnPing()` is called when sending a ping message, but the log says \"received ping\". Also, the comment of `m_ping_nonce` is \"Most recent ping nonce received\".",
      "created_at": "2022-11-03T09:54:43Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012691719",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012691719"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 85,
      "original_start_line": 85,
      "start_side": "RIGHT",
      "line": 98,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012698220",
      "pull_request_review_id": 1166581907,
      "id": 1012698220,
      "node_id": "PRRC_kwDOABII5848XIxs",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                              // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services), // their service flags\n+                GetTime(),                                     // dummy time\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // dummy\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // ignored\n+                uint64_t{1},                                   // dummy nonce\n+                std::string{},                                 // dummy subver\n+                int32_t{},                                     // dummy starting_height\n+                true),                                         // fRelay\n+    };\n+    SendMessage(connman, peerman, node, msg_version);\n+    BOOST_CHECK(!node.fDisconnect);\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    CNodeStateStats stats;\n+    bool ret = peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(ret, true);\n+    BOOST_CHECK_EQUAL(stats.their_services, their_services);\n+\n+    pre_verack_hook(connman, peerman, node);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    SendMessage(connman, peerman, node, msg_verack);\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();\n+}\n+\n+BOOST_AUTO_TEST_CASE(version_handshake)\n+{\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n+    CNode node{/*id=*/0, /*sock=*/nullptr, addr1, /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::FEEFILTER], 1);\n+\n+    peerman->FinalizeNode(node);\n+}\n+\n+static void CheckPingTimes(CNode& node, PeerManager& peerman,\n+                           std::chrono::microseconds min_ping_time, std::chrono::microseconds last_ping_time, std::chrono::microseconds ping_wait)\n+{\n+    // Check min and last ping times\n+    BOOST_CHECK_EQUAL(node.m_min_ping_time.load().count(), min_ping_time.count());\n+    BOOST_CHECK_EQUAL(node.m_last_ping_time.load().count(), last_ping_time.count());\n+\n+    // Check if and how long current ping has been pending\n+    CNodeStateStats stats;\n+    peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\n+}\n+\n+static void SendPong(CNode& node, ConnectionsInterfaceMock& connman,\n+                     PeerManager& peerman, std::optional<int64_t> nonce = {})\n+{\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_pong = nonce ? mm.Make(NetMsgType::PONG, nonce.value()) : mm.Make(NetMsgType::PONG);\n+    SendMessage(connman, peerman, node, msg_pong);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)\n+{\n+    // See PING_INTERVAL in net_processing.cpp\n+    constexpr int64_t PING_INTERVAL{2 * 60};\n+\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CNode node{/*id=*/0, /*sock=*/nullptr, CAddress(), /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    // Use mock time to control pings from node\n+    SetMockTime(GetTime());\n+\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_TEST_MESSAGE(\"Advanced mocktime and check that ping is sent after connection is established\");\n+    AdvanceMockTime(1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::PING], 1);",
      "path": "src/test/peerman_tests.cpp",
      "position": 252,
      "original_position": 252,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This sequence is misleading. The ping message is sent immediately after the handshake. We do not need to \"wait\" 1 second for that to happen. So `AdvanceMockTime(1)` may be removed.\r\n",
      "created_at": "2022-11-03T10:00:43Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012698220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012698220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 250,
      "original_start_line": 250,
      "start_side": "RIGHT",
      "line": 252,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012727306",
      "pull_request_review_id": 1166581907,
      "id": 1012727306,
      "node_id": "PRRC_kwDOABII5848XP4K",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const",
      "path": "src/test/peerman_tests.cpp",
      "position": 100,
      "original_position": 100,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is duplicated from `ConnmanTestMsg::NodeReceiveMsgBytes()` + a subtle change.",
      "created_at": "2022-11-03T10:30:44Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012727306",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012727306"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 100,
      "original_line": 100,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012742783",
      "pull_request_review_id": 1166581907,
      "id": 1012742783,
      "node_id": "PRRC_kwDOABII5848XTp_",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                              // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services), // their service flags\n+                GetTime(),                                     // dummy time\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // dummy\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // ignored\n+                uint64_t{1},                                   // dummy nonce\n+                std::string{},                                 // dummy subver\n+                int32_t{},                                     // dummy starting_height\n+                true),                                         // fRelay\n+    };\n+    SendMessage(connman, peerman, node, msg_version);\n+    BOOST_CHECK(!node.fDisconnect);\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    CNodeStateStats stats;\n+    bool ret = peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(ret, true);\n+    BOOST_CHECK_EQUAL(stats.their_services, their_services);\n+\n+    pre_verack_hook(connman, peerman, node);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    SendMessage(connman, peerman, node, msg_verack);\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();\n+}\n+\n+BOOST_AUTO_TEST_CASE(version_handshake)\n+{\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n+    CNode node{/*id=*/0, /*sock=*/nullptr, addr1, /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::FEEFILTER], 1);\n+\n+    peerman->FinalizeNode(node);\n+}\n+\n+static void CheckPingTimes(CNode& node, PeerManager& peerman,\n+                           std::chrono::microseconds min_ping_time, std::chrono::microseconds last_ping_time, std::chrono::microseconds ping_wait)\n+{\n+    // Check min and last ping times\n+    BOOST_CHECK_EQUAL(node.m_min_ping_time.load().count(), min_ping_time.count());\n+    BOOST_CHECK_EQUAL(node.m_last_ping_time.load().count(), last_ping_time.count());\n+\n+    // Check if and how long current ping has been pending\n+    CNodeStateStats stats;\n+    peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\n+}\n+\n+static void SendPong(CNode& node, ConnectionsInterfaceMock& connman,\n+                     PeerManager& peerman, std::optional<int64_t> nonce = {})\n+{\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_pong = nonce ? mm.Make(NetMsgType::PONG, nonce.value()) : mm.Make(NetMsgType::PONG);\n+    SendMessage(connman, peerman, node, msg_pong);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)\n+{\n+    // See PING_INTERVAL in net_processing.cpp\n+    constexpr int64_t PING_INTERVAL{2 * 60};\n+\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CNode node{/*id=*/0, /*sock=*/nullptr, CAddress(), /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    // Use mock time to control pings from node\n+    SetMockTime(GetTime());\n+\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_TEST_MESSAGE(\"Advanced mocktime and check that ping is sent after connection is established\");\n+    AdvanceMockTime(1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::PING], 1);\n+\n+    // The ping nonce should be non-zero\n+    BOOST_CHECK(connman->m_ping_nonce != 0);\n+\n+    // No pong response has been received yet, and current ping is outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 1s);",
      "path": "src/test/peerman_tests.cpp",
      "position": 258,
      "original_position": 258,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `AdvanceMockTime(1)` from above belongs to just before this call. If the \"1 second\" is put in a variable that will make it obvious that it is the same as the 4th argument to `CheckPingTimes()`.",
      "created_at": "2022-11-03T10:47:16Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012742783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012742783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 258,
      "original_line": 258,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012749883",
      "pull_request_review_id": 1166581907,
      "id": 1012749883,
      "node_id": "PRRC_kwDOABII5848XVY7",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);",
      "path": "src/test/peerman_tests.cpp",
      "position": 135,
      "original_position": 135,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This function simulates _receiving_ a message from the peer. I find the name `SendMessage()` confusing. Naming elsewhere in the code is from our point of view.",
      "created_at": "2022-11-03T10:54:36Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012749883",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012749883"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 132,
      "original_start_line": 132,
      "start_side": "RIGHT",
      "line": 135,
      "original_line": 135,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012752032",
      "pull_request_review_id": 1166581907,
      "id": 1012752032,
      "node_id": "PRRC_kwDOABII5848XV6g",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                              // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services), // their service flags\n+                GetTime(),                                     // dummy time\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // dummy\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // ignored\n+                uint64_t{1},                                   // dummy nonce\n+                std::string{},                                 // dummy subver\n+                int32_t{},                                     // dummy starting_height\n+                true),                                         // fRelay\n+    };\n+    SendMessage(connman, peerman, node, msg_version);\n+    BOOST_CHECK(!node.fDisconnect);\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    CNodeStateStats stats;\n+    bool ret = peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(ret, true);\n+    BOOST_CHECK_EQUAL(stats.their_services, their_services);\n+\n+    pre_verack_hook(connman, peerman, node);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    SendMessage(connman, peerman, node, msg_verack);\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();\n+}\n+\n+BOOST_AUTO_TEST_CASE(version_handshake)\n+{\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n+    CNode node{/*id=*/0, /*sock=*/nullptr, addr1, /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::FEEFILTER], 1);\n+\n+    peerman->FinalizeNode(node);\n+}\n+\n+static void CheckPingTimes(CNode& node, PeerManager& peerman,\n+                           std::chrono::microseconds min_ping_time, std::chrono::microseconds last_ping_time, std::chrono::microseconds ping_wait)\n+{\n+    // Check min and last ping times\n+    BOOST_CHECK_EQUAL(node.m_min_ping_time.load().count(), min_ping_time.count());\n+    BOOST_CHECK_EQUAL(node.m_last_ping_time.load().count(), last_ping_time.count());\n+\n+    // Check if and how long current ping has been pending\n+    CNodeStateStats stats;\n+    peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\n+}\n+\n+static void SendPong(CNode& node, ConnectionsInterfaceMock& connman,",
      "path": "src/test/peerman_tests.cpp",
      "position": 222,
      "original_position": 222,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same as `SendMessage()`: this is simulating the reception of a pong message from the peer and the name `SendPong()` is confusing.",
      "created_at": "2022-11-03T10:56:56Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012752032",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012752032"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 222,
      "original_line": 222,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012768460",
      "pull_request_review_id": 1166581907,
      "id": 1012768460,
      "node_id": "PRRC_kwDOABII5848XZ7M",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept\n+{\n+    // Send version message\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_version{\n+        mm.Make(NetMsgType::VERSION,\n+                PROTOCOL_VERSION,                              // current p2p version\n+                Using<CustomUintFormatter<8>>(their_services), // their service flags\n+                GetTime(),                                     // dummy time\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // dummy\n+                int64_t{},                                     // ignored service bits\n+                CService{},                                    // ignored\n+                uint64_t{1},                                   // dummy nonce\n+                std::string{},                                 // dummy subver\n+                int32_t{},                                     // dummy starting_height\n+                true),                                         // fRelay\n+    };\n+    SendMessage(connman, peerman, node, msg_version);\n+    BOOST_CHECK(!node.fDisconnect);\n+    BOOST_CHECK_EQUAL(node.nVersion, PROTOCOL_VERSION);\n+    BOOST_CHECK_EQUAL(node.GetCommonVersion(), PROTOCOL_VERSION);\n+    CNodeStateStats stats;\n+    bool ret = peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(ret, true);\n+    BOOST_CHECK_EQUAL(stats.their_services, their_services);\n+\n+    pre_verack_hook(connman, peerman, node);\n+\n+    // Send verack message\n+    CSerializedNetMsg msg_verack{mm.Make(NetMsgType::VERACK)};\n+    SendMessage(connman, peerman, node, msg_verack);\n+    BOOST_CHECK_EQUAL(node.fSuccessfullyConnected, true);\n+\n+    TestOnlyResetTimeData();\n+}\n+\n+BOOST_AUTO_TEST_CASE(version_handshake)\n+{\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CAddress addr1(ip(0xa0b0c001), NODE_NONE);\n+    CNode node{/*id=*/0, /*sock=*/nullptr, addr1, /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERSION], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::WTXIDRELAY], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDADDRV2], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::VERACK], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETADDR], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::SENDCMPCT], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::GETHEADERS], 1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::FEEFILTER], 1);\n+\n+    peerman->FinalizeNode(node);\n+}\n+\n+static void CheckPingTimes(CNode& node, PeerManager& peerman,\n+                           std::chrono::microseconds min_ping_time, std::chrono::microseconds last_ping_time, std::chrono::microseconds ping_wait)\n+{\n+    // Check min and last ping times\n+    BOOST_CHECK_EQUAL(node.m_min_ping_time.load().count(), min_ping_time.count());\n+    BOOST_CHECK_EQUAL(node.m_last_ping_time.load().count(), last_ping_time.count());\n+\n+    // Check if and how long current ping has been pending\n+    CNodeStateStats stats;\n+    peerman.GetNodeStateStats(node.GetId(), stats);\n+    BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\n+}\n+\n+static void SendPong(CNode& node, ConnectionsInterfaceMock& connman,\n+                     PeerManager& peerman, std::optional<int64_t> nonce = {})\n+{\n+    const CNetMsgMaker mm{0};\n+    CSerializedNetMsg msg_pong = nonce ? mm.Make(NetMsgType::PONG, nonce.value()) : mm.Make(NetMsgType::PONG);\n+    SendMessage(connman, peerman, node, msg_pong);\n+}\n+\n+BOOST_AUTO_TEST_CASE(ping)\n+{\n+    // See PING_INTERVAL in net_processing.cpp\n+    constexpr int64_t PING_INTERVAL{2 * 60};\n+\n+    auto connman = std::make_unique<ConnectionsInterfaceMock>();\n+    auto peerman = PeerManager::make(*connman, *m_node.addrman, nullptr,\n+                                     *m_node.chainman, *m_node.mempool, false);\n+\n+    // Mock an outbound peer\n+    CNode node{/*id=*/0, /*sock=*/nullptr, CAddress(), /*nKeyedNetGroupIn=*/0, /*nLocalHostNonceIn=*/0, CAddress(),\n+               /*addrNameIn=*/\"\", ConnectionType::OUTBOUND_FULL_RELAY, /*inbound_onion=*/false};\n+\n+    peerman->InitializeNode(node, /*our_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    // Use mock time to control pings from node\n+    SetMockTime(GetTime());\n+\n+    Handshake(*connman, *peerman, node, /*their_services=*/ServiceFlags(NODE_NETWORK | NODE_WITNESS));\n+\n+    BOOST_TEST_MESSAGE(\"Advanced mocktime and check that ping is sent after connection is established\");\n+    AdvanceMockTime(1);\n+    BOOST_CHECK_EQUAL(connman->m_message_types_sent[NetMsgType::PING], 1);\n+\n+    // The ping nonce should be non-zero\n+    BOOST_CHECK(connman->m_ping_nonce != 0);\n+\n+    // No pong response has been received yet, and current ping is outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 1s);\n+\n+    BOOST_TEST_MESSAGE(\"Reply without nonce cancels ping\");\n+    SendPong(node, *connman, *peerman, std::nullopt);\n+\n+    // Ping metrics have not been updated on the CNode object, and there is no ping outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 0us);\n+\n+    BOOST_TEST_MESSAGE(\"Reply without ping\");\n+    SendPong(node, *connman, *peerman, 0);\n+\n+    // Ping metrics have not been updated on the CNode object, and there is no ping outstanding\n+    CheckPingTimes(node, *peerman, std::chrono::microseconds::max(), 0us, 0us);",
      "path": "src/test/peerman_tests.cpp",
      "position": 270,
      "original_position": 270,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe use `ASSERT_DEBUG_LOG(\"Unsolicited pong without ping\")` here.",
      "created_at": "2022-11-03T11:15:10Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012768460",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012768460"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 266,
      "original_start_line": 266,
      "start_side": "RIGHT",
      "line": 270,
      "original_line": 270,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012809634",
      "pull_request_review_id": 1166581907,
      "id": 1012809634,
      "node_id": "PRRC_kwDOABII5848Xj-i",
      "diff_hunk": "@@ -0,0 +1,307 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <span.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <optional>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+static void AdvanceMockTime(int64_t delta)\n+{\n+    auto time_before{GetMockTime()};\n+    SetMockTime(time_before + std::chrono::seconds(delta));\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+    void OnPing(CDataStream& data);\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+    /** Most recent ping nonce received. */\n+    uint64_t m_ping_nonce{0};\n+\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+\n+    CDataStream data{msg.data, SER_NETWORK, PROTOCOL_VERSION};\n+    if (msg.m_type == NetMsgType::PING) OnPing(data);\n+}\n+\n+void ConnectionsInterfaceMock::OnPing(CDataStream& data)\n+{\n+    data >> m_ping_nonce;\n+    BOOST_TEST_MESSAGE(strprintf(\"received ping. Nonce:%d\", m_ping_nonce));\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }\n+}\n+\n+bool ConnectionsInterfaceMock::ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const\n+{\n+    std::vector<uint8_t> ser_msg_header;\n+    node.m_serializer->prepareForTransport(ser_msg, ser_msg_header);\n+\n+    bool complete;\n+    NodeReceiveMsgBytes(node, ser_msg_header, complete);\n+    NodeReceiveMsgBytes(node, ser_msg.data, complete);\n+    return complete;\n+}\n+\n+BOOST_FIXTURE_TEST_SUITE(peerman_tests, TestingSetup)\n+\n+static void SendMessage(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node, CSerializedNetMsg& msg)\n+{\n+    std::atomic<bool> interrupt{false};\n+    (void)connman.ReceiveMsgFrom(node, msg);\n+    node.fPauseSend = false;\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\n+    peerman.ProcessMessages(&node, interrupt);\n+    peerman.SendMessages(&node);\n+}\n+\n+using HandshakeHookFn = std::function<void(ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node)>;\n+static void Handshake(\n+    ConnectionsInterfaceMock& connman, PeerManager& peerman,\n+    CNode& node, ServiceFlags their_services,\n+    HandshakeHookFn pre_verack_hook = [](ConnectionsInterfaceMock& connman, PeerManager& peerman, CNode& node) {}) noexcept",
      "path": "src/test/peerman_tests.cpp",
      "position": 146,
      "original_position": 146,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is very similar to `ConnmanTestMsg::Handshake()`. To avoid code duplication, can it be used instead?",
      "created_at": "2022-11-03T12:00:58Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1012809634",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012809634"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 143,
      "original_start_line": 143,
      "start_side": "RIGHT",
      "line": 146,
      "original_line": 146,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013142021",
      "pull_request_review_id": 1167285173,
      "id": 1013142021,
      "node_id": "PRRC_kwDOABII5848Y1IF",
      "diff_hunk": "@@ -0,0 +1,188 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));",
      "path": "src/test/peerman_tests.cpp",
      "position": 81,
      "original_position": 81,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "According to our coding guidelines, [assertions shouldn't have side-effects](https://github.com/bitcoin/bitcoin/blob/28653a596ab7e0811ffec3bbb7632e17d54f8e43/doc/developer-notes.md?plain=1#L725).\r\n```suggestion\r\n    bool success = node.ReceiveMsgBytes(msg_bytes, complete);\r\n    assert(success);\r\n```",
      "created_at": "2022-11-03T16:30:34Z",
      "updated_at": "2022-11-03T16:44:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1013142021",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013142021"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 81,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013149806",
      "pull_request_review_id": 1167285173,
      "id": 1013149806,
      "node_id": "PRRC_kwDOABII5848Y3Bu",
      "diff_hunk": "@@ -0,0 +1,188 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>",
      "path": "src/test/peerman_tests.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Seems like a lot of these includes are unnecessary and can be removed; e.g. I don't see any arith_uint256-, pubkey- or script-related stuff used in the unit test. With the following diff it still compiles:\r\n```diff\r\ndiff --git a/src/test/peerman_tests.cpp b/src/test/peerman_tests.cpp\r\nindex 8ab87be6b..9d0c02fd0 100644\r\n--- a/src/test/peerman_tests.cpp\r\n+++ b/src/test/peerman_tests.cpp\r\n@@ -2,16 +2,11 @@\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n\r\n-#include <arith_uint256.h>\r\n #include <banman.h>\r\n #include <chainparams.h>\r\n #include <net.h>\r\n #include <net_processing.h>\r\n #include <netmessagemaker.h>\r\n-#include <pubkey.h>\r\n-#include <script/sign.h>\r\n-#include <script/signingprovider.h>\r\n-#include <script/standard.h>\r\n #include <serialize.h>\r\n #include <span.h>\r\n #include <test/util/net.h>\r\n@@ -22,7 +17,6 @@\r\n #include <timedata.h>\r\n #include <validation.h>\r\n\r\n-#include <array>\r\n #include <optional>\r\n #include <stdint.h>\r\n\r\n```",
      "created_at": "2022-11-03T16:35:54Z",
      "updated_at": "2022-11-03T16:44:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1013149806",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013149806"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 14,
      "original_line": 14,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014128036",
      "pull_request_review_id": 1166581907,
      "id": 1014128036,
      "node_id": "PRRC_kwDOABII5848cl2k",
      "diff_hunk": "@@ -663,7 +664,64 @@ class NetEventsInterface\n     ~NetEventsInterface() = default;\n };\n \n-class CConnman\n+/** Interface class for interacting with CConnman */\n+class ConnectionsInterface",
      "path": "src/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that the tests added in this PR can be done without virtualizing `CConnman` and without touching the source code at all, by capturing the sent and received messages (see `net_tests/initial_advertise_from_version_message` for an example).",
      "created_at": "2022-11-04T14:57:49Z",
      "updated_at": "2022-11-04T15:00:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1014128036",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014128036"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 668,
      "original_line": 668,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014164912",
      "pull_request_review_id": 1168753395,
      "id": 1014164912,
      "node_id": "PRRC_kwDOABII5848cu2w",
      "diff_hunk": "@@ -663,7 +664,64 @@ class NetEventsInterface\n     ~NetEventsInterface() = default;\n };\n \n-class CConnman\n+/** Interface class for interacting with CConnman */\n+class ConnectionsInterface",
      "path": "src/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": 1014128036,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Huh I have not seen that before, thanks for bringing it up! While we could do that, i think that virtualizing `CConnman` is just the right thing to do for several reasons.\r\n\r\n- Defining an interface for it gets us a step closer to hiding more implementation details of our net module (similar to what we did with net processing. See `net_processing.h`, it (almost) only has the interface definition for `PeerManager`).\r\n- Mocking `CConnman` is much easier if such an interface definition exists. That's nice for unit tests but also nice for fuzz testing as we could have a `FuzzedConnman` (similar to your work on `FuzzedSock`).\r\n- Future tests might need more functionality besides capturing messages, so having the ability to mock the entire `CConnman` would be nice.\r\n",
      "created_at": "2022-11-04T15:24:49Z",
      "updated_at": "2022-11-04T15:24:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1014164912",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014164912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 668,
      "original_line": 668,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015336054",
      "pull_request_review_id": 1170268723,
      "id": 1015336054,
      "node_id": "PRRC_kwDOABII5848hMx2",
      "diff_hunk": "@@ -663,7 +664,64 @@ class NetEventsInterface\n     ~NetEventsInterface() = default;\n };\n \n-class CConnman\n+/** Interface class for interacting with CConnman */\n+class ConnectionsInterface",
      "path": "src/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": 1014128036,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> ... i think that virtualizing `CConnman` is just the right thing to do for several reasons\r\n\r\nMaybe put those in the OP to make the case for virtualizing stronger.\r\n\r\n> Defining an interface for it gets us a step closer to hiding more implementation details ...\r\n\r\nIn general, I wonder if we are going a step too far with \"hiding implementation details\". Are we aiming to remove `private:` sections from classes defined in header files?\r\n\r\nPImpl and virtualization have their use cases but IMO shouldn't be used as if they are universally good (as in \"lets pimpl and virtualize everything because the code will become better just by doing that\"). They could have adverse effects if abused.\r\n\r\n> * Mocking `CConnman` is much easier if such an interface definition exists ...\r\n> * Future tests might need more functionality besides capturing messages ...\r\n\r\nI agree.",
      "created_at": "2022-11-07T11:57:34Z",
      "updated_at": "2022-11-07T11:57:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1015336054",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1015336054"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 668,
      "original_line": 668,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1022470321",
      "pull_request_review_id": 1180407764,
      "id": 1022470321,
      "node_id": "PRRC_kwDOABII58488aix",
      "diff_hunk": "@@ -663,7 +664,64 @@ class NetEventsInterface\n     ~NetEventsInterface() = default;\n };\n \n-class CConnman\n+/** Interface class for interacting with CConnman */\n+class ConnectionsInterface",
      "path": "src/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": 1014128036,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> the tests added in this PR can be done without ... touching the source code at all\r\n\r\nYes, that works. Here it is:\r\n\r\n<details>\r\n<summary>tests</summary>\r\n\r\n```diff\r\ndiff --git a/src/test/net_tests.cpp b/src/test/net_tests.cpp\r\nindex f24509dd97..105f4e4487 100644\r\n--- a/src/test/net_tests.cpp\r\n+++ b/src/test/net_tests.cpp\r\n@@ -11,12 +11,14 @@\r\n #include <netaddress.h>\r\n #include <netbase.h>\r\n #include <netmessagemaker.h>\r\n #include <serialize.h>\r\n #include <span.h>\r\n #include <streams.h>\r\n+#include <test/util/logging.h>\r\n+#include <test/util/net.h>\r\n #include <test/util/setup_common.h>\r\n #include <test/util/validation.h>\r\n #include <timedata.h>\r\n #include <util/strencodings.h>\r\n #include <util/string.h>\r\n #include <util/system.h>\r\n@@ -902,7 +904,213 @@ BOOST_AUTO_TEST_CASE(initial_advertise_from_version_message)\r\n     // PeerManager::ProcessMessage() calls AddTimeData() which changes the internal state\r\n     // in timedata.cpp and later confuses the test \"timedata_tests/addtimedata\". Thus reset\r\n     // that state as it was before our test was run.\r\n     TestOnlyResetTimeData();\r\n }\r\n \r\n+BOOST_AUTO_TEST_CASE(initial_messages_sent)\r\n+{\r\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\r\n+\r\n+    m_node.args->ForceSetArg(\"-capturemessages\", \"1\");\r\n+\r\n+    auto& connman = static_cast<ConnmanTestMsg&>(*m_node.connman);\r\n+    auto& peerman = *m_node.peerman;\r\n+\r\n+    CNode outbound_peer{\r\n+        /*id=*/NodeId{0},\r\n+        /*sock=*/nullptr,\r\n+        /*addrIn=*/CAddress{CService{CNetAddr{in_addr{.s_addr = htonl(0x01020304)}}, 8333}, NODE_NONE},\r\n+        /*nKeyedNetGroupIn=*/0,\r\n+        /*nLocalHostNonceIn=*/0,\r\n+        /*addrBindIn=*/CAddress{},\r\n+        /*addrNameIn=*/\"\",\r\n+        /*conn_type_in=*/ConnectionType::OUTBOUND_FULL_RELAY,\r\n+        /*inbound_onion=*/false};\r\n+\r\n+    std::unordered_map<std::string, size_t> count_sent_messages;\r\n+\r\n+    const auto CaptureMessageOrig = CaptureMessage;\r\n+    CaptureMessage = [&count_sent_messages](const CAddress& addr,\r\n+                                            const std::string& msg_type,\r\n+                                            Span<const unsigned char> data,\r\n+                                            bool is_incoming) -> void {\r\n+        if (!is_incoming) {\r\n+            count_sent_messages[msg_type]++;\r\n+        }\r\n+    };\r\n+\r\n+    connman.Handshake(\r\n+        /*node=*/outbound_peer,\r\n+        /*successfully_connected=*/true,\r\n+        /*remote_services=*/ServiceFlags{NODE_NETWORK | NODE_WITNESS},\r\n+        /*local_services=*/ServiceFlags{NODE_NETWORK | NODE_WITNESS},\r\n+        /*version=*/PROTOCOL_VERSION,\r\n+        /*relay_txs=*/true);\r\n+\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERSION], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::WTXIDRELAY], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDADDRV2], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::VERACK], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETADDR], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::SENDCMPCT], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::PING], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::GETHEADERS], 1);\r\n+    BOOST_CHECK_EQUAL(count_sent_messages[NetMsgType::FEEFILTER], 1);\r\n+\r\n+    peerman.FinalizeNode(outbound_peer);\r\n+\r\n+    CaptureMessage = CaptureMessageOrig;\r\n+    m_node.args->ForceSetArg(\"-capturemessages\", \"0\");\r\n+    // PeerManager::ProcessMessage() calls AddTimeData() which changes the internal state\r\n+    // in timedata.cpp and later confuses the test \"timedata_tests/addtimedata\". Thus reset\r\n+    // that state as it was before our test was run.\r\n+    TestOnlyResetTimeData();\r\n+}\r\n+\r\n+BOOST_AUTO_TEST_CASE(pingpong)\r\n+{\r\n+    // See PING_INTERVAL in net_processing.cpp\r\n+    static constexpr auto PING_INTERVAL{2min};\r\n+\r\n+    m_node.args->ForceSetArg(\"-capturemessages\", \"1\");\r\n+\r\n+    auto& connman = static_cast<ConnmanTestMsg&>(*m_node.connman);\r\n+    auto& peerman = *m_node.peerman;\r\n+\r\n+    CNode outbound_peer{\r\n+        /*id=*/NodeId{0},\r\n+        /*sock=*/nullptr,\r\n+        /*addrIn=*/CAddress{CService{CNetAddr{in_addr{.s_addr = htonl(0x01020304)}}, 8333}, NODE_NONE},\r\n+        /*nKeyedNetGroupIn=*/0,\r\n+        /*nLocalHostNonceIn=*/0,\r\n+        /*addrBindIn=*/CAddress{},\r\n+        /*addrNameIn=*/\"\",\r\n+        /*conn_type_in=*/ConnectionType::OUTBOUND_FULL_RELAY,\r\n+        /*inbound_onion=*/false};\r\n+\r\n+    auto CheckPingTimes = [&peerman, &outbound_peer](std::chrono::microseconds min_ping_time,\r\n+                                                     std::chrono::microseconds last_ping_time,\r\n+                                                     std::chrono::microseconds ping_wait) {\r\n+        // Check min and last ping times\r\n+        BOOST_CHECK_EQUAL(outbound_peer.m_min_ping_time.load().count(), min_ping_time.count());\r\n+        BOOST_CHECK_EQUAL(outbound_peer.m_last_ping_time.load().count(), last_ping_time.count());\r\n+\r\n+        // Check if and how long current ping has been pending\r\n+        CNodeStateStats stats;\r\n+        BOOST_REQUIRE(peerman.GetNodeStateStats(outbound_peer.GetId(), stats));\r\n+        BOOST_CHECK_EQUAL(stats.m_ping_wait.count(), ping_wait.count());\r\n+    };\r\n+\r\n+    uint64_t ping_nonce_sent;\r\n+\r\n+    const auto CaptureMessageOrig = CaptureMessage;\r\n+    CaptureMessage = [&ping_nonce_sent](const CAddress& addr,\r\n+                                        const std::string& msg_type,\r\n+                                        Span<const unsigned char> data,\r\n+                                        bool is_incoming) {\r\n+        if (!is_incoming && msg_type == NetMsgType::PING) {\r\n+            CDataStream stream{data, SER_NETWORK, PROTOCOL_VERSION};\r\n+            stream >> ping_nonce_sent;\r\n+        }\r\n+    };\r\n+\r\n+    const auto SendPing = [&peerman, &outbound_peer, &ping_nonce_sent]() EXCLUSIVE_LOCKS_REQUIRED(NetEventsInterface::g_msgproc_mutex) {\r\n+        SetMockTime(GetMockTime() + PING_INTERVAL + 1s);\r\n+        ping_nonce_sent = 0;\r\n+        peerman.SendMessages(&outbound_peer);\r\n+        BOOST_REQUIRE(ping_nonce_sent != 0);\r\n+    };\r\n+\r\n+    const auto ReceiveAndProcessMessage = [&connman, &outbound_peer](CSerializedNetMsg& msg) EXCLUSIVE_LOCKS_REQUIRED(NetEventsInterface::g_msgproc_mutex) {\r\n+        connman.ReceiveMsgFrom(outbound_peer, msg);\r\n+        // The send buffer CConnman::nSendBufferMaxSize happens to be 0 during tests which\r\n+        // trips fPauseSend to be set to true which cancels processing of incoming messages.\r\n+        outbound_peer.fPauseSend = false;\r\n+        connman.ProcessMessagesOnce(outbound_peer);\r\n+    };\r\n+\r\n+    // Use mock time to control pings from node\r\n+    SetMockTime(GetTime());\r\n+\r\n+    ping_nonce_sent = 0;\r\n+\r\n+    LOCK(NetEventsInterface::g_msgproc_mutex);\r\n+\r\n+    connman.Handshake(\r\n+        /*node=*/outbound_peer,\r\n+        /*successfully_connected=*/true,\r\n+        /*remote_services=*/ServiceFlags{NODE_NETWORK | NODE_WITNESS},\r\n+        /*local_services=*/ServiceFlags{NODE_NETWORK | NODE_WITNESS},\r\n+        /*version=*/PROTOCOL_VERSION,\r\n+        /*relay_txs=*/true);\r\n+    BOOST_REQUIRE(ping_nonce_sent != 0);\r\n+\r\n+    auto time_elapsed = 1s;\r\n+    SetMockTime(GetMockTime() + time_elapsed);\r\n+    // No pong response has been received and current ping is outstanding.\r\n+    CheckPingTimes(std::chrono::microseconds::max(), 0us, time_elapsed);\r\n+\r\n+    CSerializedNetMsg pong_msg;\r\n+\r\n+    BOOST_TEST_MESSAGE(\"Receiving a PONG without nonce cancels our PING\");\r\n+    {\r\n+        ASSERT_DEBUG_LOG(\"Short payload\");\r\n+        pong_msg = CNetMsgMaker{PROTOCOL_VERSION}.Make(NetMsgType::PONG);\r\n+        ReceiveAndProcessMessage(pong_msg);\r\n+    }\r\n+    // Ping metrics have not been updated and there is no ping outstanding.\r\n+    CheckPingTimes(std::chrono::microseconds::max(), 0us, 0us);\r\n+\r\n+    BOOST_TEST_MESSAGE(\"Receiving an unrequested PONG is logged and ignored\");\r\n+    {\r\n+        ASSERT_DEBUG_LOG(\"Unsolicited pong without ping\");\r\n+        pong_msg = CNetMsgMaker{PROTOCOL_VERSION}.Make(NetMsgType::PONG, /*nonce=*/(uint64_t)0);\r\n+        ReceiveAndProcessMessage(pong_msg);\r\n+    }\r\n+    // Ping metrics have not been updated and there is no ping outstanding.\r\n+    CheckPingTimes(std::chrono::microseconds::max(), 0us, 0us);\r\n+\r\n+    SendPing();\r\n+\r\n+    BOOST_TEST_MESSAGE(\"Receiving a PONG with the wrong nonce does not cancel our PING\");\r\n+    {\r\n+        ASSERT_DEBUG_LOG(\"Nonce mismatch\");\r\n+        pong_msg = CNetMsgMaker{PROTOCOL_VERSION}.Make(NetMsgType::PONG, /*nonce=*/ping_nonce_sent + 1);\r\n+        ReceiveAndProcessMessage(pong_msg);\r\n+    }\r\n+    // Ping metrics have not been updated and there is an outstanding ping.\r\n+    time_elapsed = 5s;\r\n+    SetMockTime(GetMockTime() + time_elapsed);\r\n+    CheckPingTimes(std::chrono::microseconds::max(), 0us, time_elapsed);\r\n+\r\n+    BOOST_TEST_MESSAGE(\"Receiving a PONG with nonce=0 cancels our PING\");\r\n+    {\r\n+        ASSERT_DEBUG_LOG(\"Nonce zero\");\r\n+        pong_msg = CNetMsgMaker{PROTOCOL_VERSION}.Make(NetMsgType::PONG, /*nonce=*/(uint64_t)0);\r\n+        ReceiveAndProcessMessage(pong_msg);\r\n+    }\r\n+    // Ping metrics have not been updated and there is no ping outstanding.\r\n+    CheckPingTimes(std::chrono::microseconds::max(), 0us, 0us);\r\n+\r\n+    SendPing();\r\n+\r\n+    time_elapsed = 5s;\r\n+    SetMockTime(GetMockTime() + time_elapsed);\r\n+\r\n+    BOOST_TEST_MESSAGE(\"Receiving a PONG with the correct nonce cancels our PING\");\r\n+    pong_msg = CNetMsgMaker{PROTOCOL_VERSION}.Make(NetMsgType::PONG, ping_nonce_sent);\r\n+    ReceiveAndProcessMessage(pong_msg);\r\n+    // Ping metrics have been updated and there is no ping outstanding.\r\n+    CheckPingTimes(time_elapsed, time_elapsed, 0us);\r\n+\r\n+    peerman.FinalizeNode(outbound_peer);\r\n+\r\n+    CaptureMessage = CaptureMessageOrig;\r\n+    m_node.args->ForceSetArg(\"-capturemessages\", \"0\");\r\n+    // PeerManager::ProcessMessage() calls AddTimeData() which changes the internal state\r\n+    // in timedata.cpp and later confuses the test \"timedata_tests/addtimedata\". Thus reset\r\n+    // that state as it was before our test was run.\r\n+    TestOnlyResetTimeData();\r\n+}\r\n+\r\n BOOST_AUTO_TEST_SUITE_END()\r\n```\r\n</details>\r\n",
      "created_at": "2022-11-15T08:19:53Z",
      "updated_at": "2022-11-15T08:19:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1022470321",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1022470321"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 668,
      "original_line": 668,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1135979252",
      "pull_request_review_id": 1339941979,
      "id": 1135979252,
      "node_id": "PRRC_kwDOABII585Dtar0",
      "diff_hunk": "@@ -0,0 +1,188 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>\n+#include <serialize.h>\n+#include <test/util/net.h>\n+#include <test/util/setup_common.h>\n+#include <util/string.h>\n+#include <util/system.h>\n+#include <util/time.h>\n+#include <timedata.h>\n+#include <validation.h>\n+\n+#include <array>\n+#include <stdint.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+static CService ip(uint32_t i)\n+{\n+    struct in_addr s;\n+    s.s_addr = i;\n+    return CService(CNetAddr(s), Params().GetDefaultPort());\n+}\n+\n+/** Mock the connections interface. */\n+class ConnectionsInterfaceMock : public ConnectionsInterface\n+{\n+public:\n+    bool ForNode(NodeId id, std::function<bool(CNode* pnode)> func) override { return true; };\n+    using NodeFn = std::function<void(CNode*)>;\n+    void ForEachNode(const NodeFn& func) override {};\n+    void ForEachNode(const NodeFn& func) const override {};\n+    void PushMessage(CNode* pnode, CSerializedNetMsg&& msg) override;\n+    CSipHasher GetDeterministicRandomizer(uint64_t id) const override { return {0, 0}; };\n+    void WakeMessageHandler() override {};\n+    bool OutboundTargetReached(bool historicalBlockServingLimit) const override { return true; };\n+    std::vector<CAddress> GetAddresses(size_t max_addresses,\n+                                       size_t max_pct,\n+                                       std::optional<Network> network) const override { return {}; };\n+    std::vector<CAddress> GetAddresses(CNode& requestor, size_t max_addresses, size_t max_pct) override { return {}; };\n+    bool DisconnectNode(const CNetAddr& addr) override { return true; };\n+    unsigned int GetReceiveFloodSize() const override { return 0; };\n+    int GetExtraFullOutboundCount() const override { return 0; };\n+    int GetExtraBlockRelayCount() const override { return 0; };\n+    void SetTryNewOutboundPeer(bool flag) override {};\n+    bool GetTryNewOutboundPeer() const override { return true; };\n+    bool GetNetworkActive() const override { return true; };\n+    bool GetUseAddrmanOutgoing() const override { return true; };\n+    void StartExtraBlockRelayPeers() override {};\n+    bool ShouldRunInactivityChecks(const CNode& node, std::chrono::seconds now) const override { return true; };\n+    bool CheckIncomingNonce(uint64_t nonce) override { return true; };\n+\n+    void NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const;\n+    bool ReceiveMsgFrom(CNode& node, CSerializedNetMsg& ser_msg) const;\n+\n+    virtual ~ConnectionsInterfaceMock() {}\n+\n+    /** Count of number of each message type sent */\n+    std::map<std::string, uint64_t> m_message_types_sent;\n+};\n+\n+void ConnectionsInterfaceMock::PushMessage(CNode* pnode, CSerializedNetMsg&& msg)\n+{\n+    BOOST_TEST_MESSAGE(strprintf(\"sending message %s to peer %d\", msg.m_type, pnode->GetId()));\n+    m_message_types_sent[msg.m_type]++;\n+}\n+\n+void ConnectionsInterfaceMock::NodeReceiveMsgBytes(CNode& node, Span<const uint8_t> msg_bytes, bool& complete) const\n+{\n+    assert(node.ReceiveMsgBytes(msg_bytes, complete));\n+    if (complete) {\n+        size_t nSizeAdded = 0;\n+        auto it(node.vRecvMsg.begin());\n+        for (; it != node.vRecvMsg.end(); ++it) {\n+            // vRecvMsg contains only completed CNetMessage\n+            // the single possible partially deserialized message are held by TransportDeserializer\n+            nSizeAdded += it->m_raw_message_size;\n+        }\n+        {\n+            LOCK(node.cs_vProcessMsg);\n+            node.vProcessMsg.splice(node.vProcessMsg.end(), node.vRecvMsg, node.vRecvMsg.begin(), it);\n+            node.nProcessQueueSize += nSizeAdded;\n+        }\n+    }",
      "path": "src/test/peerman_tests.cpp",
      "position": 116,
      "original_position": 95,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "#27257 dedupes this code across the entire code base, reviewing that would help move this forward.",
      "created_at": "2023-03-14T17:49:26Z",
      "updated_at": "2023-03-14T17:49:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1135979252",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1135979252"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": 104,
      "original_start_line": 83,
      "start_side": "RIGHT",
      "line": 116,
      "original_line": 95,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171560928",
      "pull_request_review_id": 1392417614,
      "id": 1171560928,
      "node_id": "PRRC_kwDOABII585F1Jng",
      "diff_hunk": "@@ -0,0 +1,188 @@\n+// Copyright (c) 2011-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <arith_uint256.h>\n+#include <banman.h>\n+#include <chainparams.h>\n+#include <net.h>\n+#include <net_processing.h>\n+#include <netmessagemaker.h>\n+#include <pubkey.h>\n+#include <script/sign.h>\n+#include <script/signingprovider.h>\n+#include <script/standard.h>",
      "path": "src/test/peerman_tests.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "bdfe134ed6b13e69becc43c9e0a8f958e8931b0a",
      "in_reply_to_id": 1013149806,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Seems like a lot of these includes are unnecessary and can be removed... With the following diff it still compiles\r\n\r\nA way to verify is to add the file to `ci/test/06_script_b.sh` and look at the `lint` CI output after repushing.",
      "created_at": "2023-04-19T16:06:04Z",
      "updated_at": "2023-04-19T16:06:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1171560928",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171560928"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 14,
      "original_line": 14,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171566094",
      "pull_request_review_id": 1392429137,
      "id": 1171566094,
      "node_id": "PRRC_kwDOABII585F1K4O",
      "diff_hunk": "@@ -663,7 +664,64 @@ class NetEventsInterface\n     ~NetEventsInterface() = default;\n };\n \n-class CConnman\n+/** Interface class for interacting with CConnman */\n+class ConnectionsInterface",
      "path": "src/net.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "original_commit_id": "9c04c32101cd458c336de1d66ad296dc7f1cf35d",
      "in_reply_to_id": 1014128036,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">> the tests added in this PR can be done without ... touching the source code at all\r\n\r\n> Yes, that works. Here it is:\r\n\r\nNice!\r\n\r\nVirtualization/dynamic dispatch has performance and overhead costs in addition to increased class/code size and complexity, and there are places in this codebase where it seems to have been avoided, and still is, for that reason. For an example, see the discussion in #25349.\r\n\r\nIf virtualization is still considered to be worth the overhead here, on its own merits above and beyond facilitating unit testing that can be done without it, it may be good to open a PR doing only that, as also suggested by someone above (and maybe consider a non-virtual public interface that calls private virtual implementation methods, i.e. the Template pattern via the Non-Virtual Interface (NVI) idiom. There is a simple example at https://github.com/jonatack/bitcoin/commit/b05383211239d564e98b19c96c80ff778e054146).",
      "created_at": "2023-04-19T16:10:41Z",
      "updated_at": "2023-04-19T16:10:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25515#discussion_r1171566094",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1171566094"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25515"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 668,
      "original_line": 668,
      "side": "RIGHT"
    }
  ]
}
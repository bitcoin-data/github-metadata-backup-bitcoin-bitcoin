{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066",
    "id": 2695954303,
    "node_id": "PR_kwDOABII586gsP9_",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33066",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33066.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33066.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0f919d01db723f0b384800ab10b5719befbf4d68",
    "number": 33066,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "p2p: never check tx rejections by txid",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This PR removes the rejection cache filtering part of all txid-based tx requests. In practice, this seems to only be used for orphan resolution because everybody supports wtxidrelay. And so in essence, this PR removes the logic that stops us from attempting orphan resolution when parents are found in the rejection filter.\r\n\r\nBackground:\r\nWe have 2 bloom filters for remembering transactions that we've rejected so we don't redownload them, `RecentRejectsFilter` and `RecentRejectsReconsiderableFilter`. This lets us save a little bit of bandwidth on rejected transactions, particularly if we have policy differences. It's not designed to stop attackers from wasting our download bandwidth, as they can create as many policy-invalid transactions with different witnesses as they want. We generally only put wtxids and not txids in them (see #18044), except for these cases:\r\n(A) When we specifically know that the rejection reason is not due to the witness (however, this is only done for `!AreInputsStandard`, even though there are other cases we could apply)\r\n(B) When the transaction has no witness, so its txid == wtxid\r\n(C) (With #32379) When the transaction's witness has been stripped, so txid == wtxid\r\nWe check the filters to decide whether to send a getdata for an inv, whether we should validate a tx we just downloaded, and whether we should keep an orphan: we look the missing parents up by (prevout) txid and throw the orphan away if its parents were already rejected. That means there are very few cases where we save bandwidth by finding a txid in the filter.\r\n\r\nRationale: mainly that the additional complexity is not worth the bandwidth savings. TLDR: this case does not seem to ever hit in practice. Even if that is circumstantial, the number of transactions this filter could apply to is extremely small.\r\n\r\nI collected some stats over a couple of weeks, setting mempoolexpiry to 1 hour to try to artificially increase orphan rates (though I don't know whether the effect is significant):\r\n- I'm seeing 100% of peers support wtxidrelay. Bitcoin Core has been doing this since ~5 years ago. I'm sure there are some nodes that don't do it, but it'll probably be rare that we are surrounded by txidrelay peers and that we have a policy difference causing us to reject the transaction that they all send us.\r\n- Orphan parent fetching was 3.64% of my transaction requests.\r\n- 93.77% of all transactions I receive have witnesses (includes accepted and rejected ones). 96.20% of orphan parents I fetched had witnesses.\r\n- I found no cases of already-rejected parent txids in the past week. This could be because all my peers have the same policy as me (which might not always be true), but the number of nonsegwit orphan parents in general is just so tiny - a few dozen requests per day.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-07-25T20:47:00Z",
    "updated_at": "2025-09-02T14:08:34Z",
    "closed_at": "2025-09-02T14:08:34Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "glozow:2025-07-wtxid-only-rej",
      "ref": "2025-07-wtxid-only-rej",
      "sha": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 244262754,
        "node_id": "MDEwOlJlcG9zaXRvcnkyNDQyNjI3NTQ=",
        "name": "bitcoin",
        "full_name": "glozow/bitcoin",
        "owner": {
          "login": "glozow",
          "id": 25183001,
          "node_id": "MDQ6VXNlcjI1MTgzMDAx",
          "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/glozow",
          "html_url": "https://github.com/glozow",
          "followers_url": "https://api.github.com/users/glozow/followers",
          "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
          "organizations_url": "https://api.github.com/users/glozow/orgs",
          "repos_url": "https://api.github.com/users/glozow/repos",
          "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/glozow/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/glozow/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/glozow/bitcoin",
        "archive_url": "https://api.github.com/repos/glozow/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/glozow/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/glozow/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/glozow/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/glozow/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/glozow/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/glozow/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/glozow/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/glozow/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/glozow/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/glozow/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/glozow/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/glozow/bitcoin/events",
        "forks_url": "https://api.github.com/repos/glozow/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/glozow/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/glozow/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/glozow/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/glozow/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/glozow/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/glozow/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/glozow/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/glozow/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/glozow/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/glozow/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/glozow/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/glozow/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/glozow/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/glozow/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/glozow/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:glozow/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/glozow/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/glozow/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/glozow/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/glozow/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/glozow/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/glozow/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/glozow/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/glozow/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/glozow/bitcoin/hooks",
        "svn_url": "https://github.com/glozow/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 17,
        "watchers_count": 17,
        "size": 282768,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-09-02T13:40:10Z",
        "created_at": "2020-03-02T02:31:56Z",
        "updated_at": "2025-09-02T13:40:26Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "643bacd124f567b59f5ad290930dc533e2f06633",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37692,
        "stargazers_count": 85317,
        "watchers_count": 85317,
        "size": 291772,
        "default_branch": "master",
        "open_issues_count": 762,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-09-02T09:57:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-09-02T13:23:56Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 46,
    "deletions": 222,
    "changed_files": 7,
    "commits": 1,
    "review_comments": 4,
    "comments": 20
  },
  "events": [
    {
      "event": "labeled",
      "id": 18821367255,
      "node_id": "LE_lADOABII587CkfDTzwAAAARh10XX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18821367255",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T20:47:03Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 3120300082,
      "node_id": "IC_kwDOABII5865_AAy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3120300082",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T20:47:05Z",
      "updated_at": "2025-08-06T21:11:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33066.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3137446026), [sipa](https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3161635101) |\n| User requested bot ignore | [cedwies](https://github.com/bitcoin/bitcoin/pull/33066#pullrequestreview-3056948992) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33116](https://github.com/bitcoin/bitcoin/pull/33116) (refactor: Convert uint256 to Txid by marcofleon)\n* [#29060](https://github.com/bitcoin/bitcoin/pull/29060) (Policy: Report reason inputs are non standard by ismaelsadeeq)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3120300082",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3120300985,
      "node_id": "IC_kwDOABII5865_AO5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3120300985",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T20:47:26Z",
      "updated_at": "2025-07-25T20:47:26Z",
      "author_association": "MEMBER",
      "body": "cc @darosior",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3120300985",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "mentioned",
      "id": 18821371822,
      "node_id": "MEE_lADOABII587CkfDTzwAAAARh11eu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18821371822",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T20:47:28Z"
    },
    {
      "event": "subscribed",
      "id": 18821371876,
      "node_id": "SE_lADOABII587CkfDTzwAAAARh11fk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18821371876",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T20:47:28Z"
    },
    {
      "event": "commented",
      "id": 3120416280,
      "node_id": "IC_kwDOABII5865_cYY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3120416280",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-25T21:27:47Z",
      "updated_at": "2025-07-25T21:27:47Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3120416280",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "reviewed",
      "id": 3056948992,
      "node_id": "PRR_kwDOABII5862NVcA",
      "url": null,
      "actor": null,
      "commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-07-25T22:40:37Z",
      "author_association": "NONE",
      "body": "Built PR 33066 on macOS 14 (Apple Silicon) with CMake + Ninja, Debug.\r\n- unit tests: 141/141 pass, 9 min wall time\r\n\r\nwhat I checked:\r\nâ€’ AlreadyHaveTx(): tx-id path now skips both reject filters; wtx-id path unchanged.  \r\nâ€’ MempoolRejectedTx(): parent-txid rejection bail-out removed â†’ orphans kept even if parents sit in a reject cache \r\nâ€’ updated tests (expected_behaviors table + orphan-handling cases) run green.\r\n\r\nQuestion (still wrapping my head around this):\r\nMempoolRejectedTx still inserts a tx-id into RecentRejectsFilter for TX_INPUTS_NOT_STANDARD, but After this patch AlreadyHaveTx no longer consults the filter by tx-id. Is that entry now redundant, or do other call-sites still depend on it?\r\n\r\n(Second review, so no (N)ACK yet. just confirming I understand the (PR) flow.)",
      "user": {
        "login": "cedwies",
        "id": 141683552,
        "node_id": "U_kgDOCHHrYA",
        "avatar_url": "https://avatars.githubusercontent.com/u/141683552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cedwies",
        "html_url": "https://github.com/cedwies",
        "followers_url": "https://api.github.com/users/cedwies/followers",
        "following_url": "https://api.github.com/users/cedwies/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/cedwies/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/cedwies/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/cedwies/subscriptions",
        "organizations_url": "https://api.github.com/users/cedwies/orgs",
        "repos_url": "https://api.github.com/users/cedwies/repos",
        "events_url": "https://api.github.com/users/cedwies/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/cedwies/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#pullrequestreview-3056948992",
      "submitted_at": "2025-07-25T22:40:37Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
    },
    {
      "event": "commented",
      "id": 3128957421,
      "node_id": "IC_kwDOABII5866gBnt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3128957421",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-28T19:31:16Z",
      "updated_at": "2025-07-28T19:31:16Z",
      "author_association": "MEMBER",
      "body": ">  MempoolRejectedTx still inserts a tx-id into RecentRejectsFilter for TX_INPUTS_NOT_STANDARD, but After this patch AlreadyHaveTx no longer consults the filter by tx-id. Is that entry now redundant, or do other call-sites still depend on it?\r\n\r\nGood question. I think we can remove that actually, since we are no longer interested in whether a transaction's txid is in the cache ðŸ¤” ",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3128957421",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3135258539,
      "node_id": "IC_kwDOABII58664D-r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3135258539",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T08:03:18Z",
      "updated_at": "2025-07-30T08:03:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "> TLDR, this PR removes the rejection cache filtering part of all txid-based tx requests.\r\n\r\nThere's three cases here I think:\r\n\r\n * orphan resolution from wtxidrelay peers (WTXIDRELAY)\r\n * tx relay from segwit-supporting, non-wtxidrelay peers (NODE_WITNESS, no WTXIDRELAY, 0.13.1 to 0.20.x, Jan 2021)\r\n * tx relay from non-segwit peers\r\n\r\nThe last case case is trivial -- non-segwit peers can be treated as doing wtxid relay for caching because all the txs they relay will have the same value for txid and wtxid.\r\n\r\nFor orphan resolution, caching bad txids seems mostly undesirable: we can cache INPUTS_NON_STANDARD since that will fail repeatedly, but can't cache anything much else, as different witness could make an acceptable transaction. I think it should be possible to detect INPUTS_NON_STANDARD versus WITNESS_STRIPPED or other failures, so I think that behaviour could actually be retained? Something like:\r\n\r\n```c++\r\nstatic bool RequiresWitnessData(TxoutType txo)\r\n{\r\n    switch(txo) {\r\n    case WITNESS_V0_SCRIPTHASH:\r\n    case WITNESS_V0_KEYHASH:\r\n    case WITNESS_V1_TAPROOT:\r\n        return true;\r\n    default: // should list all cases for completeness and compiler checks\r\n         break;\r\n    }\r\n    return false;\r\n}\r\n\r\nbool AreInputsStandard(const CTransaction& tx, const CCoinsViewCache& mapInputs, bool& is_stripped)\r\n{\r\n    is_stripped = false;\r\n    ...\r\n    const bool has_witness_data = tx.HasWitness();\r\n    for (unsigned int i = 0; i < tx.vin.size(); i++) {\r\n        const CTxOut& prev = mapInputs.AccessCoin(tx.vin[i].prevout).out;\r\n\r\n        std::vector<std::vector<unsigned char> > vSolutions;\r\n        TxoutType whichType = Solver(prev.scriptPubKey, vSolutions);\r\n        if (!has_witness_data && !is_stripped && RequiresWitnessData(whichType)) {\r\n            is_stripped = true;\r\n        }\r\n        if (whichType == TxoutType::NONSTANDARD || whichType == TxoutType::WITNESS_UNKNOWN) {\r\n        ...\r\n    }\r\n    if (is_stripped) return false;\r\n    return true;\r\n}\r\n\r\n    bool is_stripped;\r\n    if (m_pool.m_opts.require_standard && !AreInputsStandard(tx, m_view, is_strippped)) {\r\n        if (is_stripped) {\r\n            return state.Invalid(TxValidationResult::TX_WITNESS_STRIPPED, \"bad-txns-missing-witness\");\r\n        } else { \r\n            return state.Invalid(TxValidationResult::TX_INPUTS_NOT_STANDARD, \"bad-txns-nonstandard-inputs\");\r\n         }\r\n    }\r\n```\r\n\r\n(just passing `state` through probably would be better than the bool ref)\r\n\r\n`WITNESS_STRIPPED` would indicate you should retry requesting by txid for orphan resolution; `INPUTS_NOT_STANDARD` means there's no point retrying. Other errors also indicate you should retry -- a tx with the same txid but different witness data may pass validation.\r\n\r\nIn that case, I believe adding the wtxid to the reject filter, and `INPUTS_NOT_STANDARD` txids to the reject filter, and checking the reject filter when requestion both by wtxid and txid would give good/correct behaviour for wtxidrelay and non-segwit peers, and I think best-possible behavour for non-wtxidrelay segwit peers?",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3135258539",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3137446026,
      "node_id": "IC_kwDOABII5867AaCK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3137446026",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T18:38:33Z",
      "updated_at": "2025-07-30T19:02:38Z",
      "author_association": "MEMBER",
      "body": "Yes, we could do that. I suppose the minimal way to do so today on master would be to simply check whether we are spending any Segwit input while the transaction has no witness after `CheckInputScripts` failed:\r\n<details>\r\n<summary>Expand patch</summary>\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 09e04ff0ddb..8f86b630ef5 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -1254,13 +1254,17 @@ bool MemPoolAccept::PolicyScriptChecks(const ATMPArgs& args, Workspace& ws)\r\n     // Check input scripts and signatures.\r\n     // This is done last to help prevent CPU exhaustion denial-of-service attacks.\r\n     if (!CheckInputScripts(tx, state, m_view, scriptVerifyFlags, true, false, ws.m_precomputed_txdata, GetValidationCache())) {\r\n-        // SCRIPT_VERIFY_CLEANSTACK requires SCRIPT_VERIFY_WITNESS, so we\r\n-        // need to turn both off, and compare against just turning off CLEANSTACK\r\n-        // to see if the failure is specifically due to witness validation.\r\n-        TxValidationState state_dummy; // Want reported failures to be from first CheckInputScripts\r\n-        if (!tx.HasWitness() && CheckInputScripts(tx, state_dummy, m_view, scriptVerifyFlags & ~(SCRIPT_VERIFY_WITNESS | SCRIPT_VERIFY_CLEANSTACK), true, false, ws.m_precomputed_txdata, GetValidationCache()) &&\r\n-                !CheckInputScripts(tx, state_dummy, m_view, scriptVerifyFlags & ~SCRIPT_VERIFY_CLEANSTACK, true, false, ws.m_precomputed_txdata, GetValidationCache())) {\r\n-            // Only the witness is missing, so the transaction itself may be fine.\r\n+        // CheckInputScripts filled the spent outputs. Detect whether this transaction's witness was stripped by checking\r\n+        // whether this transaction spends a Segwit output but does not have a witness.\r\n+        Assert(ws.m_precomputed_txdata.m_spent_outputs_ready);\r\n+        const auto& spent_txos{ws.m_precomputed_txdata.m_spent_outputs};\r\n+        Assert(spent_txos.size() == tx.vin.size());\r\n+        int ver;\r\n+        std::vector<uint8_t> prog;\r\n+        const bool spends_segwit{std::any_of(spent_txos.begin(), spent_txos.end(), [&ver, &prog](const CTxOut& txo) {\r\n+            return txo.scriptPubKey.IsWitnessProgram(ver, prog);\r\n+        })};\r\n+        if (!tx.HasWitness() && spends_segwit) {\r\n             state.Invalid(TxValidationResult::TX_WITNESS_STRIPPED,\r\n                     state.GetRejectReason(), state.GetDebugMessage());\r\n         }\r\n```\r\n\r\n</details>\r\n\r\nHowever it seemed cleaner to me to get rid of the WITNESS_STRIPPED edge case detection in the first place, which was always meant to go?",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3137446026",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3137458271,
      "node_id": "IC_kwDOABII5867AdBf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3137458271",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T18:43:49Z",
      "updated_at": "2025-07-30T18:43:49Z",
      "author_association": "MEMBER",
      "body": "> However it seemed cleaner to me to get rid of the WITNESS_STRIPPED edge case detection in the first place, which was always meant to go?\r\n\r\nI didn't realize it was always meant to go - how do you know that?\r\n\r\nFwiw, I do think that being able to detect `WITNESS_STRIPPED` without triple validation is the main thing we want, so would prioritize that kind of solution. At the same time, my main point in the OP is that being able to cache `INPUTS_NOT_STANDARD` isn't very helpful to us in practice, so I would still be weakly in favor of this PR.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3137458271",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3137486313,
      "node_id": "IC_kwDOABII5867Aj3p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3137486313",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T18:55:06Z",
      "updated_at": "2025-07-30T18:55:06Z",
      "author_association": "MEMBER",
      "body": "> I didn't realize it was always meant to go - how do you know that?\r\n\r\nIt was introduced in https://github.com/bitcoin/bitcoin/pull/18044 as a hack until the network upgrades to wtxid relay with an explicit mention it can be (according to author, [should be](https://github.com/bitcoin/bitcoin/pull/18044#discussion_r388445400)) removed afterward:\r\nhttps://github.com/bitcoin/bitcoin/blob/8a94cf8efebc3177effcfc1160560735b8caf34b/src/node/txdownloadman_impl.cpp#L452-L454\r\n\r\nOf course that it was *meant to* go then does not implies it *needs to* go now. But i think this still holds. It is a weird special case that is not necessary post wtxid relay (and post this PR).",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3137486313",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3137704209,
      "node_id": "IC_kwDOABII5867BZER",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3137704209",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T20:19:45Z",
      "updated_at": "2025-07-30T20:19:45Z",
      "author_association": "MEMBER",
      "body": "I opened https://github.com/bitcoin/bitcoin/pull/33105, which ended up implementing a variant of @ajtowns' suggestion, because as pointed out the resource consumption gains can be achieved independently of this work (which i still think is desirable) as a much smaller patch which i think would be nice to get in before the feature freeze.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3137704209",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "mentioned",
      "id": 18906959511,
      "node_id": "MEE_lADOABII587CkfDTzwAAAARm8U6X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18906959511",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T20:19:46Z"
    },
    {
      "event": "subscribed",
      "id": 18906959613,
      "node_id": "SE_lADOABII587CkfDTzwAAAARm8U79",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18906959613",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T20:19:46Z"
    },
    {
      "event": "commented",
      "id": 3138260890,
      "node_id": "IC_kwDOABII5867Dg-a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3138260890",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T01:07:29Z",
      "updated_at": "2025-07-31T01:07:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "> However it seemed cleaner to me to get rid of the WITNESS_STRIPPED edge case detection in the first place, which was always meant to go?\r\n\r\nI don't think it makes sense to get rid of WITNESS_STRIPPED while we still care about resolving orphans via their missing parents' txids. If/when we have protocol support for receiver-initiated package relay by wtxid, then I think it could make sense to treat every request as being by wtxid -- so a witness-stripped response from a non-wtxid-relay peer would mean not requesting that tx from any other non-wtxid-relay peer, but wouldn't prevent requesting the same tx from wtxid-relay peers.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3138260890",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "reviewed",
      "id": 3084700804,
      "node_id": "PRR_kwDOABII58633MyE",
      "url": null,
      "actor": null,
      "commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-04T15:20:15Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "Crypt-iQ",
        "id": 15145615,
        "node_id": "MDQ6VXNlcjE1MTQ1NjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/15145615?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Crypt-iQ",
        "html_url": "https://github.com/Crypt-iQ",
        "followers_url": "https://api.github.com/users/Crypt-iQ/followers",
        "following_url": "https://api.github.com/users/Crypt-iQ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Crypt-iQ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Crypt-iQ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Crypt-iQ/subscriptions",
        "organizations_url": "https://api.github.com/users/Crypt-iQ/orgs",
        "repos_url": "https://api.github.com/users/Crypt-iQ/repos",
        "events_url": "https://api.github.com/users/Crypt-iQ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Crypt-iQ/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#pullrequestreview-3084700804",
      "submitted_at": "2025-08-04T15:20:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBmOTE5ZDAxZGI3MjNmMGIzODQ4MDBhYjEwYjU3MTliZWZiZjRkNjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0f919d01db723f0b384800ab10b5719befbf4d68",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0f919d01db723f0b384800ab10b5719befbf4d68",
      "tree": {
        "sha": "f1738488ebe33423a8a16d89b1817c20f361c432",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f1738488ebe33423a8a16d89b1817c20f361c432"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/643bacd124f567b59f5ad290930dc533e2f06633",
          "sha": "643bacd124f567b59f5ad290930dc533e2f06633",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/643bacd124f567b59f5ad290930dc533e2f06633"
        }
      ],
      "message": "[p2p] never check rejections by txid in AlreadyHaveTx\n\nWhile this may result in some wasted bandwidth for orphans that have\ninvalid non-witness parents, we expect this case to be rare. Allows us\nto cache witness-stripped transactions in recent rejections without\nworrying about blocking 1p1cs.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2025-08-04T17:34:55Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2025-05-05T20:05:48Z"
      },
      "sha": "0f919d01db723f0b384800ab10b5719befbf4d68"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18975521577,
      "node_id": "HRFPE_lADOABII587CkfDTzwAAAARrB3sp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18975521577",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "commit_url": "https://api.github.com/repos/glozow/bitcoin/commits/0f919d01db723f0b384800ab10b5719befbf4d68",
      "created_at": "2025-08-04T17:36:14Z"
    },
    {
      "event": "commented",
      "id": 3151919059,
      "node_id": "IC_kwDOABII58673nfT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3151919059",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-04T18:31:30Z",
      "updated_at": "2025-08-04T18:31:30Z",
      "author_association": "MEMBER",
      "body": "Do we have numbers on how often the rejection filter catches things by txid? I suspect that in practice that will be just due to fetches of orphan parents which are (policy) invalid, due to non-witness reasons?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3151919059",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3151926755,
      "node_id": "IC_kwDOABII58673pXj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3151926755",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-04T18:34:38Z",
      "updated_at": "2025-08-04T18:34:38Z",
      "author_association": "MEMBER",
      "body": "> Do we have numbers on how often the rejection filter catches things by txid? \r\n\r\nI didn't see any in a 2-week period ðŸ˜… ",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3151926755",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3155611529,
      "node_id": "IC_kwDOABII5868Fs-J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3155611529",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T15:08:41Z",
      "updated_at": "2025-08-05T20:09:34Z",
      "author_association": "MEMBER",
      "body": "I still think this PR is preferable to #33105. The latter will inevitably introduce more false-positive witness stripped errors, whereby we won't add some transactions with consensus/standardness errors to the reject filter. Since we already don't add all transactions with consensus/standardness errors to the reject filter, if we also don't care about these additional false positives, we might as well just to the cleaner thing and get rid of this filter entirely as is done here.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3155611529",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3159450863,
      "node_id": "IC_kwDOABII5868UWTv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3159450863",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T10:41:51Z",
      "updated_at": "2025-08-06T10:41:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I still think this PR is preferable to #33105. The latter will inevitably introduce more false-positive witness stripped errors,\r\n\r\nI don't think false-positive witness stripped errors are harmful, apart from the CPU they required to be detected in the first place.\r\n\r\nOnly \"misbehaving\" peers will send us witness stripped txs in the first place, so the only benefit caching an error does (which is what we'd do if we replaced the \"false\" witness stripped result with something else) is only to prevent us from requesting the invalid tx from some other peer, but the only way any other peer would give us the tx in that case is if they were advertising and relaying invalid txs themselves. If we do have such peers, requesting the tx again by txid doesn't cost much if we get a witness-stripped version and detect that cheaply/quickly; and if we don't get a witness-stripped version we at least make some progress by being able to cache rejection by wtxid. If we have many peers relaying invalid txs to us, that will still be costly, but spending a lot of cpu/bandwidth doing validation is exactly what we'd expected in that scenario anyway.\r\n\r\nWhen we have almost entirely honest peers, we'll never see witness stripped errors in the first place; and aside from that we would expect our rejection caches to only see reconsiderable rejections (due to double spends and fee rate differences), and policy rejections (when we have different policy configuration to our peers). I think the only policy rejection you'd hit here that has any significant use in the network is if you were running with p2a validation disabled. So I don't think stats will be informative here -- this code aims to lower the impact of buggy clients, so you need buggy peers for it to have any impact.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3159450863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3161635101,
      "node_id": "IC_kwDOABII5868crkd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3161635101",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T21:11:50Z",
      "updated_at": "2025-08-08T13:04:32Z",
      "author_association": "MEMBER",
      "body": "Concept ACK.\r\n\r\nFirst of all, I'm convinced by the rationale for #33050 and #33105, and if we do (at least) the latter, then this PR isn't necessary anymore to get rid of the triple-validation costs, which would make it low-urgency. I think it's still a nice cleanup, as I don't think the code does much right now (see below).\r\n\r\nAside, I don't think we need to worry about the impact it may have on pre-segwit or pre-wtxidrelay peers; given how widespread wtxidrelay peers are, I think we can reasonably add/increase a fetching delay by a few seconds from non-wtxidrelay peers to minimize their impact, and/or consider preferentially peering with wtxidrelay peers (they have no service flag, but we could kick+cycle random outbound non-wtxidrelay peers if we have under some threshold).\r\n\r\n@ajtowns It's fair to say we shouldn't judge the quality of protection against buggy clients based on statistics, because all they might tell us that there currently are no relevant buggy clients. But @glozow is not seeing any hits on the txid rejection cache at all - not just no witness-stripped cases. And the txid rejection cache is there (I think) primarily to protect against bandwidth waste due to repeated downloading of rejected transactions from a (multitude of) policy-diverging peers, not buggy peers. The lack of such hits on the txid filter may of course also mean there are currently no such peers, but I think there are additional reasons why it doesn't do much.\r\n\r\nIf we exclude pre-wtxidrelay peers, the use of the txid rejection filter is limited to cases where all of these hold:\r\n* For consensus-valid transactions, as honest peers never create consensus-invalid transactions (because it is protection against redownloading from honest peers, not attackers, which can waste our bandwidth in much easier ways).\r\n* For policy-invalid transactions, where we have many peers which consider it policy-valid regardless.\r\n* For parents of orphans, because that's the only context in which we just know a transaction's txid.\r\n* For **a specific, small subset** of policy-invalidity reasons that do not involve the witness (namely: nonstandard input types, because that's currently the only thing where we assign failure to the txid, not the wtxid) or are non-segwit.\r\n\r\nFor it to matter, we'd need to be in a regime where there are lots of policy-diverging peers with a more liberal relay policy (... may happen), with a deployed-at-scale use case that causes such transactions (... might happen), that involve dependent transactions (... less likely), and where the invalidity is due to non-standard script input types or are non-segwit (... pretty unlikely).\r\n\r\nAs an alternative, it is possible to expand the number of validation failures that get attributed to txids, as there are more than just non-standard script input types in theory. Others include base size > 100k, non-standard output types, min feerate not met (when counting just base size), too many sigops, and probably a few more. I think those are still unlikely candidates of being things people build at scale, in dependent transactions, but if we think that's possible, I think expanding those to be txid-rejectable is a reasonable alternative to this PR.\r\n\r\nAbsent that alternative, I feel the hypothetical scenario where this matters is just too obscure to have a whole piece of net_processing state dedicated too. It uses memory too; without inserting txids in the rejection filter, we could shrink the filters, or improve their reliability.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3161635101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "mentioned",
      "id": 19021690441,
      "node_id": "MEE_lADOABII587CkfDTzwAAAARtx_ZJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19021690441",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T21:11:51Z"
    },
    {
      "event": "subscribed",
      "id": 19021690481,
      "node_id": "SE_lADOABII587CkfDTzwAAAARtx_Zx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19021690481",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T21:11:51Z"
    },
    {
      "event": "mentioned",
      "id": 19021690500,
      "node_id": "MEE_lADOABII587CkfDTzwAAAARtx_aE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19021690500",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T21:11:51Z"
    },
    {
      "event": "subscribed",
      "id": 19021690513,
      "node_id": "SE_lADOABII587CkfDTzwAAAARtx_aR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19021690513",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-06T21:11:51Z"
    },
    {
      "event": "commented",
      "id": 3164046002,
      "node_id": "IC_kwDOABII5868l4Ky",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3164046002",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-07T12:48:55Z",
      "updated_at": "2025-08-07T12:48:55Z",
      "author_association": "MEMBER",
      "body": "I've removed #32379 and mention of witness-stripping from the PR description; I think we can regard this as irrelevant for removing the triple validation (though it doesn't hurt).\r\n\r\nThe primary motivation now is to clean up logic that doesn't really get used.\r\n\r\n> Others include base size > 100k, non-standard output types, min feerate not met (when counting just base size), too many sigops, and probably a few more.\r\n\r\nAlso: large scriptSig, nonstandard output type, dust, OP_RETURN size and count (assuming this node's policy is more restrictive than its peers'). I would guess that if we added these, they would similarly be very rare and not really worth the added complexity.\r\n\r\nWe can wait until we're using something like BIP331 for orphan resolution (when txid requests are even rarer), but I think there's sufficient evidence this is already vestigal today.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3164046002",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3168866004,
      "node_id": "IC_kwDOABII58684Q7U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3168866004",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-08T17:55:44Z",
      "updated_at": "2025-08-08T17:55:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "sipa wrote:\r\n\r\n> * For **a specific, small subset** of policy-invalidity reasons that do not involve the witness (namely: nonstandard input types, because that's currently the only thing where we assign failure to the txid, not the wtxid) or are non-segwit.\r\n\r\nI believe you'd see that for new segwit spend types when you're not running an upgraded node (eg, taproot, p2a, perhaps p2qrh), which might help reduce your wasted bandwidth if you're running behind network consensus/policy changes as adoption increases.\r\n\r\n> As an alternative, it is possible to expand the number of validation failures that get attributed to txids, as there are more than just non-standard script input types in theory. Others include base size > 100k, non-standard output types, min feerate not met (when counting just base size), too many sigops, and probably a few more. I think those are still unlikely candidates of being things people build at scale, in dependent transactions, but if we think that's possible, I think expanding those to be txid-rejectable is a reasonable alternative to this PR.\r\n\r\nBumping tx version (TRUC), creating dust outputs (ephemeral dust), and increased OP_RETURN output count/size are all pretty recent examples of where we've loosened standardness rules in ways that could be assigned to the txid and that presumably we're hoping might get built on at scale. I don't see why we'd necessary stop doing that any time soon.\r\n\r\nOf course, all those things will only show up in normal usage if your mempool rules are stricter than what's being commonly seen on the network, and stricter than your peers, which is a situation we generally try to avoid. So even then, I don't think you'll see much effect in normal usage -- it's only defensive against future changes to policy that you don't adopt in sync with your peers, or if there's something of a schism in the p2p network and we care about the people adopting more restrictive policies.\r\n\r\nIt might be interesting to try getting similar stats on a Knots node with its more restrictive mempool policies -- potentially both just seeing how many times rejected txs get redundantly downloaded due to orphan resolution attempts, and tweaking it so that (some of) the errors that can be assigned to the txid are (which could catch the lower datacarrier limits, though not the inscription ones)... Alternatively maybe you could get similar stats from a post-wtxidrelay but pre-taproot node who might see child spends of taproot parents.\r\n\r\nThat doesn't help for non-standardness issues we can't assign to the txid -- so script upgrades and forbidding inscriptions and they like aren't helped by this mechanism, and can't be helped without some form of explicit package relay afaics.\r\n\r\nThe bad case there is if we get a child from many peers whose parent we've already probably rejected (by wtxid). If we can also reject the txid, then we save ourselves some bandwidth and perhaps validation costs; if we can't reject the txid, we likely have to redundantly request it from each peer in case many of our peers are dishonest, but one is honest and has a version of the tx that we'll accept. So rather than downloading it once, we're downloading it up to 8 or 120 times if all our peers have looser standardness policies than we do? We already check the wtxid against RecentRejects via AlreadyHaveTx via ReceivedTx, so we won't revalidate afaics.\r\n\r\nAs far as the adversarial case goes -- the worst case would be that in an environment where your rules are stricter than many of your peers, an adversary could force you to redownload/revalidate a large tx from many peers with you rejecting it each time. If your peers announced the tx by wtxid, you'd only do that once, and things would be fine. To trigger it happening by txid, they would need to use orphan resolution and actually have each of your peers announce the child (in order for you to believe its worth getting the parent from them). But that's just normal behaviour -- you're sending a real child tx through the network?\r\n\r\nSo I think the only potential benefit here is saving ourselves from redownloading a transaction ~10x or ~100x times more than we should, and agree that this is only in the cases where we're enforcing \"special\" standardness rules, and those rules can be assigned independent of the witness data, and only in cases where we have a child of the non-standard tx.\r\n\r\n> Absent that alternative, I feel the hypothetical scenario where this matters is just too obscure to have a whole piece of net_processing state dedicated too.\r\n\r\nI don't really think this change is much of a win -- the original motivation of avoiding the triple-script-check stuff is, but that can be avoided just by rejecting witness-stripped txs asap, independent of this change.\r\n\r\n>  It uses memory too; without inserting txids in the rejection filter, we could shrink the filters, or improve their reliability.\r\n\r\nI don't think that's quite true in practice? The logic in txdownloadman_impl.h for the the filter size is based on 1000 txs per second for 2 minutes creating 120000 entries; but that should presumably be doubled if we're assuming an attacker might add minimal witness data to invalid non-standard input txs as well in order to overflow the filter as quickly as possible in order to trick us into re-requesting txs from other peers? If we're approximately never seeing spends of non-standard inputs, then we also already have the reliability benefits of never adding them. Either way, 1.3MB, 2.6MB or 650kB of filters doesn't seem like a big deal to me. If we really cared about minimising the filter size we could probably rate-limit peers to a target of 10 or 20 rejected txs per second or similar.\r\n\r\nglozow wrote:\r\n\r\n> We can wait until we're using something like BIP331 for orphan resolution (when txid requests are even rarer), but I think there's sufficient evidence this is already vestigal today.\r\n\r\nI think the main reason it seems vestigial is dependent on running a node with policy rules at least as loose as (almost) all your peers, and assuming that everyone else who isn't doing the same now, will do so in short order.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3168866004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3168887520,
      "node_id": "IC_kwDOABII58684WLg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3168887520",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-08T18:01:58Z",
      "updated_at": "2025-08-08T18:01:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "> and/or consider preferentially peering with wtxidrelay peers\r\n\r\nIt would probably be good to be able to preferentially peer with package-relay peers when they exist, so even if peering with wtxidrelay peers is easy now, having the code in a way that's reusable for package-relay peers in future might be worthwhile.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3168887520",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "referenced",
      "id": 19060173484,
      "node_id": "REFE_lADOABII587CkfDTzwAAAARwEyqs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19060173484",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f679bad6052ad4b7ea0b57a406adc617746d54ed",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f679bad6052ad4b7ea0b57a406adc617746d54ed",
      "created_at": "2025-08-08T18:20:57Z"
    },
    {
      "event": "labeled",
      "id": 19145104176,
      "node_id": "LE_lADOABII587CkfDTzwAAAAR1Ixsw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19145104176",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:30:40Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3185651952,
      "node_id": "IC_kwDOABII58694TDw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3185651952",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:30:41Z",
      "updated_at": "2025-08-13T20:30:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nðŸ™ This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3185651952",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "commented",
      "id": 3245518101,
      "node_id": "IC_kwDOABII587Bcq0V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3245518101",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-02T14:08:34Z",
      "updated_at": "2025-09-02T14:08:34Z",
      "author_association": "MEMBER",
      "body": "Closing for now. We can revisit this cleanup later.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#issuecomment-3245518101",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33066"
    },
    {
      "event": "closed",
      "id": 19461472969,
      "node_id": "CE_lADOABII587CkfDTzwAAAASH_oLJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19461472969",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-02T14:08:34Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251819585",
      "pull_request_review_id": 3084700804,
      "id": 2251819585,
      "node_id": "PRRC_kwDOABII586GOApB",
      "diff_hunk": "@@ -361,83 +366,47 @@ node::RejectedTxTodo TxDownloadManagerImpl::MempoolRejectedTx(const CTransaction\n \n     if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n         // Only process a new orphan if this is a first time failure, as otherwise it must be either\n-        // already in orphanage or from 1p1c processing.\n+        // already in orphanage or from 1p1c processing. Also, we are unable to process orphans that are too low feerate\n+        // right now, as package validation only permits one generation of CPFP.\n         if (first_time_failure && !RecentRejectsFilter().contains(ptx->GetWitnessHash().ToUint256())) {\n-            bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n             // Deduplicate parent txids, so that we don't have to loop over\n             // the same parent txid more than once down below.\n             unique_parents = GetUniqueParents(tx);\n \n-            // Distinguish between parents in m_lazy_recent_rejects and m_lazy_recent_rejects_reconsiderable.\n-            // We can tolerate having up to 1 parent in m_lazy_recent_rejects_reconsiderable since we\n-            // submit 1p1c packages. However, fail immediately if any are in m_lazy_recent_rejects.\n-            std::optional<Txid> rejected_parent_reconsiderable;\n-            for (const Txid& parent_txid : unique_parents) {\n-                if (RecentRejectsFilter().contains(parent_txid.ToUint256())) {\n-                    fRejectedParents = true;\n-                    break;\n-                } else if (RecentRejectsReconsiderableFilter().contains(parent_txid.ToUint256()) &&",
      "path": "src/node/txdownloadman_impl.cpp",
      "position": 50,
      "original_position": 50,
      "commit_id": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "original_commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "in_reply_to_id": null,
      "user": {
        "login": "Crypt-iQ",
        "id": 15145615,
        "node_id": "MDQ6VXNlcjE1MTQ1NjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/15145615?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Crypt-iQ",
        "html_url": "https://github.com/Crypt-iQ",
        "followers_url": "https://api.github.com/users/Crypt-iQ/followers",
        "following_url": "https://api.github.com/users/Crypt-iQ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Crypt-iQ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Crypt-iQ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Crypt-iQ/subscriptions",
        "organizations_url": "https://api.github.com/users/Crypt-iQ/orgs",
        "repos_url": "https://api.github.com/users/Crypt-iQ/repos",
        "events_url": "https://api.github.com/users/Crypt-iQ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Crypt-iQ/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I get that if this is an orphan, we only have the parent txids. In most cases, it seems like this reconsiderable filter will be storing wtxid? The exceptions being a non-segwit tx and if a tx is TX_RECONSIDERABLE but is actually witness-stripped (I'm not sure if there are others?). I may be missing something here, are there more cases where this reconsiderable filter check is/was used with txid?",
      "created_at": "2025-08-04T15:20:15Z",
      "updated_at": "2025-08-04T15:21:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#discussion_r2251819585",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251819585"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 379,
      "original_line": 379,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251868109",
      "pull_request_review_id": 3084768120,
      "id": 2251868109,
      "node_id": "PRRC_kwDOABII586GOMfN",
      "diff_hunk": "@@ -361,83 +366,47 @@ node::RejectedTxTodo TxDownloadManagerImpl::MempoolRejectedTx(const CTransaction\n \n     if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n         // Only process a new orphan if this is a first time failure, as otherwise it must be either\n-        // already in orphanage or from 1p1c processing.\n+        // already in orphanage or from 1p1c processing. Also, we are unable to process orphans that are too low feerate\n+        // right now, as package validation only permits one generation of CPFP.\n         if (first_time_failure && !RecentRejectsFilter().contains(ptx->GetWitnessHash().ToUint256())) {\n-            bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n             // Deduplicate parent txids, so that we don't have to loop over\n             // the same parent txid more than once down below.\n             unique_parents = GetUniqueParents(tx);\n \n-            // Distinguish between parents in m_lazy_recent_rejects and m_lazy_recent_rejects_reconsiderable.\n-            // We can tolerate having up to 1 parent in m_lazy_recent_rejects_reconsiderable since we\n-            // submit 1p1c packages. However, fail immediately if any are in m_lazy_recent_rejects.\n-            std::optional<Txid> rejected_parent_reconsiderable;\n-            for (const Txid& parent_txid : unique_parents) {\n-                if (RecentRejectsFilter().contains(parent_txid.ToUint256())) {\n-                    fRejectedParents = true;\n-                    break;\n-                } else if (RecentRejectsReconsiderableFilter().contains(parent_txid.ToUint256()) &&",
      "path": "src/node/txdownloadman_impl.cpp",
      "position": 50,
      "original_position": 50,
      "commit_id": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "original_commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "in_reply_to_id": 2251819585,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yep, we don't ever put txids in the reconsiderable filter unless the txid is the same as the wtxid. We don't put witness-stripped in there either (even if we do #32379, as that will put it in the normal RecentRejects filter)",
      "created_at": "2025-08-04T15:41:32Z",
      "updated_at": "2025-08-04T15:41:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#discussion_r2251868109",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251868109"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 379,
      "original_line": 379,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251897931",
      "pull_request_review_id": 3084810121,
      "id": 2251897931,
      "node_id": "PRRC_kwDOABII586GOTxL",
      "diff_hunk": "@@ -361,83 +366,47 @@ node::RejectedTxTodo TxDownloadManagerImpl::MempoolRejectedTx(const CTransaction\n \n     if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n         // Only process a new orphan if this is a first time failure, as otherwise it must be either\n-        // already in orphanage or from 1p1c processing.\n+        // already in orphanage or from 1p1c processing. Also, we are unable to process orphans that are too low feerate\n+        // right now, as package validation only permits one generation of CPFP.\n         if (first_time_failure && !RecentRejectsFilter().contains(ptx->GetWitnessHash().ToUint256())) {\n-            bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n             // Deduplicate parent txids, so that we don't have to loop over\n             // the same parent txid more than once down below.\n             unique_parents = GetUniqueParents(tx);\n \n-            // Distinguish between parents in m_lazy_recent_rejects and m_lazy_recent_rejects_reconsiderable.\n-            // We can tolerate having up to 1 parent in m_lazy_recent_rejects_reconsiderable since we\n-            // submit 1p1c packages. However, fail immediately if any are in m_lazy_recent_rejects.\n-            std::optional<Txid> rejected_parent_reconsiderable;\n-            for (const Txid& parent_txid : unique_parents) {\n-                if (RecentRejectsFilter().contains(parent_txid.ToUint256())) {\n-                    fRejectedParents = true;\n-                    break;\n-                } else if (RecentRejectsReconsiderableFilter().contains(parent_txid.ToUint256()) &&",
      "path": "src/node/txdownloadman_impl.cpp",
      "position": 50,
      "original_position": 50,
      "commit_id": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "original_commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "in_reply_to_id": 2251819585,
      "user": {
        "login": "Crypt-iQ",
        "id": 15145615,
        "node_id": "MDQ6VXNlcjE1MTQ1NjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/15145615?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Crypt-iQ",
        "html_url": "https://github.com/Crypt-iQ",
        "followers_url": "https://api.github.com/users/Crypt-iQ/followers",
        "following_url": "https://api.github.com/users/Crypt-iQ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Crypt-iQ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Crypt-iQ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Crypt-iQ/subscriptions",
        "organizations_url": "https://api.github.com/users/Crypt-iQ/orgs",
        "repos_url": "https://api.github.com/users/Crypt-iQ/repos",
        "events_url": "https://api.github.com/users/Crypt-iQ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Crypt-iQ/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I modified p2p_opportunistic_1p1c.py to remove the witness on a low-fee parent tx and it failed with TX_RECONSIDERABLE (as those checks are before the 3x CheckInputScripts that returns WITNESS_STRIPPED). I think my comment was a little confusing, also not sure this matters in practice?",
      "created_at": "2025-08-04T15:55:22Z",
      "updated_at": "2025-08-04T15:55:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#discussion_r2251897931",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251897931"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 379,
      "original_line": 379,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251927093",
      "pull_request_review_id": 3084852888,
      "id": 2251927093,
      "node_id": "PRRC_kwDOABII586GOa41",
      "diff_hunk": "@@ -361,83 +366,47 @@ node::RejectedTxTodo TxDownloadManagerImpl::MempoolRejectedTx(const CTransaction\n \n     if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS) {\n         // Only process a new orphan if this is a first time failure, as otherwise it must be either\n-        // already in orphanage or from 1p1c processing.\n+        // already in orphanage or from 1p1c processing. Also, we are unable to process orphans that are too low feerate\n+        // right now, as package validation only permits one generation of CPFP.\n         if (first_time_failure && !RecentRejectsFilter().contains(ptx->GetWitnessHash().ToUint256())) {\n-            bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n             // Deduplicate parent txids, so that we don't have to loop over\n             // the same parent txid more than once down below.\n             unique_parents = GetUniqueParents(tx);\n \n-            // Distinguish between parents in m_lazy_recent_rejects and m_lazy_recent_rejects_reconsiderable.\n-            // We can tolerate having up to 1 parent in m_lazy_recent_rejects_reconsiderable since we\n-            // submit 1p1c packages. However, fail immediately if any are in m_lazy_recent_rejects.\n-            std::optional<Txid> rejected_parent_reconsiderable;\n-            for (const Txid& parent_txid : unique_parents) {\n-                if (RecentRejectsFilter().contains(parent_txid.ToUint256())) {\n-                    fRejectedParents = true;\n-                    break;\n-                } else if (RecentRejectsReconsiderableFilter().contains(parent_txid.ToUint256()) &&",
      "path": "src/node/txdownloadman_impl.cpp",
      "position": 50,
      "original_position": 50,
      "commit_id": "0f919d01db723f0b384800ab10b5719befbf4d68",
      "original_commit_id": "86a03b167ff6e7e49111d4614f199dacafe23380",
      "in_reply_to_id": 2251819585,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ohhhh I see. Yeah, I suppose a witness-stripped can end up there if it's also low feerate. And adding a witness can only make the feerate decrease, so any tx with the same txid would have the same problem ðŸ˜… ",
      "created_at": "2025-08-04T16:02:27Z",
      "updated_at": "2025-08-04T16:02:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33066#discussion_r2251927093",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2251927093"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33066"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 379,
      "original_line": 379,
      "side": "LEFT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180",
    "id": 2430056672,
    "node_id": "PR_kwDOABII586Q17jg",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32180",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32180.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32180.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32180",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32180/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
    "number": 32180,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "p2p: Advance pindexLastCommonBlock early after connecting blocks",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "As described in #32179, `pindexLastCommonBlock` is updated later than necessary \r\nin master. \r\nIn case of a linear chain with no forks, it can be moved forward at the beginning of \r\n`FindNextBlocksToDownload`, so that the updated value can be used to better estimate `nWindowEnd`. \r\nThis helps the node to request all blocks from peers within the correct 1024-block-window and avoids peers being incorrectly marked as stallers.\r\n\r\nThe second commit removes  a special case introduced in 49d569cb1fdd62a9da8dff51dccaf4680fe3d0eb which is not necessary, because the more general logic also covers this case.\r\n\r\nI also changed `p2p_ibd_stalling.py` to cover the situation after a resolved situation, making sure that no additional peers are marked for stalling.\r\n\r\nFixes #32179\r\n\r\n",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-03-31T22:40:42Z",
    "updated_at": "2025-04-29T04:32:23Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "de804e5a91ee7d2a83231fb6263daeafa4d68f58",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "mzumsande:202403_ibd_lastcommonblock",
      "ref": "202403_ibd_lastcommonblock",
      "sha": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 187673073,
        "node_id": "MDEwOlJlcG9zaXRvcnkxODc2NzMwNzM=",
        "name": "bitcoin",
        "full_name": "mzumsande/bitcoin",
        "owner": {
          "login": "mzumsande",
          "id": 48763452,
          "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
          "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/mzumsande",
          "html_url": "https://github.com/mzumsande",
          "followers_url": "https://api.github.com/users/mzumsande/followers",
          "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
          "organizations_url": "https://api.github.com/users/mzumsande/orgs",
          "repos_url": "https://api.github.com/users/mzumsande/repos",
          "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/mzumsande/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/mzumsande/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/mzumsande/bitcoin",
        "archive_url": "https://api.github.com/repos/mzumsande/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/mzumsande/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/mzumsande/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/mzumsande/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/mzumsande/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/mzumsande/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/mzumsande/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/mzumsande/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/mzumsande/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/mzumsande/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/mzumsande/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/mzumsande/bitcoin/events",
        "forks_url": "https://api.github.com/repos/mzumsande/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/mzumsande/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/mzumsande/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/mzumsande/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/mzumsande/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/mzumsande/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/mzumsande/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/mzumsande/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/mzumsande/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/mzumsande/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/mzumsande/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/mzumsande/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/mzumsande/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:mzumsande/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/mzumsande/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/mzumsande/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/mzumsande/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/mzumsande/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/mzumsande/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/mzumsande/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/mzumsande/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/mzumsande/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/mzumsande/bitcoin/hooks",
        "svn_url": "https://github.com/mzumsande/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 260379,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-28T19:56:40Z",
        "created_at": "2019-05-20T16:03:10Z",
        "updated_at": "2025-04-24T18:53:18Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "af6cffa36d12d8b9f504024c080f1559373aba2a",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37120,
        "stargazers_count": 83080,
        "watchers_count": 83080,
        "size": 280492,
        "default_branch": "master",
        "open_issues_count": 712,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-28T21:43:55Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-04-29T03:03:39Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 29,
    "deletions": 30,
    "changed_files": 2,
    "commits": 4,
    "review_comments": 10,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 2767583466,
      "node_id": "IC_kwDOABII586k9fjq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2767583466",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-31T22:40:46Z",
      "updated_at": "2025-04-28T19:57:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32180.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [stringintech](https://github.com/bitcoin/bitcoin/pull/32180#pullrequestreview-2756103728), [i-am-yuvi](https://github.com/bitcoin/bitcoin/pull/32180#issuecomment-2796118736) |\n| Stale ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/32180#pullrequestreview-2793701909) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#issuecomment-2767583466",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32180"
    },
    {
      "event": "convert_to_draft",
      "id": 17064876219,
      "node_id": "CTDE_lADOABII586wiHnhzwAAAAP5JVi7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17064876219",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-31T22:40:47Z"
    },
    {
      "event": "labeled",
      "id": 17064876313,
      "node_id": "LE_lADOABII586wiHnhzwAAAAP5JVkZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17064876313",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-31T22:40:48Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "ready_for_review",
      "id": 17101171779,
      "node_id": "RFRE_lADOABII586wiHnhzwAAAAP7TyxD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17101171779",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-02T21:15:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17161014488,
      "node_id": "HRFPE_lADOABII586wiHnhzwAAAAP-4EzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17161014488",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "205e651713f27885931ce552c9992d32741b5d87",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/205e651713f27885931ce552c9992d32741b5d87",
      "created_at": "2025-04-07T21:56:55Z"
    },
    {
      "event": "reviewed",
      "id": 2756103728,
      "node_id": "PRR_kwDOABII586kRs4w",
      "url": null,
      "actor": null,
      "commit_id": "205e651713f27885931ce552c9992d32741b5d87",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "Concept ACK.",
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#pullrequestreview-2756103728",
      "submitted_at": "2025-04-10T10:02:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
    },
    {
      "event": "commented",
      "id": 2796118736,
      "node_id": "IC_kwDOABII586mqWLQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2796118736",
      "actor": {
        "login": "i-am-yuvi",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/i-am-yuvi",
        "html_url": "https://github.com/i-am-yuvi",
        "followers_url": "https://api.github.com/users/i-am-yuvi/followers",
        "following_url": "https://api.github.com/users/i-am-yuvi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/i-am-yuvi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/i-am-yuvi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/i-am-yuvi/subscriptions",
        "organizations_url": "https://api.github.com/users/i-am-yuvi/orgs",
        "repos_url": "https://api.github.com/users/i-am-yuvi/repos",
        "events_url": "https://api.github.com/users/i-am-yuvi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/i-am-yuvi/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-11T07:47:23Z",
      "updated_at": "2025-04-11T07:47:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nThanks for this PR.\r\n\r\nI have made some [notes](https://github.com/i-am-yuvi/bitcoin-core-issues-prs-notes/blob/master/%2332180.md) regarding this PR and will add some guide for testing as well very soon.",
      "user": {
        "login": "i-am-yuvi",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/i-am-yuvi",
        "html_url": "https://github.com/i-am-yuvi",
        "followers_url": "https://api.github.com/users/i-am-yuvi/followers",
        "following_url": "https://api.github.com/users/i-am-yuvi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/i-am-yuvi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/i-am-yuvi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/i-am-yuvi/subscriptions",
        "organizations_url": "https://api.github.com/users/i-am-yuvi/orgs",
        "repos_url": "https://api.github.com/users/i-am-yuvi/repos",
        "events_url": "https://api.github.com/users/i-am-yuvi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/i-am-yuvi/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#issuecomment-2796118736",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32180"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17229766248,
      "node_id": "HRFPE_lADOABII586wiHnhzwAAAAQC-V5o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17229766248",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "created_at": "2025-04-11T19:46:47Z"
    },
    {
      "event": "reviewed",
      "id": 2793701909,
      "node_id": "PRR_kwDOABII586mhIIV",
      "url": null,
      "actor": null,
      "commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK c69ee2d5b93296d3008d6978182b2bc29bbeb457\r\n\r\nThe code changes look reasonable. I tested that `p2p_ibd_stalling.py` fails without commit 1d8504c5e6 `p2p: During block download, adjust pindexLastCommonBlock right away`. It failed 7 times and passed 1 time. Is it expected to pass sometimes?\r\nI also checked that the code inside the modified `if`s is executed during `p2p_ibd_stalling.py`.\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#pullrequestreview-2793701909",
      "submitted_at": "2025-04-25T12:23:56Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
    },
    {
      "event": "review_requested",
      "id": 17405698133,
      "node_id": "RRE_lADOABII586wiHnhzwAAAAQNdeBV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17405698133",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-25T12:24:00Z",
      "requested_reviewer": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg1NWIxZmMyYjkyMTAxYzNlOWIwNGYwMGNlZmY0ZDA4MmEyOTRhODQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/855b1fc2b92101c3e9b04f00ceff4d082a294a84",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/855b1fc2b92101c3e9b04f00ceff4d082a294a84",
      "tree": {
        "sha": "b8aa4030a778657563389cbca26b382e2f63aaf3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b8aa4030a778657563389cbca26b382e2f63aaf3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0dc74c92c0650a171e1c6f5bea1c15e13584e799",
          "sha": "0dc74c92c0650a171e1c6f5bea1c15e13584e799",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0dc74c92c0650a171e1c6f5bea1c15e13584e799"
        }
      ],
      "message": "p2p: During block download, adjust pindexLastCommonBlock right away\n\nThis allows us to calculate nWndowEnd better.\nBefore, it would be calculated based on an old pindexLastCommonBlock,\nwhich could result in blocks not requested for download that could have been\nrequested, and peers being wrongly marked as staller.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-28T19:55:08Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-03-28T19:46:59Z"
      },
      "sha": "855b1fc2b92101c3e9b04f00ceff4d082a294a84"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ4Y2Q5MTcxYmJjZWM1YWY2YmE2MzQ0MTVmMjk3N2I3NGI5NDY1NzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48cd9171bbcec5af6ba634415f2977b74b946573",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/48cd9171bbcec5af6ba634415f2977b74b946573",
      "tree": {
        "sha": "34d0debbc2ecd67192ecdcf3acbafbb702b712fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/34d0debbc2ecd67192ecdcf3acbafbb702b712fd"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/855b1fc2b92101c3e9b04f00ceff4d082a294a84",
          "sha": "855b1fc2b92101c3e9b04f00ceff4d082a294a84",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/855b1fc2b92101c3e9b04f00ceff4d082a294a84"
        }
      ],
      "message": "p2p: remove extra logic for assumeutxo\n\nThis reverts commit 49d569cb1fdd62a9da8dff51dccaf4680fe3d0eb\nwhich introduced extra logic for when a snapshot was loaded.\nWith the previous commit, this is not longer necessary\nbecause the more general logic of advancing pindexLastCommonBlock\nalso covers this case.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-28T19:55:08Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-03-31T21:42:17Z"
      },
      "sha": "48cd9171bbcec5af6ba634415f2977b74b946573"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVlZDdkYWExMDJhYWMwOGU0MjAzNzViNDgyODllZTM3NmIwYTNjOTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5ed7daa102aac08e420375b48289ee376b0a3c96",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5ed7daa102aac08e420375b48289ee376b0a3c96",
      "tree": {
        "sha": "4bebc38780f4bbfb7cda1fe2b8c8f151988026f4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4bebc38780f4bbfb7cda1fe2b8c8f151988026f4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48cd9171bbcec5af6ba634415f2977b74b946573",
          "sha": "48cd9171bbcec5af6ba634415f2977b74b946573",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/48cd9171bbcec5af6ba634415f2977b74b946573"
        }
      ],
      "message": "test: remove magic number when checking for blocks that have arrived\n\ngetpeerinfo provides a list of blocks that are inflight, which can be used\ninstead.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-28T19:55:08Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-02T15:18:58Z"
      },
      "sha": "5ed7daa102aac08e420375b48289ee376b0a3c96"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI3ZmY2YTYxMWEyMjBlOTM4MGY2Y2Q2NDI4ZjFkMzQ4M2M4ZDU2NmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "tree": {
        "sha": "daac0a7fd11bfba3ea1ff898b6e87857a758b0ed",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/daac0a7fd11bfba3ea1ff898b6e87857a758b0ed"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5ed7daa102aac08e420375b48289ee376b0a3c96",
          "sha": "5ed7daa102aac08e420375b48289ee376b0a3c96",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5ed7daa102aac08e420375b48289ee376b0a3c96"
        }
      ],
      "message": "test: improve coverage for a resolved stalling situation\n\nThis test (which would fail without the previous commit) checks\nthat after the stalling block was received, we don't incorrectly\nmark another peer as a staller immediately.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-28T19:55:08Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-04-02T15:29:05Z"
      },
      "sha": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17441044846,
      "node_id": "HRFPE_lADOABII586wiHnhzwAAAAQPkTlu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17441044846",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "created_at": "2025-04-28T19:56:42Z"
    },
    {
      "event": "commented",
      "id": 2836382102,
      "node_id": "IC_kwDOABII586pD8GW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2836382102",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-28T20:02:43Z",
      "updated_at": "2025-04-28T20:06:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "[c69ee2d](https://github.com/bitcoin/bitcoin/commit/c69ee2d5b93296d3008d6978182b2bc29bbeb457) to [b7ff6a6](https://github.com/bitcoin/bitcoin/commit/b7ff6a611a220e9380f6cd6428f1d3483c8d566f): addressed feedback\r\n\r\n\r\n> Is it expected to pass sometimes?\r\n\r\nIt wasn't - but I have tracked this down now. It's a bit involved, I hope the following explanation makes sense:\r\n\r\nThe initial situation is that there are 2 remaining connected peers, the node has just synced blocks up to height 500, but pindexLastCommonBlock is still at 0. The second stall block at height 501 is already requested from one peer, let's say `peer0`.\r\n\r\nIf SendMessages is invoked for `peer0`, it will request no blocks, update `pindexLastCommonBlock` to 500 and won't mark anyone as a staller, because it's already requested from the same peer.\r\nIf after that, `peer1` would be processed, `peer0` would be marked as a staller.\r\nBut if `peer0` is processed twice in a row (which can happen due to the randomization in `ThreadMessageHandler`), we could request block 1025 from it.\r\nIf `peer1` is processed then (for which pindexLastCommonBlock is still at 0), all `1024+1` blocks in the window will already be requested, so we never get to [this point](https://github.com/bitcoin/bitcoin/blob/af6cffa36d12d8b9f504024c080f1559373aba2a/src/net_processing.cpp#L1500) because we always continue [here](https://github.com/bitcoin/bitcoin/blob/af6cffa36d12d8b9f504024c080f1559373aba2a/src/net_processing.cpp#L1496).\r\nI think this could be fixed by exchanging the order of [this](https://github.com/bitcoin/bitcoin/blob/af6cffa36d12d8b9f504024c080f1559373aba2a/src/net_processing.cpp#L1490-L1497) and [this](https://github.com/bitcoin/bitcoin/blob/af6cffa36d12d8b9f504024c080f1559373aba2a/src/net_processing.cpp#L1499-L1507) code block. I'm not sure if this is something that needs fixing though because the current patch should avoid this problem too...\r\n",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#issuecomment-2836382102",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32180"
    },
    {
      "event": "labeled",
      "id": 17447481095,
      "node_id": "LE_lADOABII586wiHnhzwAAAAQP828H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17447481095",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T04:32:23Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036986575",
      "pull_request_review_id": 2756103728,
      "id": 2036986575,
      "node_id": "PRRC_kwDOABII5855afLP",
      "diff_hunk": "@@ -1367,12 +1367,16 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n     // Bootstrap quickly by guessing a parent of our best tip is the forking point.\n     // Guessing wrong in either direction is not a problem.\n-    // Also reset pindexLastCommonBlock after a snapshot was loaded, so that blocks after the snapshot will be prioritised for download.\n-    if (state->pindexLastCommonBlock == nullptr ||\n-        (snap_base && state->pindexLastCommonBlock->nHeight < snap_base->nHeight)) {\n+    if (state->pindexLastCommonBlock == nullptr) {\n         state->pindexLastCommonBlock = m_chainman.ActiveChain()[std::min(state->pindexBestKnownBlock->nHeight, m_chainman.ActiveChain().Height())];\n     }\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }\n+\n     // If the peer reorganized, our previous pindexLastCommonBlock may not be an ancestor\n     // of its current tip anymore. Go back enough to fix that.\n     state->pindexLastCommonBlock = LastCommonAncestor(state->pindexLastCommonBlock, state->pindexBestKnownBlock);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "205e651713f27885931ce552c9992d32741b5d87",
      "in_reply_to_id": null,
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Could there be an issue if both nodes reorganize to the same chain, but the last common block is still on another fork? \n\nIf our new tip height is less than the outdated `pindexLastCommonBlock` height (like when reorging to a shorter chain with more work), we'd skip the optimization when we shouldn't.\n\nSince `LastCommonAncestor()` brings back the `pindexLastCommonBlock` on the peer's best chain, maybe the new code should come after this call?\n\nNot sure if this edge case matters in practice, but thought I'd mention it.â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹",
      "created_at": "2025-04-10T09:59:55Z",
      "updated_at": "2025-04-11T14:09:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2036986575",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2036986575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": 1374,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1376,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2040219929",
      "pull_request_review_id": 2761443000,
      "id": 2040219929,
      "node_id": "PRRC_kwDOABII5855m0kZ",
      "diff_hunk": "@@ -1367,12 +1367,16 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n \n     // Bootstrap quickly by guessing a parent of our best tip is the forking point.\n     // Guessing wrong in either direction is not a problem.\n-    // Also reset pindexLastCommonBlock after a snapshot was loaded, so that blocks after the snapshot will be prioritised for download.\n-    if (state->pindexLastCommonBlock == nullptr ||\n-        (snap_base && state->pindexLastCommonBlock->nHeight < snap_base->nHeight)) {\n+    if (state->pindexLastCommonBlock == nullptr) {\n         state->pindexLastCommonBlock = m_chainman.ActiveChain()[std::min(state->pindexBestKnownBlock->nHeight, m_chainman.ActiveChain().Height())];\n     }\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }\n+\n     // If the peer reorganized, our previous pindexLastCommonBlock may not be an ancestor\n     // of its current tip anymore. Go back enough to fix that.\n     state->pindexLastCommonBlock = LastCommonAncestor(state->pindexLastCommonBlock, state->pindexBestKnownBlock);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "205e651713f27885931ce552c9992d32741b5d87",
      "in_reply_to_id": 2036986575,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Good observation!\r\nI also think that this edge case shouldn't matter much.\r\nIt's absolutely essential that `pindexLastCommonBlock` is an ancestor of `pindexBestKnownBlock` when calling `FindNextBlocks`, which is why I originally left that check last. But the added check can't change that since it only sets `pindexLastCommonBlock` to the tip if that tip is an ancestor of `pindexBestKnownBlock`.\r\nSo I've changed the order.",
      "created_at": "2025-04-11T19:45:14Z",
      "updated_at": "2025-04-11T19:45:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2040219929",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2040219929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": 1374,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1376,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2059993955",
      "pull_request_review_id": 2793701909,
      "id": 2059993955,
      "node_id": "PRRC_kwDOABII5856yQNj",
      "diff_hunk": "@@ -1379,6 +1377,12 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     if (state->pindexLastCommonBlock == state->pindexBestKnownBlock)\n         return;\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }",
      "path": "src/net_processing.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This change assumes their tip is higher than our tip. What if their tip is lower? Maybe worth advancing `pindexLastCommonBlock` in that case as well. Something like this:\r\n\r\n```cpp\r\n// If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to\r\n// download any blocks in between, and skipping ahead here allows us to determine nWindowEnd better.\r\nconst auto our_tip{m_chainman.ActiveTip()};\r\nconst auto peer_best_known{state->pindexBestKnownBlock};\r\nif (our_tip->nHeight > state->pindexLastCommonBlock->nHeight) {\r\n    if (peer_best_known->nHeight >= our_tip->nHeight) { \r\n        if (peer_best_known->GetAncestor(our_tip->nHeight) == our_tip) {\r\n            state->pindexLastCommonBlock = our_tip;\r\n        }     \r\n    } else {                        \r\n        if (our_tip->GetAncestor(peer_best_known->nHeight) == peer_best_known) {\r\n            state->pindexLastCommonBlock = peer_best_known;\r\n        }\r\n        // FindNextBlocks() would be a noop below, so return here.\r\n        return;\r\n    }     \r\n}\r\n```",
      "created_at": "2025-04-25T10:36:02Z",
      "updated_at": "2025-04-25T12:23:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2059993955",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2059993955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": 1380,
      "original_start_line": 1380,
      "start_side": "RIGHT",
      "line": 1384,
      "original_line": 1384,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060107128",
      "pull_request_review_id": 2793701909,
      "id": 2060107128,
      "node_id": "PRRC_kwDOABII5856yr14",
      "diff_hunk": "@@ -67,6 +67,7 @@ def run_test(self):\n             height += 1\n             block_dict[blocks[-1].sha256] = blocks[-1]\n         stall_block = blocks[0].sha256\n+        second_stall = blocks[500].sha256  # another block we don't provide immediately",
      "path": "test/functional/p2p_ibd_stalling.py",
      "position": null,
      "original_position": 32,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: could use an array here:\r\n\r\n```py\r\nstall_blocks = [blocks[0].sha256, blocks[500].sha256]\r\n```\r\n\r\nwhich would make it possible to have the following code like:\r\n\r\n```diff\r\n- peers.append(node.add_outbound_p2p_connection(P2PStaller([stall_block, second_stall]), p2p_idx=id, connection_type=\"outbound-full-relay\"))\r\n+ peers.append(node.add_outbound_p2p_connection(P2PStaller(stall_blocks), p2p_idx=id, connection_type=\"outbound-full-relay\"))\r\n\r\n- self.wait_until(lambda: sum(len(peer['inflight']) for peer in node.getpeerinfo()) == 2)\r\n+ self.wait_until(lambda: sum(len(peer['inflight']) for peer in node.getpeerinfo()) == len(stall_blocks))\r\n```",
      "created_at": "2025-04-25T11:57:39Z",
      "updated_at": "2025-04-25T12:23:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2060107128",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060107128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": 69,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 70,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060110804",
      "pull_request_review_id": 2793701909,
      "id": 2060110804,
      "node_id": "PRRC_kwDOABII5856ysvU",
      "diff_hunk": "@@ -135,21 +134,16 @@ def run_test(self):\n         self.wait_until(lambda: self.is_block_requested(peers, stall_block))\n         self.all_sync_send_with_ping(peers)\n \n-        self.log.info(\"Provide the withheld block and check that stalling timeout gets reduced back to 2 seconds\")\n-        with node.assert_debug_log(expected_msgs=['Decreased stalling timeout to 2 seconds']):\n+        self.log.info(\"Provide the first withheld block and check that stalling timeout gets reduced back to 2 seconds\")\n+        with node.assert_debug_log(expected_msgs=['Decreased stalling timeout to 2 seconds'], unexpected_msgs=['Stall started']):\n             for p in peers:\n                 if p.is_connected and (stall_block in p.getdata_requests):\n                     p.send_without_ping(msg_block(block_dict[stall_block]))\n+            self.all_sync_send_with_ping(peers)\n \n-        self.log.info(\"Check that all outstanding blocks get connected\")\n-        self.wait_until(lambda: node.getblockcount() == NUM_BLOCKS)\n+        self.log.info(\"Check that all outstanding blocks up to the second stall block get connected\")\n+        self.wait_until(lambda: node.getblockcount() == 500)",
      "path": "test/functional/p2p_ibd_stalling.py",
      "position": null,
      "original_position": 70,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: could use a variable `second_stall_block_index = 500` or something like that to avoid repeating the number `500`.",
      "created_at": "2025-04-25T12:00:10Z",
      "updated_at": "2025-04-25T12:23:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2060110804",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060110804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 145,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060402198",
      "pull_request_review_id": 2794418342,
      "id": 2060402198,
      "node_id": "PRRC_kwDOABII5856zz4W",
      "diff_hunk": "@@ -1379,6 +1377,12 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     if (state->pindexLastCommonBlock == state->pindexBestKnownBlock)\n         return;\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }",
      "path": "src/net_processing.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": 2059993955,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Then we would have returned earlier because there are no blocks from this peer that would help us with our IBD:\r\nhttps://github.com/bitcoin/bitcoin/blob/80e6ad9e3023a57a4ef19b7d0edf9ac5be71a584/src/net_processing.cpp#L1384-L1387 (second condition)",
      "created_at": "2025-04-25T14:54:53Z",
      "updated_at": "2025-04-25T14:54:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2060402198",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2060402198"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": 1380,
      "original_start_line": 1380,
      "start_side": "RIGHT",
      "line": 1384,
      "original_line": 1384,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2063248425",
      "pull_request_review_id": 2798617939,
      "id": 2063248425,
      "node_id": "PRRC_kwDOABII5856-qwp",
      "diff_hunk": "@@ -1379,6 +1377,12 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     if (state->pindexLastCommonBlock == state->pindexBestKnownBlock)\n         return;\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }",
      "path": "src/net_processing.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": 2059993955,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Does it make sense to advance `pindexLastCommonBlock` in that case? I am just curious, it is definitely not the aim of this PR.",
      "created_at": "2025-04-28T09:10:41Z",
      "updated_at": "2025-04-28T09:10:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2063248425",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2063248425"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": 1380,
      "original_start_line": 1380,
      "start_side": "RIGHT",
      "line": 1384,
      "original_line": 1384,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064454694",
      "pull_request_review_id": 2800581225,
      "id": 2064454694,
      "node_id": "PRRC_kwDOABII5857DRQm",
      "diff_hunk": "@@ -67,6 +67,7 @@ def run_test(self):\n             height += 1\n             block_dict[blocks[-1].sha256] = blocks[-1]\n         stall_block = blocks[0].sha256\n+        second_stall = blocks[500].sha256  # another block we don't provide immediately",
      "path": "test/functional/p2p_ibd_stalling.py",
      "position": null,
      "original_position": 32,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": 2060107128,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "done",
      "created_at": "2025-04-28T20:02:52Z",
      "updated_at": "2025-04-28T20:02:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2064454694",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064454694"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": 69,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 70,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064455709",
      "pull_request_review_id": 2800582844,
      "id": 2064455709,
      "node_id": "PRRC_kwDOABII5857DRgd",
      "diff_hunk": "@@ -135,21 +134,16 @@ def run_test(self):\n         self.wait_until(lambda: self.is_block_requested(peers, stall_block))\n         self.all_sync_send_with_ping(peers)\n \n-        self.log.info(\"Provide the withheld block and check that stalling timeout gets reduced back to 2 seconds\")\n-        with node.assert_debug_log(expected_msgs=['Decreased stalling timeout to 2 seconds']):\n+        self.log.info(\"Provide the first withheld block and check that stalling timeout gets reduced back to 2 seconds\")\n+        with node.assert_debug_log(expected_msgs=['Decreased stalling timeout to 2 seconds'], unexpected_msgs=['Stall started']):\n             for p in peers:\n                 if p.is_connected and (stall_block in p.getdata_requests):\n                     p.send_without_ping(msg_block(block_dict[stall_block]))\n+            self.all_sync_send_with_ping(peers)\n \n-        self.log.info(\"Check that all outstanding blocks get connected\")\n-        self.wait_until(lambda: node.getblockcount() == NUM_BLOCKS)\n+        self.log.info(\"Check that all outstanding blocks up to the second stall block get connected\")\n+        self.wait_until(lambda: node.getblockcount() == 500)",
      "path": "test/functional/p2p_ibd_stalling.py",
      "position": null,
      "original_position": 70,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": 2060110804,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "changed to use one var for each index, plus one array.",
      "created_at": "2025-04-28T20:03:27Z",
      "updated_at": "2025-04-28T20:03:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2064455709",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064455709"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 145,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064457862",
      "pull_request_review_id": 2800587144,
      "id": 2064457862,
      "node_id": "PRRC_kwDOABII5857DSCG",
      "diff_hunk": "@@ -1379,6 +1377,12 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     if (state->pindexLastCommonBlock == state->pindexBestKnownBlock)\n         return;\n \n+    // If our tip has advanced beyond pindexLastCommonBlock, move it ahead to the tip. We don't need to download any blocks in between, and skipping ahead here\n+    // allows us to determine nWindowEnd better.\n+    if (m_chainman.ActiveHeight() > state->pindexLastCommonBlock->nHeight && state->pindexBestKnownBlock->GetAncestor(m_chainman.ActiveHeight()) == m_chainman.ActiveTip()) {\n+        state->pindexLastCommonBlock = m_chainman.ActiveTip();\n+    }",
      "path": "src/net_processing.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "b7ff6a611a220e9380f6cd6428f1d3483c8d566f",
      "original_commit_id": "c69ee2d5b93296d3008d6978182b2bc29bbeb457",
      "in_reply_to_id": 2059993955,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'd say probably not because `pindexLastCommonBlock` isn't really used for anything but assigning blocks during IBD.\r\nIf we will never need any blocks from this peer (until it sends us more headers, but then `pindexLastCommonBlock` will get updated. I'll also ignore weird `invalidateblock` scenarios here), I don't see what benefits advancing it anyway would have. \r\n",
      "created_at": "2025-04-28T20:05:00Z",
      "updated_at": "2025-04-28T20:05:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2064457862",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2064457862"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32180"
        }
      },
      "start_line": 1380,
      "original_start_line": 1380,
      "start_side": "RIGHT",
      "line": 1384,
      "original_line": 1384,
      "side": "RIGHT"
    }
  ]
}
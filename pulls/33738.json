{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738",
    "id": 2961054510,
    "node_id": "PR_kwDOABII586wfhsu",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33738",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33738.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33738.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/211149ae3a67f7a87dd113723f622ef26eb7c095",
    "number": 33738,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "log: avoid collecting `GetSerializeSize` data when compact block logging is disabled",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Context\r\n\r\nThe new accounting options introduced in https://github.com/bitcoin/bitcoin/pull/32582 can be quite heavy, and are not needed when debug logging is disabled.\r\n\r\n### Problem\r\n`PartiallyDownloadedBlock::FillBlock()` and `PeerManagerImpl::SendBlockTransactions()` accumulate transaction sizes for debug logging by calling `ComputeTotalSize()` in loops, which invokes expensive `GetSerializeSize()` serializations.\r\nThe block header hash is also only computed for the debug log.\r\n\r\n### Fixes\r\n\r\nGuard the size and hash calculations with `LogAcceptCategory()` checks so the serialization and hashing work only occurs when compact block debug logging is enabled.\r\n\r\nAlso modernized the surrounding code a bit since the change is quite trivial.\r\n\r\n### Reproducer\r\n\r\nYou can test the change by starting an up-to-date `bitcoind` node with `-debug=cmpctblock` and observing compact block log lines such as:\r\n\r\n> [cmpctblock] Successfully reconstructed block 00000000000000000001061eaa6c0fe79258e7f79606e67ac495765cb121a520 with 1 txn prefilled, 3122 txn from mempool (incl at least 3 from extra pool) and 641 txn (352126 bytes) requested\r\n\r\n<details>\r\n<summary>Test patch</summary>\r\n\r\n```patch\r\ndiff --git a/src/blockencodings.cpp b/src/blockencodings.cpp\r\nindex 58620c93cc..f16eb38fa5 100644\r\n--- a/src/blockencodings.cpp\r\n+++ b/src/blockencodings.cpp\r\n@@ -186,6 +186,7 @@ bool PartiallyDownloadedBlock::IsTxAvailable(size_t index) const\r\n\r\n ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<CTransactionRef>& vtx_missing, bool segwit_active)\r\n {\r\n+    LogInfo(\"PartiallyDownloadedBlock::FillBlock called\");\r\n     if (header.IsNull()) return READ_STATUS_INVALID;\r\n\r\n     block = header;\r\n@@ -218,6 +219,7 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\r\n     }\r\n\r\n     if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\r\n+        LogInfo(\"debug log enabled\");\r\n         const uint256 hash{block.GetHash()}; // avoid cleared header\r\n         uint32_t tx_missing_size{0};\r\n         for (const auto& tx : vtx_missing) tx_missing_size += tx->ComputeTotalSize(); // avoid cleared txn_available\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 5600c8d389..c081825f77 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -2470,6 +2470,7 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\r\n\r\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\r\n {\r\n+    LogInfo(\"PeerManagerImpl::SendBlockTransactions called\");\r\n     BlockTransactions resp(req);\r\n     for (size_t i = 0; i < req.indexes.size(); i++) {\r\n         if (req.indexes[i] >= block.vtx.size()) {\r\n@@ -2480,6 +2481,7 @@ void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlo\r\n     }\r\n\r\n     if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\r\n+        LogInfo(\"debug log enabled\");\r\n         uint32_t tx_requested_size{0};\r\n         for (const auto i : req.indexes) tx_requested_size += block.vtx[i]->ComputeTotalSize();\r\n         LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);\r\n```\r\n\r\n</details>\r\n",
    "labels": [
      {
        "id": 241832923,
        "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
        "name": "Utils/log/libs",
        "description": "",
        "color": "5319e7",
        "default": false
      }
    ],
    "created_at": "2025-10-29T22:57:43Z",
    "updated_at": "2025-12-23T09:21:25Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "d87df7135c2c39e6f569a8335263185096643454",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/debug-log-serialization",
      "ref": "l0rinc/debug-log-serialization",
      "sha": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 280901,
        "default_branch": "master",
        "open_issues_count": 25,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-23T09:52:48Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-12-23T09:52:58Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "d861c3820528fad2e17a45549bec70b6ba434dcc",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38387,
        "stargazers_count": 87335,
        "watchers_count": 87335,
        "size": 300965,
        "default_branch": "master",
        "open_issues_count": 725,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-23T01:15:02Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-12-23T07:35:07Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 31,
    "deletions": 25,
    "changed_files": 10,
    "commits": 3,
    "review_comments": 17,
    "comments": 8
  },
  "events": [
    {
      "event": "labeled",
      "id": 20593841362,
      "node_id": "LE_lADOABII587Ur15LzwAAAATLfRTS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20593841362",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-29T22:57:46Z",
      "label": {
        "name": "Utils/log/libs",
        "color": "5319e7"
      }
    },
    {
      "event": "commented",
      "id": 3464743715,
      "node_id": "IC_kwDOABII587Og8sj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3464743715",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-29T22:57:47Z",
      "updated_at": "2025-12-22T10:35:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33738.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [sedited](https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3466336991), [0xB10C](https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3473161056) |\n| Stale ACK | [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3437924068), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3560241264) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32606](https://github.com/bitcoin/bitcoin/pull/32606) (p2p: Drop unsolicited CMPCTBLOCK from non-HB peer by davidgumberg)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3464743715",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "commented",
      "id": 3465768705,
      "node_id": "IC_kwDOABII587Ok28B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3465768705",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T01:24:22Z",
      "updated_at": "2025-10-30T01:24:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for catching this, the PR seems correct to me, why is it in draft?",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3465768705",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "commented",
      "id": 3466336991,
      "node_id": "IC_kwDOABII587OnBrf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3466336991",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T06:43:00Z",
      "updated_at": "2025-10-30T06:43:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3466336991",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "reviewed",
      "id": 3397666497,
      "node_id": "PRR_kwDOABII587KhEbB",
      "url": null,
      "actor": null,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-30T06:43:27Z",
      "author_association": "MEMBER",
      "body": "is there a benchmark that detects this?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3397666497",
      "submitted_at": "2025-10-30T06:43:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
    },
    {
      "event": "ready_for_review",
      "id": 20599583173,
      "node_id": "RFRE_lADOABII587Ur15LzwAAAATL1LHF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20599583173",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T06:49:12Z"
    },
    {
      "event": "commented",
      "id": 3470816225,
      "node_id": "IC_kwDOABII587O4HPh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3470816225",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-31T00:29:06Z",
      "updated_at": "2025-10-31T00:29:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "crACK https://github.com/bitcoin/bitcoin/pull/33738/commits/17856343f80fcfe307121679621ade6d1e0ec32b",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3470816225",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "review_requested",
      "id": 20622384692,
      "node_id": "RRE_lADOABII587Ur15LzwAAAATNMJ40",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20622384692",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-31T00:29:10Z",
      "requested_reviewer": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3473161056,
      "node_id": "IC_kwDOABII587PBDtg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3473161056",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-31T13:45:20Z",
      "updated_at": "2025-10-31T13:45:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3473161056",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20636725964,
      "node_id": "HRFPE_lADOABII587Ur15LzwAAAATOC3LM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20636725964",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "464d35d0963ee9be1f7ef0c1f9b6aa3aa0a1e611",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/464d35d0963ee9be1f7ef0c1f9b6aa3aa0a1e611",
      "created_at": "2025-10-31T15:14:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20637267423,
      "node_id": "HRFPE_lADOABII587Ur15LzwAAAATOE7Xf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20637267423",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "created_at": "2025-10-31T15:36:50Z"
    },
    {
      "event": "referenced",
      "id": 20716368012,
      "node_id": "REFE_lADOABII587Ur15LzwAAAATSyrCM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20716368012",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "065af0f17c0d158e84251b1c9ace8ad0d1de275a",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/065af0f17c0d158e84251b1c9ace8ad0d1de275a",
      "created_at": "2025-11-05T01:28:37Z"
    },
    {
      "event": "reviewed",
      "id": 3437924068,
      "node_id": "PRR_kwDOABII587M6o7k",
      "url": null,
      "actor": null,
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-22T10:35:18Z",
      "author_association": "MEMBER",
      "body": "Code Review ACK 10e0e96e703a40b298b87e9943f85d5189b9e3dc\r\n\r\nCode looks good to me, I ran the tests locally, but I didnt perform any additional testing beyond that.",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3437924068",
      "submitted_at": "2025-11-08T09:12:20Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
    },
    {
      "event": "review_requested",
      "id": 20805653520,
      "node_id": "RRE_lADOABII587Ur15LzwAAAATYHRQQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20805653520",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-08T09:12:24Z",
      "requested_reviewer": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 20805653634,
      "node_id": "RRE_lADOABII587Ur15LzwAAAATYHRSC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20805653634",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-08T09:12:25Z",
      "requested_reviewer": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3488960818,
      "node_id": "PRR_kwDOABII587P9VEy",
      "url": null,
      "actor": null,
      "commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-20T17:20:45Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3488960818",
      "submitted_at": "2025-11-20T17:20:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
    },
    {
      "event": "reviewed",
      "id": 3489498256,
      "node_id": "PRR_kwDOABII587P_YSQ",
      "url": null,
      "actor": null,
      "commit_id": "4e8bba381eb1ab933bb2140a0be955936a754739",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-20T19:12:17Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3489498256",
      "submitted_at": "2025-11-20T19:12:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
    },
    {
      "event": "review_requested",
      "id": 21079314172,
      "node_id": "RRE_lADOABII587Ur15LzwAAAATobM78",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21079314172",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T19:12:22Z",
      "requested_reviewer": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3560241264,
      "node_id": "IC_kwDOABII587UNPhw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3560241264",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-20T22:02:23Z",
      "updated_at": "2025-11-20T22:02:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "crACK 10e0e96e703a40b298b8\r\n\r\nLightly tested running on mainnet, logs for receiving look good:\r\n\r\n```\r\n2025-11-20T21:56:39.778340Z [cmpctblock] Successfully reconstructed block 000000000000000000004152f92a1ec0a2f2e4356264001b11361f35247f641d with 1 txn prefilled, 3940 txn from mempool (incl at least 6 from extra pool) and 141 txn (64021 bytes) requested\r\n```\r\n\r\nHaven't received a `GETBLOCKTXN` request yet.",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3560241264",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "reviewed",
      "id": 3595056869,
      "node_id": "PRR_kwDOABII587WSDbl",
      "url": null,
      "actor": null,
      "commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-18T22:32:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "Reviewed 10e0e96e703a40b298b87e9943f85d5189b9e3dc\r\n\r\nAgree the situation on master is not ideal.\r\n\r\nHowever, when I see `CTransaction` I often think it should be renamed `ImmutableTransaction` (to counter `CMutableTransaction`).\r\n\r\nIn that light, and since it caches hashes, it seems worth at least exploring computing sizes as we are scanning the bytes to eagerly compute either hash. Even if some future endeavor has us lazy-computing the hash (which I would be happy to see), size & hash could still be computed together.\r\n\r\nAfter realizing benchmarks were skewed, I replaced the block data from 2016 AD with a recent block to be more representative:\r\n```\r\n./build/bin/bitcoin-cli getblock 000000000000000000008ba770436ce094dc41adb020ce92eb00632b63af11a4 0 | xxd -r -p > src/bench/data/block413567.raw\r\n```\r\n\r\n(For the issue on more representative block data, see #32554).\r\n\r\n---\r\n\r\n<details><summary>First stab to cache the size during hashing</summary>\r\n\r\n```diff\r\ndiff --git a/src/primitives/transaction.cpp b/src/primitives/transaction.cpp\r\nindex e80ab60fcd..37cd75099d 100644\r\n--- a/src/primitives/transaction.cpp\r\n+++ b/src/primitives/transaction.cpp\r\n@@ -78,22 +78,74 @@ bool CTransaction::ComputeHasWitness() const\r\n     });\r\n }\r\n \r\n-Txid CTransaction::ComputeHash() const\r\n+namespace {\r\n+class CombinedWriter\r\n {\r\n-    return Txid::FromUint256((HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    HashWriter m_hash_writer;\r\n+    SizeComputer m_size_computer;\r\n+\r\n+public:\r\n+    void write(std::span<const std::byte> src)\r\n+    {\r\n+        m_hash_writer.write(src);\r\n+        m_size_computer.write(src);\r\n+    }\r\n+\r\n+    template <typename T>\r\n+    CombinedWriter& operator<<(const T& obj)\r\n+    {\r\n+        ::Serialize(*this, obj);\r\n+        return *this;\r\n+    }\r\n+\r\n+    size_t GetSize() const {\r\n+        return m_size_computer.size();\r\n+    }\r\n+\r\n+    uint256 GetHash() {\r\n+        return m_hash_writer.GetHash();\r\n+    }\r\n+};\r\n+} // namespace\r\n+\r\n+Txid CTransaction::ComputeHash(size_t& out_size) const\r\n+{\r\n+    if (HasWitness()) {\r\n+        return Txid::FromUint256((HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    }\r\n+\r\n+    CombinedWriter combined_writer;\r\n+    combined_writer << TX_NO_WITNESS(*this);\r\n+    out_size = combined_writer.GetSize();\r\n+    auto result{combined_writer.GetHash()};\r\n+\r\n+    // Costly, just for verification\r\n+    //assert(result == (HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    //assert(out_size == ::GetSerializeSize(TX_NO_WITNESS(*this)));\r\n+\r\n+    return Txid::FromUint256(result);\r\n }\r\n \r\n-Wtxid CTransaction::ComputeWitnessHash() const\r\n+Wtxid CTransaction::ComputeWitnessHash(size_t& out_size) const\r\n {\r\n     if (!HasWitness()) {\r\n         return Wtxid::FromUint256(hash.ToUint256());\r\n     }\r\n \r\n-    return Wtxid::FromUint256((HashWriter{} << TX_WITH_WITNESS(*this)).GetHash());\r\n+    CombinedWriter combined_writer;\r\n+    combined_writer << TX_WITH_WITNESS(*this);\r\n+    out_size = combined_writer.GetSize();\r\n+    auto result{combined_writer.GetHash()};\r\n+\r\n+    // Costly, just for verification\r\n+    //assert(result == (HashWriter{} << TX_WITH_WITNESS(*this)).GetHash());\r\n+    //assert(out_size == ::GetSerializeSize(TX_WITH_WITNESS(*this)));\r\n+\r\n+    return Wtxid::FromUint256(result);\r\n }\r\n \r\n-CTransaction::CTransaction(const CMutableTransaction& tx) : vin(tx.vin), vout(tx.vout), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n-CTransaction::CTransaction(CMutableTransaction&& tx) : vin(std::move(tx.vin)), vout(std::move(tx.vout)), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n+CTransaction::CTransaction(const CMutableTransaction& tx) : vin(tx.vin), vout(tx.vout), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash(/*out_size=*/m_size)}, m_witness_hash{ComputeWitnessHash(/*out_size=*/m_size)} {}\r\n+CTransaction::CTransaction(CMutableTransaction&& tx) : vin(std::move(tx.vin)), vout(std::move(tx.vout)), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash(/*out_size=*/m_size)}, m_witness_hash{ComputeWitnessHash(/*out_size=*/m_size)} {}\r\n \r\n CAmount CTransaction::GetValueOut() const\r\n {\r\n@@ -109,7 +161,7 @@ CAmount CTransaction::GetValueOut() const\r\n \r\n unsigned int CTransaction::GetTotalSize() const\r\n {\r\n-    return ::GetSerializeSize(TX_WITH_WITNESS(*this));\r\n+    return m_size;\r\n }\r\n \r\n std::string CTransaction::ToString() const\r\ndiff --git a/src/primitives/transaction.h b/src/primitives/transaction.h\r\nindex 295bce61b9..406f6fb9ff 100644\r\n--- a/src/primitives/transaction.h\r\n+++ b/src/primitives/transaction.h\r\n@@ -313,9 +313,10 @@ private:\r\n     const bool m_has_witness;\r\n     const Txid hash;\r\n     const Wtxid m_witness_hash;\r\n+    size_t m_size;\r\n \r\n-    Txid ComputeHash() const;\r\n-    Wtxid ComputeWitnessHash() const;\r\n+    Txid ComputeHash(size_t& out_size) const;\r\n+    Wtxid ComputeWitnessHash(size_t& out_size) const;\r\n \r\n     bool ComputeHasWitness() const;\r\n \r\n```\r\n\r\n<details><summary>DeserializeBlockTest benchmark shows ~0.4% slowdown compared to master.</summary>\r\n\r\n```\r\ncmake --build build -t bench_bitcoin && build/bin/bench_bitcoin -filter=\"DeserializeBlockTest\" -min-time=10000\r\n```\r\nWithout diff (but still new block data):\r\n\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       13,695,535.27 |               73.02 |    0.1% |  172,027,205.56 |   50,480,492.19 |  3.408 |   7,936,417.71 |    0.1% |     32.95 | `DeserializeBlockTest`\r\n|       13,719,279.25 |               72.89 |    0.1% |  172,026,940.33 |   50,563,252.02 |  3.402 |   7,936,357.15 |    0.1% |     32.84 | `DeserializeBlockTest`\r\n|       13,736,674.56 |               72.80 |    0.2% |  172,027,205.58 |   50,631,723.07 |  3.398 |   7,936,417.76 |    0.1% |     32.98 | `DeserializeBlockTest`\r\n```\r\n\r\nWith new block data diff (size computed with hash):\r\n\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       13,758,327.17 |               72.68 |    0.1% |  172,313,875.87 |   50,716,919.21 |  3.398 |   7,948,257.78 |    0.1% |     32.97 | `DeserializeBlockTest`\r\n|       13,770,950.59 |               72.62 |    0.1% |  172,313,875.88 |   50,762,181.95 |  3.395 |   7,948,257.79 |    0.1% |     32.83 | `DeserializeBlockTest`\r\n|       13,743,023.50 |               72.76 |    0.1% |  172,313,864.58 |   50,656,651.53 |  3.402 |   7,948,295.76 |    0.1% |     32.89 | `DeserializeBlockTest`\r\n```\r\n</details>\r\n\r\n</details>\r\n\r\n---\r\n\r\n<details><summary>Second attempt, using CSHA256::bytes (preferred)</summary>\r\n\r\n```diff\r\ndiff --git a/src/crypto/sha256.h b/src/crypto/sha256.h\r\nindex 3ac771c5d0..b97ace5fcc 100644\r\n--- a/src/crypto/sha256.h\r\n+++ b/src/crypto/sha256.h\r\n@@ -23,6 +23,7 @@ public:\r\n     CSHA256();\r\n     CSHA256& Write(const unsigned char* data, size_t len);\r\n     void Finalize(unsigned char hash[OUTPUT_SIZE]);\r\n+    uint64_t GetInputSize() const { return bytes; }\r\n     CSHA256& Reset();\r\n };\r\n \r\ndiff --git a/src/hash.h b/src/hash.h\r\nindex 34486af64a..a4943fd69a 100644\r\n--- a/src/hash.h\r\n+++ b/src/hash.h\r\n@@ -108,6 +108,8 @@ public:\r\n         ctx.Write(UCharCast(src.data()), src.size());\r\n     }\r\n \r\n+    uint64_t GetInputSize() const { return ctx.GetInputSize(); }\r\n+\r\n     /** Compute the double-SHA256 hash of all data written to this object.\r\n      *\r\n      * Invalidates this object.\r\ndiff --git a/src/primitives/transaction.cpp b/src/primitives/transaction.cpp\r\nindex e80ab60fcd..d9ebcfc1b7 100644\r\n--- a/src/primitives/transaction.cpp\r\n+++ b/src/primitives/transaction.cpp\r\n@@ -78,22 +78,44 @@ bool CTransaction::ComputeHasWitness() const\r\n     });\r\n }\r\n \r\n-Txid CTransaction::ComputeHash() const\r\n+Txid CTransaction::ComputeHash(size_t& out_size) const\r\n {\r\n-    return Txid::FromUint256((HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    if (HasWitness()) {\r\n+        return Txid::FromUint256((HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    }\r\n+\r\n+    HashWriter writer;\r\n+    writer << TX_NO_WITNESS(*this);\r\n+    out_size = writer.GetInputSize();\r\n+    auto result{writer.GetHash()};\r\n+\r\n+    // Costly, just for verification\r\n+    //assert(result == (HashWriter{} << TX_NO_WITNESS(*this)).GetHash());\r\n+    //assert(out_size == ::GetSerializeSize(TX_NO_WITNESS(*this)));\r\n+\r\n+    return Txid::FromUint256(result);\r\n }\r\n \r\n-Wtxid CTransaction::ComputeWitnessHash() const\r\n+Wtxid CTransaction::ComputeWitnessHash(size_t& out_size) const\r\n {\r\n     if (!HasWitness()) {\r\n         return Wtxid::FromUint256(hash.ToUint256());\r\n     }\r\n \r\n-    return Wtxid::FromUint256((HashWriter{} << TX_WITH_WITNESS(*this)).GetHash());\r\n+    HashWriter writer;\r\n+    writer << TX_WITH_WITNESS(*this);\r\n+    out_size = writer.GetInputSize();\r\n+    auto result{writer.GetHash()};\r\n+\r\n+    // Costly, just for verification\r\n+    //assert(result == (HashWriter{} << TX_WITH_WITNESS(*this)).GetHash());\r\n+    //assert(out_size == ::GetSerializeSize(TX_WITH_WITNESS(*this)));\r\n+\r\n+    return Wtxid::FromUint256(result);\r\n }\r\n \r\n-CTransaction::CTransaction(const CMutableTransaction& tx) : vin(tx.vin), vout(tx.vout), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n-CTransaction::CTransaction(CMutableTransaction&& tx) : vin(std::move(tx.vin)), vout(std::move(tx.vout)), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash()}, m_witness_hash{ComputeWitnessHash()} {}\r\n+CTransaction::CTransaction(const CMutableTransaction& tx) : vin(tx.vin), vout(tx.vout), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash(/*out_size=*/m_size)}, m_witness_hash{ComputeWitnessHash(/*out_size=*/m_size)} {}\r\n+CTransaction::CTransaction(CMutableTransaction&& tx) : vin(std::move(tx.vin)), vout(std::move(tx.vout)), version{tx.version}, nLockTime{tx.nLockTime}, m_has_witness{ComputeHasWitness()}, hash{ComputeHash(/*out_size=*/m_size)}, m_witness_hash{ComputeWitnessHash(/*out_size=*/m_size)} {}\r\n \r\n CAmount CTransaction::GetValueOut() const\r\n {\r\n@@ -109,7 +131,7 @@ CAmount CTransaction::GetValueOut() const\r\n \r\n unsigned int CTransaction::GetTotalSize() const\r\n {\r\n-    return ::GetSerializeSize(TX_WITH_WITNESS(*this));\r\n+    return m_size;\r\n }\r\n \r\n std::string CTransaction::ToString() const\r\ndiff --git a/src/primitives/transaction.h b/src/primitives/transaction.h\r\nindex 295bce61b9..406f6fb9ff 100644\r\n--- a/src/primitives/transaction.h\r\n+++ b/src/primitives/transaction.h\r\n@@ -313,9 +313,10 @@ private:\r\n     const bool m_has_witness;\r\n     const Txid hash;\r\n     const Wtxid m_witness_hash;\r\n+    size_t m_size;\r\n \r\n-    Txid ComputeHash() const;\r\n-    Wtxid ComputeWitnessHash() const;\r\n+    Txid ComputeHash(size_t& out_size) const;\r\n+    Wtxid ComputeWitnessHash(size_t& out_size) const;\r\n \r\n     bool ComputeHasWitness() const;\r\n \r\n```\r\n\r\n<details><summary>DeserializeBlockTest benchmark shows no slowdown.</summary>\r\n\r\n```\r\ncmake --build build -t bench_bitcoin && build/bin/bench_bitcoin -filter=\"DeserializeBlockTest\" -min-time=10000\r\n```\r\n\r\nWithout diff (but still new block data):\r\n\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       13,642,735.69 |               73.30 |    0.0% |  172,027,198.95 |   50,303,451.00 |  3.420 |   7,936,417.69 |    0.1% |     10.98 | `DeserializeBlockTest`\r\n|       13,696,742.23 |               73.01 |    0.0% |  172,027,199.00 |   50,509,943.00 |  3.406 |   7,936,417.71 |    0.1% |     10.98 | `DeserializeBlockTest`\r\n|       13,608,190.19 |               73.49 |    0.0% |  172,027,198.90 |   50,181,783.58 |  3.428 |   7,936,417.64 |    0.1% |     11.01 | `DeserializeBlockTest`\r\n```\r\n\r\nWith new block data diff (size read off CSHA256::bytes):\r\n\r\n```\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       13,597,905.17 |               73.54 |    0.2% |  172,124,011.94 |   50,128,232.00 |  3.434 |   7,951,499.67 |    0.1% |     11.01 | `DeserializeBlockTest`\r\n|       13,691,575.07 |               73.04 |    0.1% |  172,123,994.96 |   50,450,106.97 |  3.412 |   7,951,537.71 |    0.1% |     10.95 | `DeserializeBlockTest`\r\n|       13,584,015.82 |               73.62 |    0.0% |  172,124,011.88 |   50,092,367.11 |  3.436 |   7,951,499.62 |    0.1% |     11.00 | `DeserializeBlockTest`\r\n```\r\n\r\n</details>\r\n</details>\r\n\r\n---\r\n\r\nI can see the point of `GetTotalSize()` having so few users though. Not going to N-A-C-K current PR state, but might be a shame to change the name to `ComputeTotalSize` if we later decide to return a cached size value.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#pullrequestreview-3595056869",
      "submitted_at": "2025-12-18T22:32:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21701939606,
      "node_id": "HRFPE_lADOABII587Ur15LzwAAAAUNiVGW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21701939606",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "created_at": "2025-12-22T10:35:18Z"
    },
    {
      "event": "commented",
      "id": 3681600394,
      "node_id": "IC_kwDOABII587bcMOK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3681600394",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-22T11:06:43Z",
      "updated_at": "2025-12-22T11:09:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "> However, when I see CTransaction I often think it should be renamed ImmutableTransaction (to counter CMutableTransaction).\r\n\r\nI didn't understand at first how that's related, but slept on it and now I do :)\r\nI don't mind experimenting with that in a separate PR (thanks for the detailed reproducers and benchmarks), had a similar-looking draft in https://github.com/l0rinc/bitcoin/pull/21 (caching the hashes lazily - caching the size would fit here better). \r\n\r\nIf we want to cache size (or compute it alongside hashing), that should be evaluated based on broader call sites and overall construction cost, and done in a separate PR with focused benchmarks and review. I will investigate that in a separate PR.\r\n\r\n> Might be a shame to change the name to ComputeTotalSize if we later decide to return a cached size value.\r\n\r\nI would consider that a feature: we should rename it back when we're not computing it anymore as it's confusing currently. \r\nThis PR is intentionally narrow: it avoids debug-only serialization/hashing work when cmpctblock debug logging, I would like to avoid doing unrelated refactors here. Alternatively I can revert that commit, but it was explicitly requested.\r\n\r\n-----\r\n\r\nRebased in separate empty push and and pushed 2 suggestions in https://github.com/bitcoin/bitcoin/compare/4f1b29d32dea5fbcefe92df6dd0540807cfac1b2..2d3b557f1d414c509b992caa8b96f8ef3bb2aa46",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3681600394",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21702464293,
      "node_id": "HRFPE_lADOABII587Ur15LzwAAAAUNkVMl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21702464293",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2d3b557f1d414c509b992caa8b96f8ef3bb2aa46",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/2d3b557f1d414c509b992caa8b96f8ef3bb2aa46",
      "created_at": "2025-12-22T11:06:51Z"
    },
    {
      "event": "labeled",
      "id": 21702473502,
      "node_id": "LE_lADOABII587Ur15LzwAAAAUNkXce",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21702473502",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-22T11:07:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21703769042,
      "node_id": "UNLE_lADOABII587Ur15LzwAAAAUNpTvS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21703769042",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-22T12:25:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU5NjdiNmU5NGZkYmJmMmFlZjBmNDJlMmNkZmVhOTg2ODAzYWIwMzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e967b6e94fdbbf2aef0f42e2cdfea986803ab032",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e967b6e94fdbbf2aef0f42e2cdfea986803ab032",
      "tree": {
        "sha": "3319748e4ea8ba1c5b81b4b3a9af29fbb9ed50a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3319748e4ea8ba1c5b81b4b3a9af29fbb9ed50a4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3319748e4ea8ba1c5b81b4b3a9af29fbb9ed50a4\nparent 5bbc7c8cc1f221bd584b1b30a89f7138494e7571\nauthor Lrinc <pap.lorinc@gmail.com> 1761918664 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1766439564 +0200\n\nrefactor: rename `CTransaction::GetTotalSize` to signal that it's not cached\n\nTransaction hashes are cached, it may not be intuitive that their sizes are actually recalculated every time.\nThis is done before the other refactors to clarify why we want to avoid calling this method;\n\nCo-authored-by: maflcko <6399679+maflcko@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlJuowACgkQZp//D/pH\nenb40BAArAY7bqj1Viz9a11uUlOvohTUbIopEh16kd+AMF7f6xnb1+QojClD6kZt\ntMXpgiYcWakSYYjbs3lqF5hBH8CU+5joeZBl61Kme7gARBCT4s1OBqtsgwzhnLXX\nJChkIHnDkrU3yVGWUJtA3+r0zdj2Z5r2sdtCiOOAG5OQFtpKOBIGUQEArfhaAvwd\nxKxe4W0jf/S1kmM0K02iZIsa+hK4RrtG1Tzy3Xe7Mq+YbTvf7sVYjn56/qR4Jp9d\nrozkJc7/M8X2x4dILDYKC8K27AtKhsgIe2JkPY5sievUlx6Qrb4kzAh8aZmB3kNT\n3t5G5NoUi86ey01Z85S8AqTVZE7vPp5EphLNathEVzje5aF9Qb2aWgTBmOFkDMSN\nKYtnCcHoMvQY9KZ4gXOWGpeaQ75HvVzSDD5yRMfZ5IYas8NRz7XW8345+7oaK/NI\nJbcWvxjgnUHEXklDae8ByBPjSar25U5XFkL0OV4uMh/V5gJ6bhuTu0aCdT+0hjpC\nyY89nBkNxntjuR1q8y5eG0T5QtwWDptzVkQjxJlxLMvvdaC6Y6pgsAp7ZV/KZ11V\nTkLvsnV1h86dJ1YKQy0n+mgT4TUW9dXRHt777ucyCvtWk/jmJaxqpfeov2NrJNrO\n8wBx2Jik9Iq0IRxffhGRfB9MjZQtg/jb38cd5zZyct5djhLXIVs=\n=4IyG\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5bbc7c8cc1f221bd584b1b30a89f7138494e7571",
          "sha": "5bbc7c8cc1f221bd584b1b30a89f7138494e7571",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5bbc7c8cc1f221bd584b1b30a89f7138494e7571"
        }
      ],
      "message": "refactor: rename `CTransaction::GetTotalSize` to signal that it's not cached\n\nTransaction hashes are cached, it may not be intuitive that their sizes are actually recalculated every time.\nThis is done before the other refactors to clarify why we want to avoid calling this method;\n\nCo-authored-by: maflcko <6399679+maflcko@users.noreply.github.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-22T21:39:24Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-31T13:51:04Z"
      },
      "sha": "e967b6e94fdbbf2aef0f42e2cdfea986803ab032"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE5ZTIzNjczOWQwNTlkZTM1ZmUwNDZjNzZjYTFhNDIyZWRhNmYyY2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a9e236739d059de35fe046c76ca1a422eda6f2cb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a9e236739d059de35fe046c76ca1a422eda6f2cb",
      "tree": {
        "sha": "ae0369d1ee916ad9afacbbcb290d810d07102cac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ae0369d1ee916ad9afacbbcb290d810d07102cac"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ae0369d1ee916ad9afacbbcb290d810d07102cac\nparent e967b6e94fdbbf2aef0f42e2cdfea986803ab032\nauthor Lrinc <pap.lorinc@gmail.com> 1761921698 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1766439606 +0200\n\nlog,net: avoid `ComputeTotalSize` when logging is disabled\n\n`PeerManagerImpl::SendBlockTransactions()` computed the total byte size of requested transactions for a debug log line by calling `ComputeTotalSize()` in a tight loop, triggering serialization even when debug logging is off.\n\nGuard the size accumulation with `LogAcceptCategory` so the serialization work only happens when the log line can be emitted.\n\nNo behavior change when debug logging is enabled: the reported block hash, transaction count, and byte totals are the same.\nThe bounds checks still run unconditionally; the debug-only loop iterates the already-validated response contents.\n\nSeparating debug-only work from the critical path reduces risk and favors the performance-critical non-debug case.\nThis also narrows the racy scope of when logging is toggled from another thread.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlJurYACgkQZp//D/pH\nenaRJA//a4lcxObP06k783l7TQlUG0uxB34wIaCfVepC8U0ySsj5nioZwkNpP5bo\nQDBCkSaS06WQY/MsysrVxsVF6VdXMOgRunJw89unNdLMl41LMO/IUlkkuGbMOVQN\niKLa9+VnxrJDWRm9AvdZQpFvwG9qyOQVM1e1v3L9dG7ZIoqszmss1dToMPAQ0XtU\nu+YR802IKxuraUDLtNtSBztdS4oRcvwZeUxKGH7R9osrvNwkar3YdWkzy1p1HPBR\nXKDO+OZtoNcNBAMZLJJnhzoz8WyQkNQDeu4JnJlt/GCAAGHMtT3Lf6/6xJtN9PCj\nWpWfPpPo78xtMU0MwYUFq/rlW9zoSlGmRB1XjwGk1JP/DCnQJ9piCybjnCCZssvn\n5JpeIUDqDxKWrGSJkk0dnA808sYbTJtv2C5CzNXBBowygTh5KypwE5ZbhKCEt3Wn\nm0wwh46KzsCjvA1dctbPg/R7+rbuRq6gT9v3LieVMHVakRCjRISivUBQK5qrTzBR\nq2AhbGXLiOWvLBN9Vf2AbKKhi0QmmNlMQdZdcbzUt15x1o+ZaB9MY+W5YRzwD+Jb\nf07eDT8uFOM4/Jx1jNI1zstw0Sb91cRcMKg5VTD6eR9vZ8HPiz5xmyfT94Bi9QtS\nSVkhwsFSfoPcMrgHsZgG5ckJMOBQdsW3dCWCoJnQgwDI4vApuSA=\n=zBPJ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e967b6e94fdbbf2aef0f42e2cdfea986803ab032",
          "sha": "e967b6e94fdbbf2aef0f42e2cdfea986803ab032",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e967b6e94fdbbf2aef0f42e2cdfea986803ab032"
        }
      ],
      "message": "log,net: avoid `ComputeTotalSize` when logging is disabled\n\n`PeerManagerImpl::SendBlockTransactions()` computed the total byte size of requested transactions for a debug log line by calling `ComputeTotalSize()` in a tight loop, triggering serialization even when debug logging is off.\n\nGuard the size accumulation with `LogAcceptCategory` so the serialization work only happens when the log line can be emitted.\n\nNo behavior change when debug logging is enabled: the reported block hash, transaction count, and byte totals are the same.\nThe bounds checks still run unconditionally; the debug-only loop iterates the already-validated response contents.\n\nSeparating debug-only work from the critical path reduces risk and favors the performance-critical non-debug case.\nThis also narrows the racy scope of when logging is toggled from another thread.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-22T21:40:06Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-31T14:41:38Z"
      },
      "sha": "a9e236739d059de35fe046c76ca1a422eda6f2cb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDIxMTE0OWFlM2E2N2Y3YTg3ZGQxMTM3MjNmNjIyZWYyNmViN2MwOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/211149ae3a67f7a87dd113723f622ef26eb7c095",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/211149ae3a67f7a87dd113723f622ef26eb7c095",
      "tree": {
        "sha": "007a43c178c19db8f9375bec5eb7d1719add9fda",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/007a43c178c19db8f9375bec5eb7d1719add9fda"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 007a43c178c19db8f9375bec5eb7d1719add9fda\nparent a9e236739d059de35fe046c76ca1a422eda6f2cb\nauthor Lrinc <pap.lorinc@gmail.com> 1761921695 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1766439606 +0200\n\nlog,blocks: avoid `ComputeTotalSize` and `GetHash` work when logging is disabled\n\n`PartiallyDownloadedBlock::FillBlock()` computed the block header hash and summed missing transaction sizes for debug logging unconditionally, including when cmpctblock debug logging is disabled.\n\nGuard the debug-only hash and size computations with `LogAcceptCategory`.\nSince `txn_available` is invalidated after the first loop (needed for efficient moving), we compute `tx_missing_size` by iterating `vtx_missing` directly. This is safe because the later `tx_missing_offset` check guarantees `vtx_missing` was fully consumed during reconstruction.\n\nUse `block.GetHash()` instead of `header.GetHash()`, since header is cleared before logging.\n\nNo behavior change when debug logging is enabled: the reported counts, hashes, and byte totals remain the same.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlJurYACgkQZp//D/pH\nenZXoQ//TjfgCx4GjGB/qRul4iKV/psUT69QtispOPnOzOB81penBUSXVtfFcZ6I\nixrtzZH8jZydZPGuhdWWcn9hyVyMmJ+Bv4YxPBOhMWlCKsgq90nu+gLszq58MfKM\nYFRO59d18qAwCP/k+0orC0YtGM4kfrIdpCqzbhr+nizw3Urcyx669S6Xk8VQhKqQ\n4CjjaVb4lQf3mBDPVATF6D0E/2kK52YOYFDXjZ0blhHBG+ouskvfKzEAJ3fsMUC7\nJZbSNIDfh3mz5Se6gDinQ83cwNf8qfKTAjVgp/VLtkGXv95cKE8aTPw65YU7lCdV\nF1l4OVncaj5b9IAC75VhS2/tvsgzm/+UapAFsfFfIlJFrWI9E9HyHUYDwlRmmUVL\nohJ9JhBzzpt+5E2A3a85zDFK9/LcY3tKKsG9Fyjp01Zem9xCbh2ucnVBJ+7j1Ly4\nDsW6ro5PztDf4f6bsD1QQD7YgiwSkvip4Kmnyf3FnD7wzU6iQSemZNeyh6d+4CAI\nKdBl9juspbapSoNA2+X0hODz9TyV5226xb0c9r2maE8MrbcZgI12yyJlGd3+UUtd\nD6n5iQTDpNlu4n7srlpGpKfvrs/LWQ2sd9ZgpcKqHPlLlYrQgmFde4m0yjvKEO7m\nZrazDqpnAyxYhwfLWNxqlRMrC2MfTwjuqqw7/dZaWz9bbSgUZoE=\n=drGC\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a9e236739d059de35fe046c76ca1a422eda6f2cb",
          "sha": "a9e236739d059de35fe046c76ca1a422eda6f2cb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a9e236739d059de35fe046c76ca1a422eda6f2cb"
        }
      ],
      "message": "log,blocks: avoid `ComputeTotalSize` and `GetHash` work when logging is disabled\n\n`PartiallyDownloadedBlock::FillBlock()` computed the block header hash and summed missing transaction sizes for debug logging unconditionally, including when cmpctblock debug logging is disabled.\n\nGuard the debug-only hash and size computations with `LogAcceptCategory`.\nSince `txn_available` is invalidated after the first loop (needed for efficient moving), we compute `tx_missing_size` by iterating `vtx_missing` directly. This is safe because the later `tx_missing_offset` check guarantees `vtx_missing` was fully consumed during reconstruction.\n\nUse `block.GetHash()` instead of `header.GetHash()`, since header is cleared before logging.\n\nNo behavior change when debug logging is enabled: the reported counts, hashes, and byte totals remain the same.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-22T21:40:06Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-31T14:41:35Z"
      },
      "sha": "211149ae3a67f7a87dd113723f622ef26eb7c095"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21713573369,
      "node_id": "HRFPE_lADOABII587Ur15LzwAAAAUOOtX5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21713573369",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/211149ae3a67f7a87dd113723f622ef26eb7c095",
      "created_at": "2025-12-22T21:41:37Z"
    },
    {
      "event": "labeled",
      "id": 21715460319,
      "node_id": "LE_lADOABII587Ur15LzwAAAAUOV6Df",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21715460319",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-23T00:32:10Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3685631473,
      "node_id": "IC_kwDOABII587brkXx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3685631473",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-23T08:03:03Z",
      "updated_at": "2025-12-23T08:03:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "close/open dance to retrigger CI - likely caused by [GitHub outage](https://www.githubstatus.com/history) ",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#issuecomment-3685631473",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33738"
    },
    {
      "event": "closed",
      "id": 21720377381,
      "node_id": "CE_lADOABII587Ur15LzwAAAAUOoqgl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21720377381",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-23T08:03:03Z"
    },
    {
      "event": "reopened",
      "id": 21720378151,
      "node_id": "REE_lADOABII587Ur15LzwAAAAUOoqsn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21720378151",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-23T08:03:06Z"
    },
    {
      "event": "unlabeled",
      "id": 21721639611,
      "node_id": "UNLE_lADOABII587Ur15LzwAAAAUOteq7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21721639611",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-23T09:21:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2476602340",
      "pull_request_review_id": 3397666497,
      "id": 2476602340,
      "node_id": "PRRC_kwDOABII586TnfPk",
      "diff_hunk": "@@ -2471,14 +2471,16 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n+    [[maybe_unused]] uint32_t tx_requested_size{0};\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->GetTotalSize();\n+        if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+            tx_requested_size += resp.txn[i]->GetTotalSize();\n+        }\n     }\n \n     LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "original_commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in theory this seems racy, when the logging is toggled in another thread, but this is probably good enough to ignore.\r\n\r\nThough, on a different note, I wonder if there are other places that could benefit from CTransaction caching. Two full hashes are cached, so caching the size should be cheap in both time and space?",
      "created_at": "2025-10-30T06:43:12Z",
      "updated_at": "2025-10-30T06:43:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2476602340",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2476602340"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": 2481,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2476611373",
      "pull_request_review_id": 3397678193,
      "id": 2476611373,
      "node_id": "PRRC_kwDOABII586Tnhct",
      "diff_hunk": "@@ -2471,14 +2471,16 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n+    [[maybe_unused]] uint32_t tx_requested_size{0};\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->GetTotalSize();\n+        if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+            tx_requested_size += resp.txn[i]->GetTotalSize();\n+        }\n     }\n \n     LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "original_commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "in_reply_to_id": 2476602340,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "the hash is actually eagerly calculated as well - which should also be hidden behind a similar condition, was hoping someone will bring it up :)\r\n\r\n----\r\nthere aren't any benchmarks for this but a ton of tests failed for the throw check above, so at least it has coverage.",
      "created_at": "2025-10-30T06:48:56Z",
      "updated_at": "2025-10-30T06:50:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2476611373",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2476611373"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": 2481,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479859800",
      "pull_request_review_id": 3402159330,
      "id": 2479859800,
      "node_id": "PRRC_kwDOABII586Tz6hY",
      "diff_hunk": "@@ -2471,14 +2471,16 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n+    [[maybe_unused]] uint32_t tx_requested_size{0};\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->GetTotalSize();\n+        if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+            tx_requested_size += resp.txn[i]->GetTotalSize();\n+        }\n     }\n \n     LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "original_commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "in_reply_to_id": 2476602340,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": ">  wonder if there are other places that could benefit from CTransaction caching. Two full hashes are cached, so caching the size should be cheap in both time and space?\r\n\r\nI don't think we should be caching the sizes, since there aren't really any performance critical users of `GetTotalSize()`, it's invoked by these cmpctblock logs, many RPC's when they do pretty-printing of transactions, and the qt interface's transaction view, but there are critical paths where  `CTransaction()`'s are constructed.\r\n\r\n------\r\n\r\n> the hash is actually eagerly calculated as well\r\n\r\nAs far as I can tell, `CTransaction`'s hashes are computed and cached on construction:\r\nhttps://github.com/bitcoin/bitcoin/blob/6f359695c36c13af832b0b1021dcb3a234f6f219/src/primitives/transaction.cpp#L95-L96\r\nhttps://github.com/bitcoin/bitcoin/blob/6f359695c36c13af832b0b1021dcb3a234f6f219/src/primitives/transaction.h#L343-L344\r\n\r\nAre you suggesting that the hashes should be computed lazily when `CTransaction::GetHash()` is first invoked?\r\n",
      "created_at": "2025-10-31T00:28:53Z",
      "updated_at": "2025-10-31T00:28:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2479859800",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479859800"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": 2481,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2480316536",
      "pull_request_review_id": 3402787061,
      "id": 2480316536,
      "node_id": "PRRC_kwDOABII586T1qB4",
      "diff_hunk": "@@ -2471,14 +2471,16 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n+    [[maybe_unused]] uint32_t tx_requested_size{0};\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->GetTotalSize();\n+        if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+            tx_requested_size += resp.txn[i]->GetTotalSize();\n+        }\n     }\n \n     LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "original_commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "in_reply_to_id": 2476602340,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I don't think we should be caching the sizes,\r\n\r\nGood point. I haven't looked at the other places where it is used. I guess one could consider renaming `GetTotalSize` to `ComputeTotalSize`, to hopefully avoid similar issues of this kind in the future?",
      "created_at": "2025-10-31T06:49:57Z",
      "updated_at": "2025-10-31T06:49:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2480316536",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2480316536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": 2481,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2481763116",
      "pull_request_review_id": 3404762129,
      "id": 2481763116,
      "node_id": "PRRC_kwDOABII586T7LMs",
      "diff_hunk": "@@ -2471,14 +2471,16 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n+    [[maybe_unused]] uint32_t tx_requested_size{0};\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->GetTotalSize();\n+        if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+            tx_requested_size += resp.txn[i]->GetTotalSize();\n+        }\n     }\n \n     LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "original_commit_id": "17856343f80fcfe307121679621ade6d1e0ec32b",
      "in_reply_to_id": 2476602340,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> As far as I can tell, CTransaction's hashes are computed and cached on construction\r\n\r\nNo, I mean `uint256 hash = header.GetHash()` is only needed for the debug log - let me try separating all calculations that are only needed for debugging. Given that we're clearing `header` and `txn_available` I understand why the split wasn't done before. But we can still use `block` for the hash and `vtx_missing` for the missing, so I think it should be possible to split the two.\r\nThat's a more invasive change but it would separate the performance critical calculations from the debugging data.\r\nhttps://github.com/bitcoin/bitcoin/blob/a0c254c13a3ef21e257cca3493446c632b636b15/src/primitives/block.cpp#L11-L14\r\n\r\n> Are you suggesting that the hashes should be computed lazily when `CTransaction::GetHash()` is first invoked?\r\n\r\nI did investigate that in https://github.com/l0rinc/bitcoin/pull/21, but haven't finished the investigation since the initial numbers weren't convincing enough.\r\n\r\n>  I guess one could consider renaming GetTotalSize to ComputeTotalSize\r\n\r\nThanks, pushed that in a separate commit (before the rest to showcase why we're avoiding the call in the first place). It's small enough that I didn't bother with a scripted diff.",
      "created_at": "2025-10-31T15:14:45Z",
      "updated_at": "2025-10-31T15:14:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2481763116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2481763116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": 2481,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2546914489",
      "pull_request_review_id": 3488960818,
      "id": 2546914489,
      "node_id": "PRRC_kwDOABII586XztS5",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else\n+        } else {\n             block.vtx[i] = std::move(txn_available[i]);\n+        }\n     }\n \n     // Make sure we can't call FillBlock again.\n     header.SetNull();\n     txn_available.clear();\n \n-    if (vtx_missing.size() != tx_missing_offset)\n+    if (vtx_missing.size() != tx_missing_offset) {\n         return READ_STATUS_INVALID;\n+    }\n \n     // Check for possible mutations early now that we have a seemingly good block\n     IsBlockMutatedFn check_mutated{m_check_block_mutated_mock ? m_check_block_mutated_mock : IsBlockMutated};\n-    if (check_mutated(/*block=*/block,\n-                       /*check_witness_root=*/segwit_active)) {\n+    if (check_mutated(/*block=*/block, /*check_witness_root=*/segwit_active)) {\n         return READ_STATUS_FAILED; // Possible Short ID collision\n     }\n \n-    LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n-    if (vtx_missing.size() < 5) {\n-        for (const auto& tx : vtx_missing) {\n-            LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+    if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+        const uint256 hash{block.GetHash()}; // avoid cleared header\n+        uint32_t tx_missing_size{0};\n+        for (const auto& tx : vtx_missing) tx_missing_size += tx->ComputeTotalSize(); // avoid cleared txn_available\n+        LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n+        if (vtx_missing.size() < 5) {\n+            for (const auto& tx : vtx_missing) {\n+                LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+            }\n         }",
      "path": "src/blockencodings.cpp",
      "position": 54,
      "original_position": 54,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Would it be useful to print the first 5, even if there are more? E.g.\n```\nReconstructed block B required tx 111\nReconstructed block B required tx 222\nReconstructed block B required tx 333\nReconstructed block B required tx 444\nReconstructed block B required tx 555 and others\n```",
      "created_at": "2025-11-20T17:09:44Z",
      "updated_at": "2025-11-20T17:20:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2546914489",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2546914489"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 229,
      "original_start_line": 225,
      "start_side": "RIGHT",
      "line": 233,
      "original_line": 233,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2546951579",
      "pull_request_review_id": 3488960818,
      "id": 2546951579,
      "node_id": "PRRC_kwDOABII586Xz2Wb",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else",
      "path": "src/blockencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I am missing some high level context here, but is this guaranteed to iterate over all members of `vtx_missing[]`?\n\nI ask because down there we do iterate the full `vtx_missing[]` to derive `tx_missing_size`.",
      "created_at": "2025-11-20T17:18:46Z",
      "updated_at": "2025-11-20T17:20:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2546951579",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2546951579"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 199,
      "original_start_line": 195,
      "start_side": "RIGHT",
      "line": 207,
      "original_line": 207,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547146360",
      "pull_request_review_id": 3489256527,
      "id": 2547146360,
      "node_id": "PRRC_kwDOABII586X0l54",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else\n+        } else {\n             block.vtx[i] = std::move(txn_available[i]);\n+        }\n     }\n \n     // Make sure we can't call FillBlock again.\n     header.SetNull();\n     txn_available.clear();\n \n-    if (vtx_missing.size() != tx_missing_offset)\n+    if (vtx_missing.size() != tx_missing_offset) {\n         return READ_STATUS_INVALID;\n+    }\n \n     // Check for possible mutations early now that we have a seemingly good block\n     IsBlockMutatedFn check_mutated{m_check_block_mutated_mock ? m_check_block_mutated_mock : IsBlockMutated};\n-    if (check_mutated(/*block=*/block,\n-                       /*check_witness_root=*/segwit_active)) {\n+    if (check_mutated(/*block=*/block, /*check_witness_root=*/segwit_active)) {\n         return READ_STATUS_FAILED; // Possible Short ID collision\n     }\n \n-    LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n-    if (vtx_missing.size() < 5) {\n-        for (const auto& tx : vtx_missing) {\n-            LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+    if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+        const uint256 hash{block.GetHash()}; // avoid cleared header\n+        uint32_t tx_missing_size{0};\n+        for (const auto& tx : vtx_missing) tx_missing_size += tx->ComputeTotalSize(); // avoid cleared txn_available\n+        LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n+        if (vtx_missing.size() < 5) {\n+            for (const auto& tx : vtx_missing) {\n+                LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+            }\n         }",
      "path": "src/blockencodings.cpp",
      "position": 54,
      "original_position": 54,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546914489,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good idea. Should we do it in a follow-up instead?",
      "created_at": "2025-11-20T18:19:34Z",
      "updated_at": "2025-11-20T18:19:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2547146360",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547146360"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 229,
      "original_start_line": 225,
      "start_side": "RIGHT",
      "line": 233,
      "original_line": 233,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547148360",
      "pull_request_review_id": 3489259119,
      "id": 2547148360,
      "node_id": "PRRC_kwDOABII586X0mZI",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else",
      "path": "src/blockencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546951579,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I have tried explaining it in the commit message, can you please point out where more context is necessarry?",
      "created_at": "2025-11-20T18:20:20Z",
      "updated_at": "2025-11-20T18:20:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2547148360",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547148360"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 199,
      "original_start_line": 195,
      "start_side": "RIGHT",
      "line": 207,
      "original_line": 207,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547165872",
      "pull_request_review_id": 3489280589,
      "id": 2547165872,
      "node_id": "PRRC_kwDOABII586X0qqw",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else\n+        } else {\n             block.vtx[i] = std::move(txn_available[i]);\n+        }\n     }\n \n     // Make sure we can't call FillBlock again.\n     header.SetNull();\n     txn_available.clear();\n \n-    if (vtx_missing.size() != tx_missing_offset)\n+    if (vtx_missing.size() != tx_missing_offset) {\n         return READ_STATUS_INVALID;\n+    }\n \n     // Check for possible mutations early now that we have a seemingly good block\n     IsBlockMutatedFn check_mutated{m_check_block_mutated_mock ? m_check_block_mutated_mock : IsBlockMutated};\n-    if (check_mutated(/*block=*/block,\n-                       /*check_witness_root=*/segwit_active)) {\n+    if (check_mutated(/*block=*/block, /*check_witness_root=*/segwit_active)) {\n         return READ_STATUS_FAILED; // Possible Short ID collision\n     }\n \n-    LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n-    if (vtx_missing.size() < 5) {\n-        for (const auto& tx : vtx_missing) {\n-            LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+    if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+        const uint256 hash{block.GetHash()}; // avoid cleared header\n+        uint32_t tx_missing_size{0};\n+        for (const auto& tx : vtx_missing) tx_missing_size += tx->ComputeTotalSize(); // avoid cleared txn_available\n+        LogDebug(BCLog::CMPCTBLOCK, \"Successfully reconstructed block %s with %u txn prefilled, %u txn from mempool (incl at least %u from extra pool) and %u txn (%u bytes) requested\\n\", hash.ToString(), prefilled_count, mempool_count, extra_count, vtx_missing.size(), tx_missing_size);\n+        if (vtx_missing.size() < 5) {\n+            for (const auto& tx : vtx_missing) {\n+                LogDebug(BCLog::CMPCTBLOCK, \"Reconstructed block %s required tx %s\\n\", hash.ToString(), tx->GetHash().ToString());\n+            }\n         }",
      "path": "src/blockencodings.cpp",
      "position": 54,
      "original_position": 54,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546914489,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I don't think it's very helpful to print 5, when I want to know the tx'es causing compact block reconstruction to fail I remove this `if` statement so that all missing tx'es are printed, and I have a hard time imagining a use case for only wanting the txid's if it's less than 5 or only wanting the first 5.\r\n\r\nI think we should print all of the missing transactions every time, but can definitely be discussed in a separate issue/pr.\r\n",
      "created_at": "2025-11-20T18:25:35Z",
      "updated_at": "2025-11-20T19:00:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2547165872",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547165872"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 229,
      "original_start_line": 225,
      "start_side": "RIGHT",
      "line": 233,
      "original_line": 233,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547272545",
      "pull_request_review_id": 3489410054,
      "id": 2547272545,
      "node_id": "PRRC_kwDOABII586X1Eth",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else",
      "path": "src/blockencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546951579,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Is this guaranteed to iterate over all members of vtx_missing[]?\r\n\r\nYes, because of the check below that:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/6b2d17b13220ea69c33b8cab41fe059ff758874c/src/blockencodings.cpp#L211-L212\r\n\r\nWe increment `tx_missing_offset` every time we take a transaction from `vtx_missing`, so the check enforces that we followed the `if` branch  / took from `vtx_missing` just as many times as there are members in `vtx_missing`.  ",
      "created_at": "2025-11-20T18:52:33Z",
      "updated_at": "2025-11-20T18:52:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2547272545",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547272545"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 199,
      "original_start_line": 195,
      "start_side": "RIGHT",
      "line": 207,
      "original_line": 207,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547342770",
      "pull_request_review_id": 3489498256,
      "id": 2547342770,
      "node_id": "PRRC_kwDOABII586X1V2y",
      "diff_hunk": "@@ -2471,17 +2471,19 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->ComputeTotalSize();\n     }\n \n-    LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);\n+    if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+        uint32_t tx_requested_size{0};\n+        for (const auto i : req.indexes) tx_requested_size += block.vtx[i]->ComputeTotalSize();",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 17,
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "original_commit_id": "4e8bba381eb1ab933bb2140a0be955936a754739",
      "in_reply_to_id": null,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit:\r\n\r\n```suggestion\r\n        for (const auto &tx : resp.txn) tx_requested_size += tx->ComputeTotalSize();\r\n```",
      "created_at": "2025-11-20T19:12:17Z",
      "updated_at": "2025-11-20T19:12:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2547342770",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2547342770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2484,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2632634101",
      "pull_request_review_id": 3595056869,
      "id": 2632634101,
      "node_id": "PRRC_kwDOABII586c6s71",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {",
      "path": "src/blockencodings.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "meganit: Feel free to ignore.\r\nSince we're touching this line... it would be more natural to have what changes on the left hand side -\r\nWe're not testing that the vector shrinks too small, but rather that we don't increment the index out of bounds.\r\n```suggestion\r\n            if (tx_missing_offset >= vtx_missing.size()) {\r\n```\r\n\r\nSame but less itchy below:\r\n\r\n```diff\r\n-if (vtx_missing.size() != tx_missing_offset) {\r\n+if (tx_missing_offset != vtx_missing.size()) {\r\n```",
      "created_at": "2025-12-18T21:07:35Z",
      "updated_at": "2025-12-18T22:32:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2632634101",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2632634101"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2632709196",
      "pull_request_review_id": 3595056869,
      "id": 2632709196,
      "node_id": "PRRC_kwDOABII586c6_RM",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else",
      "path": "src/blockencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546951579,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: I found this last explanation helpful. Would change commit message:\r\n```diff\r\n- Since multiple arguments are invalidated after the first iteration (needed for\r\n- efficient moving), we can't redo the exact same loop, but we can iterate the\r\n- `missing` arg directly and use the block header (which we've copied at the\r\n- beginning) for the header hash instead.\r\n+ txn_available is invalidated after the first loop (needed for efficient moving),\r\n+ so instead we loop through vtx_missing directly which is guaranteed to be\r\n+ consumed by the first loop (see later check against tx_missing_offset).\r\n+ We also switch from computing the hash from the header to the block.\r\n```",
      "created_at": "2025-12-18T21:31:31Z",
      "updated_at": "2025-12-18T22:32:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2632709196",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2632709196"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 199,
      "original_start_line": 195,
      "start_side": "RIGHT",
      "line": 207,
      "original_line": 207,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515068",
      "pull_request_review_id": 3603640311,
      "id": 2639515068,
      "node_id": "PRRC_kwDOABII586dU828",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {",
      "path": "src/blockencodings.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2632634101,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "[Done](https://github.com/bitcoin/bitcoin/compare/4f1b29d32dea5fbcefe92df6dd0540807cfac1b2..2d3b557f1d414c509b992caa8b96f8ef3bb2aa46#diff-da06ec8f1a17251dfc8a10b7155fe3d833e26e1d0c66d66999a209369f405ab1R201)",
      "created_at": "2025-12-22T11:07:02Z",
      "updated_at": "2025-12-22T11:08:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2639515068",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515505",
      "pull_request_review_id": 3603640825,
      "id": 2639515505,
      "node_id": "PRRC_kwDOABII586dU89x",
      "diff_hunk": "@@ -2471,17 +2471,19 @@ uint32_t PeerManagerImpl::GetFetchFlags(const Peer& peer) const\n void PeerManagerImpl::SendBlockTransactions(CNode& pfrom, Peer& peer, const CBlock& block, const BlockTransactionsRequest& req)\n {\n     BlockTransactions resp(req);\n-    unsigned int tx_requested_size = 0;\n     for (size_t i = 0; i < req.indexes.size(); i++) {\n         if (req.indexes[i] >= block.vtx.size()) {\n             Misbehaving(peer, \"getblocktxn with out-of-bounds tx indices\");\n             return;\n         }\n         resp.txn[i] = block.vtx[req.indexes[i]];\n-        tx_requested_size += resp.txn[i]->ComputeTotalSize();\n     }\n \n-    LogDebug(BCLog::CMPCTBLOCK, \"Peer %d sent us a GETBLOCKTXN for block %s, sending a BLOCKTXN with %u txns. (%u bytes)\\n\", pfrom.GetId(), block.GetHash().ToString(), resp.txn.size(), tx_requested_size);\n+    if (LogAcceptCategory(BCLog::CMPCTBLOCK, BCLog::Level::Debug)) {\n+        uint32_t tx_requested_size{0};\n+        for (const auto i : req.indexes) tx_requested_size += block.vtx[i]->ComputeTotalSize();",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 17,
      "commit_id": "4f1b29d32dea5fbcefe92df6dd0540807cfac1b2",
      "original_commit_id": "4e8bba381eb1ab933bb2140a0be955936a754739",
      "in_reply_to_id": 2547342770,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "[Done](https://github.com/bitcoin/bitcoin/compare/4f1b29d32dea5fbcefe92df6dd0540807cfac1b2..2d3b557f1d414c509b992caa8b96f8ef3bb2aa46#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R2484)",
      "created_at": "2025-12-22T11:07:13Z",
      "updated_at": "2025-12-22T11:09:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2639515505",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515505"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2484,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515774",
      "pull_request_review_id": 3603641162,
      "id": 2639515774,
      "node_id": "PRRC_kwDOABII586dU9B-",
      "diff_hunk": "@@ -188,40 +188,44 @@ ReadStatus PartiallyDownloadedBlock::FillBlock(CBlock& block, const std::vector<\n {\n     if (header.IsNull()) return READ_STATUS_INVALID;\n \n-    uint256 hash = header.GetHash();\n     block = header;\n     block.vtx.resize(txn_available.size());\n \n-    unsigned int tx_missing_size = 0;\n     size_t tx_missing_offset = 0;\n     for (size_t i = 0; i < txn_available.size(); i++) {\n         if (!txn_available[i]) {\n-            if (vtx_missing.size() <= tx_missing_offset)\n+            if (vtx_missing.size() <= tx_missing_offset) {\n                 return READ_STATUS_INVALID;\n+            }\n             block.vtx[i] = vtx_missing[tx_missing_offset++];\n-            tx_missing_size += block.vtx[i]->GetTotalSize();\n-        } else",
      "path": "src/blockencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "211149ae3a67f7a87dd113723f622ef26eb7c095",
      "original_commit_id": "10e0e96e703a40b298b87e9943f85d5189b9e3dc",
      "in_reply_to_id": 2546951579,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added [something similar](https://github.com/bitcoin/bitcoin/pull/33738/commits/2d3b557f1d414c509b992caa8b96f8ef3bb2aa46)",
      "created_at": "2025-12-22T11:07:21Z",
      "updated_at": "2025-12-22T11:07:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33738#discussion_r2639515774",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2639515774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33738"
        }
      },
      "start_line": 199,
      "original_start_line": 195,
      "start_side": "RIGHT",
      "line": 207,
      "original_line": 207,
      "side": "LEFT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860",
    "id": 2334713712,
    "node_id": "PR_kwDOABII586LKOdw",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31860",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31860.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31860.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/fc12a89cb337a4a835973201503c01c2c749e8bb",
    "number": 31860,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "init: Take lock on blocks directory in BlockManager ctor",
    "user": {
      "login": "TheCharlatan",
      "id": 8421793,
      "node_id": "MDQ6VXNlcjg0MjE3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheCharlatan",
      "html_url": "https://github.com/TheCharlatan",
      "followers_url": "https://api.github.com/users/TheCharlatan/followers",
      "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
      "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
      "repos_url": "https://api.github.com/users/TheCharlatan/repos",
      "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This ensures consistent directory locking for users of the kernel library by disallowing mistakenly creating multiple BlockManagers that might write into the same block or undo files.\r\n\r\nThe change here makes `LockDirectory` more strict: It now returns an error even if it is called again on the same directory from the same process. However from the description in https://github.com/bitcoin/bitcoin/pull/12422 , where this feature was introduced, it is not immediately clear what its usage was at the time. Supporting multiple wallets in the same directory is mentioned there, but it is not said why that might be a desirable feature.",
    "labels": [],
    "created_at": "2025-02-13T20:49:22Z",
    "updated_at": "2025-05-04T12:07:48Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "13a26fb3590e4ab8f2f57004cc76d49239d2231d",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "TheCharlatan:blockmanLock",
      "ref": "blockmanLock",
      "sha": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 94456368,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NDQ1NjM2OA==",
        "name": "bitcoin",
        "full_name": "TheCharlatan/bitcoin",
        "owner": {
          "login": "TheCharlatan",
          "id": 8421793,
          "node_id": "MDQ6VXNlcjg0MjE3OTM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/TheCharlatan",
          "html_url": "https://github.com/TheCharlatan",
          "followers_url": "https://api.github.com/users/TheCharlatan/followers",
          "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
          "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
          "repos_url": "https://api.github.com/users/TheCharlatan/repos",
          "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/TheCharlatan/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/TheCharlatan/bitcoin",
        "archive_url": "https://api.github.com/repos/TheCharlatan/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/TheCharlatan/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/TheCharlatan/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/TheCharlatan/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/TheCharlatan/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/events",
        "forks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/TheCharlatan/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/TheCharlatan/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/TheCharlatan/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/TheCharlatan/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/TheCharlatan/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/TheCharlatan/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/TheCharlatan/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/TheCharlatan/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/TheCharlatan/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:TheCharlatan/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/TheCharlatan/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/TheCharlatan/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/TheCharlatan/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/hooks",
        "svn_url": "https://github.com/TheCharlatan/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 5,
        "watchers_count": 5,
        "size": 261482,
        "default_branch": "master",
        "open_issues_count": 4,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-04T10:27:05Z",
        "created_at": "2017-06-15T16:03:35Z",
        "updated_at": "2025-04-21T16:14:20Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37170,
        "stargazers_count": 83356,
        "watchers_count": 83356,
        "size": 280735,
        "default_branch": "master",
        "open_issues_count": 723,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-02T21:10:46Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-05-04T12:08:24Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 102,
    "deletions": 19,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 5,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2657680687,
      "node_id": "IC_kwDOABII586eaP0v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2657680687",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-13T20:49:26Z",
      "updated_at": "2025-05-04T10:27:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31860.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/31860#pullrequestreview-2617967456) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32403](https://github.com/bitcoin/bitcoin/pull/32403) (test: remove Boost SIGCHLD workaround. by fanquake)\n* [#32043](https://github.com/bitcoin/bitcoin/pull/32043) ([IBD] Tracking PR for speeding up Initial Block Download by l0rinc)\n* [#31144](https://github.com/bitcoin/bitcoin/pull/31144) ([IBD] multi-byte block obfuscation by l0rinc)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n* [#19463](https://github.com/bitcoin/bitcoin/pull/19463) (Prune locks by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2657680687",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "reviewed",
      "id": 2617967456,
      "node_id": "PRR_kwDOABII586cCwNg",
      "url": null,
      "actor": null,
      "commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK on:\r\n- making LockDirectory more strict, it confused me recently that I was able to acquire a lock multiple times (within the same process)\r\n- making BlockManager manage the lock instead of init\r\n\r\nAs per https://github.com/TheCharlatan/bitcoin/pull/25, I would be a fan of going further and making the `BlockManagerOptions` ctor take a `BlockDirLock` (or, as per my comment a `DirectoryLock`) to allow more granular error feedback, but this is already a step in the right direction regardless.\r\n\r\nIn the future, this approach would also make it more straightforward to e.g. let `BlockManager` give other threads read-only access to the blocksdir via something like:\r\n\r\n```\r\nclass DirectoryLock {\r\nprivate:\r\n    std::shared_mutex m_mutex;\r\npublic:\r\n    const fs::path m_path;\r\n\r\n    DirectoryLock(const fs::path& path)\r\n        : m_path(path)\r\n    {\r\n        assert(util::LockDirectory(m_path, \".lock\", false) == util::LockResult::Success);\r\n    }\r\n    ~DirectoryLock() { UnlockDirectory(m_path, \".lock\"); }\r\n\r\n    DirectoryLock(const DirectoryLock&) = delete;\r\n    DirectoryLock& operator=(const DirectoryLock&) = delete;\r\n\r\n    std::unique_lock<std::shared_mutex> lock_exclusive()\r\n    {\r\n        return std::unique_lock<std::shared_mutex>(m_mutex);\r\n    }\r\n    std::shared_lock<std::shared_mutex> lock_shared()\r\n    {\r\n        return std::shared_lock<std::shared_mutex>(m_mutex);\r\n    }\r\n};\r\n```",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#pullrequestreview-2617967456",
      "submitted_at": "2025-02-14T18:03:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16317600934,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPMmtSm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317600934",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b1f16d3ce13b6ddd6535608b7b4b99b68f56fcbb",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/b1f16d3ce13b6ddd6535608b7b4b99b68f56fcbb",
      "created_at": "2025-02-14T21:26:51Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16317650486,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPMm5Y2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317650486",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "created_at": "2025-02-14T21:31:53Z"
    },
    {
      "event": "commented",
      "id": 2660309397,
      "node_id": "IC_kwDOABII586ekRmV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660309397",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T21:31:58Z",
      "updated_at": "2025-02-14T21:31:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37256718772</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2660309397",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "labeled",
      "id": 16317651101,
      "node_id": "LE_lADOABII586p_zNxzwAAAAPMm5id",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317651101",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T21:31:58Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 16318979435,
      "node_id": "UNLE_lADOABII586p_zNxzwAAAAPMr91r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16318979435",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T00:21:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16325307213,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPNEGtN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16325307213",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "aab070a753d9d840ce60c5e6977a0471bdf56579",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/aab070a753d9d840ce60c5e6977a0471bdf56579",
      "created_at": "2025-02-16T21:44:23Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16325309756,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPNEHU8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16325309756",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "51436f85a2bfcb7874a0c3b12add2df19ff18a3b",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/51436f85a2bfcb7874a0c3b12add2df19ff18a3b",
      "created_at": "2025-02-16T21:45:39Z"
    },
    {
      "event": "commented",
      "id": 2662391575,
      "node_id": "IC_kwDOABII586esN8X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2662391575",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-17T08:32:50Z",
      "updated_at": "2025-02-17T08:32:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I would be a fan of going further and making the BlockManagerOptions ctor take a BlockDirLock (or, as per my comment a DirectoryLock) to allow more granular error feedback, but this is already a step in the right direction regardless.\r\n\r\nI attempted implementing this, but giving the options the lock starts to introduce non-trivial additional semantics to the options: Since the lock needs to be moved from the options to the block manager, the options cannot be re-used. I'm not sure how to implement that and make it clear to the user what is going on.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2662391575",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "commented",
      "id": 2690448271,
      "node_id": "IC_kwDOABII586gXPuP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2690448271",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-28T11:49:56Z",
      "updated_at": "2025-02-28T11:49:56Z",
      "author_association": "MEMBER",
      "body": "> Supporting multiple wallets in the same directory is mentioned there, but it is not said why that might be a desirable feature.\r\n\r\nI haven't tested this, but it may have been required in the past, because BDB wallets may just be files, not folders, so they could all sit in the same walletdir (which could even be the datadir)? If true, this requirement may go away with dropping bdb?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2690448271",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "labeled",
      "id": 17505515820,
      "node_id": "LE_lADOABII586p_zNxzwAAAAQTaPks",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17505515820",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-02T22:43:07Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNlZjZkNzBiMDZkODU1ZGFhZWZiNDRhYjU2NDM3YzRjZDViODBlNGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cef6d70b06d855daaefb44ab56437c4cd5b80e4e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cef6d70b06d855daaefb44ab56437c4cd5b80e4e",
      "tree": {
        "sha": "0cdf6e687ce8866bd97e9dbda9cbc69257fd3d92",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0cdf6e687ce8866bd97e9dbda9cbc69257fd3d92"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0cdf6e687ce8866bd97e9dbda9cbc69257fd3d92\nparent eba5f9c4b63fe46261fbb3e71b9a94832d105b23\nauthor TheCharlatan <seb.kung@gmail.com> 1739475875 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354297 +0200\n\nutil: Prevent multiple LockDirectory calls within the same process\n\nPreviously LockDirectory only prevented concurrent locks across\ndifferent processes, but allowed the same process to re-lock on the same\ndirectory.\n\nThis change is not immediately relevant for its current use, where the\nlock is only supposed to protect against a different process writing on\nthe same resources.\n\nThis change is relevant for future use by the kernel library, where\nusers of the library might mistakenly create multiple instances of an\nobject that seek to write to a common resource.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXQHkACgkQm3m0VpHb\nQXPhzA/+JCcXDXOFuyLvWNuraF6trvBPVBo4W2B73CTnxtXTWaQmvW3uHwOh9GmV\n+gNmfDj7Luwiyaxh+vVxSKOE+PFofvMCGn8iMzyiyadzafIKaIz1PQIymJhU4Grd\nIwNKuIfc8twt07kVIV/KjqnabcwuOmAjpJ27VXsB9vgrTThtdd4kpCbp452Slc1x\nvYv8wK+kANB6iSAIl5KQcNcxSivH+ofGlvM209W04zNwkDUCItZySVV1ZNbIDW1z\noC6D2ZAcFaCEswhjOIh/ZerojbB1yXVzCSvD6BYOBKddWdb32tIRkllN89V6YrkB\nDw7+VtHW35IJj8S8lLzIzw9A4C4nrpOy9pz65nUutcue9H6vMfp2dApDQoo0ZA3W\nhq44zHCrA7Ja+JSRVuZsycKMfXOyceBAc21ePnUGexR15KgW6yfe9afMEbEPQV0G\nqfDiirQvkjdkqJO4RZCs+nTZDZPuW59DbqNSjtV9FHV9eVD/A+gAN964w3ttW5/+\ni2FqeQs0TfQRL101QJkndvsbGiyRB7dw/krq49K5z8Xuavws8Znt1AsIba00hVjh\nJ8pe8O6kNUr5SuUSHm3iR55IIEVcsv6WP+Ax8I8goY4w1InYs4eJd3QwyiULXuWI\n/fJMaDV1xcDRtnTsUOUbE2xir7qvV+BJOk/646cuLlnP/R2zs+o=\n=8LIu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
          "sha": "eba5f9c4b63fe46261fbb3e71b9a94832d105b23",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eba5f9c4b63fe46261fbb3e71b9a94832d105b23"
        }
      ],
      "message": "util: Prevent multiple LockDirectory calls within the same process\n\nPreviously LockDirectory only prevented concurrent locks across\ndifferent processes, but allowed the same process to re-lock on the same\ndirectory.\n\nThis change is not immediately relevant for its current use, where the\nlock is only supposed to protect against a different process writing on\nthe same resources.\n\nThis change is relevant for future use by the kernel library, where\nusers of the library might mistakenly create multiple instances of an\nobject that seek to write to a common resource.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:24:57Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-13T19:44:35Z"
      },
      "sha": "cef6d70b06d855daaefb44ab56437c4cd5b80e4e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUyMDM5N2YzYjNmZDM5ZjU1ZGNlMDZlYTI5MjkwMzU1Y2ViZTY2NjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e20397f3b3fd39f55dce06ea29290355cebe6662",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e20397f3b3fd39f55dce06ea29290355cebe6662",
      "tree": {
        "sha": "190b45f29c7463f63e7abad062a1ffbec7e84027",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/190b45f29c7463f63e7abad062a1ffbec7e84027"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 190b45f29c7463f63e7abad062a1ffbec7e84027\nparent cef6d70b06d855daaefb44ab56437c4cd5b80e4e\nauthor TheCharlatan <seb.kung@gmail.com> 1739568005 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354400 +0200\n\nutil: Add RAII directory lock\n\nThis makes it easier for a class or a struct to own a lock on a\ndirectory for the duration of its lifetime. It is used in the next\ncommit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXQOEACgkQm3m0VpHb\nQXM3/xAAoHskzCtJlvbPuFbA8OdTd3s5mQWa465B7glboQH3RUKgh26dm9bJx/Qm\nLtio6Zo2ScpHBaqPEZ2KMdp5brE2+K6Loh4bgw/c2WoQTUFThr4TL+pwanZkK+TE\nBF08fGe/PYf5Kbpoq1XHfAm4PDNpTu802R4oghWy5Spqjetv6rFn94aO3mUms+yx\n1lEi3Uh7wS7iXjQtqtY4W0+Jk6sl7Yo2hKcjzliGE396j7DXUBrAGHVXl3bCghTi\nh1DaDCfiLeVyqZorjwvQ/k4hsMhi7NJULngs7IBE7zBK+UOi0/kP1uJfsQYU63+s\nfyLt1GQZ/d1qD+J32Emv5jnsoiQSQ9+vuooZvK/d4aLtNDvWlzMq20RqxsSz9A2u\n3uZzAFrseyrVPxJjQsv0cSvfj0LRY6V9WV1WfgjTq0Rd4t1rTbK7+SoQNMFaldK/\nLsojkZPdstDvAW3LNGt9HjvShLl4HQUnUeC8kWlFdoJVkoPILIEDvaebxBrLcKH/\ntzBXMVf09DrBi0TUSaP5M+sZN8U9JG3moQrYIoThi4Oon3J/k1LYFegDFnTBAg5G\nuvhJT+A5wfr3bnsWIrsepb7vGP7cvYHs6vHYz+/p/BueAv9enwVdmULKRp1VfO3t\nUYtTZk1I/8G+QYxo8I4SQEf7MtV9G4vs/ueMO0NBR0B1TYSoxtg=\n=oxu/\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cef6d70b06d855daaefb44ab56437c4cd5b80e4e",
          "sha": "cef6d70b06d855daaefb44ab56437c4cd5b80e4e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cef6d70b06d855daaefb44ab56437c4cd5b80e4e"
        }
      ],
      "message": "util: Add RAII directory lock\n\nThis makes it easier for a class or a struct to own a lock on a\ndirectory for the duration of its lifetime. It is used in the next\ncommit.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:26:40Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:20:05Z"
      },
      "sha": "e20397f3b3fd39f55dce06ea29290355cebe6662"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZjMTJhODljYjMzN2E0YTgzNTk3MzIwMTUwM2MwMWMyYzc0OWU4YmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fc12a89cb337a4a835973201503c01c2c749e8bb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fc12a89cb337a4a835973201503c01c2c749e8bb",
      "tree": {
        "sha": "6b63f08585c3d17738ee8be925b6fea90e23ee18",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b63f08585c3d17738ee8be925b6fea90e23ee18"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6b63f08585c3d17738ee8be925b6fea90e23ee18\nparent e20397f3b3fd39f55dce06ea29290355cebe6662\nauthor TheCharlatan <seb.kung@gmail.com> 1739568054 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354403 +0200\n\ninit: Take lock on blocks directory in BlockManager ctor\n\nThis moves the responsibility of taking the lock for the blocks\ndirectory into the BlockManager. Use the DirectoryLock wrapper to ensure\nit is the first resource to be acquired and is released again after use.\n\nThis is relevant for the kernel library where the lock should be taken\neven if the user fails to explicitly do so.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXQOMACgkQm3m0VpHb\nQXM7Ng/8C0BhUypP9f+MATsBTg4ls+qp9+HAJwqrF0DpsZv/6YM3ZSSbYSV4gmgd\nByjFdiShZLbTBVKqD/7ZABsPqlytH+iGXzmMIkliFzZCAU/+f/+TDbMDc7xFNALo\nyKKQCzp0JkNqPi1XryfvcB4xz0xCMHEGbJo8ePKJmJ/JvpeezUpFTarBR3ndgO3J\ntmhw14KRKF9U1esrzZvxlujIbeamZHGzHOOq+5wlKXJ5q8YkL0GjjqS4cyteqN0R\n+8T289VUuXvqzY2Mpk8moFD3HpXq/mkNnMntsTsYktgbIfBEAt1uJiMH9uLgBFo4\nWF3BHyOfldtwWdEazE8vxG7M6v2kdI6w6VsJSXSRIhyQ3PeDCl4OHYFisd7Eqb1s\nSiOGcPYrebdC4yMYEL4nPe5vCL/BkuxQSGy0haNx4DtPyVVBaTcdG7YStTiOIk3W\nTS9ro8uV7Ss0iCD+conwxGen/NGVWdJR/wommODN4BuRhKyBRQW54xIsFJ6JZZ3H\nB3SQbTNsaYZwVMOi7M0l/gbNOhuz2JyiXRXxvPhe6F2irVm4EM7OIwVX54C4TThO\nnbm3E/jgSh0mObNrZ3ZACe/kr3C1Y4uTrNMZ1VyQHXGKOyo3YgnN8Cwj1V2AX8CX\njdeG/f08S5nNGD9RhM1kBaHlvQ6Drw4VEBL1dB6h9eHk18IJCRE=\n=zXVG\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e20397f3b3fd39f55dce06ea29290355cebe6662",
          "sha": "e20397f3b3fd39f55dce06ea29290355cebe6662",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e20397f3b3fd39f55dce06ea29290355cebe6662"
        }
      ],
      "message": "init: Take lock on blocks directory in BlockManager ctor\n\nThis moves the responsibility of taking the lock for the blocks\ndirectory into the BlockManager. Use the DirectoryLock wrapper to ensure\nit is the first resource to be acquired and is released again after use.\n\nThis is relevant for the kernel library where the lock should be taken\neven if the user fails to explicitly do so.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:26:43Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:20:54Z"
      },
      "sha": "fc12a89cb337a4a835973201503c01c2c749e8bb"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17510063923,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAQTrl8z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17510063923",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/fc12a89cb337a4a835973201503c01c2c749e8bb",
      "created_at": "2025-05-04T10:27:06Z"
    },
    {
      "event": "unlabeled",
      "id": 17510300281,
      "node_id": "UNLE_lADOABII586p_zNxzwAAAAQTsfp5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17510300281",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-04T12:07:46Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956244596",
      "pull_request_review_id": 2617967456,
      "id": 1956244596,
      "node_id": "PRRC_kwDOABII5850mex0",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 4,
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It seems like this class could easily be reused for chainstate, datadir, wallet, ... directories in future commits. Perhaps a `class DirectoryLock` would make sense?",
      "created_at": "2025-02-14T14:33:21Z",
      "updated_at": "2025-02-14T18:04:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956244596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956244596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 130,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956371573",
      "pull_request_review_id": 2617967456,
      "id": 1956371573,
      "node_id": "PRRC_kwDOABII5850m9x1",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Copy ctor and assignment operator should probably be deleted?",
      "created_at": "2025-02-14T15:55:16Z",
      "updated_at": "2025-02-14T18:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956371573",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956371573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956484013",
      "pull_request_review_id": 2617967456,
      "id": 1956484013,
      "node_id": "PRRC_kwDOABII5850nZOt",
      "diff_hunk": "@@ -1109,8 +1109,9 @@ static bool LockDirectory(const fs::path& dir, bool probeOnly)\n }\n static bool LockDirectories(bool probeOnly)\n {\n-    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) && \\\n-           LockDirectory(gArgs.GetBlocksDirPath(), probeOnly);\n+    // Only allow probing the blocks directory, the BlockManager takes the lock internally.\n+    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) &&\n+           (probeOnly ? LockDirectory(gArgs.GetBlocksDirPath(), probeOnly) : true);",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "At this point, I don't see the benefit of this function anymore. Let's just inline it?\r\n\r\n<details>\r\n<summary>git diff on 436df349f0</summary>\r\n\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex 579669712e..3a984488af 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1107,12 +1107,6 @@ static bool LockDirectory(const fs::path& dir, bool probeOnly)\r\n     } // no default case, so the compiler can warn about missing cases\r\n     assert(false);\r\n }\r\n-static bool LockDirectories(bool probeOnly)\r\n-{\r\n-    // Only allow probing the blocks directory, the BlockManager takes the lock internally.\r\n-    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) &&\r\n-           (probeOnly ? LockDirectory(gArgs.GetBlocksDirPath(), probeOnly) : true);\r\n-}\r\n \r\n bool AppInitSanityChecks(const kernel::Context& kernel)\r\n {\r\n@@ -1130,7 +1124,8 @@ bool AppInitSanityChecks(const kernel::Context& kernel)\r\n     // Probe the directory locks to give an early error message, if possible\r\n     // We cannot hold the directory locks here, as the forking for daemon() hasn't yet happened,\r\n     // and a fork will cause weird behavior to them.\r\n-    return LockDirectories(true);\r\n+    return LockDirectory(gArgs.GetDataDirNet(), /*probeOnly=*/true)\r\n+        && LockDirectory(gArgs.GetBlocksDirPath(), /*probeOnly=*/true);\r\n }\r\n \r\n bool AppInitLockDirectories()\r\n@@ -1138,11 +1133,8 @@ bool AppInitLockDirectories()\r\n     // After daemonization get the directory locks again and hold on to them until exit\r\n     // This creates a slight window for a race condition to happen, however this condition is harmless: it\r\n     // will at most make us exit without printing a message to console.\r\n-    if (!LockDirectories(false)) {\r\n-        // Detailed error printed inside LockDirectory\r\n-        return false;\r\n-    }\r\n-    return true;\r\n+    // Detailed error printed inside LockDirectory\r\n+    return LockDirectory(gArgs.GetDataDirNet(), /*probeOnly=*/false);\r\n }\r\n \r\n bool AppInitInterfaces(NodeContext& node)\r\n\r\n```\r\n</details>\r\n",
      "created_at": "2025-02-14T17:16:07Z",
      "updated_at": "2025-02-14T18:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956484013",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956484013"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": 1112,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956541082",
      "pull_request_review_id": 2618491099,
      "id": 1956541082,
      "node_id": "PRRC_kwDOABII5850nnKa",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": 1956371573,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "And have `BlockManager::m_lock` be a `std::unique_ptr<BlockDirLock>` instead?",
      "created_at": "2025-02-14T18:06:40Z",
      "updated_at": "2025-02-14T18:06:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956541082",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956541082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956747029",
      "pull_request_review_id": 2618853313,
      "id": 1956747029,
      "node_id": "PRRC_kwDOABII5850oZcV",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "fc12a89cb337a4a835973201503c01c2c749e8bb",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": 1956371573,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I've been thinking about allocating it on the heap instead, but I kind of like that declaring it as the first field forces us to initialize it first, which a pointer type would not necessarily. Then again, moving the lock as a unique pointer from the options to the actual class would also probably be easier than defining a move constructor the directory lock class.",
      "created_at": "2025-02-14T21:36:32Z",
      "updated_at": "2025-02-14T21:36:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956747029",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956747029"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    }
  ]
}
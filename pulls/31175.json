{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175",
    "id": 2151266647,
    "node_id": "PR_kwDOABII586AOblX",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31175",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31175.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31175.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b83d509d59dde352054cccf792d28bb87835e64f",
    "number": 31175,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "rpc: Remove submitblock pre-checks",
    "user": {
      "login": "TheCharlatan",
      "id": 8421793,
      "node_id": "MDQ6VXNlcjg0MjE3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheCharlatan",
      "html_url": "https://github.com/TheCharlatan",
      "followers_url": "https://api.github.com/users/TheCharlatan/followers",
      "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
      "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
      "repos_url": "https://api.github.com/users/TheCharlatan/repos",
      "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "With the introduction of a mining ipc interface and the potential future introduction of a kernel library API it becomes increasingly important to offer common behaviour between them. An example of this is ProcessNewBlock, which is used by ipc, rpc, net_processing and (potentially) the kernel library. Having divergent behaviour on suggested pre-checks and checks for these functions is confusing to both developers and users and is a maintenance burden.\r\n\r\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks if the block has a coinbase transaction and whether it has been processed before. While the current example binary for how to use the kernel library, bitcoin-chainstate, imitates these checks, the other interfaces do not.\r\n\r\nThe coinbase check is repeated again early during ProcessNewBlock. Pre-checking it may also shadow more fundamental problems with a block. In most cases the block header is checked first, before validating the transactions. Checking the coinbase first therefore masks potential issues with the header. Fix this by removing the pre-check, but still throwing the same more expressive exception in case a coinbase validation error occurs.\r\n\r\nSimilary the duplicate checks are repeated early in the contextual checks of ProcessNewBlock. If duplicate blocks are detected much of their validation is skipped. Depending on the constitution of the block, validating the merkle root of the block is part of the more intensive workload when validating a block. This could be an argument for moving the pre-checks into block processing. In net_processing this would have a smaller effect however, since the block mutation check, which also validates the merkle root, is done before.\r\n\r\nTesting spamming a node with valid, but duplicate unrequested blocks seems to exhaust a CPU thread, but does not seem to significantly impact keeping up with the tip. The benefits of adding these checks to net_processing are questionable, especially since there are other ways to trigger the more CPU-intensive checks without submitting a duplicate block. Since these DOS concerns apply even less to the RPC interface, which does not have banning mechanics built in, remove them too.\r\n\r\nFinally, also remove the pre-checks from `bitcoin-chainstate.cpp`.\r\n\r\n---\r\n\r\nThis PR is part of the [libbitcoinkernel project](https://github.com/bitcoin/bitcoin/issues/27587).",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      }
    ],
    "created_at": "2024-10-29T11:05:05Z",
    "updated_at": "2024-11-07T21:35:43Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "195e5b0a9591d085b803c87bdb3e1d567cc01b8c",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "TheCharlatan:submitblock_prechecks",
      "ref": "submitblock_prechecks",
      "sha": "b83d509d59dde352054cccf792d28bb87835e64f",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 94456368,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NDQ1NjM2OA==",
        "name": "bitcoin",
        "full_name": "TheCharlatan/bitcoin",
        "owner": {
          "login": "TheCharlatan",
          "id": 8421793,
          "node_id": "MDQ6VXNlcjg0MjE3OTM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/TheCharlatan",
          "html_url": "https://github.com/TheCharlatan",
          "followers_url": "https://api.github.com/users/TheCharlatan/followers",
          "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
          "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
          "repos_url": "https://api.github.com/users/TheCharlatan/repos",
          "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/TheCharlatan/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/TheCharlatan/bitcoin",
        "archive_url": "https://api.github.com/repos/TheCharlatan/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/TheCharlatan/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/TheCharlatan/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/TheCharlatan/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/TheCharlatan/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/events",
        "forks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/TheCharlatan/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/TheCharlatan/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/TheCharlatan/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/TheCharlatan/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/TheCharlatan/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/TheCharlatan/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/TheCharlatan/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/TheCharlatan/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/TheCharlatan/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:TheCharlatan/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/TheCharlatan/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/TheCharlatan/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/TheCharlatan/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/hooks",
        "svn_url": "https://github.com/TheCharlatan/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 249162,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-11-07T21:13:35Z",
        "created_at": "2017-06-15T16:03:35Z",
        "updated_at": "2024-10-09T08:59:51Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "018e5fcc462caebb25cf5d3eb6a19dc2787466c8",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36320,
        "stargazers_count": 79238,
        "watchers_count": 79238,
        "size": 272050,
        "default_branch": "master",
        "open_issues_count": 645,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-11-07T17:30:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-11-07T21:43:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 17,
    "deletions": 44,
    "changed_files": 4,
    "commits": 2,
    "review_comments": 1,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2443908337,
      "node_id": "IC_kwDOABII586RqxTx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2443908337",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-29T11:05:08Z",
      "updated_at": "2024-11-06T21:00:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31175.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2419408412) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31196](https://github.com/bitcoin/bitcoin/pull/31196) (Prune mining interface by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2443908337",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "labeled",
      "id": 14982190543,
      "node_id": "LE_lADOABII586cN9yczwAAAAN9AhXP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14982190543",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-29T11:05:11Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "reviewed",
      "id": 2402259498,
      "node_id": "PRR_kwDOABII586PL5Iq",
      "url": null,
      "actor": null,
      "commit_id": "e742d66b1c77a90de502c45b452184b183b3778c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Haven't looked deeply yet, just wanted to mention #10146, which introduced the coinbase check and was even backported (see also #10190 for a regression test). Makes me wonder if there is more historical context to this.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2402259498",
      "submitted_at": "2024-10-29T15:22:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
    },
    {
      "event": "commented",
      "id": 2449494945,
      "node_id": "IC_kwDOABII586SAFOh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2449494945",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-31T10:11:09Z",
      "updated_at": "2024-10-31T10:11:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Makes me wonder if there is more historical context to this.\r\n\r\nYes, me too. If there are good reasons to keep these checks, then we should document why (and why they are not needed for the other interfaces). I could not come up with one, so I opened this PR, but I may well be missing something.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2449494945",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "commented",
      "id": 2452572531,
      "node_id": "IC_kwDOABII586SL0lz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2452572531",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-01T20:50:47Z",
      "updated_at": "2024-11-01T20:50:47Z",
      "author_association": "MEMBER",
      "body": "my guess is from #10146 this commit ada0caa165905b50db351a56ec124518c922085a looks like a covert fix for `submitblock` with a completely empty block. https://github.com/bitcoin/bitcoin/blob/master/src/rpc/mining.cpp#L1041 shows that it will call:\r\n\r\n`UpdateUncommittedBlockStructures -> GetWitnessCommitmentIndex` which would result in UB, before any PoW checks are made.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2452572531",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "reviewed",
      "id": 2419408412,
      "node_id": "PRR_kwDOABII586QNT4c",
      "url": null,
      "actor": null,
      "commit_id": "e742d66b1c77a90de502c45b452184b183b3778c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nI agree with the general motivation. While this PR can change the error message of `submitblock` in case more than one thing is wrong with the block, I don't really see why one is more important than the other.\r\n\r\n> UpdateUncommittedBlockStructures -> GetWitnessCommitmentIndex which would result in UB, before any PoW checks are made.\r\n\r\nNice find!\r\nI think that it would be good to have a test that would trigger the UB if https://github.com/bitcoin/bitcoin/commit/ada0caa165905b50db351a56ec124518c922085a was reverted (it requires us to know the header so that `UpdateUncommittedBlockStructures()` gets called, so the added test for an empty block doesn't trigger it - could make another `deepcopy` of `block` instead and then delete the txns):\r\n\r\n> Fix this by removing the pre-check, but still throwing the same more expressive exception in case a coinbase validation error occurs.\r\n\r\nI realize that you want to keep the existing behavior in this PR, but I do wonder if it really makes sense to have other consensus errors return \"rejected\", and this particular one to throw an exception.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2419408412",
      "submitted_at": "2024-11-06T21:00:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVlZGJjZTlkZWEyYjE4NjAwYTFlMDJhYTU0YWRlM2RjZjUwYjVkMDY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
      "tree": {
        "sha": "6ed4290f8ec227af7e50cd7c07d829ad4960774a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ed4290f8ec227af7e50cd7c07d829ad4960774a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6ed4290f8ec227af7e50cd7c07d829ad4960774a\nparent da10e0bab4a3e98868dd663af02c43b1dc8b7f4a\nauthor TheCharlatan <seb.kung@gmail.com> 1730129654 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1731013661 +0100\n\nrpc: Remove submitblock pre-checks\n\nWith the introduction of a mining ipc interface and the potential future\nintroduction of a kernel library API it becomes increasingly important\nto offer common behaviour between them. An example of this is\nProcessNewBlock, which is used by ipc, rpc, net_processing and\n(potentially) the kernel library. Having divergent behaviour on\nsuggested pre-checks and checks for these functions is confusing to both\ndevelopers and users and is a maintenance burden.\n\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks\nif the block has a coinbase transaction and whether it has been\nprocessed before. While the current example binary for how to use the\nkernel library, bitcoin-chainstate, imitates these checks, the other\ninterfaces do not.\n\nThe coinbase check is repeated again early during ProcessNewBlock.\nPre-checking it may also shadow more fundamental problems with a block.\nIn most cases the block header is checked first, before validating the\ntransactions. Checking the coinbase first therefore masks potential\nissues with the header. Fix this by removing the pre-check, but still\nthrowing the same more expressive exception in case a coinbase\nvalidation error occurs.\n\nThe pre-check was likely introduced on top of\nada0caa165905b50db351a56ec124518c922085a to fix UB in\nGetWitnessCommitmentIndex in case a block's transactions are empty. This\ncode path could only be reached because of the call to\nUpdateUncommittedBlockStructures in submitblock, but cannot be reached\nthrough net_processing.\n\nSimilary the duplicate checks are repeated early in the contextual\nchecks of ProcessNewBlock. If duplicate blocks are detected much of\ntheir validation is skipped. Depending on the constitution of the block,\nvalidating the merkle root of the block is part of the more intensive\nworkload when validating a block. This could be an argument for moving\nthe pre-checks into block processing. In net_processing this would have\na smaller effect however, since the block mutation check, which also\nvalidates the merkle root, is done before.\n\nTesting spamming a node with valid, but duplicate unrequested blocks\nseems to exhaust a CPU thread, but does not seem to significantly impact\nkeeping up with the tip. The benefits of adding these checks to\nnet_processing are questionable, especially since there are other ways\nto trigger the more CPU-intensive checks without submitting a duplicate\nblock. Since these DOS concerns apply even less to the RPC interface,\nwhich does not have banning mechanics built in, remove them too.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmctLQsACgkQm3m0VpHb\nQXNvahAAuaCL7C3Xxt6u20DSsULqF1qK5DRGeDVi1JAgv0PH8XZiOTrOU1hMNzHe\nnG0ovOt8GH682iV4cuq+xl0tEKhbKIHkpe+PLURMvZ7mtCoNBWT2k1te1SpiuRoV\n0s4ewNJ3v3s+vwtUHJ6wlBLus78evRnVf73e3pTT7YluJqdlneLBPfoEbYiZDVfb\nhS+BKhHVavRqT5lgppCyQtpzPnoWCkkfi4JA43v3xPpSoH2cqBzeIfMNUJY9GxKY\nm0leSt3+sAOYoElY75tr/psAD8t5KZM2Ds6TbbZiUw8MLgq+FVNuNQgFvolwJBpT\nY1hmHMn9e0URQLpZj/y6fANjWGsoMJya0d8zvmNgnrTaF5uR9drwWLL7O2ThIyyl\nNYzt3IsDZKh0fhUA4X8A+wcLoPrBd/8iDaJmjg24zNiKhQEBkhgfk5KpYcwNcdd8\nd+dpD5pX7sMC/5xVAsSxfbwWV1T3F8IO+PGROtjPllxD2HDPLWRFAy/uUxvJ/GQ4\nwQdHRGZ6MP9cEFyU+CRq/bzHQtWm70TACEHjDfqBYXJNLuV3s6X+GCdJFtN2EJON\nFfA9BdHfPMTUPKK+keHMW8AgsH24clQrbjgG6+VdkyTNjhS/4cCyCKSKJ2a6CVF5\nzwdhJ0N+B352gXd03GwaVgCWNAzVqbXG8h18EzwD4nMQmOuS8Ww=\n=pTYX\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da10e0bab4a3e98868dd663af02c43b1dc8b7f4a",
          "sha": "da10e0bab4a3e98868dd663af02c43b1dc8b7f4a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/da10e0bab4a3e98868dd663af02c43b1dc8b7f4a"
        }
      ],
      "message": "rpc: Remove submitblock pre-checks\n\nWith the introduction of a mining ipc interface and the potential future\nintroduction of a kernel library API it becomes increasingly important\nto offer common behaviour between them. An example of this is\nProcessNewBlock, which is used by ipc, rpc, net_processing and\n(potentially) the kernel library. Having divergent behaviour on\nsuggested pre-checks and checks for these functions is confusing to both\ndevelopers and users and is a maintenance burden.\n\nThe rpc interface for ProcessNewBlock (submitblock) currently pre-checks\nif the block has a coinbase transaction and whether it has been\nprocessed before. While the current example binary for how to use the\nkernel library, bitcoin-chainstate, imitates these checks, the other\ninterfaces do not.\n\nThe coinbase check is repeated again early during ProcessNewBlock.\nPre-checking it may also shadow more fundamental problems with a block.\nIn most cases the block header is checked first, before validating the\ntransactions. Checking the coinbase first therefore masks potential\nissues with the header. Fix this by removing the pre-check, but still\nthrowing the same more expressive exception in case a coinbase\nvalidation error occurs.\n\nThe pre-check was likely introduced on top of\nada0caa165905b50db351a56ec124518c922085a to fix UB in\nGetWitnessCommitmentIndex in case a block's transactions are empty. This\ncode path could only be reached because of the call to\nUpdateUncommittedBlockStructures in submitblock, but cannot be reached\nthrough net_processing.\n\nSimilary the duplicate checks are repeated early in the contextual\nchecks of ProcessNewBlock. If duplicate blocks are detected much of\ntheir validation is skipped. Depending on the constitution of the block,\nvalidating the merkle root of the block is part of the more intensive\nworkload when validating a block. This could be an argument for moving\nthe pre-checks into block processing. In net_processing this would have\na smaller effect however, since the block mutation check, which also\nvalidates the merkle root, is done before.\n\nTesting spamming a node with valid, but duplicate unrequested blocks\nseems to exhaust a CPU thread, but does not seem to significantly impact\nkeeping up with the tip. The benefits of adding these checks to\nnet_processing are questionable, especially since there are other ways\nto trigger the more CPU-intensive checks without submitting a duplicate\nblock. Since these DOS concerns apply even less to the RPC interface,\nwhich does not have banning mechanics built in, remove them too.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-11-07T21:07:41Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-28T15:34:14Z"
      },
      "sha": "eedbce9dea2b18600a1e02aa54ade3dcf50b5d06"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI4M2Q1MDlkNTlkZGUzNTIwNTRjY2NmNzkyZDI4YmI4NzgzNWU2NGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b83d509d59dde352054cccf792d28bb87835e64f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b83d509d59dde352054cccf792d28bb87835e64f",
      "tree": {
        "sha": "fbf3146251971b603838cca3249dd51e41a94f96",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fbf3146251971b603838cca3249dd51e41a94f96"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree fbf3146251971b603838cca3249dd51e41a94f96\nparent eedbce9dea2b18600a1e02aa54ade3dcf50b5d06\nauthor TheCharlatan <seb.kung@gmail.com> 1730130418 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1731013912 +0100\n\nkernel: Make bitcoin-chainstate's block validation mirror submitblock's\n\nThe behaviour of submitblock was changed in the previous commit, so\nchange it here too.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmctLRgACgkQm3m0VpHb\nQXO61RAAj9Nossh14r1mthXTqPFxXxdZL1MpbDrHre0JFCMWAoImXU6qwJB4rhCx\nAUcK7i+Kj8noghbQuEF05Hrg9lzzyVP58tcuywfixmdvITr2W786lF3O/5JW0Tpi\nWkAcJgYv4ak0Uy9CP2/g0usFor44DNPtNcfwc7ccCUW42+tNMi9vJZoFoTgE6HSH\nyGvlTtATdPTkL2gX6lvY+kJpiNwsA1w3J+qgBzVFrTm+2zullR7bA0FCRjN6JbKa\nGEcQ/X2WDhfHHSOWF4Jh3WJ7BBm/IgizYa3yWhqBGdVoRH9IXPwRqjBePeMFNAsu\nWXzmeuUAxJ0eujbSP/knlt/SHuB5+jG+sIVv1PSaOflrOtzuM7b0N4xQJG837HPB\nc37CxXV6XwnZuiNjpwF6J8BDueuvHtCabind7EnxBuBnWbXbTkIZ4912nqROKuGR\nfiwgehJijB/Pw+Y6Wwr6dwd6lk75CYQppHSdV3dbwZSIs4+JL1++WxBhGHiOjRLe\n+0mIW3aJONItP674tRrWTEN+sqAZGJ1z2YwzA1CVtU9nMj/Kqn+yvg/C86G+R4oM\nWCSJ+DsPfyzoQOHgKp1C2/oILoMcsUSR7ntOqU8a8Z/pgydYPwgUw5fEmCzS1wOg\nPStEadVk3rQFL74iaPqAe4Sscl61pN+Q/qtsps91BqNHOa+h54c=\n=JBWH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
          "sha": "eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eedbce9dea2b18600a1e02aa54ade3dcf50b5d06"
        }
      ],
      "message": "kernel: Make bitcoin-chainstate's block validation mirror submitblock's\n\nThe behaviour of submitblock was changed in the previous commit, so\nchange it here too.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-11-07T21:11:52Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2024-10-28T15:46:58Z"
      },
      "sha": "b83d509d59dde352054cccf792d28bb87835e64f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15193586464,
      "node_id": "HRFPE_lADOABII586cN9yczwAAAAOJm7sg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15193586464",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-07T21:12:20Z"
    },
    {
      "event": "commented",
      "id": 2463233587,
      "node_id": "IC_kwDOABII586S0fYz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2463233587",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-07T21:18:33Z",
      "updated_at": "2024-11-07T21:18:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Updated e742d66b1c77a90de502c45b452184b183b3778c -> b83d509d59dde352054cccf792d28bb87835e64f ([submitblock_prechecks_0](https://github.com/TheCharlatan/bitcoin/tree/submitblock_prechecks_0) -> [submitblock_prechecks_1](https://github.com/TheCharlatan/bitcoin/tree/submitblock_prechecks_1), [compare](https://github.com/TheCharlatan/bitcoin/compare/submitblock_prechecks_0..submitblock_prechecks_1))\r\n\r\n\r\n* Addressed @mzumsande's [comment](https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2419408412), added a small addition to the functional test for checking blocks with no transactions.\r\n* Mentioned the commit introducing the patch to `GetWitnessCommitmentIndex` in the commit message.\r\n\r\n> I realize that you want to keep the existing behavior in this PR, but I do wonder if it really makes sense to have other consensus errors return \"rejected\", and this particular one to throw an exception.\r\n\r\nYeah, I also don't think it makes a lot of sense, and even though it looks like the original description in #10146 was used to mask an actual problem, it does still mention the distinct error message as an improvement, so not sure if removing it could be annoying for users.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#issuecomment-2463233587",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31175"
    },
    {
      "event": "mentioned",
      "id": 15193729017,
      "node_id": "MEE_lADOABII586cN9yczwAAAAOJnef5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15193729017",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-07T21:18:35Z"
    },
    {
      "event": "subscribed",
      "id": 15193729038,
      "node_id": "SE_lADOABII586cN9yczwAAAAOJnegO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15193729038",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-07T21:18:35Z"
    },
    {
      "event": "reviewed",
      "id": 2422203882,
      "node_id": "PRR_kwDOABII586QX-Xq",
      "url": null,
      "actor": null,
      "commit_id": "eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#pullrequestreview-2422203882",
      "submitted_at": "2024-11-07T21:35:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1833399181",
      "pull_request_review_id": 2422203882,
      "id": 1833399181,
      "node_id": "PRRC_kwDOABII585tR3ON",
      "diff_hunk": "@@ -237,10 +237,17 @@ def assert_submitblock(block, result_str_1, result_str_2=None):\n         bad_block = copy.deepcopy(block)\n         bad_block.vtx[0].vin[0].prevout.hash += 1\n         bad_block.vtx[0].rehash()\n+        self.log.info(\"getblocktemplate: Test block with missing coinbase\")\n         assert_template(node, bad_block, 'bad-cb-missing')\n \n+        self.log.info(\"submitblock: Test empty block\")\n+        assert_equal('high-hash', node.submitblock(hexdata=CBlock().serialize().hex()))\n         self.log.info(\"submitblock: Test invalid coinbase transaction\")\n-        assert_raises_rpc_error(-22, \"Block does not start with a coinbase\", node.submitblock, CBlock().serialize().hex())\n+        bad_block.solve()\n+        assert_raises_rpc_error(-22, \"Block does not start with a coinbase\", node.submitblock, bad_block.serialize().hex())\n+        no_tx_block = copy.deepcopy(block)\n+        no_tx_block.vtx.clear()\n+        no_tx_block.solve()\n         assert_raises_rpc_error(-22, \"Block does not start with a coinbase\", node.submitblock, bad_block.serialize().hex())",
      "path": "test/functional/mining_basic.py",
      "position": 16,
      "original_position": 16,
      "commit_id": "b83d509d59dde352054cccf792d28bb87835e64f",
      "original_commit_id": "eedbce9dea2b18600a1e02aa54ade3dcf50b5d06",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "submit `no_tx_block` instead of `bad_block` here, and if I remember correctly from yesterday, that will lead to a different error.",
      "created_at": "2024-11-07T21:35:42Z",
      "updated_at": "2024-11-07T21:35:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31175#discussion_r1833399181",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1833399181"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31175"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 251,
      "original_line": 251,
      "side": "RIGHT"
    }
  ]
}
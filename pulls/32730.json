{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730",
    "id": 2584873116,
    "node_id": "PR_kwDOABII586aEgic",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32730",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32730.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32730.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
    "number": 32730,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "p2p: avoid traversing blocks (twice) during IBD",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Context:\r\nEvery time a block is connected, a `BlockConnected()` event is appended to the validation interface queue. This queue is consumed sequentially by a single worker thread. To avoid excessive memory usage, the queue is limited to 10 events at a time, and we stop processing new blocks until the queued events are handled.\r\n\r\nIssue:\r\nWithin the `PeerManager::BlockConnected()` listener, we traverse the block twice inside the transaction download manager — despite not needing to handle orphans or transaction requests during IBD.\r\n\r\nExtra info about the changes:\r\nThe new arg added to `BlockConnected()` in the first commit is primarily meant to avoid locking `cs_main` on the\r\nlistener side (to avoid calling `IsInitialBlockDownload()` there).\r\nAnother way of implementing this could be to add a bool field `enabled` to the `TxDownloadManager` class that is only\r\nset to true when we are out of IBD, so that we don't have to include a new arg inside the block connection event.\r\nThis is open for discussion. Could try implementing this second approach too.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-06-11T16:54:40Z",
    "updated_at": "2025-10-19T12:08:29Z",
    "closed_at": "2025-10-18T23:29:23Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "furszy:2025_net_avoid_traversing_block_twice",
      "ref": "2025_net_avoid_traversing_block_twice",
      "sha": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 438350,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-18T23:36:56Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2025-10-18T12:37:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5e6dbfd14ea9eace1c7e5ee76b140be46a0ec855",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38046,
        "stargazers_count": 86288,
        "watchers_count": 86288,
        "size": 295042,
        "default_branch": "master",
        "open_issues_count": 822,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-17T14:16:11Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-19T12:22:46Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 14,
    "deletions": 9,
    "changed_files": 5,
    "commits": 1,
    "review_comments": 27,
    "comments": 6
  },
  "events": [
    {
      "event": "commented",
      "id": 2963539180,
      "node_id": "IC_kwDOABII586wpATs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2963539180",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T16:54:44Z",
      "updated_at": "2025-07-11T15:40:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32730.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32941](https://github.com/bitcoin/bitcoin/pull/32941) (p2p: TxOrphanage revamp cleanups by glozow)\n* [#32827](https://github.com/bitcoin/bitcoin/pull/32827) (mempool: Avoid needless vtx iteration during IBD by l0rinc)\n* [#32631](https://github.com/bitcoin/bitcoin/pull/32631) (refactor: Convert GenTxid to `std::variant` by marcofleon)\n* [#32189](https://github.com/bitcoin/bitcoin/pull/32189) (refactor: Txid type safety (parent PR) by marcofleon)\n* [#31829](https://github.com/bitcoin/bitcoin/pull/31829) (p2p: improve TxOrphanage denial of service bounds by glozow)\n* [#30214](https://github.com/bitcoin/bitcoin/pull/30214) (refactor: Improve assumeutxo state representation by ryanofsky)\n* [#30116](https://github.com/bitcoin/bitcoin/pull/30116) (p2p: Fill reconciliation sets (Erlay) attempt 2 by sr-gi)\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-2963539180",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "labeled",
      "id": 18098416357,
      "node_id": "LE_lADOABII5867Aqa0zwAAAAQ2v-rl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18098416357",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T16:54:51Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "reviewed",
      "id": 2918055674,
      "node_id": "PRR_kwDOABII586t7f76",
      "url": null,
      "actor": null,
      "commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-11T20:11:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "Only had time for adding a few questions and quickly checking the expected effect this will have on IBD.\r\n\r\nA flame graph I did this week for master, showing a `-reindex` until 900k blocks shows this part of the code to be 0.07% of IBD (~20 seconds). It can still make sense to do it, we should avoid doing unnecessary work, just setting the expectations straight.\r\n\r\n![image](https://github.com/user-attachments/assets/3f18e48f-45eb-4046-8e98-e6bb2041cc55)\r\n\r\nLeft a few notes, the guard makes sense to me, but the part I passionately disagree with is the boolean argument train - is there a simpler way to avoid that either via a different guard or the locally available `m_initial_sync_finished` (we've been locking before anyway).",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#pullrequestreview-2918055674",
      "submitted_at": "2025-06-11T17:57:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
    },
    {
      "event": "reviewed",
      "id": 2918201028,
      "node_id": "PRR_kwDOABII586t8DbE",
      "url": null,
      "actor": null,
      "commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-11T18:00:44Z",
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#pullrequestreview-2918201028",
      "submitted_at": "2025-06-11T18:00:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
    },
    {
      "event": "reviewed",
      "id": 2921024467,
      "node_id": "PRR_kwDOABII586uG0vT",
      "url": null,
      "actor": null,
      "commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-12T12:52:52Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#pullrequestreview-2921024467",
      "submitted_at": "2025-06-12T12:52:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
    },
    {
      "event": "commented",
      "id": 2969850457,
      "node_id": "IC_kwDOABII586xBFJZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2969850457",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-13T10:15:18Z",
      "updated_at": "2025-06-13T10:15:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "One thing that still irks me a bit is that we are communicating more `ChainstateManager` state through a `Chainstate` callback. I think ideally the chainstate should not have to know if it is in ibd or not, but that is a difficult thing to achieve with out current code. What does seem non-ideal is that re-indexing is treated the same `is_ibd`. Maybe the `SynchronizationState` from the `headerTip` notification would give us more flexibility in that regard if needed in the future?",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-2969850457",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhiOWQzOTYxMmRjOWNjZGExNWZiYmMyYzc0M2JhZDY5M2U4YTJjZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "tree": {
        "sha": "6754a1f5e975880cbad645aab53d37ac2af8dc4d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6754a1f5e975880cbad645aab53d37ac2af8dc4d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6754a1f5e975880cbad645aab53d37ac2af8dc4d\nparent fed41b75fbfa6d14cce852863271b1fb0206eef0\nauthor furszy <matiasfurszyfer@protonmail.com> 1749651559 -0400\ncommitter furszy <matiasfurszyfer@protonmail.com> 1750185594 -0400\n\np2p: avoid traversing blocks (twice) during IBD\n\nContext:\nEvery time a block is connected, a 'BlockConnected' event is appended to the validation\ninterface queue. This queue is consumed sequentially by a single worker thread.\nTo avoid excessive memory usage, the queue is limited to 10 events at a time, and\nwe stop processing new blocks until the queued events are handled.\n\nIssue:\nWithin the 'PeerManager::BlockConnected()' listener, we traverse the block twice\ninside the transaction download manager — despite not needing to handle orphans or\ntransaction requests during IBD.\nThis redundant work adds unnecessary delay to the initial block download process.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmhRtnsACgkQXdI8zGhq\npiMBCA//VWN1C3g1aMtwtsr8ndwltdQnAL+VlcuMIEwSCQ52IrnJ9khnCedKxmNn\nStnyrw5mmfjvKsYjQ3L7q5iaFjOanE+PmN3NeD6NdfC3QLYXONlXjyU787vbUZHt\nBIiyvgGKQNWLXSl+AVVDcuHdUC74sDsyQ2aY4bt8U+R6qSKOy8UAUAuuuIGEHJnv\nMUU+qvGL6AtEHNAUSx6KojvahbxkHmW4f8mU+2+MJEFMYoUV3B4hjTmcmajpb1bf\n/aXTQN0en/x+3ttalkZIZl+AnfI4p+ArgHaA4cfQp2DJSZglOyl7HzMObF1GXs0M\nuJGCDbDloGIGisrLzvCN0mM+ADHXQrvAWpMAqBxYE65Sw/jCceahUXMUckIfpPc9\n/v9xNe/92RKQ/yIQfviPXghO0dyD2Q/Rlz7xQDXUvn9eF6BxqKDI8/571COGvMRW\n6Mx3MbAmqI4XE78/pRRc8w1kG1mmqsu78+G6xHvmrf9HA1DuCyTlf2NTzTWl4rTV\neL/HgNWph913DVw+QFQlxkxCp6571ftnNInyBFz9TBrGOYukLvsQ3WgtohNJ1VJr\nn1OEj/NSscCKNgFTURqtPfTmIcF/VQXI0tXbJzpXdUJO5AQbqoaWC5zvTmR4emuu\nsl4l1STgT4VZlqFZtPMpml9vdNm23TqvDu7MXkFS91VysgjVfYc=\n=KM2Z\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fed41b75fbfa6d14cce852863271b1fb0206eef0",
          "sha": "fed41b75fbfa6d14cce852863271b1fb0206eef0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fed41b75fbfa6d14cce852863271b1fb0206eef0"
        }
      ],
      "message": "p2p: avoid traversing blocks (twice) during IBD\n\nContext:\nEvery time a block is connected, a 'BlockConnected' event is appended to the validation\ninterface queue. This queue is consumed sequentially by a single worker thread.\nTo avoid excessive memory usage, the queue is limited to 10 events at a time, and\nwe stop processing new blocks until the queued events are handled.\n\nIssue:\nWithin the 'PeerManager::BlockConnected()' listener, we traverse the block twice\ninside the transaction download manager — despite not needing to handle orphans or\ntransaction requests during IBD.\nThis redundant work adds unnecessary delay to the initial block download process.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2025-06-17T18:39:54Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2025-06-11T14:19:19Z"
      },
      "sha": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18196495496,
      "node_id": "HRFPE_lADOABII5867Aqa0zwAAAAQ8mHyI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18196495496",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "created_at": "2025-06-17T18:42:14Z"
    },
    {
      "event": "commented",
      "id": 2981637249,
      "node_id": "IC_kwDOABII586xuCyB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2981637249",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-17T19:41:00Z",
      "updated_at": "2025-06-17T19:43:19Z",
      "author_association": "MEMBER",
      "body": "> One thing that still irks me a bit is that we are communicating more `ChainstateManager` state through a `Chainstate` callback. I think ideally the chainstate should not have to know if it is in ibd or not, but that is a difficult thing to achieve with out current code.\r\n\r\nHmm yeah, we would need to decouple the block download logic from the chain state class first. This reminds me to #27837, which is a small step in that direction.\r\n\r\n> What does seem non-ideal is that re-indexing is treated the same is_ibd. Maybe the SynchronizationState from the headerTip notification would give us more flexibility in that regard if needed in the future?\r\n\r\nCheck it now. Ended up reimplementing it differently.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-2981637249",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "renamed",
      "id": 18197473653,
      "node_id": "RTE_lADOABII5867Aqa0zwAAAAQ8p2l1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18197473653",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-17T19:59:49Z",
      "rename": {
        "from": "p2p: avoid traversing blocks (twice) during IBD for no reason",
        "to": "p2p: avoid traversing blocks (twice) during IBD"
      }
    },
    {
      "event": "reviewed",
      "id": 2938016671,
      "node_id": "PRR_kwDOABII586vHpOf",
      "url": null,
      "actor": null,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-18T07:21:13Z",
      "author_association": "MEMBER",
      "body": "Would be good to first add proper tests for the touched code in another pull, before refactoring the code for a 0.07% speedup. (The refactor broke the code, as I see it)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#pullrequestreview-2938016671",
      "submitted_at": "2025-06-18T07:21:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
    },
    {
      "event": "reviewed",
      "id": 2937862890,
      "node_id": "PRR_kwDOABII586vHDrq",
      "url": null,
      "actor": null,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-18T07:39:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "I like this new patch a lot more, setting IBD is a lot cleaner this way.\r\nSomebody with more experience should validate whether that's correct or not.\r\nMy main suggestion is splitting to commits where the messages put the 3 distinct changes in context - and maybe to invert the naming of a the new field which is always negated at use site anyway.\r\n\r\n<details>\r\n<summary>Patch</summary>\r\n\r\n```patch\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex 88fe531119..80b2fc7d6a 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1909,7 +1909,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n     // ********************************************************* Step 12: start node\r\n \r\n     int64_t best_block_time{};\r\n-    bool initial_sync_finished{false};\r\n+    bool initial_sync{true};\r\n     {\r\n         LOCK(chainman.GetMutex());\r\n         const auto& tip{*Assert(chainman.ActiveTip())};\r\n@@ -1925,10 +1925,10 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n             tip_info->header_height = chainman.m_best_header->nHeight;\r\n             tip_info->header_time = chainman.m_best_header->GetBlockTime();\r\n         }\r\n-        initial_sync_finished = !chainman.IsInitialBlockDownload();\r\n+        initial_sync = chainman.IsInitialBlockDownload();\r\n     }\r\n     LogPrintf(\"nBestHeight = %d\\n\", chain_active_height);\r\n-    if (node.peerman) node.peerman->SetBestBlock(chain_active_height, std::chrono::seconds{best_block_time}, initial_sync_finished);\r\n+    if (node.peerman) node.peerman->SetBestBlock(chain_active_height, best_block_time, initial_sync);\r\n \r\n     // Map ports with NAT-PMP\r\n     StartMapPort(args.GetBoolArg(\"-natpmp\", DEFAULT_NATPMP));\r\ndiff --git a/src/net_processing.cpp b/src/net_processing.cpp\r\nindex 97e3e05d4f..89229d6cae 100644\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -511,7 +511,7 @@ public:\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_tx_download_mutex);\r\n     void BlockDisconnected(const std::shared_ptr<const CBlock> &block, const CBlockIndex* pindex) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_tx_download_mutex);\r\n-    void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) override\r\n+    void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool initial_sync) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     void BlockChecked(const CBlock& block, const BlockValidationState& state) override\r\n         EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n@@ -537,11 +537,11 @@ public:\r\n     PeerManagerInfo GetInfo() const override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     void SendPings() override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n     void RelayTransaction(const uint256& txid, const uint256& wtxid) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\r\n-    void SetBestBlock(int height, std::chrono::seconds time, bool initial_sync_finished) override\r\n+    void SetBestBlock(int height, uint64_t block_time, bool initial_sync) override\r\n     {\r\n         m_best_height = height;\r\n-        m_best_block_time = time;\r\n-        m_initial_sync_finished = initial_sync_finished;\r\n+        m_best_block_time = std::chrono::seconds{block_time};\r\n+        m_initial_sync = initial_sync;\r\n     };\r\n     void UnitTestMisbehaving(NodeId peer_id) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex) { Misbehaving(*Assert(GetPeerRef(peer_id)), \"\"); };\r\n     void ProcessMessage(CNode& pfrom, const std::string& msg_type, DataStream& vRecv,\r\n@@ -789,9 +789,9 @@ private:\r\n \r\n     bool RejectIncomingTxs(const CNode& peer) const;\r\n \r\n-    /** Whether we've completed initial sync yet, for determining when to turn\r\n+    /** Whether we're still in initial sync, for determining when to turn\r\n       * on extra block-relay-only peers. */\r\n-    std::atomic<bool> m_initial_sync_finished{false};\r\n+    std::atomic<bool> m_initial_sync{true};\r\n \r\n     /** Protects m_peer_map. This mutex must not be locked while holding a lock\r\n      *  on any of the mutexes inside a Peer object. */\r\n@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\r\n \r\n     // The following task can be skipped since we don't maintain a mempool for\r\n     // the ibd/background chainstate.\r\n-    if (!m_initial_sync_finished || role == ChainstateRole::BACKGROUND) {\r\n+    if (m_initial_sync || role == ChainstateRole::BACKGROUND) {\r\n         return;\r\n     }\r\n     LOCK(m_tx_download_mutex);\r\n@@ -2066,12 +2066,12 @@ void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::sha\r\n  * Update our best height and announce any block hashes which weren't previously\r\n  * in m_chainman.ActiveChain() to our peers.\r\n  */\r\n-void PeerManagerImpl::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload)\r\n+void PeerManagerImpl::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool initial_sync)\r\n {\r\n-    SetBestBlock(pindexNew->nHeight, std::chrono::seconds{pindexNew->GetBlockTime()}, !fInitialDownload);\r\n+    SetBestBlock(pindexNew->nHeight, pindexNew->GetBlockTime(), initial_sync);\r\n \r\n     // Don't relay inventory during initial block download.\r\n-    if (fInitialDownload) return;\r\n+    if (initial_sync) return;\r\n \r\n     // Find the hashes of all blocks that weren't previously in the best chain.\r\n     std::vector<uint256> vHashes;\r\n@@ -5266,8 +5266,9 @@ void PeerManagerImpl::CheckForStaleTipAndEvictPeers()\r\n         m_stale_tip_check_time = now + STALE_CHECK_INTERVAL;\r\n     }\r\n \r\n-    if (!m_initial_sync_finished && CanDirectFetch()) {\r\n+    if (m_initial_sync && CanDirectFetch()) {\r\n         m_connman.StartExtraBlockRelayPeers();\r\n+        // TODO? m_initial_sync = false;\r\n     }\r\n }\r\n \r\ndiff --git a/src/net_processing.h b/src/net_processing.h\r\nindex 5a5980a9da..d7ea6a12a3 100644\r\n--- a/src/net_processing.h\r\n+++ b/src/net_processing.h\r\n@@ -124,8 +124,8 @@ public:\r\n     /** Send ping message to all peers */\r\n     virtual void SendPings() = 0;\r\n \r\n-    /** Set the height of the best block and its time (seconds since epoch), and indicate whether historical block sync has completed. */\r\n-    virtual void SetBestBlock(int height, std::chrono::seconds time, bool initial_sync_finished) = 0;\r\n+    /** Set the height of the best block, its block time, and whether block sync has completed. */\r\n+    virtual void SetBestBlock(int height, uint64_t block_time, bool initial_sync) = 0;\r\n \r\n     /* Public for unit testing. */\r\n     virtual void UnitTestMisbehaving(NodeId peer_id) = 0;\r\ndiff --git a/src/test/peerman_tests.cpp b/src/test/peerman_tests.cpp\r\nindex 30d680ffde..0bedae7859 100644\r\n--- a/src/test/peerman_tests.cpp\r\n+++ b/src/test/peerman_tests.cpp\r\n@@ -41,8 +41,7 @@ BOOST_AUTO_TEST_CASE(connections_desirable_service_flags)\r\n     // Make peerman aware of the initial best block and verify we accept limited peers when we start close to the tip time.\r\n     auto tip = WITH_LOCK(::cs_main, return m_node.chainman->ActiveChain().Tip());\r\n     uint64_t tip_block_time = tip->GetBlockTime();\r\n-    int tip_block_height = tip->nHeight;\r\n-    peerman->SetBestBlock(tip_block_height, std::chrono::seconds{tip_block_time}, /*initial_sync_finished=*/true);\r\n+    peerman->SetBestBlock(tip->nHeight, tip_block_time, /*initial_sync=*/false);\r\n \r\n     SetMockTime(tip_block_time + 1); // Set node time to tip time\r\n     BOOST_CHECK(peerman->GetDesirableServiceFlags(peer_flags) == ServiceFlags(NODE_NETWORK_LIMITED | NODE_WITNESS));\r\ndiff --git a/src/txorphanage.cpp b/src/txorphanage.cpp\r\nindex ca47bf949f..80d25df047 100644\r\n--- a/src/txorphanage.cpp\r\n+++ b/src/txorphanage.cpp\r\n@@ -246,7 +246,6 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\r\n \r\n void TxOrphanage::EraseForBlock(const CBlock& block)\r\n {\r\n-    // No orphans, nothing to do\r\n     if (m_orphans.empty()) return;\r\n \r\n     std::vector<Wtxid> vOrphanErase;\r\n```\r\n\r\n</details>",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#pullrequestreview-2937862890",
      "submitted_at": "2025-06-18T07:39:06Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
    },
    {
      "event": "commented",
      "id": 2984080899,
      "node_id": "IC_kwDOABII586x3XYD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2984080899",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T12:53:34Z",
      "updated_at": "2025-06-18T13:27:16Z",
      "author_association": "MEMBER",
      "body": "> m_initial_sync_finished will normally be set to true, so this is dead code now. Surprising that no tests failed ...\r\n\r\nyeah.. This reminded me why I didn’t use the `m_initial_sync_finished` flag in the previous version.. it is being set differently because it can toggle back and forth, while the IBD one doesn’t. We had a whole discussion about this in #28170.\r\nBefore getting into any detail, will think more about the approach (not this week) and whether it’s worth embarking on a larger journey just for this change.\r\n",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-2984080899",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "commented",
      "id": 3063441895,
      "node_id": "IC_kwDOABII5862mGnn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3063441895",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-11T19:11:36Z",
      "updated_at": "2025-07-11T19:11:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-3063441895",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "labeled",
      "id": 18592631994,
      "node_id": "LE_lADOABII5867Aqa0zwAAAARUNQy6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18592631994",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-11T19:11:36Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 18731128236,
      "node_id": "REFE_lADOABII5867Aqa0zwAAAARcdlWs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18731128236",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7129c9ea8e950f50bdc56d88c57617c66c90bb8a",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7129c9ea8e950f50bdc56d88c57617c66c90bb8a",
      "created_at": "2025-07-21T15:02:01Z"
    },
    {
      "event": "commented",
      "id": 3379343664,
      "node_id": "IC_kwDOABII587JbLEw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3379343664",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-08T02:27:37Z",
      "updated_at": "2025-10-08T02:27:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#issuecomment-3379343664",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32730"
    },
    {
      "event": "closed",
      "id": 20362922986,
      "node_id": "CE_lADOABII5867Aqa0zwAAAAS9uYvq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20362922986",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-18T23:29:23Z"
    },
    {
      "event": "comment_deleted",
      "id": 20366484389,
      "node_id": "CDE_lADOABII5867Aqa0zwAAAAS97-Ol",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20366484389",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-19T12:08:28Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140691354",
      "pull_request_review_id": 2918055674,
      "id": 2140691354,
      "node_id": "PRRC_kwDOABII585_mFua",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This makes sense on its own I think - it's similar to another draft PR I had (https://github.com/bitcoin-dev-tools/benchcoin/pull/167). If you think it's related and adds anything, feel free to cherry-pick it here.",
      "created_at": "2025-06-11T17:08:32Z",
      "updated_at": "2025-06-11T17:57:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140691354",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140691354"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140727336",
      "pull_request_review_id": 2918055674,
      "id": 2140727336,
      "node_id": "PRRC_kwDOABII585_mOgo",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do",
      "path": "src/txorphanage.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I find the comment redundant, it states exactly what the code already states clearly, doesn't add any new info",
      "created_at": "2025-06-11T17:29:59Z",
      "updated_at": "2025-06-11T17:57:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140727336",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140727336"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 249,
      "original_line": 249,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140736581",
      "pull_request_review_id": 2918055674,
      "id": 2140736581,
      "node_id": "PRRC_kwDOABII585_mQxF",
      "diff_hunk": "@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {\n         return;\n     }\n     LOCK(m_tx_download_mutex);",
      "path": "src/net_processing.cpp",
      "position": 30,
      "original_position": 8,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We can safely skip this because we're never requesting single transactions during IBD (i.e. `AlreadyHaveTx` isn't needed during IBD)?\r\n```C++\r\nfor (const auto& ptx : pblock->vtx) {\r\n    RecentConfirmedTransactionsFilter().insert(ptx->GetHash().ToUint256());\r\n    if (ptx->HasWitness()) {\r\n        RecentConfirmedTransactionsFilter().insert(ptx->GetWitnessHash().ToUint256());\r\n    }\r\n    m_txrequest.ForgetTxHash(ptx->GetHash());\r\n    m_txrequest.ForgetTxHash(ptx->GetWitnessHash());\r\n}\r\n```\r\n\r\nCan we guard this by some other criteria instead of the IBD boolean, like we're doing with `EraseForBlock`, e.g.\r\n```C++\r\nif (!m_txrequest.Size()) return;\r\n```\r\n",
      "created_at": "2025-06-11T17:35:53Z",
      "updated_at": "2025-06-11T17:57:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140736581",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140736581"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2000,
      "original_line": 2000,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140745477",
      "pull_request_review_id": 2918055674,
      "id": 2140745477,
      "node_id": "PRRC_kwDOABII585_mS8F",
      "diff_hunk": "@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "is the comment (already mentioning IBD) still accurate?",
      "created_at": "2025-06-11T17:41:29Z",
      "updated_at": "2025-06-11T17:57:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140745477",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140745477"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": 1995,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140746212",
      "pull_request_review_id": 2918055674,
      "id": 2140746212,
      "node_id": "PRRC_kwDOABII585_mTHk",
      "diff_hunk": "@@ -1975,7 +1975,8 @@ void PeerManagerImpl::ActiveTipChange(const CBlockIndex& new_tip, bool is_ibd)\n void PeerManagerImpl::BlockConnected(\n     ChainstateRole role,\n     const std::shared_ptr<const CBlock>& pblock,\n-    const CBlockIndex* pindex)\n+    const CBlockIndex* pindex,\n+    bool is_ibd)",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "there should be a better way to do this than passing around a boolean over so many layers. I'll review it properly this week.",
      "created_at": "2025-06-11T17:41:56Z",
      "updated_at": "2025-06-11T17:57:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140746212",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140746212"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1979,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140775369",
      "pull_request_review_id": 2918201028,
      "id": 2140775369,
      "node_id": "PRRC_kwDOABII585_maPJ",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this is a common-sense change by itself :+1: ",
      "created_at": "2025-06-11T18:00:44Z",
      "updated_at": "2025-06-11T18:00:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140775369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140775369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140904587",
      "pull_request_review_id": 2918419471,
      "id": 2140904587,
      "node_id": "PRRC_kwDOABII585_m5yL",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140775369,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "tiny note: this also skip post-IBD blocks when we don't have any orphans.\r\n--Credits to @mzumsande for pointing it out too--\r\nWe could do the same for the tx requests tracker loop but.. that wouldn't change much as we still need to traverse the block for the \"recently confirmed\" filter anyway.",
      "created_at": "2025-06-11T19:20:33Z",
      "updated_at": "2025-06-12T07:35:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140904587",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140904587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140909676",
      "pull_request_review_id": 2918427191,
      "id": 2140909676,
      "node_id": "PRRC_kwDOABII585_m7Bs",
      "diff_hunk": "@@ -1975,7 +1975,8 @@ void PeerManagerImpl::ActiveTipChange(const CBlockIndex& new_tip, bool is_ibd)\n void PeerManagerImpl::BlockConnected(\n     ChainstateRole role,\n     const std::shared_ptr<const CBlock>& pblock,\n-    const CBlockIndex* pindex)\n+    const CBlockIndex* pindex,\n+    bool is_ibd)",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140746212,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> there should be a better way to do this than passing around a boolean over so many layers. I'll review it properly this week.\r\n\r\nDid you check the second approach proposed in the PR description?",
      "created_at": "2025-06-11T19:24:08Z",
      "updated_at": "2025-06-11T19:24:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140909676",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140909676"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1979,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140911571",
      "pull_request_review_id": 2918429980,
      "id": 2140911571,
      "node_id": "PRRC_kwDOABII585_m7fT",
      "diff_hunk": "@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140745477,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> is the comment (already mentioning IBD) still accurate?\r\n\r\nThe comment was accurate, but the code didn’t behave as described. Now it does.",
      "created_at": "2025-06-11T19:25:25Z",
      "updated_at": "2025-06-11T19:25:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140911571",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140911571"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": 1995,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140918676",
      "pull_request_review_id": 2918441054,
      "id": 2140918676,
      "node_id": "PRRC_kwDOABII585_m9OU",
      "diff_hunk": "@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {\n         return;\n     }\n     LOCK(m_tx_download_mutex);",
      "path": "src/net_processing.cpp",
      "position": 30,
      "original_position": 8,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140736581,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> We can safely skip this because we're never requesting single transactions during IBD (i.e. `AlreadyHaveTx` isn't needed during IBD)?\r\n> \r\n> ```c++\r\n> for (const auto& ptx : pblock->vtx) {\r\n>     RecentConfirmedTransactionsFilter().insert(ptx->GetHash().ToUint256());\r\n>     if (ptx->HasWitness()) {\r\n>         RecentConfirmedTransactionsFilter().insert(ptx->GetWitnessHash().ToUint256());\r\n>     }\r\n>     m_txrequest.ForgetTxHash(ptx->GetHash());\r\n>     m_txrequest.ForgetTxHash(ptx->GetWitnessHash());\r\n> }\r\n> ```\r\n> \r\n> Can we guard this by some other criteria instead of the IBD boolean, like we're doing with `EraseForBlock`, e.g.\r\n> \r\n> ```c++\r\n> if (!m_txrequest.Size()) return;\r\n> ```\r\n\r\nI thought about it but didn't do it on purpose. The reasoning is that we still need to add the txs into the recently confirmed filters post-IBD even when we don't have any tx requests. In other words, we still need to traverse the block. Could at most skip the last two lines with the emptiness check.",
      "created_at": "2025-06-11T19:30:28Z",
      "updated_at": "2025-06-11T19:30:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140918676",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140918676"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2000,
      "original_line": 2000,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140931183",
      "pull_request_review_id": 2918460317,
      "id": 2140931183,
      "node_id": "PRRC_kwDOABII585_nARv",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140691354,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> This makes sense on its own I think - it's similar to another draft PR I had ([bitcoin-dev-tools#167](https://github.com/bitcoin-dev-tools/benchcoin/pull/167)). If you think it's related and adds anything, feel free to cherry-pick it here.\r\n\r\nThat's cool, will check it in the coming days.\r\nFirst quick glance it seems that if the mempool is empty; we could avoid calling `removeForBlock` entirely. Which will save us from adding another callback into the validation queue too, which will leave space for processing another block during ibd.\r\nYet, that was a fast check. Should check who is using the `MempoolTransactionsRemovedForBlock` event.",
      "created_at": "2025-06-11T19:39:30Z",
      "updated_at": "2025-06-11T19:39:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2140931183",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140931183"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142663267",
      "pull_request_review_id": 2921024467,
      "id": 2142663267,
      "node_id": "PRRC_kwDOABII585_tnJj",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Shouldn't checking `role == ChainstateRole::BACKGROUND || m_chainman.IsInitialBlockDownload()` be good enough? I realize it is racy, the condition may already be false even when the last few ibd blocks are still being processed, but I don't think that really matters here. We also use it similarly in the `BlockChecked` method.",
      "created_at": "2025-06-12T12:52:52Z",
      "updated_at": "2025-06-12T12:52:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2142663267",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142663267"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142790766",
      "pull_request_review_id": 2921237009,
      "id": 2142790766,
      "node_id": "PRRC_kwDOABII585_uGRu",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "That's why I asked for !m_initial_sync_finished as well.\r\nIf the race is biased towards reenabling it too early (rather than later), I agree that it should be fine.",
      "created_at": "2025-06-12T13:44:58Z",
      "updated_at": "2025-06-12T13:44:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2142790766",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142790766"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142866210",
      "pull_request_review_id": 2921369411,
      "id": 2142866210,
      "node_id": "PRRC_kwDOABII585_uYsi",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "furszy reminded me that BlockChecked is run synchronously, so I don't think that comparison makes sense after all.  I guess this comment can be resolved.",
      "created_at": "2025-06-12T14:06:57Z",
      "updated_at": "2025-06-12T14:06:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2142866210",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142866210"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142868289",
      "pull_request_review_id": 2921373138,
      "id": 2142868289,
      "node_id": "PRRC_kwDOABII585_uZNB",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Shouldn't checking `role == ChainstateRole::BACKGROUND || m_chainman.IsInitialBlockDownload()` be good enough? I realize it is racy, the condition may already be false even when the last few ibd blocks are still being processed, but I don't think that really matters here. We also use it similarly in the `BlockChecked` method.\r\n\r\nThe diff between `BlockConnected()` and `BlockChecked()` is that the former one runs async while the latter runs synchronously. So the idea was to avoid locking `cs_main` in a different thread which delays other parts of the node.\r\n\r\nI also thought about using the 'm_initial_sync_finished' bool for this, but that's not good because the field is calculated at a different time interval in the stale tip check thread (we could compute it more often but that's a different story).\r\n\r\nThe last idea that had was the `enabled` flag inside the TxDownloadManager (check the PR description, you might like this one more).",
      "created_at": "2025-06-12T14:07:36Z",
      "updated_at": "2025-06-12T14:13:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2142868289",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2142868289"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2143003197",
      "pull_request_review_id": 2921591755,
      "id": 2143003197,
      "node_id": "PRRC_kwDOABII585_u6I9",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> The last idea that had was the enabled flag inside the TxDownloadManager (check the PR description, you might like this one more).\r\n\r\nI saw that but not yet sure until I see it in action. I definitely dislike the current arg passing, so I'd vote for that if we really need this param",
      "created_at": "2025-06-12T15:01:19Z",
      "updated_at": "2025-06-12T15:01:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2143003197",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2143003197"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2143351000",
      "pull_request_review_id": 2922175264,
      "id": 2143351000,
      "node_id": "PRRC_kwDOABII585_wPDY",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I saw that but not yet sure until I see it in action. I definitely dislike the current arg passing, so I'd vote for that if we really need this param\r\n\r\nOk, I'm a ~0 on this. I think this field is special enough (reason below) to be signaled as a separate arg or it could be wrapped into a struct — similar to how it's done in the `interfaces::Chain::Notifications class`. With this, I'm not saying to not try the TxDownloadManager `enabled` flag approach, I just think that the current approach is slightly more useful for future listeners usages.\r\n\r\nThe only thing I'm somewhat convinced of is that, just like listeners are informed about blocks being downloaded through AssumeUTXO background chain validation, it would be nice if they are aware of IBD blocks — otherwise, sooner or later they will end up re-implementing the same racy/locking `isIBD()` logic across multiple layers (which could be fine for some cases but it doesn't seem to be generally good).",
      "created_at": "2025-06-12T18:05:25Z",
      "updated_at": "2025-06-12T18:07:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2143351000",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2143351000"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2144941851",
      "pull_request_review_id": 2924559098,
      "id": 2144941851,
      "node_id": "PRRC_kwDOABII585_2Tcb",
      "diff_hunk": "@@ -1993,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 1,
      "original_position": 24,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2142663267,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> it would be nice if they are aware of IBD blocks — otherwise [...] they will end up re-implementing\r\n\r\nIs there a more reusable way we could implement this?",
      "created_at": "2025-06-13T11:57:34Z",
      "updated_at": "2025-06-13T11:57:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2144941851",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2144941851"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1997,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153734695",
      "pull_request_review_id": 2937862890,
      "id": 2153734695,
      "node_id": "PRRC_kwDOABII586AX2In",
      "diff_hunk": "@@ -790,7 +791,7 @@ class PeerManagerImpl final : public PeerManager\n \n     /** Whether we've completed initial sync yet, for determining when to turn\n       * on extra block-relay-only peers. */\n-    bool m_initial_sync_finished GUARDED_BY(cs_main){false};\n+    std::atomic<bool> m_initial_sync_finished{false};",
      "path": "src/net_processing.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "👍 for using an atomic here!\r\n\r\nNote: the usages are always inverted now, can we rather have `std::atomic<bool> m_initial_sync{true}` instead?",
      "created_at": "2025-06-18T06:16:58Z",
      "updated_at": "2025-06-18T07:39:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153734695",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153734695"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 794,
      "original_line": 794,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153747162",
      "pull_request_review_id": 2937862890,
      "id": 2153747162,
      "node_id": "PRRC_kwDOABII586AX5La",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140691354,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "To simplify review, could you split it into several commits - one changing the `m_initial_sync(_finished)` implementation, one adding it next to `role == ChainstateRole::BACKGROUND` and one with this change -  explaining the context (which are a bit muffled for me currently) in each commit message?\r\n\r\nI'm also curious if it's possible to get back to being in IBD after we're finished (e.g. after being offline for weeks, i.e. `if (chain.Tip()->Time() < Now<NodeSeconds>() - m_options.max_tip_age) {`).",
      "created_at": "2025-06-18T06:25:31Z",
      "updated_at": "2025-06-18T07:39:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153747162",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153747162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153782195",
      "pull_request_review_id": 2937862890,
      "id": 2153782195,
      "node_id": "PRRC_kwDOABII586AYBuz",
      "diff_hunk": "@@ -5267,7 +5268,6 @@ void PeerManagerImpl::CheckForStaleTipAndEvictPeers()\n \n     if (!m_initial_sync_finished && CanDirectFetch()) {\n         m_connman.StartExtraBlockRelayPeers();\n-        m_initial_sync_finished = true;",
      "path": "src/net_processing.cpp",
      "position": 44,
      "original_position": 44,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "does this introduce any behavioral change? (i.e. `m_initial_sync_finished` being set to `true` at a different lifecycle)",
      "created_at": "2025-06-18T06:48:39Z",
      "updated_at": "2025-06-18T07:39:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153782195",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153782195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5270,
      "original_line": 5270,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153816847",
      "pull_request_review_id": 2937862890,
      "id": 2153816847,
      "node_id": "PRRC_kwDOABII586AYKMP",
      "diff_hunk": "@@ -1924,9 +1925,10 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n             tip_info->header_height = chainman.m_best_header->nHeight;\n             tip_info->header_time = chainman.m_best_header->GetBlockTime();\n         }\n+        initial_sync_finished = !chainman.IsInitialBlockDownload();\n     }\n     LogPrintf(\"nBestHeight = %d\\n\", chain_active_height);\n-    if (node.peerman) node.peerman->SetBestBlock(chain_active_height, std::chrono::seconds{best_block_time});\n+    if (node.peerman) node.peerman->SetBestBlock(chain_active_height, std::chrono::seconds{best_block_time}, initial_sync_finished);",
      "path": "src/init.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Q: is the guard only meant for tests or can this happen in prod as well? Given that we only need `initial_sync_finished` when this is set, was wondering if it would make sense to guard the `initial_sync_finished = !chainman.IsInitialBlockDownload()` as well - but not sure if that makes it clearer or more cumbersome. Just documenting my questions, no action needed.",
      "created_at": "2025-06-18T07:08:41Z",
      "updated_at": "2025-06-18T07:41:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153816847",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153816847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1931,
      "original_line": 1931,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153823534",
      "pull_request_review_id": 2937862890,
      "id": 2153823534,
      "node_id": "PRRC_kwDOABII586AYL0u",
      "diff_hunk": "@@ -124,8 +124,8 @@ class PeerManager : public CValidationInterface, public NetEventsInterface\n     /** Send ping message to all peers */\n     virtual void SendPings() = 0;\n \n-    /** Set the height of the best block and its time (seconds since epoch). */\n-    virtual void SetBestBlock(int height, std::chrono::seconds time) = 0;\n+    /** Set the height of the best block and its time (seconds since epoch), and indicate whether historical block sync has completed. */",
      "path": "src/net_processing.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "* `indicate` doesn't hint that we're actually setting it as well\r\n* `historical` might not be accurate given that we can re-enter IBD mode I think",
      "created_at": "2025-06-18T07:12:25Z",
      "updated_at": "2025-06-18T07:39:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153823534",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153823534"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 127,
      "original_line": 127,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153826564",
      "pull_request_review_id": 2937862890,
      "id": 2153826564,
      "node_id": "PRRC_kwDOABII586AYMkE",
      "diff_hunk": "@@ -1994,7 +1994,7 @@ void PeerManagerImpl::BlockConnected(\n \n     // The following task can be skipped since we don't maintain a mempool for\n     // the ibd/background chainstate.\n-    if (role == ChainstateRole::BACKGROUND) {\n+    if (is_ibd || role == ChainstateRole::BACKGROUND) {\n         return;\n     }\n     LOCK(m_tx_download_mutex);",
      "path": "src/net_processing.cpp",
      "position": 30,
      "original_position": 8,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140736581,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Could at most skip the last two lines with the emptiness check\r\n\r\nNot sure that helps",
      "created_at": "2025-06-18T07:13:59Z",
      "updated_at": "2025-06-18T07:39:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153826564",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153826564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2000,
      "original_line": 2000,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153828418",
      "pull_request_review_id": 2937862890,
      "id": 2153828418,
      "node_id": "PRRC_kwDOABII586AYNBC",
      "diff_hunk": "@@ -537,10 +537,11 @@ class PeerManagerImpl final : public PeerManager\n     PeerManagerInfo GetInfo() const override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\n     void SendPings() override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\n     void RelayTransaction(const uint256& txid, const uint256& wtxid) override EXCLUSIVE_LOCKS_REQUIRED(!m_peer_mutex);\n-    void SetBestBlock(int height, std::chrono::seconds time) override\n+    void SetBestBlock(int height, std::chrono::seconds time, bool initial_sync_finished) override",
      "path": "src/net_processing.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Given that we're always calling this with `tip->GetBlockTime()` and converting it to seconds on the call sites, we might simplify it to accept `uint64_t block_time` and convert to seconds inside instead. Not sure it's better, just noticed a pattern...",
      "created_at": "2025-06-18T07:14:34Z",
      "updated_at": "2025-06-18T07:42:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153828418",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153828418"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 540,
      "original_line": 540,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153834617",
      "pull_request_review_id": 2938016671,
      "id": 2153834617,
      "node_id": "PRRC_kwDOABII586AYOh5",
      "diff_hunk": "@@ -5267,7 +5268,6 @@ void PeerManagerImpl::CheckForStaleTipAndEvictPeers()\n \n     if (!m_initial_sync_finished && CanDirectFetch()) {\n         m_connman.StartExtraBlockRelayPeers();\n-        m_initial_sync_finished = true;",
      "path": "src/net_processing.cpp",
      "position": 44,
      "original_position": 44,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "m_initial_sync_finished will normally be set to true, so this is dead code now. Surprising that no tests failed ...\r\n\r\n",
      "created_at": "2025-06-18T07:17:38Z",
      "updated_at": "2025-06-18T07:21:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2153834617",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153834617"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": 5269,
      "original_start_line": 5269,
      "start_side": "RIGHT",
      "line": 5270,
      "original_line": 5270,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2173852408",
      "pull_request_review_id": 2969367582,
      "id": 2173852408,
      "node_id": "PRRC_kwDOABII586Bklr4",
      "diff_hunk": "@@ -246,6 +246,9 @@ bool TxOrphanage::HaveTxToReconsider(NodeId peer)\n \n void TxOrphanage::EraseForBlock(const CBlock& block)\n {\n+    // No orphans, nothing to do\n+    if (m_orphans.empty()) return;",
      "path": "src/txorphanage.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "8b9d39612dc9ccda15fbbc2c743bad693e8a2ce6",
      "original_commit_id": "e48bfeb58ff9d7bc3d4395be1e3f6057740e9418",
      "in_reply_to_id": 2140691354,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Opened it separately in https://github.com/bitcoin/bitcoin/pull/32827, please resolve this comment",
      "created_at": "2025-06-29T18:24:22Z",
      "updated_at": "2025-06-29T18:24:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32730#discussion_r2173852408",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2173852408"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32730"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": 250,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606",
    "id": 1139581261,
    "node_id": "PR_kwDOABII585D7KFN",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26606",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26606.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26606.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/837d656f8cbeeec5e30c129aa1beac8816a35651",
    "number": 26606,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Implement independent BDB parser",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Split from #26596 \r\n\r\nThis PR adds `BerkeleyRODatabase` which is an independent implementation of a BDB file parser. It provides read only access to a BDB file, and can therefore be used as a read only database backend for wallets. This will be used for dumping legacy wallet records and migrating legacy wallets without the need for BDB itself.\r\n\r\nWallettool's `dump` command is changed to use `BerkeleyRODatabase` instead of `BerkeleyDatabase` (and `CWallet` itself) to demonstrate that this parser works and to test it against the existing wallettool functional tests.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2022-11-29T21:50:53Z",
    "updated_at": "2024-04-24T16:48:41Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "2bebbd9c2724155322b80358c6e901a2d7077fef",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "achow101:berkeleyro",
      "ref": "berkeleyro",
      "sha": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 36,
        "watchers_count": 36,
        "size": 268848,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-04-23T16:21:13Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2024-04-04T14:22:50Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "256e1703197fdddd78bc6d659431cd0fc3b63cde",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35289,
        "stargazers_count": 75970,
        "watchers_count": 75970,
        "size": 255014,
        "default_branch": "master",
        "open_issues_count": 696,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-04-24T16:33:47Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-04-24T15:59:23Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 1266,
    "deletions": 19,
    "changed_files": 23,
    "commits": 17,
    "review_comments": 72,
    "comments": 33
  },
  "events": [
    {
      "event": "commented",
      "id": 1331367594,
      "node_id": "IC_kwDOABII585PWw6q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1331367594",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T21:50:56Z",
      "updated_at": "2024-04-24T16:48:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/26606).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1479296136), [Sjors](https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1658468351), [theStack](https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1713893741) |\n| Stale ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1782050983), [laanwj](https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2063345481) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29442](https://github.com/bitcoin/bitcoin/pull/29442) (wallet: Target a pre-defined utxo set composition by adjusting change outputs by remyers)\n* [#29071](https://github.com/bitcoin/bitcoin/pull/29071) (refactor: Remove Span operator==, Use std::ranges::equal by maflcko)\n* [#28236](https://github.com/bitcoin/bitcoin/pull/28236) (fuzz: wallet, add target for Spend by Ayush170-Future)\n* [#26596](https://github.com/bitcoin/bitcoin/pull/26596) (wallet: Migrate legacy wallets to descriptor wallets without requiring BDB by achow101)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1331367594",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 7916809974,
      "node_id": "LE_lADOABII585Xi1euzwAAAAHX4O72",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7916809974",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T21:50:58Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-29T21:51:35Z",
      "updated_at": "2022-11-29T21:51:35Z",
      "source": {
        "issue": {
          "id": 1467243567,
          "node_id": "PR_kwDOABII585D2F4R",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26596",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26596/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26596/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26596/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26596",
          "number": 26596,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Migrate legacy wallets to descriptor wallets without requiring BDB",
          "body": "Currently migrating to descriptor wallets requires having BDB available. In order to remove BDB from the project, we need to be able to do these migrations without BDB. This PR adds `BerkeleyRODatabase` which is an independent implementation of a BDB file parser. It can be used to read uncorrupted BDB files and extract all of their records. This is used for both the wallettool's `dump` command, and `migratewallet`.\r\n\r\nBased on #26606 ",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26596",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26596",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26596.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26596.patch"
          },
          "created_at": "2022-11-28T23:46:50Z",
          "updated_at": "2024-04-16T17:56:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7917493896,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAHX616I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7917493896",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T00:13:18Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7918049578,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAHX89kq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7918049578",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T02:36:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7918381484,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAHX-Oms",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7918381484",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T04:09:47Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T14:14:40Z",
      "updated_at": "2022-11-30T14:14:40Z",
      "source": {
        "issue": {
          "id": 1320033494,
          "node_id": "PR_kwDOABII5848NBt5",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25722",
          "number": 25722,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Use util::Result class for wallet loading",
          "body": "**This is based on #25665 + #26022.** The non-base commits are:\r\n\r\n- [`b027d1df5981` refactor: Use util::Result class in wallet/spend](https://github.com/bitcoin/bitcoin/pull/25722/commits/b027d1df598177dec3236f8689b3218f53de3fa9)\r\n- [`5972a3abf26c` Add temporary ResultExtract helper for porting to util::Result](https://github.com/bitcoin/bitcoin/pull/25722/commits/5972a3abf26c25e47db298461c08a4553e4010bb)\r\n- [`1a92d9497bd1` refactor: Use util::Result class in wallet/sqlite](https://github.com/bitcoin/bitcoin/pull/25722/commits/1a92d9497bd158a1d16efd281c68e41fa11e5b0d)\r\n- [`b4fbcf5f2a8f` refactor: Use util::Result class in wallet/bdb](https://github.com/bitcoin/bitcoin/pull/25722/commits/b4fbcf5f2a8f3b390b4041ac98f16161c5181a76)\r\n- [`f56538aa2b92` refactor: Use util::Result class in wallet::MakeDatabase](https://github.com/bitcoin/bitcoin/pull/25722/commits/f56538aa2b924aaeae28f55b41c03eb0145c981d)\r\n- [`e880f6d5e89b` refactor: Use util::Result class in wallet/dump](https://github.com/bitcoin/bitcoin/pull/25722/commits/e880f6d5e89bbdceed2e4d769882f37b3a3c81b2)\r\n- [`4128ab5cdcc6` refactor: Use util::Result class in wallet/salvage](https://github.com/bitcoin/bitcoin/pull/25722/commits/4128ab5cdcc6e2a540e994b615618586e902ccda)\r\n- [`1138e12cfd98` refactor: Use util::Result class in wallet/wallettool](https://github.com/bitcoin/bitcoin/pull/25722/commits/1138e12cfd984fbceaa045348d993b70047d3ab3)\r\n- [`aed183ad112f` refactor: Use util::Result class in wallet/wallet](https://github.com/bitcoin/bitcoin/pull/25722/commits/aed183ad112f00d7ac11435244149e8e936494f9)\r\n- [`032e3e1ebf9b` refactor: Use util::Result class in wallet/load](https://github.com/bitcoin/bitcoin/pull/25722/commits/032e3e1ebf9b1d86596e8393f85461d60074e821)\r\n- [`46ed2908e6f8` refactor: Use util::Result class in wallet/rpc](https://github.com/bitcoin/bitcoin/pull/25722/commits/46ed2908e6f8b6d0f2ebcfc5600a52c61f26109e)\r\n- [`799467626de3` refactor: Use util::Result class in wallet/interfaces](https://github.com/bitcoin/bitcoin/pull/25722/commits/799467626de3c40249be6f0be4ecef5aa5757ed9)\r\n- [`5c7e1caff7db` refactor: Use util::Result class in wallet/test](https://github.com/bitcoin/bitcoin/pull/25722/commits/5c7e1caff7db1f9a61e94e40c22f056f9bef9715)\r\n- [`965c31baa9a3` Drop temporary ResultExtract helper for porting to util::Result](https://github.com/bitcoin/bitcoin/pull/25722/commits/965c31baa9a357e5a92bf4da94e84c37df7e0a9f)\r\n- [`2385cb37dbbe` scripted-diff: replace wallet DatabaseStatus with DatabaseError](https://github.com/bitcoin/bitcoin/pull/25722/commits/2385cb37dbbe00004f8bffe1d1d784778d89a21e)\r\n\r\n---\r\n\r\nWallet loading functions up and down the stack have lots of error and warning parameters, and return error information in different ways. This PR makes them uniformly return `util::Result`, without changing behavior.",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25722",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25722",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25722.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25722.patch"
          },
          "created_at": "2022-07-27T19:26:58Z",
          "updated_at": "2024-04-19T17:17:54Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1199739624,
      "node_id": "PRR_kwDOABII585HgpLo",
      "url": null,
      "actor": null,
      "commit_id": "f135c19f82e3d19ef0292f140d94d8e114a31547",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "Marek777777",
        "id": 117536597,
        "node_id": "U_kgDOBwF3VQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/117536597?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Marek777777",
        "html_url": "https://github.com/Marek777777",
        "followers_url": "https://api.github.com/users/Marek777777/followers",
        "following_url": "https://api.github.com/users/Marek777777/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Marek777777/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Marek777777/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Marek777777/subscriptions",
        "organizations_url": "https://api.github.com/users/Marek777777/orgs",
        "repos_url": "https://api.github.com/users/Marek777777/repos",
        "events_url": "https://api.github.com/users/Marek777777/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Marek777777/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1199739624",
      "submitted_at": "2022-11-30T17:23:47Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T18:00:14Z",
      "updated_at": "2022-11-30T18:00:14Z",
      "source": {
        "issue": {
          "id": 652547610,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ1NTk1Mjk3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19461",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19461/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19461/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19461/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19461",
          "number": 19461,
          "state": "open",
          "state_reason": null,
          "title": "multiprocess: Add bitcoin-gui -ipcconnect option",
          "body": "**This is a draft PR because it is based on #10102 + #19460.** The non-base commits are:\r\n\r\n- [`5f91aa3d8b47` multiprocess: Add bitcoin-gui -ipcconnect option](https://github.com/bitcoin/bitcoin/pull/19461/commits/5f91aa3d8b47cee97e625c3b5689a37dbd941eff)\r\n\r\n---\r\n\r\nBuilding on #10102, this adds an `-ipcconnect` option to `bitcoin-gui` that connects the GUI to an existing `bitcoin-node` process already running in the background instead of spawning a new `bitcoin-node` process. This allows the GUI to be started and stopped independently of the node. By default with this change, `bitcoin-gui` will check if a `<datadir>/sockets/node.sock` socket exists and try to connect to that. If that doesn't work, it will spawn a new node process and start up the same way it did before this PR.\r\n\r\nThe default `bitcoin-gui` connect option is `-ipcconnect=auto`, which tries to connect if possible as described above, and spawns a new `bitcoin-node` process if not possible. Other supported options are `-noipcconnect` to never connect to an existing node and always spawn a new one, `-ipcconnect` to require a connection and fail if it can't be established, and `-ipcconnect=unix:<socket>` to require a connection and use a custom socket path.\r\n\r\nWith this PR, basic functionality works and gui instances can connect and disconnect from a running node. But there are rough edges: If a gui process doesn't shut down cleanly, the node can see unhandled IpcExceptions, and if node command line options are passed to `bitcoin-gui` and `bitcoin-gui` connects to an exiting bitcoin-node process instead of spawning a new one, the node options will be silently ignored. \r\n\r\nThese changes require multiprocess support and this PR has no effect unless bitcoin is configured with `--enable-multiprocess` as described in [doc/multiprocess.md](https://github.com/bitcoin/bitcoin/blob/master/doc/multiprocess.md)\r\n\r\n---\r\n\r\nThis PR is part of the [process separation project](https://github.com/bitcoin/bitcoin/issues/28722).\r\n",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135946,
              "node_id": "MDU6TGFiZWwxMzU5NDY=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/GUI",
              "name": "GUI",
              "color": "02d7e1",
              "default": false
            },
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19461",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19461",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19461.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19461.patch"
          },
          "created_at": "2020-07-07T19:00:11Z",
          "updated_at": "2024-04-20T01:06:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-30T18:02:08Z",
      "updated_at": "2022-11-30T18:02:08Z",
      "source": {
        "issue": {
          "id": 652543635,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ1NTkyMDUz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19460",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19460/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19460/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19460/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19460",
          "number": 19460,
          "state": "open",
          "state_reason": null,
          "title": "multiprocess: Add bitcoin-wallet -ipcconnect option",
          "body": "**This is a draft PR because it is based on #10102.** The non-base commits are:\r\n\r\n- [`bbefbd3c199b` multiprocess: Add -ipcconnect and -ipcbind options](https://github.com/bitcoin/bitcoin/pull/19460/commits/bbefbd3c199b189188d6427b4564b17477c6d50e)\r\n\r\n---\r\n\r\nBuilding on #10102, this adds an `-ipcconnect` option to `bitcoin-wallet` and an `-ipcbind` option to `bitcoin-node` (both enabled by default in multiprocess builds) so bitcoin node will listen on a `<datadir>/sockets/node.sock` unix socket, and `bitcoin-wallet` will connect to it.\r\n\r\nThe idea is that `bitcoin-wallet` can be extended in the future to have some online functionality. For example, there could be a `bitcoin-wallet sync` command that will update balances and sync latest transactions to an unloaded wallet, or a `bitcoin-wallet serve` subcommand that loads a wallet and serves RPC requests, or a `bitcoin-wallet shell` subcommand that allows running RPC methods interactively like the GUI console, or just general support for `bitcoin-wallet <rpc method> <rpc params>` invocations suggested https://github.com/bitcoin/bitcoin/pull/13926#issuecomment-455187379.\r\n\r\nThis PR is small and doesn't do much. The only visible change is that `bitcoin-wallet` now checks whether a node socket exists on startup and prints \"Connected to IPC address\" if it can connect it it.\r\n\r\nThe default `bitcoin-wallet` connect option is `-ipcconnect=auto`, which connects if possible as described above, and proceeds offline if not possible. Other supported options are `-noipcconnect` to disable ipc, `-ipcconnect` to require a connection and fail if it can't be established, and `-ipcconnect=unix:<socket>` to require a connection and use a custom socket path.\r\n\r\nThese changes require multiprocess support and this PR has no effect unless bitcoin is configured with `--enable-multiprocess` as described in [doc/multiprocess.md](https://github.com/bitcoin/bitcoin/blob/master/doc/multiprocess.md)\r\n\r\n---\r\n\r\nThis PR is part of the [process separation project](https://github.com/bitcoin/bitcoin/issues/28722).\r\n",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 61889416,
              "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
              "name": "Build system",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19460",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19460",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19460.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19460.patch"
          },
          "created_at": "2020-07-07T18:53:19Z",
          "updated_at": "2024-04-20T01:06:14Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7936723616,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAHZEMqg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7936723616",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-12-02T00:48:47Z"
    },
    {
      "event": "reviewed",
      "id": 1203279038,
      "node_id": "PRR_kwDOABII585HuJS-",
      "url": null,
      "actor": null,
      "commit_id": "99c43be0a051586fc01cae0af74ea9e2d5f649b1",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": ".",
      "user": {
        "login": "Marek777777",
        "id": 117536597,
        "node_id": "U_kgDOBwF3VQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/117536597?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Marek777777",
        "html_url": "https://github.com/Marek777777",
        "followers_url": "https://api.github.com/users/Marek777777/followers",
        "following_url": "https://api.github.com/users/Marek777777/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Marek777777/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Marek777777/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Marek777777/subscriptions",
        "organizations_url": "https://api.github.com/users/Marek777777/orgs",
        "repos_url": "https://api.github.com/users/Marek777777/repos",
        "events_url": "https://api.github.com/users/Marek777777/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Marek777777/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1203279038",
      "submitted_at": "2022-12-03T02:11:29Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-18T21:46:49Z",
      "updated_at": "2023-01-18T21:46:49Z",
      "source": {
        "issue": {
          "id": 1532409473,
          "node_id": "PR_kwDOABII585HVfFs",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26889",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26889/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26889/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26889/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26889",
          "number": 26889,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: wallet, remove global 'ArgsManager' dependency",
          "body": "Structurally, the wallet class shouldn't access the global `ArgsManager` class, its internal behavior shouldn't be coupled to a global command line args parsing object.\r\n\r\nSo this PR migrates the only two places where we depend on it: (1) the keypool size, and (2) the \"-walletnotify\" script. And cleans up the, now unneeded, wallet `ArgsManager` ref member.\r\n\r\nExtra note:\r\nIn the process of removing the args ref member, discovered and fixed files that were invalidly depending on the wallet header including `util/system.h`.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 14,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26889",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26889",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26889.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26889.patch"
          },
          "closed_at": "2023-02-17T17:48:08Z",
          "created_at": "2023-01-13T14:45:27Z",
          "updated_at": "2023-05-01T19:10:24Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 8550177843,
      "node_id": "LE_lADOABII585Xi1euzwAAAAH9oVwz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8550177843",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T19:14:36Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8550968208,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAH9rWuQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8550968208",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T20:57:47Z"
    },
    {
      "event": "unlabeled",
      "id": 8551149700,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAH9sDCE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8551149700",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T21:24:37Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1320156842,
      "node_id": "PRR_kwDOABII585Or_6q",
      "url": null,
      "actor": null,
      "commit_id": "89f5edaf85a0e597b7f63accce526a0dfca6990f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Some review nibbles.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1320156842",
      "submitted_at": "2023-03-01T16:42:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8758584134,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAIKDWNG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8758584134",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-15T18:09:31Z"
    },
    {
      "event": "commented",
      "id": 1479296136,
      "node_id": "IC_kwDOABII585YLESI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1479296136",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-22T10:29:17Z",
      "updated_at": "2023-03-22T10:29:17Z",
      "author_association": "MEMBER",
      "body": "Concept ACK. Have you looked into a fuzz target for this parser?",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1479296136",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1480027322,
      "node_id": "IC_kwDOABII585YN2y6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1480027322",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-22T18:02:01Z",
      "updated_at": "2023-03-22T18:02:01Z",
      "author_association": "MEMBER",
      "body": "> Have you looked into a fuzz target for this parser?\r\n\r\nI haven't. If someone would like to write one, I'd be happy to add it.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1480027322",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 9139121889,
      "node_id": "LE_lADOABII585Xi1euzwAAAAIgu-7h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9139121889",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-01T19:47:09Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9148245130,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAIhRySK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9148245130",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T17:42:53Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9148332893,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAIhSHtd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9148332893",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T17:53:13Z"
    },
    {
      "event": "unlabeled",
      "id": 9149329341,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAIhV6-9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9149329341",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-02T19:53:46Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-03T15:58:58Z",
      "updated_at": "2023-05-03T15:58:58Z",
      "source": {
        "issue": {
          "id": 722711719,
          "node_id": "MDU6SXNzdWU3MjI3MTE3MTk=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/20160",
          "number": 20160,
          "state": "open",
          "state_reason": null,
          "title": "Proposed Timeline for Legacy Wallet and BDB removal",
          "body": "Here is a proposed timeline for the move from legacy wallets to descriptor wallets, and at the same time, bdb to sqlite, culminating with the removal of both legacy wallets and bdb. Even though the wallet type and the wallet storage format are orthogonal to each other, as noted in #19077, I would like to tie them together for the sake of simplicity when it comes to how we make new wallets and the migration of one type to another.\r\n\r\nThe 4 combinations of type and format are: legacy-bdb, legacy-sqlite, descriptor-bdb, and descriptor-sqlite. While all 4 types will be supported, we will primarily deal with legacy-bdb and descriptor-sqlite. Setting `descriptors=True` in `createwallet` (or checking the Descriptors option in the GUI) will always make a descriptor-sqlite. Setting that to `False` will always make a legacy-bdb.\r\n\r\n- [x] 0.21 (late 2020)\r\n  - [x] Initial release of descriptor type and sqlite format. (#16528, #19077)\r\n  - [x] Descriptor type is experimental with a warning as such (#16528)\r\n  - [x] Only legacy-bdb and descriptor-sqlite will be created (#19077)\r\n- [x] 22.0 (mid 2021)\r\n  - [x] Implement descriptor exports (#20226)\r\n  - [x] Legacy type remains default (no pr needed)\r\n  - [x] Introduce `dump` and `createfromdump` wallet tool commands with an additional `-format` option to specify the wallet type (#19137)\r\n    * Users may use `dump` and then `createfromdump` in order to make legacy-sqlite from legacy-bdb\r\n    * Users may use `dump` and then `createfromdump` in order to make descriptor-bdb from descriptor-sqlite\r\n  - [x] If a wallet specified in conf or command line doesn't exist, don't make a wallet and instead warn (#15454)\r\n- [x] 23.0 (early 2022)\r\n  - [x] Change descriptor type to non-experimental (#23002)\r\n  - [x] Change `createwallet` `descriptors` default to `True` (#23002)\r\n  - [x] Change wallet tool `create` `-descriptors` default to `True` (#23002)\r\n- [x] 24.0 (late 2022)\r\n  - [x] Introduce `migratewallet` command to migrate a legacy-bdb to descriptor-sqlite (#19602)\r\n  - [x] For newly created legacy-bdb wallets, warn that they are deprecated and will soon be unsupported (#24505)\r\n- [x] 26.0 (late 2023)\r\n  - [x] When loading legacy-bdb, descriptor-bdb, or legacy-sqlite wallets, warn that the legacy type and bdb format will soon be unsupported, as applicable. (#27869)\r\n  - [x] Deprecate creating new legacy-bdb wallets #28597 \r\n  - [x] `migratewallet` bug fixes\r\n    - [x] #28609\r\n    - [x] #28546\r\n- [x] 27.0 (early 2024)\r\n  - [x] address book performance improvement #26836\r\n  - [x] bulk deletion of txs performance improvement #28987\r\n  - [x] bulk deletion of records performance improvement #29403\r\n  - [x] Caching to improve performance of migrated non-HD descriptor wallets (also perf improvement in general) #26008\r\n  - [x] Remove `migratewallet` experimental warning #28037 \r\n- [ ] 28.0 (late 2024)\r\n  - [ ] Improve performance of migratewallet #28574\r\n  - [ ] Reimplement legacy-bdb to descriptor-sqlite migration (maybe as a separate command or in the wallet tool) to be independent of `LegacyScriptPubKeyMan` and BDB (#26596)\r\n  - [ ] For `dump`, implement an independent BDB file loader (this should probably be shared with the previous) (#26606)\r\n  - [ ] Stop creating new legacy-bdb wallets (not yet started)\r\n  - [ ] GUI: Migrate wallets that are not loaded (not yet started)\r\n  - [x] Fix default wallet migration naming (#29586)\r\n- [ ] 29.0 (early 2025)\r\n  - [ ] Stop loading legacy-bdb, descriptor-bdb, legacy-sqlite wallet entirely. Inform users how to migrate (not yet started)\r\n  - [ ] Remove `LegacyScriptPubKeyMan` except for the independent migration stuff (#28710)\r\n  - [ ] Remove BDB except for independent loading for migration stuff (#28710)\r\n\r\nAdditional improvements that have no target deadline:\r\n\r\n- [x] Backwards compatibility tests fixes for descriptor wallets #28027\r\n\r\nThe migration code will probably be around for a long time/forever.\r\n\r\nNote that we expect users who go through the effort to make a legacy-sqlite or descriptor-bdb wallet to suck it up and deal with the consequences of doing something that isn't really supported. Such users should be able to figure out for themselves how to migrate their wallets. (Maybe `migratewallet` can migrate legacy-sqlite to descriptor-sqlite. bdb to sqlite is way easier than legacy to descriptor).",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 37,
          "created_at": "2020-10-15T22:17:41Z",
          "updated_at": "2024-03-25T12:57:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1577039004,
      "node_id": "IC_kwDOABII585d_7Sc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1577039004",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-05T15:40:32Z",
      "updated_at": "2023-06-05T15:40:32Z",
      "author_association": "MEMBER",
      "body": "Adding a fuzz target that compares this to the real thing seems useful. Given that this PR changes `dumpwallet` to rely on the new parser, I think we should do that sooner rather than later. Otherwise I suggest changing e88ad38ac2f3e43de54a332965b13eb7cc27b91f so that the read-only parser is optional, and then change the tests to always use it.\r\n\r\nIt seems a bit daunting to compare the low level DBD parsing code in this PR to the real thing. Having a fuzzer also reduces the need to be very thorough in that. I'm not sure how much confidence I have in the existing test coverage for dumpwallet.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1577039004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 9455539693,
      "node_id": "LE_lADOABII585Xi1euzwAAAAIzmBXt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9455539693",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T08:12:47Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9470032193,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAI0dTlB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9470032193",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-08T09:35:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9470102935,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAI0dk2X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9470102935",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-08T09:42:18Z"
    },
    {
      "event": "unlabeled",
      "id": 9472828338,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAI0n-Oy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9472828338",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-08T13:50:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1585733097,
      "node_id": "IC_kwDOABII585ehF3p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585733097",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-10T16:52:31Z",
      "updated_at": "2023-06-10T16:52:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1585733097",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "unsubscribed",
      "id": 9491485410,
      "node_id": "UE_lADOABII585Xi1euzwAAAAI1vJLi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9491485410",
      "actor": {
        "login": "joostjager",
        "id": 4638168,
        "node_id": "MDQ6VXNlcjQ2MzgxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4638168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joostjager",
        "html_url": "https://github.com/joostjager",
        "followers_url": "https://api.github.com/users/joostjager/followers",
        "following_url": "https://api.github.com/users/joostjager/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/joostjager/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/joostjager/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/joostjager/subscriptions",
        "organizations_url": "https://api.github.com/users/joostjager/orgs",
        "repos_url": "https://api.github.com/users/joostjager/repos",
        "events_url": "https://api.github.com/users/joostjager/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/joostjager/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-10T19:12:44Z"
    },
    {
      "event": "reviewed",
      "id": 1478773216,
      "node_id": "PRR_kwDOABII585YJEng",
      "url": null,
      "actor": null,
      "commit_id": "f108c6b565e73ea02df94331a347f9d1653ab0b2",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK\r\n\r\nI'm testing this against my hand-rolled databases, so far this looks solid.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1478773216",
      "submitted_at": "2023-06-14T21:21:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "commented",
      "id": 1600625695,
      "node_id": "IC_kwDOABII585fZ5wf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1600625695",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-21T10:58:16Z",
      "updated_at": "2023-06-21T10:58:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "Wrote [my first fuzz test](https://github.com/TheCharlatan/bitcoin/commit/995ccef131e71ae94f5c73ee3b0297282f5646ed) (I really don't know what I am doing so not even sure this is useful), and managed to hit: `fuzz: wallet/migrate.cpp:384: void wallet::RecordsPage::Unserialize(Stream &) [Stream = CAutoFile]: Assertion false failed`.\r\n\r\n",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1600625695",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1600634431,
      "node_id": "IC_kwDOABII585fZ74_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1600634431",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-21T11:04:59Z",
      "updated_at": "2023-06-21T11:04:59Z",
      "author_association": "MEMBER",
      "body": "> wallet/migrate.cpp:384: void wallet::RecordsPage::Unserialize(Stream &) [Stream = CAutoFile]: Assertion false failed\r\n\r\nSound like a real bug, because `assert` should generally not be used to validate user input or files read from disk?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1600634431",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1601156957,
      "node_id": "IC_kwDOABII585fb7dd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601156957",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-21T16:27:38Z",
      "updated_at": "2023-06-21T16:27:38Z",
      "author_association": "MEMBER",
      "body": "> Wrote [my first fuzz test](https://github.com/TheCharlatan/bitcoin/commit/995ccef131e71ae94f5c73ee3b0297282f5646ed) (I really don't know what I am doing so not even sure this is useful), and managed to hit: `fuzz: wallet/migrate.cpp:384: void wallet::RecordsPage::Unserialize(Stream &) [Stream = CAutoFile]: Assertion false failed`.\r\n\r\nDo you have the input that hit that?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1601156957",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1601377160,
      "node_id": "IC_kwDOABII585fcxOI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1601377160",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-21T18:33:09Z",
      "updated_at": "2023-06-21T18:33:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1601156957\r\n\r\n> Do you have the input that hit that?\r\n\r\nYes, pasting as base64 here, since I'm not sure about the practice of attaching random binary files:\r\n\r\n```\r\necho \"HQABAAAAAQAAAACPAAUxYgAAAAmK/////wkAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAKysrAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////gAAAAAAz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Xz8/Pz8/Pz8/Pz8/Pz8/Pz88Az8/Pz8/PADqKIIr/////////EwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAArKysAAAAAAAAAAAAAAAAAAADPz8/Pz8/PxXt7e3t7e3t7AABPAAUxz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/S0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eNLS0tLS0tLSKtLS0tLS0tLS0tLS0tLS0tDS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0s/Pz8/Pz8/Pz8/Pz8/PAAB7e3t7e3t7e3sBAAABAAACK08ABQAgXFxcXFxcAQAAAACPAAUxYgAAAAmK/////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKysrAAAAAAAAAAAAAAAAAAAAz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/PzwAAAP/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pzw==\" | base64 -d > crash-assert\r\n```",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1601377160",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9670693740,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJAaxNs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9670693740",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-28T22:27:24Z"
    },
    {
      "event": "commented",
      "id": 1612198266,
      "node_id": "IC_kwDOABII585gGDF6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1612198266",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-28T22:28:42Z",
      "updated_at": "2023-06-28T22:28:42Z",
      "author_association": "MEMBER",
      "body": "Found an issue with prefix cursor handling, updated the tests to check for that. Also pulled in @TheCharlatan's fuzz test and changed several asserts to instead throw exceptions which resolves the fuzz crash.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1612198266",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "mentioned",
      "id": 9670700954,
      "node_id": "MEE_lADOABII585Xi1euzwAAAAJAay-a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9670700954",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-28T22:28:42Z"
    },
    {
      "event": "subscribed",
      "id": 9670700966,
      "node_id": "SE_lADOABII585Xi1euzwAAAAJAay-m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9670700966",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-28T22:28:43Z"
    },
    {
      "event": "labeled",
      "id": 9672217925,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJAglVF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9672217925",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T03:40:40Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1612512773,
      "node_id": "IC_kwDOABII585gHP4F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1612512773",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T06:49:37Z",
      "updated_at": "2023-06-29T06:49:37Z",
      "author_association": "MEMBER",
      "body": "Looks like the fuzz target doesn't compile on windows?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1612512773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9677639145,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJA1Q3p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9677639145",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T14:21:48Z"
    },
    {
      "event": "unlabeled",
      "id": 9678840790,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJA52PW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9678840790",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T15:48:49Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1506063580,
      "node_id": "PRR_kwDOABII585ZxLTc",
      "url": null,
      "actor": null,
      "commit_id": "5b3573e201863cf22cf04597a346a027cb685a13",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1506063580",
      "submitted_at": "2023-06-29T20:22:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9681601557,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJBEYQV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9681601557",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T21:02:10Z"
    },
    {
      "event": "reviewed",
      "id": 1506562478,
      "node_id": "PRR_kwDOABII585ZzFGu",
      "url": null,
      "actor": null,
      "commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "(nit)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1506562478",
      "submitted_at": "2023-06-30T06:02:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1506898105,
      "node_id": "PRR_kwDOABII585Z0XC5",
      "url": null,
      "actor": null,
      "commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1506898105",
      "submitted_at": "2023-06-30T09:58:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1507168279,
      "node_id": "PRR_kwDOABII585Z1ZAX",
      "url": null,
      "actor": null,
      "commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1507168279",
      "submitted_at": "2023-06-30T13:19:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9689273500,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJBhpSc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9689273500",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T15:43:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9691244776,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJBpKjo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9691244776",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T19:32:56Z"
    },
    {
      "event": "labeled",
      "id": 9691245373,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJBpKs9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9691245373",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T19:33:01Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-12T22:36:08Z",
      "updated_at": "2023-07-12T22:36:08Z",
      "source": {
        "issue": {
          "id": 1796477777,
          "node_id": "PR_kwDOABII585VEjNn",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28060",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28060/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28060/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28060/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28060",
          "number": 28060,
          "state": "closed",
          "state_reason": null,
          "title": "util: Teach AutoFile how to XOR",
          "body": "This allows `AutoFile` to roll an XOR pattern while reading or writing to the underlying file.\r\n\r\nThis is needed for https://github.com/bitcoin/bitcoin/pull/28052, but can also be used in any other place.\r\n\r\nAlso, there are tests, so I've split this up from the larger pull to make review easier, hopefully.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 14,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28060",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28060",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28060.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28060.patch"
          },
          "closed_at": "2023-08-01T15:38:17Z",
          "created_at": "2023-07-10T10:39:12Z",
          "updated_at": "2023-08-01T16:53:17Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-12T22:48:16Z",
      "updated_at": "2023-07-12T22:48:16Z",
      "source": {
        "issue": {
          "id": 1794835202,
          "node_id": "PR_kwDOABII585U_Njk",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28052",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28052/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28052/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28052/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28052",
          "number": 28052,
          "state": "open",
          "state_reason": null,
          "title": "blockstorage: XOR blocksdir *.dat files",
          "body": "Currently the *.dat files in the blocksdir store the data received from remote peers as-is. This may be problematic when a program other than Bitcoin Core tries to interpret them by accident. For example, an anti-virus program or other program may scan them and move them into quarantine, or delete them, or corrupt them. This may cause Bitcoin Core to fail a reorg, or fail to reply to block requests (via P2P, RPC, REST, ...).\r\n\r\nFix this, similar to https://github.com/bitcoin/bitcoin/pull/6650, by rolling a random XOR pattern over the dat files when writing or reading them.\r\n\r\nObviously this can only protect against programs that accidentally and unintentionally are trying to mess with the dat files. Any program that intentionally wants to mess with the dat files can still trivially do so.\r\n\r\nThe XOR pattern is only applied when the blocksdir is freshly created, and there is an option to disable it (on creation), so that people can disable it, if needed.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 219890555,
              "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
              "name": "Block storage",
              "color": "000000",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 20,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28052",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28052",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28052.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28052.patch"
          },
          "created_at": "2023-07-08T08:07:53Z",
          "updated_at": "2024-04-06T11:13:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9886313431,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJNRSvX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9886313431",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T15:02:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9886530740,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJNSHy0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9886530740",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T15:24:21Z"
    },
    {
      "event": "unlabeled",
      "id": 9888406255,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJNZRrv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9888406255",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T19:39:10Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-24T21:30:52Z",
      "updated_at": "2023-07-24T21:30:52Z",
      "source": {
        "issue": {
          "id": 1819164915,
          "node_id": "PR_kwDOEEET9c5WRXMV",
          "url": "https://api.github.com/repos/bitcoin-core/gui/issues/747",
          "repository_url": "https://api.github.com/repos/bitcoin-core/gui",
          "labels_url": "https://api.github.com/repos/bitcoin-core/gui/issues/747/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/gui/issues/747/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/gui/issues/747/events",
          "html_url": "https://github.com/bitcoin-core/gui/pull/747",
          "number": 747,
          "state": "closed",
          "state_reason": null,
          "title": "Open fully encrypted wallets",
          "body": "Allows users to open wallets with encrypted databases (https://github.com/bitcoin/bitcoin/pull/28142) from the GUI.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 2145506980,
              "node_id": "MDU6TGFiZWwyMTQ1NTA2OTgw",
              "url": "https://api.github.com/repos/bitcoin-core/gui/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 2927906211,
              "node_id": "MDU6TGFiZWwyOTI3OTA2MjEx",
              "url": "https://api.github.com/repos/bitcoin-core/gui/labels/Wallet",
              "name": "Wallet",
              "description": "",
              "color": "08a781",
              "default": false
            },
            {
              "id": 5353934559,
              "node_id": "LA_kwDOEEET9c8AAAABPx6O3w",
              "url": "https://api.github.com/repos/bitcoin-core/gui/labels/CI%20failed",
              "name": "CI failed",
              "color": "ededed",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/gui/pulls/747",
            "html_url": "https://github.com/bitcoin-core/gui/pull/747",
            "diff_url": "https://github.com/bitcoin-core/gui/pull/747.diff",
            "patch_url": "https://github.com/bitcoin-core/gui/pull/747.patch"
          },
          "closed_at": "2024-01-08T15:51:41Z",
          "created_at": "2023-07-24T21:21:21Z",
          "updated_at": "2024-01-08T15:51:41Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-24T22:28:44Z",
      "updated_at": "2023-07-24T22:28:44Z",
      "source": {
        "issue": {
          "id": 1819155354,
          "node_id": "PR_kwDOABII585WRVWj",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28142",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28142/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28142/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28142/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28142",
          "number": 28142,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: Allow users to create a wallet that encrypts all database records",
          "body": "A couple of users have requested that we support wallets that encrypt everything, even if the wallet is watch-only, in order to have better privacy if the wallet is stolen. This PR introduces an `EncryptedDatabase` backend for the wallet which encrypts/decrypts each key-value record individually before reading from or writing to the database.\r\n\r\n`EncryptedDatabase` is only supported for SQLite databases and descriptor wallets. This was done in order to have an easier way to get downgrade protection that also does not involve writing an existing record in plaintext (e.g. `minversion` or `flags`). SQLite has a fixed field \"application id\" that we already use for cross-network protection. This is reused to detect if a sqlite database is an encrypted wallet, and thus it prevents older software from attempting to open such wallets.\r\n\r\nIn order to read records from the database, `EncryptedDatabase` will cache the decrypted key in memory so that it can lookup the encrypted key in the database. Values will always be decrypted when read.\r\n\r\nThe encryption scheme is the same one that we use for encrypting private keys. It's not that great, but I didn't feel like re-implementing it, and it seems good enough. The encryption key itself is encrypted with the passphrase and stored in a new record.\r\n\r\nWallets with encrypted databases cannot be loaded on start. They can only be loaded by explicit user action through `loadwallet` which now has a `db_passphrase` parameter to allow the decryption of these wallets. `createwallet` also has a `db_passphrase` to create these wallets. For now, there is no way to encrypt the database after it has been created, nor is there a way to change the passphrase.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 749416508,
              "node_id": "MDU6TGFiZWw3NDk0MTY1MDg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Up%20for%20grabs",
              "name": "Up for grabs",
              "color": "99a810",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28142",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28142",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28142.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28142.patch"
          },
          "closed_at": "2024-01-06T00:03:50Z",
          "created_at": "2023-07-24T21:15:15Z",
          "updated_at": "2024-01-06T02:17:55Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1546251193,
      "node_id": "PRR_kwDOABII585cKeu5",
      "url": null,
      "actor": null,
      "commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 6e28ff97a99519ec8b50123bc1177084bba68f96 (besides the two small comments)\r\n\r\nI'm sure I could spend many hours more verifying the parser, but at this point I'd like to encourage other reviewers to take a look. I think if this is merged soon and given the opportunity to be fuzzed against a large corpus of both random seeds, bdb databases, and valid wallets we could also gain some confidence in the code.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1546251193",
      "submitted_at": "2023-07-25T19:58:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-26T00:00:45Z",
      "updated_at": "2023-07-26T00:00:45Z",
      "source": {
        "issue": {
          "id": 1821055554,
          "node_id": "PR_kwDOABII585WXzPh",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28153",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28153/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28153/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28153/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28153",
          "number": 28153,
          "state": "closed",
          "state_reason": null,
          "title": "fuzz: add target for `ScriptPubKeyMan` (legacy)",
          "body": "This PR adds target for `{Legacy}ScriptPubKeyMan`. I'm working on a descriptor one and will do it in a separate file. I tried to focus here on functions that we use directly and we may have in some unit tests.",
          "user": {
            "login": "brunoerg",
            "id": 19480819,
            "node_id": "MDQ6VXNlcjE5NDgwODE5",
            "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/brunoerg",
            "html_url": "https://github.com/brunoerg",
            "followers_url": "https://api.github.com/users/brunoerg/followers",
            "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
            "organizations_url": "https://api.github.com/users/brunoerg/orgs",
            "repos_url": "https://api.github.com/users/brunoerg/repos",
            "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/brunoerg/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28153",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28153",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28153.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28153.patch"
          },
          "closed_at": "2023-09-20T17:19:01Z",
          "created_at": "2023-07-25T20:03:44Z",
          "updated_at": "2023-09-21T08:57:13Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1658468351,
      "node_id": "IC_kwDOABII585i2jf_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1658468351",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-31T14:20:44Z",
      "updated_at": "2023-07-31T15:19:21Z",
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nI still suggest changing fc810c1df899e5b42fe7658ebdddc6b4320240a6 so that `dumpwallet` does not use the read-only format by default, and instead change the tests use it. ~However with the new fuzz target commit I'm less worried about it.~\r\n\r\nThe new fuzz target helps, but currently doesn't compare between BDB and the RO implementation. I'm also not sure how to see if we're covering all code paths. Should we manually produce some wallets to bootstrap a good corpus or is the fuzzer smart enough to find it?",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1658468351",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "reviewed",
      "id": 1555022636,
      "node_id": "PRR_kwDOABII585cr8Ms",
      "url": null,
      "actor": null,
      "commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1555022636",
      "submitted_at": "2023-07-31T15:07:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1555052889,
      "node_id": "PRR_kwDOABII585csDlZ",
      "url": null,
      "actor": null,
      "commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1555052889",
      "submitted_at": "2023-07-31T15:14:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T10:30:13Z",
      "updated_at": "2023-08-01T10:30:13Z",
      "source": {
        "issue": {
          "id": 1830961918,
          "node_id": "PR_kwDOCgmu_85W5KZB",
          "url": "https://api.github.com/repos/bitcoin-core/qa-assets/issues/140",
          "repository_url": "https://api.github.com/repos/bitcoin-core/qa-assets",
          "labels_url": "https://api.github.com/repos/bitcoin-core/qa-assets/issues/140/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/qa-assets/issues/140/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/qa-assets/issues/140/events",
          "html_url": "https://github.com/bitcoin-core/qa-assets/pull/140",
          "number": 140,
          "state": "open",
          "state_reason": null,
          "title": "Add initial wallet_bdb_parser corpus",
          "body": "Generated on Ubuntu 23.04 using Clang 15.0.7 and libFuzzer\r\n`--with-sanitizers=fuzzer`\r\n\r\nGenerated by running the wallet_bdb_parser target in https://github.com/bitcoin/bitcoin/pull/26606 for about a day on AMD Ryzen 9 7950X.\r\n\r\nI used `test/fuzz/test_runner.py --m_dir` which reduced the inputs from 1210 (200KB) to 116 (2 KB).\r\n\r\nI wonder if it makes sense to manually generate some inputs based on real (testnet) wallets.",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/qa-assets/pulls/140",
            "html_url": "https://github.com/bitcoin-core/qa-assets/pull/140",
            "diff_url": "https://github.com/bitcoin-core/qa-assets/pull/140.diff",
            "patch_url": "https://github.com/bitcoin-core/qa-assets/pull/140.patch"
          },
          "created_at": "2023-08-01T10:30:13Z",
          "updated_at": "2023-08-03T08:55:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 9979202613,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJSzow1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9979202613",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T17:11:29Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9980401496,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJS4NdY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9980401496",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T19:30:43Z"
    },
    {
      "event": "commented",
      "id": 1660955989,
      "node_id": "IC_kwDOABII585jAC1V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660955989",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T19:32:09Z",
      "updated_at": "2023-08-01T19:32:09Z",
      "author_association": "MEMBER",
      "body": "> I still suggest changing fc810c1 so that dumpwallet does not use the read-only format by default, and instead change the tests use it.\r\n\r\nSince dumping should be a read-only operation, I think it's better to use the read-only database since it definitely won't write to it like BDB does. Also it provides a good mechanism for testing.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1660955989",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 9981257632,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJS7eeg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9981257632",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T21:19:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9981262888,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJS7fwo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9981262888",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T21:19:47Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1558219665,
      "node_id": "PRR_kwDOABII585c4IuR",
      "url": null,
      "actor": null,
      "commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Looks like CI is red?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1558219665",
      "submitted_at": "2023-08-02T05:26:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1558223099,
      "node_id": "PRR_kwDOABII585c4Jj7",
      "url": null,
      "actor": null,
      "commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1558223099",
      "submitted_at": "2023-08-02T05:30:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "commented",
      "id": 1662535127,
      "node_id": "IC_kwDOABII585jGEXX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1662535127",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T16:25:06Z",
      "updated_at": "2023-08-02T16:25:06Z",
      "author_association": "MEMBER",
      "body": "> Since dumping should be a read-only operation, I think it's better to use the read-only database since it definitely won't write to it like BDB does.\r\n\r\nBut it could produce a corrupt dump, which someone might rely on for their backup (even if they shouldn't).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1662535127",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "reviewed",
      "id": 1559482876,
      "node_id": "PRR_kwDOABII585c89H8",
      "url": null,
      "actor": null,
      "commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1559482876",
      "submitted_at": "2023-08-02T17:05:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9990671911,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJTfY4n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9990671911",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T17:29:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9990677475,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJTfaPj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9990677475",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T17:29:52Z"
    },
    {
      "event": "commented",
      "id": 1662720996,
      "node_id": "IC_kwDOABII585jGxvk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1662720996",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T18:14:33Z",
      "updated_at": "2023-08-02T18:15:10Z",
      "author_association": "MEMBER",
      "body": "I tried adding `if (bdb_ro_err) return;` above `#ifdef USE_BDB` (although that does reduce coverage of potentially valid wallets). I also added in the second catch:\r\n\r\n```cpp\r\n// We are not interested in fuzzing the original BDB implementation\r\nif (std::string(e.what()) == \"BerkeleyDatabase: Error 22, can't open database fuzzed_wallet.dat\") return;\r\n```\r\n\r\nThat helps a bit, but still leads to a \"SEGV on unknown address 0x000000000000\" in `DumpWallet` very quickly. I haven't looked at what the fuzzer came up with. Perhaps it can be dealt with by making the RO parser more strict?\r\n\r\nOr can we tell the fuzzer to ignore crashes in the original BDB entirely? We only care about comparing dumps for wallets that the original implementation can load.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1662720996",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "unlabeled",
      "id": 9992057578,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJTkrLq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9992057578",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T20:19:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9992075014,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJTkvcG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9992075014",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T20:20:40Z"
    },
    {
      "event": "commented",
      "id": 1662918852,
      "node_id": "IC_kwDOABII585jHiDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1662918852",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T20:22:18Z",
      "updated_at": "2023-08-02T20:22:18Z",
      "author_association": "MEMBER",
      "body": "I've fixed at least one fuzzer crash. BDB verifies a couple of other things that RO was not.\r\n\r\nI also changed the fuzzer to make sure that BDB fails to open the database if RO failed to open it, and vice versa.\r\n\r\nThere's still another crash that I have, but it's something where RO is being stricter than BDB.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1662918852",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 9992811235,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJTnjLj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9992811235",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T22:16:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9993173061,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJTo7hF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9993173061",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-02T23:41:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9993256086,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJTpPyW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9993256086",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T00:03:25Z"
    },
    {
      "event": "unlabeled",
      "id": 9994278823,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJTtJen",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9994278823",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T04:24:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1663560293,
      "node_id": "IC_kwDOABII585jJ-pl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1663560293",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T08:50:37Z",
      "updated_at": "2023-08-03T08:50:37Z",
      "author_association": "MEMBER",
      "body": "> There's still another crash that I have\r\n\r\nNot sure if that was fixed in your later push, but in any case, I pushed another crash to the qa-assets PR.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1663560293",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "reviewed",
      "id": 1560573265,
      "node_id": "PRR_kwDOABII585dBHVR",
      "url": null,
      "actor": null,
      "commit_id": "a7508fedcb529324bb1009455151800138e09022",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "(nits only)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1560573265",
      "submitted_at": "2023-08-03T08:56:18Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10000977298,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJUGs2S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10000977298",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T16:24:38Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10000983551,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJUGuX_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10000983551",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T16:25:20Z"
    },
    {
      "event": "commented",
      "id": 1664282446,
      "node_id": "IC_kwDOABII585jMu9O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1664282446",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T16:26:07Z",
      "updated_at": "2023-08-03T16:26:32Z",
      "author_association": "MEMBER",
      "body": "> But it could produce a corrupt dump, which someone might rely on for their backup (even if they shouldn't).\r\n\r\nI've changed it to be optional and enabled with the argument `-withinternalbdb`.\r\n\r\n> Not sure if that was fixed in your later push, but in any case,\r\n\r\nYes, I fixed that\r\n\r\n> I pushed another crash to the qa-assets PR.\r\n\r\nThis seems to be crash in BDB itself rather than in our parser. Not entirely sure how to handle that since we don't care about fuzzing BDB itself.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1664282446",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1664347932,
      "node_id": "IC_kwDOABII585jM-8c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1664347932",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T17:15:21Z",
      "updated_at": "2023-08-03T17:15:21Z",
      "author_association": "MEMBER",
      "body": "> Not entirely sure how to handle that since we don't care about fuzzing BDB itself.\r\n\r\nIndeed, @MarcoFalke any idea on how to make the fuzzer ignore that?",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1664347932",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "mentioned",
      "id": 10001410697,
      "node_id": "MEE_lADOABII585Xi1euzwAAAAJUIWqJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10001410697",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T17:15:22Z"
    },
    {
      "event": "subscribed",
      "id": 10001410718,
      "node_id": "SE_lADOABII585Xi1euzwAAAAJUIWqe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10001410718",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-03T17:15:22Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-08T08:43:25Z",
      "updated_at": "2023-08-08T08:43:25Z",
      "source": {
        "issue": {
          "id": 1840228464,
          "node_id": "PR_kwDOABII585XYF9P",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28236",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28236/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28236/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28236/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28236",
          "number": 28236,
          "state": "open",
          "state_reason": null,
          "title": "fuzz: wallet, add target for Spend",
          "body": "This PR adds fuzz coverage for `wallet/spend`.\r\n\r\nMotivation: Issue [27272](https://github.com/bitcoin/bitcoin/issues/27272#issue-1628327906)\r\n\r\nThis PR adds FuzzÂ coverage toÂ the wholeÂ conceptÂ of Creating a New Transaction as well as other sections of the Spend file.  Because `CreateTransaction` is one of the most frequently used functionsÂ in the wallet codebase, merging this PR will significantly improve the wallet codebase's Fuzz testing!\r\n\r\nI also used the `Singleton Class` concept for creating Wallet instances because it assures that only one instance of it is created during all Fuzz runs, which significantly boosts the file's `exec/sec`.\r\n",
          "user": {
            "login": "Ayush170-Future",
            "id": 76209654,
            "node_id": "MDQ6VXNlcjc2MjA5NjU0",
            "avatar_url": "https://avatars.githubusercontent.com/u/76209654?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Ayush170-Future",
            "html_url": "https://github.com/Ayush170-Future",
            "followers_url": "https://api.github.com/users/Ayush170-Future/followers",
            "following_url": "https://api.github.com/users/Ayush170-Future/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Ayush170-Future/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Ayush170-Future/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Ayush170-Future/subscriptions",
            "organizations_url": "https://api.github.com/users/Ayush170-Future/orgs",
            "repos_url": "https://api.github.com/users/Ayush170-Future/repos",
            "events_url": "https://api.github.com/users/Ayush170-Future/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Ayush170-Future/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28236",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28236",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28236.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28236.patch"
          },
          "created_at": "2023-08-07T21:25:27Z",
          "updated_at": "2024-04-23T07:49:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1669359482,
      "node_id": "IC_kwDOABII585jgGd6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669359482",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-08T10:33:25Z",
      "updated_at": "2023-08-08T10:33:25Z",
      "author_association": "MEMBER",
      "body": "Can you give more context? What are the steps to reproduce? My understanding is that the fuzz CI tasks don't install and use bdb. And you can put a comment in the fuzz test to document that running this with bdb can be done at the users own risk. Outside of that, my recommendations would be to use bdb-5.3, which fixed a few bugs (or maybe it is possible to use an even later version, just for fuzzing?).",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1669359482",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 10391004592,
      "node_id": "LE_lADOABII585Xi1euzwAAAAJrWiWw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10391004592",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-17T08:35:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10489383912,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJxN0vo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10489383912",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-27T15:46:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10489439584,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAJxOCVg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10489439584",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-27T15:51:23Z"
    },
    {
      "event": "unlabeled",
      "id": 10497135130,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAJxrZIa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10497135130",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-28T09:57:37Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T02:47:03Z",
      "updated_at": "2023-10-24T02:47:03Z",
      "source": {
        "issue": {
          "id": 1958204865,
          "node_id": "PR_kwDOABII585dlfBo",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
          "number": 28710,
          "state": "open",
          "state_reason": null,
          "title": "Remove the legacy wallet and BDB dependency",
          "body": "The final step of #20160.\r\n\r\nA bare minimum of legacy wallet code is kept in order to perform wallet migration. Migration of legacy wallets uses the independent BDB parser and a minimal `LegacyDataSPKM` that allows the legacy data to be loaded so that the migration can be completed.\r\n\r\nAll tests which tested legacy wallet behavior have been removed. The `--descriptors` and `--legacy-wallet` options are removed from the functional tests.\r\n\r\nBDB has been removed as a dependency and documentation have been updated to reflect that.\r\n\r\nDepends on #26596",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28710",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28710.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28710.patch"
          },
          "created_at": "2023-10-23T23:36:07Z",
          "updated_at": "2024-04-09T10:26:31Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10756272210,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAKBH7BS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10756272210",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T16:07:19Z"
    },
    {
      "event": "labeled",
      "id": 10758833142,
      "node_id": "LE_lADOABII585Xi1euzwAAAAKBRsP2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10758833142",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T20:09:15Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 10773102601,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAKCIIAJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10773102601",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T22:54:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1713893741,
      "node_id": "PRR_kwDOABII585mJ_Ft",
      "url": null,
      "actor": null,
      "commit_id": "43d7ec1bb78c1dcfde9ca982e07fb0e51c088dce",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nAs a follow-up, it might be nice if we could somehow add coverage for the \"other endianness\" code path in the tests. Did that manually with the following patch (creates the BDB database in big-endian format, while I'm running a little-endian system):\r\n```diff\r\ndiff --git a/src/wallet/bdb.cpp b/src/wallet/bdb.cpp\r\nindex 9ea43ca67c..945e12ebdb 100644\r\n--- a/src/wallet/bdb.cpp\r\n+++ b/src/wallet/bdb.cpp\r\n@@ -389,6 +389,7 @@ void BerkeleyDatabase::Open()\r\n                 }\r\n             }\r\n \r\n+            pdb_temp->set_lorder(4321);\r\n             ret = pdb_temp->open(nullptr,                             // Txn pointer\r\n                             fMockDb ? nullptr : strFile.c_str(),      // Filename\r\n                             fMockDb ? strFile.c_str() : \"main\",       // Logical db name\r\n```\r\nTests still passed, only had to adapt the BDB magic number check in wallet_migration.py which currently assumes LE byte order.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1713893741",
      "submitted_at": "2023-11-05T01:15:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "commented",
      "id": 1794248918,
      "node_id": "IC_kwDOABII585q8hDW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1794248918",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T07:50:26Z",
      "updated_at": "2023-11-06T07:50:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1669359482\r\n\r\n> What are the steps to reproduce?\r\n\r\nRun the fuzzer on the fuzz test introduced in this PR seeded with Sjors' inputs from his [qa repo PR](https://github.com/bitcoin-core/qa-assets/pull/140) and compiled with bdb enabled.\r\n\r\n> Outside of that, my recommendations would be to use bdb-5.3\r\n\r\nThe bugs persist even with bdb 5.3.\r\n\r\n",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1794248918",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 1794381260,
      "node_id": "IC_kwDOABII585q9BXM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1794381260",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-06T09:16:15Z",
      "updated_at": "2023-11-06T09:16:15Z",
      "author_association": "MEMBER",
      "body": "Ok, but then I think this is a problem for the qa-assets repo to solve. As I said, BDB is not enabled in the fuzz CI, so this shouldn't cause CI issues.\r\n\r\nOne way for qa-assets to solve this would be to exclude inputs that crash bdb.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1794381260",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10948203494,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAKMkFPm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10948203494",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-13T23:41:53Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11085822937,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAKUxDvZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11085822937",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-28T16:15:07Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-13T13:08:39Z",
      "updated_at": "2023-12-13T13:08:39Z",
      "source": {
        "issue": {
          "id": 2039458902,
          "node_id": "PR_kwDOABII585h4izR",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29071",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29071/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29071/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29071/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29071",
          "number": 29071,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Remove Span operator==, Use std::ranges::equal",
          "body": "`std::span` removed the comparison operators, so it makes sense to remove them for the `Span` \"backport\" as well. Using `std::ranges::equal` also has the benefit that some `Span` temporary constructions can now be dropped.\r\n\r\nThis is required to move from `Span` toward `std::span`.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29071",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29071",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29071.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29071.patch"
          },
          "created_at": "2023-12-13T10:58:46Z",
          "updated_at": "2024-04-23T05:41:25Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1782050983,
      "node_id": "PRR_kwDOABII585qN_Cn",
      "url": null,
      "actor": null,
      "commit_id": "3c91202c5a03c57c9f83186de9d3caf337b78d45",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Re-ACK 3c91202c5a03c57c9f83186de9d3caf337b78d45",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1782050983",
      "submitted_at": "2023-12-14T16:54:08Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "review_requested",
      "id": 11250541116,
      "node_id": "RRE_lADOABII585Xi1euzwAAAAKelaI8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11250541116",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-14T16:54:14Z",
      "requested_reviewer": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 11250541312,
      "node_id": "RRE_lADOABII585Xi1euzwAAAAKelaMA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11250541312",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-14T16:54:14Z",
      "requested_reviewer": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 11250541464,
      "node_id": "RRE_lADOABII585Xi1euzwAAAAKelaOY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11250541464",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-14T16:54:15Z",
      "requested_reviewer": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-19T23:39:57Z",
      "updated_at": "2023-12-19T23:39:57Z",
      "source": {
        "issue": {
          "id": 2049508623,
          "node_id": "PR_kwDOABII585iamOH",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29117/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29117",
          "number": 29117,
          "state": "closed",
          "state_reason": null,
          "title": "wallettool: Always be able to dump a wallet's database",
          "body": "https://github.com/bitcoin/bitcoin/issues/29109#issuecomment-1863449058 reports that a wallet with noncritical errors cannot be dumped with `bitcoin-wallet dump`. This was caused by an erroneous reset of the wallet pointer when the loading the wallet returns something other than `LOAD_OK`. Not all errors are errors that require aborting, so unilaterally resetting the pointer at that time is incorrect. The first commit resolves this issue.\r\n\r\nFurthermore, if a wallet has loading errors, that should not prevent the wallet tool from dumping the wallet. The wallet application logic should not get in the way of performing such a low level database operation, especially when it's primary usage is for debugging potentially corrupted wallets. The 2nd commit is taken from #28710 and changes the `dump` to stop at making a `WalletDatabase` rather than making a `CWallet` only to retrieve the underlying `WalletDatabase`.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29117",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29117",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29117.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29117.patch"
          },
          "closed_at": "2024-01-05T17:40:50Z",
          "created_at": "2023-12-19T22:05:19Z",
          "updated_at": "2024-01-05T17:40:50Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-20T06:12:09Z",
      "updated_at": "2023-12-20T06:12:09Z",
      "source": {
        "issue": {
          "id": 2049590379,
          "node_id": "PR_kwDOABII585ia4AQ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29119",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29119/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29119/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29119/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29119",
          "number": 29119,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Use std::span over Span",
          "body": "`std::span` allows static extents, which is a nice benefit over just `Span`.\r\n\r\nHowever, the interface of the two isn't identical and requires some more changes than just defining an alias. This is my current draft to *compile* with `std::span`. This should be the minimal changes required to get a green CI, but the changes may not be ideal, so this remains a draft.\r\n\r\nAlso, this requires and is based on #29071, which is blocked on OSS-Fuzz.\r\n\r\nIn the meantime, changes that make sense on their own, can be split up.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29119",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29119",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29119.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29119.patch"
          },
          "created_at": "2023-12-19T23:36:52Z",
          "updated_at": "2024-02-26T12:26:47Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11374033954,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAKl8fwi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11374033954",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-02T21:36:41Z"
    },
    {
      "event": "labeled",
      "id": 11404102912,
      "node_id": "LE_lADOABII585Xi1euzwAAAAKnvM0A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11404102912",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T18:33:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11406039561,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAKn2loJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11406039561",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T23:34:16Z"
    },
    {
      "event": "unlabeled",
      "id": 11406453687,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAKn4Ku3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11406453687",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-06T00:49:06Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 11478917470,
      "node_id": "LE_lADOABII585Xi1euzwAAAAKsMmFe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11478917470",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-13T20:52:10Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11674867330,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAK34FaC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11674867330",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-01T19:29:52Z"
    },
    {
      "event": "unlabeled",
      "id": 11677158468,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAK4A0xE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11677158468",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-01T23:36:51Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-03T20:13:18Z",
      "updated_at": "2024-02-03T20:13:18Z",
      "source": {
        "issue": {
          "id": 2116557543,
          "node_id": "PR_kwDOABII585l61fV",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29375",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29375/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29375/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29375/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29375",
          "number": 29375,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: remove unused 'accept_no_keys' arg from decryption process",
          "body": "Found it while reviewing other PR. Couldn't contain myself from cleaning it up.\r\n\r\nThe wallet decryption process (`CheckDecryptionKey()` and `Unlock()`)\r\ncontains an arg 'accept_no_keys,' introduced in #13926, that has\r\nnever been used.\r\nAdditionally, this also removes the unimplemented `SplitWalletPath`\r\nfunction.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29375",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29375",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29375.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29375.patch"
          },
          "closed_at": "2024-02-06T18:03:06Z",
          "created_at": "2024-02-03T16:06:18Z",
          "updated_at": "2024-02-06T18:08:29Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 11722235400,
      "node_id": "LE_lADOABII585Xi1euzwAAAAK6sx4I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11722235400",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-06T18:06:54Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11751754880,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAAK8dYyA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11751754880",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T22:04:45Z"
    },
    {
      "event": "unlabeled",
      "id": 11752347881,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAAK8fpjp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11752347881",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T23:34:29Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 11838142820,
      "node_id": "LE_lADOABII585Xi1euzwAAAALBm7lk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11838142820",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-18T06:04:26Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11865127625,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALDN3rJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11865127625",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-20T17:28:17Z"
    },
    {
      "event": "unlabeled",
      "id": 11868058394,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAALDZDMa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11868058394",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-20T22:19:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 11946965266,
      "node_id": "LE_lADOABII585Xi1euzwAAAALIGDkS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11946965266",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-28T06:27:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1968316700,
      "node_id": "IC_kwDOABII5851UiEc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1968316700",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-28T06:27:04Z",
      "updated_at": "2024-02-28T06:27:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21780695174</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1968316700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11970748040,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALJgx6I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11970748040",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-29T19:48:04Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12075746252,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALPxUPM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12075746252",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T15:44:25Z"
    },
    {
      "event": "commented",
      "id": 1988755857,
      "node_id": "IC_kwDOABII5852igGR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1988755857",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T15:44:58Z",
      "updated_at": "2024-03-11T15:44:58Z",
      "author_association": "MEMBER",
      "body": "Rebased for silent merge conflict",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-1988755857",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12078312963,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALP7G4D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12078312963",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T18:30:12Z"
    },
    {
      "event": "unlabeled",
      "id": 12082792847,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAALQMMmP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12082792847",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-12T04:08:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhMThhZWE1YzQ5NzVhY2U0ZTMwN2JlOTZjNzQ2NDFkMjAzZmEzODk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca18aea5c4975ace4e307be96c74641d203fa389",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca18aea5c4975ace4e307be96c74641d203fa389",
      "tree": {
        "sha": "af1fb649f9f10893d7a17f84369f973d40b7fa48",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/af1fb649f9f10893d7a17f84369f973d40b7fa48"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/23ba39470c3d155a65f0616f8848ada730658301",
          "sha": "23ba39470c3d155a65f0616f8848ada730658301",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/23ba39470c3d155a65f0616f8848ada730658301"
        }
      ],
      "message": "Add AutoFile::seek and tell\n\nIt's useful to be able to seek to a specific position in a file. Allow\nAutoFile to seek by using fseek.\n\nIt's also useful to be able to get the current position in a file.\nAllow AutoFile to tell by using ftell.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-01T18:37:24Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:34:50Z"
      },
      "sha": "ca18aea5c4975ace4e307be96c74641d203fa389"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE1MjRhODdiNGY0NTBhM2JlNjEyOGMwNmVjNGI3NjFkNDc1MWJjYzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a524a87b4f450a3be6128c06ec4b761d4751bcc4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a524a87b4f450a3be6128c06ec4b761d4751bcc4",
      "tree": {
        "sha": "3b9a6b80fb49532334de1d49a9a7a18d31576c0a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3b9a6b80fb49532334de1d49a9a7a18d31576c0a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca18aea5c4975ace4e307be96c74641d203fa389",
          "sha": "ca18aea5c4975ace4e307be96c74641d203fa389",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ca18aea5c4975ace4e307be96c74641d203fa389"
        }
      ],
      "message": "wallet: add dummy BerkeleyRODatabase and BerkeleyROBatch classes\n\nBerkeleyRODatabase and BerkeleyROBatch will be used to access a BDB file\nwithout the use of BDB. For now, these are dummy classes.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-01T18:37:24Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:35:07Z"
      },
      "sha": "a524a87b4f450a3be6128c06ec4b761d4751bcc4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhMDliMTFkOWZiOTRhY2Y4ZTE0NmNjYjVmM2I2ZGUxNzU4YzIxYzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1",
      "tree": {
        "sha": "5215b9e005b57078dd99c44705ab84c6e2d0bcc7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5215b9e005b57078dd99c44705ab84c6e2d0bcc7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a524a87b4f450a3be6128c06ec4b761d4751bcc4",
          "sha": "a524a87b4f450a3be6128c06ec4b761d4751bcc4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a524a87b4f450a3be6128c06ec4b761d4751bcc4"
        }
      ],
      "message": "wallet: implement BerkeleyROBatch\n\nImplement ReadKey and HasKey of BerkeleyROBatch, and Next of BerkeleyROCursor.\nAlso adds the containers for records to BerkeleyRODatabase so that\nBerkeleyROBatch will be able to access the records.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-01T18:37:24Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:35:22Z"
      },
      "sha": "ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEwYjRjMWI3YTNiZmVhZWFlMDI3N2ZlMTUxY2Q1ZWY5YjMxY2NmMTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
      "tree": {
        "sha": "fd84c080ff7096bc024e9b0645c8b5c86e91b600",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fd84c080ff7096bc024e9b0645c8b5c86e91b600"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1",
          "sha": "ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ca09b11d9fb94acf8e146ccb5f3b6de1758c21c1"
        }
      ],
      "message": "wallet: implement BerkeleyRODatabase::Backup",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-01T18:37:24Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:35:30Z"
      },
      "sha": "a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12314310753,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALd_Xhh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12314310753",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-01T18:37:29Z"
    },
    {
      "event": "labeled",
      "id": 12317717020,
      "node_id": "LE_lADOABII585Xi1euzwAAAALeMXIc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12317717020",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-02T00:55:07Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 12368390083,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAALhNqfD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12368390083",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-05T06:10:00Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1988863282,
      "node_id": "PRR_kwDOABII5852i6Uy",
      "url": null,
      "actor": null,
      "commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1988863282",
      "submitted_at": "2024-04-09T12:04:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1988887021,
      "node_id": "PRR_kwDOABII5852jAHt",
      "url": null,
      "actor": null,
      "commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1988887021",
      "submitted_at": "2024-04-09T12:16:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1988953662,
      "node_id": "PRR_kwDOABII5852jQY-",
      "url": null,
      "actor": null,
      "commit_id": "7707db3ad536e84a92f424272f6bb0fdc361a0b1",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1988953662",
      "submitted_at": "2024-04-09T12:49:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 1988976956,
      "node_id": "PRR_kwDOABII5852jWE8",
      "url": null,
      "actor": null,
      "commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-1988976956",
      "submitted_at": "2024-04-09T12:59:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "commented",
      "id": 2057202451,
      "node_id": "IC_kwDOABII5856nmsT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2057202451",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T15:59:29Z",
      "updated_at": "2024-04-15T15:59:29Z",
      "author_association": "MEMBER",
      "body": "i tried some old wallets, and there was a problem with parsing the headers of overflow pages (which have btree level 0), the following makes the check pass and adds a further check that overflow records correspond to overflow pages:\r\n```patch\r\ndiff --git a/src/wallet/migrate.cpp b/src/wallet/migrate.cpp\r\nindex be54b58f67c9bc961f8df306fe4bc0bf810b41f3..1c4ce1c1ed8d44221626613df2cd0d4712fc5c85 100644\r\n--- a/src/wallet/migrate.cpp\r\n+++ b/src/wallet/migrate.cpp\r\n@@ -361,7 +361,7 @@ public:\r\n         if (expected_page_num != page_num) {\r\n             throw std::runtime_error(\"Page number mismatch\");\r\n         }\r\n-        if (level < 1) {\r\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\r\n             throw std::runtime_error(\"Bad btree level\");\r\n         }\r\n     }\r\n@@ -636,6 +636,9 @@ void BerkeleyRODatabase::Open()\r\n                         SeekToPage(db_file, next_page, page_size);\r\n                         PageHeader opage_header(next_page, inner_meta.other_endian);\r\n                         db_file >> opage_header;\r\n+                        if (opage_header.type != PageType::OVERFLOW_DATA) {\r\n+                            throw std::runtime_error(\"Bad overflow record page type\");\r\n+                        }\r\n                         OverflowPage opage(opage_header);\r\n                         db_file >> opage;\r\n                         data.insert(data.end(), opage.data.begin(), opage.data.end());\r\n```",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2057202451",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:20:43Z",
      "updated_at": "2024-04-15T19:20:43Z",
      "source": {
        "issue": {
          "id": 2244437486,
          "node_id": "I_kwDOABII586Fx2Xu",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29883",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29883/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29883/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29883/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/29883",
          "number": 29883,
          "state": "open",
          "state_reason": null,
          "title": "utils: wallet_dump can create a `database` directory, cross-pollinating records",
          "body": "### Is there an existing issue for this?\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Current behaviour\r\n\r\nI created a large directory with legacy wallet dat files for testing #26606. Ran into a weird issue where the output mismatches, but after investigating deeper, this was not due to a bug in that PR.\r\n\r\nSo I created a script that iterates over all wallets, dumps them with the internal bdb and external bdb, diffs the textual output, stopping on the first wallet which mismatches. Mind that the wallets are loose `.dat` files, not themselves subdirectories.\r\n```sh\r\n#!/bin/bash\r\nset -e\r\nDATADIR=\"$HOME/.../2024-04-testwallets\"\r\nfor WALLET in a.dat b.dat c.dat d.dat ...; do\r\n    echo $WALLET\r\n    rm -f /tmp/dump /tmp/dump2\r\n    src/bitcoin-wallet -datadir=\"$DATADIR\" -withinternalbdb -wallet=\"$WALLET\" -dumpfile=/tmp/dump dump\r\n    src/bitcoin-wallet -datadir=\"$DATADIR\" -wallet=\"$WALLET\" -dumpfile=/tmp/dump2 dump\r\n\r\n    diff -q /tmp/dump /tmp/dump2\r\n\r\n    ### Uncomment to following to make it work:\r\n    # rm -rf $DATADIR/database. \r\ndone\r\nrm -f /tmp/dump /tmp/dump2\r\n```\r\nSo far so good. \r\n\r\nHowever, I was seeing some huge divergences. Not small differences that could be explained to differences in interpretation, but e.g. the output would have wildly different `blockheight`. A kind of cross-pollination.\r\n\r\nWhat it turned out to be is that the `bitcoin-wallet dump` leaves behind a `database/` subdirectory on close containing log files (`log.0000000001` etc). When opening the next wallet in the same directory, this subdirectory is used, and affects the dumped contents of the new wallet.\r\n\r\nDeleting the `database` directory between wallets solves the problem. If this is still worth fixing, the wallet should probably compact after close to incorporate the log files. You wouldn't expect modification on a read-only operation in the first place, but I suppose this is due to an inherent bdb limitation.\r\n\r\n\r\n### Expected behaviour\r\n\r\nSuccessively dumped wallets don't affect each other.\r\n\r\n### Steps to reproduce\r\n\r\nSee script in \"current behavior\".\r\n\r\n### Relevant log output\r\n\r\n_No response_\r\n\r\n### How did you obtain Bitcoin Core\r\n\r\nCompiled from source\r\n\r\n### What version of Bitcoin Core are you using?\r\n\r\n7f8d4c963c6a12da0e8df462a3f25ccda4a39a62 (#26606)\r\n\r\n### Operating system and version\r\n\r\nUbuntu 24.04\r\n\r\n### Machine specifications\r\n\r\n_No response_",
          "user": {
            "login": "laanwj",
            "id": 126646,
            "node_id": "MDQ6VXNlcjEyNjY0Ng==",
            "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/laanwj",
            "html_url": "https://github.com/laanwj",
            "followers_url": "https://api.github.com/users/laanwj/followers",
            "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
            "organizations_url": "https://api.github.com/users/laanwj/orgs",
            "repos_url": "https://api.github.com/users/laanwj/repos",
            "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/laanwj/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 4,
          "created_at": "2024-04-15T19:20:43Z",
          "updated_at": "2024-04-16T06:21:02Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12476418932,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALnpwt0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12476418932",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:39:24Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12476526592,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALnqLAA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12476526592",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:47:44Z"
    },
    {
      "event": "labeled",
      "id": 12476527743,
      "node_id": "LE_lADOABII585Xi1euzwAAAALnqLR_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12476527743",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:47:49Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2057681921,
      "node_id": "IC_kwDOABII5856pbwB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2057681921",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:47:50Z",
      "updated_at": "2024-04-15T19:47:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/23845360026</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2057681921",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 2057691808,
      "node_id": "IC_kwDOABII5856peKg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2057691808",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T19:54:20Z",
      "updated_at": "2024-04-15T19:54:20Z",
      "author_association": "MEMBER",
      "body": "> parsing the headers of overflow pages (which have btree level 0)\r\n\r\nInteresting, did not know that they would use an invalid btree level. Fixed as suggested.\r\n\r\n***\r\n\r\nI've also commented out the enums that we do not use. I decided to leave them there for completeness, but they won't be used.\r\n\r\n***\r\n\r\nFor help with reviewing, I suggest looking at the BDB source code. I've uploaded a copy of the version that we use at https://github.com/achow101/bdb-sources/tree/main/4.8.30.NC. The files that I used for referencing and checking that things were implemented correctly are [`dbinc/db_page.h`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/dbinc/db_page.h), [`btree/bt_open.c`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/btree/bt_open.c), and [`btree/bt_put.c`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/btree/bt_put.c). That repo also has a couple of other BDB versions that people may have used for their wallets (except 18.x), so you may want to compare with those versions and check that the file format did not change between them.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2057691808",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 2057799622,
      "node_id": "IC_kwDOABII5856p4fG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2057799622",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-15T21:01:25Z",
      "updated_at": "2024-04-15T21:01:25Z",
      "author_association": "MEMBER",
      "body": "There was a comment at CoreDev that this should check that the file is compacted, so I've added a commit that does that. To check that this is correct, see the implementation of [`lsn_reset`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/db/db_setlsn.c#L114), which uses [`LSN_NOT_LOGGED`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/dbinc/db_int.in#L803). The definition of [`DB_LSN`](https://github.com/achow101/bdb-sources/blob/main/4.8.30.NC/dbinc/db.in#L444) is also useful.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2057799622",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 2058305830,
      "node_id": "IC_kwDOABII5856r0Em",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2058305830",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-16T06:13:18Z",
      "updated_at": "2024-04-16T06:13:18Z",
      "author_association": "MEMBER",
      "body": "> There was a comment at CoreDev that this should check that the file is compacted, so I've added a commit that does that.\r\n\r\nThat's good to have. It does look like the newly added check trips up in the CI in some places:\r\n```\r\nunknown location(0): fatal error: in \"db_tests/db_cursor_prefix_range_test\": class std::runtime_error: LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\r\n```",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2058305830",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "commented",
      "id": 2059220656,
      "node_id": "IC_kwDOABII5856vTaw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2059220656",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-16T14:22:52Z",
      "updated_at": "2024-04-16T14:22:52Z",
      "author_association": "MEMBER",
      "body": "> That's good to have. It does look like the newly added check trips up in the CI in some places:\r\n> \r\n> ```\r\n> unknown location(0): fatal error: in \"db_tests/db_cursor_prefix_range_test\": class std::runtime_error: LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\r\n> ```\r\n\r\nFixed",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2059220656",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12490791987,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALoglwz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12490791987",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-16T14:23:05Z"
    },
    {
      "event": "unlabeled",
      "id": 12493281930,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAALoqFqK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12493281930",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-16T16:49:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2004320891,
      "node_id": "PRR_kwDOABII5853d4J7",
      "url": null,
      "actor": null,
      "commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2004320891",
      "submitted_at": "2024-04-16T18:13:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 2004356721,
      "node_id": "PRR_kwDOABII5853eA5x",
      "url": null,
      "actor": null,
      "commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2004356721",
      "submitted_at": "2024-04-16T18:33:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 2004368521,
      "node_id": "PRR_kwDOABII5853eDyJ",
      "url": null,
      "actor": null,
      "commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2004368521",
      "submitted_at": "2024-04-16T18:41:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 2004421084,
      "node_id": "PRR_kwDOABII5853eQnc",
      "url": null,
      "actor": null,
      "commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2004421084",
      "submitted_at": "2024-04-16T19:11:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 2004443229,
      "node_id": "PRR_kwDOABII5853eWBd",
      "url": null,
      "actor": null,
      "commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2004443229",
      "submitted_at": "2024-04-16T19:24:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12496427058,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALo2Fgy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12496427058",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-16T20:43:14Z"
    },
    {
      "event": "commented",
      "id": 2063345481,
      "node_id": "IC_kwDOABII5856_CdJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2063345481",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-18T08:43:46Z",
      "updated_at": "2024-04-18T08:43:46Z",
      "author_association": "MEMBER",
      "body": "ACK f4f7eda0bf0e798d305df331c1d94443b81dff22\r\n\r\ni've extensively reviewed the code and tested `bitcoin-wallet  -withinternalbdb dump ...` on a fair number of historical wallet database backups, getting the exact same dump as BerkeleyDB, or in one case the \"LSNs are not reset\" error (because it wasn't cleanly closed at the time).\r\n\r\nThere are a lot of checks and i'm reasonably confident that this won't silently drop or corrupt any data (in one way safer than BDB: it truly opens read-only), instead fails when it sees something is outside expectations. It's of course possible some legit wallet will trigger an edge case exception, but that will only become evident after this reaches wider testing. As this doesn't remove the BerkeleyDB dependency yet, it's not something to be excessively worried about for this PR.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2063345481",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "review_requested",
      "id": 12519865979,
      "node_id": "RRE_lADOABII585Xi1euzwAAAALqPf57",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12519865979",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-18T08:43:53Z",
      "requested_reviewer": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 2013355543,
      "node_id": "PRR_kwDOABII5854AV4X",
      "url": null,
      "actor": null,
      "commit_id": "f4f7eda0bf0e798d305df331c1d94443b81dff22",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2013355543",
      "submitted_at": "2024-04-21T08:46:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "reviewed",
      "id": 2013358301,
      "node_id": "PRR_kwDOABII5854AWjd",
      "url": null,
      "actor": null,
      "commit_id": "a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2013358301",
      "submitted_at": "2024-04-21T09:03:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVmMGNkZGI0ZjY2ZjJhMTc0YmFiZGZiMTdiYzMxYTMwMTFlNWNjMjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f0cddb4f66f2a174babdfb17bc31a3011e5cc20",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5f0cddb4f66f2a174babdfb17bc31a3011e5cc20",
      "tree": {
        "sha": "ff5841eb8634619d0e76b658be0189c4f7a1ed95",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff5841eb8634619d0e76b658be0189c4f7a1ed95"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
          "sha": "a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15"
        }
      ],
      "message": "wallet: implement independent BDB deserializer in BerkeleyRODatabase\n\nBerkeleyRODatabase is intended for use after BDB is removed, so it needs\nto be able to read all of the records from a BDB file. Thus an\nindependent deserializer for BDB data files is implemented in it. This\ndeserializer is targeted towards the data files that Bitcoin Core\ncreates so it does not fully support all of BDB's features (e.g. other\ndatabase types, encryption, etc.).",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:35:37Z"
      },
      "sha": "5f0cddb4f66f2a174babdfb17bc31a3011e5cc20"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBlY2Q0MWFjNWUyOTBlYjQ4ZjYzN2ZhNDIwYmRlZmZmYmYxOTUzOGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ecd41ac5e290eb48f637fa420bdefffbf19538c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0ecd41ac5e290eb48f637fa420bdefffbf19538c",
      "tree": {
        "sha": "6f84b8135a86163abffc7bae906db3f8e895be9e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6f84b8135a86163abffc7bae906db3f8e895be9e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f0cddb4f66f2a174babdfb17bc31a3011e5cc20",
          "sha": "5f0cddb4f66f2a174babdfb17bc31a3011e5cc20",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5f0cddb4f66f2a174babdfb17bc31a3011e5cc20"
        }
      ],
      "message": "Implement handling of other endianness in BerkeleyRODatabase",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:35:50Z"
      },
      "sha": "0ecd41ac5e290eb48f637fa420bdefffbf19538c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFhZGVkZDhmN2QwYjAwZjg4OGU2NGYwNDJiYmVlNjEwN2RiMGIzNmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aadedd8f7d0b00f888e64f042bbee6107db0b36a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aadedd8f7d0b00f888e64f042bbee6107db0b36a",
      "tree": {
        "sha": "b9e67a5dafef8471b219600c3bca185f8d9fbceb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b9e67a5dafef8471b219600c3bca185f8d9fbceb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ecd41ac5e290eb48f637fa420bdefffbf19538c",
          "sha": "0ecd41ac5e290eb48f637fa420bdefffbf19538c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0ecd41ac5e290eb48f637fa420bdefffbf19538c"
        }
      ],
      "message": "Add MakeBerkeleyRODatabase\n\nImplements MakeBerkeleyRODatabase and adds DatabaseFormat::BERKELEY_RO\nso that MakeDatabase can use BerkeleyRO as the backend database.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:36:06Z"
      },
      "sha": "aadedd8f7d0b00f888e64f042bbee6107db0b36a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ4NzgyMjM3ZDBkNDNiNGFjYTk3MDg0MGZlMTYzM2JiOWVhZjk0MjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48782237d0d43b4aca970840fe1633bb9eaf9425",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/48782237d0d43b4aca970840fe1633bb9eaf9425",
      "tree": {
        "sha": "f666ea8d6b76e56681b20881bbe3d9a752d62ee4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f666ea8d6b76e56681b20881bbe3d9a752d62ee4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aadedd8f7d0b00f888e64f042bbee6107db0b36a",
          "sha": "aadedd8f7d0b00f888e64f042bbee6107db0b36a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aadedd8f7d0b00f888e64f042bbee6107db0b36a"
        }
      ],
      "message": "wallettool: Optionally use BERKELEY_RO as format when dumping BDB wallets\n\nIn order to ease the transition to not having BDB, make the dump tool\nuse DatabaseFormmat::BERKELEY_RO when -withinternalbdb is set.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:36:17Z"
      },
      "sha": "48782237d0d43b4aca970840fe1633bb9eaf9425"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNjYzc5NTdkOGNjNmM4MmQzNjRkMzkwZDVhNTQ1ZDM1NWMyMTAxZjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cc7957d8cc6c82d364d390d5a545d355c2101f8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3cc7957d8cc6c82d364d390d5a545d355c2101f8",
      "tree": {
        "sha": "78e7384d891c1fd66fa6ffa1202289ad21ead89a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/78e7384d891c1fd66fa6ffa1202289ad21ead89a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/48782237d0d43b4aca970840fe1633bb9eaf9425",
          "sha": "48782237d0d43b4aca970840fe1633bb9eaf9425",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/48782237d0d43b4aca970840fe1633bb9eaf9425"
        }
      ],
      "message": "tests: Add BerkeleyRO to db prefix tests",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-01-02T21:36:23Z"
      },
      "sha": "3cc7957d8cc6c82d364d390d5a545d355c2101f8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM3MDg0MDQyNzYzOTFiYmQ0M2Y4ZmFkNDk0Y2U2YjYyNThiYzIxOTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c708404276391bbd43f8fad494ce6b6258bc2197",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c708404276391bbd43f8fad494ce6b6258bc2197",
      "tree": {
        "sha": "ac1cd0a5cd41eb22a935d0ab522e87eafa2e4533",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ac1cd0a5cd41eb22a935d0ab522e87eafa2e4533"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3cc7957d8cc6c82d364d390d5a545d355c2101f8",
          "sha": "3cc7957d8cc6c82d364d390d5a545d355c2101f8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3cc7957d8cc6c82d364d390d5a545d355c2101f8"
        }
      ],
      "message": "Berkeley RO Database fuzz test",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2023-06-20T22:14:56Z"
      },
      "sha": "c708404276391bbd43f8fad494ce6b6258bc2197"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZlN2JiMjUyNTg1ZTQ3OTNkODA4NmQ1NDQzZDM2YWUzODQzYjY3MjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe7bb252585e4793d8086d5443d36ae3843b6724",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fe7bb252585e4793d8086d5443d36ae3843b6724",
      "tree": {
        "sha": "7e769e276512c86bc7736451d35bd850e2a3cdb4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7e769e276512c86bc7736451d35bd850e2a3cdb4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c708404276391bbd43f8fad494ce6b6258bc2197",
          "sha": "c708404276391bbd43f8fad494ce6b6258bc2197",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c708404276391bbd43f8fad494ce6b6258bc2197"
        }
      ],
      "message": "Error if LSNs are not reset",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-15T20:47:14Z"
      },
      "sha": "fe7bb252585e4793d8086d5443d36ae3843b6724"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBiNjcwMDM3ZDZiNzU4YmIyM2QzNjkzZTUzNGM2YTE3NGI4YjJiYzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0b670037d6b758bb23d3693e534c6a174b8b2bc7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0b670037d6b758bb23d3693e534c6a174b8b2bc7",
      "tree": {
        "sha": "b923e24984a0392e7cc52920be9bc37d56507816",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b923e24984a0392e7cc52920be9bc37d56507816"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe7bb252585e4793d8086d5443d36ae3843b6724",
          "sha": "fe7bb252585e4793d8086d5443d36ae3843b6724",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fe7bb252585e4793d8086d5443d36ae3843b6724"
        }
      ],
      "message": "bdb: Be able to make byteswapped databases",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T19:21:58Z"
      },
      "sha": "0b670037d6b758bb23d3693e534c6a174b8b2bc7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE3MWYzMmM1OTdmMjRiODc1N2ZiN2I2MDAwMjgzYjQ2ODc5OGIzOGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a71f32c597f24b8757fb7b6000283b468798b38b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a71f32c597f24b8757fb7b6000283b468798b38b",
      "tree": {
        "sha": "d82ad98237fd1e942bc8740b25326509f997eb5f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d82ad98237fd1e942bc8740b25326509f997eb5f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0b670037d6b758bb23d3693e534c6a174b8b2bc7",
          "sha": "0b670037d6b758bb23d3693e534c6a174b8b2bc7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0b670037d6b758bb23d3693e534c6a174b8b2bc7"
        }
      ],
      "message": "test: Test dumps of other endian BDB files",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T19:39:07Z"
      },
      "sha": "a71f32c597f24b8757fb7b6000283b468798b38b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUxZmVlZTA1N2JkMDFlMjIwOWZlNzY1NWRhMjg1NmRlMDFiZTJjYzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51feee057bd01e2209fe7655da2856de01be2cc9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/51feee057bd01e2209fe7655da2856de01be2cc9",
      "tree": {
        "sha": "b75be9c427d9d97be20a5400184cd8d2c95acf6a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b75be9c427d9d97be20a5400184cd8d2c95acf6a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a71f32c597f24b8757fb7b6000283b468798b38b",
          "sha": "a71f32c597f24b8757fb7b6000283b468798b38b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a71f32c597f24b8757fb7b6000283b468798b38b"
        }
      ],
      "message": "test: Test dumping dbs with overflow pages",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:50Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:06:29Z"
      },
      "sha": "51feee057bd01e2209fe7655da2856de01be2cc9"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12565133926,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALs8Lpm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12565133926",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-22T20:06:58Z"
    },
    {
      "event": "commented",
      "id": 2070869416,
      "node_id": "IC_kwDOABII5857bvWo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2070869416",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-22T20:11:13Z",
      "updated_at": "2024-04-22T20:43:26Z",
      "author_association": "MEMBER",
      "body": "For testing big endian wallets, you can use `db_dump wallet.dat | db_load -c db_lorder=4321 wallet_big_endian.dat` to make big endian databasese using BDB's tools.\r\n\r\nHowever, I also realized that BDB lets us set the endianness to use for a new database, so I've added a `bdb_swap` format to `createfromdump` that will make a BDB database with the other endianness. This will flip it depending on the system that you use, so on little endian, it will make a big endian wallet, and on big endian, it will make a little endian wallet. Adding this lets us have a test of `BerkeleyRO` dumping other endian wallets.\r\n\r\nI've also added a test for the overflow page issue that was discovered earlier, and another test for the LSN reset check.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2070869416",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMwMGVjOTVlZDI0YjdmNmI4NGIwNTQ0OWI1YzA3MTNmNzk3ZjA0NmQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/300ec95ed24b7f6b84b05449b5c0713f797f046d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/300ec95ed24b7f6b84b05449b5c0713f797f046d",
      "tree": {
        "sha": "4a24ab9ecc91ff1f68fc53ee2c0c6cd186e6f4c8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4a24ab9ecc91ff1f68fc53ee2c0c6cd186e6f4c8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51feee057bd01e2209fe7655da2856de01be2cc9",
          "sha": "51feee057bd01e2209fe7655da2856de01be2cc9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/51feee057bd01e2209fe7655da2856de01be2cc9"
        }
      ],
      "message": "test: Test bdb_ro dump of wallet without reset LSNs",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:42:44Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T20:42:44Z"
      },
      "sha": "300ec95ed24b7f6b84b05449b5c0713f797f046d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12565869476,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALs-_Ok",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12565869476",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-22T21:15:45Z"
    },
    {
      "event": "commented",
      "id": 2070965921,
      "node_id": "IC_kwDOABII5857cG6h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2070965921",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-22T21:15:50Z",
      "updated_at": "2024-04-22T21:15:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/24124143992</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#issuecomment-2070965921",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26606"
    },
    {
      "event": "labeled",
      "id": 12565870327,
      "node_id": "LE_lADOABII585Xi1euzwAAAALs-_b3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12565870327",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-22T21:15:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2017378701,
      "node_id": "PRR_kwDOABII5854PsGN",
      "url": null,
      "actor": null,
      "commit_id": "dc938e90323b15d5fdc25cacd2d14bd0ff370c01",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#pullrequestreview-2017378701",
      "submitted_at": "2024-04-23T14:05:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12577799438,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALtsf0O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12577799438",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-23T15:41:32Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMzNmMzNDBjNTQyZWM0ZTI1MzkyMDNiOGFjYjlmZWU4MzNkY2UzYjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/336c340c542ec4e2539203b8acb9fee833dce3b8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/336c340c542ec4e2539203b8acb9fee833dce3b8",
      "tree": {
        "sha": "fa62390b803e8e75d6e723fbb2b011e095ed543b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fa62390b803e8e75d6e723fbb2b011e095ed543b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/300ec95ed24b7f6b84b05449b5c0713f797f046d",
          "sha": "300ec95ed24b7f6b84b05449b5c0713f797f046d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/300ec95ed24b7f6b84b05449b5c0713f797f046d"
        }
      ],
      "message": "wallet, test: Be able to always swap BDB endianness",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-23T16:17:28Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-22T21:08:18Z"
      },
      "sha": "336c340c542ec4e2539203b8acb9fee833dce3b8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12578278607,
      "node_id": "HRFPE_lADOABII585Xi1euzwAAAALtuUzP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12578278607",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-23T16:17:35Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgzN2Q2NTZmOGNiZWVlYzVlMzBjMTI5YWExYmVhYzg4MTZhMzU2NTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/837d656f8cbeeec5e30c129aa1beac8816a35651",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/837d656f8cbeeec5e30c129aa1beac8816a35651",
      "tree": {
        "sha": "f3d7962336fd838234e5545f6f76df13ed44976f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f3d7962336fd838234e5545f6f76df13ed44976f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/336c340c542ec4e2539203b8acb9fee833dce3b8",
          "sha": "336c340c542ec4e2539203b8acb9fee833dce3b8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/336c340c542ec4e2539203b8acb9fee833dce3b8"
        }
      ],
      "message": "fixup! test: Test bdb_ro dump of wallet without reset LSNs",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-23T16:20:28Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-04-23T16:20:28Z"
      },
      "sha": "837d656f8cbeeec5e30c129aa1beac8816a35651"
    },
    {
      "event": "unlabeled",
      "id": 12580330565,
      "node_id": "UNLE_lADOABII585Xi1euzwAAAALt2JxF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12580330565",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-23T18:59:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-24T10:15:17Z",
      "updated_at": "2024-04-24T10:15:17Z",
      "source": {
        "issue": {
          "id": 2138981919,
          "node_id": "PR_kwDOABII585nG3c9",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29442/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29442",
          "number": 29442,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Target a pre-defined utxo set composition by adjusting change outputs",
          "body": "This PR is designed for the use case of a Lightning node that provides liquidity of predefined amounts via [liquidity ads](https://github.com/lightning/bolts/pull/878).\r\n\r\nCoin selection is currently optimized to reduce the size of the utxo set and create change optimized for privacy. A liquidity provider instead needs to service multiple liquidity requests by spending confirmed utxos of known sizes.\r\n\r\nIdeally most liquidity transactions would be funded by a single input or a small set of inputs optimized to reduce fees. To minimize the number of unconfirmed transactions, inputs should also be sized in a range where most transactions do not produce change. When change is created, it should be divided into outputs of the sizes needed so that the wallet's utxo set converges towards an ideal utxo set specified by the user.\r\n\r\nI am opening this PR as a draft to get feedback and suggestions on the concept and my implementation to address this use case.\r\n\r\nThe algorithm described below can be implemented externally via RPC calls or directly in the wallet. \r\n\r\n1. Externally: use a new option to set the change target used for coin selection. \r\n2. Wallet (opportunistic): a new configuration file defines the desired utxo set which the wallet uses to compute the change target used for coin selection and to split change outputs (if any). \r\n4. Wallet (reactive/proactive):  pre-select a large input to force coin selection to produce change when fees are below some specified threshold or the desired set of utxos falls below some threshold. \r\n\r\n## utxo targets file example:\r\n\r\n```json\r\n{\r\n    \"buckets\": [\r\n        {\r\n            \"start_satoshis\": 10000,\r\n            \"end_satoshis\": 25000,\r\n            \"target_utxo_count\": 150\r\n        },\r\n        {\r\n            \"start_satoshis\": 50000,\r\n            \"end_satoshis\": 75000,\r\n            \"target_utxo_count\": 50\r\n        },\r\n        {\r\n            \"start_satoshis\": 200000,\r\n            \"end_satoshis\": 250000,\r\n            \"target_utxo_count\": 20\r\n        },\r\n        {\r\n            \"start_satoshis\": 1000000,\r\n            \"end_satoshis\": 1400000,\r\n            \"target_utxo_count\": 5\r\n        }\r\n    ],\r\n    \"bucket_refill_feerate\": 30000\r\n}\r\n```\r\n - The `target_utxo_count` for a bucket should be larger than the anticipated number of liquidity requests of `bucket_start_satoshis` within the expected confirmation time of a liquidity transaction.\r\n - The range from `bucket_start_satoshis` to `bucket_end_satoshis` should encompass expected fee variance.\r\n - The `bucket_refill_feerate` should be set to the expected median fee rate (?).\r\n - This file will be reloaded for every spend request to allow for on-the-fly updates\r\n\r\n## Algorithm steps\r\n\r\nFor each payment do the following:\r\n\r\n1) Calculate the current capacity of each target bucket from the wallet's utxo set.\r\n    - Include outputs from both confirmed and unconfirmed transactions in the wallet to calculate capacity.\r\n2) Add our largest confirmed utxo as an input IF the capacity of the least full target bucket is below some threshold (eg. < 30% full) or less than some higher threshold (eg. < 70%) and fee rates are below the `bucket_refill_feerate`.\r\n    - When the largest confirmed utxo is from one of our target buckets, then we should refill our wallet with a utxo from cold storage.\r\n3) Set the minimum change target [`m_min_change_target`](https://github.com/bitcoin/bitcoin/blob/3054416f62644120a4a6bc76e927054c7fbbd487/src/wallet/coinselection.h#L147) to a value from the target bucket with the lowest current capacity.\r\n    - Generate a random change target of the amount: current `change_fee` (the fee for creating an output) + a random value in the range: `bucket_start_satoshis` to `bucket_end_satoshi` - `change_fee`.\r\n    - Currently the change target is set by [`GenerateChangeTarget()`](https://github.com/bitcoin/bitcoin/blob/6ff0aa089c01ff3e610ecb47814ed739d685a14c/src/wallet/coinselection.cpp#L824) in a hard coded range.\r\n    - This parameter is only used by the 'knapsack' and 'coingrinder' algorithms.\r\n4) Call ['SelectCoins()'](https://github.com/bitcoin/bitcoin/blob/3054416f62644120a4a6bc76e927054c7fbbd487/src/wallet/spend.cpp#L1132) with the input from step 2 (if any) added to the `preset_inputs` parameter and with the minimum change target from step 3.\r\n    - The `consolidatefeerate=0` configuration option should always be set so that utxos are not preemptively cosolidated. Coin selection sets the parameter [`m_long_term_feerate`](https://github.com/bitcoin/bitcoin/blob/37fdf5a492786c1772b5b40773a1031237447070/src/wallet/coinselection.h#L160) to the wallets `consolidatefeerate`.\r\n    - Ideally, only the 'bnb' and 'cg' coin selection algorithms should be used and the others disabled to optimize for low fees.\r\n5) If the coin selection result includes a change output, then split the single change output amount into multiple outputs.\r\n    - Add the mimimum change target as an output first.\r\n    - If there is remaining value after paying the fee for a new output, then add a target from the next most empty target bucket.\r\n    - If there is not enough value to add a new output and fees, add remaining value to the last output added instead.\r\n\r\n",
          "user": {
            "login": "remyers",
            "id": 8568892,
            "node_id": "MDQ6VXNlcjg1Njg4OTI=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8568892?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/remyers",
            "html_url": "https://github.com/remyers",
            "followers_url": "https://api.github.com/users/remyers/followers",
            "following_url": "https://api.github.com/users/remyers/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/remyers/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/remyers/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/remyers/subscriptions",
            "organizations_url": "https://api.github.com/users/remyers/orgs",
            "repos_url": "https://api.github.com/users/remyers/repos",
            "events_url": "https://api.github.com/users/remyers/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/remyers/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29442",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29442",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29442.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29442.patch"
          },
          "created_at": "2024-02-16T16:45:09Z",
          "updated_at": "2024-04-24T10:15:16Z"
        },
        "type": "issue"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121971951",
      "pull_request_review_id": 1320156842,
      "id": 1121971951,
      "node_id": "PRRC_kwDOABII585C3-7v",
      "diff_hunk": "@@ -530,6 +530,14 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (!file)",
      "path": "src/streams.h",
      "position": null,
      "original_position": 6,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d `{`\r\n\r\nCould also use the `IsNull()` helper.",
      "created_at": "2023-03-01T16:02:46Z",
      "updated_at": "2023-03-01T16:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1121971951",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121971951"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 535,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121975697",
      "pull_request_review_id": 1320156842,
      "id": 1121975697,
      "node_id": "PRRC_kwDOABII585C3_2R",
      "diff_hunk": "@@ -530,6 +530,14 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)",
      "path": "src/streams.h",
      "position": null,
      "original_position": 4,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d: Note for other reviewers: yes\r\n\r\nhttps://en.cppreference.com/w/c/io/fseek",
      "created_at": "2023-03-01T16:05:12Z",
      "updated_at": "2023-03-01T16:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1121975697",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121975697"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 525,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121979628",
      "pull_request_review_id": 1320156842,
      "id": 1121979628,
      "node_id": "PRRC_kwDOABII585C4Azs",
      "diff_hunk": "@@ -530,6 +530,14 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (!file)\n+            throw std::ios_base::failure(\"CAutoFile::read: file handle is nullptr\");\n+        if (fseek(file, offset, origin) != 0)\n+            throw std::ios_base::failure(feof(file) ? \"CAutoFile::seek: end of file\" : \"CAutoFile::seek: fseek failed\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 9,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d: maybe log the exact error code.",
      "created_at": "2023-03-01T16:07:54Z",
      "updated_at": "2023-03-01T16:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1121979628",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1121979628"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1122017022",
      "pull_request_review_id": 1320156842,
      "id": 1122017022,
      "node_id": "PRRC_kwDOABII585C4J7-",
      "diff_hunk": "@@ -0,0 +1,104 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_MIGRATE_H\n+#define BITCOIN_WALLET_MIGRATE_H",
      "path": "src/wallet/migrate.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1224f45a92972199799d1ea33700eee567dc66fe",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "1224f45a92972199799d1ea33700eee567dc66fe: maybe call this file `bdb_ro_wallet_db.h`?",
      "created_at": "2023-03-01T16:32:13Z",
      "updated_at": "2023-03-01T16:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1122017022",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1122017022"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6,
      "original_line": 6,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1122022825",
      "pull_request_review_id": 1320156842,
      "id": 1122022825,
      "node_id": "PRRC_kwDOABII585C4LWp",
      "diff_hunk": "@@ -21,17 +21,37 @@ bool BerkeleyRODatabase::Backup(const std::string& dest) const\n \n bool BerkeleyROBatch::ReadKey(DataStream&& key, DataStream& value)\n {\n-    return false;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "d6c5aa0f6783ef9f26f93a583d2fad5a943e23ec",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d6c5aa0f6783ef9f26f93a583d2fad5a943e23ec: commit description also mentions `StartCursor`, `ReadAtCursor`, `CloseCursor`.",
      "created_at": "2023-03-01T16:35:56Z",
      "updated_at": "2023-03-01T16:42:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1122022825",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1122022825"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 24,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556050",
      "pull_request_review_id": 1342106242,
      "id": 1137556050,
      "node_id": "PRRC_kwDOABII585DzbpS",
      "diff_hunk": "@@ -530,6 +530,14 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (!file)",
      "path": "src/streams.h",
      "position": null,
      "original_position": 6,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d",
      "in_reply_to_id": 1121971951,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-03-15T18:09:29Z",
      "updated_at": "2023-03-15T18:09:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1137556050",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556050"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 535,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556512",
      "pull_request_review_id": 1342106695,
      "id": 1137556512,
      "node_id": "PRRC_kwDOABII585Dzbwg",
      "diff_hunk": "@@ -530,6 +530,14 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (!file)\n+            throw std::ios_base::failure(\"CAutoFile::read: file handle is nullptr\");\n+        if (fseek(file, offset, origin) != 0)\n+            throw std::ios_base::failure(feof(file) ? \"CAutoFile::seek: end of file\" : \"CAutoFile::seek: fseek failed\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 9,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1d093bbf97b8d4ec5413ca560ac79e56f23d7f1d",
      "in_reply_to_id": 1121979628,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's kind of annoying to do that, so I'll leave it as is. The other functions do the same.",
      "created_at": "2023-03-15T18:09:47Z",
      "updated_at": "2023-03-15T18:09:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1137556512",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556512"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556948",
      "pull_request_review_id": 1342107141,
      "id": 1137556948,
      "node_id": "PRRC_kwDOABII585Dzb3U",
      "diff_hunk": "@@ -0,0 +1,104 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_MIGRATE_H\n+#define BITCOIN_WALLET_MIGRATE_H",
      "path": "src/wallet/migrate.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "1224f45a92972199799d1ea33700eee567dc66fe",
      "in_reply_to_id": 1122017022,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The intent is to have all of the migration stuff in these files, so I will leave it as is.",
      "created_at": "2023-03-15T18:10:04Z",
      "updated_at": "2023-03-15T18:10:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1137556948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137556948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6,
      "original_line": 6,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137557089",
      "pull_request_review_id": 1342107285,
      "id": 1137557089,
      "node_id": "PRRC_kwDOABII585Dzb5h",
      "diff_hunk": "@@ -21,17 +21,37 @@ bool BerkeleyRODatabase::Backup(const std::string& dest) const\n \n bool BerkeleyROBatch::ReadKey(DataStream&& key, DataStream& value)\n {\n-    return false;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "d6c5aa0f6783ef9f26f93a583d2fad5a943e23ec",
      "in_reply_to_id": 1122022825,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Updated the message.",
      "created_at": "2023-03-15T18:10:10Z",
      "updated_at": "2023-03-15T18:10:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1137557089",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1137557089"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 24,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229358644",
      "pull_request_review_id": 1478773216,
      "id": 1229358644,
      "node_id": "PRRC_kwDOABII585JRoY0",
      "diff_hunk": "@@ -0,0 +1,122 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_MIGRATE_H\n+#define BITCOIN_WALLET_MIGRATE_H\n+\n+#include <wallet/db.h>\n+\n+#include <optional>\n+\n+namespace wallet {\n+\n+using BerkeleyROData = std::map<SerializeData, SerializeData, std::less<>>;\n+\n+/**\n+ * A class representing a BerkeleyDB file from which we can only read records.\n+ * This is used only for migration of legacy to descriptor wallets\n+ */\n+class BerkeleyRODatabase : public WalletDatabase\n+{\n+private:\n+    const fs::path m_filepath;\n+\n+public:\n+    /** Create dummy DB handle */\n+    BerkeleyRODatabase(const fs::path& filepath) : WalletDatabase(), m_filepath(filepath)\n+    {\n+        Open();\n+    }\n+    ~BerkeleyRODatabase() {};\n+\n+    BerkeleyROData m_records;\n+\n+    /** Open the database if it is not already opened. */\n+    void Open() override;\n+\n+    /** Indicate the a new database user has began using the database. Increments m_refcount */\n+    void AddRef() override {}\n+    /** Indicate that database user has stopped using the database and that it could be flushed or closed. Decrement m_refcount */\n+    void RemoveRef() override {}\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    bool Rewrite(const char* pszSkip=nullptr) override { return false; }\n+\n+    /** Back up the entire database to a file.\n+     */\n+    bool Backup(const std::string& strDest) const override;\n+\n+    /** Make sure all changes are flushed to database file.\n+     */\n+     void Flush() override {}\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n+     */\n+    void Close() override {}\n+    /* flush the wallet passively (TRY_LOCK)\n+       ideal to be called periodically */\n+    bool PeriodicFlush() override { return false; }\n+\n+    void IncrementUpdateCounter() override {}\n+\n+    void ReloadDbEnv() override {}\n+\n+    /** Return path to main database file for logs and error messages. */\n+    std::string Filename() override { return fs::PathToString(m_filepath); }\n+\n+    std::string Format() override { return \"bdb_ro\"; }\n+\n+    /** Make a DatabaseBatch connected to this database */\n+    std::unique_ptr<DatabaseBatch> MakeBatch(bool flush_on_close = true) override;\n+};\n+\n+class BerkeleyROCursor : public DatabaseCursor\n+{\n+private:\n+    const BerkeleyRODatabase& m_database;\n+    BerkeleyROData::const_iterator m_cursor;\n+    BerkeleyROData::const_iterator m_cursor_end;\n+\n+public:\n+    explicit BerkeleyROCursor(const BerkeleyRODatabase& database, Span<const std::byte> prefix = {});\n+    ~BerkeleyROCursor() {}\n+\n+    Status Next(DataStream& key, DataStream& value) override;\n+};\n+\n+/** RAII class that provides access to a BerkeleyRODatabase */\n+class BerkeleyROBatch : public DatabaseBatch\n+{\n+private:\n+    const BerkeleyRODatabase& m_database;\n+\n+    bool ReadKey(DataStream&& key, DataStream& value) override;\n+    bool WriteKey(DataStream&& key, DataStream&& value, bool overwrite=true) override { return true; }",
      "path": "src/wallet/migrate.h",
      "position": 96,
      "original_position": 96,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f108c6b565e73ea02df94331a347f9d1653ab0b2",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why is this method returning `true`, but false for the erase methods?",
      "created_at": "2023-06-14T10:11:13Z",
      "updated_at": "2023-06-14T21:21:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1229358644",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229358644"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 96,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247132355",
      "pull_request_review_id": 1506063580,
      "id": 1247132355,
      "node_id": "PRRC_kwDOABII585KVbrD",
      "diff_hunk": "@@ -522,6 +522,16 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (IsNull()) {\n+            throw std::ios_base::failure(\"CAutoFile::read: file handle is nullptr\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "5b3573e201863cf22cf04597a346a027cb685a13",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            throw std::ios_base::failure(\"AutoFile::seek: file handle is nullptr\");\r\n```\r\n\r\n?",
      "created_at": "2023-06-29T20:21:49Z",
      "updated_at": "2023-06-29T20:22:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247132355",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247132355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 528,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247172893",
      "pull_request_review_id": 1506127844,
      "id": 1247172893,
      "node_id": "PRRC_kwDOABII585KVlkd",
      "diff_hunk": "@@ -522,6 +522,16 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (IsNull()) {\n+            throw std::ios_base::failure(\"CAutoFile::read: file handle is nullptr\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "5b3573e201863cf22cf04597a346a027cb685a13",
      "in_reply_to_id": 1247132355,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-06-29T21:02:00Z",
      "updated_at": "2023-06-29T21:02:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247172893",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247172893"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 528,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247469065",
      "pull_request_review_id": 1506562478,
      "id": 1247469065,
      "node_id": "PRRC_kwDOABII585KWt4J",
      "diff_hunk": "@@ -522,6 +522,16 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (IsNull()) {\n+            throw std::ios_base::failure(\"AutoFile::read: file handle is nullptr\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            throw std::ios_base::failure(\"AutoFile::seek: file handle is nullptr\");\r\n```",
      "created_at": "2023-06-30T06:00:58Z",
      "updated_at": "2023-06-30T06:02:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247469065",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247469065"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 528,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247687691",
      "pull_request_review_id": 1506898105,
      "id": 1247687691,
      "node_id": "PRRC_kwDOABII585KXjQL",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+const TestingSetup* g_setup;",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "After testing with a valid database in the fuzzing corpus, I noticed that I messed up the `m_args`, `m_node.args`, `gArgs` division again ([see here](https://github.com/bitcoin/bitcoin/issues/25055)) - sorry about that. I have a basic patch here, but feel free to commit a more elegant fix:\r\n\r\n```diff\r\ndiff --git a/src/wallet/test/fuzz/wallet_bdb_parser.cpp b/src/wallet/test/fuzz/wallet_bdb_parser.cpp\r\nindex aabde093b6..a1acb95178 100644\r\n--- a/src/wallet/test/fuzz/wallet_bdb_parser.cpp\r\n+++ b/src/wallet/test/fuzz/wallet_bdb_parser.cpp\r\n@@ -19,23 +19,15 @@ using wallet::DatabaseOptions;\r\n using wallet::DatabaseStatus;\r\n \r\n namespace {\r\n-const TestingSetup* g_setup;\r\n+TestingSetup* g_setup;\r\n } // namespace\r\n \r\n void initialize_wallet_bdb_parser()\r\n {\r\n-    static const auto testing_setup = MakeNoLogFileContext<const TestingSetup>();\r\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\r\n     g_setup = testing_setup.get();\r\n }\r\n \r\n-void SetDumpFile(ArgsManager& args) {\r\n-    auto dumpfile{args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"};\r\n-    if (fs::exists(dumpfile)) { // Writing into an existing dump file will throw an exception\r\n-        remove(dumpfile);\r\n-    }\r\n-    args.ForceSetArg(\"-dumpfile\", fs::PathToString(args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"));\r\n-}\r\n-\r\n FUZZ_TARGET_INIT(wallet_bdb_parser, initialize_wallet_bdb_parser)\r\n {\r\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\r\n@@ -52,10 +44,14 @@ FUZZ_TARGET_INIT(wallet_bdb_parser, initialize_wallet_bdb_parser)\r\n     DatabaseStatus status;\r\n     bilingual_str error;\r\n \r\n+    auto dumpfile{g_setup->m_args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"};\r\n+    if (fs::exists(dumpfile)) { // Writing into an existing dump file will throw an exception\r\n+        remove(dumpfile);\r\n+    }\r\n+    g_setup->m_args.ForceSetArg(\"-dumpfile\", dumpfile);\r\n+\r\n     try {\r\n         auto db{MakeBerkeleyRODatabase(wallet_path, options, status, error)};\r\n-        const auto& node = g_setup->m_node;\r\n-        SetDumpFile(*node.args);\r\n         assert(DumpWallet(g_setup->m_args, *db, error));\r\n     }\r\n     catch (const std::runtime_error& e) {\r\n```",
      "created_at": "2023-06-30T09:58:08Z",
      "updated_at": "2023-06-30T09:58:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247687691",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247687691"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247847963",
      "pull_request_review_id": 1507168279,
      "id": 1247847963,
      "node_id": "PRRC_kwDOABII585KYKYb",
      "diff_hunk": "@@ -519,7 +582,7 @@ void BerkeleyRODatabase::Open()\n                     uint32_t next_page = orec->page_number;\n                     while (next_page != 0) {\n                         SeekToPage(db_file, next_page, page_size);\n-                        PageHeader opage_header;\n+                        PageHeader opage_header(inner_meta.other_endian);\n                         db_file >> opage_header;\n                         OverflowPage opage(opage_header);\n                         db_file >> opage;",
      "path": "src/wallet/migrate.cpp",
      "position": 681,
      "original_position": 215,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0b8eac6a78351a68c1b5a6126564493ab50031dc",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Implement handling of other endianness in BerkeleyRODatabase\" 0b8eac6a78351a68c1b5a6126564493ab50031dc\r\n\r\nI might be reading something wrong, or confusing something, but I don't quite understand why the record data itself does not have to get its endianness adjusted.",
      "created_at": "2023-06-30T13:11:01Z",
      "updated_at": "2023-06-30T13:19:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247847963",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247847963"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 681,
      "original_line": 681,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247852182",
      "pull_request_review_id": 1507168279,
      "id": 1247852182,
      "node_id": "PRRC_kwDOABII585KYLaW",
      "diff_hunk": "@@ -1,13 +1,547 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    std::vector<std::byte> data; // Data from all of the overflow pages",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 224,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "d5fe130106bdf367c0bca157b02d12254590b585",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: implement independent BDB deserializer in BerkeleyRODatabase\" d5fe130106bdf367c0bca157b02d12254590b585\r\n\r\nCan this `data` field be removed? Seems to be unused.",
      "created_at": "2023-06-30T13:15:02Z",
      "updated_at": "2023-06-30T13:19:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1247852182",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247852182"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248008111",
      "pull_request_review_id": 1507432998,
      "id": 1248008111,
      "node_id": "PRRC_kwDOABII585KYxev",
      "diff_hunk": "@@ -519,7 +582,7 @@ void BerkeleyRODatabase::Open()\n                     uint32_t next_page = orec->page_number;\n                     while (next_page != 0) {\n                         SeekToPage(db_file, next_page, page_size);\n-                        PageHeader opage_header;\n+                        PageHeader opage_header(inner_meta.other_endian);\n                         db_file >> opage_header;\n                         OverflowPage opage(opage_header);\n                         db_file >> opage;",
      "path": "src/wallet/migrate.cpp",
      "position": 681,
      "original_position": 215,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0b8eac6a78351a68c1b5a6126564493ab50031dc",
      "in_reply_to_id": 1247847963,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The record data should just be arbitrary byte strings so they don't have an endianness.",
      "created_at": "2023-06-30T15:37:20Z",
      "updated_at": "2023-06-30T15:37:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1248008111",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248008111"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 681,
      "original_line": 681,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248013942",
      "pull_request_review_id": 1507442894,
      "id": 1248013942,
      "node_id": "PRRC_kwDOABII585KYy52",
      "diff_hunk": "@@ -522,6 +522,16 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin)\n+    {\n+        if (IsNull()) {\n+            throw std::ios_base::failure(\"AutoFile::read: file handle is nullptr\");",
      "path": "src/streams.h",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "in_reply_to_id": 1247469065,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-06-30T15:43:46Z",
      "updated_at": "2023-06-30T15:43:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1248013942",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248013942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 528,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248014091",
      "pull_request_review_id": 1507443085,
      "id": 1248014091,
      "node_id": "PRRC_kwDOABII585KYy8L",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+const TestingSetup* g_setup;",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6d2f8d999055f48084dcebef982e47c21ceb4f38",
      "in_reply_to_id": 1247687691,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done as suggested",
      "created_at": "2023-06-30T15:43:54Z",
      "updated_at": "2023-06-30T15:43:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1248014091",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248014091"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248014465",
      "pull_request_review_id": 1507443735,
      "id": 1248014465,
      "node_id": "PRRC_kwDOABII585KYzCB",
      "diff_hunk": "@@ -1,13 +1,547 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    std::vector<std::byte> data; // Data from all of the overflow pages",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 224,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "d5fe130106bdf367c0bca157b02d12254590b585",
      "in_reply_to_id": 1247852182,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Removed. I think originally I though I could put the overflow page data into this field, but I didn't end up doing it that way.",
      "created_at": "2023-06-30T15:44:22Z",
      "updated_at": "2023-06-30T15:44:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1248014465",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248014465"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248057852",
      "pull_request_review_id": 1507509204,
      "id": 1248057852,
      "node_id": "PRRC_kwDOABII585KY9n8",
      "diff_hunk": "@@ -0,0 +1,122 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_WALLET_MIGRATE_H\n+#define BITCOIN_WALLET_MIGRATE_H\n+\n+#include <wallet/db.h>\n+\n+#include <optional>\n+\n+namespace wallet {\n+\n+using BerkeleyROData = std::map<SerializeData, SerializeData, std::less<>>;\n+\n+/**\n+ * A class representing a BerkeleyDB file from which we can only read records.\n+ * This is used only for migration of legacy to descriptor wallets\n+ */\n+class BerkeleyRODatabase : public WalletDatabase\n+{\n+private:\n+    const fs::path m_filepath;\n+\n+public:\n+    /** Create dummy DB handle */\n+    BerkeleyRODatabase(const fs::path& filepath) : WalletDatabase(), m_filepath(filepath)\n+    {\n+        Open();\n+    }\n+    ~BerkeleyRODatabase() {};\n+\n+    BerkeleyROData m_records;\n+\n+    /** Open the database if it is not already opened. */\n+    void Open() override;\n+\n+    /** Indicate the a new database user has began using the database. Increments m_refcount */\n+    void AddRef() override {}\n+    /** Indicate that database user has stopped using the database and that it could be flushed or closed. Decrement m_refcount */\n+    void RemoveRef() override {}\n+\n+    /** Rewrite the entire database on disk, with the exception of key pszSkip if non-zero\n+     */\n+    bool Rewrite(const char* pszSkip=nullptr) override { return false; }\n+\n+    /** Back up the entire database to a file.\n+     */\n+    bool Backup(const std::string& strDest) const override;\n+\n+    /** Make sure all changes are flushed to database file.\n+     */\n+     void Flush() override {}\n+    /** Flush to the database file and close the database.\n+     *  Also close the environment if no other databases are open in it.\n+     */\n+    void Close() override {}\n+    /* flush the wallet passively (TRY_LOCK)\n+       ideal to be called periodically */\n+    bool PeriodicFlush() override { return false; }\n+\n+    void IncrementUpdateCounter() override {}\n+\n+    void ReloadDbEnv() override {}\n+\n+    /** Return path to main database file for logs and error messages. */\n+    std::string Filename() override { return fs::PathToString(m_filepath); }\n+\n+    std::string Format() override { return \"bdb_ro\"; }\n+\n+    /** Make a DatabaseBatch connected to this database */\n+    std::unique_ptr<DatabaseBatch> MakeBatch(bool flush_on_close = true) override;\n+};\n+\n+class BerkeleyROCursor : public DatabaseCursor\n+{\n+private:\n+    const BerkeleyRODatabase& m_database;\n+    BerkeleyROData::const_iterator m_cursor;\n+    BerkeleyROData::const_iterator m_cursor_end;\n+\n+public:\n+    explicit BerkeleyROCursor(const BerkeleyRODatabase& database, Span<const std::byte> prefix = {});\n+    ~BerkeleyROCursor() {}\n+\n+    Status Next(DataStream& key, DataStream& value) override;\n+};\n+\n+/** RAII class that provides access to a BerkeleyRODatabase */\n+class BerkeleyROBatch : public DatabaseBatch\n+{\n+private:\n+    const BerkeleyRODatabase& m_database;\n+\n+    bool ReadKey(DataStream&& key, DataStream& value) override;\n+    bool WriteKey(DataStream&& key, DataStream&& value, bool overwrite=true) override { return true; }",
      "path": "src/wallet/migrate.h",
      "position": 96,
      "original_position": 96,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f108c6b565e73ea02df94331a347f9d1653ab0b2",
      "in_reply_to_id": 1229358644,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "IIRC I did this to avoid issues with old wallets that the wallet loading logic would do automatic upgrading of which expects writing to not fail. It actually should be fine for those to not write anything.",
      "created_at": "2023-06-30T16:20:07Z",
      "updated_at": "2023-06-30T16:22:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1248057852",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1248057852"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 96,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1252319116",
      "pull_request_review_id": 1513342000,
      "id": 1252319116,
      "node_id": "PRRC_kwDOABII585KpN-M",
      "diff_hunk": "@@ -519,7 +582,7 @@ void BerkeleyRODatabase::Open()\n                     uint32_t next_page = orec->page_number;\n                     while (next_page != 0) {\n                         SeekToPage(db_file, next_page, page_size);\n-                        PageHeader opage_header;\n+                        PageHeader opage_header(inner_meta.other_endian);\n                         db_file >> opage_header;\n                         OverflowPage opage(opage_header);\n                         db_file >> opage;",
      "path": "src/wallet/migrate.cpp",
      "position": 681,
      "original_position": 215,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0b8eac6a78351a68c1b5a6126564493ab50031dc",
      "in_reply_to_id": 1247847963,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ACK, please resolve.",
      "created_at": "2023-07-04T20:01:54Z",
      "updated_at": "2023-07-04T20:01:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1252319116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1252319116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 681,
      "original_line": 681,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1273993906",
      "pull_request_review_id": 1546251193,
      "id": 1273993906,
      "node_id": "PRRC_kwDOABII585L75qy",
      "diff_hunk": "@@ -0,0 +1,683 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            magic = bswap_32(magic);\n+            version = bswap_32(version);\n+            pagesize = bswap_32(pagesize);\n+            free_list = bswap_32(free_list);\n+            last_page = bswap_32(last_page);\n+            partitions = bswap_32(partitions);\n+            key_count = bswap_32(key_count);\n+            record_count = bswap_32(record_count);\n+            unused2 = bswap_32(unused2);\n+            minkey = bswap_32(minkey);\n+            re_len = bswap_32(re_len);\n+            re_pad = bswap_32(re_pad);\n+            root = bswap_32(root);\n+            crypto_magic = bswap_32(crypto_magic);\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = bswap_32(page_num);\n+            records = bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = bswap_32(page_number);\n+            item_len = bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    bool other_endian;\n+\n+    PageHeader(bool other_endian) : other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            prev_page = bswap_32(prev_page);\n+            next_page = bswap_32(next_page);\n+            entries = bswap_16(entries);\n+            hf_offset = bswap_16(hf_offset);\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.push_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static MetaPage ReadMetaPage(CAutoFile& f)\n+{\n+    // Read the metapage\n+    MetaPage meta;\n+    f >> meta;\n+\n+    // Sanity checks\n+    if (meta.magic != BTREE_MAGIC) {\n+        throw std::runtime_error(\"Not a BDB file\");\n+    }\n+    if (meta.version != 9) {\n+        throw std::runtime_error(\"Unsupported BDB data file version number\");\n+    }\n+    if (meta.type != PageType::BTREE_META) {\n+        throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+    }\n+    if (meta.flags != BTreeFlags::SUBDB) {\n+        throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+    }\n+\n+    return meta;\n+}\n+\n+static void SeekToPage(CAutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    CAutoFile db_file(file, 0, 0);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    MetaPage outer_meta = ReadMetaPage(db_file);\n+    page_size = outer_meta.pagesize;\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != std::vector<std::byte>({std::byte('m'), std::byte('a'), std::byte('i'), std::byte('n')})) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 527,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This would be more readable if the `main` bytes were stuffed into a constant somewhere.",
      "created_at": "2023-07-25T19:30:14Z",
      "updated_at": "2023-07-25T19:58:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1273993906",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1273993906"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 527,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274005925",
      "pull_request_review_id": 1546251193,
      "id": 1274005925,
      "node_id": "PRRC_kwDOABII585L78ml",
      "diff_hunk": "@@ -0,0 +1,683 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            magic = bswap_32(magic);\n+            version = bswap_32(version);\n+            pagesize = bswap_32(pagesize);\n+            free_list = bswap_32(free_list);\n+            last_page = bswap_32(last_page);\n+            partitions = bswap_32(partitions);\n+            key_count = bswap_32(key_count);\n+            record_count = bswap_32(record_count);\n+            unused2 = bswap_32(unused2);\n+            minkey = bswap_32(minkey);\n+            re_len = bswap_32(re_len);\n+            re_pad = bswap_32(re_pad);\n+            root = bswap_32(root);\n+            crypto_magic = bswap_32(crypto_magic);\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = bswap_32(page_num);\n+            records = bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = bswap_32(page_number);\n+            item_len = bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    bool other_endian;\n+\n+    PageHeader(bool other_endian) : other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            prev_page = bswap_32(prev_page);\n+            next_page = bswap_32(next_page);\n+            entries = bswap_16(entries);\n+            hf_offset = bswap_16(hf_offset);\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.push_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static MetaPage ReadMetaPage(CAutoFile& f)\n+{\n+    // Read the metapage\n+    MetaPage meta;\n+    f >> meta;\n+\n+    // Sanity checks\n+    if (meta.magic != BTREE_MAGIC) {\n+        throw std::runtime_error(\"Not a BDB file\");\n+    }\n+    if (meta.version != 9) {\n+        throw std::runtime_error(\"Unsupported BDB data file version number\");\n+    }\n+    if (meta.type != PageType::BTREE_META) {\n+        throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+    }\n+    if (meta.flags != BTreeFlags::SUBDB) {\n+        throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+    }\n+\n+    return meta;\n+}\n+\n+static void SeekToPage(CAutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    CAutoFile db_file(file, 0, 0);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    MetaPage outer_meta = ReadMetaPage(db_file);\n+    page_size = outer_meta.pagesize;\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != std::vector<std::byte>({std::byte('m'), std::byte('a'), std::byte('i'), std::byte('n')})) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get_if<DataRecord>(&page.records.at(1))->m_header.len != 4) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 530,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can you add a comment explaining why we check this?",
      "created_at": "2023-07-25T19:43:38Z",
      "updated_at": "2023-07-25T19:58:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1274005925",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1274005925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 570,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279447033",
      "pull_request_review_id": 1555022636,
      "id": 1279447033,
      "node_id": "PRRC_kwDOABII585MQs_5",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 38,
      "original_position": 35,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe add a recommendation to the fuzz doc to [mount /tmp to tmpfs](https://ubuntu.com/blog/data-driven-analysis-tmp-on-tmpfs), or ensure we don't use the file system.",
      "created_at": "2023-07-31T15:07:01Z",
      "updated_at": "2023-07-31T15:07:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1279447033",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279447033"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279450655",
      "pull_request_review_id": 1555027910,
      "id": 1279450655,
      "node_id": "PRRC_kwDOABII585MQt4f",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 38,
      "original_position": 35,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1279447033,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is already in the test docs, no?\r\n\r\n```\r\n$ git grep tmpfs test/README.md\r\ntest/README.md:sudo mount -t tmpfs -o size=4g tmpfs /mnt/tmp/\r\n",
      "created_at": "2023-07-31T15:09:05Z",
      "updated_at": "2023-07-31T15:09:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1279450655",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279450655"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279466130",
      "pull_request_review_id": 1555052889,
      "id": 1279466130,
      "node_id": "PRRC_kwDOABII585MQxqS",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n+        outfile << Span{file_data};\n+    }\n+\n+    const DatabaseOptions options{};\n+    DatabaseStatus status;\n+    bilingual_str error;\n+\n+    fs::path dumpfile{g_setup->m_args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"};\n+    if (fs::exists(dumpfile)) { // Writing into an existing dump file will throw an exception\n+        remove(dumpfile);\n+    }\n+    g_setup->m_args.ForceSetArg(\"-dumpfile\", fs::PathToString(dumpfile));\n+\n+    try {\n+        auto db{MakeBerkeleyRODatabase(wallet_path, options, status, error)};\n+        assert(DumpWallet(g_setup->m_args, *db, error));",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 62,
      "original_position": 55,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It would be useful here - if BDB is compiled - to also open it with BDB, dump and then compare both dumps.\r\n\r\nI'm not sure what to do for cases where BDB and RO have slightly different opinions on what they're willing to open at all. It's probably fine to skip comparing files where _either_ refuses to open.",
      "created_at": "2023-07-31T15:14:56Z",
      "updated_at": "2023-07-31T15:14:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1279466130",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279466130"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 62,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279468544",
      "pull_request_review_id": 1555058328,
      "id": 1279468544,
      "node_id": "PRRC_kwDOABII585MQyQA",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 38,
      "original_position": 35,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1279447033,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not in the fuzz docs, but just having it in the test docs is probably fine.",
      "created_at": "2023-07-31T15:16:53Z",
      "updated_at": "2023-07-31T15:16:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1279468544",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1279468544"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063486",
      "pull_request_review_id": 1557685853,
      "id": 1281063486,
      "node_id": "PRRC_kwDOABII585MW3o-",
      "diff_hunk": "@@ -0,0 +1,683 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            magic = bswap_32(magic);\n+            version = bswap_32(version);\n+            pagesize = bswap_32(pagesize);\n+            free_list = bswap_32(free_list);\n+            last_page = bswap_32(last_page);\n+            partitions = bswap_32(partitions);\n+            key_count = bswap_32(key_count);\n+            record_count = bswap_32(record_count);\n+            unused2 = bswap_32(unused2);\n+            minkey = bswap_32(minkey);\n+            re_len = bswap_32(re_len);\n+            re_pad = bswap_32(re_pad);\n+            root = bswap_32(root);\n+            crypto_magic = bswap_32(crypto_magic);\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = bswap_32(page_num);\n+            records = bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = bswap_32(page_number);\n+            item_len = bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    bool other_endian;\n+\n+    PageHeader(bool other_endian) : other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            prev_page = bswap_32(prev_page);\n+            next_page = bswap_32(next_page);\n+            entries = bswap_16(entries);\n+            hf_offset = bswap_16(hf_offset);\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.push_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static MetaPage ReadMetaPage(CAutoFile& f)\n+{\n+    // Read the metapage\n+    MetaPage meta;\n+    f >> meta;\n+\n+    // Sanity checks\n+    if (meta.magic != BTREE_MAGIC) {\n+        throw std::runtime_error(\"Not a BDB file\");\n+    }\n+    if (meta.version != 9) {\n+        throw std::runtime_error(\"Unsupported BDB data file version number\");\n+    }\n+    if (meta.type != PageType::BTREE_META) {\n+        throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+    }\n+    if (meta.flags != BTreeFlags::SUBDB) {\n+        throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+    }\n+\n+    return meta;\n+}\n+\n+static void SeekToPage(CAutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    CAutoFile db_file(file, 0, 0);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    MetaPage outer_meta = ReadMetaPage(db_file);\n+    page_size = outer_meta.pagesize;\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != std::vector<std::byte>({std::byte('m'), std::byte('a'), std::byte('i'), std::byte('n')})) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 527,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1273993906,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-08-01T19:30:40Z",
      "updated_at": "2023-08-01T19:30:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1281063486",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063486"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 527,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063610",
      "pull_request_review_id": 1557686133,
      "id": 1281063610,
      "node_id": "PRRC_kwDOABII585MW3q6",
      "diff_hunk": "@@ -0,0 +1,683 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            magic = bswap_32(magic);\n+            version = bswap_32(version);\n+            pagesize = bswap_32(pagesize);\n+            free_list = bswap_32(free_list);\n+            last_page = bswap_32(last_page);\n+            partitions = bswap_32(partitions);\n+            key_count = bswap_32(key_count);\n+            record_count = bswap_32(record_count);\n+            unused2 = bswap_32(unused2);\n+            minkey = bswap_32(minkey);\n+            re_len = bswap_32(re_len);\n+            re_pad = bswap_32(re_pad);\n+            root = bswap_32(root);\n+            crypto_magic = bswap_32(crypto_magic);\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = bswap_32(page_num);\n+            records = bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = bswap_32(page_number);\n+            item_len = bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    bool other_endian;\n+\n+    PageHeader(bool other_endian) : other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = bswap_64(lsn);\n+            page_num = bswap_32(page_num);\n+            prev_page = bswap_32(prev_page);\n+            next_page = bswap_32(next_page);\n+            entries = bswap_16(entries);\n+            hf_offset = bswap_16(hf_offset);\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.push_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.push_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static MetaPage ReadMetaPage(CAutoFile& f)\n+{\n+    // Read the metapage\n+    MetaPage meta;\n+    f >> meta;\n+\n+    // Sanity checks\n+    if (meta.magic != BTREE_MAGIC) {\n+        throw std::runtime_error(\"Not a BDB file\");\n+    }\n+    if (meta.version != 9) {\n+        throw std::runtime_error(\"Unsupported BDB data file version number\");\n+    }\n+    if (meta.type != PageType::BTREE_META) {\n+        throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+    }\n+    if (meta.flags != BTreeFlags::SUBDB) {\n+        throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+    }\n+\n+    return meta;\n+}\n+\n+static void SeekToPage(CAutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    CAutoFile db_file(file, 0, 0);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    MetaPage outer_meta = ReadMetaPage(db_file);\n+    page_size = outer_meta.pagesize;\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != std::vector<std::byte>({std::byte('m'), std::byte('a'), std::byte('i'), std::byte('n')})) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get_if<DataRecord>(&page.records.at(1))->m_header.len != 4) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 530,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1274005925,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comment",
      "created_at": "2023-08-01T19:30:47Z",
      "updated_at": "2023-08-01T19:30:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1281063610",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063610"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 570,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063722",
      "pull_request_review_id": 1557686444,
      "id": 1281063722,
      "node_id": "PRRC_kwDOABII585MW3sq",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n+        outfile << Span{file_data};\n+    }\n+\n+    const DatabaseOptions options{};\n+    DatabaseStatus status;\n+    bilingual_str error;\n+\n+    fs::path dumpfile{g_setup->m_args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"};\n+    if (fs::exists(dumpfile)) { // Writing into an existing dump file will throw an exception\n+        remove(dumpfile);\n+    }\n+    g_setup->m_args.ForceSetArg(\"-dumpfile\", fs::PathToString(dumpfile));\n+\n+    try {\n+        auto db{MakeBerkeleyRODatabase(wallet_path, options, status, error)};\n+        assert(DumpWallet(g_setup->m_args, *db, error));",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 62,
      "original_position": 55,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1279466130,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comparison",
      "created_at": "2023-08-01T19:30:55Z",
      "updated_at": "2023-08-01T19:30:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1281063722",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281063722"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 62,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281410852",
      "pull_request_review_id": 1558219665,
      "id": 1281410852,
      "node_id": "PRRC_kwDOABII585MYMck",
      "diff_hunk": "@@ -528,6 +528,7 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin);",
      "path": "src/streams.h",
      "position": null,
      "original_position": 4,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style nit: I don't think this method is a subset of our streams. Many streams can't seek to the beginning after a read. It may be better to move this up by 3 lines of code (or more if you want)",
      "created_at": "2023-08-02T05:26:46Z",
      "updated_at": "2023-08-02T05:26:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1281410852",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281410852"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281412977",
      "pull_request_review_id": 1558223099,
      "id": 1281412977,
      "node_id": "PRRC_kwDOABII585MYM9x",
      "diff_hunk": "@@ -0,0 +1,108 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/bdb.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <fstream>\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "style nit: If you remove this, it may be possible to feed in a \"happy\" wallet.dat (created with vanilla Bitcoin Core) as a fuzz input. See https://github.com/bitcoin-core/qa-assets/pull/140#issuecomment-1660088315\r\n\r\nThough, I haven't tested this.",
      "created_at": "2023-08-02T05:30:46Z",
      "updated_at": "2023-08-02T05:30:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1281412977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1281412977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282150028",
      "pull_request_review_id": 1559403016,
      "id": 1282150028,
      "node_id": "PRRC_kwDOABII585MbA6M",
      "diff_hunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n+        outfile << Span{file_data};\n+    }\n+\n+    const DatabaseOptions options{};\n+    DatabaseStatus status;\n+    bilingual_str error;\n+\n+    fs::path dumpfile{g_setup->m_args.GetDataDirNet() / \"fuzzed_dumpfile.dat\"};\n+    if (fs::exists(dumpfile)) { // Writing into an existing dump file will throw an exception\n+        remove(dumpfile);\n+    }\n+    g_setup->m_args.ForceSetArg(\"-dumpfile\", fs::PathToString(dumpfile));\n+\n+    try {\n+        auto db{MakeBerkeleyRODatabase(wallet_path, options, status, error)};\n+        assert(DumpWallet(g_setup->m_args, *db, error));",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 62,
      "original_position": 55,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "6e28ff97a99519ec8b50123bc1177084bba68f96",
      "in_reply_to_id": 1279466130,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nice! I'll run the fuzzer against that...",
      "created_at": "2023-08-02T16:26:46Z",
      "updated_at": "2023-08-02T16:26:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282150028",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282150028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 62,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282196740",
      "pull_request_review_id": 1559482876,
      "id": 1282196740,
      "node_id": "PRRC_kwDOABII585MbMUE",
      "diff_hunk": "@@ -0,0 +1,108 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/bdb.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <fstream>\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};\n+        outfile << Span{file_data};\n+    }\n+\n+    const DatabaseOptions options{};\n+    DatabaseStatus status;\n+    bilingual_str error;\n+\n+    fs::path bdb_ro_dumpfile{g_setup->m_args.GetDataDirNet() / \"fuzzed_dumpfile_bdb_ro.dat\"};\n+    if (fs::exists(bdb_ro_dumpfile)) { // Writing into an existing dump file will throw an exception\n+        remove(bdb_ro_dumpfile);\n+    }\n+    g_setup->m_args.ForceSetArg(\"-dumpfile\", fs::PathToString(bdb_ro_dumpfile));\n+\n+    bool bdb_ro_err = false;\n+    try {\n+        auto db{MakeBerkeleyRODatabase(wallet_path, options, status, error)};\n+        assert(DumpWallet(g_setup->m_args, *db, error));\n+    }\n+    catch (const std::runtime_error& e) {\n+        bdb_ro_err = true;\n+        if (std::string(e.what()) == \"AutoFile::ignore: end of file: iostream error\") return;\n+        if (std::string(e.what()) == \"AutoFile::read: end of file: iostream error\") return;\n+        if (std::string(e.what()) == \"Not a BDB file\") return;\n+        if (std::string(e.what()) == \"Unsupported BDB data file version number\") return;\n+        if (std::string(e.what()) == \"Unexpected page type, should be 9 (BTree Metadata)\") return;\n+        if (std::string(e.what()) == \"Unexpected database flags, should only be 0x20 (subdatabases)\") return;\n+        if (std::string(e.what()) == \"Unexpected outer database root page type\") return;\n+        if (std::string(e.what()) == \"Unexpected number of entries in outer database root page\") return;\n+        if (std::string(e.what()) == \"Subdatabase has an unexpected name\") return;\n+        if (std::string(e.what()) == \"Subdatabase page number has unexpected length\") return;\n+        if (std::string(e.what()) == \"Unexpected inner database page type\") return;\n+        if (std::string(e.what()) == \"Unknown record type in records page\") return;\n+        if (std::string(e.what()) == \"Unknown record type in internal page\") return;\n+        if (std::string(e.what()) == \"Unexpected page size\") return;\n+        if (std::string(e.what()) == \"Unexpected page type\") return;\n+        throw e;\n+    }",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": 101,
      "original_position": 78,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So far my corpus doesn't make it here, as tested by sprinkling `assert(false)`. It may indeed need some help with a real wallet.",
      "created_at": "2023-08-02T17:05:56Z",
      "updated_at": "2023-08-02T17:08:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282196740",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282196740"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 101,
      "original_line": 101,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282211461",
      "pull_request_review_id": 1559505421,
      "id": 1282211461,
      "node_id": "PRRC_kwDOABII585MbP6F",
      "diff_hunk": "@@ -0,0 +1,108 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/bdb.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <fstream>\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": 1281412977,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I simply copied a `wallet.dat` into the corpus directory. That resulted in a bunch of extra corpus entities and almost immediately a crash.",
      "created_at": "2023-08-02T17:20:53Z",
      "updated_at": "2023-08-02T17:20:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282211461",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282211461"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282214518",
      "pull_request_review_id": 1559510055,
      "id": 1282214518,
      "node_id": "PRRC_kwDOABII585MbQp2",
      "diff_hunk": "@@ -0,0 +1,108 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/bdb.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <fstream>\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": 1281412977,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Though the file seems to get ignored when trying to merge.",
      "created_at": "2023-08-02T17:23:59Z",
      "updated_at": "2023-08-02T17:24:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282214518",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282214518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282220244",
      "pull_request_review_id": 1559519181,
      "id": 1282220244,
      "node_id": "PRRC_kwDOABII585MbSDU",
      "diff_hunk": "@@ -528,6 +528,7 @@ class AutoFile\n     //\n     // Stream subset\n     //\n+    void seek(int64_t offset, int origin);",
      "path": "src/streams.h",
      "position": null,
      "original_position": 4,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": 1281410852,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-08-02T17:29:49Z",
      "updated_at": "2023-08-02T17:29:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282220244",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282220244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282227280",
      "pull_request_review_id": 1559530471,
      "id": 1282227280,
      "node_id": "PRRC_kwDOABII585MbTxQ",
      "diff_hunk": "@@ -0,0 +1,108 @@\n+// Copyright (c) 2023 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <test/fuzz/FuzzedDataProvider.h>\n+#include <test/fuzz/fuzz.h>\n+#include <test/fuzz/util.h>\n+#include <test/util/setup_common.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+#include <util/translation.h>\n+#include <wallet/bdb.h>\n+#include <wallet/db.h>\n+#include <wallet/dump.h>\n+#include <wallet/migrate.h>\n+\n+#include <fstream>\n+#include <iostream>\n+\n+using wallet::DatabaseOptions;\n+using wallet::DatabaseStatus;\n+\n+namespace {\n+TestingSetup* g_setup;\n+} // namespace\n+\n+void initialize_wallet_bdb_parser()\n+{\n+    static auto testing_setup = MakeNoLogFileContext<TestingSetup>();\n+    g_setup = testing_setup.get();\n+}\n+\n+FUZZ_TARGET(wallet_bdb_parser, .init = initialize_wallet_bdb_parser)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    const auto wallet_path = g_setup->m_args.GetDataDirNet() / \"fuzzed_wallet.dat\";\n+\n+    {\n+        AutoFile outfile{fsbridge::fopen(wallet_path, \"wb\")};\n+        const auto file_data{ConsumeRandomLengthByteVector(fuzzed_data_provider)};",
      "path": "src/wallet/test/fuzz/wallet_bdb_parser.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "0dd59f3769bfb7cb15f7a93aa5efac66e3c3e50e",
      "in_reply_to_id": 1281412977,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, figured it out! Will push some new entries to the qa-assets PR that should reproduce the crash.",
      "created_at": "2023-08-02T17:36:55Z",
      "updated_at": "2023-08-02T17:36:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282227280",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282227280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282873918",
      "pull_request_review_id": 1560573265,
      "id": 1282873918,
      "node_id": "PRRC_kwDOABII585Mdxo-",
      "diff_hunk": "@@ -21,6 +21,28 @@ std::size_t AutoFile::detail_fread(Span<std::byte> dst)\n     }\n }\n \n+void AutoFile::seek(int64_t offset, int origin)\n+{\n+    if (IsNull()) {\n+        throw std::ios_base::failure(\"AutoFile::seek: file handle is nullptr\");\n+    }\n+    if (fseek(m_file, offset, origin) != 0) {\n+        throw std::ios_base::failure(feof() ? \"AutoFile::seek: end of file\" : \"AutoFile::seek: fseek failed\");\n+    }\n+}\n+\n+int64_t AutoFile::tell()\n+{\n+    if (IsNull()) {\n+        throw std::ios_base::failure(\"AutoFile::tell: file handle is nullptr\");\n+    }\n+    int64_t r = ftell(m_file);",
      "path": "src/streams.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "167cbf7b1851eeeb28937bd8e241e1f865b813f8",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in 167cbf7b1851eeeb28937bd8e241e1f865b813f8:\r\n\r\n\r\n```cpp\r\n    int64_t r{std::ftell(m_file)};",
      "created_at": "2023-08-03T08:55:14Z",
      "updated_at": "2023-08-03T08:56:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282873918",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282873918"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 39,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282875416",
      "pull_request_review_id": 1560573265,
      "id": 1282875416,
      "node_id": "PRRC_kwDOABII585MdyAY",
      "diff_hunk": "@@ -21,6 +21,28 @@ std::size_t AutoFile::detail_fread(Span<std::byte> dst)\n     }\n }\n \n+void AutoFile::seek(int64_t offset, int origin)\n+{\n+    if (IsNull()) {\n+        throw std::ios_base::failure(\"AutoFile::seek: file handle is nullptr\");\n+    }\n+    if (fseek(m_file, offset, origin) != 0) {",
      "path": "src/streams.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "167cbf7b1851eeeb28937bd8e241e1f865b813f8",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in 167cbf7b1851eeeb28937bd8e241e1f865b813f8:\r\n\r\nCould add `std::` before `fseek`? Also, the commit message has a typo:\r\n\r\nusefule -> useful (remove `e`)",
      "created_at": "2023-08-03T08:56:06Z",
      "updated_at": "2023-08-03T08:56:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1282875416",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1282875416"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 29,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382487576",
      "pull_request_review_id": 1713893741,
      "id": 1382487576,
      "node_id": "PRRC_kwDOABII585SZxYY",
      "diff_hunk": "@@ -21,17 +21,41 @@ bool BerkeleyRODatabase::Backup(const std::string& dest) const\n \n bool BerkeleyROBatch::ReadKey(DataStream&& key, DataStream& value)\n {\n-    return false;\n+    SerializeData key_data{key.begin(), key.end()};\n+    if (m_database.m_records.count(key_data) == 0) {\n+        return false;\n+    }\n+    auto val = m_database.m_records.at(key_data);",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "b7b90daf46ae840d9ab089ac438f71f7b79dbf5a",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(in commit b7b90daf46ae840d9ab089ac438f71f7b79dbf5a) could avoid duplicate std::map lookup by using `.find` instead:\r\n```suggestion\r\n    const auto it{m_database.m_records.find(key_data)};\r\n    if (it == m_database.m_records.end()) {\r\n         return false;\r\n    }\r\n    auto val = it->second;\r\n```",
      "created_at": "2023-11-05T00:53:14Z",
      "updated_at": "2023-11-05T01:15:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1382487576",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382487576"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": 25,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382488042",
      "pull_request_review_id": 1713893741,
      "id": 1382488042,
      "node_id": "PRRC_kwDOABII585SZxfq",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n \n void BerkeleyRODatabase::Open()\n {\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != SUBDATABASE_NAME) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 505,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "a02db44419148984d726f95fd66030b9a40fc0bb",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(in commit a02db44419148984d726f95fd66030b9a40fc0bb) readability nit: could also use `std::get` here, as the RHS of the OR conditoin is only executed if the variant holds the right data type:\r\n```suggestion\r\n    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get<DataRecord>(page.records.at(0)).data != SUBDATABASE_NAME) {\r\n```\r\n(same for the two `page.records.at(1)` instances a few lines below)",
      "created_at": "2023-11-05T00:59:23Z",
      "updated_at": "2023-11-05T01:15:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1382488042",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1382488042"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391817693",
      "pull_request_review_id": 1728455389,
      "id": 1391817693,
      "node_id": "PRRC_kwDOABII585S9XPd",
      "diff_hunk": "@@ -21,17 +21,41 @@ bool BerkeleyRODatabase::Backup(const std::string& dest) const\n \n bool BerkeleyROBatch::ReadKey(DataStream&& key, DataStream& value)\n {\n-    return false;\n+    SerializeData key_data{key.begin(), key.end()};\n+    if (m_database.m_records.count(key_data) == 0) {\n+        return false;\n+    }\n+    auto val = m_database.m_records.at(key_data);",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "b7b90daf46ae840d9ab089ac438f71f7b79dbf5a",
      "in_reply_to_id": 1382487576,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done as suggested",
      "created_at": "2023-11-13T23:42:04Z",
      "updated_at": "2023-11-13T23:42:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1391817693",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391817693"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": 25,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 28,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391817724",
      "pull_request_review_id": 1728455442,
      "id": 1391817724,
      "node_id": "PRRC_kwDOABII585S9XP8",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n \n void BerkeleyRODatabase::Open()\n {\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get_if<DataRecord>(&page.records.at(0))->data != SUBDATABASE_NAME) {",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 505,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "a02db44419148984d726f95fd66030b9a40fc0bb",
      "in_reply_to_id": 1382488042,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done as suggested",
      "created_at": "2023-11-13T23:42:08Z",
      "updated_at": "2023-11-13T23:42:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1391817724",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1391817724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1426859564",
      "pull_request_review_id": 1782050983,
      "id": 1426859564,
      "node_id": "PRRC_kwDOABII585VDCYs",
      "diff_hunk": "@@ -1476,6 +1477,11 @@ std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const Databas\n         return nullptr;\n     }\n \n+    // If BERKELEY_RO was the format, then change the format from BERKELEY to BERKELEY_RO",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f18d35ec78b305dfc49bbf7262fa3685aaa1a899",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This comment is confusing, aren't we going from `BERKELEY` to `BERKELEY_RO`?",
      "created_at": "2023-12-14T15:15:46Z",
      "updated_at": "2023-12-14T16:54:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1426859564",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1426859564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1439887042",
      "pull_request_review_id": 1801124655,
      "id": 1439887042,
      "node_id": "PRRC_kwDOABII585V0u7C",
      "diff_hunk": "@@ -1476,6 +1477,11 @@ std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const Databas\n         return nullptr;\n     }\n \n+    // If BERKELEY_RO was the format, then change the format from BERKELEY to BERKELEY_RO",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f18d35ec78b305dfc49bbf7262fa3685aaa1a899",
      "in_reply_to_id": 1426859564,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, fixed.",
      "created_at": "2024-01-02T21:36:43Z",
      "updated_at": "2024-01-02T21:36:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1439887042",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1439887042"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557522115",
      "pull_request_review_id": 1988863282,
      "id": 1557522115,
      "node_id": "PRRC_kwDOABII585c1ebD",
      "diff_hunk": "@@ -0,0 +1,738 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic",
      "path": "src/wallet/migrate.cpp",
      "position": 15,
      "original_position": 16,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Just a note for other reviewers: This comment mentioning \"our system\" was slightly confusing to me: our serialization framework always serializes in LE, so if we see BTREE_MAGIC_OE it means the file is in big-endian. Which means we always need to swap it, independent of system's endianness. \r\n",
      "created_at": "2024-04-09T12:04:02Z",
      "updated_at": "2024-04-09T12:04:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557522115",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557522115"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 15,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557537019",
      "pull_request_review_id": 1988887021,
      "id": 1557537019,
      "node_id": "PRRC_kwDOABII585c1iD7",
      "diff_hunk": "@@ -0,0 +1,738 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "i don't think importing `uint160` is necessary here--the actual value isnt used, we're just using it to consume some bytes",
      "created_at": "2024-04-09T12:16:39Z",
      "updated_at": "2024-04-09T12:16:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557537019",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557537019"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 81,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557578207",
      "pull_request_review_id": 1988953662,
      "id": 1557578207,
      "node_id": "PRRC_kwDOABII585c1sHf",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 454,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7707db3ad536e84a92f424272f6bb0fdc361a0b1",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "calculation of two 32 bit integers, you need to use a cast",
      "created_at": "2024-04-09T12:49:44Z",
      "updated_at": "2024-04-09T12:49:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557578207",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557578207"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 454,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557581834",
      "pull_request_review_id": 1988959407,
      "id": 1557581834,
      "node_id": "PRRC_kwDOABII585c1tAK",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 454,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7707db3ad536e84a92f424272f6bb0fdc361a0b1",
      "in_reply_to_id": 1557578207,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You probably want `size_t pos = size_t{page_num} * page_size;`, or you'll get an integer overflow for files over 4 GiB.",
      "created_at": "2024-04-09T12:52:27Z",
      "updated_at": "2024-04-09T12:53:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557581834",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557581834"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 454,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557583470",
      "pull_request_review_id": 1988962072,
      "id": 1557583470,
      "node_id": "PRRC_kwDOABII585c1tZu",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 454,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7707db3ad536e84a92f424272f6bb0fdc361a0b1",
      "in_reply_to_id": 1557578207,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "aside: might be better to not use size_t at all for file offsets, as the type is 32 bit on usual 32 bit platforms\r\nedit: `AutoFile::seek` uses  `int64_t` internally, let's ust that",
      "created_at": "2024-04-09T12:53:42Z",
      "updated_at": "2024-04-09T13:22:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557583470",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557583470"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 454,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557592239",
      "pull_request_review_id": 1988976956,
      "id": 1557592239,
      "node_id": "PRRC_kwDOABII585c1viv",
      "diff_hunk": "@@ -0,0 +1,738 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;",
      "path": "src/wallet/migrate.cpp",
      "position": 116,
      "original_position": 107,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "do we want to sanity check for encryption to be disabled? (didn't know bdb supported db-level encryption in the first place)\r\nedit: i checked BDB, apparently this value is 0 for non-encrypted databases, otherwise some other value",
      "created_at": "2024-04-09T12:59:57Z",
      "updated_at": "2024-04-11T06:54:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1557592239",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1557592239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 116,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566348693",
      "pull_request_review_id": 2002023175,
      "id": 1566348693,
      "node_id": "PRRC_kwDOABII585dXJWV",
      "diff_hunk": "@@ -0,0 +1,738 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 81,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "in_reply_to_id": 1557537019,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Dropped `uint160`, changed to use an array.",
      "created_at": "2024-04-15T19:47:27Z",
      "updated_at": "2024-04-15T19:47:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1566348693",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566348693"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 81,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566349302",
      "pull_request_review_id": 2002024266,
      "id": 1566349302,
      "node_id": "PRRC_kwDOABII585dXJf2",
      "diff_hunk": "@@ -1,13 +1,601 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <crypto/common.h> // For ReadBE32\n #include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n #include <wallet/migrate.h>\n \n+#include <optional>\n+#include <variant>\n+\n namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;  // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+\n+    PageHeader(uint32_t page_num) : expected_page_num(page_num) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if (level < 1) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::DUPLICATE:\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr;\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    size_t pos = page_num * page_size;",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 454,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7707db3ad536e84a92f424272f6bb0fdc361a0b1",
      "in_reply_to_id": 1557578207,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to `int64_t` with casting.",
      "created_at": "2024-04-15T19:48:08Z",
      "updated_at": "2024-04-15T19:48:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1566349302",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566349302"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 454,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566349587",
      "pull_request_review_id": 2002024679,
      "id": 1566349587,
      "node_id": "PRRC_kwDOABII585dXJkT",
      "diff_hunk": "@@ -0,0 +1,738 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <uint256.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    RECNO_LEAF = 6,      // Recno leaf\n+    OVERFLOW_DATA = 7,        // Overflow\n+    HASH_META = 8,       // Hash metadata\n+    BTREE_META = 9,      // BTree metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+\n+    PAGETYPE_MAX = 14,\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    DUPLICATE = 2,\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is AND'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    SUBDB = 0x20,    // Subdatabases\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    uint160 uid;              // Unique file ID (20 bytes, fits in uint16)\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;",
      "path": "src/wallet/migrate.cpp",
      "position": 116,
      "original_position": 107,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "7f8d4c963c6a12da0e8df462a3f25ccda4a39a62",
      "in_reply_to_id": 1557592239,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, I've added a check for that.",
      "created_at": "2024-04-15T19:48:27Z",
      "updated_at": "2024-04-15T19:48:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1566349587",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1566349587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 116,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567771033",
      "pull_request_review_id": 2004320891,
      "id": 1567771033,
      "node_id": "PRRC_kwDOABII585dckmZ",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (outer_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;\n+        if (file != 0 || offset != 1) {\n+            throw std::runtime_error(\"LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\");\n+        }\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root, outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get<DataRecord>(page.records.at(0)).data != SUBDATABASE_NAME) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    // Check length of page number for subdatabase location\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get<DataRecord>(page.records.at(1)).m_header.len != 4) {\n+        throw std::runtime_error(\"Subdatabase page number has unexpected length\");\n+    }\n+\n+    // Read subdatabase page number\n+    // It is written as a big endian 32 bit number\n+    uint32_t main_db_page = ReadBE32(UCharCast(std::get<DataRecord>(page.records.at(1)).data.data()));\n+\n+    // The main database is in a page that doesn't exist\n+    if (main_db_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Page number is greater than database last page\");\n+    }\n+\n+    // Read the inner metapage\n+    SeekToPage(db_file, main_db_page, page_size);\n+    MetaPage inner_meta(main_db_page);\n+    db_file >> inner_meta;\n+\n+    if (inner_meta.pagesize != page_size) {\n+        throw std::runtime_error(\"Unexpected page size\");\n+    }\n+\n+    if (inner_meta.last_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Subdatabase last page is greater than database last page\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (inner_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Do a DFS through the BTree, starting at root\n+    std::vector<uint32_t> pages{inner_meta.root};\n+    while (pages.size() > 0) {\n+        uint32_t curr_page = pages.back();\n+        if (curr_page > inner_meta.last_page) {\n+            std::runtime_error(\"Page number is greater than subdatabase last page\");\n+        }\n+        pages.pop_back();\n+        SeekToPage(db_file, curr_page, page_size);\n+        PageHeader header(curr_page, inner_meta.other_endian);\n+        db_file >> header;\n+        if (header.type != PageType::BTREE_LEAF && header.type != PageType::BTREE_INTERNAL) {\n+            throw std::runtime_error(\"Unexpected inner database page type\");",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 638,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`header.type` is compared against `BTREE_LEAF` and `BTREE_INTERNAL`, which are the same cases as handled in the `switch()` statement below, which also errors in the default page (though with a slightly different error), so this check is redundant?",
      "created_at": "2024-04-16T18:13:53Z",
      "updated_at": "2024-04-16T18:13:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567771033",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567771033"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 638,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567792369",
      "pull_request_review_id": 2004356721,
      "id": 1567792369,
      "node_id": "PRRC_kwDOABII585dcpzx",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);",
      "path": "src/wallet/migrate.cpp",
      "position": 409,
      "original_position": 408,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Note that the argument to `ignore()` is unsigned (a `size_t`), might want to error out here if somehow `index < pos`.\r\n(same for the occurence in `InternalPage`)",
      "created_at": "2024-04-16T18:33:59Z",
      "updated_at": "2024-04-16T18:33:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567792369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567792369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 409,
      "original_line": 409,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567799862",
      "pull_request_review_id": 2004368521,
      "id": 1567799862,
      "node_id": "PRRC_kwDOABII585dcro2",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 531,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It looks like `fclose()` does nothing if `db_file.IsNull()` already holds.",
      "created_at": "2024-04-16T18:41:12Z",
      "updated_at": "2024-04-16T18:41:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567799862",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567799862"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567831243",
      "pull_request_review_id": 2004421084,
      "id": 1567831243,
      "node_id": "PRRC_kwDOABII585dczTL",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (outer_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;\n+        if (file != 0 || offset != 1) {\n+            throw std::runtime_error(\"LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\");\n+        }\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root, outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get<DataRecord>(page.records.at(0)).data != SUBDATABASE_NAME) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    // Check length of page number for subdatabase location\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get<DataRecord>(page.records.at(1)).m_header.len != 4) {\n+        throw std::runtime_error(\"Subdatabase page number has unexpected length\");\n+    }\n+\n+    // Read subdatabase page number\n+    // It is written as a big endian 32 bit number\n+    uint32_t main_db_page = ReadBE32(UCharCast(std::get<DataRecord>(page.records.at(1)).data.data()));\n+\n+    // The main database is in a page that doesn't exist\n+    if (main_db_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Page number is greater than database last page\");\n+    }\n+\n+    // Read the inner metapage\n+    SeekToPage(db_file, main_db_page, page_size);\n+    MetaPage inner_meta(main_db_page);\n+    db_file >> inner_meta;\n+\n+    if (inner_meta.pagesize != page_size) {\n+        throw std::runtime_error(\"Unexpected page size\");\n+    }\n+\n+    if (inner_meta.last_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Subdatabase last page is greater than database last page\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (inner_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Do a DFS through the BTree, starting at root\n+    std::vector<uint32_t> pages{inner_meta.root};\n+    while (pages.size() > 0) {\n+        uint32_t curr_page = pages.back();\n+        if (curr_page > inner_meta.last_page) {\n+            std::runtime_error(\"Page number is greater than subdatabase last page\");\n+        }\n+        pages.pop_back();\n+        SeekToPage(db_file, curr_page, page_size);\n+        PageHeader header(curr_page, inner_meta.other_endian);\n+        db_file >> header;\n+        if (header.type != PageType::BTREE_LEAF && header.type != PageType::BTREE_INTERNAL) {\n+            throw std::runtime_error(\"Unexpected inner database page type\");\n+        }\n+        switch (header.type) {\n+        case PageType::BTREE_INTERNAL:\n+        {\n+            InternalPage int_page(header);\n+            db_file >> int_page;\n+            for (const InternalRecord& rec : int_page.records) {\n+                if (rec.m_header.IsDeleted()) continue;\n+                pages.push_back(rec.page_num);\n+            }\n+            break;\n+        }\n+        case PageType::BTREE_LEAF:\n+        {\n+            RecordsPage rec_page(header);\n+            db_file >> rec_page;\n+            bool is_key = true;\n+            std::vector<std::byte> key;\n+            for (const std::variant<DataRecord, OverflowRecord>& rec : rec_page.records) {\n+                std::vector<std::byte> data;\n+                if (const DataRecord* drec = std::get_if<DataRecord>(&rec)) {\n+                    if (drec->m_header.IsDeleted()) continue;\n+                    data = drec->data;\n+                } else if (const OverflowRecord* orec = std::get_if<OverflowRecord>(&rec)) {\n+                    if (orec->m_header.IsDeleted()) continue;\n+                    uint32_t next_page = orec->page_number;\n+                    while (next_page != 0) {\n+                        SeekToPage(db_file, next_page, page_size);\n+                        PageHeader opage_header(next_page, inner_meta.other_endian);\n+                        db_file >> opage_header;\n+                        if (opage_header.type != PageType::OVERFLOW_DATA) {\n+                            throw std::runtime_error(\"Bad overflow record page type\");\n+                        }\n+                        OverflowPage opage(opage_header);\n+                        db_file >> opage;\n+                        data.insert(data.end(), opage.data.begin(), opage.data.end());\n+                        next_page = opage_header.next_page;\n+                    }\n+                }\n+\n+                if (is_key) {\n+                    key = data;\n+                } else {\n+                    m_records.emplace(SerializeData{key.begin(), key.end()}, SerializeData{data.begin(), data.end()});\n+                    key.clear();\n+                }\n+                is_key = !is_key;\n+            }",
      "path": "src/wallet/migrate.cpp",
      "position": 694,
      "original_position": 686,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could add a check that `is_key` is true at the end. If not, there's an odd number of values, which would be odd?",
      "created_at": "2024-04-16T19:11:20Z",
      "updated_at": "2024-04-16T19:11:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567831243",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567831243"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 694,
      "original_line": 694,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567845152",
      "pull_request_review_id": 2004443229,
      "id": 1567845152,
      "node_id": "PRRC_kwDOABII585dc2sg",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 216,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Instead of casting back and forth and having a `GetRealType()` it would, imo, be more straightforward to split the delete flag off from the type in `Unserialize` before casting to `RecordType`. So to have\r\n```\r\nRecordType type;\r\nbool deleted;\r\n```\r\nThen these accessors could go.",
      "created_at": "2024-04-16T19:24:36Z",
      "updated_at": "2024-04-16T19:24:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567845152",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567845152"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 216,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920748",
      "pull_request_review_id": 2004565374,
      "id": 1567920748,
      "node_id": "PRRC_kwDOABII585ddJJs",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (outer_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;\n+        if (file != 0 || offset != 1) {\n+            throw std::runtime_error(\"LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\");\n+        }\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root, outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get<DataRecord>(page.records.at(0)).data != SUBDATABASE_NAME) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    // Check length of page number for subdatabase location\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get<DataRecord>(page.records.at(1)).m_header.len != 4) {\n+        throw std::runtime_error(\"Subdatabase page number has unexpected length\");\n+    }\n+\n+    // Read subdatabase page number\n+    // It is written as a big endian 32 bit number\n+    uint32_t main_db_page = ReadBE32(UCharCast(std::get<DataRecord>(page.records.at(1)).data.data()));\n+\n+    // The main database is in a page that doesn't exist\n+    if (main_db_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Page number is greater than database last page\");\n+    }\n+\n+    // Read the inner metapage\n+    SeekToPage(db_file, main_db_page, page_size);\n+    MetaPage inner_meta(main_db_page);\n+    db_file >> inner_meta;\n+\n+    if (inner_meta.pagesize != page_size) {\n+        throw std::runtime_error(\"Unexpected page size\");\n+    }\n+\n+    if (inner_meta.last_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Subdatabase last page is greater than database last page\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (inner_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Do a DFS through the BTree, starting at root\n+    std::vector<uint32_t> pages{inner_meta.root};\n+    while (pages.size() > 0) {\n+        uint32_t curr_page = pages.back();\n+        if (curr_page > inner_meta.last_page) {\n+            std::runtime_error(\"Page number is greater than subdatabase last page\");\n+        }\n+        pages.pop_back();\n+        SeekToPage(db_file, curr_page, page_size);\n+        PageHeader header(curr_page, inner_meta.other_endian);\n+        db_file >> header;\n+        if (header.type != PageType::BTREE_LEAF && header.type != PageType::BTREE_INTERNAL) {\n+            throw std::runtime_error(\"Unexpected inner database page type\");",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 638,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": 1567771033,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point. Removed this check.",
      "created_at": "2024-04-16T20:43:22Z",
      "updated_at": "2024-04-16T20:43:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567920748",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920748"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 638,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920893",
      "pull_request_review_id": 2004565615,
      "id": 1567920893,
      "node_id": "PRRC_kwDOABII585ddJL9",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);",
      "path": "src/wallet/migrate.cpp",
      "position": 409,
      "original_position": 408,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": 1567792369,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a check",
      "created_at": "2024-04-16T20:43:32Z",
      "updated_at": "2024-04-16T20:43:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567920893",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920893"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 409,
      "original_line": 409,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920972",
      "pull_request_review_id": 2004565760,
      "id": 1567920972,
      "node_id": "PRRC_kwDOABII585ddJNM",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 531,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": 1567799862,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Removed",
      "created_at": "2024-04-16T20:43:38Z",
      "updated_at": "2024-04-16T20:43:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567920972",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567920972"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567921413",
      "pull_request_review_id": 2004566465,
      "id": 1567921413,
      "node_id": "PRRC_kwDOABII585ddJUF",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));\n+    }\n+\n+    bool IsDeleted() const\n+    {\n+        return static_cast<uint8_t>(type) & static_cast<uint8_t>(RecordType::DELETE);\n+    }\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> len;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<RecordType>(uint8_type);\n+\n+        if (other_endian) {\n+            len = internal_bswap_16(len);\n+        }\n+    }\n+};\n+\n+/** Class for data in the record directly */\n+class DataRecord\n+{\n+public:\n+    DataRecord(const RecordHeader& header) : m_header(header) {}\n+    DataRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    std::vector<std::byte> data; // Variable length key/data item\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** Class for records representing internal nodes of the BTree. */\n+class InternalRecord\n+{\n+public:\n+    InternalRecord(const RecordHeader& header) : m_header(header) {}\n+    InternalRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused;                   // Padding, unused\n+    uint32_t page_num;                // Page number of referenced page\n+    uint32_t records;                 // Subtree record count\n+    std::vector<std::byte> data;      // Variable length key item\n+\n+    static constexpr size_t FIXED_SIZE = 9; // Size of fixed data is 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused;\n+        s >> page_num;\n+        s >> records;\n+\n+        data.resize(m_header.len);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+\n+        if (m_header.other_endian) {\n+            page_num = internal_bswap_32(page_num);\n+            records = internal_bswap_32(records);\n+        }\n+    }\n+};\n+\n+/** Class for records representing overflow records of the BTree.\n+ * Overflow records point to a page which contains the data in the record.\n+ * Those pages may point to further pages with the rest of the data if it does not fit\n+ * in one page */\n+class OverflowRecord\n+{\n+public:\n+    OverflowRecord(const RecordHeader& header) : m_header(header) {}\n+    OverflowRecord() = delete;\n+\n+    RecordHeader m_header;\n+\n+    uint8_t unused2;      // Padding, unused\n+    uint32_t page_number; // Page number where data begins\n+    uint32_t item_len;    // Total length of item\n+\n+    static constexpr size_t SIZE = 9; // Overflow record is always 9 bytes\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> unused2;\n+        s >> page_number;\n+        s >> item_len;\n+\n+        if (m_header.other_endian) {\n+            page_number = internal_bswap_32(page_number);\n+            item_len = internal_bswap_32(item_len);\n+        }\n+    }\n+};\n+\n+/** A generic data page in the database. Contains fields common to all data pages. */\n+class PageHeader\n+{\n+public:\n+    uint64_t lsn;       // Log Sequence Number\n+    uint32_t page_num;  // Current page number\n+    uint32_t prev_page; // Previous page number\n+    uint32_t next_page; // Next page number\n+    uint16_t entries;   // Number of items on the page\n+    uint16_t hf_offset; // High free byte page offset\n+    uint8_t level;      // Btree page level\n+    PageType type;      // Page type\n+\n+    static constexpr int64_t SIZE = 26; // The header is 26 bytes\n+\n+    uint32_t expected_page_num;\n+    bool other_endian;\n+\n+    PageHeader(uint32_t page_num, bool other_endian) : expected_page_num(page_num), other_endian(other_endian) {}\n+    PageHeader() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> prev_page;\n+        s >> next_page;\n+        s >> entries;\n+        s >> hf_offset;\n+        s >> level;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            prev_page = internal_bswap_32(prev_page);\n+            next_page = internal_bswap_32(next_page);\n+            entries = internal_bswap_16(entries);\n+            hf_offset = internal_bswap_16(hf_offset);\n+        }\n+\n+        if (expected_page_num != page_num) {\n+            throw std::runtime_error(\"Page number mismatch\");\n+        }\n+        if ((type != PageType::OVERFLOW_DATA && level < 1) || (type == PageType::OVERFLOW_DATA && level != 0)) {\n+            throw std::runtime_error(\"Bad btree level\");\n+        }\n+    }\n+};\n+\n+/** A page of records in the database */\n+class RecordsPage\n+{\n+public:\n+    RecordsPage(const PageHeader& header) : m_header(header) {}\n+    RecordsPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<std::variant<DataRecord, OverflowRecord>> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            switch (rec_hdr.GetRealType()) {\n+            case RecordType::KEYDATA:\n+            {\n+                DataRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += rec_hdr.len;\n+                break;\n+            }\n+            case RecordType::OVERFLOW_DATA:\n+            {\n+                OverflowRecord record(rec_hdr);\n+                s >> record;\n+                records.emplace_back(record);\n+                to_jump += OverflowRecord::SIZE;\n+                break;\n+            }\n+            default:\n+                throw std::runtime_error(\"Unknown record type in records page\");\n+            }\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+        }\n+    }\n+};\n+\n+/** A page containing overflow data */\n+class OverflowPage\n+{\n+public:\n+    OverflowPage(const PageHeader& header) : m_header(header) {}\n+    OverflowPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    // BDB overloads some page fields to store overflow page data\n+    // hf_offset contains the length of the overflow data stored on this page\n+    // entries contains a reference count for references to this item\n+\n+    // The overflow data itself. Begins immediately following header\n+    std::vector<std::byte> data;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        data.resize(m_header.hf_offset);\n+        s.read(AsWritableBytes(Span(data.data(), data.size())));\n+    }\n+};\n+\n+/** A page of records in the database */\n+class InternalPage\n+{\n+public:\n+    InternalPage(const PageHeader& header) : m_header(header) {}\n+    InternalPage() = delete;\n+\n+    PageHeader m_header;\n+\n+    std::vector<uint16_t> indexes;\n+    std::vector<InternalRecord> records;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        // Current position within the page\n+        int64_t pos = PageHeader::SIZE;\n+\n+        // Get the items\n+        for (uint32_t i = 0; i < m_header.entries; ++i) {\n+            // Get the index\n+            uint16_t index;\n+            s >> index;\n+            if (m_header.other_endian) {\n+                index = internal_bswap_16(index);\n+            }\n+            indexes.push_back(index);\n+            pos += sizeof(uint16_t);\n+\n+            // Go to the offset from the index\n+            int64_t to_jump = index - pos;\n+            s.ignore(to_jump);\n+\n+            // Read the record\n+            RecordHeader rec_hdr(m_header.other_endian);\n+            s >> rec_hdr;\n+            to_jump += RecordHeader::SIZE;\n+\n+            if (rec_hdr.GetRealType() != RecordType::KEYDATA) {\n+                throw std::runtime_error(\"Unknown record type in internal page\");\n+            }\n+            InternalRecord record(rec_hdr);\n+            s >> record;\n+            records.emplace_back(record);\n+            to_jump += InternalRecord::FIXED_SIZE + rec_hdr.len;\n+\n+            // Go back to the indexes\n+            s.seek(-to_jump, SEEK_CUR);\n+\n+        }\n+    }\n+};\n+\n+static void SeekToPage(AutoFile& s, uint32_t page_num, uint32_t page_size)\n+{\n+    int64_t pos = int64_t{page_num} * page_size;\n+    s.seek(pos, SEEK_SET);\n+}\n+\n+void BerkeleyRODatabase::Open()\n+{\n+    // Open the file\n+    FILE *file = fsbridge::fopen(m_filepath, \"rb\");\n+    AutoFile db_file(file);\n+    if (db_file.IsNull()) {\n+        db_file.fclose();\n+        throw std::runtime_error(\"BerkeleyRODatabase: Failed to open database file\");\n+    }\n+\n+    uint32_t page_size = 4096; // Default page size\n+\n+    // Read the outer metapage\n+    // Expected page number is 0\n+    MetaPage outer_meta(0);\n+    db_file >> outer_meta;\n+    page_size = outer_meta.pagesize;\n+\n+    // Verify the size of the file is a multiple of the page size\n+    db_file.seek(0, SEEK_END);\n+    int64_t size = db_file.tell();\n+    /* BDB doesn't actually error on this\n+    if (size % page_size != 0) {\n+        throw std::runtime_error(\"File size is not a multiple of page size\");\n+    }\n+    */\n+\n+    // Check the last page number\n+    uint32_t expected_last_page = (size / page_size) - 1;\n+    if (outer_meta.last_page != expected_last_page) {\n+        throw std::runtime_error(\"Last page number could not fit in file\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (outer_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;\n+        if (file != 0 || offset != 1) {\n+            throw std::runtime_error(\"LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\");\n+        }\n+    }\n+\n+    // Read the root page\n+    SeekToPage(db_file, outer_meta.root, page_size);\n+    PageHeader header(outer_meta.root, outer_meta.other_endian);\n+    db_file >> header;\n+    if (header.type != PageType::BTREE_LEAF) {\n+        throw std::runtime_error(\"Unexpected outer database root page type\");\n+    }\n+    if (header.entries != 2) {\n+        throw std::runtime_error(\"Unexpected number of entries in outer database root page\");\n+    }\n+    RecordsPage page(header);\n+    db_file >> page;\n+\n+    // First record should be the string \"main\"\n+    if (!std::holds_alternative<DataRecord>(page.records.at(0)) || std::get<DataRecord>(page.records.at(0)).data != SUBDATABASE_NAME) {\n+        throw std::runtime_error(\"Subdatabase has an unexpected name\");\n+    }\n+    // Check length of page number for subdatabase location\n+    if (!std::holds_alternative<DataRecord>(page.records.at(1)) || std::get<DataRecord>(page.records.at(1)).m_header.len != 4) {\n+        throw std::runtime_error(\"Subdatabase page number has unexpected length\");\n+    }\n+\n+    // Read subdatabase page number\n+    // It is written as a big endian 32 bit number\n+    uint32_t main_db_page = ReadBE32(UCharCast(std::get<DataRecord>(page.records.at(1)).data.data()));\n+\n+    // The main database is in a page that doesn't exist\n+    if (main_db_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Page number is greater than database last page\");\n+    }\n+\n+    // Read the inner metapage\n+    SeekToPage(db_file, main_db_page, page_size);\n+    MetaPage inner_meta(main_db_page);\n+    db_file >> inner_meta;\n+\n+    if (inner_meta.pagesize != page_size) {\n+        throw std::runtime_error(\"Unexpected page size\");\n+    }\n+\n+    if (inner_meta.last_page > outer_meta.last_page) {\n+        throw std::runtime_error(\"Subdatabase last page is greater than database last page\");\n+    }\n+\n+    // Make sure encryption is disabled\n+    if (inner_meta.encrypt_algo != 0) {\n+        throw std::runtime_error(\"BDB builtin encryption is not supported\");\n+    }\n+\n+    // Do a DFS through the BTree, starting at root\n+    std::vector<uint32_t> pages{inner_meta.root};\n+    while (pages.size() > 0) {\n+        uint32_t curr_page = pages.back();\n+        if (curr_page > inner_meta.last_page) {\n+            std::runtime_error(\"Page number is greater than subdatabase last page\");\n+        }\n+        pages.pop_back();\n+        SeekToPage(db_file, curr_page, page_size);\n+        PageHeader header(curr_page, inner_meta.other_endian);\n+        db_file >> header;\n+        if (header.type != PageType::BTREE_LEAF && header.type != PageType::BTREE_INTERNAL) {\n+            throw std::runtime_error(\"Unexpected inner database page type\");\n+        }\n+        switch (header.type) {\n+        case PageType::BTREE_INTERNAL:\n+        {\n+            InternalPage int_page(header);\n+            db_file >> int_page;\n+            for (const InternalRecord& rec : int_page.records) {\n+                if (rec.m_header.IsDeleted()) continue;\n+                pages.push_back(rec.page_num);\n+            }\n+            break;\n+        }\n+        case PageType::BTREE_LEAF:\n+        {\n+            RecordsPage rec_page(header);\n+            db_file >> rec_page;\n+            bool is_key = true;\n+            std::vector<std::byte> key;\n+            for (const std::variant<DataRecord, OverflowRecord>& rec : rec_page.records) {\n+                std::vector<std::byte> data;\n+                if (const DataRecord* drec = std::get_if<DataRecord>(&rec)) {\n+                    if (drec->m_header.IsDeleted()) continue;\n+                    data = drec->data;\n+                } else if (const OverflowRecord* orec = std::get_if<OverflowRecord>(&rec)) {\n+                    if (orec->m_header.IsDeleted()) continue;\n+                    uint32_t next_page = orec->page_number;\n+                    while (next_page != 0) {\n+                        SeekToPage(db_file, next_page, page_size);\n+                        PageHeader opage_header(next_page, inner_meta.other_endian);\n+                        db_file >> opage_header;\n+                        if (opage_header.type != PageType::OVERFLOW_DATA) {\n+                            throw std::runtime_error(\"Bad overflow record page type\");\n+                        }\n+                        OverflowPage opage(opage_header);\n+                        db_file >> opage;\n+                        data.insert(data.end(), opage.data.begin(), opage.data.end());\n+                        next_page = opage_header.next_page;\n+                    }\n+                }\n+\n+                if (is_key) {\n+                    key = data;\n+                } else {\n+                    m_records.emplace(SerializeData{key.begin(), key.end()}, SerializeData{data.begin(), data.end()});\n+                    key.clear();\n+                }\n+                is_key = !is_key;\n+            }",
      "path": "src/wallet/migrate.cpp",
      "position": 694,
      "original_position": 686,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": 1567831243,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point. I've added a check earlier that the number of records is even to avoid this kind of issue.",
      "created_at": "2024-04-16T20:44:06Z",
      "updated_at": "2024-04-16T20:44:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567921413",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567921413"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 694,
      "original_line": 694,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567921595",
      "pull_request_review_id": 2004566739,
      "id": 1567921595,
      "node_id": "PRRC_kwDOABII585ddJW7",
      "diff_hunk": "@@ -0,0 +1,771 @@\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <compat/byteswap.h>\n+#include <crypto/common.h> // For ReadBE32\n+#include <logging.h>\n+#include <streams.h>\n+#include <wallet/migrate.h>\n+\n+#include <optional>\n+#include <variant>\n+\n+namespace wallet {\n+// Magic bytes in both endianness's\n+constexpr uint32_t BTREE_MAGIC = 0x00053162; // If the file endianness matches our system, we see this magic\n+constexpr uint32_t BTREE_MAGIC_OE = 0x62310500; // If the file endianness is the other one, we will see this magic\n+\n+// Subdatabase name\n+static const std::vector<std::byte> SUBDATABASE_NAME = {std::byte{'m'}, std::byte{'a'}, std::byte{'i'}, std::byte{'n'}};\n+\n+enum class PageType : uint8_t\n+{\n+    /*\n+     * BDB has several page types, most of which we do not use\n+     * They are listed here for completeness, but commented out\n+     * to avoid opening something unintended.\n+    INVALID = 0,         // Invalid page type\n+    DUPLICATE = 1,       // Duplicate. Deprecated and no longer used\n+    HASH_UNSORTED = 2,   // Hash pages. Deprecated.\n+    RECNO_INTERNAL = 4,  // Recno internal\n+    RECNO_LEAF = 6,      // Recno leaf\n+    HASH_META = 8,       // Hash metadata\n+    QUEUE_META = 10,     // Queue Metadata\n+    QUEUE_DATA = 11,     // Queue Data\n+    DUPLICATE_LEAF = 12, // Off-page duplicate leaf\n+    HASH_SORTED = 13,    // Sorted hash page\n+    */\n+    BTREE_INTERNAL = 3,  // BTree internal\n+    BTREE_LEAF = 5,      // BTree leaf\n+    OVERFLOW_DATA = 7,   // Overflow\n+    BTREE_META = 9,      // BTree metadata\n+};\n+\n+enum class RecordType : uint8_t\n+{\n+    KEYDATA = 1,\n+    // DUPLICATE = 2,       Unused as our databases do not support duplicate records\n+    OVERFLOW_DATA = 3,\n+    DELETE = 0x80, // Indicate this record is deleted. This is OR'd with the real type.\n+};\n+\n+enum class BTreeFlags : uint32_t\n+{\n+    /*\n+     * BTree databases have feature flags, but we do not use them except for\n+     * subdatabases. The unused flags are included for completeness, but commented out\n+     * to avoid accidental use.\n+    DUP = 1,         // Duplicates\n+    RECNO = 2,       // Recno tree\n+    RECNUM = 4,      // BTree: Maintain record counts\n+    FIXEDLEN = 8,    // Recno: fixed length records\n+    RENUMBER = 0x10, // Recno: renumber on insert/delete\n+    DUPSORT = 0x40,  // Duplicates are sorted\n+    COMPRESS = 0x80, // Compressed\n+    */\n+    SUBDB = 0x20,    // Subdatabases\n+};\n+\n+/** Berkeley DB BTree metadata page layout */\n+class MetaPage\n+{\n+public:\n+    uint64_t lsn;             // Log Sequence Number\n+    uint32_t page_num;        // Current page number\n+    uint32_t magic;           // Magic number\n+    uint32_t version;         // Version\n+    uint32_t pagesize;        // Page size\n+    uint8_t encrypt_algo;     // Encryption algorithm\n+    PageType type;            // Page type\n+    uint8_t metaflags;        // Meta-only flags\n+    uint8_t unused1;          // Unused\n+    uint32_t free_list;       // Free list page number\n+    uint32_t last_page;       // Page number of last page in db\n+    uint32_t partitions;      // Number of partitions\n+    uint32_t key_count;       // Cached key count\n+    uint32_t record_count;    // Cached record count\n+    BTreeFlags flags;         // Flags\n+    std::array<std::byte, 20> uid; // 20 byte unique file ID\n+    uint32_t unused2;         // Unused\n+    uint32_t minkey;          // Minimum key\n+    uint32_t re_len;          // Recno: fixed length record length\n+    uint32_t re_pad;          // Recno: fixed length record pad\n+    uint32_t root;            // Root page number\n+    char unused3[368];        // 92 * 4 bytes of unused space\n+    uint32_t crypto_magic;    // Crypto magic number\n+    char trash[12];           // 3 * 4 bytes of trash space\n+    unsigned char iv[20];     // Crypto IV\n+    unsigned char chksum[16]; // Checksum\n+\n+    bool other_endian;\n+    uint32_t expected_page_num;\n+\n+    MetaPage(uint32_t expected_page_num) : expected_page_num(expected_page_num) {}\n+    MetaPage() = delete;\n+\n+    template<typename Stream>\n+    void Unserialize(Stream& s)\n+    {\n+        s >> lsn;\n+        s >> page_num;\n+        s >> magic;\n+        s >> version;\n+        s >> pagesize;\n+        s >> encrypt_algo;\n+\n+        other_endian = magic == BTREE_MAGIC_OE;\n+\n+        uint8_t uint8_type;\n+        s >> uint8_type;\n+        type = static_cast<PageType>(uint8_type);\n+\n+        s >> metaflags;\n+        s >> unused1;\n+        s >> free_list;\n+        s >> last_page;\n+        s >> partitions;\n+        s >> key_count;\n+        s >> record_count;\n+\n+        uint32_t uint32_flags;\n+        s >> uint32_flags;\n+        if (other_endian) {\n+            uint32_flags = internal_bswap_32(uint32_flags);\n+        }\n+        flags = static_cast<BTreeFlags>(uint32_flags);\n+\n+        s >> uid;\n+        s >> unused2;\n+        s >> minkey;\n+        s >> re_len;\n+        s >> re_pad;\n+        s >> root;\n+        s >> unused3;\n+        s >> crypto_magic;\n+        s >> trash;\n+        s >> iv;\n+        s >> chksum;\n+\n+        if (other_endian) {\n+            lsn = internal_bswap_64(lsn);\n+            page_num = internal_bswap_32(page_num);\n+            magic = internal_bswap_32(magic);\n+            version = internal_bswap_32(version);\n+            pagesize = internal_bswap_32(pagesize);\n+            free_list = internal_bswap_32(free_list);\n+            last_page = internal_bswap_32(last_page);\n+            partitions = internal_bswap_32(partitions);\n+            key_count = internal_bswap_32(key_count);\n+            record_count = internal_bswap_32(record_count);\n+            unused2 = internal_bswap_32(unused2);\n+            minkey = internal_bswap_32(minkey);\n+            re_len = internal_bswap_32(re_len);\n+            re_pad = internal_bswap_32(re_pad);\n+            root = internal_bswap_32(root);\n+            crypto_magic = internal_bswap_32(crypto_magic);\n+        }\n+\n+        // Page number must match\n+        if (page_num != expected_page_num) {\n+            throw std::runtime_error(\"Meta page number mismatch\");\n+        }\n+\n+        // Check magic\n+        if (magic != BTREE_MAGIC) {\n+            throw std::runtime_error(\"Not a BDB file\");\n+        }\n+\n+        // Only version 9 is supported\n+        if (version != 9) {\n+            throw std::runtime_error(\"Unsupported BDB data file version number\");\n+        }\n+\n+        // Page size must be 512 <= pagesize <= 64k, and be a power of 2\n+        if (pagesize < 512 || pagesize > 65536 ||  (pagesize & (pagesize - 1)) != 0) {\n+            throw std::runtime_error(\"Bad page size\");\n+        }\n+\n+        // Page type must be the btree type\n+        if (type != PageType::BTREE_META) {\n+            throw std::runtime_error(\"Unexpected page type, should be 9 (BTree Metadata)\");\n+        }\n+\n+        // Only supported meta-flag is subdatabase\n+        if (flags != BTreeFlags::SUBDB) {\n+            throw std::runtime_error(\"Unexpected database flags, should only be 0x20 (subdatabases)\");\n+        }\n+    }\n+};\n+\n+/** General class for records in a BDB BTree database. Contains common fields. */\n+class RecordHeader\n+{\n+public:\n+    uint16_t len;  // Key/data item length\n+    RecordType type;  // Page type and DELETE FLAG\n+\n+    static constexpr size_t SIZE = 3; // The record header is 3 bytes\n+\n+    bool other_endian;\n+\n+    RecordHeader(bool other_endian) : other_endian(other_endian) {}\n+    RecordHeader() = delete;\n+\n+    RecordType GetRealType() const\n+    {\n+        return static_cast<RecordType>(static_cast<uint8_t>(type) & ~static_cast<uint8_t>(RecordType::DELETE));",
      "path": "src/wallet/migrate.cpp",
      "position": null,
      "original_position": 216,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "ae58ab0a1d9c1cb00fbe37956564012a9bf72d7c",
      "in_reply_to_id": 1567845152,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done as suggested.",
      "created_at": "2024-04-16T20:44:17Z",
      "updated_at": "2024-04-16T20:44:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1567921595",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1567921595"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 216,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1573675369",
      "pull_request_review_id": 2013355543,
      "id": 1573675369,
      "node_id": "PRRC_kwDOABII585dzGFp",
      "diff_hunk": "@@ -557,6 +557,20 @@ void BerkeleyRODatabase::Open()\n         throw std::runtime_error(\"BDB builtin encryption is not supported\");\n     }\n \n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;",
      "path": "src/wallet/migrate.cpp",
      "position": 574,
      "original_position": 12,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f4f7eda0bf0e798d305df331c1d94443b81dff22",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The check currently always fails for other-endian wallets, needs something like:\r\n```diff\r\ndiff --git a/src/wallet/migrate.cpp b/src/wallet/migrate.cpp\r\nindex 15478e8bc5bfe39e04b400fa475215e25eef6452..0a41ae199e1950bf372bae90b8a88fccca2b88f0 100644\r\n--- a/src/wallet/migrate.cpp\r\n+++ b/src/wallet/migrate.cpp\r\n@@ -566,6 +566,10 @@ void BerkeleyRODatabase::Open()\r\n         uint32_t offset;\r\n         SeekToPage(db_file, i, page_size);\r\n         db_file >> file >> offset;\r\n+        if (outer_meta.other_endian) {\r\n+            file = internal_bswap_32(file);\r\n+            offset = internal_bswap_32(offset);\r\n+        }\r\n         if (file != 0 || offset != 1) {\r\n             throw std::runtime_error(\"LSNs are not reset, this database is not completely flushed. Please reopen then close the database with a version that has BDB support\");\r\n         }\r\n```",
      "created_at": "2024-04-21T08:46:09Z",
      "updated_at": "2024-04-21T08:46:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1573675369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1573675369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 574,
      "original_line": 574,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1573680139",
      "pull_request_review_id": 2013358301,
      "id": 1573680139,
      "node_id": "PRRC_kwDOABII585dzHQL",
      "diff_hunk": "@@ -16,7 +17,25 @@ std::unique_ptr<DatabaseBatch> BerkeleyRODatabase::MakeBatch(bool flush_on_close\n \n bool BerkeleyRODatabase::Backup(const std::string& dest) const\n {\n-    return false;\n+    fs::path src(m_filepath);\n+    fs::path dst(fs::PathFromString(dest));\n+\n+    if (fs::is_directory(dst)) {\n+        dst = BDBDataFile(dst);\n+    }\n+    try {\n+        if (fs::exists(dst) && fs::equivalent(src, dst)) {\n+            LogPrintf(\"cannot backup to wallet source file %s\\n\", fs::PathToString(dst));\n+            return false;\n+        }\n+\n+        fs::copy_file(src, dst, fs::copy_options::overwrite_existing);\n+        LogPrintf(\"copied %s to %s\\n\", fs::PathToString(m_filepath), fs::PathToString(dst));\n+        return true;\n+    } catch (const fs::filesystem_error& e) {\n+        LogPrintf(\"error copying %s to %s - %s\\n\", fs::PathToString(m_filepath), fs::PathToString(dst), fsbridge::get_filesystem_error_message(e));\n+        return false;\n+    }",
      "path": "src/wallet/migrate.cpp",
      "position": 728,
      "original_position": 31,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15: Is this used in this pull request? I wonder if it could make sense to return the error string to the caller, assuming this is called by RPC eventually?",
      "created_at": "2024-04-21T09:03:47Z",
      "updated_at": "2024-04-21T09:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1573680139",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1573680139"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": 710,
      "original_start_line": 20,
      "start_side": "RIGHT",
      "line": 728,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1575302127",
      "pull_request_review_id": 2015713662,
      "id": 1575302127,
      "node_id": "PRRC_kwDOABII585d5TPv",
      "diff_hunk": "@@ -557,6 +557,20 @@ void BerkeleyRODatabase::Open()\n         throw std::runtime_error(\"BDB builtin encryption is not supported\");\n     }\n \n+    // Check all LSNs point to file 0 and offset 1 which indicates that the LSNs were\n+    // reset and that the log files are not necessary to get all of the data in the database.\n+    for (uint32_t i = 0; i < outer_meta.last_page; ++i) {\n+        // The LSN is composed of 2 32-bit ints, the first is a file id, the second an offset\n+        // It will always be the first 8 bytes of a page, so we deserialize it directly for every page\n+        uint32_t file;\n+        uint32_t offset;\n+        SeekToPage(db_file, i, page_size);\n+        db_file >> file >> offset;",
      "path": "src/wallet/migrate.cpp",
      "position": 574,
      "original_position": 12,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "f4f7eda0bf0e798d305df331c1d94443b81dff22",
      "in_reply_to_id": 1573675369,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch, fixed",
      "created_at": "2024-04-22T20:07:09Z",
      "updated_at": "2024-04-22T20:07:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1575302127",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1575302127"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 574,
      "original_line": 574,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1575308063",
      "pull_request_review_id": 2015723755,
      "id": 1575308063,
      "node_id": "PRRC_kwDOABII585d5Usf",
      "diff_hunk": "@@ -16,7 +17,25 @@ std::unique_ptr<DatabaseBatch> BerkeleyRODatabase::MakeBatch(bool flush_on_close\n \n bool BerkeleyRODatabase::Backup(const std::string& dest) const\n {\n-    return false;\n+    fs::path src(m_filepath);\n+    fs::path dst(fs::PathFromString(dest));\n+\n+    if (fs::is_directory(dst)) {\n+        dst = BDBDataFile(dst);\n+    }\n+    try {\n+        if (fs::exists(dst) && fs::equivalent(src, dst)) {\n+            LogPrintf(\"cannot backup to wallet source file %s\\n\", fs::PathToString(dst));\n+            return false;\n+        }\n+\n+        fs::copy_file(src, dst, fs::copy_options::overwrite_existing);\n+        LogPrintf(\"copied %s to %s\\n\", fs::PathToString(m_filepath), fs::PathToString(dst));\n+        return true;\n+    } catch (const fs::filesystem_error& e) {\n+        LogPrintf(\"error copying %s to %s - %s\\n\", fs::PathToString(m_filepath), fs::PathToString(dst), fsbridge::get_filesystem_error_message(e));\n+        return false;\n+    }",
      "path": "src/wallet/migrate.cpp",
      "position": 728,
      "original_position": 31,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "a0b4c1b7a3bfeaeae0277fe151cd5ef9b31ccf15",
      "in_reply_to_id": 1573680139,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Is this used in this pull request?\r\n\r\nNo, it's used in the followup.\r\n\r\n> I wonder if it could make sense to return the error string to the caller, assuming this is called by RPC eventually?\r\n\r\n`Backup` is a part of the `WalletDatabase` parent class, so changing this would also mean changing the `Backup` of existing database classes, and all of their callers. I think that's something that would be worth doing in a followup, but not this PR.",
      "created_at": "2024-04-22T20:13:12Z",
      "updated_at": "2024-04-22T20:13:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1575308063",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1575308063"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": 710,
      "original_start_line": 20,
      "start_side": "RIGHT",
      "line": 728,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1576327472",
      "pull_request_review_id": 2017378701,
      "id": 1576327472,
      "node_id": "PRRC_kwDOABII585d9Nkw",
      "diff_hunk": "@@ -87,8 +87,9 @@ void WalletInit::AddWalletOptions(ArgsManager& argsman) const\n     argsman.AddArg(\"-dblogsize=<n>\", strprintf(\"Flush wallet database activity from memory to disk log every <n> megabytes (default: %u)\", DatabaseOptions().max_log_mb), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n     argsman.AddArg(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n     argsman.AddArg(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", !DatabaseOptions().use_shared_memory), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n+    argsman.AddArg(\"-swapbdbendian\", \"Swaps the internal endianness of BDB wallet databases (default: false)\", ArgsManager:: ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n #else\n-    argsman.AddHiddenArgs({\"-dblogsize\", \"-flushwallet\", \"-privdb\"});\n+    argsman.AddHiddenArgs({\"-dblogsize\", \"-flushwallet\", \"-privdb\", \"swapbdbendian\"});",
      "path": "src/wallet/init.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "dc938e90323b15d5fdc25cacd2d14bd0ff370c01",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "CI linter complains, apparently the option needs to be added in another place:\r\n```\r\nAssertionError: Please add {'-swapbdbendian'} to the hidden args in DummyWalletInit::AddWalletOptions\r\n```\r\nEdit: maybe forgotten `-`?",
      "created_at": "2024-04-23T14:05:46Z",
      "updated_at": "2024-04-23T14:07:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1576327472",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1576327472"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 92,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1576483883",
      "pull_request_review_id": 2017637372,
      "id": 1576483883,
      "node_id": "PRRC_kwDOABII585d9zwr",
      "diff_hunk": "@@ -87,8 +87,9 @@ void WalletInit::AddWalletOptions(ArgsManager& argsman) const\n     argsman.AddArg(\"-dblogsize=<n>\", strprintf(\"Flush wallet database activity from memory to disk log every <n> megabytes (default: %u)\", DatabaseOptions().max_log_mb), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n     argsman.AddArg(\"-flushwallet\", strprintf(\"Run a thread to flush wallet periodically (default: %u)\", DEFAULT_FLUSHWALLET), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n     argsman.AddArg(\"-privdb\", strprintf(\"Sets the DB_PRIVATE flag in the wallet db environment (default: %u)\", !DatabaseOptions().use_shared_memory), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n+    argsman.AddArg(\"-swapbdbendian\", \"Swaps the internal endianness of BDB wallet databases (default: false)\", ArgsManager:: ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::WALLET_DEBUG_TEST);\n #else\n-    argsman.AddHiddenArgs({\"-dblogsize\", \"-flushwallet\", \"-privdb\"});\n+    argsman.AddHiddenArgs({\"-dblogsize\", \"-flushwallet\", \"-privdb\", \"swapbdbendian\"});",
      "path": "src/wallet/init.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "837d656f8cbeeec5e30c129aa1beac8816a35651",
      "original_commit_id": "dc938e90323b15d5fdc25cacd2d14bd0ff370c01",
      "in_reply_to_id": 1576327472,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oops fixed.",
      "created_at": "2024-04-23T15:41:34Z",
      "updated_at": "2024-04-23T15:41:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26606#discussion_r1576483883",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1576483883"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26606"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 92,
      "side": "RIGHT"
    }
  ]
}
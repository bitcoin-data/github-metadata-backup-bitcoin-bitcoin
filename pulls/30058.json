{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058",
    "id": 1859156716,
    "node_id": "PR_kwDOABII585u0Hrs",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30058",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30058.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30058.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/5dfbc354a7aae9df5b9cfd839981874cb911d06d",
    "number": 30058,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Encapsulate warnings in generalized node::Warnings and remove globals",
    "user": {
      "login": "stickies-v",
      "id": 69010457,
      "node_id": "MDQ6VXNlcjY5MDEwNDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stickies-v",
      "html_url": "https://github.com/stickies-v",
      "followers_url": "https://api.github.com/users/stickies-v/followers",
      "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
      "organizations_url": "https://api.github.com/users/stickies-v/orgs",
      "repos_url": "https://api.github.com/users/stickies-v/repos",
      "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/stickies-v/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR:\r\n- moves warnings from common to the node library and into the node namespace (as suggested in https://github.com/bitcoin/bitcoin/pull/29845#discussion_r1570069541)\r\n- generalizes the warnings interface to `Warnings::Set()` and `Warnings::Unset()` methods, instead of having a separate function and globals for each warning. As a result, this simplifies the `kernel::Notifications` interface.\r\n- removes warnings.cpp from the kernel library\r\n- removes warning globals\r\n- adds testing for the warning logic\r\n\r\nBehaviour change introduced:\r\n- the `-alertnotify` command is executed for all `KernelNotifications::warningSet` calls, which now also covers the `large-work-invalid-chain` warning\r\n- the GUI is updated automatically whenever a warning is (un)set, covering some code paths where it previously wouldn't be, e.g. when `node::AbortNode()` is called, or for the `large-work-invalid-chain` warning\r\n\r\nSome discussion points:\r\n- is `const std::string& id` the best way to refer to warnings? Enums are an obvious alternative, but since we need to define warnings across libraries, strings seem like a straightforward solution.",
    "labels": [],
    "created_at": "2024-05-07T22:32:44Z",
    "updated_at": "2024-05-23T22:23:54Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "eb684536bf713234c22138b13d4c317c0f023607",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "stickies-v:2024-04/move-warnings-node",
      "ref": "2024-04/move-warnings-node",
      "sha": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 431644530,
        "node_id": "R_kgDOGbpfcg",
        "name": "bitcoin",
        "full_name": "stickies-v/bitcoin",
        "owner": {
          "login": "stickies-v",
          "id": 69010457,
          "node_id": "MDQ6VXNlcjY5MDEwNDU3",
          "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/stickies-v",
          "html_url": "https://github.com/stickies-v",
          "followers_url": "https://api.github.com/users/stickies-v/followers",
          "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
          "organizations_url": "https://api.github.com/users/stickies-v/orgs",
          "repos_url": "https://api.github.com/users/stickies-v/repos",
          "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/stickies-v/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/stickies-v/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/stickies-v/bitcoin",
        "archive_url": "https://api.github.com/repos/stickies-v/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/stickies-v/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/stickies-v/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/stickies-v/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/stickies-v/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/stickies-v/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/stickies-v/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/stickies-v/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/stickies-v/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/stickies-v/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/stickies-v/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/stickies-v/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/stickies-v/bitcoin/events",
        "forks_url": "https://api.github.com/repos/stickies-v/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/stickies-v/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/stickies-v/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/stickies-v/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/stickies-v/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/stickies-v/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/stickies-v/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/stickies-v/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/stickies-v/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/stickies-v/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/stickies-v/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/stickies-v/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/stickies-v/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/stickies-v/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/stickies-v/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/stickies-v/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:stickies-v/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/stickies-v/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/stickies-v/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/stickies-v/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/stickies-v/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/stickies-v/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/stickies-v/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/stickies-v/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/stickies-v/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/stickies-v/bitcoin/hooks",
        "svn_url": "https://github.com/stickies-v/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 250968,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-23T21:11:20Z",
        "created_at": "2021-11-24T22:26:41Z",
        "updated_at": "2023-12-02T14:25:33Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "413844f1c2a3d8f7cfef822f348f26df488b03c7",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35436,
        "stargazers_count": 76512,
        "watchers_count": 76512,
        "size": 259219,
        "default_branch": "master",
        "open_issues_count": 685,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-23T22:39:06Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-05-23T22:26:28Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 371,
    "deletions": 184,
    "changed_files": 39,
    "commits": 5,
    "review_comments": 16,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2099421515,
      "node_id": "IC_kwDOABII5859IqFL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2099421515",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T22:32:46Z",
      "updated_at": "2024-05-23T20:52:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30058).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/30058#issuecomment-2100025531) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/30058#pullrequestreview-2074413782) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30157](https://github.com/bitcoin/bitcoin/pull/30157) (Fee Estimation via Fee rate Forecasters by ismaelsadeeq)\n* [#30141](https://github.com/bitcoin/bitcoin/pull/30141) (kernel: De-globalize validation caches by TheCharlatan)\n* [#30115](https://github.com/bitcoin/bitcoin/pull/30115) (rpc: avoid copying into UniValue by theuni)\n* [#30110](https://github.com/bitcoin/bitcoin/pull/30110) (refactor: TxDownloadManager by glozow)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n* [#29415](https://github.com/bitcoin/bitcoin/pull/29415) (Broadcast own transactions only via short-lived Tor or I2P connections by vasild)\n* [#29039](https://github.com/bitcoin/bitcoin/pull/29039) (versionbits refactoring by ajtowns)\n* [#29015](https://github.com/bitcoin/bitcoin/pull/29015) (kernel: Streamline util library by ryanofsky)\n* [#28830](https://github.com/bitcoin/bitcoin/pull/28830) ([refactor] Check CTxMemPool options in ctor by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#issuecomment-2099421515",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T22:33:47Z",
      "updated_at": "2024-05-07T22:33:47Z",
      "source": {
        "issue": {
          "id": 2235262089,
          "node_id": "PR_kwDOABII585sOo01",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29845",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29845/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29845/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29845/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29845",
          "number": 29845,
          "state": "closed",
          "state_reason": null,
          "title": "rpc: return warnings as an array instead of just a single one",
          "body": "The RPC documentation for `getblockchaininfo`, `getmininginfo` and `getnetworkinfo` states that \"warnings\" returns \"any network and blockchain warnings\". In practice, only a single warning (i.e. the latest one that is set) is returned, the other ones are ignored.\r\n\r\nFix that by returning all warnings as an array.\r\n\r\nAs a side benefit, clean up the GetWarnings() logic.\r\n\r\nSince this PR changes the RPC result schema, I've added release notes. Users can temporarily revert to the old results by using `-deprecatedrpc=warnings`, until it's removed in a future version.\r\n\r\n---\r\n\r\nSome historical context from git log:\r\n\r\n- when `GetWarnings` was introduced in 401926283a200994ecd7df8eae8ced8e0b067c46, it was used in the `getinfo` RPC, where only a [single error/warning was returned](https://github.com/bitcoin/bitcoin/commit/401926283a200994ecd7df8eae8ced8e0b067c46#diff-7442c48d42cd5455a79915a0f00cce5e13359db46437a32b812876edb0a5ccddR250) (similar to how it is now).\r\n- later on, \"warnings\" RPC response fields were introduced, e.g. in ef2a3de25c882396e1776b554878d2784b6b7391, with the description [stating](https://github.com/bitcoin/bitcoin/commit/ef2a3de25c882396e1776b554878d2784b6b7391#diff-1021bd3c74415ad9719bd764ad6ca35af5dfb33b1cd863c0be49bdf52518af54R411) that it returned \"any network warnings\" but in practice still only a single warning was returned",
          "user": {
            "login": "stickies-v",
            "id": 69010457,
            "node_id": "MDQ6VXNlcjY5MDEwNDU3",
            "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/stickies-v",
            "html_url": "https://github.com/stickies-v",
            "followers_url": "https://api.github.com/users/stickies-v/followers",
            "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
            "organizations_url": "https://api.github.com/users/stickies-v/orgs",
            "repos_url": "https://api.github.com/users/stickies-v/repos",
            "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/stickies-v/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 11,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29845",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29845",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29845.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29845.patch"
          },
          "closed_at": "2024-05-06T16:24:22Z",
          "created_at": "2024-04-10T10:29:39Z",
          "updated_at": "2024-05-10T04:14:22Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12736191814,
      "node_id": "HRFPE_lADOABII586IKCIlzwAAAAL3It1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12736191814",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T22:39:31Z"
    },
    {
      "event": "labeled",
      "id": 12736192265,
      "node_id": "LE_lADOABII586IKCIlzwAAAAL3It8J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12736192265",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T22:39:35Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2099427909,
      "node_id": "IC_kwDOABII5859IrpF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2099427909",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T22:39:36Z",
      "updated_at": "2024-05-07T22:39:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/24704508399</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#issuecomment-2099427909",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T06:58:52Z",
      "updated_at": "2024-05-08T06:58:52Z",
      "source": {
        "issue": {
          "id": 2182604130,
          "node_id": "PR_kwDOABII585pbmSj",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29641",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29641/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29641/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29641/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29641",
          "number": 29641,
          "state": "open",
          "state_reason": null,
          "title": "scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint",
          "body": "`LogPrintf/LogPrint` are problematic, because:\r\n\r\n* Their name is non-descriptive of what the function does (info logging or debug logging).\r\n* They are deprecated aliases, where code is using either the deprecated or non-deprecated alias, which is inconsistent and confusing.\r\n\r\nFix all issues by replacing the usage.\r\n\r\nWhile the diff is large and may cause merge conflicts or backport conflicts, I don't see the deprecated aliases being kept forever, so this will have to be done at some point. All conflicts should be trivial to solve, in any case.",
          "user": {
            "login": "maflcko",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/maflcko",
            "html_url": "https://github.com/maflcko",
            "followers_url": "https://api.github.com/users/maflcko/followers",
            "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
            "organizations_url": "https://api.github.com/users/maflcko/orgs",
            "repos_url": "https://api.github.com/users/maflcko/repos",
            "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/maflcko/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29641",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29641",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29641.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29641.patch"
          },
          "created_at": "2024-03-12T20:21:40Z",
          "updated_at": "2024-05-23T16:44:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T07:57:07Z",
      "updated_at": "2024-05-08T07:57:07Z",
      "source": {
        "issue": {
          "id": 2134155715,
          "node_id": "PR_kwDOABII585m2Xsr",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29432",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29432/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29432/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29432/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29432",
          "number": 29432,
          "state": "open",
          "state_reason": null,
          "title": "Stratum v2 Template Provider (take 3)",
          "body": "Based on on @Fi3's https://github.com/bitcoin/bitcoin/compare/master...Fi3:bitcoin:PatchTemplates which is based on @ccdle12's #27854. I rebased it and re-wrote the commit history. Compared to #28983 it introduces EllSwift in the handshake and fixes various bugs. I used that opportunity to change the branch name, which makes testing against [SRI](https://github.com/stratum-mining/stratum) slightly easier. There's no conceptual discussion on #28983 so it can be ignored by reviewers.\r\n\r\nSee [docs/stratum-v2.md](https://github.com/Sjors/bitcoin/blob/sv2/doc/stratum-v2.md) for a brief description of Stratum v2 and the role of Bitcoin Core in that system..\r\n\r\n## What to test and review?\r\n\r\nI'll make separate pull requests for parts that are ready for detailed review.\r\n\r\n- [ ] #29346\r\n- [ ] #29295 \r\n- [ ] Custom signet mining improvement: #29032\r\n- [ ] Make nested pull-requests easier: #29274\r\n\r\nSee the [testing guide](https://github.com/Sjors/bitcoin/blob/2023/11/sv2-poll/doc/stratum-v2.md#testing-guide) for various ways to test this PR. This branch is actively used by (testnet) pools, so it should be ready for high level review.\r\n\r\n### Related useful PRs\r\n\r\n- [ ] #26812\r\n\r\n## Implementation notes\r\n\r\nThere's roughly three layers:\r\n\r\n1. Noise encryption #29346\r\n2. Messages and transport layer\r\n3. The Template Provider\r\n\r\n* the `ci:` commits (#29274) are there to facilitate PR's against this branch, but they are not blocking for Stratum v2\r\n* the commits that move `transport.h` and some other stuff from `node` to `common` are not blocking. But in the longer run I'd like to see process separation between the node and the template provider.\r\n* I will occasionally add commits to _undo_ bug fixes, in order to stay compatible with the SRI `main` branch. Those will get dropped over time and can be ignored. \r\n\r\n## Contributing\r\n\r\nIf you want to help out with any of the issues below, please open a PR to my fork. I will then squash your commits into my own where needed. \r\n\r\n## Things left todo\r\n\r\n### Spec\r\n\r\n- [ ] modify spec to use `ProvideMissingTransactions`? (followup?)\r\n- [ ] pick a good default for `default_coinbase_tx_additional_output_size` (see `getblocktemplate` RPC)\r\n\r\n### Networking\r\n\r\n- [ ] add `-sv2bind` and `-sv2allowip`\r\n- [ ] optional `-sv2cert`\r\n- [ ] drop `Sv2TemplateProvider::SendBuf`, reuse p2p socket handling if possible\r\n- [ ] limit number of connected clients\r\n- [ ] maybe limit (number of) `coinbase_output_max_additional_size`\r\n- [ ] TMP / TODO comments at the top of `sv2_messages.h`\r\n\r\n### Testing\r\n\r\n- [ ] expand sv2_template_provider_tests\r\n- [ ] add transport fuzzer\r\n- [ ] add template provider fuzzer\r\n\r\n### Template generation and updating\r\n\r\n- [ ] group templates with the same `coinbase_tx_additional_output_size`\r\n- [ ] don't generate templates when no client is connected\r\n\r\n### Misc\r\n\r\n- [ ] move / refactor `GetMerklePathForCoinbase` helper (see Future Work in original PR, and https://github.com/stratum-mining/stratum/issues/567)\r\n- [ ] truncate long trace messages\r\n\r\n## Potential followups\r\n\r\n- [ ] implement Noise protocol and mock client in Python, add functional tests (based on `test/sv2_template_provider_tests.cpp`)\r\n- [ ] use process separation, e.g. a `bitcoin-tp` binary, see [multiprocess.md](https://github.com/bitcoin/bitcoin/blob/master/doc/design/multiprocess.md?plain=1)\r\n- [ ] make template updates push based, on top of Cluster Mempool, see [docs/stratum-v2.md](https://github.com/Sjors/bitcoin/blob/2023/11/sv2-poll/doc/stratum-v2.md) (for new blocks it's already push based)\r\n- [ ] push empty template for the next block (downstream can ignore or use, https://github.com/stratum-mining/stratum/issues/715)\r\n  - send prevhash for this template as soon as any new block arrives\r\n- [ ] push optimistic template for the next block\r\n  - send prevhash if and only if our template won (i.e. we got a `SubmitSolution` message)",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 15,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29432",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29432",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29432.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29432.patch"
          },
          "created_at": "2024-02-14T11:34:49Z",
          "updated_at": "2024-05-15T10:12:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T08:08:13Z",
      "updated_at": "2024-05-08T08:08:13Z",
      "source": {
        "issue": {
          "id": 2127176950,
          "node_id": "PR_kwDOABII585me8Nn",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29415/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29415",
          "number": 29415,
          "state": "open",
          "state_reason": null,
          "title": "Broadcast own transactions only via short-lived Tor or I2P connections",
          "body": "To improve privacy, broadcast locally submitted transactions (from the `sendrawtransaction` RPC) to the P2P network only via Tor or I2P short-lived connections.\r\n\r\n* Introduce a new connection type for private broadcast of transactions with the following properties:\r\n  * started whenever there are local transactions to be sent\r\n  * only opened to Tor or I2P peers\r\n  * opened regardless of max connections limits\r\n  * after handshake is completed one local transaction is pushed to the peer, `PING` is sent and after receiving `PONG` the connection is closed\r\n  * ignore all incoming messages after handshake is completed (except `PONG`)\r\n\r\n* Broadcast transactions submitted via `sendrawtransaction` using this new mechanism, to a few Tor or I2P peers. Keep doing this until we receive an `INV` about this transaction from one of our ordinary peers (this takes about 1 second on mainnet).\r\n\r\n* The transaction is stored in peerman and does not enter the mempool.\r\n\r\n* Once we get an `INV` from somebody, then the normal flow executes: we request the transaction with `GETDATA`, receive it with a `TX` message, put it in our mempool and broadcast it to all our existent connections (as if we see it for the first time).\r\n\r\n* After we receive the full transaction as a `TX` message, in reply to our `GETDATA` request, only then consider the transaction has propagated through the network and remove it from the storage in peerman, ending the private broadcast attempts.\r\n\r\nThe messages exchange should look like this:\r\n\r\n```\r\ntx-sender >--- connect -------> tx-recipient\r\ntx-sender >--- VERSION -------> tx-recipient (dummy VERSION with no revealing data)\r\ntx-sender <--- VERSION -------< tx-recipient\r\ntx-sender <--- WTXIDRELAY ----< tx-recipient (maybe)\r\ntx-sender <--- SENDADDRV2 ----< tx-recipient (maybe)\r\ntx-sender <--- SENDTXRCNCL ---< tx-recipient (maybe)\r\ntx-sender <--- VERACK --------< tx-recipient\r\ntx-sender >--- VERACK --------> tx-recipient\r\ntx-sender >--- TX ------------> tx-recipient\r\ntx-sender >--- PING ----------> tx-recipient\r\ntx-sender <--- PONG ----------< tx-recipient\r\ntx-sender disconnects\r\n```\r\n\r\nWhenever a new transaction is received from `sendrawtransaction` RPC, the node will send it to 5 (`NUM_PRIVATE_BROADCAST_PER_TX`) recipients right away. If after 10-15 mins we still have not heard anything about the transaction from the network, then it will be sent to 1 more peer (see `PeerManagerImpl::ReattemptPrivateBroadcast()`).\r\n\r\nA few considerations:\r\n* The short-lived private broadcast connections are very cheap and fast wrt network traffic. It is expected that some of those peers could blackhole the transaction. Just one honest/proper peer is enough for successful propagation.\r\n* The peers that receive the transaction could deduce that this is initial transaction broadcast from the transaction originator. This is ok, they can't identify the sender.\r\n\r\n---\r\n\r\nSome explanation of the commits:\r\n\r\n* New logging category and config option to enable private broadcast\r\n  * `log: introduce a new category for private broadcast`\r\n  * `init: introduce a new option to enable/disable private broadcast`\r\n\r\n* Implement the private broadcast connection handling on the `CConnman` side:\r\n  * `net: introduce a new connection type for private broadcast`\r\n  * `net: move peers counting before grant acquisition in ThreadOpenConnections()`\r\n  * `net: implement opening PRIVATE_BROADCAST connections`\r\n\r\n* Prepare `BroadcastTransaction()` for private broadcast requests:\r\n  * `net_processing: rename RelayTransaction to better describe what it does`\r\n  * `node: change a tx-relay on/off flag to a tri-state`\r\n  * `net_processing: store transactions for private broadcast in PeerManager`\r\n\r\n* Implement the private broadcast connection handling on the `PeerManager` side:\r\n  * `net_processing: reorder the code that handles the VERSION message`\r\n  * `net_processing: handle ConnectionType::PRIVATE_BROADCAST connections`\r\n  * `net_processing: stop private broadcast of a transaction after round-trip`\r\n  * `net_processing: retry private broadcast`\r\n\r\n* Engage the new functionality from `sendrawtransaction`:\r\n  * `rpc: use private broadcast from sendrawtransaction RPC if -privatebroadcast is ON`\r\n\r\n* Independent test framework improvements (also opened as a standalone PR at https://github.com/bitcoin/bitcoin/pull/29420):\r\n  * `test: improve debug log message from P2PConnection::connection_made()`\r\n  * `test: extend the SOCKS5 Python proxy to actually connect to a destination`\r\n  * `test: support WTX INVs from P2PDataStore and fix a comment`\r\n  * `test: set P2PConnection::p2p_connected_to_node in peer_connect_helper()`\r\n\r\n* New functional test that exercies some of the new code:\r\n  * `test: add functional test for local tx relay`\r\n\r\n---\r\n\r\nThis addresses:\r\nhttps://github.com/bitcoin/bitcoin/issues/3828 Clients leak IPs if they are recipients of a transaction\r\nhttps://github.com/bitcoin/bitcoin/issues/14692 Can't configure bitocoind to only send tx via Tor but receive clearnet transactions\r\nhttps://github.com/bitcoin/bitcoin/issues/19042 Tor-only transaction broadcast onlynet=onion alternative\r\nhttps://github.com/bitcoin/bitcoin/issues/24557 Option for receive events with all networks, but send transactions and/or blocks only with anonymous network[s]?\r\nhttps://github.com/bitcoin/bitcoin/issues/25450 Ability to broadcast wallet transactions only via dedicated oneshot Tor connections\r\n\r\nRelated, but different:\r\nhttps://github.com/bitcoin/bitcoin/issues/21876 Broadcast a transaction to specific nodes\r\nhttps://github.com/bitcoin/bitcoin/issues/28636 new RPC: sendrawtransactiontopeer\r\n\r\n---\r\n\r\nNext step after this PR is done will be to have the wallet do the private broadcast as well, https://github.com/bitcoin/bitcoin/issues/11887 would have to be resolved.\r\n\r\n---\r\n\r\n_A previous incarnation of this can be found at https://github.com/bitcoin/bitcoin/pull/27509. It puts the transaction in the mempool and (tries to) hide it from the outside observers. This turned out to be too error prone or maybe even impossible._\r\n",
          "user": {
            "login": "vasild",
            "id": 266751,
            "node_id": "MDQ6VXNlcjI2Njc1MQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/vasild",
            "html_url": "https://github.com/vasild",
            "followers_url": "https://api.github.com/users/vasild/followers",
            "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
            "organizations_url": "https://api.github.com/users/vasild/orgs",
            "repos_url": "https://api.github.com/users/vasild/repos",
            "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/vasild/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 32,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29415",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29415",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29415.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29415.patch"
          },
          "created_at": "2024-02-09T13:39:10Z",
          "updated_at": "2024-05-22T16:26:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 2100025531,
      "node_id": "IC_kwDOABII5859K9i7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2100025531",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T08:24:06Z",
      "updated_at": "2024-05-08T08:24:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK on removing the warnings globals.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#issuecomment-2100025531",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T09:24:46Z",
      "updated_at": "2024-05-08T09:24:46Z",
      "source": {
        "issue": {
          "id": 2033608154,
          "node_id": "PR_kwDOABII585hkxaw",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29039",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29039/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29039/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29039/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29039",
          "number": 29039,
          "state": "open",
          "state_reason": null,
          "title": "versionbits refactoring",
          "body": "Increases the encapsulation/modularity of the versionbits code, moving more of the logic into the versionbits module rather than having it scattered across validation and rpc code. Updates unit/fuzz tests to test the actual code used rather than just a close approximation of it.",
          "user": {
            "login": "ajtowns",
            "id": 127186,
            "node_id": "MDQ6VXNlcjEyNzE4Ng==",
            "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ajtowns",
            "html_url": "https://github.com/ajtowns",
            "followers_url": "https://api.github.com/users/ajtowns/followers",
            "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
            "organizations_url": "https://api.github.com/users/ajtowns/orgs",
            "repos_url": "https://api.github.com/users/ajtowns/repos",
            "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ajtowns/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29039",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29039",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29039.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29039.patch"
          },
          "created_at": "2023-12-09T04:34:57Z",
          "updated_at": "2024-05-23T16:49:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T09:49:59Z",
      "updated_at": "2024-05-08T09:49:59Z",
      "source": {
        "issue": {
          "id": 1985417135,
          "node_id": "PR_kwDOABII585fBgeM",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28830",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28830/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28830/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28830/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28830",
          "number": 28830,
          "state": "open",
          "state_reason": null,
          "title": "[refactor] Check CTxMemPool options in ctor",
          "body": "The tests should run the same checks on the mempool options that the init code also applies. The downside to this patch is that the log line may now be printed more than once in the for loop.\r\n\r\nThis was originally noticed here https://github.com/bitcoin/bitcoin/pull/25290#discussion_r900272797.\r\n",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 15,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28830",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28830",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28830.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28830.patch"
          },
          "created_at": "2023-11-09T11:24:01Z",
          "updated_at": "2024-05-18T09:18:22Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12747935625,
      "node_id": "HRFPE_lADOABII586IKCIlzwAAAAL31g-J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12747935625",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T18:45:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12748766357,
      "node_id": "HRFPE_lADOABII586IKCIlzwAAAAL34ryV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12748766357",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T20:05:59Z"
    },
    {
      "event": "commented",
      "id": 2101342201,
      "node_id": "IC_kwDOABII5859P-_5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2101342201",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T20:08:42Z",
      "updated_at": "2024-05-08T20:08:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "Force-pushed to address compilation failure on non-macOS systems:\r\n- moved `GetNodeWarnings()` (in `rpc/util.cpp`) to `node::GetWarningsForRpc()` (in `node/warnings.cpp`). Since `rpc/util.cpp` is in `common`, this causes issues after warnings are moved to `node`. I don't love this approach, but it seemed like the least bad one - open to suggestions if anyone has any?\r\n- updated bitcoin-chainstate.cpp to the new `kernel::Notifications` interface",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#issuecomment-2101342201",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30058"
    },
    {
      "event": "unlabeled",
      "id": 12749855526,
      "node_id": "UNLE_lADOABII586IKCIlzwAAAAL381sm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12749855526",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-08T21:45:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2072280930,
      "node_id": "PRR_kwDOABII5857hH9i",
      "url": null,
      "actor": null,
      "commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#pullrequestreview-2072280930",
      "submitted_at": "2024-05-22T20:24:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T13:04:18Z",
      "updated_at": "2024-05-23T13:04:18Z",
      "source": {
        "issue": {
          "id": 2312700303,
          "node_id": "PR_kwDOABII585wUc8Y",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30157/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30157",
          "number": 30157,
          "state": "open",
          "state_reason": null,
          "title": "Fee Estimation via Fee rate Forecasters",
          "body": "### This PR aims at improving Bitcoin Core fee estimation\r\n\r\n\r\n### The objectives of this improvement are to:\r\n\r\n- Reduce overestimation done by the current `CBlockPolicyEstimator`\r\n- Make the fee estimator aware of the state of the mempool, allowing it to respond to changing conditions immediately.\r\n- Empower node users to be self-sovereign and use their node's estimates, as is now, the majority rely on third parties for fee estimation.\r\n- Simplify the process of adding new fee estimation strategies in the future.\r\n\r\nThe PR creates a new `FeeEstimator` class which is responsible for getting estimates from one or more subscribed `Forcaster`'s.\r\n\r\nA `Forcaster` will register with the `FeeEstimator` as being able to provide estimates, and when an estimate is requested, should return two fee rate estimates (high and low) and a confidence level.\r\n\r\nThe estimator will then take (currently undecided):\r\n1. the lowest estimated rate, or\r\n1. the weighted average of all the estimated rates\r\n\r\n...and return the two 'high' and 'low' estimations to the user.\r\n\r\nThe `FeeEstimator` also owns access to the legacy estimator, accessible via a pointer.\r\n\r\nThis PR deliberately does **not** try to modify existing fee estimation code, but instead uses new modules with cleaner seperation. This will make new code and interfaces much easier to introduce, and also make it easier to, if desired in the future, drop legacy estimation code.\r\n\r\n### Currently, this PR implements two forecasters:\r\n\r\n1. Mempool-based forecaster (`MemPoolForecaster`): It estimates fees simply by generating a block template from the node's mempool and returns the 25th and 50th percentile mining scores as low-priority and high-priority fee estimates, respectively.\r\n1. Last 6 Blocks forecaster (`BlockForecaster`): Uses the transactions from the previous six blocks _which were also seen in the node's mempool_, to make an estimate.\r\n\r\n    It listens to the validation interface notifications for removed mempool transactions, linearizes the transactions using a mini miner, and saves the 25th and 50th percentile mining scores. When estimating fees, it averages the mining scores of the percentiles from the last six mined blocks.\r\n    \r\n    NB. As this **excludes** transactions that never entered the node's mempool, it's likely to undershoot slightly\r\n\r\nThese two forecasters both estimate fees for (1, 2) block confirmation targets, referred to as \"as soon as possible (ASAP)\" fee rate estimates.\r\n\r\nFor both forcasters use of RBF is strongly recommended in order that transactions can be fee-bumped if desired.\r\n\r\n### Next steps:\r\n\r\n- Give some statistics of estimates \"missing the block\" (~percentage of estimates below the 5th percentile mining score of the confirmed block) and \"over paying\" (~percentage of estimates above the 25th 50th and 75th percentiles mining score) \r\n\r\n- Extend the feature to the wallet; currently it's only exposed in an RPC `estimatefee`.\r\n- Update forecasters to return confidence levels in their estimates.\r\n\r\n### Confidence levels\r\n\r\nConfidence levels are determined by heuristics.\r\n\r\nFor the mempool-based forecaster:\r\n\r\n- Suspected high mining score transactions should be confirmed but aren't.\r\n- Most transactions in previously mined blocks were in our node's mempool.\r\n- High mining score mempool transactions are confirmed.\r\n\r\nFor the last 6 blocks forecaster:\r\n\r\n- Presence of empty blocks in the last 6 blocks.\r\n- Most of the last 6 blocks' transactions were seen in the node's mempool or not.\r\n\r\nThe fee estimator  will select the fee rate from the forecasters based on confidence level instead of just taking the lowest fee rate estimate.\r\n\r\n\r\n### How does this fit in with `CBlockPolicyEstimator`?\r\n\r\nThis fee estimator owns the legacy `CBlockPolicyEstimator` and does not change any of its interfaces. The wallet still uses `estimatesmartfee`, and RPCs also access it through the Fee Estimator.\r\nHowever, this will change when we switch to using estimates from `GetFeeEstimateFromForecasters`, which works much better than the `estimatesmartfee` in (1, 2) confirmation target scenarios.\r\n\r\nMoreover, when we have another forecaster that supports confirmation targets beyond (1, 2) and works better than `estimatesmartfee`, we will eventually phase out `CBlockPolicyEstimator` as the new Fee Estimator module makes it easy to do so.\r\n\r\nThis PR addresses two open issues and has been requested by users in the past.\r\n\r\n#27995\r\n#30009\r\n\r\n### FAQ\r\n\r\n1. **Will miners broadcast high fee rate transactions, and then evict them with a conflicting transaction in the next block, trick users of this fee estimator into making transactions with high fees?**\r\n   https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/6?u=ismaelsadeeq\r\n\r\n   This PR addresses this concern by ensuring that the fee estimate does not surge immediately whenever this happens the mempool based forecaster estimate will be higher than last 6 block forecaster estimate. As such the last six blocks forecaster estimate will be returned, preventing users to be victims of this attack.\r\n\r\n2. **In times of high confirmation times or high block space demand, fee estimates tend to rise. If the mempool-based forecaster estimate rises, the fee estimator will fall back to the last six blocks fee estimate, if it's low, will that make transactions constructed with the estimate get stuck in the mempool?**\r\nThe ASAP fee estimate provides an estimate for transactions to confirm in the next one or two blocks. During periods of high confirmation times, fee rates rise due to congestion. Once a block is mined, the mempool clears high mining score transactions, making room for lower fee rate transactions. If congestion recurs and the transaction is time-sensitive, users can safely fee bump assuming it's an RBF-enabled transaction.\r\nIn times of immediate high block demand, if the mempool-based fee estimate surges while the last six blocks fee estimate is low, users can fee bump their transactions if they take longer to confirm. As more blocks are mined, the last six blocks forecaster will adjust and reflect the higher fee rates. When demand decreases, the mempool forecaster will immediately respond to the new conditions by providing a lower fee estimate and the fee estimator will return it instead.\r\n\r\n3. **Currently, getting a block template is expensive. How do you tackle that in the mempool-based forecaster?**\r\nThe forecaster cache the recently generated fee rate estimates and only generate a new block template when the time delta between the recent estimate and the current time exceeds 30 seconds.\r\n\r\n---\r\nThis is a collaborative work with @willcl-ark and a result of collecting insight from other contributors.\r\n",
          "user": {
            "login": "ismaelsadeeq",
            "id": 48946461,
            "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ismaelsadeeq",
            "html_url": "https://github.com/ismaelsadeeq",
            "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
            "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
            "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
            "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
            "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30157",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30157",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30157.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30157.patch"
          },
          "created_at": "2024-05-23T11:44:09Z",
          "updated_at": "2024-05-23T20:22:36Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T13:31:54Z",
      "updated_at": "2024-05-23T13:31:54Z",
      "source": {
        "issue": {
          "id": 2304633349,
          "node_id": "PR_kwDOABII585v43Zq",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30141",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30141/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30141/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30141/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30141",
          "number": 30141,
          "state": "open",
          "state_reason": null,
          "title": "kernel: De-globalize validation caches",
          "body": "The validation caches are currently setup independently from where the rest of the validation code is initialized. This makes their ownership semantics unclear. There is also no clear enforcement on when and in what order they need to be initialized. The caches are always initialized in the `BasicTestingSetup` although a number of tests don't actually need them.\r\n\r\nSolve this by moving the caches from global scope into the `ChainstateManager` class. This simplifies the usage of the kernel library by no longer requiring manual setup of the caches prior to using the `ChainstateManager`. Tests that need to access the caches can instantiate them independently.\r\n\r\n---\r\nThis pull request is part of the [libbitcoinkernel project](https://github.com/bitcoin/bitcoin/issues/27587).",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30141",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30141",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30141.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30141.patch"
          },
          "created_at": "2024-05-19T14:17:42Z",
          "updated_at": "2024-05-23T20:41:13Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T14:01:56Z",
      "updated_at": "2024-05-23T14:01:56Z",
      "source": {
        "issue": {
          "id": 2298612841,
          "node_id": "PR_kwDOABII585vkhDL",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30115",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30115/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30115/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30115/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30115",
          "number": 30115,
          "state": "closed",
          "state_reason": null,
          "title": "rpc: avoid copying into UniValue",
          "body": "These are the simple (and hopefully obviously correct) copies that can be moves instead.\r\n\r\nThis is a follow-up from https://github.com/bitcoin/bitcoin/pull/30094#issuecomment-2108751842\r\n\r\nAs it turns out, there are hundreds of places where we copy UniValues needlessly. It should be the case that moves are always preferred over copies, so there should be no downside to these changes.\r\n\r\nwillcl-ark, however, noticed that memory usage may increase in some cases. Logically this makes no sense to me. The only plausible explanation imo is that because the moves are faster, more ops/second occur in some cases.\r\n\r\nThis list of moves was obtained by changing the function signatures of the UniValue functions to accept only rvalues, then compiling and fixing them up one by one. There still exist many places where copies are being made. These can/should be fixed up, but weren't done here for the sake of doing the easy ones first.\r\n\r\nI ran these changes through clang-tidy with `performance-move-const-arg` and `bugprone-use-after-move` and no bugs were detected (though that's obviously not to say it can be trusted 100%).\r\n\r\nAs stated above, there are still lots of other less trivial fixups to do after these including:\r\n- Using non-const UniValues where possible so that moves can happen\r\n- Refactoring code in order to be able to move a UniValue without introducing a use-after-move\r\n- Refactoring functions to accept UniValues by value rather than by const reference",
          "user": {
            "login": "theuni",
            "id": 417043,
            "node_id": "MDQ6VXNlcjQxNzA0Mw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/theuni",
            "html_url": "https://github.com/theuni",
            "followers_url": "https://api.github.com/users/theuni/followers",
            "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
            "organizations_url": "https://api.github.com/users/theuni/orgs",
            "repos_url": "https://api.github.com/users/theuni/repos",
            "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/theuni/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 20,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30115",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30115",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30115.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30115.patch"
          },
          "closed_at": "2024-05-23T14:53:49Z",
          "created_at": "2024-05-15T18:52:46Z",
          "updated_at": "2024-05-23T15:03:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T14:11:04Z",
      "updated_at": "2024-05-23T14:11:04Z",
      "source": {
        "issue": {
          "id": 2297394267,
          "node_id": "PR_kwDOABII585vgSti",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30110",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30110/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30110/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30110/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30110",
          "number": 30110,
          "state": "open",
          "state_reason": null,
          "title": "refactor: TxDownloadManager",
          "body": "Part of #27463.\r\n\r\nDraft while #30000 is not merged, and because I am still smoothing out the interface, making sure the commits are clean, and writing more tests.\r\n\r\nThis modularizes transaction download logic into a `TxDownloadManager`. Transaction download logic refers to the process of deciding what transactions to request, download, and validate.[1]\r\nAll of the changes here should result in no behavior change.\r\n\r\nThere are several benefits to this interface, such as:\r\n- Unit test coverage and **F U Z Z I N G** for logic that currently isn't feasible to test as thoroughly (due to the code paths not being reachable through `PeerManager` without a ton of overhead) and/or currently only lightly tested through `assert_debug_log` ( :-1: ) in functional tests.\r\n    - See for example the `MempoolRejectedTx` test, where we can define a matrix of expected outcomes for each `TxValidationResult` and test them very easily.\r\n    - For fuzzing, see the `txdownloadman` and `txdownload_impl` targets.\r\n- When we add more functionality (e.g. package relay messages, more robust orphan handling), the vast majority of it will be within `TxDownloadManager` instead of `PeerManager`, making it easier to review and test.\r\n- A thinner and easier-to-use interface for `PeerManager`, which will no longer know anything about / have access to `TxOrphanage` or rejection caches. Its primary interface with `TxDownloadManager` would be:\r\n    - Notify `txdownloadman` of tip changes (i.e. passing on some `ValidationInterface` callbacks)\r\n    - Tell `txdownloadman`when a {transaction, package} is {accepted, rejected} from mempool, and receive a few instructions\r\n    - Each time a peer connects or disconnects + sanity check functions during cleanup\r\n    - Pass transaction `inv`s, `notfound`s to `txdownloadman` and receive instructions on what to validate\r\n    - Get the `getdata` requests to send\r\n    - Get the transactions to reconsider in `ProcessOrphanTx`\r\n    - Get whether a peer `HaveMoreWork` for the `ProessMessages` loop\r\n    - ^note that there are some cleanups I still have to do, so it's not this clean yet, but this is the vision. For example, while I'm writing this, I plan to make `Find1P1CPackage` private to `TxDownloadImpl`\r\n    - ^in the future, it would also pass package-related messages on, and we would reuse the `PackageToValidate` struct to return the things `peerman` needs for validation.\r\n- (todo) with some more interface changes, we can make this manager internally thread-safe instead of having `PeerManager` handle it (e.g. currently it locks `cs_main` to synchronize accesses to `m_txrequest`!)\r\n\r\n[1]: This does not include transaction announcements, i.e. what we *send* to our peers. All of that happens after we download/accept a tx. Txreconciliation (erlay) is excluded from this module, as it is part of announcements and/or part of helping the other peer decide which `inv`s to send.",
          "user": {
            "login": "glozow",
            "id": 25183001,
            "node_id": "MDQ6VXNlcjI1MTgzMDAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/glozow",
            "html_url": "https://github.com/glozow",
            "followers_url": "https://api.github.com/users/glozow/followers",
            "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
            "organizations_url": "https://api.github.com/users/glozow/orgs",
            "repos_url": "https://api.github.com/users/glozow/repos",
            "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/glozow/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30110",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30110",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30110.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30110.patch"
          },
          "created_at": "2024-05-15T09:49:51Z",
          "updated_at": "2024-05-23T21:08:29Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 12912521182,
      "node_id": "LE_lADOABII586IKCIlzwAAAAMBpW_e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12912521182",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T16:39:33Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2074413782,
      "node_id": "PRR_kwDOABII5857pQrW",
      "url": null,
      "actor": null,
      "commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 445e6de114c00311c506b9245adf7f63bbbbec1d. It was a little unclear in some places what behavior was supposed to be changing, and I think that could be documented better. But overall the changes look good and seem very positive.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#pullrequestreview-2074413782",
      "submitted_at": "2024-05-23T17:10:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
    },
    {
      "event": "review_requested",
      "id": 12912881396,
      "node_id": "RRE_lADOABII586IKCIlzwAAAAMBqu70",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12912881396",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T17:10:34Z",
      "requested_reviewer": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDViMzc3ZTAzNjVhNWQ2MzJlMTg2NTFkNWU0NzM4ODdmMjFmZjUzZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b377e0365a5d632e18651d5e473887f21ff53e6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5b377e0365a5d632e18651d5e473887f21ff53e6",
      "tree": {
        "sha": "04ca1e66c5a916a8af8fc29d1cb9998357ffc38a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/04ca1e66c5a916a8af8fc29d1cb9998357ffc38a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 04ca1e66c5a916a8af8fc29d1cb9998357ffc38a\nparent 413844f1c2a3d8f7cfef822f348f26df488b03c7\nauthor stickies-v <stickies-v@protonmail.com> 1713439744 +0100\ncommitter stickies-v <stickies-v@protonmail.com> 1716486669 +0100\n\nrefactor: remove unnecessary AppendWarning helper function\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5g/ggIZt5fccjfOgXLHObl5mp1cFAmZPgg0ACgkQXLHObl5m\np1frGBAAq7RVGFQbxjmOKZOEeUeLTwb9V+OsnnvH+7H+98jj8wHSDBG7F8cRbPmX\nrc8WKWXfvYdt3Ckc8qrzr6qt5HanDgh96HtblOo9+E281f/fveaN+Iv4AG1iUoBr\nG9JBBdtR52qxGzqvhh4n7b1IThbSsQjtI/ea5uw/JCmbSfD9wnu38lHPnC8n0/WB\nslFrxPishUhrak0sgezpa1GKNPqTRbSyqyNSwnWxFTBsi6kILXEnucZQeThrbPKK\nJMXeyz3/Q4tSf9bAOAUnFvux8Fx4uI1cWAbuR7MPpJopE25txB86pkCUR0FVWpkp\n8AJRAkZUGlEMeQXPbwbNUFSP7KewDheBldOibUok4mdmf6gbCfMEj8WRhJG+r0TM\n7SFOFYI5OhrBKv9kw3UXOr4DyCUtqSpebkdC7JSNfos3IyOy4Z/REVegSC7on1M+\nadXGls1nuk0KjkEGykKoLjdhlzMzAKOVXQUiULLwg7WaOyU8K7+H8wi+z3nT4kd6\nJRFVDar6B4g3LW6SkxXGlcCPzvSqo0Ok/TXHqgN3/oaShmXtOtz/vfUSHB95+xIc\n/d1237sToHsRdmcSwZBNx3KF0p8goIGq7XL5HYI5bccPBwCpkHiWhJmtPFdi1Hau\n+e7LEUnKlF5TpjYTmGyY15NqHeIYwQ8ThS8eJoMLCGalnxgcHkA=\n=MBOe\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/413844f1c2a3d8f7cfef822f348f26df488b03c7",
          "sha": "413844f1c2a3d8f7cfef822f348f26df488b03c7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/413844f1c2a3d8f7cfef822f348f26df488b03c7"
        }
      ],
      "message": "refactor: remove unnecessary AppendWarning helper function",
      "committer": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-23T17:51:09Z"
      },
      "author": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-04-18T11:29:04Z"
      },
      "sha": "5b377e0365a5d632e18651d5e473887f21ff53e6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFhMmU1ZTdjNTkyYTFlNGNmYzNmNzYxZjBiYTBmODBkZjAxM2Y1ZmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe",
      "tree": {
        "sha": "9618f9b984f76a958cf52efdecf9b956dce602f0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9618f9b984f76a958cf52efdecf9b956dce602f0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9618f9b984f76a958cf52efdecf9b956dce602f0\nparent 5b377e0365a5d632e18651d5e473887f21ff53e6\nauthor stickies-v <stickies-v@protonmail.com> 1713445512 +0100\ncommitter stickies-v <stickies-v@protonmail.com> 1716493822 +0100\n\nmove-only: move warnings from common to node\n\nSince rpc/util.cpp is in common, also move GetNodeWarnings() to\nnode::GetWarningsForRPC()\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5g/ggIZt5fccjfOgXLHObl5mp1cFAmZPngkACgkQXLHObl5m\np1fP/RAAjCGC+w9dwJ1JCcgztl2sTd2Q3xo43lAb1DtfPzw58zY0XwdbflGeDflf\nqjFxbA2AA02E+voCeQVGWoxJ2UKiLg1RtxpusM90MDIJn+WvgqCMAksVJM90bz3O\nBhl/aEnWpNym4mvLyZDhzHlDFL63p5VaPkc+IgYX7sSeeJtZTE1/nYtK3yB9B2S4\nCxLBAqBA8/CDDuj7EwCMLSENSTwLKmQ0wrBbKBHQ6i+5BLkZeazS0Rp3qnWe99eN\n5rVczHizdU5DYFyvZYkffsGUE1hViS+a6iYE7I/69jyGaXGZNp/mAZYTUruZfrPN\nmgF/O6crpWfPmH35lAJUQdZMIkQqWAJv6r2R7IGYGejlAGBWFEJc1F3KKaTsVS9l\nqeGM9RWbrhFgom9lt57hGdTc0wsI506QwG5oSklIUYfpIVG9WUBYXjjswSJDDGtp\nfaY+/jHmvVmQQLHGYXXnY4VZIxbYI78kbYg4pyFFvjz7ZdAPMsMEwjz3miZwmd6W\noAZlQcoPfDLp70p2ffz1fuwIKO+uWkQ5aATD9CT4eFnHfrbTgQaK5kScx/iSkUZO\nRe/d8dSAKOz3ruFBxJtHlhYT8NTy27ssrhdytA6lIGi9VZBuSFM2Zhf/SKpiIqgT\nW/URQoVgC+cCUDQYOnptMoyECwigdexHUhpZI9dlRoZoD6JORgw=\n=3IVO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b377e0365a5d632e18651d5e473887f21ff53e6",
          "sha": "5b377e0365a5d632e18651d5e473887f21ff53e6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5b377e0365a5d632e18651d5e473887f21ff53e6"
        }
      ],
      "message": "move-only: move warnings from common to node\n\nSince rpc/util.cpp is in common, also move GetNodeWarnings() to\nnode::GetWarningsForRPC()",
      "committer": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-23T19:50:22Z"
      },
      "author": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-04-18T13:05:12Z"
      },
      "sha": "1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12915075425,
      "node_id": "HRFPE_lADOABII586IKCIlzwAAAAMBzGlh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12915075425",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T20:52:01Z"
    },
    {
      "event": "unlabeled",
      "id": 12915209548,
      "node_id": "UNLE_lADOABII586IKCIlzwAAAAMBznVM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12915209548",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T21:06:49Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ4MTk3MTMxOTM3ZWU4ZDMzYWVkY2EwZDQwMmY4Zjk2MTNiYWJhOTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8197131937ee8d33aedca0d402f8f9613baba99",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d8197131937ee8d33aedca0d402f8f9613baba99",
      "tree": {
        "sha": "6fab2cb41bfaae1a8a98b5bb3a02bff7cf2e8f8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6fab2cb41bfaae1a8a98b5bb3a02bff7cf2e8f8f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6fab2cb41bfaae1a8a98b5bb3a02bff7cf2e8f8f\nparent 1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe\nauthor stickies-v <stickies-v@protonmail.com> 1715097940 +0100\ncommitter stickies-v <stickies-v@protonmail.com> 1716498563 +0100\n\nintroduce and use the generalized `node::Warnings` interface\n\nInstead of having separate warning functions (and globals) for each\ndifferent warning that can be raised, encapsulate this logic into\na single class and allow to (un)set any number of warnings.\n\nIntroduces behaviour change:\n- the `-alertnotify` command is executed for all\n  `KernelNotifications::warningSet` calls, which now also covers the\n  `LARGE_WORK_INVALID_CHAIN` warning.\n- previously, warnings were returned based on a predetermined order,\n  e.g. with the \"pre-release test build\" warning always first. This\n  is no longer the case, and Warnings::GetMessages() will return\n  messages sorted by the id of the warning.\n\nRemoves warnings.cpp from kernel.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5g/ggIZt5fccjfOgXLHObl5mp1cFAmZPsIMACgkQXLHObl5m\np1eEqxAArzy2xM9B0zI9Dx/gm+o6H0x/eV5++KYayb/ID6ZWxP9GwMB9l52/CH3v\nQqFFZXMDJoWkDj+XQx3b5ygP2fno8EQpva5JnyrXkWzNTjN7uPYcndDnvTTVLzfp\nfViBVOwJRqcwaWPyf+xNK9f8glvo30PxQ/AQExiGcHzEq/pdW/sF3TaaYPYtfBWd\nj/MzBZe/ld7jhPkKhJ6PQ8ReoRbi/m+2OYOLmk033AhxrkmqjW3G+yNPm3DsorT9\nlSuMo2D1whdQFK/MlBcMaPIbtKdi37MfTc42UenFEaXa5kNPSis0DH28jYPzBb0c\nm7tbRHCtbcfFgV4iYAHrAfAehGNEf46qeRPgNOy5xcp861+DW5pV7s2w9C9o73dP\nAdAnVfJuTL1MHkDkJG4U8cXnBLsNnbdt55A+6ZdAxHoWCr25PBxScaOttP/1Qr1q\nWUGdEDZejazlb5jbyzZSJJsDDeIpQW2dwraQUg2R5YoLBGtG+1OyOOhfzhKqpJj3\nCujNPNt88Aokp5UAm8FDUx0jn2yz13DJ/JdsXLe2sNXWuhZ/QGV2WNDD9ya3zaWQ\ns1L2Mb0SsQdeVe749qqniIarz4xsUDDQqo1+XnuQTRbafDFkLxbO/crLMUaHKfsd\n8u8erK9jcOWjkeYjf0W4/8S4wcZP0iP/at4DjjjoSy77rha9/jg=\n=gayo\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe",
          "sha": "1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1a2e5e7c592a1e4cfc3f761f0ba0f80df013f5fe"
        }
      ],
      "message": "introduce and use the generalized `node::Warnings` interface\n\nInstead of having separate warning functions (and globals) for each\ndifferent warning that can be raised, encapsulate this logic into\na single class and allow to (un)set any number of warnings.\n\nIntroduces behaviour change:\n- the `-alertnotify` command is executed for all\n  `KernelNotifications::warningSet` calls, which now also covers the\n  `LARGE_WORK_INVALID_CHAIN` warning.\n- previously, warnings were returned based on a predetermined order,\n  e.g. with the \"pre-release test build\" warning always first. This\n  is no longer the case, and Warnings::GetMessages() will return\n  messages sorted by the id of the warning.\n\nRemoves warnings.cpp from kernel.",
      "committer": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-23T21:09:23Z"
      },
      "author": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-07T16:05:40Z"
      },
      "sha": "d8197131937ee8d33aedca0d402f8f9613baba99"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMyMDJmMGRlNTk1YmJmNGIwMjljYjZjYjQ4M2MyMDU0ODM0M2RjZGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3202f0de595bbf4b029cb6cb483c20548343dcdf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3202f0de595bbf4b029cb6cb483c20548343dcdf",
      "tree": {
        "sha": "59d2adf7838e63493bc81c79e1d218e0bb3c6835",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/59d2adf7838e63493bc81c79e1d218e0bb3c6835"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 59d2adf7838e63493bc81c79e1d218e0bb3c6835\nparent d8197131937ee8d33aedca0d402f8f9613baba99\nauthor stickies-v <stickies-v@protonmail.com> 1715098969 +0100\ncommitter stickies-v <stickies-v@protonmail.com> 1716498563 +0100\n\nnode: update uiInterface whenever warnings updated\n\nThis commit introduces slight behaviour change. Previously, the\nGUI status bar would be updated for most warnings, namely\nUNKNOWN_NEW_RULES_ACTIVATED, CLOCK_OUT_OF_SYNC and\nPRE_RELEASE_TEST_BUILD, but not for LARGE_WORK_INVALID_CHAIN\n(and not for FATAL_INTERNAL_ERROR, but that is not really\nmeaningful).\n\nFix this by always updating the status bar when the warnings are\nchanged.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5g/ggIZt5fccjfOgXLHObl5mp1cFAmZPsIMACgkQXLHObl5m\np1eWTxAAmRc2aopJcGqi9O8dBjZwj17XeHsi1mGAWWnH+y7JzywqehE9Pyk9LpmA\nnJsnI/74j/zlzjEtqI9W4ETf7RjsoknCMj4Rs6ZRHFdcJqiyUC9XT92nNMoEfYwB\nYOPMkc9V8TTsE/9xspNR1du9sGwYO0HH/fFswDEO3biAmN11yDw5v1Uwp1N62qHP\nOzHOQWfO2MJFkKmIalE9+O9Y7vi+vOsirwcba13bFORge30qGHObbtkg0jeE9iyC\n2yu1q5HRHBYjOofvJ4VaJPQjjde25qxPbM+FSzYPsI5LGt2d+bvKduqBI4rp7Jmv\nXqfFEw5EnTdeQhquNI8ouLmsAcrMAS9uCkZelFoMorsUu2LQ+CTq0WHfKYef+J8n\n6jafKaOjyo3DY5cqfjFLQZSRS/eVih4t8GTlCPCD/WMylxsRMmj+IEcsrQn9sYL5\ndWyuz76OXF836h2g8p2t0Rejfq0HHDlkT4mHpMQ387tsdPOUU6PUYSjMcAAtklbs\nKKDEXKukMghmFT8S0U+6lyp6FAIKEEeN9WU0kxDHk9p9JDLFqepGzbCSAOB/st+w\n7RqNO3WD1vMuevKY0fToDXpv3ci+SIwLKpEq/41L6I2h5ghOTnHoWsFmxu5wD2fd\nHh99ZFWGyeLw+kSWFipnqIDvTMONEtVRjUIaVIjtBkn1vvqEmlQ=\n=IKay\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8197131937ee8d33aedca0d402f8f9613baba99",
          "sha": "d8197131937ee8d33aedca0d402f8f9613baba99",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d8197131937ee8d33aedca0d402f8f9613baba99"
        }
      ],
      "message": "node: update uiInterface whenever warnings updated\n\nThis commit introduces slight behaviour change. Previously, the\nGUI status bar would be updated for most warnings, namely\nUNKNOWN_NEW_RULES_ACTIVATED, CLOCK_OUT_OF_SYNC and\nPRE_RELEASE_TEST_BUILD, but not for LARGE_WORK_INVALID_CHAIN\n(and not for FATAL_INTERNAL_ERROR, but that is not really\nmeaningful).\n\nFix this by always updating the status bar when the warnings are\nchanged.",
      "committer": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-23T21:09:23Z"
      },
      "author": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-07T16:22:49Z"
      },
      "sha": "3202f0de595bbf4b029cb6cb483c20548343dcdf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVkZmJjMzU0YTdhYWU5ZGY1YjljZmQ4Mzk5ODE4NzRjYjkxMWQwNmQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "tree": {
        "sha": "cb8e4ef15f76430ba1f81471465ee9a88e721976",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cb8e4ef15f76430ba1f81471465ee9a88e721976"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cb8e4ef15f76430ba1f81471465ee9a88e721976\nparent 3202f0de595bbf4b029cb6cb483c20548343dcdf\nauthor stickies-v <stickies-v@protonmail.com> 1715088095 +0100\ncommitter stickies-v <stickies-v@protonmail.com> 1716498563 +0100\n\nrefactor: remove warnings globals\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5g/ggIZt5fccjfOgXLHObl5mp1cFAmZPsIMACgkQXLHObl5m\np1c7yBAAi3niaS2lcp3JXixa/+SjNwR+bEMILZVD5aFx68uliezQrn5lBaqaNIVk\nkp5GOlSjtE8Alm0IyisoLVLCW2VJPQJPlWIJ4FCln6rUoCbVqe4MOyVw1usESiaq\nGt6iDQWNH3xkMf6ADMtZAQR+wfk1ep5NQ1IYRFQ437oUq8cT7Xnwrcp9XQBHBZg2\ns/O38gD9vIfeeVlsNJdat2b2vWxU5eespwM1skyPoSg+eOkZQyfTUuopQ/IewxmX\n/tPsvz78Xgy1jqHReXBphcg7sg59nhqftFpt/NmGPhuP8xEKotuH/7SugsvtCgEs\n6b+pG/6NXakBuR8f2lT1lyjNpin1+Q4r81muIX4nxWjbHU0GQ5kroWk8WgoCgxoT\n6Jn0iF+0xosiauSugpsxsb63YNs6XSMtFL+brCFqDVtfmES7aO/6RVxnym7xEI1w\n/XuBURX9D1TRQyUuGf2leI3oGKG+QXOxtjPG6aaB9tRgPusO8F/VLPPlR70KuxUP\nEZPHJh6DmNzD74aEsnuNqwDJOgM+N776AlEUlrzlV2+8uvIjxHJ7NisNnPWe4LZ7\ncn2vzsmZ+6NglFhoaP6IZK3STbpostTTU0We6q4nxey+hsLas9+fgkk3qvjmeWX4\n+6Fm3X4N0AeBj28fWl2Pxa6P5/OnmHGtNMNAYckIz664VMP0f5k=\n=Z5GO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3202f0de595bbf4b029cb6cb483c20548343dcdf",
          "sha": "3202f0de595bbf4b029cb6cb483c20548343dcdf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3202f0de595bbf4b029cb6cb483c20548343dcdf"
        }
      ],
      "message": "refactor: remove warnings globals",
      "committer": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-23T21:09:23Z"
      },
      "author": {
        "name": "stickies-v",
        "email": "stickies-v@protonmail.com",
        "date": "2024-05-07T13:21:35Z"
      },
      "sha": "5dfbc354a7aae9df5b9cfd839981874cb911d06d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12915248782,
      "node_id": "HRFPE_lADOABII586IKCIlzwAAAAMBzw6O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12915248782",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T21:11:22Z"
    },
    {
      "event": "reviewed",
      "id": 2074818707,
      "node_id": "PRR_kwDOABII5857qziT",
      "url": null,
      "actor": null,
      "commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Thank you for the review, @TheCharlatan  and @ryanofsky . \r\n\r\nIn this force push, I've:\r\n- rebased to address merge conflict from #30115\r\n- incorporated @TheCharlatan's [suggestion](https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1610597554) to use `enum class` instead of `std::string` for the warning identifiers\r\n- addressed @ryanofsky's comments:\r\n    - improved commit messages to describe the introduced behaviour change and improved a couple of docstrings\r\n    - added release notes to describe the new `-alertnotify` behaviour\r\n    - updated the `Warnings::Set()` signature to pass by value and use move semantics \r\n- removed an unnecessary include in `kernel/warning.h` ",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#pullrequestreview-2074818707",
      "submitted_at": "2024-05-23T22:23:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610597554",
      "pull_request_review_id": 2072280930,
      "id": 1610597554,
      "node_id": "PRRC_kwDOABII585f_8Sy",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "As an alternative: How about making this a set of enums whose variants encode the various errors? Then we can add a function to convert the enums to strings (the enums and the conversion function could live in the kernel namespace) and use that to populate the vector for `GetMessages()`.",
      "created_at": "2024-05-22T20:21:42Z",
      "updated_at": "2024-05-22T20:24:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1610597554",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610597554"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611438018",
      "pull_request_review_id": 2073558616,
      "id": 1611438018,
      "node_id": "PRRC_kwDOABII585gDJfC",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": 1610597554,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have considered that approach, but see a couple of difficulties with it:\r\n- We have kernel warnings (\"unknown-new-rules-activated\", \"large-work-invalid-chain\") and node warnings (\"clock-out-of-sync\", \"pre-release-test-build\", \"fatal-internal-error\"). I would rather not define the node warnings in the kernel namespace. We could have have `kernel::Warning` and `node::Warning` enums (and potentially more in the future), and have a `std::variant<kernel::Warning, node::Warning> GetAllWarnings()` to address that.\r\n- not all warnings are compile-time constants, see e.g. the [\"unknown-new-rules-activated\" warning](https://github.com/bitcoin/bitcoin/pull/30058/files#diff-97c3a52bc5fad452d82670a7fd291800bae20c7bc35bb82686c2c0a4ea7b5b98R2850): `const bilingual_str warning = strprintf(_(\"Unknown new rules activated (versionbit %i)\"), bit);`, so I'm no sure a conversion function is desirable?",
      "created_at": "2024-05-23T10:36:13Z",
      "updated_at": "2024-05-23T10:36:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611438018",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611438018"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611500389",
      "pull_request_review_id": 2073664402,
      "id": 1611500389,
      "node_id": "PRRC_kwDOABII585gDYtl",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": 1610597554,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I gave the `kernel::Warning` and `node::Warning` enums approach a go because it would be nice to have the possible warnings enumerated, and it ended up being less overhead than I expected. I'm leaning towards updating this PR with that approach. What do you think?\r\n\r\nhttps://github.com/stickies-v/bitcoin/commit/e4ea7aba9f1426dc510dbdbff19788919bf9d3fb - PoC but compiles and tests pass, needs rebase, cleanup and doc updates etc",
      "created_at": "2024-05-23T11:21:35Z",
      "updated_at": "2024-05-23T11:22:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611500389",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611500389"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611606129",
      "pull_request_review_id": 2073823964,
      "id": 1611606129,
      "node_id": "PRRC_kwDOABII585gDyhx",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": 1610597554,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for testing this out! I forgot that the we'd need to reconstruct the versionbit before, sorry about that. I think I like this better. The reason I am a bit hesitant about keying by strings is that it makes them harder to discover for outside users and forces them to use a variable-size data type as a key for mapping them. ",
      "created_at": "2024-05-23T12:28:40Z",
      "updated_at": "2024-05-23T12:28:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611606129",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611606129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611939057",
      "pull_request_review_id": 2074382835,
      "id": 1611939057,
      "node_id": "PRRC_kwDOABII585gFDzx",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": 1610597554,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "EDIT: Looking at the PR more, I now see the previous discussion is about id strings, not message strings. In that case I agree with TheCharlatan it is a littler better to use enum ids than string ids.\r\n\r\n---\r\n\r\nI think in the longer run the string/enum distinction should not matter too much here.\r\n\r\nIn general, requiring kernel applications to get warning information from `warning`, or `warningSet`/`warningUnset` callbacks is not a nice API. It would make more sense for the kernel to treat errors and warnings similarly, and return this information directly in function return values or output arguments, instead of indirect callbacks. We have PR #29642 and #29700 which change kernel code to bubble up errors, and another PR could be made to bubble up warnings.\r\n\r\nWith these changes, you should be able to look at any kernel API function, and know exactly what error and warning conditions it can trigger, and have that information returned to the caller. We shouldn't remain in the current situation where when you call a kernel function, there is no way to know what fatal errors, or flush errors, or warnings it might trigger, and the only way to get that information by handling indirect callbacks.\r\n\r\nI also think when designing these API's, it would be good to distinguish between errors and warning conditions that are directly actionable by callers, and those that aren't. Conditions that are directly actionable are conditions where callers might add special cases to do things like scheduling a retry, or dropping a cache to free up resources, or starting an interaction with the user that goes beyond displaying a message string. If the only way an API caller can realistically handle a condition is by showing or logging a message string, I think returning a string is much better than returning an enum, because a string, unlike an enum, can provide context needed to understand and solve the problem. But if the condition is more directly actionable and could be handled with special case code, returning structured information instead of (or along with) a string could be better.",
      "created_at": "2024-05-23T15:48:35Z",
      "updated_at": "2024-05-23T15:55:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611939057",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611939057"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611957425",
      "pull_request_review_id": 2074413782,
      "id": 1611957425,
      "node_id": "PRRC_kwDOABII585gFISx",
      "diff_hunk": "@@ -235,6 +235,7 @@ BITCOIN_CORE_H = \\\n   node/txreconciliation.h \\\n   node/utxo_snapshot.h \\\n   node/validation_cache_args.h \\\n+  node/warnings.h \\",
      "path": "src/Makefile.am",
      "position": 12,
      "original_position": 4,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6681395632c0ab5e048b34d63d26636856d4202d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"move-only: move warnings from common to node\" (6681395632c0ab5e048b34d63d26636856d4202d)\r\n\r\ns/RPc/RPC/ in commit message",
      "created_at": "2024-05-23T16:01:25Z",
      "updated_at": "2024-05-23T17:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611957425",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611957425"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 239,
      "original_line": 239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611964045",
      "pull_request_review_id": 2074413782,
      "id": 1611964045,
      "node_id": "PRRC_kwDOABII585gFJ6N",
      "diff_hunk": "@@ -43,13 +43,10 @@ static void AlertNotify(const std::string& strMessage)\n #endif\n }\n \n-static void DoWarning(const bilingual_str& warning)\n+static void DoWarning(const std::string& id, const bilingual_str& warning)\n {\n-    static bool fWarned = false;\n-    node::SetMiscWarning(warning);\n-    if (!fWarned) {\n+    if (node::g_warnings.Set(id, warning)) {",
      "path": "src/node/kernel_notifications.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"introduce and use the generalized `node::Warnings` interface\" (6152c20970c4c4db308879524d4d1c999c4580ae)\r\n\r\nWould be good to have release notes for this change mentioning new -alertnotify behavior, since it now can be trigged multiple times and in new cases",
      "created_at": "2024-05-23T16:06:43Z",
      "updated_at": "2024-05-23T17:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611964045",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611964045"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611973476",
      "pull_request_review_id": 2074413782,
      "id": 1611973476,
      "node_id": "PRRC_kwDOABII585gFMNk",
      "diff_hunk": "@@ -12,69 +12,53 @@\n #include <univalue.h>\n #include <util/translation.h>\n \n-#include <optional>\n #include <vector>\n \n-static GlobalMutex g_warnings_mutex;\n-static bilingual_str g_misc_warnings GUARDED_BY(g_warnings_mutex);\n-static bool fLargeWorkInvalidChainFound GUARDED_BY(g_warnings_mutex) = false;\n-static std::optional<bilingual_str> g_timeoffset_warning GUARDED_BY(g_warnings_mutex){};\n-\n namespace node {\n-void SetMiscWarning(const bilingual_str& warning)\n+Warnings g_warnings;\n+\n+Warnings::Warnings()\n {\n-    LOCK(g_warnings_mutex);\n-    g_misc_warnings = warning;\n+    // Pre-release build warning\n+    if (!CLIENT_VERSION_IS_RELEASE) {\n+        m_warnings.insert(\n+            {\"pre-release-test-build\",\n+            _(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\")}\n+        );\n+    }\n }\n-\n-void SetfLargeWorkInvalidChainFound(bool flag)\n+bool Warnings::Set(const std::string& id, const bilingual_str& message)\n {\n-    LOCK(g_warnings_mutex);\n-    fLargeWorkInvalidChainFound = flag;\n+    LOCK(m_mutex);\n+    const auto& [_, inserted]{m_warnings.insert({id, message})};\n+    return inserted;\n }\n \n-void SetMedianTimeOffsetWarning(std::optional<bilingual_str> warning)\n+bool Warnings::Unset(const std::string& id)\n {\n-    LOCK(g_warnings_mutex);\n-    g_timeoffset_warning = warning;\n+    return WITH_LOCK(m_mutex, return m_warnings.erase(id));\n }\n \n-std::vector<bilingual_str> GetWarnings()\n+std::vector<bilingual_str> Warnings::GetMessages() const\n {\n-    std::vector<bilingual_str> warnings;\n-\n-    LOCK(g_warnings_mutex);\n-\n-    // Pre-release build warning\n-    if (!CLIENT_VERSION_IS_RELEASE) {\n-        warnings.emplace_back(_(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\"));\n-    }\n-\n-    // Misc warnings like out of disk space and clock is wrong\n-    if (!g_misc_warnings.empty()) {\n-        warnings.emplace_back(g_misc_warnings);\n-    }\n-\n-    if (fLargeWorkInvalidChainFound) {\n-        warnings.emplace_back(_(\"Warning: We do not appear to fully agree with our peers! You may need to upgrade, or other nodes may need to upgrade.\"));\n+    LOCK(m_mutex);\n+    std::vector<bilingual_str> messages;\n+    messages.reserve(m_warnings.size());\n+    for (const auto& [id, msg] : m_warnings) {",
      "path": "src/node/warnings.cpp",
      "position": 50,
      "original_position": 69,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"introduce and use the generalized `node::Warnings` interface\" (6152c20970c4c4db308879524d4d1c999c4580ae)\r\n\r\nI guess this change also affects the order of warnings. It seems like previous code was written to consistently put the pre-release warning first, followed by the miscellaneous warnings, the large-work chain warning, and the time offset warning last. \r\n\r\nChanging this is probably fine, but it would be good to note the change in the commit message. Could also note in setWarning documentation that ID affects order warnings are shown in.",
      "created_at": "2024-05-23T16:13:07Z",
      "updated_at": "2024-05-23T17:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1611973476",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611973476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 50,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612014056",
      "pull_request_review_id": 2074413782,
      "id": 1612014056,
      "node_id": "PRRC_kwDOABII585gFWHo",
      "diff_hunk": "@@ -12,69 +12,53 @@\n #include <univalue.h>\n #include <util/translation.h>\n \n-#include <optional>\n #include <vector>\n \n-static GlobalMutex g_warnings_mutex;\n-static bilingual_str g_misc_warnings GUARDED_BY(g_warnings_mutex);\n-static bool fLargeWorkInvalidChainFound GUARDED_BY(g_warnings_mutex) = false;\n-static std::optional<bilingual_str> g_timeoffset_warning GUARDED_BY(g_warnings_mutex){};\n-\n namespace node {\n-void SetMiscWarning(const bilingual_str& warning)\n+Warnings g_warnings;\n+\n+Warnings::Warnings()\n {\n-    LOCK(g_warnings_mutex);\n-    g_misc_warnings = warning;\n+    // Pre-release build warning\n+    if (!CLIENT_VERSION_IS_RELEASE) {\n+        m_warnings.insert(\n+            {\"pre-release-test-build\",\n+            _(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\")}\n+        );\n+    }\n }\n-\n-void SetfLargeWorkInvalidChainFound(bool flag)\n+bool Warnings::Set(const std::string& id, const bilingual_str& message)",
      "path": "src/node/warnings.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"introduce and use the generalized `node::Warnings` interface\" (6152c20970c4c4db308879524d4d1c999c4580ae)\r\n\r\nNot important, but since these arguments are being inserted in a map, it would probably be a little better to pass them by value instead of reference, and use std::move so they can be moved instead of copied.",
      "created_at": "2024-05-23T16:38:41Z",
      "updated_at": "2024-05-23T17:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612014056",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612014056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612033198",
      "pull_request_review_id": 2074413782,
      "id": 1612033198,
      "node_id": "PRRC_kwDOABII585gFayu",
      "diff_hunk": "@@ -31,12 +32,15 @@ bool Warnings::Set(const std::string& id, const bilingual_str& message)\n {\n     LOCK(m_mutex);\n     const auto& [_, inserted]{m_warnings.insert({id, message})};\n+    if (inserted) uiInterface.NotifyAlertChanged();",
      "path": "src/node/warnings.cpp",
      "position": 34,
      "original_position": 12,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "396b261fc72d47d3ac4420d2db9910197a21d5ab",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"node: update uiInterface whenever warnings updated\" (396b261fc72d47d3ac4420d2db9910197a21d5ab)\r\n\r\nCan commit message be updated to say what this change in behavior here is? It looks like now this UI notification will be triggered if a fatal error happens, so not sure if that is good or bad. It might be possible to avoid this by moving the uiInterface call to node/kernel_notifications.cpp instead. That would be good for consistency since uiInterface is already accessed there, and it would be nice for this new class not to rely on a global variable.",
      "created_at": "2024-05-23T16:54:18Z",
      "updated_at": "2024-05-23T17:10:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612033198",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612033198"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 34,
      "original_line": 34,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612194682",
      "pull_request_review_id": 2074818707,
      "id": 1612194682,
      "node_id": "PRRC_kwDOABII585gGCN6",
      "diff_hunk": "@@ -235,6 +235,7 @@ BITCOIN_CORE_H = \\\n   node/txreconciliation.h \\\n   node/utxo_snapshot.h \\\n   node/validation_cache_args.h \\\n+  node/warnings.h \\",
      "path": "src/Makefile.am",
      "position": 12,
      "original_position": 4,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6681395632c0ab5e048b34d63d26636856d4202d",
      "in_reply_to_id": 1611957425,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, fixed.",
      "created_at": "2024-05-23T19:19:16Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612194682",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612194682"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 239,
      "original_line": 239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612215147",
      "pull_request_review_id": 2074818707,
      "id": 1612215147,
      "node_id": "PRRC_kwDOABII585gGHNr",
      "diff_hunk": "@@ -43,13 +43,10 @@ static void AlertNotify(const std::string& strMessage)\n #endif\n }\n \n-static void DoWarning(const bilingual_str& warning)\n+static void DoWarning(const std::string& id, const bilingual_str& warning)\n {\n-    static bool fWarned = false;\n-    node::SetMiscWarning(warning);\n-    if (!fWarned) {\n+    if (node::g_warnings.Set(id, warning)) {",
      "path": "src/node/kernel_notifications.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": 1611964045,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sounds good, I've added release notes to cover that. The way I read the startup option docstring _(\"Execute command when an alert is raised (%s in cmd is replaced by message)\")_, I think the new behaviour aligns better with how I'd expect this option to behave.",
      "created_at": "2024-05-23T19:37:57Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612215147",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612215147"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612216154",
      "pull_request_review_id": 2074818707,
      "id": 1612216154,
      "node_id": "PRRC_kwDOABII585gGHda",
      "diff_hunk": "@@ -12,69 +12,53 @@\n #include <univalue.h>\n #include <util/translation.h>\n \n-#include <optional>\n #include <vector>\n \n-static GlobalMutex g_warnings_mutex;\n-static bilingual_str g_misc_warnings GUARDED_BY(g_warnings_mutex);\n-static bool fLargeWorkInvalidChainFound GUARDED_BY(g_warnings_mutex) = false;\n-static std::optional<bilingual_str> g_timeoffset_warning GUARDED_BY(g_warnings_mutex){};\n-\n namespace node {\n-void SetMiscWarning(const bilingual_str& warning)\n+Warnings g_warnings;\n+\n+Warnings::Warnings()\n {\n-    LOCK(g_warnings_mutex);\n-    g_misc_warnings = warning;\n+    // Pre-release build warning\n+    if (!CLIENT_VERSION_IS_RELEASE) {\n+        m_warnings.insert(\n+            {\"pre-release-test-build\",\n+            _(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\")}\n+        );\n+    }\n }\n-\n-void SetfLargeWorkInvalidChainFound(bool flag)\n+bool Warnings::Set(const std::string& id, const bilingual_str& message)",
      "path": "src/node/warnings.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": 1612014056,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah makes sense, I've updated that, thanks.",
      "created_at": "2024-05-23T19:39:01Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612216154",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612216154"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612228366",
      "pull_request_review_id": 2074818707,
      "id": 1612228366,
      "node_id": "PRRC_kwDOABII585gGKcO",
      "diff_hunk": "@@ -31,12 +32,15 @@ bool Warnings::Set(const std::string& id, const bilingual_str& message)\n {\n     LOCK(m_mutex);\n     const auto& [_, inserted]{m_warnings.insert({id, message})};\n+    if (inserted) uiInterface.NotifyAlertChanged();",
      "path": "src/node/warnings.cpp",
      "position": 34,
      "original_position": 12,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "396b261fc72d47d3ac4420d2db9910197a21d5ab",
      "in_reply_to_id": 1612033198,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Can commit message be updated to say what this change in behavior here is?\r\n\r\nI've updated the commit message:\r\n\r\n<details>\r\n\r\n```\r\nnode: update uiInterface whenever warnings updated\r\n\r\nThis commit introduces slight behaviour change. Previously, the\r\nGUI status bar would be updated for most warnings, namely\r\nUNKNOWN_NEW_RULES_ACTIVATED, CLOCK_OUT_OF_SYNC and\r\nPRE_RELEASE_TEST_BUILD, but not for LARGE_WORK_INVALID_CHAIN\r\n(and not for FATAL_INTERNAL_ERROR, but that is not really\r\nmeaningful).\r\n\r\nFix this by always updating the status bar when the warnings are\r\nchanged.\r\n```\r\n</details>\r\n\r\n> It looks like now this UI notification will be triggered if a fatal error happens, so not sure if that is good or bad\r\n\r\nI'm not super familiar with the GUI, but I think it's mostly irrelevant for the internal fatal error case, or any case where we shutdown the node? We're not creating any messageboxes etc, the `uiInterface.NotifyAlertChanged()` just updates the status bar, so it's not blocking.\r\n\r\n> It might be possible to avoid this by moving the uiInterface call to node/kernel_notifications.cpp instead. That would be good for consistency since uiInterface is already accessed there, and it would be nice for this new class not to rely on a global variable.\r\n\r\nI agree that not having a global variable in `Warnings` would be better, and that's how I originally implemented it at first too. But I think the current approach is the most consistent? It seems undesirable that we would ever want to create a warning, and then not show it in the GUI until another - unrelated - warning is created that does trigger the GUI update. So, if we agree that we always want to update the GUI when the warnings are modified, then I think just doing it inside the `Set()` and `Unset()` methods is the most sensible approach?",
      "created_at": "2024-05-23T19:51:06Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612228366",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612228366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 34,
      "original_line": 34,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612240542",
      "pull_request_review_id": 2074818707,
      "id": 1612240542,
      "node_id": "PRRC_kwDOABII585gGNae",
      "diff_hunk": "@@ -12,69 +12,53 @@\n #include <univalue.h>\n #include <util/translation.h>\n \n-#include <optional>\n #include <vector>\n \n-static GlobalMutex g_warnings_mutex;\n-static bilingual_str g_misc_warnings GUARDED_BY(g_warnings_mutex);\n-static bool fLargeWorkInvalidChainFound GUARDED_BY(g_warnings_mutex) = false;\n-static std::optional<bilingual_str> g_timeoffset_warning GUARDED_BY(g_warnings_mutex){};\n-\n namespace node {\n-void SetMiscWarning(const bilingual_str& warning)\n+Warnings g_warnings;\n+\n+Warnings::Warnings()\n {\n-    LOCK(g_warnings_mutex);\n-    g_misc_warnings = warning;\n+    // Pre-release build warning\n+    if (!CLIENT_VERSION_IS_RELEASE) {\n+        m_warnings.insert(\n+            {\"pre-release-test-build\",\n+            _(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\")}\n+        );\n+    }\n }\n-\n-void SetfLargeWorkInvalidChainFound(bool flag)\n+bool Warnings::Set(const std::string& id, const bilingual_str& message)\n {\n-    LOCK(g_warnings_mutex);\n-    fLargeWorkInvalidChainFound = flag;\n+    LOCK(m_mutex);\n+    const auto& [_, inserted]{m_warnings.insert({id, message})};\n+    return inserted;\n }\n \n-void SetMedianTimeOffsetWarning(std::optional<bilingual_str> warning)\n+bool Warnings::Unset(const std::string& id)\n {\n-    LOCK(g_warnings_mutex);\n-    g_timeoffset_warning = warning;\n+    return WITH_LOCK(m_mutex, return m_warnings.erase(id));\n }\n \n-std::vector<bilingual_str> GetWarnings()\n+std::vector<bilingual_str> Warnings::GetMessages() const\n {\n-    std::vector<bilingual_str> warnings;\n-\n-    LOCK(g_warnings_mutex);\n-\n-    // Pre-release build warning\n-    if (!CLIENT_VERSION_IS_RELEASE) {\n-        warnings.emplace_back(_(\"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\"));\n-    }\n-\n-    // Misc warnings like out of disk space and clock is wrong\n-    if (!g_misc_warnings.empty()) {\n-        warnings.emplace_back(g_misc_warnings);\n-    }\n-\n-    if (fLargeWorkInvalidChainFound) {\n-        warnings.emplace_back(_(\"Warning: We do not appear to fully agree with our peers! You may need to upgrade, or other nodes may need to upgrade.\"));\n+    LOCK(m_mutex);\n+    std::vector<bilingual_str> messages;\n+    messages.reserve(m_warnings.size());\n+    for (const auto& [id, msg] : m_warnings) {",
      "path": "src/node/warnings.cpp",
      "position": 50,
      "original_position": 69,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "6152c20970c4c4db308879524d4d1c999c4580ae",
      "in_reply_to_id": 1611973476,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I guess this change also affects the order of warnings.\r\n\r\nIt does indeed. I hadn't really considered this, and I think I agree that the current behaviour is fine - but I'll think about it more and open to suggestions.\r\n\r\n> Changing this is probably fine, but it would be good to note the change in the commit message.\r\n\r\nI've updated the commit message section on behaviour change to:\r\n<details>\r\n\r\n```\r\nIntroduces behaviour change:\r\n- the `-alertnotify` command is executed for all\r\n`KernelNotifications::warningSet` calls, which now also covers the\r\n`LARGE_WORK_INVALID_CHAIN` warning.\r\n- previously, warnings were returned based on a predetermined order,\r\ne.g. with the \"pre-release test build\" warning always first. This\r\nis no longer the case, and Warnings::GetMessages() will return\r\nmessages sorted by the id of the warning.\r\n```\r\n</details>\r\n\r\n> Could also note in setWarning documentation that ID affects order warnings are shown in.\r\n\r\nI don't think this belongs in `setWarning`, kernel users could implement this how they want, so I've updated the `Warnings::GetMessages()` docstring to:\r\n\r\n```\r\n    /** Return potential problems detected by the node, sorted by the\r\n     * warning_type id */\r\n```",
      "created_at": "2024-05-23T20:03:22Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612240542",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612240542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 50,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612278118",
      "pull_request_review_id": 2074818707,
      "id": 1612278118,
      "node_id": "PRRC_kwDOABII585gGWlm",
      "diff_hunk": "@@ -0,0 +1,77 @@\n+// Copyright (c) 2009-2010 Satoshi Nakamoto\n+// Copyright (c) 2009-2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_NODE_WARNINGS_H\n+#define BITCOIN_NODE_WARNINGS_H\n+\n+#include <sync.h>\n+#include <util/translation.h>\n+\n+#include <map>\n+#include <string>\n+#include <vector>\n+\n+class UniValue;\n+\n+namespace node {\n+/**\n+ * @class Warnings\n+ * @brief Manages warning messages within a node.\n+ *\n+ * The Warnings class provides mechanisms to set, unset, and retrieve\n+ * warning messages identified by unique strings. Warning messages are\n+ * managed in a thread-safe manner using mutexes. This class is designed\n+ * to be non-copyable to ensure warnings are managed centrally.\n+ */\n+class Warnings\n+{\n+    mutable Mutex m_mutex;\n+    std::map<std::string, bilingual_str> m_warnings GUARDED_BY(m_mutex);",
      "path": "src/node/warnings.h",
      "position": null,
      "original_position": 31,
      "commit_id": "5dfbc354a7aae9df5b9cfd839981874cb911d06d",
      "original_commit_id": "445e6de114c00311c506b9245adf7f63bbbbec1d",
      "in_reply_to_id": 1610597554,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've incorporated the id-as-enum approach in the latest force-push, thank you very much for both of your extensive feedback.",
      "created_at": "2024-05-23T20:40:42Z",
      "updated_at": "2024-05-23T22:23:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30058#discussion_r1612278118",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1612278118"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30058"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    }
  ]
}
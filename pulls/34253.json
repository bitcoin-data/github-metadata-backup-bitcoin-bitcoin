{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253",
    "id": 3163366332,
    "node_id": "PR_kwDOABII5868jSO8",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34253",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34253.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34253.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a4041df49d40871cf975769f55fa2c29b7ca657d",
    "number": 34253,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: cache tip recency for lock-free `IsInitialBlockDownload()`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Context\r\nThis PR is a follow-up to the stale #32885.\r\n\r\n### Problem\r\n`ChainstateManager::IsInitialBlockDownload()` currently acquires `cs_main` internally, even though most existing call sites already hold the lock. This becomes relevant for proposals like #34054, which would call `IsInitialBlockDownload()` from the scheduler thread without holding `cs_main`, potentially introducing lock contention.\r\n\r\n### Fix\r\nThe key insight is that the tip work/recency check acts as a one-way latch: once satisfied, it remains true (absent a deep reorg). Rather than re-evaluating on every read, we can cache it when the tip changes.\r\n\r\nThe PR introduces `ChainstateManager::SetTip()` as a choke point for active chain tip updates, routing `ConnectTip()`, `DisconnectTip()`, and `LoadChainTip()` through it.\r\nWhen the tip changes, `SetTip()` latches `m_cached_tip_recent` if the new tip satisfies work and recency requirements (via a new `CChain::IsTipRecent()` helper).                                                                  \r\n\r\nWith this, `IsInitialBlockDownload()` depends only on atomics (`m_cached_finished_ibd`,`m_cached_tip_recent`, and `BlockManager::LoadingBlocks()`) allowing the lock to be removed.",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2026-01-11T15:15:32Z",
    "updated_at": "2026-01-11T22:02:55Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "12814f75b0748f63994b92d311aa9552194011c7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/cache-ibd-status",
      "ref": "l0rinc/cache-ibd-status",
      "sha": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 281619,
        "default_branch": "master",
        "open_issues_count": 28,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-11T21:21:23Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-10T21:20:48Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "aeaa67a9eac0decb89c60a67f9755ca10cbcc1d9",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38802,
        "stargazers_count": 87621,
        "watchers_count": 87621,
        "size": 301415,
        "default_branch": "master",
        "open_issues_count": 753,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-11T22:44:29Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-11T22:44:40Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 38,
    "deletions": 20,
    "changed_files": 4,
    "commits": 5,
    "review_comments": 2,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAyOWE2ZGQ3ODAzZDk3YWQyNmU0NzVjYWQxZDA5YmQ2MDZkNjRmYmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/029a6dd7803d97ad26e475cad1d09bd606d64fbc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/029a6dd7803d97ad26e475cad1d09bd606d64fbc",
      "tree": {
        "sha": "42064b448b2e89df56b4848aad14092c11e6e2b4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/42064b448b2e89df56b4848aad14092c11e6e2b4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 42064b448b2e89df56b4848aad14092c11e6e2b4\nparent 595504a43209bead162da54a204df7d140a25f0e\nauthor Lőrinc <pap.lorinc@gmail.com> 1764683679 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768142761 +0100\n\nchain: add `IsTipRecent` helper on `CChain`\n\nFactor the chain tip \"enough work and recent\" checks out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper.\nThis keeps the work/recency definition in one place and makes follow-up caching changes easier to reason about.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmljt6oACgkQZp//D/pH\nenYk8w/9GK1n4P0srQKQ30nu0zlwOOe2ATJufXxagXdKi2I64Dhraz9Tkz/qrycR\n/RcsZmS/NxBd5Oy0mMNyX8G1+mWZejFXYEk1juidkcI5MRu5FZBnoLZfe9yuUXYz\nxvl4zbFaJCI0pevWsscr+mqiGmxHSLXK8Ph85nhJtybWZ3B7JcHCwjt31oD0SUvw\n4FxZZ7BmQLR6i2nCfRCcXOg8OAvCG6Izl+so1AUMoed70m2PB42e+NzxK2CPem82\nSIyZFmNDKSXJcC9wsQ5vp0fx1IJMu57pEwKi9ny0VtBlJpqzD2q7L6BYKAms3fyZ\nIcWZugHq5+cxtyXfvGzbzfy73taXkokunc7DLI6Zzp3mDr02Bwn1dpDbiREpkYKD\n8MI+tyrYjpZcBFT5IE8X5mRUT1Rr1tIjHXXORhYvi5gVrg8WFwFa1pqW+RV66xrx\nPBYdSFGdCv/tqIWV6Q4o4L3yc+Wzr37RZ2wfAaaxS31lD/YHqVOGzrUxpSciRzCH\nUqGZ1H2apvZaKlE4ax46zqmpYQFg0z+zMOakCZO8Kow5AtOc3awSy1Q4j911R1n/\n/83afGRd/D/LyOy1OYWNqIul+AVLiesdOU8snM0N+J6fZH0oEkyENFdwqinMbilr\nzwDm7OLohErrHt2vnT5i0m1HbDl02hiFeqYXzO4tS1pn2GVcddY=\n=5Ehk\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/595504a43209bead162da54a204df7d140a25f0e",
          "sha": "595504a43209bead162da54a204df7d140a25f0e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/595504a43209bead162da54a204df7d140a25f0e"
        }
      ],
      "message": "chain: add `IsTipRecent` helper on `CChain`\n\nFactor the chain tip \"enough work and recent\" checks out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper.\nThis keeps the work/recency definition in one place and makes follow-up caching changes easier to reason about.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T14:46:01Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-02T13:54:39Z"
      },
      "sha": "029a6dd7803d97ad26e475cad1d09bd606d64fbc"
    },
    {
      "event": "labeled",
      "id": 21971286181,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdlzil",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971286181",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:36Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 3734779791,
      "node_id": "IC_kwDOABII587enDeP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3734779791",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:40Z",
      "updated_at": "2026-01-11T22:01:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34253.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3648563264) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#issuecomment-3734779791",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI2ZGVkZjc3ZThlNTU0Y2IwNGQ4OTI3ODM1MDA5NDU1ZWM5MDIwNjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/26dedf77e8e554cb04d8927835009455ec902068",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/26dedf77e8e554cb04d8927835009455ec902068",
      "tree": {
        "sha": "c88b9490ce686e32f1c86bafa1ff0e6e7358b753",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c88b9490ce686e32f1c86bafa1ff0e6e7358b753"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c88b9490ce686e32f1c86bafa1ff0e6e7358b753\nparent 029a6dd7803d97ad26e475cad1d09bd606d64fbc\nauthor Lőrinc <pap.lorinc@gmail.com> 1764690220 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768144579 +0100\n\nvalidation: route active chain `SetTip` through `ChainstateManager`\n\nIntroduce `ChainstateManager::SetTip()` and route active chain tip updates through it from `ConnectTip()`, `DisconnectTip()`, and `LoadChainTip()`.\nCentralizing tip updates makes it harder to miss related state updates in follow-up commits (e.g. caching IBD-related state on tip changes).\n\nAlso switch `m_cached_finished_ibd` to `std::atomic_bool` for consistency with other boolean atomics.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIyBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmljvsQACgkQZp//D/pH\nenZECw/40IdO3/BNvVdoxzHUEi7Ev0y0iVj1p/eVkODsPxhU3UQlKOsETSBMZ92A\n01JWYkisdn5LGc48V2zUvuCWmu13iTS9Ccn3tfIcIK8EGdfTQjTsAOAbfdKd93rJ\n0DzloGssp2ODQniOL0wGByTJVh7uC7jVJ6J0oL6UVzbj/oT/HIU2fsulsTZ9qbKF\ndEMQHMJvl6k3TuxnZLPTM65mLBSQGjlwazoy/PZ2BWKusS4lZbrQ6WYri3Am+9qQ\n6sISFw7kclmzAYzimM6EMrM2oPzQ6XVyZsC/8JpsluJ8dXs8yhZv1Jl5OHTqcrMt\nk8gPK1E6v/akJ7euaKsxl1MQD2wXMtZY2DYIWXhm+KrXODfg/XQWuo06QtYMocxC\nC6AAd1W/ECw5DlRAYr37XcHv0oPIVyFWTMEityU8t6DR7gPcfxQEFvPfMFU2qYqC\n23XYOfVQr9+DFVGNis5EYyMLxSL4iB50VpJLJ2j88jw1gcECUiLph9fDwdtW5PxY\n58R2D4Olb4FIKbdjDUzozHqh3mQI8QsPW0NkCKenLw6ZtCKAMCPkXPe3R+kTv0Ci\neeSJFyGGh0YGD3BjbUF+055jQP6TG7E4ozInc0vm1OpGzPqpsUoWk5Iw0mv6Oj9V\nibtxlbG3ediPDMBTlU5ziHGwtM3BMzBMhiarQw41q6SNayf9xg==\n=Uj1A\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/029a6dd7803d97ad26e475cad1d09bd606d64fbc",
          "sha": "029a6dd7803d97ad26e475cad1d09bd606d64fbc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/029a6dd7803d97ad26e475cad1d09bd606d64fbc"
        }
      ],
      "message": "validation: route active chain `SetTip` through `ChainstateManager`\n\nIntroduce `ChainstateManager::SetTip()` and route active chain tip updates through it from `ConnectTip()`, `DisconnectTip()`, and `LoadChainTip()`.\nCentralizing tip updates makes it harder to miss related state updates in follow-up commits (e.g. caching IBD-related state on tip changes).\n\nAlso switch `m_cached_finished_ibd` to `std::atomic_bool` for consistency with other boolean atomics.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T15:16:19Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-02T15:43:40Z"
      },
      "sha": "26dedf77e8e554cb04d8927835009455ec902068"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE2ZDhiMTA3NGQzNWJmOWVkMWI2OWVkN2RlMDcwZGE5ZGE2MDBkYmQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "tree": {
        "sha": "6ba33209ae1a848ac4b3970ed6a88d171410fddb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ba33209ae1a848ac4b3970ed6a88d171410fddb"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6ba33209ae1a848ac4b3970ed6a88d171410fddb\nparent 26dedf77e8e554cb04d8927835009455ec902068\nauthor Lőrinc <pap.lorinc@gmail.com> 1764690327 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768144580 +0100\n\nvalidation: cache tip recency in `IsInitialBlockDownload`\n\nAdd a `m_cached_tip_recent` latch that becomes true once the active chain tip exists, has at least `MinimumChainWork()`, and is not older than `-maxtipage`.\nUpdate the latch when `SetTip()` advances the active chain so `IsInitialBlockDownload()` can rely on a cached value instead of re-checking the tip.\n\nUpdate `TestChainstateManager` helpers to keep the new latch consistent in tests.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmljvsQACgkQZp//D/pH\nena+nhAAogW6Paa9quE+s11i3Uk5vwMGJZwj8El+gnFB+JXQkXYLugJ/LExTe7yE\n9ydddQlDjiD1vf81run2qM/EsmkuTFbM+ZzGWSqrI7rSzzFO5gxmVGSp/D0IWZ67\nXgKgyjMvEGurad/qKxCMoSOG3M4Qm/SAkchu3cGB8wBUplFm898uo5/Cwbijqcn/\nv9LF14wwb6sa8xce+CSldau1LhxN3EFltLkLU+CdtmuqkE1TVG+VyXOkLtgO6HM+\nzRHc15meRjXOluo7WhsoepudZ1rnIhCzpB0nSGs3ADE8yoAQXVHGQ87ISg8b1MuW\n3DxbH0GfkOaip0i5wK6zSj0yI4pPGdk0p6yoCD3KWb4Vy1CJQZCkXlUnGtcdhxUF\nsb6zIDokmVs1zONSo8WjxQ0PiTg/Xhi1RvFymaODQNOrRYvdAUP+hEYz45/omYhv\n+T3eNEBNiUfNCSsnDfHg/wxmmORrTb8cwTGxkbW7by9qLATZtU1NQSJ1qMlSgNMO\ncKKGtee3Dp+Sshg1uIbeKyMvbj7LdIlTmvcnxmvGjOMLnin2H13pvtNPO+QyJQM7\nTTPh/pMQLSUId9ZzcjMNR6/7snF6P771D8Z4vTVEE0WpIG60eu4V4JtRXEyWK6tZ\nMx/iYysNA7vPryM4ePzUsi9BiwzAuLeL5sfmkSm/LsB8hgaYwPY=\n=9lQb\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/26dedf77e8e554cb04d8927835009455ec902068",
          "sha": "26dedf77e8e554cb04d8927835009455ec902068",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/26dedf77e8e554cb04d8927835009455ec902068"
        }
      ],
      "message": "validation: cache tip recency in `IsInitialBlockDownload`\n\nAdd a `m_cached_tip_recent` latch that becomes true once the active chain tip exists, has at least `MinimumChainWork()`, and is not older than `-maxtipage`.\nUpdate the latch when `SetTip()` advances the active chain so `IsInitialBlockDownload()` can rely on a cached value instead of re-checking the tip.\n\nUpdate `TestChainstateManager` helpers to keep the new latch consistent in tests.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T15:16:20Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-02T15:45:27Z"
      },
      "sha": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAyMjE5ZTk2MjIzMTdjZTY3NmYyNTE0ZDc1NzY4NWY4MmE1OTJhNDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02219e9622317ce676f2514d757685f82a592a48",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/02219e9622317ce676f2514d757685f82a592a48",
      "tree": {
        "sha": "3e30ec1654df7317bceda83401f27e017c4fe247",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e30ec1654df7317bceda83401f27e017c4fe247"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3e30ec1654df7317bceda83401f27e017c4fe247\nparent a6d8b1074d35bf9ed1b69ed7de070da9da600dbd\nauthor Lőrinc <pap.lorinc@gmail.com> 1764697740 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768144580 +0100\n\nvalidation: remove lock from `IsInitialBlockDownload`\n\nNow that `IsInitialBlockDownload()` depends only on atomic state (`m_cached_finished_ibd`, `m_cached_tip_recent`, and `BlockManager::LoadingBlocks()`), it no longer needs to take `cs_main`.\nRemove the lock and the now-redundant pre-test.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmljvsQACgkQZp//D/pH\nenaxfBAAs47VkaJikmZWy+Kye8APIskJ7OxMVsDKeIH5b+AeH8wclH7yFj+sVqW+\nz8vbGssHS/gGo6bT47N4aZcIDSGlOuzQQ7H60mPW87Wvch1KbygTJDsDYrDdxYR9\nYC3z4jJnBZNj8T7FYG1EC4x7ZWi1fI59ksb+Ge62v1Lkac6Ig1dYRxCtOUkyvTmN\n+uHw1YlBUXn45DoGJ4KeIDjIIVE7UJ2C9lMcLi+iFOEAzsmqtc3ryROw9AbCvXCW\ntemGmG5sdsW3Ov9Z3/paKitj9dZqyn7IMaJVu4fJZaambQ2myUtSnRZUOUXusK+V\nrac0T4SrrcfjZaUkB61Yy4S6NvUux42GVmFG+8bWm17Dgy1hIXHGpW7rvq5+yj4a\nbDM2ldLICIvISQsH+cXOsum9nNMwxX7YjqCzuJGIHAwB/GJ6ymYippimYJEjBxGk\n9S+eIS6aTI7mV1yrfq1zB3Bx+gzgQWnoF1pujh+b7sWh1uDLMbjA5R2miihj8KAc\ncPU1CFRMTWmgksuBNqHOpIh+x+YqA+8hJLQFHzj+0lFsMtFvJ+SebAJf/Yu7d7jS\nNr6NvLpzyc6Ii5NDU54QCbUeGNoG5IIbVYRU8lgMN1+vlZQUqmAw3gQHCez2uJlD\nRhfOxhlMDlRShCL0qHPHFKH4WfVT6Tg5c9U1NTlQTlRfvpHTLQc=\n=IpQi\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
          "sha": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a6d8b1074d35bf9ed1b69ed7de070da9da600dbd"
        }
      ],
      "message": "validation: remove lock from `IsInitialBlockDownload`\n\nNow that `IsInitialBlockDownload()` depends only on atomic state (`m_cached_finished_ibd`, `m_cached_tip_recent`, and `BlockManager::LoadingBlocks()`), it no longer needs to take `cs_main`.\nRemove the lock and the now-redundant pre-test.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T15:16:20Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-02T17:49:00Z"
      },
      "sha": "02219e9622317ce676f2514d757685f82a592a48"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE0MDQxZGY0OWQ0MDg3MWNmOTc1NzY5ZjU1ZmEyYzI5YjdjYTY1N2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a4041df49d40871cf975769f55fa2c29b7ca657d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a4041df49d40871cf975769f55fa2c29b7ca657d",
      "tree": {
        "sha": "da1718a3d221ebeacabf7da5749ab6c0fa43d2d3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/da1718a3d221ebeacabf7da5749ab6c0fa43d2d3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree da1718a3d221ebeacabf7da5749ab6c0fa43d2d3\nparent 02219e9622317ce676f2514d757685f82a592a48\nauthor Lőrinc <pap.lorinc@gmail.com> 1768142023 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768144580 +0100\n\nvalidation: avoid redundant IBD exit log\n\nWith `IsInitialBlockDownload()` lock-free, multiple threads can concurrently reach the latching path and emit duplicate \"Leaving InitialBlockDownload\" logs.\nUse `m_cached_finished_ibd.exchange(true, ...)` so the log is only emitted on the false->true transition.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmljvsQACgkQZp//D/pH\nenbg9xAAhP9PlMDAX6BbMDry747YZdX7zCzOrKSlPkkes0Hm7arxUQ8N3CJW6q4a\nG7rruyMucWuEXwiYGZLjiMh3fPNFHaKRv8AmpPOKoCnmwjInVNR3VPxRfpjRuGxr\nY2MfZw/ktBTIf0HREBWBITawCcusDBKeskPAqRx0BDKDj+x981prMPfK2EN5tF6l\nUkW07VCPNYaDZBdxiG1EzHYUNWEKV/oVZBfNV7TsEaflYHgzOovQStvRBbRVo/vO\nB8ZSALJhaAIgBTDkRbOIs2INJeJbxkkK7YZEslCObtYqXj3pQAUynpQR7GNynIi9\ni5JXzP1yGvj7LPKT9dniEPX09q1kBEQCd5q+DhzwM7eLa1oKDKX+ykR2iwEeusbH\nQZ1RIxBHlOIQqw/mjZDChmJYLVScOOTSCXE/CiKLKEu9XmHr4G4Rh/RsoW0ceySw\nSjtdidNtLg6bq+p7LmVDQk2lcv0NI6TOiZtRWcGpC3KArbreSQ+gLIFD4KKkgkVw\nctfo17mDgow3BtUowKS60Hs2fqYBMNVdDHKJ/8QXw8guhwx5Qsyd2NRbh7fdjpDu\nCyfw27M3WoEruDipCNNZKTQoJR8U7vuzGwUNPd3iP0e28t5+lCnufTHqThu4sWXT\n+LlJIkAwnG6wjPEQ2MMUGKqMV/5GmEhTzFISr6MUIL2PZzObrOY=\n=jkZz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02219e9622317ce676f2514d757685f82a592a48",
          "sha": "02219e9622317ce676f2514d757685f82a592a48",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/02219e9622317ce676f2514d757685f82a592a48"
        }
      ],
      "message": "validation: avoid redundant IBD exit log\n\nWith `IsInitialBlockDownload()` lock-free, multiple threads can concurrently reach the latching path and emit duplicate \"Leaving InitialBlockDownload\" logs.\nUse `m_cached_finished_ibd.exchange(true, ...)` so the log is only emitted on the false->true transition.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T15:16:20Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T14:33:43Z"
      },
      "sha": "a4041df49d40871cf975769f55fa2c29b7ca657d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21971297094,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUdl2NG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971297094",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a4041df49d40871cf975769f55fa2c29b7ca657d",
      "created_at": "2026-01-11T15:16:28Z"
    },
    {
      "event": "labeled",
      "id": 21971305163,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdl4LL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971305163",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:17:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21972208162,
      "node_id": "UNLE_lADOABII587ilTpmzwAAAAUdpUoi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972208162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:30:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "ready_for_review",
      "id": 21972311851,
      "node_id": "RFRE_lADOABII587ilTpmzwAAAAUdpt8r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972311851",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:37:55Z"
    },
    {
      "event": "unsubscribed",
      "id": 21975329271,
      "node_id": "UE_lADOABII587ilTpmzwAAAAUd1On3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21975329271",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T20:27:40Z"
    },
    {
      "event": "reviewed",
      "id": 3648563264,
      "node_id": "PRR_kwDOABII587ZeKhA",
      "url": null,
      "actor": null,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-11T22:02:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK (I didn't review the latest approach of #32885, just this one), it would help to be able to call `IsIBD()` without having to worry about `cs_main` locking.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3648563264",
      "submitted_at": "2026-01-11T22:01:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595",
      "pull_request_review_id": 3648563264,
      "id": 2680313595,
      "node_id": "PRRC_kwDOABII586fwlb7",
      "diff_hunk": "@@ -1038,6 +1038,9 @@ class ChainstateManager\n      */\n     mutable std::atomic_bool m_cached_finished_ibd{false};\n \n+    /** Latch that becomes true once the active tip has met IsTipRecent(). */\n+    mutable std::atomic_bool m_cached_tip_recent{false};",
      "path": "src/validation.h",
      "position": 8,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think having both `m_cached_tip_recent` and `m_cached_finished_ibd` may be more complicated than necessary. Probably the reason for it is that `IsIBD()` should latch to true also after `ImportBlocks()` without having to wait for a new block.\r\nWould it work to instead have just one atomic called `m_cached_finished_ibd` that is only set when `LoadingBlocks()` is false, ans set it in a function `ChainstateManager::MaybeExitIBD()`  that would be called both from `ChainstateManager::SetTip` (within the current approach, see also my other comment about that) and at the end of `ImportBlocks()` when `ImportingNow` went out of scope`?",
      "created_at": "2026-01-11T21:26:12Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680313595",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1042,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280",
      "pull_request_review_id": 3648563264,
      "id": 2680342280,
      "node_id": "PRRC_kwDOABII586fwscI",
      "diff_hunk": "@@ -3004,7 +3004,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n         }\n     }\n \n-    m_chain.SetTip(*pindexDelete->pprev);\n+    m_chainman.SetTip(m_chain, *pindexDelete->pprev);",
      "path": "src/validation.cpp",
      "position": 39,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "26dedf77e8e554cb04d8927835009455ec902068",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I find it a bit weird to have a function `SetTip` on the level of `ChainstateManager`, that would naturally live on a Chainstate/Chain level.\r\nI saw the justification of coupling the two close to make it harder to \"miss related state updates\", but I am not really convinced by it: It can still be easily forgotten by just using `Chain::SetTip` instead, like many tests  do, and there are only 3 affected call sites outside of tests.\r\nMaybe it would be simpler to not couple the two and call a separate function `ChainstateManager::MaybeExitIBD()` at the 3 call sites (`DisconnectTip`, `ConnectTip`, `LoadChainTip`) right after the `CChain::SetTip()` call.",
      "created_at": "2026-01-11T21:43:08Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680342280",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3004,
      "original_line": 3007,
      "side": "RIGHT"
    }
  ]
}
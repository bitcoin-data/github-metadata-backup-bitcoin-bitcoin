{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253",
    "id": 3163366332,
    "node_id": "PR_kwDOABII5868jSO8",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34253",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34253.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34253.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/63e822b637f67242e3689adedc0155b34100e651",
    "number": 34253,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: cache tip recency for lock-free `IsInitialBlockDownload()`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Context\r\nThis PR is a follow-up to the stale #32885.\r\n\r\n### Problem\r\n`ChainstateManager::IsInitialBlockDownload()` currently acquires `cs_main` internally, even though most existing call sites already hold the lock. This becomes relevant for proposals like #34054, which would call `IsInitialBlockDownload()` from the scheduler thread without holding `cs_main`, potentially introducing lock contention.\r\n\r\n### Fix\r\nMake `ChainstateManager::IsInitialBlockDownload()` lock-free by caching its result in a single atomic `m_cached_is_ibd` (true while in IBD, latched to false on exit).\r\nMove the IBD exit checks out of `IsInitialBlockDownload()` (reader-side) into a new `ChainstateManager::UpdateIBDStatus()` (writer-side, called under cs_main).\r\n\r\nCall UpdateIBDStatus() at strategic points where IBD exit conditions may change, after active chain tip updates in `ConnectTip()`, `DisconnectTip()`, and `LoadChainTip()`, and after `ImportBlocks()` returns.\r\n\r\nWith this, `IsInitialBlockDownload()` becomes a lock-free atomic read, avoiding internal `cs_main` acquisition on hot paths.",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2026-01-11T15:15:32Z",
    "updated_at": "2026-01-12T11:27:34Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "4e2effc2b562be4dd3a0c5678024f767a42764bc",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/cache-ibd-status",
      "ref": "l0rinc/cache-ibd-status",
      "sha": "63e822b637f67242e3689adedc0155b34100e651",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 281549,
        "default_branch": "master",
        "open_issues_count": 28,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-12T10:11:03Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-10T21:20:48Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "abc6a3a4eb9814a7f17e40f7a4d330cbef86bff0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38859,
        "stargazers_count": 87626,
        "watchers_count": 87626,
        "size": 301410,
        "default_branch": "master",
        "open_issues_count": 755,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-11T22:44:29Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-12T10:38:01Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 87,
    "deletions": 40,
    "changed_files": 8,
    "commits": 4,
    "review_comments": 4,
    "comments": 2
  },
  "events": [
    {
      "event": "labeled",
      "id": 21971286181,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdlzil",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971286181",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:36Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 3734779791,
      "node_id": "IC_kwDOABII587enDeP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3734779791",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:40Z",
      "updated_at": "2026-01-12T10:11:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34253.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3648563264) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (✨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- \"to prioritize the snapshot chainstate, giving it more cache space than the snapshot chainstate.\" -> \"to prioritize the snapshot chainstate, giving it more cache space than the other chainstate.\" [The sentence repeats \"snapshot chainstate\" twice, which is likely a copy-paste error and makes the intended comparison unclear.]\n\n\n\n<sup>2026-01-12</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#issuecomment-3734779791",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21971297094,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUdl2NG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971297094",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a4041df49d40871cf975769f55fa2c29b7ca657d",
      "created_at": "2026-01-11T15:16:28Z"
    },
    {
      "event": "labeled",
      "id": 21971305163,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdl4LL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971305163",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:17:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21972208162,
      "node_id": "UNLE_lADOABII587ilTpmzwAAAAUdpUoi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972208162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:30:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "ready_for_review",
      "id": 21972311851,
      "node_id": "RFRE_lADOABII587ilTpmzwAAAAUdpt8r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972311851",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:37:55Z"
    },
    {
      "event": "unsubscribed",
      "id": 21975329271,
      "node_id": "UE_lADOABII587ilTpmzwAAAAUd1On3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21975329271",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T20:27:40Z"
    },
    {
      "event": "reviewed",
      "id": 3648563264,
      "node_id": "PRR_kwDOABII587ZeKhA",
      "url": null,
      "actor": null,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-11T22:02:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK (I didn't review the latest approach of #32885, just this one), it would help to be able to call `IsIBD()` without having to worry about `cs_main` locking.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3648563264",
      "submitted_at": "2026-01-11T22:01:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIxNWE3NTI1Zjc0OTUzZThmMDc5ZTVhMDZjYzY4ODBkZWZjOGM1Y2E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b15a7525f74953e8f079e5a06cc6880defc8c5ca",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b15a7525f74953e8f079e5a06cc6880defc8c5ca",
      "tree": {
        "sha": "1ca23e16ecde44a4a1b1e6a8578f1fb2a9e190ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1ca23e16ecde44a4a1b1e6a8578f1fb2a9e190ab"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1ca23e16ecde44a4a1b1e6a8578f1fb2a9e190ab\nparent 595504a43209bead162da54a204df7d140a25f0e\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172275 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768211072 +0100\n\ntest: cover IBD exit after block loading\n\nAdd a unit test ensuring IBD does not exit while `BlockManager::LoadingBlocks()` is true, and stays exited once block loading finishes.\nAdd some minor test doc fixes while we're here.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlkwoEACgkQZp//D/pH\nenbjihAAoZ95bv0mDrnUUMdf9dYL1IjUgACdLginHzjRX2ObHK8bhmnbTDbJV3kF\ngxHJFfQc1XB/GyNqAAzMozAToTShn3R12zEnBTHM/48zdBjNT6/8yQiEklLGEKcB\nXoXRyH6tzVxf+3Amoe+MUBbDPEnRfGhOjgMVyV09QLAZHOfMlC5ngqisgOLnru0X\nlXMZEEbxXYN5VqrXB6R2BWgAoC7qa0B1w3lluWidDV7/9lMoLkNEhyINyK5B2Wmy\nG2LChEO7W48fF4MtxbRy4BQuNaqFgjqdkTJ1350dKcl5nVQ5tHFCnvMa2IAcCEPp\nvbl7H8hUdL9B0+7QMxUMj39Ls7tPElNrXwk0iftNnPSDXy+D/cewpgavu6Oiat0h\nmpcgPYW4o1lK5B3xLZTUsrZFFHM2JGwjTv7D08wLPZRYmGsMPzRVwMUAAlsS6gG3\nsOZEVo6SKS8vGEI/cxiksL7WcFgGigBdUpUQvzu5lcquIdVErT7ygjVXcZwJt1jV\nTwZukXEjHijZCuk2OeaH24d3AIJDhY+F4GN/054IkwKSgnEsTf3keghYm1If/0ef\nkwA1jGU5YdFWelfwPd3PN3vcgLJBL3/lUAoId+J3ScKPu0NLJ4Ku1CLTYbxDKHaA\n6hNmzUqdd148YzRCzzFw0AVGPTs6zWNsSw30X7wrde2s5YYVmz4=\n=bFbm\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/595504a43209bead162da54a204df7d140a25f0e",
          "sha": "595504a43209bead162da54a204df7d140a25f0e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/595504a43209bead162da54a204df7d140a25f0e"
        }
      ],
      "message": "test: cover IBD exit after block loading\n\nAdd a unit test ensuring IBD does not exit while `BlockManager::LoadingBlocks()` is true, and stays exited once block loading finishes.\nAdd some minor test doc fixes while we're here.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T09:44:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:57:55Z"
      },
      "sha": "b15a7525f74953e8f079e5a06cc6880defc8c5ca"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21985191970,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUea2gi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985191970",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "cac06c45a971355ab8655d3875b65f14b3febfe4",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/cac06c45a971355ab8655d3875b65f14b3febfe4",
      "created_at": "2026-01-12T10:00:50Z"
    },
    {
      "event": "commented",
      "id": 3737752862,
      "node_id": "IC_kwDOABII587eyZUe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3737752862",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:19Z",
      "updated_at": "2026-01-12T10:04:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks to @mzumsande for the hint to simplify this, added you as coauthor.\r\n\r\nThe new push makes `ChainstateManager::IsInitialBlockDownload()` lock-free by caching its result in a single atomic `m_cached_is_ibd` (inverted to match the method) and moving the exit checks into a new `ChainstateManager::UpdateIBDStatus()` (named it differently than you suggested, don't like maybes - it's called under `cs_main` after tip updates and after `ImportBlocks()` finishes).\r\nIBD exit criteria (enough work + recent tip) are encapsulated in a new `CChain::IsTipRecent()` helper, and a unit test covers the post-loading IBD exit/latching behavior (added early to show current behavior and changed throughout the PR to demonstrate the changes).\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#issuecomment-3737752862",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253"
    },
    {
      "event": "mentioned",
      "id": 21985270695,
      "node_id": "MEE_lADOABII587ilTpmzwAAAAUebJun",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985270695",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:20Z"
    },
    {
      "event": "subscribed",
      "id": 21985270732,
      "node_id": "SE_lADOABII587ilTpmzwAAAAUebJvM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985270732",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:21Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBjNWYyZjg4YzViNTliYTc4OGExNDFlOTMxZGRmNjhmOTUzMjM2YjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0c5f2f88c5b59ba788a141e931ddf68f953236b5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0c5f2f88c5b59ba788a141e931ddf68f953236b5",
      "tree": {
        "sha": "17ba751e8c7edea36ad0d1f65054275ffab2109c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/17ba751e8c7edea36ad0d1f65054275ffab2109c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 17ba751e8c7edea36ad0d1f65054275ffab2109c\nparent b15a7525f74953e8f079e5a06cc6880defc8c5ca\nauthor Lőrinc <pap.lorinc@gmail.com> 1768173184 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768212654 +0100\n\nvalidation: invert `m_cached_finished_ibd` to `m_cached_is_ibd`\n\nRename and invert the internal IBD latch so the cached value directly matches `IsInitialBlockDownload()` (true while in IBD, then latched to false).\nThis is a behavior-preserving refactor to avoid double negatives.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlkyK4ACgkQZp//D/pH\nenYBPQ//dTiFjeh2W/I684OFgKAcVybiF9vqxT/RnUe2jP6lWV880o244/GM1mwT\nxCtBgdhOTC4FE4qCvLIJt/AskMjBJFGmNwwaElNSA4JZQeiP4aQc8+3yxkdGxrpc\nGGFI7a5BHPQzgPOr4BqrAaLvuHcqaypqY8FJZ9cWyriqwcM4SG3tbuARk0QniPIz\nUGwhAclkEDf7ZO/pVQ9Ova+FYRO71htWsFcF9XiDCnoIqo8EQCSB17tc7ka6dSVs\nrm9NBGtXWAp3X2+6rNfd3u9lbMeO+WM2rvaHxW6HXFV7cYOpQ6qF4EEgahqgDtZj\nCnLvPTZu/0W82bEkJuBvYUKSyuTYZDnvEiLAPzmRCpkyh1t6Fx/SScNuKMHWjN80\nCFev/UJlpYG4Nx3p7Hk8vXwkR+C8h7+cpbPM0ea830O9AkjdNSuxAAxxgZ6cvWHS\nJ1n9J9vvrGd3FNhFrfHxoIZdaqwbYNQWMhZnwuLpMk3iLJTjD7o9XNCPbauQi8bn\n4iaRvK/Wg8/B91be9SNM6rWMc7prgNv74+rSibVlyC2PTrS7E2nBX4QJQF37Mw7f\nKKQzXu8sF68QoIyrs4sF9h7fzNA3g0vPCYUtI8IpD1POeLFn9gR586Ed+R4POyFM\nes0wgBt7DCg8Elc3BbmClwF552XdlY9bzk4bWzosqj6QQqGsMTY=\n=Y3IL\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b15a7525f74953e8f079e5a06cc6880defc8c5ca",
          "sha": "b15a7525f74953e8f079e5a06cc6880defc8c5ca",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b15a7525f74953e8f079e5a06cc6880defc8c5ca"
        }
      ],
      "message": "validation: invert `m_cached_finished_ibd` to `m_cached_is_ibd`\n\nRename and invert the internal IBD latch so the cached value directly matches `IsInitialBlockDownload()` (true while in IBD, then latched to false).\nThis is a behavior-preserving refactor to avoid double negatives.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T10:10:54Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T23:13:04Z"
      },
      "sha": "0c5f2f88c5b59ba788a141e931ddf68f953236b5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlhZGU4NzM1OGM0YWQ2ODUzNjAzYTMwNWQ1MTI1MjYzY2I2NGYzMjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9ade87358c4ad6853603a305d5125263cb64f326",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9ade87358c4ad6853603a305d5125263cb64f326",
      "tree": {
        "sha": "6dd6462e0c897e4f0c359507b5a7815a78fb3125",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6dd6462e0c897e4f0c359507b5a7815a78fb3125"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6dd6462e0c897e4f0c359507b5a7815a78fb3125\nparent 0c5f2f88c5b59ba788a141e931ddf68f953236b5\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172181 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768212654 +0100\n\nchain: add `CChain::IsTipRecent` helper\n\nFactor the chain tip work/recency check out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper, and annotate it as requiring `cs_main` since it's reading mutable state.\n\nAlso introduce a local `chainman_ref` in the kernel import-blocks wrapper to reduce repetition and keep follow-up diffs small.\n\n`IsInitialBlockDownload` returns were also unified to make the followup move clean.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlkyK4ACgkQZp//D/pH\nenZNGBAAvkzttv1o0xuTW/VBZojKzwCpmqWpUGj2rj4TrNoldX82pLCtcSWpf01F\nZNfuPl65hTzEXxs8gR0YTMkwsF+HOwREa/17sgtKYcvEWy4joS9cLBkW8RqBLePP\nWewwjcjeTCU50hgqB9RnSi/GF9vLURdq7gkTIEvxr6RlS3wJuzNYZBZ5m8WnZ/lB\npVWEHPUR25pG9PxrKmeHi0GwjdQnIYjRlIGWqgocDxLpTgzriKeTcwkbe76CLr4X\n1LFv+4MHRZbXZjoWXXPg9OpDL+LW5wJQa1by06CntRdkbfTEC9+kOXBN/tAVBc6/\n1qmSiq7oX7ywpPqQW9cnlYyk+64BxZHaQsQyasNM9uk3I9/RFD2Aiby/XyxxXyLt\ni+AlWw/NkRV8pwvRYk+zT2Abf2qFZ2mWaNsSa6Vz2Vf40+UbZEKwhh/oysdi860D\nqt0ByZQ0+P5sbHIOADnKYeFRGnKIqM2lB0l7LZUhxPSUQRwCUr6qVH9Pg25TXMYh\n89D5HjYwf5TEJng1uDBlWSyCfZdMt7O9o3XdQ3SIXBSoOjvVvYaBUrrK3TPWU9la\nBQVF0zWLmFBeuAY/YN3Ct+QwAO0GOua81mxId+ycBHla2ozcM38mO5EUozAWOPbE\nvlDpODxmfLTvt8v7xOP40koVVYLONq/1lXOTkMgAWV+RnLmT0Ag=\n=B5vJ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0c5f2f88c5b59ba788a141e931ddf68f953236b5",
          "sha": "0c5f2f88c5b59ba788a141e931ddf68f953236b5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0c5f2f88c5b59ba788a141e931ddf68f953236b5"
        }
      ],
      "message": "chain: add `CChain::IsTipRecent` helper\n\nFactor the chain tip work/recency check out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper, and annotate it as requiring `cs_main` since it's reading mutable state.\n\nAlso introduce a local `chainman_ref` in the kernel import-blocks wrapper to reduce repetition and keep follow-up diffs small.\n\n`IsInitialBlockDownload` returns were also unified to make the followup move clean.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T10:10:54Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:56:21Z"
      },
      "sha": "9ade87358c4ad6853603a305d5125263cb64f326"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYzZTgyMmI2MzdmNjcyNDJlMzY4OWFkZWRjMDE1NWIzNDEwMGU2NTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/63e822b637f67242e3689adedc0155b34100e651",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/63e822b637f67242e3689adedc0155b34100e651",
      "tree": {
        "sha": "821f3c86c6fa4a787136129941295304d8ebc25f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/821f3c86c6fa4a787136129941295304d8ebc25f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 821f3c86c6fa4a787136129941295304d8ebc25f\nparent 9ade87358c4ad6853603a305d5125263cb64f326\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172233 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768212655 +0100\n\nvalidation: make `IsInitialBlockDownload()` lock-free\n\n`ChainstateManager::IsInitialBlockDownload()` is queried on hot paths and previously acquired `cs_main` internally, contributing to lock contention.\n\nCache the IBD status in `m_cached_is_ibd`, and introduce `ChainstateManager::UpdateIBDStatus()` to latch it once block loading has finished and the current chain tip has enough work and is recent.\nCall the updater after tip updates and after `ImportBlocks()` completes.\nSince `IsInitialBlockDownload()` no longer updates the cache, drop `mutable` from `m_cached_is_ibd` and only update it from `UpdateIBDStatus()` under `cs_main`.\n\nUpdate the unit test to exercise `UpdateIBDStatus()`.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlkyK8ACgkQZp//D/pH\nenYq4BAAqeNyU76Lmp4hTLmIttWRIYhTxDsBpeHnNlUIvHFWgpj60xzwa/948HOz\n1pPKz2/x49Z2fmigVXhVWwkhOWCFffqtz1jq9uZqMJeG0vmFnkN9wqykFRU2kJU2\nt+7QSY32MaE27kZs4RNvZMSjeNHzYO2j2iTLK57EA3Tk3jtLr9KQ7PVObdRAIx2v\nuARmZ6yyL/bjd7y0UqhVjxZ35nybb4wQX9jw4NVBB/FE0ykWVX6p7l0Hm3cysj+9\niIaRFNo3BetKP5dbkagwtgbTVcCIcQG5SkAGUwK2Iw6YvVlcHgnlrOho8DU2veNf\nnJPyEg9tFBLKJyg7/gw0jrdSF8mvP/zS/y5+RWWK2zcPs6hNsZDf1zqUmK/gzBDb\nu75Qu6Y3Vd/iUX0zlxoERZosveeNyMY2PYKgYJdv3l2R+EDLv64Ql3WY8pH+mhiX\n/YRQM17h3/yuDeQNIa1SpDNd4sxmbfJl2YlAcQq+L/Fnn7EE3TyWCzh0FrU1+63D\n2WqxEWizgRk4jOyAH2z0SDulnksdqQjPbAk+TblE4RAyPVLO7mRduu2TiK7LiP7c\nNCDebS8RnFz5OLxmVTumB5EpajaKw3yXtG4ny/rIDccJcYfOsMSXPGhVKidJshFV\nZEvuafcGIOb1+La7C4+YzCwY+6UeYKTewuIcjPnkP04OJEb8wFY=\n=+YKl\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9ade87358c4ad6853603a305d5125263cb64f326",
          "sha": "9ade87358c4ad6853603a305d5125263cb64f326",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9ade87358c4ad6853603a305d5125263cb64f326"
        }
      ],
      "message": "validation: make `IsInitialBlockDownload()` lock-free\n\n`ChainstateManager::IsInitialBlockDownload()` is queried on hot paths and previously acquired `cs_main` internally, contributing to lock contention.\n\nCache the IBD status in `m_cached_is_ibd`, and introduce `ChainstateManager::UpdateIBDStatus()` to latch it once block loading has finished and the current chain tip has enough work and is recent.\nCall the updater after tip updates and after `ImportBlocks()` completes.\nSince `IsInitialBlockDownload()` no longer updates the cache, drop `mutable` from `m_cached_is_ibd` and only update it from `UpdateIBDStatus()` under `cs_main`.\n\nUpdate the unit test to exercise `UpdateIBDStatus()`.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T10:10:55Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:57:13Z"
      },
      "sha": "63e822b637f67242e3689adedc0155b34100e651"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21985432845,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUebxUN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985432845",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "63e822b637f67242e3689adedc0155b34100e651",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/63e822b637f67242e3689adedc0155b34100e651",
      "created_at": "2026-01-12T10:11:04Z"
    },
    {
      "event": "labeled",
      "id": 21985447943,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUeb1AH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985447943",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:11:44Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21987095570,
      "node_id": "UNLE_lADOABII587ilTpmzwAAAAUeiHQS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21987095570",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T11:27:34Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595",
      "pull_request_review_id": 3648563264,
      "id": 2680313595,
      "node_id": "PRRC_kwDOABII586fwlb7",
      "diff_hunk": "@@ -1038,6 +1038,9 @@ class ChainstateManager\n      */\n     mutable std::atomic_bool m_cached_finished_ibd{false};\n \n+    /** Latch that becomes true once the active tip has met IsTipRecent(). */\n+    mutable std::atomic_bool m_cached_tip_recent{false};",
      "path": "src/validation.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think having both `m_cached_tip_recent` and `m_cached_finished_ibd` may be more complicated than necessary. Probably the reason for it is that `IsIBD()` should latch to true also after `ImportBlocks()` without having to wait for a new block.\r\nWould it work to instead have just one atomic called `m_cached_finished_ibd` that is only set when `LoadingBlocks()` is false, ans set it in a function `ChainstateManager::MaybeExitIBD()`  that would be called both from `ChainstateManager::SetTip` (within the current approach, see also my other comment about that) and at the end of `ImportBlocks()` when `ImportingNow` went out of scope`?",
      "created_at": "2026-01-11T21:26:12Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680313595",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280",
      "pull_request_review_id": 3648563264,
      "id": 2680342280,
      "node_id": "PRRC_kwDOABII586fwscI",
      "diff_hunk": "@@ -3004,7 +3004,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n         }\n     }\n \n-    m_chain.SetTip(*pindexDelete->pprev);\n+    m_chainman.SetTip(m_chain, *pindexDelete->pprev);",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "26dedf77e8e554cb04d8927835009455ec902068",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I find it a bit weird to have a function `SetTip` on the level of `ChainstateManager`, that would naturally live on a Chainstate/Chain level.\r\nI saw the justification of coupling the two close to make it harder to \"miss related state updates\", but I am not really convinced by it: It can still be easily forgotten by just using `Chain::SetTip` instead, like many tests  do, and there are only 3 affected call sites outside of tests.\r\nMaybe it would be simpler to not couple the two and call a separate function `ChainstateManager::MaybeExitIBD()` at the 3 call sites (`DisconnectTip`, `ConnectTip`, `LoadChainTip`) right after the `CChain::SetTip()` call.",
      "created_at": "2026-01-11T21:43:08Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680342280",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3007,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681584887",
      "pull_request_review_id": 3649986425,
      "id": 2681584887,
      "node_id": "PRRC_kwDOABII586f1bz3",
      "diff_hunk": "@@ -3004,7 +3004,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n         }\n     }\n \n-    m_chain.SetTip(*pindexDelete->pprev);\n+    m_chainman.SetTip(m_chain, *pindexDelete->pprev);",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "26dedf77e8e554cb04d8927835009455ec902068",
      "in_reply_to_id": 2680342280,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, thanks",
      "created_at": "2026-01-12T10:04:42Z",
      "updated_at": "2026-01-12T10:04:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2681584887",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681584887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3007,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681585359",
      "pull_request_review_id": 3649986960,
      "id": 2681585359,
      "node_id": "PRRC_kwDOABII586f1b7P",
      "diff_hunk": "@@ -1038,6 +1038,9 @@ class ChainstateManager\n      */\n     mutable std::atomic_bool m_cached_finished_ibd{false};\n \n+    /** Latch that becomes true once the active tip has met IsTipRecent(). */\n+    mutable std::atomic_bool m_cached_tip_recent{false};",
      "path": "src/validation.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "in_reply_to_id": 2680313595,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, thanks",
      "created_at": "2026-01-12T10:04:50Z",
      "updated_at": "2026-01-12T10:04:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2681585359",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681585359"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1042,
      "side": "RIGHT"
    }
  ]
}
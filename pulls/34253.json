{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253",
    "id": 3163366332,
    "node_id": "PR_kwDOABII5868jSO8",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34253",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34253.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34253.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/557b41a38ccf2929ca1e5271db1701e5fbe781af",
    "number": 34253,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "validation: cache tip recency for lock-free `IsInitialBlockDownload()`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This PR is a follow-up to the stale #32885.\r\n\r\n### Problem\r\n`ChainstateManager::IsInitialBlockDownload()` currently acquires `cs_main` internally, even though most existing call sites already hold the lock. This becomes relevant for proposals like #34054, which would call `IsInitialBlockDownload()` from the scheduler thread without holding `cs_main`, potentially introducing lock contention.\r\n\r\n### Fix\r\nMake `ChainstateManager::IsInitialBlockDownload()` lock-free by caching its result in a single atomic `m_cached_is_ibd` (true while in IBD, latched to false on exit).\r\nMove the IBD exit checks out of `IsInitialBlockDownload()` (reader-side) into a new `ChainstateManager::UpdateIBDStatus()` (writer-side, called under cs_main).\r\n\r\nCall UpdateIBDStatus() at strategic points where IBD exit conditions may change, after active chain tip updates in `ConnectTip()`, `DisconnectTip()`, and `LoadChainTip()`, and after `ImportBlocks()` returns.\r\n\r\nWith this, `IsInitialBlockDownload()` becomes a lock-free atomic read, avoiding internal `cs_main` acquisition on hot paths.\r\n\r\n### Testing and Benchmarks\r\nThis isn't strictly an optimization (though some usecases might benefit from it), so rather as a sanity check I ran a reindex-chainstate and an `AssumeUTXO` load (without background validation).\r\n\r\n<details>\r\n<summary>assumeutxo load | 910000 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | xfs | SSD</summary>\r\n\r\n```\r\nCOMMITS=\"595504a43209bead162da54a204df7d140a25f0e 63e822b637f67242e3689adedc0155b34100e651\"; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/ShallowBitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; UTXO_SNAPSHOT_PATH=\"$BASE_DIR/utxo-910000.dat\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done; echo \"\") && \\\r\nfor DBCACHE in 4500; do \\\r\n  (echo \"assumeutxo load | 910000 blocks | dbcache ${DBCACHE} | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM | $(df -T $BASE_DIR | awk 'NR==2{print $2}') | $(lsblk -no ROTA $(df --output=source $BASE_DIR | tail -1) | grep -q 0 && echo SSD || echo HDD)\";) &&\\\r\n  hyperfine \\\r\n  --sort command \\\r\n  --runs 3 \\\r\n  --export-json \"$BASE_DIR/assumeutxo-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$DBCACHE-$CC-$(date +%s).json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall -9 bitcoind 2>/dev/null; rm -rf $DATA_DIR/blocks $DATA_DIR/chainstate $DATA_DIR/chainstate_snapshot $DATA_DIR/debug.log; git clean -fxd; git reset --hard {COMMIT} && \\\r\n             cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo && ninja -C build bitcoind bitcoin-cli -j2 && \\\r\n             ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; sleep 20 && \\\r\n             ./build/bin/bitcoind -datadir=$DATA_DIR -daemon -blocksonly -connect=0 -dbcache=$DBCACHE -printtoconsole=0; sleep 20\" \\\r\n   --conclude \"build/bin/bitcoin-cli -datadir=$DATA_DIR stop || true; killall bitcoind || true; sleep 10; \\\r\n               echo '{COMMIT} | dbcache=$DBCACHE | chainstate: $(find $DATA_DIR/chainstate_snapshot -type f 2>/dev/null | wc -l) files, $(du -sb $DATA_DIR/chainstate_snapshot 2>/dev/null | cut -f1) bytes' >> $DATA_DIR/debug.log; \\\r\n               cp $DATA_DIR/debug.log $LOG_DIR/debug-assumeutxo-{COMMIT}-dbcache-$DBCACHE-$(date +%s).log\" \\\r\n    \"COMPILER=$CC DBCACHE=$DBCACHE ./build/bin/bitcoin-cli -datadir=$DATA_DIR -rpcclienttimeout=0 loadtxoutset $UTXO_SNAPSHOT_PATH\"; \\\r\ndone\r\n\r\n595504a432 Merge bitcoin/bitcoin#34236: Add sedited to trusted-keys\r\n63e822b637 validation: make `IsInitialBlockDownload()` lock-free\r\n\r\nassumeutxo load | 910000 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | xfs | SSD\r\n\r\nBenchmark 1: COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 595504a43209bead162da54a204df7d140a25f0e)\r\n  Time (mean ± σ):     418.452 s ±  0.461 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   418.070 s … 418.964 s    3 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 63e822b637f67242e3689adedc0155b34100e651)\r\n  Time (mean ± σ):     415.994 s ±  0.294 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   415.788 s … 416.330 s    3 runs\r\n \r\nRelative speed comparison\r\n        1.01 ±  0.00  COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 595504a43209bead162da54a204df7d140a25f0e)\r\n        1.00          COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 63e822b637f67242e3689adedc0155b34100e651)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>2026-01-12 | reindex-chainstate | 931139 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | SSD</summary>\r\n\r\n```\r\nfor DBCACHE in 4500; do \\                                                                                                                           \r\n  COMMITS=\"595504a43209bead162da54a204df7d140a25f0e 63e822b637f67242e3689adedc0155b34100e651\"; \\\r\n  STOP=931139; CC=gcc; CXX=g++; \\\r\n  BASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n  (echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done) && \\\r\n  (echo \"\" && echo \"$(date -I) | reindex-chainstate | ${STOP} blocks | dbcache ${DBCACHE} | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM | SSD\"; echo \"\") &&\\\r\n  hyperfine \\\r\n    --sort command \\\r\n    --runs 1 \\\r\n    --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$STOP-$DBCACHE-$CC.json\" \\\r\n    --parameter-list COMMIT ${COMMITS// /,} \\\r\n    --prepare \"killall -9 bitcoind 2>/dev/null; rm -f $DATA_DIR/debug.log; git clean -fxd; git reset --hard {COMMIT} && \\\r\n      cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -DENABLE_IPC=OFF && ninja -C build bitcoind -j1 && \\\r\n      ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=1000 -printtoconsole=0; sleep 20; rm -f $DATA_DIR/debug.log\" \\\r\n    --conclude \"killall bitcoind || true; sleep 5; grep -q 'height=0' $DATA_DIR/debug.log && grep -q 'Disabling script verification at block #1' $DATA_DIR/debug.log && grep -q 'height=$STOP' $DATA_DIR/debug.log; \\\r\n                cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n    \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=$DBCACHE -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0\";\r\ndone\r\n\r\n595504a432 Merge bitcoin/bitcoin#34236: Add sedited to trusted-keys\r\n63e822b637 validation: make `IsInitialBlockDownload()` lock-free\r\n\r\n2026-01-12 | reindex-chainstate | 931139 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | SSD\r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=931139 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 595504a43209bead162da54a204df7d140a25f0e)\r\n  Time (abs ≡):        17187.310 s               [User: 33104.415 s, System: 937.548 s]\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=931139 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 63e822b637f67242e3689adedc0155b34100e651)\r\n  Time (abs ≡):        17240.300 s               [User: 33164.803 s, System: 976.485 s]\r\n \r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=931139 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 595504a43209bead162da54a204df7d140a25f0e)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=931139 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 63e822b637f67242e3689adedc0155b34100e651)\r\n```\r\n\r\n</details>",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "created_at": "2026-01-11T15:15:32Z",
    "updated_at": "2026-01-29T09:59:28Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "3ed97d08a416efc4db9ee1cc2833ce9210128f20",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/cache-ibd-status",
      "ref": "l0rinc/cache-ibd-status",
      "sha": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 283230,
        "default_branch": "master",
        "open_issues_count": 40,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-29T09:54:20Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-28T13:37:57Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "abc6a3a4eb9814a7f17e40f7a4d330cbef86bff0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38809,
        "stargazers_count": 87804,
        "watchers_count": 87804,
        "size": 302636,
        "default_branch": "master",
        "open_issues_count": 744,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-29T09:51:01Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-29T09:51:10Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 94,
    "deletions": 40,
    "changed_files": 8,
    "commits": 4,
    "review_comments": 6,
    "comments": 2
  },
  "events": [
    {
      "event": "labeled",
      "id": 21971286181,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdlzil",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971286181",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:36Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 3734779791,
      "node_id": "IC_kwDOABII587enDeP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3734779791",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:15:40Z",
      "updated_at": "2026-01-29T09:59:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34253.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sedited](https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3682278935), [sipa](https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3713607402), [mzumsande](https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3721615463) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33854](https://github.com/bitcoin/bitcoin/pull/33854) (fix assumevalid is ignored during reindex by Eunovo)\n* [#31260](https://github.com/bitcoin/bitcoin/pull/31260) (scripted-diff: Type-safe settings retrieval by ryanofsky)\n* [#30342](https://github.com/bitcoin/bitcoin/pull/30342) (kernel, logging: Pass Logger instances to kernel objects by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (✨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- snapshot chainstate, giving it more cache space than the snapshot chainstate. -> snapshot chainstate, giving it more cache space than the non-snapshot chainstate. [The original repeats \"snapshot chainstate\" twice, making the comparison unclear; replacing the second occurrence clarifies the intended contrast.]\n\n\n\n<sup>2026-01-12</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#issuecomment-3734779791",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21971297094,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUdl2NG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971297094",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a4041df49d40871cf975769f55fa2c29b7ca657d",
      "created_at": "2026-01-11T15:16:28Z"
    },
    {
      "event": "labeled",
      "id": 21971305163,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUdl4LL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21971305163",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T15:17:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21972208162,
      "node_id": "UNLE_lADOABII587ilTpmzwAAAAUdpUoi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972208162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:30:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "ready_for_review",
      "id": 21972311851,
      "node_id": "RFRE_lADOABII587ilTpmzwAAAAUdpt8r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21972311851",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T16:37:55Z"
    },
    {
      "event": "unsubscribed",
      "id": 21975329271,
      "node_id": "UE_lADOABII587ilTpmzwAAAAUd1On3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21975329271",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-11T20:27:40Z"
    },
    {
      "event": "reviewed",
      "id": 3648563264,
      "node_id": "PRR_kwDOABII587ZeKhA",
      "url": null,
      "actor": null,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-11T22:02:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK (I didn't review the latest approach of #32885, just this one), it would help to be able to call `IsIBD()` without having to worry about `cs_main` locking.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3648563264",
      "submitted_at": "2026-01-11T22:01:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21985191970,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUea2gi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985191970",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "cac06c45a971355ab8655d3875b65f14b3febfe4",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/cac06c45a971355ab8655d3875b65f14b3febfe4",
      "created_at": "2026-01-12T10:00:50Z"
    },
    {
      "event": "commented",
      "id": 3737752862,
      "node_id": "IC_kwDOABII587eyZUe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3737752862",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:19Z",
      "updated_at": "2026-01-12T16:01:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks to @mzumsande for the hint to simplify this, added you as coauthor.\r\n\r\nThe new push makes `ChainstateManager::IsInitialBlockDownload()` lock-free by caching its result in a single atomic `m_cached_is_ibd` (inverted to match the method) and moving the exit checks into a new `ChainstateManager::UpdateIBDStatus()` (named it differently than you suggested, don't like maybes - it's called under `cs_main` after tip updates and after `ImportBlocks()` finishes).\r\nIBD exit criteria (enough work + recent tip) are encapsulated in a new `CChain::IsTipRecent()` helper, and a unit test covers the post-loading IBD exit/latching behavior (added early to show current behavior and changed throughout the PR to demonstrate the changes).\r\n\r\n\r\nEdit: pushed a [more comprehensive test](https://github.com/bitcoin/bitcoin/compare/63e822b637f67242e3689adedc0155b34100e651..557b41a38ccf2929ca1e5271db1701e5fbe781af) to check the whole matrix of conditions to be sure the behavior doesn't change.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#issuecomment-3737752862",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34253"
    },
    {
      "event": "mentioned",
      "id": 21985270695,
      "node_id": "MEE_lADOABII587ilTpmzwAAAAUebJun",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985270695",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:20Z"
    },
    {
      "event": "subscribed",
      "id": 21985270732,
      "node_id": "SE_lADOABII587ilTpmzwAAAAUebJvM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985270732",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:04:21Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21985432845,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUebxUN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985432845",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "63e822b637f67242e3689adedc0155b34100e651",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/63e822b637f67242e3689adedc0155b34100e651",
      "created_at": "2026-01-12T10:11:04Z"
    },
    {
      "event": "labeled",
      "id": 21985447943,
      "node_id": "LE_lADOABII587ilTpmzwAAAAUeb1AH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21985447943",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T10:11:44Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21987095570,
      "node_id": "UNLE_lADOABII587ilTpmzwAAAAUeiHQS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21987095570",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T11:27:34Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhiZTU0ZTNiMTk2NzdiMDJlMTlkMDU0YTRhNWIyZjE5NjhiYjFjNDY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8be54e3b19677b02e19d054a4a5b2f1968bb1c46",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8be54e3b19677b02e19d054a4a5b2f1968bb1c46",
      "tree": {
        "sha": "055bc4ff7c78e986d119d24a899cba013d472f11",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/055bc4ff7c78e986d119d24a899cba013d472f11"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 055bc4ff7c78e986d119d24a899cba013d472f11\nparent 595504a43209bead162da54a204df7d140a25f0e\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172275 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768232889 +0100\n\ntest: cover IBD exit conditions\n\nAdd a unit test that exercises the `IsInitialBlockDownload()` decision matrix by varying the cached latch, `BlockManager::LoadingBlocks()`, and tip work/recency inputs.\n\nThis documents the current latching behavior and provides a baseline for later refactors.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmllF7kACgkQZp//D/pH\nenYNPQ/9Eyc6F5c2Kz+q5xBQOC7m9/9NQ4QAX9fvwdKLgTGYHR+HcMU7XYEGBH6a\natPRe+Yc1a2lcsxhNI7I3zitEa/c/rOpsupLBFmjPStfrEqo+eS/b1YtP2N1xgIY\nKbzscSxKFhTM058M1+hLp0cb/CB48N88WXfbukJfWEu+lZfjTeZcWD7C9lY/I2iZ\nkdyU1cq1w9VbHKqKF1U9PbeZIRkT2YDDYLqVXV3u52m5UUxTU8TWy1V+XYwUGxOQ\nUDAM4PbXYkyY7Llj6KqCVzbv8heHydiJrz4Cnn0aloXaRZk7ufMiSdOIhbO3tvuY\nWgmIiST8AdDkSTXPpj7MzUr7Fb0a9qDSQJVdZMs+22AOoAqo6RvYxxAC2+T1Yi7s\n56Av3xTxtBw2N/4hw1oEJDMd7D9gv9+tmyFam3SZyBNIO1f/L7BIvk7FG83HYAm0\nziKRjsWl7oAw65vnFfM81JPkyxdvwDWqKSkXFJjN7l7l3Mbd2OLC0ony2OoDjouk\nl6xyHlnH0jQA9McOWcKfkeTM3MS0nL4Z1pZcIG4hNSJH2wLJzoxVaSJjca4LlMpz\nOZU6j18b0mBdz0nunv4m7aqnN8OJE3CUOiv0CSDar5GmgC/kdN86ntmPH1WrH9Pm\nSZDP1ptsHr3Wn3PVq0kNf5dA8a8kQ9clQp80+1MQKGrIMTCxCNY=\n=ED7U\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/595504a43209bead162da54a204df7d140a25f0e",
          "sha": "595504a43209bead162da54a204df7d140a25f0e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/595504a43209bead162da54a204df7d140a25f0e"
        }
      ],
      "message": "test: cover IBD exit conditions\n\nAdd a unit test that exercises the `IsInitialBlockDownload()` decision matrix by varying the cached latch, `BlockManager::LoadingBlocks()`, and tip work/recency inputs.\n\nThis documents the current latching behavior and provides a baseline for later refactors.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T15:48:09Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:57:55Z"
      },
      "sha": "8be54e3b19677b02e19d054a4a5b2f1968bb1c46"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhkNTMxYzYyMTBlYjA1YmM0MjRjOTcxZjYyMWJiMGI2ODhmZjcwZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8d531c6210eb05bc424c971f621bb0b688ff70e6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8d531c6210eb05bc424c971f621bb0b688ff70e6",
      "tree": {
        "sha": "983681d52d6d30ef3dd7bf3e06aae46525ad6f3c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/983681d52d6d30ef3dd7bf3e06aae46525ad6f3c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 983681d52d6d30ef3dd7bf3e06aae46525ad6f3c\nparent 8be54e3b19677b02e19d054a4a5b2f1968bb1c46\nauthor Lőrinc <pap.lorinc@gmail.com> 1768173184 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768233251 +0100\n\nvalidation: invert `m_cached_finished_ibd` to `m_cached_is_ibd`\n\nRename and invert the internal IBD latch so the cached value directly matches `IsInitialBlockDownload()` (true while in IBD, then latched to false).\n\nThis is a behavior-preserving refactor to avoid double negatives.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmllGSQACgkQZp//D/pH\nenaQOBAAs25x3U3xC9xhRXbIsCgjGVqZe0RTIJql3VWE1Abg0PBSZVUXDjzNBbLP\np9RO/5qzXGRq/42h4+DBbt/4CD/O6MOlV6SwVbm070IP/DrfYElXqZ7CsAiuSHzo\nI2PzWZDspsbodC8oZNF2TSABgm+rZoMfZjggLvsqabj0EleQ1aCcSQXncIqDmww/\n6TLYH2RrySDMOe7S79VDRQuxMJXk5IZMLOTRDCMRVgOm7s+5/cnrlMVy5QAFOjsd\nnew02Cjcg17Vb4G+WX5m9tCiIJanzlDT15Ks8BRNdyBEqNf7/tzTVWiN0RZHF/f/\nx/GW3wkqaeJ5cfcGH7ipCFUBT4XEUcMESW2d3NLj+3ewDs20m4nRBc0BGJfcS+d5\nLjLSyUWkNQSmalgk+d11T/C28XXyHAzc2ZuSqu9bDQdqUiV2rOjGVxfSIyi99kHn\nj/H4Dyev+vZTz2YLZN27impM5ndYW1BQuDoAN7lRrRu61xFK0QXU7+y5mNFf2a0O\nVbz3mDbzKr3vnjCsZWjqNwsVpvAO9kLS+yhI2a9bg9QEfdrLYqxh60RW1M/qehLO\nDztHaJ72VXWKc4ATua/mB9psZwqv0BHi16w6CY06tIRWCbRJqy0NpQZLV+WusJjm\ntuwR+p7iu3QtROvObj51KVMo73REzWxghzf2m2j2CbJ7abJOrQ0=\n=kNoz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8be54e3b19677b02e19d054a4a5b2f1968bb1c46",
          "sha": "8be54e3b19677b02e19d054a4a5b2f1968bb1c46",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8be54e3b19677b02e19d054a4a5b2f1968bb1c46"
        }
      ],
      "message": "validation: invert `m_cached_finished_ibd` to `m_cached_is_ibd`\n\nRename and invert the internal IBD latch so the cached value directly matches `IsInitialBlockDownload()` (true while in IBD, then latched to false).\n\nThis is a behavior-preserving refactor to avoid double negatives.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T15:54:11Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T23:13:04Z"
      },
      "sha": "8d531c6210eb05bc424c971f621bb0b688ff70e6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5YzBhYjNiNzVhMTlkN2ExZjdjMDE3NjIzNzRjZTg1ZjJkMGQ3YmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be",
      "tree": {
        "sha": "7c7448e85d5aa69fb7c106799e7c5968731ce90f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7c7448e85d5aa69fb7c106799e7c5968731ce90f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7c7448e85d5aa69fb7c106799e7c5968731ce90f\nparent 8d531c6210eb05bc424c971f621bb0b688ff70e6\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172181 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768233361 +0100\n\nchain: add `CChain::IsTipRecent` helper\n\nFactor the chain tip work/recency check out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper, and annotate it as requiring `cs_main` since it's reading mutable state.\n\nAlso introduce a local `chainman_ref` in the kernel import-blocks wrapper to reduce repetition and keep follow-up diffs small.\n\n`IsInitialBlockDownload` returns were also unified to make the followup move clean.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmllGZEACgkQZp//D/pH\nenbO9BAAzlj6O8t53Kxo+PEReFVNd5h8cPw+Mr9T2oQfDmaBfiuyUMYxPMnuIpwp\nCJjpoHSgN+8lQlzwA9cF2fOob9/BauO8wlgri1MmHW1vixMmdZmEGU9Yiqu6dnAX\n16nhmHsDHmDKrza24SMxV1+8w20t6Mk6FQ2v+8X2KZbgEP29LHCLdqhX1FercAex\nKBG1ebC1ddlSAKW65t8eEdINoMNjEPCNZSKIk6cMWNjGym2xrJ1FRz7oXWzpJrcS\n0nq7rUz37jfiWnb15YFor+qW3daMPAeKM/CMlWrC8lMjfLtI1rDLrpP2KQwZqH3d\nRh5lJuPkUBg6xfOmmnMcLtV/hnBWKKxQpUruQUmqv80Shu8vqYSRV6ApzNDlfk5r\n+4KkQ7azyot7EvbV6AABej9bhkO98ZeEGwTEsxBAa5Mn4YapTx+l0MZ8yT4wHSAG\nBSapK9gu/t4tdSbrAfC22zbYprDaqEYT59h1BD+lNi+q3f4aqHzASw5m41YWvwJB\nHFzNXfWMgAek/O0p6EuPVkK8NcraAHEgh/vrNXYiHZNSraadynl98QsBRTvAiDGb\nKM01W+FJsJmUPtMTPM86BfTQmk4EWasZnFTA+y0kZj1P0Ux+VSBezoSOGKEidofE\nJvbE+DhqU8sK+EnE0XsxkjgDKkNInXubCkLA9903seo1HJYjCvc=\n=Vvq5\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8d531c6210eb05bc424c971f621bb0b688ff70e6",
          "sha": "8d531c6210eb05bc424c971f621bb0b688ff70e6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8d531c6210eb05bc424c971f621bb0b688ff70e6"
        }
      ],
      "message": "chain: add `CChain::IsTipRecent` helper\n\nFactor the chain tip work/recency check out of `ChainstateManager::IsInitialBlockDownload()` into a reusable `CChain::IsTipRecent()` helper, and annotate it as requiring `cs_main` since it's reading mutable state.\n\nAlso introduce a local `chainman_ref` in the kernel import-blocks wrapper to reduce repetition and keep follow-up diffs small.\n\n`IsInitialBlockDownload` returns were also unified to make the followup move clean.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T15:56:01Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:56:21Z"
      },
      "sha": "b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU1N2I0MWEzOGNjZjI5MjljYTFlNTI3MWRiMTcwMWU1ZmJlNzgxYWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "tree": {
        "sha": "f439375a4e57cbdd778995c18bcef2b11a506fe8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f439375a4e57cbdd778995c18bcef2b11a506fe8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f439375a4e57cbdd778995c18bcef2b11a506fe8\nparent b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be\nauthor Lőrinc <pap.lorinc@gmail.com> 1768172233 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1768233440 +0100\n\nvalidation: make `IsInitialBlockDownload()` lock-free\n\n`ChainstateManager::IsInitialBlockDownload()` is queried on hot paths and previously acquired `cs_main` internally, contributing to lock contention.\n\nCache the IBD status in `m_cached_is_ibd`, and introduce `ChainstateManager::UpdateIBDStatus()` to latch it once block loading has finished and the current chain tip has enough work and is recent.\nCall the updater after tip updates and after `ImportBlocks()` completes.\n\nSince `IsInitialBlockDownload()` no longer updates the cache, drop `mutable` from `m_cached_is_ibd` and only update it from `UpdateIBDStatus()` under `cs_main`.\n\nUpdate the new unit test to showcase the new `UpdateIBDStatus()`.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmllGeAACgkQZp//D/pH\nena0Iw//TUFiIG+EgAzR2LV0PHuNKt4TYKxu5NrQncBu8KYE3P7eZfdBv6X8SyYk\ncc1LmS5jRN5VdtW6KUJi6wdYf7dlMYiRGxc+Vp9SUf8wsuQ88wmooRHfah5schas\nx3XNnqnFXwBbeU9StqRa3VyuVajQwdQv1FxOlES3z9/sfEX4MxbHG9yQeHkfdJKX\nVfvTp5fXwrkd5v2xaDUlmrJlPdmI9IBaDgaoQe66n4Yp9138bCH/2CdArq4AFFkk\nr1WchZ5AfDJEBnoWbzlYod7OvieTZDtWH9Ta3aJB1OFO6lnVUfEckvtQap3nQ1Js\nN7C38qSC7iWFpViz5ZbFw/bZpx3jbgEVb7DHD05HxfcF+FJB+UlTxLFmJEH2sHfG\nmpk2EY8INFMyzxf0/WYQxKL2u56ZNJkv+pe4LQrUoUvcWXk09/CWDEpQMZLwO5kU\nkjxUptaEXtMXvQ425EtEnDSntq33SBpgeppPVqdH1pqvRjkUOtnFJ2lw2lw8pXXe\n13mw+sRxEcLAlYj/SEfL8q4+yxyfaieMmbWzJdFWCKsZcdDpEaf2d4EGwidFl/FN\nvljeodV83l5E40J6Y1d29dUhQ81cois/9+luv+/hlZ0QguuVPTaniR1NsL2nQPD/\nbrLT8p6XOaSyFdCrbAKHuq1sEfTqIctrTGDl6vqVt6jo+3jF7cI=\n=SQdB\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be",
          "sha": "b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9c0ab3b75a19d7a1f7c01762374ce85f2d0d7be"
        }
      ],
      "message": "validation: make `IsInitialBlockDownload()` lock-free\n\n`ChainstateManager::IsInitialBlockDownload()` is queried on hot paths and previously acquired `cs_main` internally, contributing to lock contention.\n\nCache the IBD status in `m_cached_is_ibd`, and introduce `ChainstateManager::UpdateIBDStatus()` to latch it once block loading has finished and the current chain tip has enough work and is recent.\nCall the updater after tip updates and after `ImportBlocks()` completes.\n\nSince `IsInitialBlockDownload()` no longer updates the cache, drop `mutable` from `m_cached_is_ibd` and only update it from `UpdateIBDStatus()` under `cs_main`.\n\nUpdate the new unit test to showcase the new `UpdateIBDStatus()`.\n\nCo-authored-by: Patrick Strateman <patrick.strateman@gmail.com>\nCo-authored-by: Martin Zumsande <mzumsande@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-12T15:57:20Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-11T22:57:13Z"
      },
      "sha": "557b41a38ccf2929ca1e5271db1701e5fbe781af"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21993448708,
      "node_id": "HRFPE_lADOABII587ilTpmzwAAAAUe6WUE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21993448708",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "created_at": "2026-01-12T16:00:23Z"
    },
    {
      "event": "reviewed",
      "id": 3682278935,
      "node_id": "PRR_kwDOABII587bex4X",
      "url": null,
      "actor": null,
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-20T13:47:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3682278935",
      "submitted_at": "2026-01-20T13:47:17Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    },
    {
      "event": "review_requested",
      "id": 22162077359,
      "node_id": "RRE_lADOABII587ilTpmzwAAAAUo9nav",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22162077359",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T13:47:23Z",
      "requested_reviewer": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3713607402,
      "node_id": "PRR_kwDOABII587dWSbq",
      "url": null,
      "actor": null,
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-27T21:46:23Z",
      "author_association": "MEMBER",
      "body": "utACK 557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3713607402",
      "submitted_at": "2026-01-27T21:46:23Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    },
    {
      "event": "referenced",
      "id": 22365270793,
      "node_id": "REFE_lADOABII587ilTpmzwAAAAU1EvMJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22365270793",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "17f00550c831b4f45cddccfc851a653003d7c53f",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/17f00550c831b4f45cddccfc851a653003d7c53f",
      "created_at": "2026-01-29T03:59:55Z"
    },
    {
      "event": "referenced",
      "id": 22365270809,
      "node_id": "REFE_lADOABII587ilTpmzwAAAAU1EvMZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22365270809",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "1741f39fcb2e0cc2a8107737669bc73549269f35",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/1741f39fcb2e0cc2a8107737669bc73549269f35",
      "created_at": "2026-01-29T03:59:55Z"
    },
    {
      "event": "reviewed",
      "id": 3721615463,
      "node_id": "PRR_kwDOABII587d01hn",
      "url": null,
      "actor": null,
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-29T09:59:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code Review ACK 557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#pullrequestreview-3721615463",
      "submitted_at": "2026-01-29T09:59:24Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595",
      "pull_request_review_id": 3648563264,
      "id": 2680313595,
      "node_id": "PRRC_kwDOABII586fwlb7",
      "diff_hunk": "@@ -1038,6 +1038,9 @@ class ChainstateManager\n      */\n     mutable std::atomic_bool m_cached_finished_ibd{false};\n \n+    /** Latch that becomes true once the active tip has met IsTipRecent(). */\n+    mutable std::atomic_bool m_cached_tip_recent{false};",
      "path": "src/validation.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think having both `m_cached_tip_recent` and `m_cached_finished_ibd` may be more complicated than necessary. Probably the reason for it is that `IsIBD()` should latch to true also after `ImportBlocks()` without having to wait for a new block.\r\nWould it work to instead have just one atomic called `m_cached_finished_ibd` that is only set when `LoadingBlocks()` is false, ans set it in a function `ChainstateManager::MaybeExitIBD()`  that would be called both from `ChainstateManager::SetTip` (within the current approach, see also my other comment about that) and at the end of `ImportBlocks()` when `ImportingNow` went out of scope`?",
      "created_at": "2026-01-11T21:26:12Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680313595",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680313595"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280",
      "pull_request_review_id": 3648563264,
      "id": 2680342280,
      "node_id": "PRRC_kwDOABII586fwscI",
      "diff_hunk": "@@ -3004,7 +3004,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n         }\n     }\n \n-    m_chain.SetTip(*pindexDelete->pprev);\n+    m_chainman.SetTip(m_chain, *pindexDelete->pprev);",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "26dedf77e8e554cb04d8927835009455ec902068",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I find it a bit weird to have a function `SetTip` on the level of `ChainstateManager`, that would naturally live on a Chainstate/Chain level.\r\nI saw the justification of coupling the two close to make it harder to \"miss related state updates\", but I am not really convinced by it: It can still be easily forgotten by just using `Chain::SetTip` instead, like many tests  do, and there are only 3 affected call sites outside of tests.\r\nMaybe it would be simpler to not couple the two and call a separate function `ChainstateManager::MaybeExitIBD()` at the 3 call sites (`DisconnectTip`, `ConnectTip`, `LoadChainTip`) right after the `CChain::SetTip()` call.",
      "created_at": "2026-01-11T21:43:08Z",
      "updated_at": "2026-01-11T22:01:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2680342280",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2680342280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3007,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681584887",
      "pull_request_review_id": 3649986425,
      "id": 2681584887,
      "node_id": "PRRC_kwDOABII586f1bz3",
      "diff_hunk": "@@ -3004,7 +3004,7 @@ bool Chainstate::DisconnectTip(BlockValidationState& state, DisconnectedBlockTra\n         }\n     }\n \n-    m_chain.SetTip(*pindexDelete->pprev);\n+    m_chainman.SetTip(m_chain, *pindexDelete->pprev);",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "26dedf77e8e554cb04d8927835009455ec902068",
      "in_reply_to_id": 2680342280,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, thanks",
      "created_at": "2026-01-12T10:04:42Z",
      "updated_at": "2026-01-12T10:04:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2681584887",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681584887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3007,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681585359",
      "pull_request_review_id": 3649986960,
      "id": 2681585359,
      "node_id": "PRRC_kwDOABII586f1b7P",
      "diff_hunk": "@@ -1038,6 +1038,9 @@ class ChainstateManager\n      */\n     mutable std::atomic_bool m_cached_finished_ibd{false};\n \n+    /** Latch that becomes true once the active tip has met IsTipRecent(). */\n+    mutable std::atomic_bool m_cached_tip_recent{false};",
      "path": "src/validation.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "a4041df49d40871cf975769f55fa2c29b7ca657d",
      "original_commit_id": "a6d8b1074d35bf9ed1b69ed7de070da9da600dbd",
      "in_reply_to_id": 2680313595,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, thanks",
      "created_at": "2026-01-12T10:04:50Z",
      "updated_at": "2026-01-12T10:04:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2681585359",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2681585359"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2740747695",
      "pull_request_review_id": 3721615463,
      "id": 2740747695,
      "node_id": "PRRC_kwDOABII586jXH2v",
      "diff_hunk": "@@ -3331,6 +3325,15 @@ static SynchronizationState GetSynchronizationState(bool init, bool blockfiles_i\n     return SynchronizationState::INIT_DOWNLOAD;\n }\n \n+void ChainstateManager::UpdateIBDStatus()\n+{\n+    if (!m_cached_is_ibd.load(std::memory_order_relaxed)) return;",
      "path": "src/validation.cpp",
      "position": 52,
      "original_position": 52,
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "original_commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: could add `AssertLockHeld(cs_main)` as per common pattern",
      "created_at": "2026-01-29T09:36:19Z",
      "updated_at": "2026-01-29T09:59:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2740747695",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2740747695"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3330,
      "original_line": 3330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2740819490",
      "pull_request_review_id": 3721615463,
      "id": 2740819490,
      "node_id": "PRRC_kwDOABII586jXZYi",
      "diff_hunk": "@@ -1939,23 +1939,15 @@ void Chainstate::InitCoinsCache(size_t cache_size_bytes)\n     m_coins_views->InitCache();\n }\n \n-// Note that though this is marked const, we may end up modifying `m_cached_is_ibd`, which\n-// is a performance-related implementation detail. This function must be marked\n-// `const` so that `CValidationInterface` clients (which are given a `const Chainstate*`)\n-// can call it.\n+// This function must be marked `const` so that `CValidationInterface` clients\n+// (which are given a `const Chainstate*`) can call it.",
      "path": "src/validation.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "original_commit_id": "557b41a38ccf2929ca1e5271db1701e5fbe781af",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: This was the case already before this PR, but this comment is not correct (maybe it was once, didn't check the history). `CValidationInterface` clients such as `ActiveTipChange()` are not given a `const Chainstate*`, just a bool `is_ibd`.\r\nThe `const` just seems to be a nice-to-have, I removed it locally and is still compiled.",
      "created_at": "2026-01-29T09:52:45Z",
      "updated_at": "2026-01-29T09:59:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34253#discussion_r2740819490",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2740819490"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1943,
      "original_line": 1943,
      "side": "RIGHT"
    }
  ]
}
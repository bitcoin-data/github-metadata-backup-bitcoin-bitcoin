{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724",
    "id": 1571888838,
    "node_id": "PR_kwDOABII585dsR7G",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28724",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28724.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28724.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e975301dbfd7764486914c52f6d4e01fd4e32bf4",
    "number": 28724,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Cleanup accidental encryption keys in watchonly wallets",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "An earlier version allowed users to create watchonly wallets (wallets without private keys) that were \"encrypted\". Such wallets would have a stored encryption keys, but nothing would actually be encrypted with them. This can cause unexpected behavior such as https://github.com/bitcoin-core/gui/issues/772.\r\n\r\nWe can detect such wallets as they will have the disable private keys flag set, no encrypted keys, and encryption keys. For such wallets, we can remove those encryption keys thereby avoiding any issues that may result from this unexpected situation.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2023-10-24T23:02:08Z",
    "updated_at": "2024-09-04T03:06:20Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "e2afbcf0746641b111f93ca273928263e0537a78",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "achow101:cleanup-accidental-watchonly-mkeys",
      "ref": "cleanup-accidental-watchonly-mkeys",
      "sha": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 8,
        "stargazers_count": 36,
        "watchers_count": 36,
        "size": 281596,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-03T20:25:14Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2024-09-03T21:46:24Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "4373414d26ffd2cd004a59a095ce30b433059780",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35814,
        "stargazers_count": 77789,
        "watchers_count": 77789,
        "size": 267598,
        "default_branch": "master",
        "open_issues_count": 672,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-03T21:27:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-04T03:57:08Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 105,
    "deletions": 0,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 10,
    "comments": 2
  },
  "events": [
    {
      "event": "commented",
      "id": 1778189273,
      "node_id": "IC_kwDOABII585p_QPZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778189273",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T23:02:11Z",
      "updated_at": "2024-09-04T03:06:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28724).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1706334932), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707986305) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#issuecomment-1778189273",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724"
    },
    {
      "event": "labeled",
      "id": 10760181570,
      "node_id": "LE_lADOABII58501rDJzwAAAAKBW1dC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10760181570",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T23:02:14Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "labeled",
      "id": 10761693628,
      "node_id": "LE_lADOABII58501rDJzwAAAAKBcmm8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10761693628",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T03:23:54Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unsubscribed",
      "id": 10765699286,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4jW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765699286",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:51Z"
    },
    {
      "event": "unsubscribed",
      "id": 10765699464,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4mI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765699464",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:52Z"
    },
    {
      "event": "unsubscribed",
      "id": 10765700072,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4vo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765700072",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10768539018,
      "node_id": "HRFPE_lADOABII58501rDJzwAAAAKB2t2K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10768539018",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T14:39:16Z"
    },
    {
      "event": "unlabeled",
      "id": 10772551280,
      "node_id": "UNLE_lADOABII58501rDJzwAAAAKCGBZw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10772551280",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T21:32:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 10784402823,
      "node_id": "LE_lADOABII58501rDJzwAAAAKCzO2H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10784402823",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-26T20:14:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 10784515242,
      "node_id": "UNLE_lADOABII58501rDJzwAAAAKCzqSq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10784515242",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-26T20:27:37Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1706334932,
      "node_id": "PRR_kwDOABII585ltJrU",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1706334932",
      "submitted_at": "2023-10-31T13:40:49Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1707333703,
      "node_id": "PRR_kwDOABII585lw9hH",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707333703",
      "submitted_at": "2023-10-31T22:47:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1707986305,
      "node_id": "PRR_kwDOABII585lzc2B",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK aaa6b709d164052c8b2496cbedccf8ccf48c4aa2\r\n\r\nI left a few comments, but they're mainly thoughts I had and questions for my own understanding.\r\n\r\nAlso checked the test manually with `--legacy-wallet` and `--descriptors` and lightly inspected the dumps to ensure the records were being removed:\r\n\r\n<details>\r\n\r\n  <summary>log</summary>\r\n  \r\n  ```\r\n  $ test/functional/wallet_encryption.py\r\n2023-11-01T11:51:31.078000Z TestFramework (INFO): PRNG seed is: 196471712041506435\r\n2023-11-01T11:51:31.079000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_hm1fob6j\r\n2023-11-01T11:51:35.739000Z TestFramework (INFO): Check a timeout less than the limit\r\n2023-11-01T11:51:35.850000Z TestFramework (INFO): Check a timeout greater than the limit\r\n2023-11-01T11:51:36.579000Z TestFramework (INFO): Test that wallets without private keys cannot be encrypted\r\n2023-11-01T11:51:36.595000Z TestFramework (INFO): Test that encryption keys in wallets without privkeys are removed\r\n{'walletname': 'noprivs', 'walletversion': 169900, 'format': 'sqlite', 'balance': Decimal('0E-8'), 'unconfirmed_balance': Decimal('0E-8'), 'immature_balance': Decimal('0E-8'), 'txcount': 0, 'keypoolsize': 0, 'keypoolsize_hd_internal': 0, 'paytxfee': Decimal('0E-8'), 'private_keys_enabled': False, 'avoid_reuse': False, 'scanning': False, 'descriptors': True, 'external_signer': False, 'blank': False, 'lastprocessedblock': {'hash': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206', 'height': 0}}\r\norig_dump=['BITCOIN_CORE_WALLET_DUMP,1\\n', 'format,sqlite\\n', '0776657273696f6e,4c1e0400\\n', '0a6d696e76657273696f6e,ac970200\\n', '0962657374626c6f636b,8011010000\\n', '1262657374626c6f636b5f6e6f6d65726b6c65,801101000106226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f\\n', '05666c616773,0400000005000000\\n', 'checksum,058c1f6af6fcbbf22056c1f690d7b9fa27ec2a37dec2b0bcadca89977666634f\\n']\r\nafter_dump=['BITCOIN_CORE_WALLET_DUMP,1\\n', 'format,sqlite\\n', '0776657273696f6e,4c1e0400\\n', '0a6d696e76657273696f6e,ac970200\\n', '0962657374626c6f636b,8011010000\\n', '1262657374626c6f636b5f6e6f6d65726b6c65,801101000106226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f\\n', '05666c616773,0400000005000000\\n', '046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n', 'checksum,e63f7200466a4d2d6e05b505be87b148a96ae57702590f0fc284fbbeac332036\\n']\r\nResult of set(orig_dump) ^ set(after_dump):\r\n{'046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n', 'checksum,058c1f6af6fcbbf22056c1f690d7b9fa27ec2a37dec2b0bcadca89977666634f\\n', 'checksum,e63f7200466a4d2d6e05b505be87b148a96ae57702590f0fc284fbbeac332036\\n'}\r\n2023-11-01T11:51:37.068000Z TestFramework (INFO): Stopping nodes\r\n2023-11-01T11:51:37.223000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_hm1fob6j on exit\r\n2023-11-01T11:51:37.223000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\n</details>",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707986305",
      "submitted_at": "2023-11-01T11:57:54Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1709154451,
      "node_id": "PRR_kwDOABII585l36CT",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1709154451",
      "submitted_at": "2023-11-01T22:06:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1758695779,
      "node_id": "PRR_kwDOABII585o05Fj",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "As the process of reading wallet records from db disregards unknown record types, what if the encryption key is ever used for something else?. Wouldn't that mean that opening such wallet on any previous version (post this PR) would erase the encryption key forever?\r\n\r\nThe erase process can only verify the private keys disabled flag and whether there is any crypted key or not. But it cannot verify if the encryption key was used for something else.\r\n\r\nGuessing that in the case of adding a new type of encrypted record in the future for private keys disabled wallets, we would be forced to add downgrade protection if we merge this PR?",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1758695779",
      "submitted_at": "2023-11-30T23:44:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "commented",
      "id": 1874681373,
      "node_id": "IC_kwDOABII585vvV4d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1874681373",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-02T23:26:07Z",
      "updated_at": "2024-01-02T23:27:55Z",
      "author_association": "MEMBER",
      "body": "> Guessing that in the case of adding a new type of encrypted record in the future for private keys disabled wallets, we would be forced to add downgrade protection if we merge this PR?\r\n\r\nYes, but I think it's unlikely such usage of encryption keys would be added, and if it were, it could still be added in a way that does not interact with this PR.\r\n\r\nFor example,although #28142 allows for encryption of records regardless of the wallet flags, it does this at the database level and uses separate records, so this PR doesn't affect it at all.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#issuecomment-1874681373",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724"
    },
    {
      "event": "labeled",
      "id": 11505497836,
      "node_id": "LE_lADOABII58501rDJzwAAAAKtx_bs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11505497836",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-17T01:38:18Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 12294011182,
      "node_id": "LE_lADOABII58501rDJzwAAAALcx7ku",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12294011182",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T11:09:27Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZjZWYwYWExYTYyMTY4ZmVhMGVlNDAwMmMxNWVhZWM3YjJhYWRmOWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d",
      "tree": {
        "sha": "0587f663a8dcc30e479ff9e73819f1d1fd5687d2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0587f663a8dcc30e479ff9e73819f1d1fd5687d2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4373414d26ffd2cd004a59a095ce30b433059780",
          "sha": "4373414d26ffd2cd004a59a095ce30b433059780",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4373414d26ffd2cd004a59a095ce30b433059780"
        }
      ],
      "message": "wallet: Add HasCryptedKeys",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-03-29T16:40:16Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T21:44:46Z"
      },
      "sha": "6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY2ZmMzMTZhZjU2MmIyMTVlZDlmMmU1NTlkNGE1YTlhMWU2YmI0MzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6fc316af562b215ed9f2e559d4a5a9a1e6bb432",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f6fc316af562b215ed9f2e559d4a5a9a1e6bb432",
      "tree": {
        "sha": "d6993c698db1b6c00810b61db77395cceddab496",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d6993c698db1b6c00810b61db77395cceddab496"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d",
          "sha": "6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6cef0aa1a62168fea0ee4002c15eaec7b2aadf9d"
        }
      ],
      "message": "wallet: Remove unused encryption keys from watchonly wallets\n\nDue to a bug in earlier versions, some wallets without private keys may\nhave an encryption key. This encryption key is unused and can lead to\nconfusing behavior elsewhere. When such wallets are detected, those\nencryption keys will now be deleted from the wallet. For safety, we only\ndo this to wallets which have private keys disabled, have encryption keys,\nand definitely do not have encrypted keys.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-03-29T16:40:17Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T21:45:01Z"
      },
      "sha": "f6fc316af562b215ed9f2e559d4a5a9a1e6bb432"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU5NzUzMDFkYmZkNzc2NDQ4NjkxNGM1MmY2ZDRlMDFmZDRlMzJiZjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "tree": {
        "sha": "7f4842c6450c90c9eb33f03613e9be6aa257b185",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7f4842c6450c90c9eb33f03613e9be6aa257b185"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6fc316af562b215ed9f2e559d4a5a9a1e6bb432",
          "sha": "f6fc316af562b215ed9f2e559d4a5a9a1e6bb432",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f6fc316af562b215ed9f2e559d4a5a9a1e6bb432"
        }
      ],
      "message": "tests: Test cleanup of mkeys from wallets without privkeys",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2024-03-29T16:40:17Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T22:57:16Z"
      },
      "sha": "e975301dbfd7764486914c52f6d4e01fd4e32bf4"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12296712261,
      "node_id": "HRFPE_lADOABII58501rDJzwAAAALc8PBF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12296712261",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T16:51:27Z"
    },
    {
      "event": "unlabeled",
      "id": 12297026742,
      "node_id": "UNLE_lADOABII58501rDJzwAAAALc9by2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12297026742",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T17:30:15Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 12297206339,
      "node_id": "UNLE_lADOABII58501rDJzwAAAALc-HpD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12297206339",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T17:57:19Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378227825",
      "pull_request_review_id": 1707333703,
      "id": 1378227825,
      "node_id": "PRRC_kwDOABII585SJhZx",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": null,
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "why do we only have the first few digits here, I tried with `046d6b657901000000` and it worked fine\r\n\r\n`assert_equal(all([not line == \"046d6b657901000000\" for line in f]), True)`",
      "created_at": "2023-10-31T22:40:38Z",
      "updated_at": "2023-10-31T22:47:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378227825",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378227825"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378328199",
      "pull_request_review_id": 1707482250,
      "id": 1378328199,
      "node_id": "PRRC_kwDOABII585SJ56H",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This prefix matches all possible `mkey` records so it can make sure that there are no `mkey`s slipping in elsewhere.",
      "created_at": "2023-11-01T02:18:51Z",
      "updated_at": "2023-11-01T02:18:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378328199",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378328199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378657380",
      "pull_request_review_id": 1707986305,
      "id": 1378657380,
      "node_id": "PRRC_kwDOABII585SLKRk",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I notice that nothing in this block requires any locks (even though `cs_wallet` will be locked at this stage in this function).\r\n\r\nFor my own understanding, is this because the db operations, i.e. writing to the on-disk file, have their synchronisation handled by the db's transaction system?\r\n\r\nI see for example in `LoadEncryptionKey` that we lock `cs_wallet` to load the keys _into_ the wallet, which makes intuitive sense. But it feels that conversely there should be something asserting the lock is held here too, as we remove encryption keys from the wallet? Or at least when `pwallet->mapMasterKeys.clear();` is called.\r\n\r\nPerhaps it doesn't matter as it's done during loading from the db, so nothing else will have started to access the Wallet?",
      "created_at": "2023-11-01T11:02:48Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378657380",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378657380"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1243,
      "original_line": 1243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378673670",
      "pull_request_review_id": 1707986305,
      "id": 1378673670,
      "node_id": "PRRC_kwDOABII585SLOQG",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was wondering if if could be a good idea to log the removed keys at this point as a backup (safe-ish seeing as we are deleting), but I'm struggling to think of a scenario where a user with this type of wallet might somehow need these keys again...",
      "created_at": "2023-11-01T11:22:48Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378673670",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378673670"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378684726",
      "pull_request_review_id": 1707986305,
      "id": 1378684726,
      "node_id": "PRRC_kwDOABII585SLQ82",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps a comment to that effect would be useful here as it's not clear directly from the code?",
      "created_at": "2023-11-01T11:35:58Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378684726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378684726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379059681",
      "pull_request_review_id": 1708632982,
      "id": 1379059681,
      "node_id": "PRRC_kwDOABII585SMsfh",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1378657380,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The lock is already being held from the top of the function.",
      "created_at": "2023-11-01T16:54:59Z",
      "updated_at": "2023-11-01T16:55:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1379059681",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379059681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1243,
      "original_line": 1243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379378823",
      "pull_request_review_id": 1709154451,
      "id": 1379378823,
      "node_id": "PRRC_kwDOABII585SN6aH",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm still not sure about #28142 but, if we ever do something like that, we could have an encrypted wallet without encrypted private keys. So, might want to change the \"without private keys\" to \"without any encrypted record\".",
      "created_at": "2023-11-01T22:05:51Z",
      "updated_at": "2023-11-01T22:07:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1379378823",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379378823"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411216955",
      "pull_request_review_id": 1758376924,
      "id": 1411216955,
      "node_id": "PRRC_kwDOABII585UHXY7",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Will add a comment if I re-touch",
      "created_at": "2023-11-30T20:18:45Z",
      "updated_at": "2023-11-30T20:18:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411216955",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411216955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411217384",
      "pull_request_review_id": 1758377486,
      "id": 1411217384,
      "node_id": "PRRC_kwDOABII585UHXfo",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1378673670,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think it would be useful to log them.",
      "created_at": "2023-11-30T20:19:10Z",
      "updated_at": "2023-11-30T20:19:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411217384",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411217384"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411218639",
      "pull_request_review_id": 1758379433,
      "id": 1411218639,
      "node_id": "PRRC_kwDOABII585UHXzP",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "e975301dbfd7764486914c52f6d4e01fd4e32bf4",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1379378823,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is fine as is. It can be updated in the future if it becomes outdated.",
      "created_at": "2023-11-30T20:20:39Z",
      "updated_at": "2023-11-30T20:20:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411218639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411218639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724",
    "id": 1571888838,
    "node_id": "PR_kwDOABII585dsR7G",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28724",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28724.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28724.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
    "number": 28724,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Cleanup accidental encryption keys in watchonly wallets",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "An earlier version allowed users to create watchonly wallets (wallets without private keys) that were \"encrypted\". Such wallets would have a stored encryption keys, but nothing would actually be encrypted with them. This can cause unexpected behavior such as https://github.com/bitcoin-core/gui/issues/772.\r\n\r\nWe can detect such wallets as they will have the disable private keys flag set, no encrypted keys, and encryption keys. For such wallets, we can remove those encryption keys thereby avoiding any issues that may result from this unexpected situation.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2023-10-24T23:02:08Z",
    "updated_at": "2024-03-29T11:09:29Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "4d2d4b11db29b9c0c704721c9c6c4b57189830b6",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "achow101:cleanup-accidental-watchonly-mkeys",
      "ref": "cleanup-accidental-watchonly-mkeys",
      "sha": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 35,
        "watchers_count": 35,
        "size": 267858,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-03-26T18:52:20Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2024-01-13T23:12:15Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "64879f4c03b9d933898c0bb83d9b7e9c20729e51",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34942,
        "stargazers_count": 75110,
        "watchers_count": 75110,
        "size": 253916,
        "default_branch": "master",
        "open_issues_count": 718,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-03-29T11:41:12Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-03-29T11:42:16Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 105,
    "deletions": 0,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 10,
    "comments": 3
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQyYzdmY2I0ZjI4OWQ2YWE2MWMzYmI4NTRmZWJmNGZlYmMxZmQ3OGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/42c7fcb4f289d6aa61c3bb854febf4febc1fd78f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/42c7fcb4f289d6aa61c3bb854febf4febc1fd78f",
      "tree": {
        "sha": "ebccad0c7dcfed1171b463917f7cd285ff5a6f8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ebccad0c7dcfed1171b463917f7cd285ff5a6f8f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/43704827b4c9c178f3651a005e26c09103cd4189",
          "sha": "43704827b4c9c178f3651a005e26c09103cd4189",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/43704827b4c9c178f3651a005e26c09103cd4189"
        }
      ],
      "message": "wallet: Add HasCryptedKeys",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T22:12:55Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T21:44:46Z"
      },
      "sha": "42c7fcb4f289d6aa61c3bb854febf4febc1fd78f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRkYjliNjNmZGNiNWQzMmZhMWFkOThmMjYzYzlmNzdlZGYxYWY4YTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "tree": {
        "sha": "6adc7f3ce39c1cebf9a2bde5ae4922a729f2bef2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6adc7f3ce39c1cebf9a2bde5ae4922a729f2bef2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/42c7fcb4f289d6aa61c3bb854febf4febc1fd78f",
          "sha": "42c7fcb4f289d6aa61c3bb854febf4febc1fd78f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/42c7fcb4f289d6aa61c3bb854febf4febc1fd78f"
        }
      ],
      "message": "wallet: Remove unused encryption keys from watchonly wallets\n\nDue to a bug in earlier versions, some wallets without private keys may\nhave an encryption key. This encryption key is unused and can lead to\nconfusing behavior elsewhere. When such wallets are detected, those\nencryption keys will now be deleted from the wallet. For safety, we only\ndo this to wallets which have private keys disabled, have encryption keys,\nand definitely do not have encrypted keys.",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T22:12:55Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T21:45:01Z"
      },
      "sha": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4"
    },
    {
      "event": "commented",
      "id": 1778189273,
      "node_id": "IC_kwDOABII585p_QPZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1778189273",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T23:02:11Z",
      "updated_at": "2024-03-19T05:07:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28724).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1706334932), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707986305) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29136](https://github.com/bitcoin/bitcoin/pull/29136) (wallet: `addhdkey` RPC to add just keys to wallets via new `void(KEY)` descriptor by achow101)\n* [#29130](https://github.com/bitcoin/bitcoin/pull/29130) (wallet: Add `createwalletdescriptor` and `gethdkeys` RPCs for adding new automatically generated descriptors by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#issuecomment-1778189273",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724"
    },
    {
      "event": "labeled",
      "id": 10760181570,
      "node_id": "LE_lADOABII58501rDJzwAAAAKBW1dC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10760181570",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-24T23:02:14Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T02:28:40Z",
      "updated_at": "2023-10-25T02:28:40Z",
      "source": {
        "issue": {
          "id": 1958204865,
          "node_id": "PR_kwDOABII585dlfBo",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
          "number": 28710,
          "state": "open",
          "state_reason": null,
          "title": "Remove the legacy wallet and BDB dependency",
          "body": "The final step of #20160.\r\n\r\nA bare minimum of legacy wallet code is kept in order to perform wallet migration. Migration of legacy wallets uses the independent BDB parser and a minimal `LegacyDataSPKM` that allows the legacy data to be loaded so that the migration can be completed.\r\n\r\nAll tests which tested legacy wallet behavior have been removed. The `--descriptors` and `--legacy-wallet` options are removed from the functional tests.\r\n\r\nBDB has been removed as a dependency and documentation have been updated to reflect that.\r\n\r\nDepends on #26596",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28710",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28710.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28710.patch"
          },
          "created_at": "2023-10-23T23:36:07Z",
          "updated_at": "2024-03-18T16:26:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 10761693628,
      "node_id": "LE_lADOABII58501rDJzwAAAAKBcmm8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10761693628",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T03:23:54Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unsubscribed",
      "id": 10765699286,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4jW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765699286",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:51Z"
    },
    {
      "event": "unsubscribed",
      "id": 10765699464,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4mI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765699464",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:52Z"
    },
    {
      "event": "unsubscribed",
      "id": 10765700072,
      "node_id": "UE_lADOABII58501rDJzwAAAAKBr4vo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10765700072",
      "actor": {
        "login": "MarnixCroes",
        "id": 93143998,
        "node_id": "U_kgDOBY1Dvg",
        "avatar_url": "https://avatars.githubusercontent.com/u/93143998?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarnixCroes",
        "html_url": "https://github.com/MarnixCroes",
        "followers_url": "https://api.github.com/users/MarnixCroes/followers",
        "following_url": "https://api.github.com/users/MarnixCroes/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarnixCroes/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarnixCroes/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarnixCroes/subscriptions",
        "organizations_url": "https://api.github.com/users/MarnixCroes/orgs",
        "repos_url": "https://api.github.com/users/MarnixCroes/repos",
        "events_url": "https://api.github.com/users/MarnixCroes/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarnixCroes/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T11:00:57Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T14:26:58Z",
      "updated_at": "2023-10-25T14:26:58Z",
      "source": {
        "issue": {
          "id": 1960103071,
          "node_id": "PR_kwDOEEET9c5dr3Lk",
          "url": "https://api.github.com/repos/bitcoin-core/gui/issues/773",
          "repository_url": "https://api.github.com/repos/bitcoin-core/gui",
          "labels_url": "https://api.github.com/repos/bitcoin-core/gui/issues/773/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin-core/gui/issues/773/comments",
          "events_url": "https://api.github.com/repos/bitcoin-core/gui/issues/773/events",
          "html_url": "https://github.com/bitcoin-core/gui/pull/773",
          "number": 773,
          "state": "closed",
          "state_reason": null,
          "title": "Check for private keys disabled before attempting unlock",
          "body": "Before trying to unlock a wallet, first check if it has private keys disabled. If so, there is no need to unlock.\r\n\r\nNote that such wallets are not expected to occur in typical usage. However bugs in previous versions allowed such wallets to be created, and so we need to handle them.\r\n\r\nFixes #772\r\n\r\nFor some additional context, see #631",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 2927906211,
              "node_id": "MDU6TGFiZWwyOTI3OTA2MjEx",
              "url": "https://api.github.com/repos/bitcoin-core/gui/labels/Wallet",
              "name": "Wallet",
              "description": "",
              "color": "08a781",
              "default": false
            },
            {
              "id": 5353934559,
              "node_id": "LA_kwDOEEET9c8AAAABPx6O3w",
              "url": "https://api.github.com/repos/bitcoin-core/gui/labels/CI%20failed",
              "name": "CI failed",
              "color": "ededed",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin-core/gui/pulls/773",
            "html_url": "https://github.com/bitcoin-core/gui/pull/773",
            "diff_url": "https://github.com/bitcoin-core/gui/pull/773.diff",
            "patch_url": "https://github.com/bitcoin-core/gui/pull/773.patch"
          },
          "closed_at": "2024-02-12T18:18:43Z",
          "created_at": "2023-10-24T21:25:26Z",
          "updated_at": "2024-02-12T18:18:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFhYTZiNzA5ZDE2NDA1MmM4YjI0OTZjYmVkY2NmOGNjZjQ4YzRhYTI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "tree": {
        "sha": "50f28662d8a8af5894ba24b170dd9060b1ff64ba",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/50f28662d8a8af5894ba24b170dd9060b1ff64ba"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
          "sha": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4"
        }
      ],
      "message": "tests: Test cleanup of mkeys from wallets without privkeys",
      "committer": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-25T14:39:07Z"
      },
      "author": {
        "name": "Andrew Chow",
        "email": "github@achow101.com",
        "date": "2023-10-24T22:57:16Z"
      },
      "sha": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10768539018,
      "node_id": "HRFPE_lADOABII58501rDJzwAAAAKB2t2K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10768539018",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T14:39:16Z"
    },
    {
      "event": "unlabeled",
      "id": 10772551280,
      "node_id": "UNLE_lADOABII58501rDJzwAAAAKCGBZw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10772551280",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-25T21:32:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 10784402823,
      "node_id": "LE_lADOABII58501rDJzwAAAAKCzO2H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10784402823",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-26T20:14:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 10784515242,
      "node_id": "UNLE_lADOABII58501rDJzwAAAAKCzqSq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10784515242",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-26T20:27:37Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1706334932,
      "node_id": "PRR_kwDOABII585ltJrU",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1706334932",
      "submitted_at": "2023-10-31T13:40:49Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1707333703,
      "node_id": "PRR_kwDOABII585lw9hH",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707333703",
      "submitted_at": "2023-10-31T22:47:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1707986305,
      "node_id": "PRR_kwDOABII585lzc2B",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK aaa6b709d164052c8b2496cbedccf8ccf48c4aa2\r\n\r\nI left a few comments, but they're mainly thoughts I had and questions for my own understanding.\r\n\r\nAlso checked the test manually with `--legacy-wallet` and `--descriptors` and lightly inspected the dumps to ensure the records were being removed:\r\n\r\n<details>\r\n\r\n  <summary>log</summary>\r\n  \r\n  ```\r\n  $ test/functional/wallet_encryption.py\r\n2023-11-01T11:51:31.078000Z TestFramework (INFO): PRNG seed is: 196471712041506435\r\n2023-11-01T11:51:31.079000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_hm1fob6j\r\n2023-11-01T11:51:35.739000Z TestFramework (INFO): Check a timeout less than the limit\r\n2023-11-01T11:51:35.850000Z TestFramework (INFO): Check a timeout greater than the limit\r\n2023-11-01T11:51:36.579000Z TestFramework (INFO): Test that wallets without private keys cannot be encrypted\r\n2023-11-01T11:51:36.595000Z TestFramework (INFO): Test that encryption keys in wallets without privkeys are removed\r\n{'walletname': 'noprivs', 'walletversion': 169900, 'format': 'sqlite', 'balance': Decimal('0E-8'), 'unconfirmed_balance': Decimal('0E-8'), 'immature_balance': Decimal('0E-8'), 'txcount': 0, 'keypoolsize': 0, 'keypoolsize_hd_internal': 0, 'paytxfee': Decimal('0E-8'), 'private_keys_enabled': False, 'avoid_reuse': False, 'scanning': False, 'descriptors': True, 'external_signer': False, 'blank': False, 'lastprocessedblock': {'hash': '0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206', 'height': 0}}\r\norig_dump=['BITCOIN_CORE_WALLET_DUMP,1\\n', 'format,sqlite\\n', '0776657273696f6e,4c1e0400\\n', '0a6d696e76657273696f6e,ac970200\\n', '0962657374626c6f636b,8011010000\\n', '1262657374626c6f636b5f6e6f6d65726b6c65,801101000106226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f\\n', '05666c616773,0400000005000000\\n', 'checksum,058c1f6af6fcbbf22056c1f690d7b9fa27ec2a37dec2b0bcadca89977666634f\\n']\r\nafter_dump=['BITCOIN_CORE_WALLET_DUMP,1\\n', 'format,sqlite\\n', '0776657273696f6e,4c1e0400\\n', '0a6d696e76657273696f6e,ac970200\\n', '0962657374626c6f636b,8011010000\\n', '1262657374626c6f636b5f6e6f6d65726b6c65,801101000106226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f\\n', '05666c616773,0400000005000000\\n', '046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n', 'checksum,e63f7200466a4d2d6e05b505be87b148a96ae57702590f0fc284fbbeac332036\\n']\r\nResult of set(orig_dump) ^ set(after_dump):\r\n{'046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n', 'checksum,058c1f6af6fcbbf22056c1f690d7b9fa27ec2a37dec2b0bcadca89977666634f\\n', 'checksum,e63f7200466a4d2d6e05b505be87b148a96ae57702590f0fc284fbbeac332036\\n'}\r\n2023-11-01T11:51:37.068000Z TestFramework (INFO): Stopping nodes\r\n2023-11-01T11:51:37.223000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_hm1fob6j on exit\r\n2023-11-01T11:51:37.223000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\n</details>",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1707986305",
      "submitted_at": "2023-11-01T11:57:54Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1709154451,
      "node_id": "PRR_kwDOABII585l36CT",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1709154451",
      "submitted_at": "2023-11-01T22:06:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "reviewed",
      "id": 1758695779,
      "node_id": "PRR_kwDOABII585o05Fj",
      "url": null,
      "actor": null,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "As the process of reading wallet records from db disregards unknown record types, what if the encryption key is ever used for something else?. Wouldn't that mean that opening such wallet on any previous version (post this PR) would erase the encryption key forever?\r\n\r\nThe erase process can only verify the private keys disabled flag and whether there is any crypted key or not. But it cannot verify if the encryption key was used for something else.\r\n\r\nGuessing that in the case of adding a new type of encrypted record in the future for private keys disabled wallets, we would be forced to add downgrade protection if we merge this PR?",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#pullrequestreview-1758695779",
      "submitted_at": "2023-11-30T23:44:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-22T02:20:14Z",
      "updated_at": "2023-12-22T02:20:14Z",
      "source": {
        "issue": {
          "id": 1503703234,
          "node_id": "PR_kwDOABII585F0rVt",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26728/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26728",
          "number": 26728,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: Have the wallet store the key for automatically generated descriptors",
          "body": "The wallet currently does not know the master key that was used to generate the automatically generated descriptors. This makes it difficult to add new automatically generated descriptors when new ones are introduced. So instead of losing this information after the descriptors are created, have `CWallet` store it. The xpub will be stored in a new `activehdkey` field. The private key must be one of the keys that is used by the descriptors, and will be extracted upon loading.\r\n\r\nAs this is a new field, wallets will be automatically upgraded upon loading. This loading is backwards compatible and uses a new non-required flag `WALLET_FLAG_GLOBAL_HD_KEY` to signal that the upgrade completed. The upgrade will search for an xpub that is shared by `pkh()`, `wpkh()`, and `sh(wpkh()` descriptors with the derivation pattern that we use. For new wallets, the xpub will be set during descriptor creation rather than trying to reverse engineer it. The flag will be set for all wallets, regardless of whether such an xpub was found or can even exist, in order to indicate that the upgrade will not need to be run in the future.\r\n\r\nThis allows us to have a `gethdkey` command which is useful for those who need a simple way to get an xpub from a wallet. `gethdkey` can also take a boolean parameter to indicate whether it should also output the corresponding xprv.\r\n\r\nSupercedes #23417",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 65,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26728",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26728",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26728.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26728.patch"
          },
          "closed_at": "2024-01-06T00:05:58Z",
          "created_at": "2022-12-19T22:31:05Z",
          "updated_at": "2024-01-10T17:33:56Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-22T05:26:24Z",
      "updated_at": "2023-12-22T05:26:24Z",
      "source": {
        "issue": {
          "id": 2053192843,
          "node_id": "PR_kwDOABII585inOYp",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29130",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29130/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29130/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29130/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29130",
          "number": 29130,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: Add `createwalletdescriptor` and `gethdkeys` RPCs for adding new automatically generated descriptors",
          "body": "This PR adds a `createwalletdescriptor` RPC which allows users to add new automatically generated descriptors to their wallet, e.g. to upgrade a 0.21.x wallet to contain a taproot descriptor. This RPC takes 3 arguments: the output type to create a descriptor for, whether the descriptor will be internal or external, and the HD key to use if the user wishes to use a specific key. The HD key is an optional parameter. If it is not specified, the wallet will use the key shared by the active descriptors, if they are all single key. For most users in the expected upgrade scenario, this should be sufficient. In more advanced cases, the user must specify the HD key to use.\r\n\r\nCurrently, specified HD keys must already exist in the wallet. To make it easier for the user to know, `gethdkeys` is also added to list out the HD keys in use by all of the descriptors in the wallet. This will include all HD keys, whether we have the private key, for it, which descriptors use it and their activeness, and optionally the extended private key. In this way, users with more complex wallets will be still be able to get HD keys from their wallet for use in other scenarios, and if they want to use `createwalletdescriptor`, they can easily get the keys that they can specify to it.\r\n\r\nSee also https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1866961865",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29130",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29130",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29130.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29130.patch"
          },
          "closed_at": "2024-03-29T10:40:12Z",
          "created_at": "2023-12-22T00:05:47Z",
          "updated_at": "2024-03-29T10:46:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-23T02:47:51Z",
      "updated_at": "2023-12-23T02:47:51Z",
      "source": {
        "issue": {
          "id": 2054578166,
          "node_id": "PR_kwDOABII585ir-jz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29136",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29136/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29136/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29136/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29136",
          "number": 29136,
          "state": "open",
          "state_reason": null,
          "title": "wallet: `addhdkey` RPC to add just keys to wallets via new `void(KEY)` descriptor",
          "body": "It is sometimes useful for the wallet to have keys that it can sign with but are not (initially) involved in any scripts, e.g. for setting up a multisig. Ryanofsky [suggested](https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1867721948) A `void(KEY)` descriptor which allows for a key to be specified, but produces no scripts. These can be imported into the wallet, and subsequently retrieved with `gethdkeys`. Additionally, `listdescriptors` will output these descriptors so that they can be easily backed up.\r\n\r\nIn order to make it easier for people to add HD keys to their wallet, and to generate a new one if they want to rotate their descriptors, an `addhdkey` RPC is also added. Without arguments, it will generate a new HD key and add it to the wallet via a `void(KEY)` descriptor. If provided a private key, it will construct the descriptor and add it to the wallet.\r\n\r\nSee also: https://github.com/bitcoin/bitcoin/pull/26728#issuecomment-1866961865\r\n\r\nBased on #29130 as `gethdkeys` is useful for testing this.",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29136",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29136",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29136.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29136.patch"
          },
          "created_at": "2023-12-22T23:40:15Z",
          "updated_at": "2024-03-29T11:06:31Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1874681373,
      "node_id": "IC_kwDOABII585vvV4d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1874681373",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-02T23:26:07Z",
      "updated_at": "2024-01-02T23:27:55Z",
      "author_association": "MEMBER",
      "body": "> Guessing that in the case of adding a new type of encrypted record in the future for private keys disabled wallets, we would be forced to add downgrade protection if we merge this PR?\r\n\r\nYes, but I think it's unlikely such usage of encryption keys would be added, and if it were, it could still be added in a way that does not interact with this PR.\r\n\r\nFor example,although #28142 allows for encryption of records regardless of the wallet flags, it does this at the database level and uses separate records, so this PR doesn't affect it at all.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#issuecomment-1874681373",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724"
    },
    {
      "event": "labeled",
      "id": 11505497836,
      "node_id": "LE_lADOABII58501rDJzwAAAAKtx_bs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11505497836",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-17T01:38:18Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 12294011182,
      "node_id": "LE_lADOABII58501rDJzwAAAALcx7ku",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12294011182",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T11:09:27Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2027087700,
      "node_id": "IC_kwDOABII58540udU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2027087700",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-29T11:09:28Z",
      "updated_at": "2024-03-29T11:09:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nðŸ™ This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#issuecomment-2027087700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28724"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378227825",
      "pull_request_review_id": 1707333703,
      "id": 1378227825,
      "node_id": "PRRC_kwDOABII585SJhZx",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": null,
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "why do we only have the first few digits here, I tried with `046d6b657901000000` and it worked fine\r\n\r\n`assert_equal(all([not line == \"046d6b657901000000\" for line in f]), True)`",
      "created_at": "2023-10-31T22:40:38Z",
      "updated_at": "2023-10-31T22:47:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378227825",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378227825"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378328199",
      "pull_request_review_id": 1707482250,
      "id": 1378328199,
      "node_id": "PRRC_kwDOABII585SJ56H",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This prefix matches all possible `mkey` records so it can make sure that there are no `mkey`s slipping in elsewhere.",
      "created_at": "2023-11-01T02:18:51Z",
      "updated_at": "2023-11-01T02:18:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378328199",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378328199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378657380",
      "pull_request_review_id": 1707986305,
      "id": 1378657380,
      "node_id": "PRRC_kwDOABII585SLKRk",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I notice that nothing in this block requires any locks (even though `cs_wallet` will be locked at this stage in this function).\r\n\r\nFor my own understanding, is this because the db operations, i.e. writing to the on-disk file, have their synchronisation handled by the db's transaction system?\r\n\r\nI see for example in `LoadEncryptionKey` that we lock `cs_wallet` to load the keys _into_ the wallet, which makes intuitive sense. But it feels that conversely there should be something asserting the lock is held here too, as we remove encryption keys from the wallet? Or at least when `pwallet->mapMasterKeys.clear();` is called.\r\n\r\nPerhaps it doesn't matter as it's done during loading from the db, so nothing else will have started to access the Wallet?",
      "created_at": "2023-11-01T11:02:48Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378657380",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378657380"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1239,
      "original_line": 1239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378673670",
      "pull_request_review_id": 1707986305,
      "id": 1378673670,
      "node_id": "PRRC_kwDOABII585SLOQG",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was wondering if if could be a good idea to log the removed keys at this point as a backup (safe-ish seeing as we are deleting), but I'm struggling to think of a scenario where a user with this type of wallet might somehow need these keys again...",
      "created_at": "2023-11-01T11:22:48Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378673670",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378673670"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1240,
      "original_line": 1240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378684726",
      "pull_request_review_id": 1707986305,
      "id": 1378684726,
      "node_id": "PRRC_kwDOABII585SLQ82",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps a comment to that effect would be useful here as it's not clear directly from the code?",
      "created_at": "2023-11-01T11:35:58Z",
      "updated_at": "2023-11-01T11:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1378684726",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1378684726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379059681",
      "pull_request_review_id": 1708632982,
      "id": 1379059681,
      "node_id": "PRRC_kwDOABII585SMsfh",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {",
      "path": "src/wallet/walletdb.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1378657380,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The lock is already being held from the top of the function.",
      "created_at": "2023-11-01T16:54:59Z",
      "updated_at": "2023-11-01T16:55:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1379059681",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379059681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1239,
      "original_line": 1239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379378823",
      "pull_request_review_id": 1709154451,
      "id": 1379378823,
      "node_id": "PRRC_kwDOABII585SN6aH",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm still not sure about #28142 but, if we ever do something like that, we could have an encrypted wallet without encrypted private keys. So, might want to change the \"without private keys\" to \"without any encrypted record\".",
      "created_at": "2023-11-01T22:05:51Z",
      "updated_at": "2023-11-01T22:07:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1379378823",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1379378823"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1240,
      "original_line": 1240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411216955",
      "pull_request_review_id": 1758376924,
      "id": 1411216955,
      "node_id": "PRRC_kwDOABII585UHXY7",
      "diff_hunk": "@@ -100,6 +102,64 @@ def run_test(self):\n             sig = self.nodes[0].signmessage(address, msg)\n             assert self.nodes[0].verifymessage(address, sig, msg)\n \n+        self.log.info(\"Test that wallets without private keys cannot be encrypted\")\n+        self.nodes[0].createwallet(wallet_name=\"noprivs\", disable_private_keys=True)\n+        noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs\")\n+        assert_raises_rpc_error(-16, \"Error: wallet does not contain private keys, nothing to encrypt.\", noprivs_wallet.encryptwallet, \"pass\")\n+\n+        if self.is_wallet_tool_compiled():\n+            self.log.info(\"Test that encryption keys in wallets without privkeys are removed\")\n+\n+            def do_wallet_tool(*args):\n+                proc = subprocess.Popen(\n+                    [self.options.bitcoinwallet, f\"-datadir={self.nodes[0].datadir_path}\", f\"-chain={self.chain}\"] + list(args),\n+                    stdin=subprocess.PIPE,\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                    text=True\n+                )\n+                stdout, stderr = proc.communicate()\n+                assert_equal(proc.poll(), 0)\n+                assert_equal(stderr, \"\")\n+\n+            # Since it is no longer possible to encrypt a wallet without privkeys, we need to force one into the wallet\n+            # 1. Make a dump of the wallet\n+            # 2. Add mkey record to the dump\n+            # 3. Create a new wallet from the dump\n+\n+            # Make the dump\n+            noprivs_wallet.unloadwallet()\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs.dump\"\n+            do_wallet_tool(\"-wallet=noprivs\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+\n+            # Modify the dump\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                dump_content = f.readlines()\n+            # Drop the checksum line\n+            dump_content = dump_content[:-1]\n+            # Insert a valid mkey line. This corresponds to a passphrase of \"pass\".\n+            dump_content.append(\"046d6b657901000000,300dc926f3b3887aad3d5d5f5a0fc1b1a4a1722f9284bd5c6ff93b64a83902765953939c58fe144013c8b819f42cf698b208e9911e5f0c544fa300000000cc52050000\\n\")\n+            with open(dumpfile_path, \"w\", encoding=\"utf-8\") as f:\n+                contents = \"\".join(dump_content)\n+                f.write(contents)\n+                checksum = hash256(contents.encode())\n+                f.write(f\"checksum,{checksum.hex()}\\n\")\n+\n+            # Load the dump into a new wallet\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"createfromdump\")\n+            # Load the wallet and make sure it is no longer encrypted\n+            with self.nodes[0].assert_debug_log([\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\"]):\n+                self.nodes[0].loadwallet(\"noprivs_enc\")\n+            noprivs_wallet = self.nodes[0].get_wallet_rpc(\"noprivs_enc\")\n+            assert_raises_rpc_error(-15, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\", noprivs_wallet.walletpassphrase, \"pass\", 1)\n+            noprivs_wallet.unloadwallet()\n+\n+            # Make a new dump and check that there are no mkeys\n+            dumpfile_path = self.nodes[0].datadir_path / \"noprivs_enc.dump\"\n+            do_wallet_tool(\"-wallet=noprivs_enc\", f\"-dumpfile={dumpfile_path}\", \"dump\")\n+            with open(dumpfile_path, \"r\", encoding=\"utf-8\") as f:\n+                assert_equal(all([not line.startswith(\"046d6b6579\") for line in f]), True)",
      "path": "test/functional/wallet_encryption.py",
      "position": 70,
      "original_position": 70,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "in_reply_to_id": 1378227825,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Will add a comment if I re-touch",
      "created_at": "2023-11-30T20:18:45Z",
      "updated_at": "2023-11-30T20:18:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411216955",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411216955"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 161,
      "original_line": 161,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411217384",
      "pull_request_review_id": 1758377486,
      "id": 1411217384,
      "node_id": "PRRC_kwDOABII585UHXfo",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1378673670,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think it would be useful to log them.",
      "created_at": "2023-11-30T20:19:10Z",
      "updated_at": "2023-11-30T20:19:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411217384",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411217384"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1240,
      "original_line": 1240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411218639",
      "pull_request_review_id": 1758379433,
      "id": 1411218639,
      "node_id": "PRRC_kwDOABII585UHXzP",
      "diff_hunk": "@@ -1227,6 +1232,21 @@ DBErrors WalletBatch::LoadWallet(CWallet* pwallet)\n         result = DBErrors::CORRUPT;\n     }\n \n+    // Since it was accidentally possible to \"encrypt\" a wallet with private keys disabled, we should check if this is\n+    // such a wallet and remove the encryption key records to avoid any future issues.\n+    // Although wallets without private keys should not have *ckey records, we should double check that.\n+    // Removing the mkey records is only safe if there are no *ckey records.\n+    if (pwallet->IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) && pwallet->HasEncryptionKeys() && !pwallet->HaveCryptedKeys()) {\n+        pwallet->WalletLogPrintf(\"Detected extraneous encryption keys in this wallet without private keys. Removing extraneous encryption keys.\\n\");",
      "path": "src/wallet/walletdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "aaa6b709d164052c8b2496cbedccf8ccf48c4aa2",
      "original_commit_id": "4db9b63fdcb5d32fa1ad98f263c9f77edf1af8a4",
      "in_reply_to_id": 1379378823,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is fine as is. It can be updated in the future if it becomes outdated.",
      "created_at": "2023-11-30T20:20:39Z",
      "updated_at": "2023-11-30T20:20:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28724#discussion_r1411218639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1411218639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28724"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1240,
      "original_line": 1240,
      "side": "RIGHT"
    }
  ]
}
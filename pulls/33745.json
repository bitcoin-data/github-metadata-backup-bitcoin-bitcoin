{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745",
    "id": 2962918038,
    "node_id": "PR_kwDOABII586wmoqW",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33745",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33745.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33745.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
    "number": 33745,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "mining: check witness commitment in submitBlock",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "When an IPC client requests a new block template via the Mining interface, we hold on to its `CBlock`. That way when they call `submitSolution()` we can modify it in place, rather than having to reconstruct the full block like the `submitblock` RPC does.\r\n\r\nBefore this commit however we forgot to invalidate `m_checked_witness_commitment`, which we should since the client brings a new coinbase.\r\n\r\nThis would cause us to accept an invalid chaintip.\r\n\r\nFix this and add a test to confirm that we now reject such a block. As a sanity check, we add a second node to the test and confirm that will accept our mined block.\r\n\r\nAs first noticed in #33374 the IPC code takes the coinbase as provided, unlike the `submitblock` RPC which calls `UpdateUncommittedBlockStructures()` and adds witness commitment to the coinbase if it was missing.\r\n\r\nAlthough that could have been an alternative fix, we instead document that IPC clients are expected to provide the full coinbase including witness commitment.\r\n",
    "labels": [
      {
        "id": 118378960,
        "node_id": "MDU6TGFiZWwxMTgzNzg5NjA=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mining",
        "name": "Mining",
        "color": "c7def8",
        "default": false
      }
    ],
    "created_at": "2025-10-30T12:02:55Z",
    "updated_at": "2025-10-30T21:40:08Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "5e394a40e072eb4a6d87a2f0f1b3c45c66fff576",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "Sjors:2025/10/submit-solution-doc",
      "ref": "2025/10/submit-solution-doc",
      "sha": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 92390696,
        "node_id": "MDEwOlJlcG9zaXRvcnk5MjM5MDY5Ng==",
        "name": "bitcoin",
        "full_name": "Sjors/bitcoin",
        "owner": {
          "login": "Sjors",
          "id": 10217,
          "node_id": "MDQ6VXNlcjEwMjE3",
          "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/Sjors",
          "html_url": "https://github.com/Sjors",
          "followers_url": "https://api.github.com/users/Sjors/followers",
          "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
          "organizations_url": "https://api.github.com/users/Sjors/orgs",
          "repos_url": "https://api.github.com/users/Sjors/repos",
          "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/Sjors/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/Sjors/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/Sjors/bitcoin",
        "archive_url": "https://api.github.com/repos/Sjors/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/Sjors/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/Sjors/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/Sjors/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/Sjors/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/Sjors/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/Sjors/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/Sjors/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/Sjors/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/Sjors/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/Sjors/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/Sjors/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/Sjors/bitcoin/events",
        "forks_url": "https://api.github.com/repos/Sjors/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/Sjors/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/Sjors/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/Sjors/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/Sjors/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/Sjors/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/Sjors/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/Sjors/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/Sjors/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/Sjors/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/Sjors/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/Sjors/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/Sjors/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/Sjors/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/Sjors/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/Sjors/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:Sjors/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/Sjors/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/Sjors/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/Sjors/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/Sjors/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/Sjors/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/Sjors/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/Sjors/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/Sjors/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/Sjors/bitcoin/hooks",
        "svn_url": "https://github.com/Sjors/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 15,
        "watchers_count": 15,
        "size": 276565,
        "default_branch": "2025/06/musig2-power",
        "open_issues_count": 5,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": false,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-30T14:54:29Z",
        "created_at": "2017-05-25T10:05:54Z",
        "updated_at": "2025-10-13T11:50:20Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "72511fd02e72b74be11273e97bd7911786a82e54",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38132,
        "stargazers_count": 86530,
        "watchers_count": 86530,
        "size": 295434,
        "default_branch": "master",
        "open_issues_count": 731,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-30T16:36:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-30T21:48:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 47,
    "deletions": 6,
    "changed_files": 4,
    "commits": 2,
    "review_comments": 14,
    "comments": 4
  },
  "events": [
    {
      "event": "labeled",
      "id": 20607345430,
      "node_id": "LE_lADOABII587U0PtezwAAAATMSyMW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20607345430",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T12:02:59Z",
      "label": {
        "name": "Mining",
        "color": "c7def8"
      }
    },
    {
      "event": "commented",
      "id": 3467666654,
      "node_id": "IC_kwDOABII587OsGTe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3467666654",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T12:03:01Z",
      "updated_at": "2025-10-30T12:03:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33745.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3467666654",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745"
    },
    {
      "event": "reviewed",
      "id": 3399316388,
      "node_id": "PRR_kwDOABII587KnXOk",
      "url": null,
      "actor": null,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-30T12:15:48Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3399316388",
      "submitted_at": "2025-10-30T12:15:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
    },
    {
      "event": "reviewed",
      "id": 3399416295,
      "node_id": "PRR_kwDOABII587Knvnn",
      "url": null,
      "actor": null,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-30T12:47:40Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3399416295",
      "submitted_at": "2025-10-30T12:47:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
    },
    {
      "event": "reviewed",
      "id": 3399448986,
      "node_id": "PRR_kwDOABII587Kn3ma",
      "url": null,
      "actor": null,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-30T13:34:39Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3399448986",
      "submitted_at": "2025-10-30T13:34:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
    },
    {
      "event": "commented",
      "id": 3468059025,
      "node_id": "IC_kwDOABII587OtmGR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3468059025",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T13:38:26Z",
      "updated_at": "2025-10-30T13:38:26Z",
      "author_association": "MEMBER",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/18939943748/job/54075967306?pr=33745#step:9:2351:\r\n```bash\r\n\r\ntest/miner_tests.cpp(70): Entering test suite \"miner_tests\"\r\ntest/miner_tests.cpp(686): Entering test case \"CreateNewBlock_validity\"\r\n<snip>\r\n 2025-10-30T12:08:21.221330Z [test] [validationinterface.cpp:218] [void ValidationSignals::BlockConnected(ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *)] [validation] Enqueuing BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-10-30T12:08:21.221451Z [scheduler] [validationinterface.cpp:218] [auto ValidationSignals::BlockConnected(ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *)::(anonymous class)::operator()() const] [validation] BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60node/miner.cpp:187 CreateNewBlock: Assertion `pblock->m_checked_witness_commitment' failed.\r\n```",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3468059025",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20609772897,
      "node_id": "HRFPE_lADOABII587U0PtezwAAAATMcC1h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20609772897",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "43b92a2727ef99a9bfd41c6e3467d04c868fba2f",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/43b92a2727ef99a9bfd41c6e3467d04c868fba2f",
      "created_at": "2025-10-30T13:44:55Z"
    },
    {
      "event": "commented",
      "id": 3468101541,
      "node_id": "IC_kwDOABII587Otwel",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3468101541",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T13:45:45Z",
      "updated_at": "2025-10-30T13:45:45Z",
      "author_association": "MEMBER",
      "body": "@TheCharlatan wrote:\r\n\r\n> What about the other checked flags? Should we just reset all of them in `AddMerkleRootAndCoinbase`?\r\n\r\nDone and pushed, but still checking the CI failure.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3468101541",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745"
    },
    {
      "event": "mentioned",
      "id": 20609796828,
      "node_id": "MEE_lADOABII587U0PtezwAAAATMcIrc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20609796828",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T13:45:47Z"
    },
    {
      "event": "subscribed",
      "id": 20609796874,
      "node_id": "SE_lADOABII587U0PtezwAAAATMcIsK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20609796874",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T13:45:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20609821071,
      "node_id": "HRFPE_lADOABII587U0PtezwAAAATMcOmP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20609821071",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/fcb8b982f159f68edc128a835026059210b57ff7",
      "created_at": "2025-10-30T13:46:43Z"
    },
    {
      "event": "commented",
      "id": 3468117727,
      "node_id": "IC_kwDOABII587Ot0bf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3468117727",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T13:48:45Z",
      "updated_at": "2025-10-30T13:48:45Z",
      "author_association": "MEMBER",
      "body": "I dropped `Assume(pblock->m_checked_witness_commitment);` from `miner.cpp`, since the assumptions seems to be wrong.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3468117727",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33745"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUwNGFjZmNkNWQxZWQ0ZDc3ZjdmZDRmNWRjNTdlNjZkNjcxOGQzZDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
      "tree": {
        "sha": "9d1695779c3e9d4fd07b8e353c2c342e4f79ae72",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9d1695779c3e9d4fd07b8e353c2c342e4f79ae72"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9d1695779c3e9d4fd07b8e353c2c342e4f79ae72\nparent 72511fd02e72b74be11273e97bd7911786a82e54\nauthor Sjors Provoost <sjors@sprovoost.nl> 1761832036 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1761835817 +0100\n\nmining: ensure witness commitment check in submitBlock\n\nWhen an IPC client requests a new block template via the Mining interface,\nwe hold on to its CBlock. That way when they call submitSolution() we can\nmodify it in place, rather than having to reconstruct the full block like\nthe submitblock RPC does.\n\nBefore this commit however we forgot to invalidate\nm_checked_witness_commitment, which we should since the client brings a\nnew coinbase.\n\nThis would cause us to accept an invalid chaintip.\n\nFix this and add a test to confirm that we now reject such a block.\nAs a sanity check, we add a second node to the test and confirm that will\naccept our mined block.\n\nNote that the IPC code takes the coinbase as provided, unlike the\nsubmitblock RPC which calls UpdateUncommittedBlockStructures() and adds\nwitness commitment to the coinbase if it was missing.\n\nAlthough that could have been an alternative fix, we instead document that\nIPC clients are expected to provide the full coinbase including witness\ncommitment.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmkDeykACgkQV/+b28ww\nEAkyXw/5AddpHqANEw1r+SowrvO6OA+6+VQadgXnd4Adj6OnZ4pgVEfINIOj+w/S\nq9gBsP7QthqAA3nVR4uRC3hKRyI8cf2g8JRMTekfbOoqw+5i6kmz5cGJ5lYI2GKq\n5rjyHJNHJOlxpyc5u1kcZyrKbISy14PpdozEkm4oSeQ5aXJDbskhkiXaSxIV+3ds\nx8AaMcCBHiQiGrIFq3Bcjey++1zqJz9ekx3Dihc8EvpOcKgx/SQxpO6Yc/hXt+/2\n2QKRMfYUbTuCqwMOxfnsM3j4PoNyDNQ6QX43rOnbKaEAMgww/oKfgwcVfPtHiiXc\n2E2FMgrlq+r3SYgKAB8ScrWCN782IF6s+YdS4pFoU68QNne0voQ0er2TBUxnj66f\niSHzGKOEkpi5M7ICoZYRf4KqXUOY9esX81mlQk3hRIgvXISKTlUSThdAof66sVZe\n9yiMfQAL85WWJDQ6mC3QtzwqcCFN5vrBw3G87eMNHCtteMBHCCt/jKN13lxq9fq2\n+ge5mFgtsU94JG/MGxvPk0XMBqk3v23stYxUilFXc3UOSGOR1jOrn/SSHgiHgcCr\n2n9HAodoM5pDmLTRt6UShZPU2jfGmv8rfvKb+7NAwFlvvAimv4hudVeew7pHi7N7\n8gknI55NkFYXl47znDO/OJWMZjjiRuqpli5dWst9T73EKy99xfI=\n=MBJJ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/72511fd02e72b74be11273e97bd7911786a82e54",
          "sha": "72511fd02e72b74be11273e97bd7911786a82e54",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/72511fd02e72b74be11273e97bd7911786a82e54"
        }
      ],
      "message": "mining: ensure witness commitment check in submitBlock\n\nWhen an IPC client requests a new block template via the Mining interface,\nwe hold on to its CBlock. That way when they call submitSolution() we can\nmodify it in place, rather than having to reconstruct the full block like\nthe submitblock RPC does.\n\nBefore this commit however we forgot to invalidate\nm_checked_witness_commitment, which we should since the client brings a\nnew coinbase.\n\nThis would cause us to accept an invalid chaintip.\n\nFix this and add a test to confirm that we now reject such a block.\nAs a sanity check, we add a second node to the test and confirm that will\naccept our mined block.\n\nNote that the IPC code takes the coinbase as provided, unlike the\nsubmitblock RPC which calls UpdateUncommittedBlockStructures() and adds\nwitness commitment to the coinbase if it was missing.\n\nAlthough that could have been an alternative fix, we instead document that\nIPC clients are expected to provide the full coinbase including witness\ncommitment.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2025-10-30T14:50:17Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2025-10-30T13:47:16Z"
      },
      "sha": "504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdkNTdjNGU0NDQ1MWNlMTE2N2JhNzZhNzNjOWNjNmY2ZmQ2Y2ZjYTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "tree": {
        "sha": "881ed75a9ab172962a5e2cfdab879f636986f998",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/881ed75a9ab172962a5e2cfdab879f636986f998"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 881ed75a9ab172962a5e2cfdab879f636986f998\nparent 504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4\nauthor Sjors Provoost <sjors@sprovoost.nl> 1761835629 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1761835817 +0100\n\ndoc: clarify UpdateUncommittedBlockStructures\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmkDeykACgkQV/+b28ww\nEAlsJxAAgUcxbybi5j/F8uAh3N1BujBiOaEOiftfJ6f8KdMN4InaS2+1iPnvbnbx\nLFgBqx4ZAddO7m7lVJaiMd599bPJrpBL95vDHIbj75GHiX/FJ1HQv9RCvJZx3BgE\n0gvKvb2XNEX5p+yEv+pLu7GzkH0HEwMJ9HnGykTXDfXKM8NqlLMjXxAovgnBnubW\nGf+dA3UHE/B+gJliRYWGhTl2RMB9wKYNVBvyNEmDMY1KTkC77yWfhAPCgsHADFfy\niBIOieOH7lDgvcLq4FG04VqiyICSy1q0kAAizwjnby9Vr1RHQ4UCfTixrlY4I50i\n214PQjC3YES+cSP1R7/IAXlw7IKcddEhALDbT9X6WBl5A9+oFxhO/vfIwV2YoJ/U\nzZMoEH5NfbJfhQgpyqVWY5N+AA/zCkSX0uocCvk8+ABeMiMcfNtNzXn6yWyCimrG\nig4C+059diVhlr6kp/6o/kYqIHHF8QryPr+qd/kewattCkXxbasMQ0XNGbxntBD6\ngX4ZkunzGZ7mLIubq2mhKafgO7uCv0yYYfak77gT1H+8NUdva1fbMN6NR2CgftLx\n9Y3aEySqOWZip889w/YScjXCqwSY6C/0gV6qYTAlewX23YY05AM/gx4BrG2ZxoH+\nVv4HBEzxgMwmwCmmj/tS3K7GRmLdw1In88Uz1Xz9CIb6siThp3M=\n=5XA3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
          "sha": "504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4"
        }
      ],
      "message": "doc: clarify UpdateUncommittedBlockStructures",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2025-10-30T14:50:17Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2025-10-30T14:47:09Z"
      },
      "sha": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20611759678,
      "node_id": "HRFPE_lADOABII587U0PtezwAAAATMjn4-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20611759678",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "created_at": "2025-10-30T14:54:30Z"
    },
    {
      "event": "reviewed",
      "id": 3401753833,
      "node_id": "PRR_kwDOABII587KwqTp",
      "url": null,
      "actor": null,
      "commit_id": "504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-30T21:33:55Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3401753833",
      "submitted_at": "2025-10-30T21:33:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477883143",
      "pull_request_review_id": 3399316388,
      "id": 2477883143,
      "node_id": "PRRC_kwDOABII586TsX8H",
      "diff_hunk": "@@ -912,7 +912,15 @@ class BlockTemplateImpl : public BlockTemplate\n \n     bool submitSolution(uint32_t version, uint32_t timestamp, uint32_t nonce, CTransactionRef coinbase) override\n     {\n-        AddMerkleRootAndCoinbase(m_block_template->block, std::move(coinbase), version, timestamp, nonce);\n+        CBlock& block{m_block_template->block};\n+        AddMerkleRootAndCoinbase(block, std::move(coinbase), version, timestamp, nonce);\n+\n+        // We modified the coinbase which should invalidate the check we did\n+        // when the block template was constructed. Additionally, unlike the\n+        // submitblock RPC we don't adjust the provided coinbase.\n+        block.m_checked_witness_commitment = false;",
      "path": "src/node/interfaces.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What about the other checked flags? Should we just reset all of them in `AddMerkleRootAndCoinbase`?",
      "created_at": "2025-10-30T12:15:48Z",
      "updated_at": "2025-10-30T12:15:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477883143",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477883143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 921,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477956663",
      "pull_request_review_id": 3399416295,
      "id": 2477956663,
      "node_id": "PRRC_kwDOABII586Tsp43",
      "diff_hunk": "@@ -912,7 +912,15 @@ class BlockTemplateImpl : public BlockTemplate\n \n     bool submitSolution(uint32_t version, uint32_t timestamp, uint32_t nonce, CTransactionRef coinbase) override\n     {\n-        AddMerkleRootAndCoinbase(m_block_template->block, std::move(coinbase), version, timestamp, nonce);\n+        CBlock& block{m_block_template->block};\n+        AddMerkleRootAndCoinbase(block, std::move(coinbase), version, timestamp, nonce);\n+\n+        // We modified the coinbase which should invalidate the check we did\n+        // when the block template was constructed. Additionally, unlike the\n+        // submitblock RPC we don't adjust the provided coinbase.\n+        block.m_checked_witness_commitment = false;\n+        Assume(!block.fChecked);\n+\n         return chainman().ProcessNewBlock(std::make_shared<const CBlock>(m_block_template->block), /*force_processing=*/true, /*min_pow_checked=*/true, /*new_block=*/nullptr);",
      "path": "src/node/interfaces.cpp",
      "position": 1,
      "original_position": 14,
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"mining: check witness commitment in submitBlock\" (68fc907de93f422fd5566f9066bf16b1239e3a1b)\r\n\r\nIf keeping changes in this function instead of making the fix in AddMerkleRootAndCoinbase, would be good to s/m_block_template->block/block on this line to be consistent",
      "created_at": "2025-10-30T12:43:14Z",
      "updated_at": "2025-10-30T12:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477956663",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477956663"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 916,
      "original_line": 916,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477966256",
      "pull_request_review_id": 3399416295,
      "id": 2477966256,
      "node_id": "PRRC_kwDOABII586TssOw",
      "diff_hunk": "@@ -912,7 +912,15 @@ class BlockTemplateImpl : public BlockTemplate\n \n     bool submitSolution(uint32_t version, uint32_t timestamp, uint32_t nonce, CTransactionRef coinbase) override\n     {\n-        AddMerkleRootAndCoinbase(m_block_template->block, std::move(coinbase), version, timestamp, nonce);\n+        CBlock& block{m_block_template->block};\n+        AddMerkleRootAndCoinbase(block, std::move(coinbase), version, timestamp, nonce);\n+\n+        // We modified the coinbase which should invalidate the check we did\n+        // when the block template was constructed. Additionally, unlike the\n+        // submitblock RPC we don't adjust the provided coinbase.\n+        block.m_checked_witness_commitment = false;",
      "path": "src/node/interfaces.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2477883143,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477883143\r\n\r\n> What about the other checked flags? Should we just reset all of them in `AddMerkleRootAndCoinbase`?\r\n\r\nThis seems like a really good idea. Having AddMerkleRootAndCoinbase update relevant flags seems like a more robust solution that would have prevented this problem.",
      "created_at": "2025-10-30T12:46:39Z",
      "updated_at": "2025-10-30T12:47:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477966256",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477966256"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 921,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477980297",
      "pull_request_review_id": 3399448986,
      "id": 2477980297,
      "node_id": "PRRC_kwDOABII586TsvqJ",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.",
      "path": "src/interfaces/mining.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"mining: check witness commitment in submitBlock\" (68fc907de93f422fd5566f9066bf16b1239e3a1b)\r\n\r\nIt's good to mention the block is modified now but it would seem helpful to provide a little more detail here about what is expected and what is modified here especially since IPC behavior is different from RPC.\r\n\r\nYou also [mentioned](https://github.com/bitcoin/bitcoin/pull/33374#issuecomment-3299129244) that RPC \"This is safe for submitted blocks\" documentation isn't really true and it would be nice if that documentation was fixed as well.\r\n\r\nFinally if we need to add some more accessors (getWitnessCommitment? getCoinbaseWitnessReservedValue?) here so miners do not need to make unsafe assumptions about the node, could we maybe do that in this PR? I understand SV2 protocol coudln't [currently](https://github.com/bitcoin/bitcoin/pull/33374#issuecomment-3299309843) use this information but it'd be nice to not have to revisit this issue and make more changes here if sv2 will need this in the future.\r\n\r\n",
      "created_at": "2025-10-30T12:51:32Z",
      "updated_at": "2025-10-30T13:34:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477980297",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2477980297"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478021355",
      "pull_request_review_id": 3399448986,
      "id": 2478021355,
      "node_id": "PRRC_kwDOABII586Ts5rr",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.\n+     *\n+     * @param[in] version version block header field\n+     * @param[in] timestamp time block header field (unix timestamp)\n+     * @param[in] nonce nonce block header field\n+     * @param[in] coinbase complete coinbase transaction (including witness)\n+     *\n+     * @note unlike the submitblock RPC, this method does NOT add the\n+     *       coinbase witness automatically.\n      *\n      * @returns if the block was processed, independent of block validity",
      "path": "src/interfaces/mining.h",
      "position": 16,
      "original_position": 15,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"mining: check witness commitment in submitBlock\" (68fc907de93f422fd5566f9066bf16b1239e3a1b)\r\n\r\nIt seems this comment is not actually true if this function is returning false now, or the comment could at least be clarified.\r\n\r\nIt also seems like just returning false here on failure without error messages could make it difficult for clients to debug issues. Will more specific errors be logged here? Could they be easily returned?\r\n\r\n",
      "created_at": "2025-10-30T13:04:35Z",
      "updated_at": "2025-10-30T13:34:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478021355",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478021355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 68,
      "original_line": 68,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478177222",
      "pull_request_review_id": 3399721764,
      "id": 2478177222,
      "node_id": "PRRC_kwDOABII586TtfvG",
      "diff_hunk": "@@ -912,7 +912,15 @@ class BlockTemplateImpl : public BlockTemplate\n \n     bool submitSolution(uint32_t version, uint32_t timestamp, uint32_t nonce, CTransactionRef coinbase) override\n     {\n-        AddMerkleRootAndCoinbase(m_block_template->block, std::move(coinbase), version, timestamp, nonce);\n+        CBlock& block{m_block_template->block};\n+        AddMerkleRootAndCoinbase(block, std::move(coinbase), version, timestamp, nonce);\n+\n+        // We modified the coinbase which should invalidate the check we did\n+        // when the block template was constructed. Additionally, unlike the\n+        // submitblock RPC we don't adjust the provided coinbase.\n+        block.m_checked_witness_commitment = false;\n+        Assume(!block.fChecked);\n+\n         return chainman().ProcessNewBlock(std::make_shared<const CBlock>(m_block_template->block), /*force_processing=*/true, /*min_pow_checked=*/true, /*new_block=*/nullptr);",
      "path": "src/node/interfaces.cpp",
      "position": 1,
      "original_position": 14,
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2477956663,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I moved the change away from here.",
      "created_at": "2025-10-30T13:44:42Z",
      "updated_at": "2025-10-30T13:44:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478177222",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478177222"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 916,
      "original_line": 916,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478202068",
      "pull_request_review_id": 3399754951,
      "id": 2478202068,
      "node_id": "PRRC_kwDOABII586TtlzU",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.\n+     *\n+     * @param[in] version version block header field\n+     * @param[in] timestamp time block header field (unix timestamp)\n+     * @param[in] nonce nonce block header field\n+     * @param[in] coinbase complete coinbase transaction (including witness)\n+     *\n+     * @note unlike the submitblock RPC, this method does NOT add the\n+     *       coinbase witness automatically.\n      *\n      * @returns if the block was processed, independent of block validity",
      "path": "src/interfaces/mining.h",
      "position": 16,
      "original_position": 15,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2478021355,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It behaves the same way as `ProcessNewBlock`, which has the following confusing documentation:\r\n\r\n> This only returns after the best known valid\r\n> block is made active. Note that it does not, however, guarantee that the\r\n> specific block passed to it has been checked for validity!",
      "created_at": "2025-10-30T13:51:37Z",
      "updated_at": "2025-10-30T13:52:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478202068",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478202068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 68,
      "original_line": 68,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478209632",
      "pull_request_review_id": 3399764434,
      "id": 2478209632,
      "node_id": "PRRC_kwDOABII586Ttnpg",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.\n+     *\n+     * @param[in] version version block header field\n+     * @param[in] timestamp time block header field (unix timestamp)\n+     * @param[in] nonce nonce block header field\n+     * @param[in] coinbase complete coinbase transaction (including witness)\n+     *\n+     * @note unlike the submitblock RPC, this method does NOT add the\n+     *       coinbase witness automatically.\n      *\n      * @returns if the block was processed, independent of block validity",
      "path": "src/interfaces/mining.h",
      "position": 16,
      "original_position": 15,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2478021355,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I do think it would be nice to return clear errors somehow, but that seems a separate issue.",
      "created_at": "2025-10-30T13:53:39Z",
      "updated_at": "2025-10-30T13:53:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478209632",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478209632"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 68,
      "original_line": 68,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478210721",
      "pull_request_review_id": 3399766107,
      "id": 2478210721,
      "node_id": "PRRC_kwDOABII586Ttn6h",
      "diff_hunk": "@@ -912,7 +912,15 @@ class BlockTemplateImpl : public BlockTemplate\n \n     bool submitSolution(uint32_t version, uint32_t timestamp, uint32_t nonce, CTransactionRef coinbase) override\n     {\n-        AddMerkleRootAndCoinbase(m_block_template->block, std::move(coinbase), version, timestamp, nonce);\n+        CBlock& block{m_block_template->block};\n+        AddMerkleRootAndCoinbase(block, std::move(coinbase), version, timestamp, nonce);\n+\n+        // We modified the coinbase which should invalidate the check we did\n+        // when the block template was constructed. Additionally, unlike the\n+        // submitblock RPC we don't adjust the provided coinbase.\n+        block.m_checked_witness_commitment = false;",
      "path": "src/node/interfaces.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2477883143,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-10-30T13:53:54Z",
      "updated_at": "2025-10-30T13:53:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478210721",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478210721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 921,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478319678",
      "pull_request_review_id": 3399922219,
      "id": 2478319678,
      "node_id": "PRRC_kwDOABII586TuCg-",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.",
      "path": "src/interfaces/mining.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2477980297,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thinking about adding the following to this comment:\r\n\r\n```cpp\r\n    /** Update uncommitted block structures (currently: only the witness reserved\r\n     * value). This is safe for submitted blocks as long as they honor\r\n     * default_witness_commitment from the template. */\r\n    void UpdateUncommittedBlockStructures(CBlock& block, const CBlockIndex* pindexPrev) const;\r\n```",
      "created_at": "2025-10-30T14:25:05Z",
      "updated_at": "2025-10-30T14:25:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478319678",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478319678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478444690",
      "pull_request_review_id": 3400099201,
      "id": 2478444690,
      "node_id": "PRRC_kwDOABII586TuhCS",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.",
      "path": "src/interfaces/mining.h",
      "position": 1,
      "original_position": 5,
      "commit_id": "fcb8b982f159f68edc128a835026059210b57ff7",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2477980297,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done. I also clarified which fields are modified.",
      "created_at": "2025-10-30T14:57:39Z",
      "updated_at": "2025-10-30T14:57:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2478444690",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2478444690"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479106793",
      "pull_request_review_id": 3401056196,
      "id": 2479106793,
      "node_id": "PRRC_kwDOABII586TxCrp",
      "diff_hunk": "@@ -54,7 +54,15 @@ class BlockTemplate\n     virtual std::vector<uint256> getCoinbaseMerklePath() = 0;\n \n     /**\n-     * Construct and broadcast the block.\n+     * Construct and broadcast the block. Modifies the template in place.\n+     *\n+     * @param[in] version version block header field\n+     * @param[in] timestamp time block header field (unix timestamp)\n+     * @param[in] nonce nonce block header field\n+     * @param[in] coinbase complete coinbase transaction (including witness)\n+     *\n+     * @note unlike the submitblock RPC, this method does NOT add the\n+     *       coinbase witness automatically.\n      *\n      * @returns if the block was processed, independent of block validity",
      "path": "src/interfaces/mining.h",
      "position": 16,
      "original_position": 15,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "68fc907de93f422fd5566f9066bf16b1239e3a1b",
      "in_reply_to_id": 2478021355,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Maybe the comment here could be changed to something like:\r\n\r\n```suggestion\r\n     * @returns if the block was processed, does not necessarily indicate validity.\r\n```",
      "created_at": "2025-10-30T18:27:20Z",
      "updated_at": "2025-10-30T18:27:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2479106793",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479106793"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 68,
      "original_line": 68,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479587224",
      "pull_request_review_id": 3401753833,
      "id": 2479587224,
      "node_id": "PRRC_kwDOABII586Ty3-Y",
      "diff_hunk": "@@ -204,13 +208,32 @@ async def async_routine():\n             res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\n             assert_equal(res.result, False)\n             self.log.debug(\"Submit a valid block\")\n+            remote_block_before = await self.parse_and_deserialize_block(template, ctx)\n             block.nVersion = original_version\n             block.solve()\n+\n+            self.log.debug(\"First call checkBlock()\")\n             res = await mining.result.checkBlock(block.serialize(), check_opts)\n             assert_equal(res.result, True)\n+\n+            self.log.debug(\"Submitted coinbase must include witness\")\n+            assert_not_equal(coinbase.serialize_without_witness().hex(), coinbase.serialize().hex())\n+            res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize_without_witness())",
      "path": "test/functional/interface_ipc.py",
      "position": 40,
      "original_position": 40,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit 504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4:\r\n\r\nIf I apply this test independently before the miner.cpp code changes, it still passes, so not sure what we are testing here. Wouldn't this only be relevant if we'd run checkBlock on the template's own block? Afaict we only do checkBlock on blocks we re-create here.",
      "created_at": "2025-10-30T21:33:55Z",
      "updated_at": "2025-10-30T21:33:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2479587224",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479587224"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 221,
      "original_line": 221,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479597276",
      "pull_request_review_id": 3401766771,
      "id": 2479597276,
      "node_id": "PRRC_kwDOABII586Ty6bc",
      "diff_hunk": "@@ -204,13 +208,32 @@ async def async_routine():\n             res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\n             assert_equal(res.result, False)\n             self.log.debug(\"Submit a valid block\")\n+            remote_block_before = await self.parse_and_deserialize_block(template, ctx)\n             block.nVersion = original_version\n             block.solve()\n+\n+            self.log.debug(\"First call checkBlock()\")\n             res = await mining.result.checkBlock(block.serialize(), check_opts)\n             assert_equal(res.result, True)\n+\n+            self.log.debug(\"Submitted coinbase must include witness\")\n+            assert_not_equal(coinbase.serialize_without_witness().hex(), coinbase.serialize().hex())\n+            res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize_without_witness())",
      "path": "test/functional/interface_ipc.py",
      "position": 40,
      "original_position": 40,
      "commit_id": "7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4",
      "original_commit_id": "504acfcd5d1ed4d77f7fd4f5dc57e66d6718d3d4",
      "in_reply_to_id": 2479587224,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Strange, for me this test fails as expected with the following diff applied to this branch:\r\n\r\n```diff\r\ndiff --git a/src/node/miner.cpp b/src/node/miner.cpp\r\nindex b988e28a3f..485984e437 100644\r\n--- a/src/node/miner.cpp\r\n+++ b/src/node/miner.cpp\r\n@@ -454,9 +454,9 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\r\n     block.hashMerkleRoot = BlockMerkleRoot(block);\r\n\r\n     // Reset cached checks\r\n-    block.m_checked_witness_commitment = false;\r\n-    block.m_checked_merkle_root = false;\r\n-    block.fChecked = false;\r\n+    // block.m_checked_witness_commitment = false;\r\n+    // block.m_checked_merkle_root = false;\r\n+    // block.fChecked = false;\r\n }\r\n```",
      "created_at": "2025-10-30T21:40:07Z",
      "updated_at": "2025-10-30T21:40:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2479597276",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2479597276"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33745"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 221,
      "original_line": 221,
      "side": "RIGHT"
    }
  ]
}
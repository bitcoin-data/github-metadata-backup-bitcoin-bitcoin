{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280",
    "id": 384870297,
    "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg0ODcwMjk3",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18280",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/18280.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/18280.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
    "number": 18280,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "wallet: UnregisterValidationInterface before SyncWithValidationInterfaceQueue",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "From boost signal documentation at https://www.boost.org/doc/libs/1_72_0/doc/html/signals2/thread-safety.html:\r\n\r\n> When a signal is invoked by calling signal::operator(), the invocation first acquires a lock on the signal's mutex. Then it obtains a handle to the signal's slot list and combiner. Next it releases the signal's mutex, before invoking the combiner to iterate through the slot list.\r\n\r\nThis means that `UnregisterValidationInterface` doesn't prevent more calls to that interface.\r\n\r\nThis PR fixes the assumption that no validation calls happen after `UnregisterValidationInterface` in the following code https://github.com/bitcoin/bitcoin/blob/5d92ac26ed8984c29eabc4b78bcddd2423e68dac/src/wallet/wallet.cpp#L114-L115\r\nThe actual bug is that `delete wallet` races with the validation notifications.\r\n\r\nThe fix consists in synchronizing with the validation queue (which happens in `BlockUntilSyncedToCurrentChain`) *after* `UnregisterValidationInterface`.\r\n\r\nAlternative to #18279. Fixes #16307.",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      }
    ],
    "active_lock_reason": "resolved",
    "created_at": "2020-03-06T15:09:03Z",
    "updated_at": "2022-02-15T10:58:14Z",
    "closed_at": "2020-03-13T08:46:31Z",
    "mergeable_state": "unknown",
    "merge_commit_sha": "f490f3d9c7f8434ccbc914da93e629e2a0153ca8",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "promag:2020-03-sync-unregistervalidationinterface",
      "ref": "2020-03-sync-unregistervalidationinterface",
      "sha": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 95606613,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NTYwNjYxMw==",
        "name": "bitcoin",
        "full_name": "promag/bitcoin",
        "owner": {
          "login": "promag",
          "id": 3534524,
          "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/promag",
          "html_url": "https://github.com/promag",
          "followers_url": "https://api.github.com/users/promag/followers",
          "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
          "organizations_url": "https://api.github.com/users/promag/orgs",
          "repos_url": "https://api.github.com/users/promag/repos",
          "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/promag/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/promag/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/promag/bitcoin",
        "archive_url": "https://api.github.com/repos/promag/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/promag/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/promag/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/promag/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/promag/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/promag/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/promag/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/promag/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/promag/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/promag/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/promag/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/promag/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/promag/bitcoin/events",
        "forks_url": "https://api.github.com/repos/promag/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/promag/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/promag/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/promag/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/promag/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/promag/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/promag/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/promag/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/promag/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/promag/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/promag/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/promag/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/promag/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/promag/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/promag/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/promag/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:promag/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/promag/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/promag/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/promag/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/promag/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/promag/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/promag/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/promag/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/promag/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/promag/bitcoin/hooks",
        "svn_url": "https://github.com/promag/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 209939,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-01-10T11:52:44Z",
        "created_at": "2017-06-27T22:37:11Z",
        "updated_at": "2022-12-31T13:30:10Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "58c72880ff70807cf622cdebf1d6273f4041bd2e",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34348,
        "stargazers_count": 69853,
        "watchers_count": 69853,
        "size": 234261,
        "default_branch": "master",
        "open_issues_count": 631,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-08T22:17:10Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-09T07:25:15Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 14,
    "deletions": 3,
    "changed_files": 4,
    "commits": 2,
    "review_comments": 20,
    "comments": 6
  },
  "events": [
    {
      "event": "reviewed",
      "id": 370395362,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMzk1MzYy",
      "url": null,
      "actor": null,
      "commit_id": "ce46396cf7ceac4d39a1bcef560904ee1b1dd6dc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-370395362",
      "submitted_at": "2020-03-06T15:13:37Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3105795176,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEwNTc5NTE3Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3105795176",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-06T15:29:29Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3105829348,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEwNTgyOTM0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3105829348",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-06T15:38:21Z"
    },
    {
      "event": "labeled",
      "id": 3106045233,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMxMDYwNDUyMzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3106045233",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-06T16:36:09Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3106996396,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEwNjk5NjM5Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3106996396",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-06T21:53:24Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3107385838,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEwNzM4NTgzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3107385838",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-07T02:27:04Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3107391828,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEwNzM5MTgyOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3107391828",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-07T02:35:43Z"
    },
    {
      "event": "commented",
      "id": 596037394,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjAzNzM5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/596037394",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-07T02:44:51Z",
      "updated_at": "2020-03-13T04:07:05Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18338 (wip: Fix wallet unload race condition by promag)\n* #18279 (Ensure wallet and chain tip are in sync by bvbfan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-596037394",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "commented",
      "id": 597150670,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzE1MDY3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597150670",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T15:30:55Z",
      "updated_at": "2020-03-10T15:30:55Z",
      "author_association": "MEMBER",
      "body": "> Alternative to #18279. Similar to #15700. More details in #18065. Possibly fixes #16307.\r\n\r\nAbout to look into this but this PR description seems like it is going to take a lot of digging to understand.\r\n\r\nIs it possible to summarize in a paragraph what this change is doing, what problem it fixes, and how it compares to the alternative? Thank you! :pray:",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-597150670",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "reviewed",
      "id": 372069303,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMDY5MzAz",
      "url": null,
      "actor": null,
      "commit_id": "afe8d39bdc27cfd0f4b3b61cc7cf1f0cf5df7b1b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Just to help other reviewers, this seems to make three changes:\r\n\r\n1. Instead of RegisterValidationInterface being non-blocking and beginning to send notifications right away, even if they preceded the RegisterValidationInterface call, it will now block waiting for any previously queued notifications to be drained, then attach the notification handler, then finally return.\r\n\r\n2. Instead of UnregisterValidationInterface being non-blocking and turning off notifications right away, it waits for any notifications that were queued prior to the UnregisterValidationInterface to be handled and blocks. Then it disconnects and returns after they were handled.\r\n\r\n3. Stops holding cs_main while sending the loadwallet notification.\r\n\r\nChange 3 seems like a good change just because it reduces unnecessary locking, but it's not clear what motivated the change. Maybe it would fix the deadlock @fanquake alluded to in https://github.com/bitcoin/bitcoin/issues/16307#issuecomment-595786198, but it's not possible to to tell without a backtrace.\r\n\r\nChange 1 at first glance seems like it more likely lead to missing notifications on startup, but maybe it's intended to prevent the wallet redundantly processing mempool transactions blocks that have just been rescanned? Unclear\r\n\r\nChange 2 seems like it could fix missing notifications on shutdown, but I'm not sure where that's been reported. It also seems like it could slow down shutdown unnecessarily.\r\n\r\nNote: I have a change which handles attaching notifications in a more deliberate nonracy way in https://github.com/bitcoin/bitcoin/pull/15719. Not sure if it overlaps with bugs that are being seen now, though. And it's nice to have more minimal bugfixes anyway.\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-372069303",
      "submitted_at": "2020-03-10T15:54:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "renamed",
      "id": 3115437551,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzExNTQzNzU1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3115437551",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T16:16:19Z",
      "rename": {
        "from": "fix: Disconnect validation interface on the queue dispacher",
        "to": "wip: fix: Disconnect validation interface on the queue dispacher"
      }
    },
    {
      "event": "commented",
      "id": 597176774,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzE3Njc3NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597176774",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T16:18:25Z",
      "updated_at": "2020-03-10T16:18:25Z",
      "author_association": "MEMBER",
      "body": "Sorry @ryanofsky, should have tagged wip. Will address your comments and address each required change once this is good. Thanks for reviewing and your comments - will also revisit #15719.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-597176774",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "mentioned",
      "id": 3115446164,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzExNTQ0NjE2NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3115446164",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T16:18:26Z"
    },
    {
      "event": "subscribed",
      "id": 3115446167,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMTU0NDYxNjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3115446167",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T16:18:26Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3115462353,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExNTQ2MjM1Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3115462353",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T16:22:23Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3115893507,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExNTg5MzUwNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3115893507",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T18:15:35Z"
    },
    {
      "event": "renamed",
      "id": 3116332435,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzExNjMzMjQzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3116332435",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T20:29:02Z",
      "rename": {
        "from": "wip: fix: Disconnect validation interface on the queue dispacher",
        "to": "wallet: UnregisterValidationInterface before SyncWithValidationInterfaceQueue"
      }
    },
    {
      "event": "commented",
      "id": 597299563,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzI5OTU2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597299563",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T20:31:07Z",
      "updated_at": "2020-03-10T20:31:07Z",
      "author_association": "MEMBER",
      "body": "Updated OP. Reduced the scope to just fix #16307. Will submit other PRs with relevant changes from previous commits.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-597299563",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3116819754,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExNjgxOTc1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3116819754",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-10T23:36:24Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3117704157,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExNzcwNDE1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3117704157",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T08:06:50Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3118466988,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExODQ2Njk4OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3118466988",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T11:52:17Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3118581235,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExODU4MTIzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3118581235",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T12:28:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3118989550,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExODk4OTU1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3118989550",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T14:14:37Z"
    },
    {
      "event": "commented",
      "id": 597693595,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5NzY5MzU5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/597693595",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T15:16:48Z",
      "updated_at": "2020-03-11T15:16:48Z",
      "author_association": "MEMBER",
      "body": "Updated to include dc62f3ce5228a611d973a154eb338e1fd34df38f which ensures that `SyncWithValidationInterfaceQueue` doesn't hang due to `!AreThreadsServicingQueue`.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-597693595",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "reviewed",
      "id": 372950012,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTUwMDEy",
      "url": null,
      "actor": null,
      "commit_id": "dc62f3ce5228a611d973a154eb338e1fd34df38f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 2a42fc1bdb393f88d72ec4d5c93b43b2b86dcc91. I left one comment below that would be nice to address. Also dc62f3ce5228a611d973a154eb338e1fd34df38f could use a better commit description. It's unclear when SyncWithValidationInterfaceQueue would hang now. Is there a shutdown race where wallets are outliving the scheduler? Or is this just a test workaround for cases where scheduler is not running?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-372950012",
      "submitted_at": "2020-03-11T17:06:08Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3119756171,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzExOTc1NjE3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3119756171",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T17:12:16Z"
    },
    {
      "event": "reviewed",
      "id": 372983242,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTgzMjQy",
      "url": null,
      "actor": null,
      "commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK c9ca6c407adc3bf43a968b6aecd3ea4cbec1ea54. Just suggested scheduler changes since last review\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-372983242",
      "submitted_at": "2020-03-11T17:49:54Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowM2NkNTkxZjQ3Zjg1MmUwYTJjMmU2MjYyMzY3ZWZmNGFjZWZjYTYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03cd591f47f852e0a2c2e6262367eff4acefca62",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/03cd591f47f852e0a2c2e6262367eff4acefca62",
      "tree": {
        "sha": "2127ce6fb374d89c523a874d801f1c0d7a192139",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2127ce6fb374d89c523a874d801f1c0d7a192139"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299",
          "sha": "6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299"
        }
      ],
      "message": "Handle no threads serving in MaybeScheduleProcessQueue\n\nThis is necessary if SyncWithValidationInterfaceQueue is called after\nscheduler thread exists, which happen at shutdown.",
      "committer": {
        "name": "Joo Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T19:06:41Z"
      },
      "author": {
        "name": "Joo Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T11:49:01Z"
      },
      "sha": "03cd591f47f852e0a2c2e6262367eff4acefca62"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMDk3ZTM1YTYzNWNkNThiZmMyMWU4YWIxNDlhOTAzZDU4ZTk0YmYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "tree": {
        "sha": "6b3c7a899efb6d54c2fa3a44202a5d1e5f787d1e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b3c7a899efb6d54c2fa3a44202a5d1e5f787d1e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03cd591f47f852e0a2c2e6262367eff4acefca62",
          "sha": "03cd591f47f852e0a2c2e6262367eff4acefca62",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/03cd591f47f852e0a2c2e6262367eff4acefca62"
        }
      ],
      "message": "wallet: UnregisterValidationInterface before SyncWithValidationInterfaceQueue",
      "committer": {
        "name": "Joo Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T19:06:46Z"
      },
      "author": {
        "name": "Joo Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-10T18:13:50Z"
      },
      "sha": "2097e35a635cd58bfc21e8ab149a903d58e94bf2"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3120153299,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzEyMDE1MzI5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3120153299",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-11T19:07:03Z"
    },
    {
      "event": "reviewed",
      "id": 373638356,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjM4MzU2",
      "url": null,
      "actor": null,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK 2097e35a635cd58bfc21e8ab149a903d58e94bf2. Just suggested change clarifying AddToProcessQueue / MaybeScheduleProcessQueue logic since last review",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-373638356",
      "submitted_at": "2020-03-12T15:04:51Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "reviewed",
      "id": 373691637,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjkxNjM3",
      "url": null,
      "actor": null,
      "commit_id": "03cd591f47f852e0a2c2e6262367eff4acefca62",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#pullrequestreview-373691637",
      "submitted_at": "2020-03-12T16:04:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
    },
    {
      "event": "commented",
      "id": 598613080,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODYxMzA4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598613080",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T08:46:31Z",
      "updated_at": "2020-03-13T08:46:31Z",
      "author_association": "MEMBER",
      "body": "Replaced by #18338.",
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#issuecomment-598613080",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18280"
    },
    {
      "event": "closed",
      "id": 3125864553,
      "node_id": "MDExOkNsb3NlZEV2ZW50MzEyNTg2NDU1Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3125864553",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T08:46:31Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 3125864808,
      "node_id": "MDE5OkhlYWRSZWZEZWxldGVkRXZlbnQzMTI1ODY0ODA4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3125864808",
      "actor": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T08:46:37Z"
    },
    {
      "event": "locked",
      "id": 6073973698,
      "node_id": "LOE_lADOABII584iZDGDzwAAAAFqCXvC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6073973698",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-02-15T10:58:14Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388959593",
      "pull_request_review_id": 370395362,
      "id": 388959593,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk1OTU5Mw==",
      "diff_hunk": "@@ -88,9 +88,11 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n }\n \n void UnregisterValidationInterface(CValidationInterface* pwalletIn) {\n-    if (g_signals.m_internals) {\n-        g_signals.m_internals->m_connMainSignals.erase(pwalletIn);\n-    }\n+    AssertLockNotHeld(cs_main);\n+    std::promise<void> promise;",
      "path": "src/validationinterface.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "ce46396cf7ceac4d39a1bcef560904ee1b1dd6dc",
      "in_reply_to_id": null,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You don't need make promise or calls function if `g_signals.m_internals` is nullptr.",
      "created_at": "2020-03-06T15:13:32Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r388959593",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388959593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 99,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388972769",
      "pull_request_review_id": 370413382,
      "id": 388972769,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3Mjc2OQ==",
      "diff_hunk": "@@ -88,9 +88,11 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n }\n \n void UnregisterValidationInterface(CValidationInterface* pwalletIn) {\n-    if (g_signals.m_internals) {\n-        g_signals.m_internals->m_connMainSignals.erase(pwalletIn);\n-    }\n+    AssertLockNotHeld(cs_main);\n+    std::promise<void> promise;",
      "path": "src/validationinterface.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "ce46396cf7ceac4d39a1bcef560904ee1b1dd6dc",
      "in_reply_to_id": 388959593,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2020-03-06T15:34:55Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r388972769",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/388972769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 99,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390406472",
      "pull_request_review_id": 372069303,
      "id": 390406472,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQwNjQ3Mg==",
      "diff_hunk": "@@ -3975,14 +3985,6 @@ std::shared_ptr<CWallet> CWallet::CreateWalletFromFile(interfaces::Chain& chain,\n     // Register with the validation interface. It's ok to do this after rescan since we're still holding locked_chain.",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "afe8d39bdc27cfd0f4b3b61cc7cf1f0cf5df7b1b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This comment is no longer true, and seems like it means there can now be missing notifications. I wonder if a different approach would be to send the loadwallet notification before locking the chain & scanning instead of after?",
      "created_at": "2020-03-10T15:35:13Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r390406472",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/390406472"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4097,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391120925",
      "pull_request_review_id": 372950012,
      "id": 391120925,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyMDkyNQ==",
      "diff_hunk": "@@ -148,6 +148,10 @@ bool CScheduler::AreThreadsServicingQueue() const {\n \n \n void SingleThreadedSchedulerClient::MaybeScheduleProcessQueue() {\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {\n+        EmptyQueue();\n+        return;\n+    }",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 7,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "dc62f3ce5228a611d973a154eb338e1fd34df38f",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Handle no threads serving in MaybeScheduleProcessQueue\" (dc62f3ce5228a611d973a154eb338e1fd34df38f)\r\n\r\nI think it would make more sense to add this logic at the bottom of `AddToProcessQueue` (and avoid calling `MaybeScheduleProcessQueue` in no thread case) than having it at the top of `MaybeScheduleProcessQueue` and returning early.\r\n\r\nFew reasons:\r\n\r\n- Having this logic doesn't seem useful in ProcessQueue, the other place where MaybeScheduleProcessQueue is called\r\n- Adding this code here creates recursion ProcessQueue -> MaybeScheduleProcessQueue -> EmptyQueue -> ProcessQueue\r\n- If code is added here the name `MaybeScheduleProcessQueue` is now misleading because this is running callbacks immediately, not scheduling them for later",
      "created_at": "2020-03-11T16:58:32Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391120925",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391120925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": 150,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391148440",
      "pull_request_review_id": 372983242,
      "id": 391148440,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0ODQ0MA==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {\n+        EmptyQueue();",
      "path": "src/scheduler.cpp",
      "position": 8,
      "original_position": 5,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Handle no threads serving in MaybeScheduleProcessQueue\" (201eebf13b2723d7fe821d7222600fa04fadc0b0)\r\n\r\nCommit message subject is out of date since `MaybeScheduleProcessQueue` is no longer changing.\r\n\r\nAlso I'm surprised by \"SyncWithValidationInterfaceQueue is called after\r\nscheduler thread exists, which happen at shutdown\" since I would hope wallets are getting unloaded before the scheduler stops, but maybe this is not the case currently. Probably beyond the scope of this PR to address, though\r\n",
      "created_at": "2020-03-11T17:39:21Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391148440",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391148440"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 201,
      "original_line": 201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391151878",
      "pull_request_review_id": 372983242,
      "id": 391151878,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE1MTg3OA==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Handle no threads serving in MaybeScheduleProcessQueue\" (201eebf13b2723d7fe821d7222600fa04fadc0b0)\r\n\r\nIf we can make this code:\r\n\r\n```c++\r\nif (m_pscheduler->AreThreadsServicingQueue()) [\r\n    MaybeScheduleProcessQueue();\r\n} else {\r\n    EmptyQueue();\r\n}\r\n```\r\n\r\nit would be more obvious what's going on here.\r\n\r\nOtherwise if the unconditional `MaybeScheduleProcessQueue` call is needed it would be good have a comment saying what it's needed for.\r\n\r\n",
      "created_at": "2020-03-11T17:44:39Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391151878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391151878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391175327",
      "pull_request_review_id": 373016278,
      "id": 391175327,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3NTMyNw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should it be inside `EmptyQueue`",
      "created_at": "2020-03-11T18:23:12Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391175327",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391175327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391198452",
      "pull_request_review_id": 373045406,
      "id": 391198452,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5ODQ1Mg==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Should it be inside `EmptyQueue`\r\n\r\nI wouldn't change emptyqueue because it's called other places which don't need this logic, and I can't see how the behavior would fit in there (how you could coherently describe it or change the emptyqueue name to reflect it)",
      "created_at": "2020-03-11T19:04:53Z",
      "updated_at": "2020-03-11T19:07:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391198452",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391198452"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391210613",
      "pull_request_review_id": 373060627,
      "id": 391210613,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIxMDYxMw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed. However if the scheduler thread is stopped after `AreThreadsServicingQueue` then the function won't be called right?",
      "created_at": "2020-03-11T19:28:39Z",
      "updated_at": "2020-03-11T19:28:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391210613",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391210613"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391422843",
      "pull_request_review_id": 373304317,
      "id": 391422843,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQyMjg0Mw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Test wallet_multiwallet fails due to this code path, see my changes in EmptyQueue, you should schedule process queue when event queue is not empty, the logic is reversed there.",
      "created_at": "2020-03-12T06:28:39Z",
      "updated_at": "2020-03-12T06:28:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391422843",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391422843"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391678408",
      "pull_request_review_id": 373629891,
      "id": 391678408,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3ODQwOA==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I wouldn't change emptyqueue because it's called other places\r\n\r\nWhere? It's called in `FlushBackgroundCallbacks` only in init.cpp i'm pretty sure it will not affect anything wrong.",
      "created_at": "2020-03-12T14:55:44Z",
      "updated_at": "2020-03-12T14:55:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391678408",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391678408"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391690701",
      "pull_request_review_id": 373645824,
      "id": 391690701,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5MDcwMQ==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> > I wouldn't change emptyqueue because it's called other places\r\n> \r\n> Where? It's called in `FlushBackgroundCallbacks` only in init.cpp i'm pretty sure it will not affect anything wrong.\r\n\r\nNot saying it's wrong, saying I don't understand how it makes sense for what how the EmptyQueue function is named, or what it currently does, or how it's called other places.\r\n\r\nMaybe your suggestion to change EmptyQueue to schedule tasks instead of running them on the current thread is good, but it doesn't make sense to me right now, and since no rationale was given and I can't read your mind, I'm saying I wouldn't change it here.",
      "created_at": "2020-03-12T15:12:59Z",
      "updated_at": "2020-03-12T15:13:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391690701",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391690701"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391693024",
      "pull_request_review_id": 373648848,
      "id": 391693024,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5MzAyNA==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {\n+        EmptyQueue();",
      "path": "src/scheduler.cpp",
      "position": 8,
      "original_position": 5,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391148440,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> since I would hope wallets are getting unloaded before the scheduler stops\r\n\r\nNot currently the case.\r\n\r\n> Probably beyond the scope of this PR to address, though\r\n\r\nAgree, I've tried and it caused some other failures.\r\n\r\n> Commit message subject is out of date since MaybeScheduleProcessQueue is no longer changing.\r\n\r\nOps need to update.",
      "created_at": "2020-03-12T15:16:20Z",
      "updated_at": "2020-03-12T15:16:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391693024",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391693024"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 201,
      "original_line": 201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391706163",
      "pull_request_review_id": 373666522,
      "id": 391706163,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcwNjE2Mw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Test wallet_multiwallet fails due to this code path, see my changes in EmptyQueue, you should schedule process queue when event queue is not empty, the logic is reversed there.\r\n\r\nwallet_multiwallet.py is failing on appveyor with \"'unloadwallet' RPC took longer than 60.000000 seconds. Consider using larger timeout for calls that take longer to return. (-344)\"\r\n\r\nhttps://ci.appveyor.com/project/DrahtBot/bitcoin/builds/31405838\r\n\r\nSo it looks like there is a problem with the current implementation. But I don't understand the comment about EmptyQueue or logic being reversed",
      "created_at": "2020-03-12T15:35:49Z",
      "updated_at": "2020-03-12T15:35:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391706163",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391706163"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391706553",
      "pull_request_review_id": 373667040,
      "id": 391706553,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcwNjU1Mw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It makes much more sense compare to current version\r\n```\r\nvoid SingleThreadedSchedulerClient::EmptyQueue() {\r\n    if (!m_pscheduler->AreThreadsServicingQueue())\r\n        return;\r\n    auto pendingCallbacks = [this]() -> bool {\r\n        LOCK(m_cs_callbacks_pending);\r\n        return !m_callbacks_pending.empty();\r\n    };\r\n    bool should_continue = pendingCallbacks();\r\n    while (should_continue) {\r\n        ProcessQueue();\r\n        should_continue = pendingCallbacks();\r\n    }\r\n}\r\n```\r\n1. You don't need to do stupid things, like here one,\r\n`if (!m_pscheduler->AreThreadsServicingQueue())`\r\n2. You don't need to check against is there pending callbacks it's done there, so if you don't have pending ones you don't need to enter eventually endless waiting. ",
      "created_at": "2020-03-12T15:36:28Z",
      "updated_at": "2020-03-12T15:36:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391706553",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391706553"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391709067",
      "pull_request_review_id": 373670392,
      "id": 391709067,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcwOTA2Nw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "promag",
        "id": 3534524,
        "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/promag",
        "html_url": "https://github.com/promag",
        "followers_url": "https://api.github.com/users/promag/followers",
        "following_url": "https://api.github.com/users/promag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/promag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/promag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
        "organizations_url": "https://api.github.com/users/promag/orgs",
        "repos_url": "https://api.github.com/users/promag/repos",
        "events_url": "https://api.github.com/users/promag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/promag/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Iv'e been trying to reproduce appveyor error wihtout any luck.",
      "created_at": "2020-03-12T15:40:17Z",
      "updated_at": "2020-03-12T15:40:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391709067",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391709067"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391725203",
      "pull_request_review_id": 373691637,
      "id": 391725203,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyNTIwMw==",
      "diff_hunk": "@@ -195,7 +195,11 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         LOCK(m_cs_callbacks_pending);\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n-    MaybeScheduleProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "03cd591f47f852e0a2c2e6262367eff4acefca62",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Handle no threads serving in MaybeScheduleProcessQueue\" (03cd591f47f852e0a2c2e6262367eff4acefca62)\r\n\r\nWas experimenting and wrote a small test for this change:\r\n\r\n```c++\r\n// Ensure scheduled tasks run even when there are no scheduler threads\r\nBOOST_AUTO_TEST_CASE(singlethreadedscheduler_nothreads)\r\n{\r\n    CScheduler scheduler;\r\n    SingleThreadedSchedulerClient client(&scheduler);\r\n    bool task_ran = false;\r\n    client.AddToProcessQueue([&] { task_ran = true; });\r\n    BOOST_CHECK(task_ran);\r\n}\r\n```\r\n\r\nCould add this to scheduler_tests.cpp. It fails without this commit and passes with it.",
      "created_at": "2020-03-12T16:04:15Z",
      "updated_at": "2020-03-12T16:04:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391725203",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391725203"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 198,
      "original_line": 198,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391771779",
      "pull_request_review_id": 373750724,
      "id": 391771779,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc3MTc3OQ==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> 1. You don't need to do stupid things, like here one,\r\n>    `if (!m_pscheduler->AreThreadsServicingQueue())`\r\n> 2. You don't need to check against is there pending callbacks it's done there, so if you don't have pending ones you don't need to enter eventually endless waiting.\r\n\r\n@bvbfan, I'm confused by what you are saying here. You seem to be saying you don't need two things, but your code sample is doing both those things. Are you saying that for some reason it is better to do (1) in `EmptyQueue` instead of `AddToProcessQueue`? If so, what is the reason you think this? To me it seems better to do (1) in `AddToProcessQueue` instead of  `EmptyQueue`, because `AddToProcessQueue` has to be aware of thread state while `EmptyQueue` does not.\r\n\r\nI'm even more confused what you are saying about (2) because you're saying we don't need a check for pending callbacks but your code is actually adding an extra check (before the first loop iteration).\r\n\r\nMore importantly, I can't figure out what this suggestion has to do with wallet_multiwallet.py. If you can clarify, it would be much appreciated. I've also been trying to reproduce the failure there and look for possible causes and haven't been able to figure it out.",
      "created_at": "2020-03-12T17:16:50Z",
      "updated_at": "2020-03-12T17:17:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391771779",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391771779"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391795447",
      "pull_request_review_id": 373780016,
      "id": 391795447,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc5NTQ0Nw==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">  I'm confused by what you are saying here. You seem to be saying you don't need two things, but your code sample is doing both those things. \r\n\r\nI mean you don't need to do these things outside else, i was not clear. These 2 things should be done here in `EmptyQueue`\r\n\r\n> More importantly, I can't figure out what this suggestion has to do with wallet_multiwallet.py\r\n\r\n```\r\nif (m_pscheduler->AreThreadsServicingQueue()) [\r\n    MaybeScheduleProcessQueue();\r\n} else {\r\n    EmptyQueue();\r\n}\r\n```\r\nThis code is wrong, you try to process / flush events but it does not do that. Let analyse current code\r\n ```\r\nvoid SingleThreadedSchedulerClient::EmptyQueue() {\r\nassert(!m_pscheduler->AreThreadsServicingQueue()); // <- assert (you can avoid that)\r\n    bool should_continue = true;\r\n    while (should_continue) {\r\n        ProcessQueue(); // <--- here is the bigger mistake, it tries to process events before it's checked that has pending callbacks, you can enter this and wait to infinity (since app is shutting down) it should be checked for pendings before process queue\r\n        LOCK(m_cs_callbacks_pending);\r\n        should_continue = !m_callbacks_pending.empty();\r\n    }\r\n```",
      "created_at": "2020-03-12T17:56:15Z",
      "updated_at": "2020-03-12T17:56:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391795447",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391795447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391814619",
      "pull_request_review_id": 373804479,
      "id": 391814619,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxNDYxOQ==",
      "diff_hunk": "@@ -196,6 +196,9 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n     MaybeScheduleProcessQueue();\n+    if (!m_pscheduler->AreThreadsServicingQueue()) {",
      "path": "src/scheduler.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "original_commit_id": "201eebf13b2723d7fe821d7222600fa04fadc0b0",
      "in_reply_to_id": 391151878,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> ```\r\n>        ProcessQueue(); // <--- here is the bigger mistake, it tries to process events before it's checked that has pending callbacks, you can enter this and wait to infinity (since app is shutting down) it should be checked for pendings before process queue\r\n> ```\r\n\r\nExplain this more? `ProcessQueue` doesn't wait for callbacks if there aren't any, it just runs a  callbacks if there is one.\r\n\r\n> Iv'e been trying to reproduce appveyor error wihtout any luck.\r\n\r\nI finally reproduced the problem cutting down the test and running in a loop with --usecli. Looking at the stack trace I see `unloadwallet` RPC thread waiting for scheduler thread `MaybeCompactWalletDB` call, which is stuck in `ReleaseWallet` calling `SyncWithValidationInterfaceQueue`, which is stuck because `SyncWithValidationInterfaceQueue` will always hang if called from the scheduler thread. This is basically the same deadlock that was in fanquake's backtrace from https://github.com/bitcoin/bitcoin/issues/16307#issuecomment-597669986, which suggests that 2a42fc1bdb393f88d72ec4d5c93b43b2b86dcc91 and 2097e35a635cd58bfc21e8ab149a903d58e94bf2 aren't going to work as fixes for this problem   in their current form. Maybe more can be done to get them working but an alternate approach like 06d2b530e57b88c0542e2bd8db00ca0b034b589d ([branch](https://github.com/ryanofsky/bitcoin/commits/pr/notify-shared), [comment](https://github.com/bitcoin/bitcoin/issues/16307#issuecomment-597302227)) might be easier at this point",
      "created_at": "2020-03-12T18:31:29Z",
      "updated_at": "2020-03-12T18:31:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/18280#discussion_r391814619",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391814619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18280"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 199,
      "side": "RIGHT"
    }
  ]
}
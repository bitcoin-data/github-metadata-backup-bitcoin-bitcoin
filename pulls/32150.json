{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150",
    "id": 2420947155,
    "node_id": "PR_kwDOABII586QTLjT",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32150",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32150.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32150.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/fe07afafefe99dd9994b49704c34477106be2ad1",
    "number": 32150,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coinselection: Optimize BnB exploration",
    "user": {
      "login": "murchandamus",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murchandamus",
      "html_url": "https://github.com/murchandamus",
      "followers_url": "https://api.github.com/users/murchandamus/followers",
      "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
      "organizations_url": "https://api.github.com/users/murchandamus/orgs",
      "repos_url": "https://api.github.com/users/murchandamus/repos",
      "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/murchandamus/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This PR rewrites the implementation of the BnB coinselection algorithm\r\nto skip the duplicate evaluation of previously visited input selections.\r\n\r\nIn the original implementation of BnB, the state of the search is\r\nbacktracked by explicitly walking back to the omission branch and then\r\ntesting again. This retests an equivalent candidate set as before, e.g.,\r\nafter backtracking from {ABC}, it would evaluate {AB_}, before trying\r\n{AB_D}, but {AB_} is equivalent to {AB} which was tested before.\r\n\r\nCoinGrinder tracks the state of the search instead by remembering which\r\nUTXO was last added and explicitly shifting from that UTXO directly to\r\nthe next, so after {ABC}, it will immediately move on to {AB_D}. We\r\nreplicate this approach here.\r\n\r\nAs fewer nodes are visited, this approach will enumerate more possible\r\ncombinations than the original implementation given the same limit for \r\niterations.",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2025-03-27T02:33:51Z",
    "updated_at": "2026-02-18T01:11:13Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "2af42e8a3f4f9cdaaefb3db5d2528a8c635601df",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "8144225309",
        "id": 248271067,
        "node_id": "U_kgDODsxQ2w",
        "avatar_url": "https://avatars.githubusercontent.com/u/248271067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/8144225309",
        "html_url": "https://github.com/8144225309",
        "followers_url": "https://api.github.com/users/8144225309/followers",
        "following_url": "https://api.github.com/users/8144225309/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/8144225309/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/8144225309/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/8144225309/subscriptions",
        "organizations_url": "https://api.github.com/users/8144225309/orgs",
        "repos_url": "https://api.github.com/users/8144225309/repos",
        "events_url": "https://api.github.com/users/8144225309/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/8144225309/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "murchandamus:2025-03-rewrite-BnB",
      "ref": "2025-03-rewrite-BnB",
      "sha": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 23979970,
        "node_id": "MDEwOlJlcG9zaXRvcnkyMzk3OTk3MA==",
        "name": "bitcoin",
        "full_name": "murchandamus/bitcoin",
        "owner": {
          "login": "murchandamus",
          "id": 4060799,
          "node_id": "MDQ6VXNlcjQwNjA3OTk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/murchandamus",
          "html_url": "https://github.com/murchandamus",
          "followers_url": "https://api.github.com/users/murchandamus/followers",
          "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
          "organizations_url": "https://api.github.com/users/murchandamus/orgs",
          "repos_url": "https://api.github.com/users/murchandamus/repos",
          "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/murchandamus/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/murchandamus/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/murchandamus/bitcoin",
        "archive_url": "https://api.github.com/repos/murchandamus/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/murchandamus/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/murchandamus/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/murchandamus/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/murchandamus/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/murchandamus/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/murchandamus/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/murchandamus/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/murchandamus/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/murchandamus/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/murchandamus/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/murchandamus/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/murchandamus/bitcoin/events",
        "forks_url": "https://api.github.com/repos/murchandamus/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/murchandamus/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/murchandamus/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/murchandamus/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/murchandamus/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/murchandamus/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/murchandamus/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/murchandamus/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/murchandamus/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/murchandamus/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/murchandamus/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/murchandamus/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/murchandamus/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/murchandamus/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/murchandamus/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/murchandamus/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:murchandamus/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/murchandamus/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/murchandamus/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/murchandamus/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/murchandamus/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/murchandamus/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/murchandamus/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/murchandamus/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/murchandamus/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/murchandamus/bitcoin/hooks",
        "svn_url": "https://github.com/murchandamus/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 255660,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-18T01:09:55Z",
        "created_at": "2014-09-12T23:11:53Z",
        "updated_at": "2025-07-13T19:52:17Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a7c29df0e5ace05b6186612671d6103c112ec922",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38908,
        "stargazers_count": 88162,
        "watchers_count": 88162,
        "size": 303687,
        "default_branch": "master",
        "open_issues_count": 732,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-17T13:15:46Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-18T01:30:53Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 193,
    "deletions": 105,
    "changed_files": 3,
    "commits": 7,
    "review_comments": 58,
    "comments": 20
  },
  "events": [
    {
      "event": "commented",
      "id": 2756305237,
      "node_id": "IC_kwDOABII586kSeFV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2756305237",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T02:33:54Z",
      "updated_at": "2026-02-18T01:11:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32150.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2972167678), [yancyribbens](https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3181000371), [8144225309](https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3754274831), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3788218793) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (✨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- \"we have already explored a set of equivalent combination as the one we could generate with the second clone.\" -> \"we have already explored a set of equivalent combinations to the one we could generate with the second clone.\" [pluralize \"combination\" and use \"to\" for correct comparison; otherwise the sentence is grammatically incorrect and harder to parse]\n\n- \"We don’t have access to the feerate here, but fee to long_term_fee is as feerate to LTFRE\" -> \"We don’t have access to the feerate here, but fee to long_term_fee is analogous to feerate to long_term_fee.\" [original wording is unclear/incorrect (\"is as ... to ...\"); clarify the analogy and use consistent identifier for the long-term fee rate]\n\n- \"it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a higher waste.  If so, selecting `next_utxo` would produce an equivalent or worse selection as one we previously evaluated.\" -> \"it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a higher waste. If so, selecting `next_utxo` would produce an equivalent or worse selection to one we previously evaluated.\" [use \"to\" (or \"than\") rather than \"as\" for correct comparison; double space removed]\n\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- TestBnBSuccess(\"Select smallest UTXO\", utxo_pool, /*selection_target=*/1 * CENT, /*expected_input_amounts=*/{1 * CENT}, /*expected_attempts=*/3, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select middle UTXO\", utxo_pool, /*selection_target=*/3 * CENT, /*expected_input_amounts=*/{3 * CENT}, /*expected_attempts=*/3, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select biggest UTXO\", utxo_pool, /*selection_target=*/5 * CENT, /*expected_input_amounts=*/{5 * CENT}, /*expected_attempts=*/2, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select two UTXOs\", utxo_pool, /*selection_target=*/4 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT}, /*expected_attempts=*/4, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select all UTXOs\", utxo_pool, /*selection_target=*/9 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT, 5 * CENT}, /*expected_attempts=*/5, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select upper bound\", utxo_pool, /*selection_target=*/4 * CENT - default_cs_params.m_cost_of_change, /*expected_input_amounts=*/{1 * CENT, 3 * CENT}, /*expected_attempts=*/4, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select max weight\", utxo_pool, /*selection_target=*/4 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT}, /*expected_attempts=*/4, cs_params, /*custom_spending_vsize=*/P2WPKH_INPUT_VSIZE, /*max_selection_weight=*/4 * 2 * P2WPKH_INPUT_VSIZE) in src/wallet/test/coinselection_tests.cpp\n- TestBnBFail(\"Exceed max weight\", utxo_pool, /*selection_target=*/4 * CENT, /*max_selection_weight=*/4 * 2 * P2WPKH_INPUT_VSIZE - 1, /*expect_max_weight_exceeded=*/true) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Skip equivalent input sets\", clone_pool, /*selection_target=*/16 * CENT, /*expected_input_amounts=*/{2 * CENT, 7 * CENT, 7 * CENT}, /*expected_attempts=*/16, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Combine smallest 8 of 17 unique UTXOs\", doppelganger_pool, /*selection_target=*/8 * CENT, /*expected_input_amounts=*/expected_inputs, /*expected_attempts=*/51'765, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Combine smallest 8 of 18 unique UTXOs\", doppelganger_pool, /*selection_target=*/8 * CENT, /*expected_input_amounts=*/expected_inputs, /*expected_attempts=*/87'957, cs_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBFail(\"Exhaust looking for smallest 8 of 19 unique UTXOs\", doppelganger_pool, /*selection_target=*/8 * CENT) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select many inputs at low feerates\", low_feerate_pool, /*selection_target=*/10 * CENT, /*expected_input_amounts=*/{2 * CENT, 3 * CENT, 5 * CENT}, /*expected_attempts=*/6) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Select one input at high feerates\", high_feerate_pool, /*selection_target=*/10 * CENT, /*expected_input_amounts=*/{10 * CENT}, /*expected_attempts=*/5, high_feerate_params) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Prefer two heavy inputs over two light inputs at low feerates\", low_feerate_pool, /*selection_target=*/13 * CENT, /*expected_input_amounts=*/{6 * CENT, 7 * CENT}, /*expected_attempts=*/18, default_cs_params, /*custom_spending_vsize=*/500) in src/wallet/test/coinselection_tests.cpp\n- TestBnBSuccess(\"Prefer two light inputs over two heavy inputs at high feerates\", high_feerate_pool, /*selection_target=*/13 * CENT, /*expected_input_amounts=*/{3 * CENT, 10 * CENT}, /*expected_attempts=*/9, high_feerate_params) in src/wallet/test/coinselection_tests.cpp\n\n\n\n<sup>2026-02-18 01:11:11</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2756305237",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "labeled",
      "id": 17003394747,
      "node_id": "LE_lADOABII586v6UtWzwAAAAP1eza7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17003394747",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T02:33:57Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "convert_to_draft",
      "id": 17003398361,
      "node_id": "CTDE_lADOABII586v6UtWzwAAAAP1e0TZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17003398361",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T02:34:29Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17013761145,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAP2GWR5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17013761145",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "613df18b00c6a5b23d829738892438ce64be27f3",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/613df18b00c6a5b23d829738892438ce64be27f3",
      "created_at": "2025-03-27T13:35:36Z"
    },
    {
      "event": "commented",
      "id": 2758592756,
      "node_id": "IC_kwDOABII586kbMj0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2758592756",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T16:05:49Z",
      "updated_at": "2025-03-27T16:05:49Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2758592756",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "commented",
      "id": 2758612172,
      "node_id": "IC_kwDOABII586kbRTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2758612172",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-27T16:12:30Z",
      "updated_at": "2025-03-27T16:12:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "I ran benchmarking on master and benchmarking on this branch since it's fairly large change.\r\n\r\nmaster:\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|       43,633,696.00 |               22.92 |    0.1% |      0.48 | `CoinSelection`\r\n```\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/32150/commits/e2a4d86131e8f1661eb450c50b8072147965b111:\r\n```\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|       40,433,894.00 |               24.73 |    0.1% |      0.44 | `CoinSelection`\r\n```\r\n\r\nlooks like a marginal improvement in bechmarked performance.\r\n",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2758612172",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17065461357,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAP5LkZt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17065461357",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "5ac0d02b3a7e678a0cf206ad676b6de0b215787c",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/5ac0d02b3a7e678a0cf206ad676b6de0b215787c",
      "created_at": "2025-04-01T00:04:33Z"
    },
    {
      "event": "commented",
      "id": 2767684548,
      "node_id": "IC_kwDOABII586k94PE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2767684548",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-01T00:05:57Z",
      "updated_at": "2025-04-01T00:05:57Z",
      "author_association": "MEMBER",
      "body": "Rebased on #29532",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2767684548",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17065491779,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAP5Lr1D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17065491779",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "44bab80284f3710ee30805ec3c5da06dd06d4d71",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/44bab80284f3710ee30805ec3c5da06dd06d4d71",
      "created_at": "2025-04-01T00:08:48Z"
    },
    {
      "event": "reviewed",
      "id": 2733815682,
      "node_id": "PRR_kwDOABII586i8reC",
      "url": null,
      "actor": null,
      "commit_id": "d765ba9ae567cf3192706223d873d041f71f9c82",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-04-01T19:12:26Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2733815682",
      "submitted_at": "2025-04-01T19:12:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "renamed",
      "id": 17082914103,
      "node_id": "RTE_lADOABII586v6UtWzwAAAAP6OJU3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17082914103",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-01T21:32:10Z",
      "rename": {
        "from": "refactor: Optimize BnB exploration",
        "to": "coinselection: Optimize BnB exploration"
      }
    },
    {
      "event": "commented",
      "id": 2773089158,
      "node_id": "IC_kwDOABII586lSfuG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2773089158",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-02T16:14:13Z",
      "updated_at": "2025-04-02T16:14:13Z",
      "author_association": "MEMBER",
      "body": "> I ran benchmarking on master and benchmarking on this branch since it's fairly large change.\r\n\r\nIf I remember right the Coin Selection benchmark is rather non-representative. I have a todo to update it somewhere in my backlog.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2773089158",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "commented",
      "id": 2776283405,
      "node_id": "IC_kwDOABII586lerkN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2776283405",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-03T16:04:18Z",
      "updated_at": "2025-04-03T16:04:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "> If I remember right the Coin Selection benchmark is rather non-representative. I have a todo to update it somewhere in my backlog.\r\n\r\nGood point.  I took a quick look, and the current benchmark runs BnB for only `4` iterations.  there are `1,000` clones and one non clone so most of the work is done by skipping clones which isn't very representative as you say.\r\n\r\nInstead of keeping this in your backlog, shouldn't there be an issue opened so it doesn't get overlooked?  Maybe someone else has the bandwidth to pick it up.  Possibly I could but I also have a large backlog of I'd like to work on.\r\n\r\nAlso, I note there is also `BnBExhaustion(benchmark::Bench& bench)` which is probably more \"representative\" although it also looks like you have a [TODO](https://github.com/bitcoin/bitcoin/pull/29532/files#diff-36ddaeb9e3a5c1aaaccd6b1ed6c770e8344e33dbfd4876b5f0726d84ab47cbab) to re-write that as well:\r\n\r\n> Worth noting that src/bench/coin_selection.cpp makes a copy of the make_hard_case function (commenting as such), so removal here may lead to confusion unless that benchmark is also updated.\r\n",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2776283405",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "labeled",
      "id": 17448870241,
      "node_id": "LE_lADOABII586v6UtWzwAAAAQQCKFh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17448870241",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T06:36:52Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 17499936110,
      "node_id": "UNLE_lADOABII586v6UtWzwAAAAQTE9Vu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17499936110",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-02T13:21:26Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17503548696,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAQTSvUY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17503548696",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9cfab3be80f0b6c927f780d0470b030a6068135c",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/9cfab3be80f0b6c927f780d0470b030a6068135c",
      "created_at": "2025-05-02T18:43:55Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17506356821,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAQTdc5V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17506356821",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "155d6d926a044826f18be4d2ad8be2dfe463eb41",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/155d6d926a044826f18be4d2ad8be2dfe463eb41",
      "created_at": "2025-05-03T01:43:12Z"
    },
    {
      "event": "ready_for_review",
      "id": 17546393666,
      "node_id": "RFRE_lADOABII586v6UtWzwAAAAQV2LhC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17546393666",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-06T23:35:32Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17581090335,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAQX6iYf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17581090335",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "447551732c999ace9587fe5462305ef1f5bb4fce",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/447551732c999ace9587fe5462305ef1f5bb4fce",
      "created_at": "2025-05-08T21:57:03Z"
    },
    {
      "event": "commented",
      "id": 2864494772,
      "node_id": "IC_kwDOABII586qvLi0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2864494772",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-08T21:57:54Z",
      "updated_at": "2025-05-08T21:57:54Z",
      "author_association": "MEMBER",
      "body": "The preceding PR https://github.com/bitcoin/bitcoin/pull/29532 got merged, so this is now ready for review.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2864494772",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "reviewed",
      "id": 2918338099,
      "node_id": "PRR_kwDOABII586t8k4z",
      "url": null,
      "actor": null,
      "commit_id": "df20dd4f905a0d04e48bfe20919cccaff11b9b30",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-11T18:48:31Z",
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2918338099",
      "submitted_at": "2025-06-11T18:48:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 2918347276,
      "node_id": "PRR_kwDOABII586t8nIM",
      "url": null,
      "actor": null,
      "commit_id": "447551732c999ace9587fe5462305ef1f5bb4fce",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-11T20:22:44Z",
      "author_association": "MEMBER",
      "body": "I think the last 2 commits \"opt: Skip evaluation of equivalent input sets\" and \"opt: Skip evaluation of equivalent input sets\" could be combined. The change the last commit makes is to the comment introduced in the commit before it, and removing a line introduced in the commit before it. We generally don't want to add code just to immediately remove it, so I think these can be squashed together.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2918347276",
      "submitted_at": "2025-06-11T20:22:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 2918744321,
      "node_id": "PRR_kwDOABII586t-IEB",
      "url": null,
      "actor": null,
      "commit_id": "447551732c999ace9587fe5462305ef1f5bb4fce",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-12T00:36:41Z",
      "author_association": "MEMBER",
      "body": "I think I addressed everything, except the issue for the follow-up.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2918744321",
      "submitted_at": "2025-06-12T00:36:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18103685884,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAQ3EFL8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18103685884",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "51ae8024175a75ff0d194d23c2e602b74bec73e1",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/51ae8024175a75ff0d194d23c2e602b74bec73e1",
      "created_at": "2025-06-12T00:37:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18120966542,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAQ4GAGO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18120966542",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "cf36d1af18f1fdb2f9846634032f468d00d7ddfb",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/cf36d1af18f1fdb2f9846634032f468d00d7ddfb",
      "created_at": "2025-06-12T18:35:39Z"
    },
    {
      "event": "commented",
      "id": 2967888161,
      "node_id": "IC_kwDOABII586w5mEh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2967888161",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-12T19:12:54Z",
      "updated_at": "2025-06-12T19:12:54Z",
      "author_association": "MEMBER",
      "body": "Ready for Review",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2967888161",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "commented",
      "id": 2972164440,
      "node_id": "IC_kwDOABII586xJ6FY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2972164440",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-14T02:58:14Z",
      "updated_at": "2025-06-14T02:58:14Z",
      "author_association": "MEMBER",
      "body": "Sorry, I forgot to reply to this comment:\r\n\r\n> I think the last 2 commits \"opt: Skip evaluation of equivalent input sets\" and \"opt: Skip evaluation of equivalent input sets\" could be combined. The change the last commit makes is to the comment introduced in the commit before it, and removing a line introduced in the commit before it. We generally don't want to add code just to immediately remove it, so I think these can be squashed together.\r\n\r\nI think of the last two commits as two separate optimizations. The idea that you only have to explore all combinations with the first of several clones in itself can use explaining. The separate step to present the realization that we can skip any UTXO that ties the predecessor on effective value due to the way the UTXO sorting is tie-broken by minimal waste seemed easier to review. The second commit also adds six more lines of documentation and shows per the test that the iteration count is further reduced. I prefer to keep them as two commits.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2972164440",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "commented",
      "id": 2972167678,
      "node_id": "IC_kwDOABII586xJ63-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2972167678",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-14T02:59:56Z",
      "updated_at": "2025-06-14T02:59:56Z",
      "author_association": "MEMBER",
      "body": "ACK cf36d1af18f1fdb2f9846634032f468d00d7ddfb",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2972167678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "review_requested",
      "id": 18144440863,
      "node_id": "RRE_lADOABII586v6UtWzwAAAAQ5fjIf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18144440863",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-14T03:00:00Z",
      "requested_reviewer": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2943855318,
      "node_id": "PRR_kwDOABII586vd6rW",
      "url": null,
      "actor": null,
      "commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-19T19:12:06Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2943855318",
      "submitted_at": "2025-06-19T19:12:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "review_requested",
      "id": 18235165678,
      "node_id": "RRE_lADOABII586v6UtWzwAAAAQ-5ovu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18235165678",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-19T19:12:08Z",
      "requested_reviewer": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2943879965,
      "node_id": "PRR_kwDOABII586veAsd",
      "url": null,
      "actor": null,
      "commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-19T19:27:49Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2943879965",
      "submitted_at": "2025-06-19T19:27:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "review_requested",
      "id": 18235303427,
      "node_id": "RRE_lADOABII586v6UtWzwAAAAQ-6KYD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18235303427",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-19T19:27:52Z",
      "requested_reviewer": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 2988989766,
      "node_id": "IC_kwDOABII586yKF1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2988989766",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-19T19:37:15Z",
      "updated_at": "2025-06-19T19:37:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think DrahtBot has had too much caffine, he keeps pinging me to review.",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2988989766",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "reviewed",
      "id": 2947044312,
      "node_id": "PRR_kwDOABII586vqFPY",
      "url": null,
      "actor": null,
      "commit_id": "cf36d1af18f1fdb2f9846634032f468d00d7ddfb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-20T18:56:40Z",
      "author_association": "MEMBER",
      "body": "Thanks for your review, @yancyribbens. I think @DrahtBot treats \"Concept ACK\" as a signal that the reviewer intends to later do a full review and will automatically ping reviewers when PRs are updated. I have no idea why it pinged you multiple times, though.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-2947044312",
      "submitted_at": "2025-06-20T18:56:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "commented",
      "id": 2993787081,
      "node_id": "IC_kwDOABII586ycZDJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2993787081",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T21:52:30Z",
      "updated_at": "2025-06-21T21:52:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Thanks for your review, @yancyribbens.\r\n\r\nSure, of course  It's on my TODO list to go over it again in more detail since I've really only done a surface level inspection so far.",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-2993787081",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "mentioned",
      "id": 18258979588,
      "node_id": "MEE_lADOABII586v6UtWzwAAAARAUesE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18258979588",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T21:52:31Z"
    },
    {
      "event": "subscribed",
      "id": 18258979599,
      "node_id": "SE_lADOABII586v6UtWzwAAAARAUesP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18258979599",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T21:52:31Z"
    },
    {
      "event": "labeled",
      "id": 18975893348,
      "node_id": "LE_lADOABII586v6UtWzwAAAARrDSdk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18975893348",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-04T18:00:43Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM4ZTE0OTAyMjM2YWNkMzg2NTNhNmQ4ZmY0ZjY5NGY2NTIwY2M4NmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38e14902236acd38653a6d8ff4f694f6520cc86e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/38e14902236acd38653a6d8ff4f694f6520cc86e",
      "tree": {
        "sha": "4b84ce6b67d4e72721c7e95bba36a6c830126dc2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4b84ce6b67d4e72721c7e95bba36a6c830126dc2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4b84ce6b67d4e72721c7e95bba36a6c830126dc2\nparent d1b583181dcc31613cd586d63329cb4c4a586972\nauthor Murch <murch@murch.one> 1743028363 -0700\ncommitter Murch <murch@murch.one> 1754352428 -0700\n\ncoinselection: Track BnB iteration count in result\n\nThe expected iteration count demonstrates how the following improvements\nreduce iterations will help catch any regressions in the future.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmiRSzEACgkQe6A1yluQ\nFxPymBAArSvs8FQkHS6aV2G52PHOLU5Vvzqkrcib0gXEJgxYgJMABE5abXf3BoI5\nadFY4rjvzM6prg3tmxSlA6x3ILeA9KrMvKpGryt1gDmnQ+amJgVtYO3xb0+5JXMe\nS41bnYUGbuEV4TonXxjy6HuBeNs4fniOrDuFUH+0/d20L+foHXex77LQHOTGNL0x\nD+6hNSeWSKfAjct0ZZSFta4n4wc/kgIDnUyw6/ZolGV1yQ9ZciRt1Hxs7akJbz9N\ng2thoHGSf9sV2goxOLaQYVzr8S0kOQ6WGZtEK++gP3hlV+pGcyRsu8jO99m/9ryT\nnPLBzGPJgiN6zUacqA9ntInodyUx7Fti/HllqjaZSrvuS7rH9vkiGHfGPdcUBsbL\nQFkMjubKqKwI1zsgxJZxX+nj0OZocWjZhKqwDDVQGEmEOoII7jEzkpXpL19DTBm2\n0VXdGPNQXqQmuYQkJoaFk4Z8Vzaw4YWwkbXfqi19UANAK5665egcLjmLiht1m44h\nkL69zUMjUB9/cnnAoUyrvFNFoks7JECYeq9QFKv0KJpLjwA5FTw3MjlLl5DbefQ4\nemTIYKhhH70XI1xzP24iUFy7CLto1prn7akp6FiEqwnTCdClC8Pg0ixuH1QSPj01\ndMU2gZZ4hkvpOzdVwZWJJXgZOuxMduZY9YdA4TAiJUdBqU7sdwg=\n=TeG4\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d1b583181dcc31613cd586d63329cb4c4a586972",
          "sha": "d1b583181dcc31613cd586d63329cb4c4a586972",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d1b583181dcc31613cd586d63329cb4c4a586972"
        }
      ],
      "message": "coinselection: Track BnB iteration count in result\n\nThe expected iteration count demonstrates how the following improvements\nreduce iterations will help catch any regressions in the future.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-08-05T00:07:08Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-26T22:32:43Z"
      },
      "sha": "38e14902236acd38653a6d8ff4f694f6520cc86e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18980519265,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAARrU71h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18980519265",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "792ed0dfe7f367fd732b2e111425591079070355",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/792ed0dfe7f367fd732b2e111425591079070355",
      "created_at": "2025-08-05T00:07:56Z"
    },
    {
      "event": "commented",
      "id": 3152850345,
      "node_id": "IC_kwDOABII58677K2p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3152850345",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T00:09:09Z",
      "updated_at": "2025-08-05T00:09:09Z",
      "author_association": "MEMBER",
      "body": "Fixed the merge conflict with #33060.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3152850345",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "unlabeled",
      "id": 18980759832,
      "node_id": "UNLE_lADOABII586v6UtWzwAAAARrV2kY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18980759832",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T00:38:51Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 18980924058,
      "node_id": "LE_lADOABII586v6UtWzwAAAARrWeqa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18980924058",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T01:01:01Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3152921236,
      "node_id": "IC_kwDOABII58677cKU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3152921236",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T01:01:03Z",
      "updated_at": "2025-08-05T01:01:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `multiprocess, i686, DEBUG`: https://github.com/bitcoin/bitcoin/runs/47377999369</sub>\n<sub>LLM reason (✨ experimental): The CI failure is caused by the failure of the \"coinselection_tests\" test.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3152921236",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18981281800,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAARrX2AI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18981281800",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "created_at": "2025-08-05T01:44:30Z"
    },
    {
      "event": "unlabeled",
      "id": 18981865863,
      "node_id": "UNLE_lADOABII586v6UtWzwAAAARraEmH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18981865863",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-05T02:44:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3103748331,
      "node_id": "PRR_kwDOABII5864_3Dr",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-10T21:12:48Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3103748331",
      "submitted_at": "2025-08-10T21:12:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3103765916,
      "node_id": "PRR_kwDOABII5864_7Wc",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-10T22:04:20Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3103765916",
      "submitted_at": "2025-08-10T22:04:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "commented",
      "id": 3172926657,
      "node_id": "IC_kwDOABII5869HwTB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3172926657",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-10T22:11:17Z",
      "updated_at": "2025-08-10T22:11:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "I reviewed this and so far it looks good.  I plan to give it one more pass over shortly to finish review.",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3172926657",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "reviewed",
      "id": 3112728323,
      "node_id": "PRR_kwDOABII5865iHcD",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:33:51Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112728323",
      "submitted_at": "2025-08-12T20:33:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3112740673,
      "node_id": "PRR_kwDOABII5865iKdB",
      "url": null,
      "actor": null,
      "commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:37:06Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112740673",
      "submitted_at": "2025-08-12T20:37:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3112752003,
      "node_id": "PRR_kwDOABII5865iNOD",
      "url": null,
      "actor": null,
      "commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:40:33Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112752003",
      "submitted_at": "2025-08-12T20:40:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3112756110,
      "node_id": "PRR_kwDOABII5865iOOO",
      "url": null,
      "actor": null,
      "commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:41:59Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112756110",
      "submitted_at": "2025-08-12T20:41:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3112762615,
      "node_id": "PRR_kwDOABII5865iPz3",
      "url": null,
      "actor": null,
      "commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:44:09Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112762615",
      "submitted_at": "2025-08-12T20:44:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3112772402,
      "node_id": "PRR_kwDOABII5865iSMy",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-12T20:47:13Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3112772402",
      "submitted_at": "2025-08-12T20:47:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "commented",
      "id": 3181000371,
      "node_id": "IC_kwDOABII5869mjaz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3181000371",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-12T20:56:13Z",
      "updated_at": "2025-08-12T21:46:45Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb\r\n\r\nI also tested the updates on secondary group of tests I wrote and there where no unexpected failures.\r\n\r\nI still have mild preference to using a loop condition of while `tries < TOTAL_TRIES` instead of while `!is_done`, and then break when done.\r\n\r\nAs for variable naming on cosmetic note, I made a note of some alternate suggestions where I feel like it's shorter and/or more concise. (just a suggestion):\r\n\r\n`curr_amount -> selected_amount`\r\n`curr_selection_waste -> selection_waste`\r\n`curr_weight -> selection_weight`\r\n`next_utxo -> next_utxo_index`\r\n`is_done -> search_complete`\r\n`should_shift -> shift`\r\n`should_cut -> cut`\r\n",
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3181000371",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "review_requested",
      "id": 19122433538,
      "node_id": "RRE_lADOABII586v6UtWzwAAAARzyS4C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19122433538",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-12T20:56:18Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3141675940,
      "node_id": "PRR_kwDOABII5867Qiuk",
      "url": null,
      "actor": null,
      "commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-21T17:26:18Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3141675940",
      "submitted_at": "2025-08-21T17:26:18Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3744733880,
      "node_id": "PRR_kwDOABII587fNBq4",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-03T11:30:08Z",
      "author_association": "NONE",
      "body": "ACK cdc25b417a\n\nRan stress tests on clone-skipping with large pools and same-effective-value UTXOs.  Sorting by effective value then waste makes the optimization correct.",
      "user": {
        "login": "8144225309",
        "id": 248271067,
        "node_id": "U_kgDODsxQ2w",
        "avatar_url": "https://avatars.githubusercontent.com/u/248271067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/8144225309",
        "html_url": "https://github.com/8144225309",
        "followers_url": "https://api.github.com/users/8144225309/followers",
        "following_url": "https://api.github.com/users/8144225309/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/8144225309/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/8144225309/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/8144225309/subscriptions",
        "organizations_url": "https://api.github.com/users/8144225309/orgs",
        "repos_url": "https://api.github.com/users/8144225309/repos",
        "events_url": "https://api.github.com/users/8144225309/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/8144225309/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3744733880",
      "submitted_at": "2026-02-03T11:30:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3747993730,
      "node_id": "PRR_kwDOABII587fZdiC",
      "url": null,
      "actor": null,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-04T21:35:56Z",
      "author_association": "MEMBER",
      "body": "> I still have mild preference to using a loop condition of while `tries < TOTAL_TRIES` instead of while `!is_done`, and then break when done.\n\nThere are two conditions how the algorithm can conclude. One, by exhausting the search space and two, by exhausting the allowed tries. Only checking tries in the outer loop would not apply to the former. The former is further discovered in a nested loop, which means that the way to extract that information from the inner loop is a flag as C++ doesn’t allow to fully break out of a nested loop.\n \n> As for variable naming on cosmetic note, I made a note of some alternate suggestions where I feel like it's shorter and/or more concise. (just a suggestion):\n> \n> `curr_amount -> selected_amount` `curr_selection_waste -> selection_waste` `curr_weight -> selection_weight` `next_utxo -> next_utxo_index` `is_done -> search_complete` `should_shift -> shift` `should_cut -> cut`\n\n`curr_…` expresses very well that it the content refers to a temporary state and not the final result, I fail to see why `next_utxo_index` would be a significant improvement, and only one of the two cases that lead to `is_done=true` indicates that the search completed, the other indicates that the search was ended prematurely due to the limit being reached. Therefore, I’ll keep the names as is. Thanks for the suggestions.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3747993730",
      "submitted_at": "2026-02-04T21:35:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFkMmVmMjZkMzZhOTM3M2JiMmU0MTIwODBkZGZmMDI5Nzg2NGZjNTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d2ef26d36a9373bb2e412080ddff0297864fc51",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1d2ef26d36a9373bb2e412080ddff0297864fc51",
      "tree": {
        "sha": "50d44a45d3918caba661972583e8c96c03c7689d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/50d44a45d3918caba661972583e8c96c03c7689d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 50d44a45d3918caba661972583e8c96c03c7689d\nparent 38e14902236acd38653a6d8ff4f694f6520cc86e\nauthor Murch <murch@murch.one> 1743031081 -0700\ncommitter Murch <murch@murch.one> 1770241406 -0800\n\ncoinselection: rewrite BnB in CoinGrinder-style\n\nIn the original implementation of BnB, the state of the search is\nbacktracked by explicitly walking back to the omission branch and then\ntesting again. This retests an equivalent candidate set as before, e.g.,\nafter backtracking from {ABC}, it would evaluate {AB_}, before trying\n{AB_D}, but {AB_} is equivalent to {AB} which was tested before.\n\nCoinGrinder tracks the state of the search instead by remembering which\nUTXO was last added and explicitly shifting from that UTXO directly to\nthe next, so after {ABC}, it will immediately move on to {AB_D}. We\nreplicate this approach here.\n\nThe description of the two optimizations is removed from the\ndocumentation as they will only be implented in a later commit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmDvX4ACgkQe6A1yluQ\nFxOo4Q/8CPFZFBPUX06krlk2gboZ42z79dCMnWYeYGpEiRX4nFPHo+0TOTjslI1L\nU69iBHErm0MerDepf3hzPYH/H359Plo+RA1eIqg8/f3vqR1BZj0kqtXFVuZLohjM\noa6RMFXhe7hKqR4V2pcKNZGePqlNKnL64o5RKzM9fFM4RYteTCyjsuBED3UcK/UA\nDBFRL2uDxx9zS6dL61m8WT5GoXEul17tq4MYJNfvsqRKJ74mIIapkl2xN90zzk+L\nIzTKCIsnrr+BMEH3HPD4nrMHiFevNgjZKdAjF2YTP6PWUEzy9SSDMi64h+lknOl+\nhtRnAnEbzSCAgFAiONranr1sJz4B5J9uDY+fNxq6nWQzRFwaCue1k3QCX3keTY/D\nsEuk/93mFQRfyvPZ0tO0CBin4XDB5q4AA5dgktM4V4kC+svK470Tb9byzdfxACTA\nJAh60/RhRqKR+HGpmLQvy74DeO8dCx7y11MXeSe3yiX5YQZS1JEk8QilzWPutpZa\nveitPs5TWXbV5J7v+ljQIYTVOGnZpMqI9bRJmE9BCtQkf93Ki1jt8dh5e0rffjLS\n+VgnB5cZwCo1tqm84Z8EFfh/GnYmFe9GVl/kx8XckV+JGk8YyVvjAXfJCbwB/Fq+\n1pVwjaMO6KdGz1ETgXjH9gaESfKSRNoLJW3xiJSkUjdmtILjMbc=\n=eBUP\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38e14902236acd38653a6d8ff4f694f6520cc86e",
          "sha": "38e14902236acd38653a6d8ff4f694f6520cc86e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/38e14902236acd38653a6d8ff4f694f6520cc86e"
        }
      ],
      "message": "coinselection: rewrite BnB in CoinGrinder-style\n\nIn the original implementation of BnB, the state of the search is\nbacktracked by explicitly walking back to the omission branch and then\ntesting again. This retests an equivalent candidate set as before, e.g.,\nafter backtracking from {ABC}, it would evaluate {AB_}, before trying\n{AB_D}, but {AB_} is equivalent to {AB} which was tested before.\n\nCoinGrinder tracks the state of the search instead by remembering which\nUTXO was last added and explicitly shifting from that UTXO directly to\nthe next, so after {ABC}, it will immediately move on to {AB_D}. We\nreplicate this approach here.\n\nThe description of the two optimizations is removed from the\ndocumentation as they will only be implented in a later commit.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-04T21:43:26Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-26T23:18:01Z"
      },
      "sha": "1d2ef26d36a9373bb2e412080ddff0297864fc51"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg4YmZmYjU3ZGNiZmYwZjVhNzc2ODIwNDZmN2Y5ZTZlMGEyNzVhMjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/88bffb57dcbff0f5a77682046f7f9e6e0a275a20",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/88bffb57dcbff0f5a77682046f7f9e6e0a275a20",
      "tree": {
        "sha": "698f959fba5225dd9bd1d4c77ff071a1daf427fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/698f959fba5225dd9bd1d4c77ff071a1daf427fd"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 698f959fba5225dd9bd1d4c77ff071a1daf427fd\nparent 1d2ef26d36a9373bb2e412080ddff0297864fc51\nauthor Murch <murch@murch.one> 1743034698 -0700\ncommitter Murch <murch@murch.one> 1770241408 -0800\n\ncoinselection: Track whether BnB completed\n\nBnB may not be able to exhaustively search all potentially interesting\ncombinations for large UTXO pools, so we keep track of whether the\nsearch was terminated by the iteration limit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmDvYAACgkQe6A1yluQ\nFxNWag/7BqoGpDyzsA1HUUU90/ES6CU8K2rvJLKaAGYdi/WLY8L5vdJNnMgKcRH1\n/Y8Q5e1b0IxXhvBqACNx6JH5npx/H5arROorHUGjg2sD9UTnds9QjettrocPNsvP\n7UCT8OPgjT1IJ2l7pSPbz+/L83ZQMf0uaaFtdHxeVSWY9a5e1mJTzLnAIJ372nre\nE+kM8z31xwdFFMf1k81r8b6lDnY6tLa+GM+CAu7X/0GQ7pBldJOGdopM3JmVGoxc\n8QbzBmxQqrrRLx6JIDxfT8dw3oN8vG88B6lfaMoQLC+Taenz+0VO7EagbbgSKht9\nG6onlAnPAQGxGEGU12BD6tco8I/z2GOTBLbK5EjUkZD3yu/brmZljIZh3x5g7TEN\nr/S/DnkQckQg6iycC4Mk27HCmSwT82+r0bZece1wdvIZX+eyxP54AuE8hCrwAoTA\n8fGuL8bGFdivpnlBJSdcGPI3I/n0ZkujY9adL8ygE3BkIUHXkwVp/rsh5r02hC20\nYW651q/JRuW3W4Po/M7BkdDZGyz1cPRUbwRCGdiV7TAtQmvdOs/AHzGlN306AG31\nepUlw69JOUquzA7b0b4WvRfIjrRouqFCTNP3ym0WSlVXxHk8jtwHmGNAl0yGhBzf\nkZ+u5J40b1KW9OwDsLQE9Qge17YrchfDlcjbieqfzPNCHvsoJno=\n=bpWz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d2ef26d36a9373bb2e412080ddff0297864fc51",
          "sha": "1d2ef26d36a9373bb2e412080ddff0297864fc51",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1d2ef26d36a9373bb2e412080ddff0297864fc51"
        }
      ],
      "message": "coinselection: Track whether BnB completed\n\nBnB may not be able to exhaustively search all potentially interesting\ncombinations for large UTXO pools, so we keep track of whether the\nsearch was terminated by the iteration limit.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-04T21:43:28Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-27T00:18:18Z"
      },
      "sha": "88bffb57dcbff0f5a77682046f7f9e6e0a275a20"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22541294915,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAU_kN1D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22541294915",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0f279f29ca03f7100bc692c0797de040a7e95878",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/0f279f29ca03f7100bc692c0797de040a7e95878",
      "created_at": "2026-02-04T21:46:15Z"
    },
    {
      "event": "commented",
      "id": 3849926151,
      "node_id": "IC_kwDOABII587leTYH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3849926151",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T21:49:52Z",
      "updated_at": "2026-02-04T22:10:21Z",
      "author_association": "MEMBER",
      "body": "I took some of the typo fixes and suggestions from @yancyribbens’s review and replied also to @brunoerg. It still cleanly merges, so I didn’t rebase (and noticed that a bit late, otherwise I would have not invalidated the ACKs).",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3849926151",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "mentioned",
      "id": 22541369613,
      "node_id": "MEE_lADOABII586v6UtWzwAAAAU_kgEN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22541369613",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T21:49:54Z"
    },
    {
      "event": "subscribed",
      "id": 22541369633,
      "node_id": "SE_lADOABII586v6UtWzwAAAAU_kgEh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22541369633",
      "actor": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T21:49:54Z"
    },
    {
      "event": "mentioned",
      "id": 22541369659,
      "node_id": "MEE_lADOABII586v6UtWzwAAAAU_kgE7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22541369659",
      "actor": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T21:49:54Z"
    },
    {
      "event": "subscribed",
      "id": 22541369670,
      "node_id": "SE_lADOABII586v6UtWzwAAAAU_kgFG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22541369670",
      "actor": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T21:49:54Z"
    },
    {
      "event": "reviewed",
      "id": 3754274831,
      "node_id": "PRR_kwDOABII587fxbAP",
      "url": null,
      "actor": null,
      "commit_id": "0f279f29ca03f7100bc692c0797de040a7e95878",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-05T03:09:30Z",
      "author_association": "NONE",
      "body": "reACK 0f279f29ca\n\nDelta is cosmetic only; retested anyway.",
      "user": {
        "login": "8144225309",
        "id": 248271067,
        "node_id": "U_kgDODsxQ2w",
        "avatar_url": "https://avatars.githubusercontent.com/u/248271067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/8144225309",
        "html_url": "https://github.com/8144225309",
        "followers_url": "https://api.github.com/users/8144225309/followers",
        "following_url": "https://api.github.com/users/8144225309/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/8144225309/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/8144225309/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/8144225309/subscriptions",
        "organizations_url": "https://api.github.com/users/8144225309/orgs",
        "repos_url": "https://api.github.com/users/8144225309/repos",
        "events_url": "https://api.github.com/users/8144225309/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/8144225309/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3754274831",
      "submitted_at": "2026-02-05T03:09:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "review_requested",
      "id": 22546012109,
      "node_id": "RRE_lADOABII586v6UtWzwAAAAU_2NfN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22546012109",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-05T03:09:36Z",
      "requested_reviewer": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3879825326,
      "node_id": "IC_kwDOABII587nQW-u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3879825326",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-10T17:58:41Z",
      "updated_at": "2026-02-10T17:58:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3879825326",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22693255003,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAVIn5db",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22693255003",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "17fd74a1505900897c6e3f42166895c621271d06",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/17fd74a1505900897c6e3f42166895c621271d06",
      "created_at": "2026-02-11T04:46:27Z"
    },
    {
      "event": "commented",
      "id": 3882090511,
      "node_id": "IC_kwDOABII587nZAAP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3882090511",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-11T04:46:47Z",
      "updated_at": "2026-02-11T04:46:47Z",
      "author_association": "MEMBER",
      "body": "Fixed the two typos surfaced by the linter.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3882090511",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUxZDk5YzgwNGMxMTE0OTgyY2MwNWNhMTU3MTg0ODIwMGI1NjAzNTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e1d99c804c1114982cc05ca1571848200b560356",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d99c804c1114982cc05ca1571848200b560356",
      "tree": {
        "sha": "1a871b7d6d5a8d575423338845d2c678cb4b5973",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1a871b7d6d5a8d575423338845d2c678cb4b5973"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1a871b7d6d5a8d575423338845d2c678cb4b5973\nparent 88bffb57dcbff0f5a77682046f7f9e6e0a275a20\nauthor Murch <murch@murch.one> 1743038247 -0700\ncommitter Murch <murch@murch.one> 1770789836 -0800\n\ncoinselection: BnB skip exploring high waste\n\nAt high feerates adding more inputs will increase the waste score. If\nthe current waste is already higher than the best selection’s we cannot\nimprove upon the best selection. All solutions that include the current\nselection with more additional inputs must be worse than the best\nselection so far: SHIFT\n\nThis optimization only works at high feerates, because at low feerates,\nadding more inputs decreases waste, so this condition would exit\nprematurely. We would never attempt input sets with higher weight than\nthe prior best selection, even though we would prefer those at low\nfeerates.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmMG80ACgkQe6A1yluQ\nFxOtcRAAn27PLW46l3v/J33UGjJIVEe7+lk4eHamMmfC77xmhzZAbB+ivzHe7Jop\nfXuqi3PPThBpWI07KKQ+dmB0/v2fs1NIFWbpH5Vy5a30oa0t5pWKEFmBcqnLR9pb\nkbavL20YnwMnibSjMlH42Kgq0JExtWZnLx0aFs6hPdjS6gMFtrV7BOC1PTGszJ/+\nzErEDpPPd7Uj9mmdLBXFwk/vL9zhCYdwI2jyiKS4/b25s+SSb3Qb6qUELv1Fx6vV\nn2joMwvAzGuiaeEGSAVDr1jSw1RRYyf6XMmsRjRVPBuHJZcgY3Wv9iO4xXfAJKJj\nWIKGiRFnUSdHMgECo2Fc5D4iG4vdLtMmueGHMdehz7pT48RW75pB+/UuezFrlq9D\ntHl2dOKFk7bsJfXECRsqBpAQuBLDhqZDUj8NqYISMbLXrhGoFFb2Jn6Qp39/b2Qb\nR+S//URmrcIW1yLvNqwd/iekCDzn93RIWA6Eed5JdaQHnxD34TGo/7vJ+yfqPkQ+\nuXIIsKV53PiEUCUDFexb2EfzyOLgPIhWPy2EV9Q2e3G6je0YEmRQlpv1nMTKDZyv\n03ROy7fcnS6dBRs3OQRlbMQEiRMZmPyrNgfMmcygsQ+3NVpuJpRqFIgGvyfYO/He\nWcihinj4IBd37OIZPX75wqEiFIC6NqLeyx2Mbmv9jLbvUUj3hlI=\n=ae0b\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/88bffb57dcbff0f5a77682046f7f9e6e0a275a20",
          "sha": "88bffb57dcbff0f5a77682046f7f9e6e0a275a20",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/88bffb57dcbff0f5a77682046f7f9e6e0a275a20"
        }
      ],
      "message": "coinselection: BnB skip exploring high waste\n\nAt high feerates adding more inputs will increase the waste score. If\nthe current waste is already higher than the best selection’s we cannot\nimprove upon the best selection. All solutions that include the current\nselection with more additional inputs must be worse than the best\nselection so far: SHIFT\n\nThis optimization only works at high feerates, because at low feerates,\nadding more inputs decreases waste, so this condition would exit\nprematurely. We would never attempt input sets with higher weight than\nthe prior best selection, even though we would prefer those at low\nfeerates.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-11T06:03:56Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-27T01:17:27Z"
      },
      "sha": "e1d99c804c1114982cc05ca1571848200b560356"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdhMDA4NzY0NDdjZjlmYTI4MTMyZWU0YjY4MGZkZGMwMzM4ODEyN2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a00876447cf9fa28132ee4b680fddc03388127c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7a00876447cf9fa28132ee4b680fddc03388127c",
      "tree": {
        "sha": "3396b92b36db116fcace14dcf6a7924ffedd49c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3396b92b36db116fcace14dcf6a7924ffedd49c7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3396b92b36db116fcace14dcf6a7924ffedd49c7\nparent e1d99c804c1114982cc05ca1571848200b560356\nauthor Murch <murch@murch.one> 1743038662 -0700\ncommitter Murch <murch@murch.one> 1770789839 -0800\n\ncoinselection: Track effective_value lookahead\n\nIntroduces a dedicated data structure to track the total\neffective_value available in the remaining UTXOs at each index of the\nUTXO pool. In contrast to the original approach in BnB, this allows us\nto immediately jump to a lower index instead of visiting every UTXO to\nadd back their eff_value to the lookahead.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmMG88ACgkQe6A1yluQ\nFxMxeRAA2mmyObmdYcMsXCcc7I/4Dawba8tys1mtMzBF7RWd9kSAak2FGyfa3UgL\nk8cnBzYb8D2S9KdMWrDvhe/ABLQwP1PeiVN1BCQh/FNWn/8wo+GbyATdU2cBpc8b\n8Kf+gQuzu5iTKvaTLtQIYcafhzIe3errzZu4FHzqaseHDooOmh1ix08o0xlnebo0\nR+mq5GAI/s+6Ksvjvv+HKrt++wyIIobCaAu8J7chXeffKHvmr4B7p7Nyn7Puljko\nOGPYrOszljJaE5yrTXCutWX4KLzzImViU2BR11u64DtkwyxHFGDB7rP4a9DsfVT9\nsyEwRTyJb5F3FXwSwlErXxqIq5mc6EVmjqFKBw5w9ScGZezS/npPxKdVvskMmzZZ\nYpnnZJ92MvxkpF2s692YC6AGqVlFg/49+AC+tC+eXHzyohRDxDet5ZyDT4Yee6GA\n02/fmvacJBOx4s+L02UjLJJ1k0MD/TFD7zuo5AA2nEFbD/dp30r61B8fXsSXAna+\nBrLm5Y/V75rAcWIg/lLevvmIClTr41GF0e26ZlsH2sq0haL/i4GxeT2SLfgB0kbx\n3aHUUeCkEj6d8poNvDmRmZ3BcmIKjHiO1irIDAALiOXCRmhyH27ssyG8VEujKqvn\nVjxgTPbL+nTsf8Kwb4UvBwL5FY6mfaCXfXPwogcWsc1KCgLDbvM=\n=f/Wu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e1d99c804c1114982cc05ca1571848200b560356",
          "sha": "e1d99c804c1114982cc05ca1571848200b560356",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e1d99c804c1114982cc05ca1571848200b560356"
        }
      ],
      "message": "coinselection: Track effective_value lookahead\n\nIntroduces a dedicated data structure to track the total\neffective_value available in the remaining UTXOs at each index of the\nUTXO pool. In contrast to the original approach in BnB, this allows us\nto immediately jump to a lower index instead of visiting every UTXO to\nadd back their eff_value to the lookahead.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-11T06:03:59Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-27T01:24:22Z"
      },
      "sha": "7a00876447cf9fa28132ee4b680fddc03388127c"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22694315058,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAVIr8Qy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22694315058",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "created_at": "2026-02-11T06:07:28Z"
    },
    {
      "event": "reviewed",
      "id": 3787608841,
      "node_id": "PRR_kwDOABII587hwlMJ",
      "url": null,
      "actor": null,
      "commit_id": "67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-11T21:38:32Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3787608841",
      "submitted_at": "2026-02-11T21:38:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "reviewed",
      "id": 3788218793,
      "node_id": "PRR_kwDOABII587hy6Gp",
      "url": null,
      "actor": null,
      "commit_id": "67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-12T00:55:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b\n\nThe rewrite restructures BnB into the CUT/SHIFT/EXPLORE pattern already used by CoinGrinder, making the two algorithms consistent and easier to maintain.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#pullrequestreview-3788218793",
      "submitted_at": "2026-02-12T00:55:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
    },
    {
      "event": "review_requested",
      "id": 22720536649,
      "node_id": "RRE_lADOABII586v6UtWzwAAAAVKP-BJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22720536649",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T00:55:56Z",
      "requested_reviewer": {
        "login": "8144225309",
        "id": 248271067,
        "node_id": "U_kgDODsxQ2w",
        "avatar_url": "https://avatars.githubusercontent.com/u/248271067?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/8144225309",
        "html_url": "https://github.com/8144225309",
        "followers_url": "https://api.github.com/users/8144225309/followers",
        "following_url": "https://api.github.com/users/8144225309/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/8144225309/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/8144225309/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/8144225309/subscriptions",
        "organizations_url": "https://api.github.com/users/8144225309/orgs",
        "repos_url": "https://api.github.com/users/8144225309/repos",
        "events_url": "https://api.github.com/users/8144225309/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/8144225309/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcwMjZmMTY2NDdkYWJkMTJiYWZlMjRhZjkyMmQzY2E1OGY3OGZhMWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7026f16647dabd12bafe24af922d3ca58f78fa1f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7026f16647dabd12bafe24af922d3ca58f78fa1f",
      "tree": {
        "sha": "4e665b2b8536d5b7131057ca3026318a6b953b50",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e665b2b8536d5b7131057ca3026318a6b953b50"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4e665b2b8536d5b7131057ca3026318a6b953b50\nparent 7a00876447cf9fa28132ee4b680fddc03388127c\nauthor Murch <murch@murch.one> 1743039981 -0700\ncommitter Murch <murch@murch.one> 1771376928 -0800\n\nopt: Skip evaluation of equivalent input sets\n\nWhen two successive UTXOs match in effective value and weight, we can\nskip the second if the prior is not selected: adding it would create an\nequivalent input set to a previously evaluated.\n\nE.g. if we have three UTXOs with effective values {5, 3, 3} of the same\nweight each, we want to evaluate\n{5, _, _}, {5, 3, _}, {5, 3, 3}, {_, 3, _}, {_, 3, 3},\nbut skip {5, _, 3}, and {_, _, 3}, because the first 3 is not selected,\nand we therefore do not need to evaluate the second 3 at the same\nposition in the input set.\n\nIf we reach the end of the branch, we must SHIFT the previously selected\nUTXO group instead.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmVESEACgkQe6A1yluQ\nFxNcAA//f4MSLofRzGosyGDTp/+oUCDQefHZA3TT+5bXMt4NeHQPnltfXbpCMDrs\n3WX+3/OgzieWjGdVH4A4IeGN1qGiY9uCAhP8ql0dxrDlMZakv6cSQiAnPQ9AQbBc\nH5zvP524KQuSO/UmSJ7DBbXt+OsC3tKLHWlOYYWTyDP+zKhq/x/Vxcg1y3qA/a/g\n91Es3PDYGezE/0zR6A6ywUxsearKlryqyF/Bgykrkcj61JbWaUrVA45/LD6WEzoQ\nA1jA7tVy/eFE+EOwCNImhQ8IrIvSuC7EDct8ioYQ6IQkhb5y0Av9O3gZhAkX8o6E\nO8DrIQUh2cNxixiRdc5zWB1zuy4vnl3FT64iWT6Jz15GFaY0L0uzVtVgidIQAkzV\nnWv3/If+l3PV3DghXORqR2aqQzi/ClrsrcWxXW1f6awvuokIrV0+WFUJmkiNEXN4\n+vMTa2dJh1KohOG4tSJJq/JrxnB52EswApRVNCMH1XQaD3gMkjGKZMMd0Va3ex8x\nfpl6XZ8Frm+SmjeDDq/8Eyqw68zaXmPW+tkK43BJZooafSUQoj0ACik6uAtYzBAr\nlAyFSQky2ZgoEQmI9FVN2dzx7cal7oRFGCpclTMPA47sMZxN+eb23GW/TepuRATO\nqbZdYIRr1OFleMrIPE7pA0/KJVA4rsZJ5CZXmURPMC5c3CYnikU=\n=NwoN\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a00876447cf9fa28132ee4b680fddc03388127c",
          "sha": "7a00876447cf9fa28132ee4b680fddc03388127c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7a00876447cf9fa28132ee4b680fddc03388127c"
        }
      ],
      "message": "opt: Skip evaluation of equivalent input sets\n\nWhen two successive UTXOs match in effective value and weight, we can\nskip the second if the prior is not selected: adding it would create an\nequivalent input set to a previously evaluated.\n\nE.g. if we have three UTXOs with effective values {5, 3, 3} of the same\nweight each, we want to evaluate\n{5, _, _}, {5, 3, _}, {5, 3, 3}, {_, 3, _}, {_, 3, 3},\nbut skip {5, _, 3}, and {_, _, 3}, because the first 3 is not selected,\nand we therefore do not need to evaluate the second 3 at the same\nposition in the input set.\n\nIf we reach the end of the branch, we must SHIFT the previously selected\nUTXO group instead.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-18T01:08:48Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-27T01:46:21Z"
      },
      "sha": "7026f16647dabd12bafe24af922d3ca58f78fa1f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZlMDdhZmFmZWZlOTlkZDk5OTRiNDk3MDRjMzQ0NzcxMDZiZTJhZDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe07afafefe99dd9994b49704c34477106be2ad1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fe07afafefe99dd9994b49704c34477106be2ad1",
      "tree": {
        "sha": "a91d26b83ef036faa879a3dea46bb338efd20a0f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a91d26b83ef036faa879a3dea46bb338efd20a0f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a91d26b83ef036faa879a3dea46bb338efd20a0f\nparent 7026f16647dabd12bafe24af922d3ca58f78fa1f\nauthor Murch <murch@murch.one> 1743040770 -0700\ncommitter Murch <murch@murch.one> 1771376975 -0800\n\nopt: Skip UTXOs with worse waste, same eff_value\n\nWhen two successive UTXOs differ in waste but match in effective value,\nwe can skip the second if the first is not selected, because all input\nsets we can generate by swapping out a less wasteful UTXOs with a more\nwastefull UTXO of matching effective value would be strictly worse.\n\nAlso expand documentation of Branch and Bound.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEENfStpiPrn+OjvH72e6A1yluQFxMFAmmVEVAACgkQe6A1yluQ\nFxMyoA//XaTFlaMO0q8tOYkdjr48zjqvJ8VOidm2JJ9QwGgPWYPS/lO5yneKspu/\nTMAk+pS+KGKp64wiYlN8xXc7wqGYSN1HPIvhMnISm2YtUpzu3sIxqI/tuyRfemP4\nfzsEolGE1Wu7UgzYg318vx4tQYh7aby3PDwceT4MDMjL5gIQZ2u/bjjlbnXEJ3kT\n92psPN80C1Y77l8JSUcYTtojE8JNXT7PWaUcIrpBTa0jjtBgmfwa4YddeHLSvSE6\netuM76mZeWHgjrojsDrgVw5tRkL9NHQsQtc8wb/y7vVg2LeSvqZQ1IrVPUTgvO18\nZ6/wG8r8dt8aKC5OfIhU+Pbs0j+nT4QRn67qH0Uq+rdxmHqniGQezB9PmMwd8px3\n/6FwN+vQrC7XztDNYKHKT8WmM4Y4IDL6zdek5Ie+Sr8FHiACRZ3aISN/NjHYWFOL\nUkPpfPfDCifZc8BynRvRuDA6LFzUBLHwNZ6M/leCVjxerVB3lgD8VZRZv4+fNoru\nYlCQf/grd2c+sBRmA8rIcR2MytAPEMlZxP8epWydTC0ntBJyZkHh0qX7laOeYFeI\neKwq/6wLKwq2vNhezkH1mBVuh3aA8Dr5d0zTnG+hMepeR0Kbg9LcuBSqa3EwXBBI\nM1bRy9GW389SmazQHZR8LkdRc6PjtyHbOqQfk3I/iTXCOf1+sZQ=\n=Xc8o\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7026f16647dabd12bafe24af922d3ca58f78fa1f",
          "sha": "7026f16647dabd12bafe24af922d3ca58f78fa1f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7026f16647dabd12bafe24af922d3ca58f78fa1f"
        }
      ],
      "message": "opt: Skip UTXOs with worse waste, same eff_value\n\nWhen two successive UTXOs differ in waste but match in effective value,\nwe can skip the second if the first is not selected, because all input\nsets we can generate by swapping out a less wasteful UTXOs with a more\nwastefull UTXO of matching effective value would be strictly worse.\n\nAlso expand documentation of Branch and Bound.",
      "committer": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2026-02-18T01:09:35Z"
      },
      "author": {
        "name": "Murch",
        "email": "murch@murch.one",
        "date": "2025-03-27T01:59:30Z"
      },
      "sha": "fe07afafefe99dd9994b49704c34477106be2ad1"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22869480234,
      "node_id": "HRFPE_lADOABII586v6UtWzwAAAAVTIJMq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22869480234",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "commit_url": "https://api.github.com/repos/murchandamus/bitcoin/commits/fe07afafefe99dd9994b49704c34477106be2ad1",
      "created_at": "2026-02-18T01:09:57Z"
    },
    {
      "event": "commented",
      "id": 3917913577,
      "node_id": "IC_kwDOABII587php3p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3917913577",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-18T01:10:47Z",
      "updated_at": "2026-02-18T01:10:47Z",
      "author_association": "MEMBER",
      "body": "Added the boundary check proposed by @w0xlt. Thanks for the review.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#issuecomment-3917913577",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32150"
    },
    {
      "event": "mentioned",
      "id": 22869491706,
      "node_id": "MEE_lADOABII586v6UtWzwAAAAVTIL_6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22869491706",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-18T01:10:49Z"
    },
    {
      "event": "subscribed",
      "id": 22869491725,
      "node_id": "SE_lADOABII586v6UtWzwAAAAVTIMAN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22869491725",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-18T01:10:49Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2023537613",
      "pull_request_review_id": 2733815682,
      "id": 2023537613,
      "node_id": "PRRC_kwDOABII5854nLvN",
      "diff_hunk": "@@ -130,14 +130,14 @@ BOOST_AUTO_TEST_CASE(bnb_test)\n     AddCoins(utxo_pool, {1 * CENT, 3 * CENT, 5 * CENT});\n \n     // Simple success cases\n-    TestBnBSuccess(\"Select smallest UTXO\", utxo_pool, /*selection_target=*/1 * CENT, /*expected_input_amounts=*/{1 * CENT}, /*expected_attempts=*/6);\n-    TestBnBSuccess(\"Select middle UTXO\", utxo_pool, /*selection_target=*/3 * CENT, /*expected_input_amounts=*/{3 * CENT}, /*expected_attempts=*/4);\n-    TestBnBSuccess(\"Select biggest UTXO\", utxo_pool, /*selection_target=*/5 * CENT, /*expected_input_amounts=*/{5 * CENT}, /*expected_attempts=*/2);\n-    TestBnBSuccess(\"Select two UTXOs\", utxo_pool, /*selection_target=*/4 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT}, /*expected_attempts=*/6);\n-    TestBnBSuccess(\"Select all UTXOs\", utxo_pool, /*selection_target=*/9 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT, 5 * CENT}, /*expected_attempts=*/6);\n+    TestBnBSuccess(\"Select smallest UTXO\", utxo_pool, /*selection_target=*/1 * CENT, /*expected_input_amounts=*/{1 * CENT}, /*expected_attempts=*/3);",
      "path": "src/wallet/test/coinselection_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "d765ba9ae567cf3192706223d873d041f71f9c82",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nice, it looks like the backtrack iterations are no longer recorded which effectively makes this probably more of an optimization than a refactor.  Now it's possible more solutions can be found since the number of times the loop will run is effectively more improving search resolution.  May be worth adding a note of that to the commit message.",
      "created_at": "2025-04-01T19:12:26Z",
      "updated_at": "2025-04-01T19:12:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2023537613",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2023537613"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2023709366",
      "pull_request_review_id": 2734099039,
      "id": 2023709366,
      "node_id": "PRRC_kwDOABII5854n1q2",
      "diff_hunk": "@@ -130,14 +130,14 @@ BOOST_AUTO_TEST_CASE(bnb_test)\n     AddCoins(utxo_pool, {1 * CENT, 3 * CENT, 5 * CENT});\n \n     // Simple success cases\n-    TestBnBSuccess(\"Select smallest UTXO\", utxo_pool, /*selection_target=*/1 * CENT, /*expected_input_amounts=*/{1 * CENT}, /*expected_attempts=*/6);\n-    TestBnBSuccess(\"Select middle UTXO\", utxo_pool, /*selection_target=*/3 * CENT, /*expected_input_amounts=*/{3 * CENT}, /*expected_attempts=*/4);\n-    TestBnBSuccess(\"Select biggest UTXO\", utxo_pool, /*selection_target=*/5 * CENT, /*expected_input_amounts=*/{5 * CENT}, /*expected_attempts=*/2);\n-    TestBnBSuccess(\"Select two UTXOs\", utxo_pool, /*selection_target=*/4 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT}, /*expected_attempts=*/6);\n-    TestBnBSuccess(\"Select all UTXOs\", utxo_pool, /*selection_target=*/9 * CENT, /*expected_input_amounts=*/{1 * CENT, 3 * CENT, 5 * CENT}, /*expected_attempts=*/6);\n+    TestBnBSuccess(\"Select smallest UTXO\", utxo_pool, /*selection_target=*/1 * CENT, /*expected_input_amounts=*/{1 * CENT}, /*expected_attempts=*/3);",
      "path": "src/wallet/test/coinselection_tests.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "d765ba9ae567cf3192706223d873d041f71f9c82",
      "in_reply_to_id": 2023537613,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, I renamed the PR and added more explanation to the opening comment.",
      "created_at": "2025-04-01T21:35:46Z",
      "updated_at": "2025-04-01T21:35:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2023709366",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2023709366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140854993",
      "pull_request_review_id": 2918338099,
      "id": 2140854993,
      "node_id": "PRRC_kwDOABII585_mtrR",
      "diff_hunk": "@@ -210,6 +211,9 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n         const auto result9 = SelectCoinsBnB(GroupCoins(available_coins.All()), 1 * CENT, coin_selection_params_bnb.m_cost_of_change);\n         BOOST_CHECK(result9);\n         BOOST_CHECK_EQUAL(result9->GetSelectedValue(), 1 * CENT);\n+        // Demonstrate how following improvements reduce iteration count and catch any regressions in the future.",
      "path": "src/wallet/test/coinselector_tests.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "df20dd4f905a0d04e48bfe20919cccaff11b9b30",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In df20dd4f905a0d04e48bfe20919cccaff11b9b30 \"coinselection: Track BnB iteration count in result\"\r\n\r\nThis kind of comment belongs in the commit message, not the code.",
      "created_at": "2025-06-11T18:48:31Z",
      "updated_at": "2025-06-11T18:48:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140854993",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140854993"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140860995",
      "pull_request_review_id": 2918347276,
      "id": 2140860995,
      "node_id": "PRRC_kwDOABII585_mvJD",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 66,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\ns/section/selection",
      "created_at": "2025-06-11T18:52:12Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140860995",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140860995"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140951729",
      "pull_request_review_id": 2918347276,
      "id": 2140951729,
      "node_id": "PRRC_kwDOABII585_nFSx",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 190,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\n`should_cut` is not used after this, there is no need to reset it.",
      "created_at": "2025-06-11T19:54:09Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140951729",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140951729"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140952030",
      "pull_request_review_id": 2918347276,
      "id": 2140952030,
      "node_id": "PRRC_kwDOABII585_nFXe",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        if (should_shift) {\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                break;\n             }\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 203,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\n`should_shift` is not used after this, there is no need to reset it.",
      "created_at": "2025-06-11T19:54:21Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140952030",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140952030"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140957548",
      "pull_request_review_id": 2918347276,
      "id": 2140957548,
      "node_id": "PRRC_kwDOABII585_nGts",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        if (should_shift) {\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 196,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\nThis comment should be after the `if`",
      "created_at": "2025-06-11T19:58:28Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140957548",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140957548"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140964773",
      "pull_request_review_id": 2918347276,
      "id": 2140964773,
      "node_id": "PRRC_kwDOABII585_nIel",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        if (should_shift) {\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                break;\n             }\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;\n         }\n     }\n \n-    // Check for solution\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    result.SetSelectionsEvaluated(curr_try);\n+\n     if (best_selection.empty()) {\n         return max_tx_weight_exceeded ? ErrorMaxWeightExceeded() : util::Error();\n     }\n \n-    // Set output set\n     for (const size_t& i : best_selection) {\n         result.AddInput(utxo_pool.at(i));\n     }\n-    result.RecalculateWaste(cost_of_change, cost_of_change, CAmount{0});\n-    assert(best_waste == result.GetWaste());",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 220,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\nWhy is the waste calculation being dropped? `result` will be returned with an incorrect waste value.",
      "created_at": "2025-06-11T20:03:42Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140964773",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140964773"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140968745",
      "pull_request_review_id": 2918347276,
      "id": 2140968745,
      "node_id": "PRRC_kwDOABII585_nJcp",
      "diff_hunk": "@@ -157,6 +158,9 @@ util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool\n         } else if (curr_amount > selection_target + cost_of_change) {\n             // Overshot target range: SHIFT\n             should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "813ac54726866b1051c502fe8bfef3b279af890f",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 813ac54726866b1051c502fe8bfef3b279af890f \"coinselection: BnB skip exploring high waste\"\r\n\r\nWhy does this optimization only work at high feerates?",
      "created_at": "2025-06-11T20:06:38Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140968745",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140968745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140974454",
      "pull_request_review_id": 2918347276,
      "id": 2140974454,
      "node_id": "PRRC_kwDOABII585_nK12",
      "diff_hunk": "@@ -93,20 +93,25 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    // Check that there are sufficient funds\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n     CAmount total_available = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert UTXOs with non-positive effective value have been filtered\n-        Assume(utxo.GetSelectionAmount() > 0);\n-        total_available += utxo.GetSelectionAmount();\n+    for (size_t i = 0; i < utxo_pool.size(); ++i) {\n+        size_t index = utxo_pool.size() - 1 - i; // Loop over every element in reverse order",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "6ff6e98000792f715324c513fd9eb83440929d0e",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 6ff6e98000792f715324c513fd9eb83440929d0e \"coinselection: Track effective_value lookahead\"\r\n\r\nDo the reversing in the `for`\r\n\r\n```suggestion\r\n    for (size_t i = utxo_pool.size() - 1; i >= 0; --i) {\r\n```",
      "created_at": "2025-06-11T20:10:26Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140974454",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140974454"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140979272",
      "pull_request_review_id": 2918347276,
      "id": 2140979272,
      "node_id": "PRRC_kwDOABII585_nMBI",
      "diff_hunk": "@@ -68,9 +68,9 @@ struct {\n  *\n  * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n  *\n- * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n+ * The algorithm uses two additional optimizations. A lookahead (tk) keeps track of the total value of",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 19,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\nWhat is `(tk)` mean?",
      "created_at": "2025-06-11T20:13:47Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140979272",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140979272"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140979521",
      "pull_request_review_id": 2918347276,
      "id": 2140979521,
      "node_id": "PRRC_kwDOABII585_nMFB",
      "diff_hunk": "@@ -68,9 +68,9 @@ struct {\n  *\n  * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n  *\n- * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n+ * The algorithm uses two additional optimizations. A lookahead (tk) keeps track of the total value of\n  * the unexplored UTXOs. A subtree is not explored if the lookahead indicates that the target range\n- * cannot be reached. Further, it is unnecessary to test equivalent combinations. This allows us\n+ * cannot be reached. Further, it is unnecessary to test equivalent combinations (tk). This allows us",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\nWhat is `(tk)` mean?",
      "created_at": "2025-06-11T20:13:57Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140979521",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140979521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140980302",
      "pull_request_review_id": 2918347276,
      "id": 2140980302,
      "node_id": "PRRC_kwDOABII585_nMRO",
      "diff_hunk": "@@ -68,7 +68,7 @@ struct {\n  *\n  * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n  *\n- * The algorithm uses two additional optimizations. A lookahead (tk) keeps track of the total value of",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "6ff6e98000792f715324c513fd9eb83440929d0e",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 6ff6e98000792f715324c513fd9eb83440929d0e \"coinselection: Track effective_value lookahead\"\r\n\r\nThis should be squashed into 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"",
      "created_at": "2025-06-11T20:14:26Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140980302",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140980302"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140980901",
      "pull_request_review_id": 2918347276,
      "id": 2140980901,
      "node_id": "PRRC_kwDOABII585_nMal",
      "diff_hunk": "@@ -70,7 +70,7 @@ struct {\n  *\n  * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n  * the unexplored UTXOs. A subtree is not explored if the lookahead indicates that the target range\n- * cannot be reached. Further, it is unnecessary to test equivalent combinations (tk). This allows us",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "ee103e5df91ecd8aa80da7da709b7d51eee65738",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"\r\n\r\nThis should be squashed into 9580c0e49030f13fe57603521b59b96e6e50cf82 \"coinselection: rewrite BnB in CoinGrinder-style\"",
      "created_at": "2025-06-11T20:14:48Z",
      "updated_at": "2025-06-11T20:22:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2140980901",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2140980901"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141115258",
      "pull_request_review_id": 2918744321,
      "id": 2141115258,
      "node_id": "PRRC_kwDOABII585_ntN6",
      "diff_hunk": "@@ -210,6 +211,9 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n         const auto result9 = SelectCoinsBnB(GroupCoins(available_coins.All()), 1 * CENT, coin_selection_params_bnb.m_cost_of_change);\n         BOOST_CHECK(result9);\n         BOOST_CHECK_EQUAL(result9->GetSelectedValue(), 1 * CENT);\n+        // Demonstrate how following improvements reduce iteration count and catch any regressions in the future.",
      "path": "src/wallet/test/coinselector_tests.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "df20dd4f905a0d04e48bfe20919cccaff11b9b30",
      "in_reply_to_id": 2140854993,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, I removed the repeated comment and added an explanation to the commit message instead.",
      "created_at": "2025-06-11T21:06:59Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141115258",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141115258"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141138034",
      "pull_request_review_id": 2918744321,
      "id": 2141138034,
      "node_id": "PRRC_kwDOABII585_nyxy",
      "diff_hunk": "@@ -68,9 +68,9 @@ struct {\n  *\n  * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n  *\n- * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n+ * The algorithm uses two additional optimizations. A lookahead (tk) keeps track of the total value of",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 19,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": 2140979272,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\"tk\" is a symbol for \"to come\" in drafting articles. My idea was to express that these two optimizations are not in this first commit, but will be implemented in the coming PRs. On second thought, I removed these sentences and will reintroduce with the commits that introduce the described optimizations.",
      "created_at": "2025-06-11T21:20:16Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141138034",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141138034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141161172",
      "pull_request_review_id": 2918744321,
      "id": 2141161172,
      "node_id": "PRRC_kwDOABII585_n4bU",
      "diff_hunk": "@@ -68,9 +68,9 @@ struct {\n  *\n  * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n  *\n- * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n+ * The algorithm uses two additional optimizations. A lookahead (tk) keeps track of the total value of\n  * the unexplored UTXOs. A subtree is not explored if the lookahead indicates that the target range\n- * cannot be reached. Further, it is unnecessary to test equivalent combinations. This allows us\n+ * cannot be reached. Further, it is unnecessary to test equivalent combinations (tk). This allows us",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": 2140979521,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Responded above.",
      "created_at": "2025-06-11T21:40:30Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141161172",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141161172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141164370",
      "pull_request_review_id": 2918744321,
      "id": 2141164370,
      "node_id": "PRRC_kwDOABII585_n5NS",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 190,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": 2140951729,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Removed",
      "created_at": "2025-06-11T21:43:17Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141164370",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141164370"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141164846",
      "pull_request_review_id": 2918744321,
      "id": 2141164846,
      "node_id": "PRRC_kwDOABII585_n5Uu",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        if (should_shift) {\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                break;\n             }\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 203,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": 2140952030,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Removed",
      "created_at": "2025-06-11T21:43:38Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141164846",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141164846"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141269177",
      "pull_request_review_id": 2918744321,
      "id": 2141269177,
      "node_id": "PRRC_kwDOABII585_oSy5",
      "diff_hunk": "@@ -157,6 +158,9 @@ util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool\n         } else if (curr_amount > selection_target + cost_of_change) {\n             // Overshot target range: SHIFT\n             should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "813ac54726866b1051c502fe8bfef3b279af890f",
      "in_reply_to_id": 2140968745,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "At high feerates adding more inputs will increase the waste score. If the current waste is already worse than the best selection’s while we have insufficient funds, we cannot beat the best selection by adding more inputs: SHIFT\r\n\r\nAt low feerates, adding more inputs decreases waste, so we would exit prematurely.",
      "created_at": "2025-06-11T23:38:47Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141269177",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141269177"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141280726",
      "pull_request_review_id": 2918744321,
      "id": 2141280726,
      "node_id": "PRRC_kwDOABII585_oVnW",
      "diff_hunk": "@@ -93,20 +93,25 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    // Check that there are sufficient funds\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n     CAmount total_available = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert UTXOs with non-positive effective value have been filtered\n-        Assume(utxo.GetSelectionAmount() > 0);\n-        total_available += utxo.GetSelectionAmount();\n+    for (size_t i = 0; i < utxo_pool.size(); ++i) {\n+        size_t index = utxo_pool.size() - 1 - i; // Loop over every element in reverse order",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "6ff6e98000792f715324c513fd9eb83440929d0e",
      "in_reply_to_id": 2140974454,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Taken with minor adjustments.",
      "created_at": "2025-06-11T23:55:09Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141280726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141280726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141309011",
      "pull_request_review_id": 2918744321,
      "id": 2141309011,
      "node_id": "PRRC_kwDOABII585_ochT",
      "diff_hunk": "@@ -93,114 +93,129 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current section, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            should_cut = false;\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        if (should_shift) {\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                break;\n             }\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;\n         }\n     }\n \n-    // Check for solution\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    result.SetSelectionsEvaluated(curr_try);\n+\n     if (best_selection.empty()) {\n         return max_tx_weight_exceeded ? ErrorMaxWeightExceeded() : util::Error();\n     }\n \n-    // Set output set\n     for (const size_t& i : best_selection) {\n         result.AddInput(utxo_pool.at(i));\n     }\n-    result.RecalculateWaste(cost_of_change, cost_of_change, CAmount{0});\n-    assert(best_waste == result.GetWaste());",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 220,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "9580c0e49030f13fe57603521b59b96e6e50cf82",
      "in_reply_to_id": 2140964773,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The waste calculation here is semantically incorrect and it is unnecessary, because the waste of all coin selection results is recalculated after they are collected, before they are compared to correctly assess bump fees.\r\n\r\nI don’t think we want to pull the bump fee calculation into each coin selection algorithm, but maybe we can pass the entire coin selection parameters object, so that we can calculate a semantically correct waste score for coin selection results, although it may still need to be amended for bump fees afterwards.\r\n\r\nLet’s fix this in a follow-up properly. And also add some tests for the waste results of coin selection algorithms.",
      "created_at": "2025-06-12T00:35:18Z",
      "updated_at": "2025-06-12T00:36:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2141309011",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141309011"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157539079",
      "pull_request_review_id": 2943855318,
      "id": 2157539079,
      "node_id": "PRRC_kwDOABII586AmW8H",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Is there some rhyme or reason behind the refactor of the variable name here?  I probably would have put that into a different commit personally.  I prefer also just dropping `curr_` although I notice this is done seemingly at random since there are other variables such as `curr_selection_waste` where the original name was maintained?",
      "created_at": "2025-06-19T19:12:05Z",
      "updated_at": "2025-06-19T19:12:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2157539079",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157539079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157541925",
      "pull_request_review_id": 2943859675,
      "id": 2157541925,
      "node_id": "PRRC_kwDOABII586AmXol",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157539079,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "To be clear, I'm commenting on the apparent rename from `curr_available_value` to `total_available`.",
      "created_at": "2025-06-19T19:14:40Z",
      "updated_at": "2025-06-19T19:14:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2157541925",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157541925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157543064",
      "pull_request_review_id": 2943861298,
      "id": 2157543064,
      "node_id": "PRRC_kwDOABII586AmX6Y",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157539079,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I also think `available_value` is perfectly fine as well.",
      "created_at": "2025-06-19T19:16:04Z",
      "updated_at": "2025-06-19T19:16:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2157543064",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157543064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157556966",
      "pull_request_review_id": 2943879965,
      "id": 2157556966,
      "node_id": "PRRC_kwDOABII586AmbTm",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 119,
      "original_position": 73,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This isn't mentioned in the comit message, so I'll ask since It's not apparent on first glance.  Why is `curr_weight` being added here?  I though bnb was agnostic to the weight, only selecting by effective_value().",
      "created_at": "2025-06-19T19:27:49Z",
      "updated_at": "2025-06-19T19:27:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2157556966",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157556966"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157558861",
      "pull_request_review_id": 2943882790,
      "id": 2157558861,
      "node_id": "PRRC_kwDOABII586AmbxN",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 119,
      "original_position": 73,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157556966,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Sorry, my understanding of this is stale.  It looks like `max_tx_weight_exceeded` was added sometime recently which I missed.",
      "created_at": "2025-06-19T19:30:07Z",
      "updated_at": "2025-06-19T19:30:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2157558861",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2157558861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159514805",
      "pull_request_review_id": 2947044312,
      "id": 2159514805,
      "node_id": "PRRC_kwDOABII586At5S1",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157539079,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`curr_available_value` was used to track the available funds in the remaining undecided UTXOs during our search. While we were exploring the search tree, we would reduce it each time we descended further in the tree, and then we had to increment it again when we ascended back to earlier UTXOs.\r\n\r\n`total_available` on the other hand is only summed up once and then refers to the total sum of available funds in our UTXO pool. While we are summing it up, we store the available funds for each depth in the `lookahead` vector. This allows us to look up the remaining funds at each depth directly and we no longer have to traverse every UTXO when we backtrack to increment the `curr_available_value` but allows us to skip back up multiple steps at once.",
      "created_at": "2025-06-20T18:48:01Z",
      "updated_at": "2025-06-20T18:56:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2159514805",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159514805"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159522378",
      "pull_request_review_id": 2947044312,
      "id": 2159522378,
      "node_id": "PRRC_kwDOABII586At7JK",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 119,
      "original_position": 73,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157556966,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "As you mention, `curr_weight` is necessary to test whether we have exceeded the `max_selection_weight`. While we could previously bump into unhandled failure cases where we exceeded the maximum weight for standard transactions, being able to handle smaller transaction weight limits has become even more relevant especially, because we want to be able to reliably create TRUC transactions that are limited to 1000 vB if they have a parent.",
      "created_at": "2025-06-20T18:54:28Z",
      "updated_at": "2025-06-20T18:56:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2159522378",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159522378"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159540477",
      "pull_request_review_id": 2947083742,
      "id": 2159540477,
      "node_id": "PRRC_kwDOABII586At_j9",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 119,
      "original_position": 73,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157556966,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, I have been doing some more research into this.\r\n\r\n> ..limited to 1000 vB if they have a parent.\r\n\r\nAnd what if they don't have a parent?  I was under the impression that the upper bound is always 4,000 WU (MAX_STANDARD_TX_WEIGHT).  Apologies btw, I could move this question to the forum or elsewhere since it's getting off topic.",
      "created_at": "2025-06-20T19:11:17Z",
      "updated_at": "2025-06-20T19:11:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2159540477",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159540477"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159561495",
      "pull_request_review_id": 2947117780,
      "id": 2159561495,
      "node_id": "PRRC_kwDOABII586AuEsX",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 119,
      "original_position": 73,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157556966,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Unconfirmed TRUC transactions may not have more than one unconfirmed ancestor transaction (not counting itself) and no more than one unconfirmed descendant transaction. Unconfirmed parent or child transactions of TRUC transactions must be TRUC themselves. TRUC transactions are limited to 40,000 WU, TRUC transactions with an unconfirmed parent transaction are limited to 4,000 WU.\r\nThe full specification is found in [BIP 431](https://github.com/bitcoin/bips/blob/master/bip-0431.mediawiki#specification) and a short summary can be found in the corresponding [release notes](https://github.com/bitcoin/bitcoin/pull/30272/files#diff-727d0bf0f21451364ea2cd322d6f45516763f92f8db957c4246374e23fcfefef).",
      "created_at": "2025-06-20T19:31:13Z",
      "updated_at": "2025-06-20T19:31:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2159561495",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159561495"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265436745",
      "pull_request_review_id": 3103743104,
      "id": 2265436745,
      "node_id": "PRRC_kwDOABII586HB9JJ",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157539079,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks.  That makes sense since now there is the lookahead, so we don't use `curr_available_value`.  I still think dropping `curr_` from like `curr_selection` is nicer.  So there is `selection` and `best_selection`.\r\n\r\nAlso, on the topic of lookahead.  Since coin-grinder also uses lookahead, couldn't that code be shared by creating a lookahead function?  Doesn't need to happen for this PR but it would be more DRY that way.",
      "created_at": "2025-08-10T20:54:18Z",
      "updated_at": "2025-08-10T20:54:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2265436745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265436745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265442605",
      "pull_request_review_id": 3103748331,
      "id": 2265442605,
      "node_id": "PRRC_kwDOABII586HB-kt",
      "diff_hunk": "@@ -93,113 +115,163 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;",
      "path": "src/wallet/coinselection.cpp",
      "position": 156,
      "original_position": 148,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit this ought to be `is_fee_high`?  also this could just be a function on utxo `utxo_pool.at(0).is_fee_high()` alternatively `.is_fee_expensive()`",
      "created_at": "2025-08-10T21:12:48Z",
      "updated_at": "2025-08-10T21:12:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2265442605",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265442605"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 169,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265461764",
      "pull_request_review_id": 3103765916,
      "id": 2265461764,
      "node_id": "PRRC_kwDOABII586HCDQE",
      "diff_hunk": "@@ -93,113 +115,163 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    while (!is_done) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_amount + lookahead[curr_selection.back()] < selection_target) {\n+            // Insufficient funds with lookahead: CUT\n+            should_cut = true;\n+        } else if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {\n+            // At high feerates adding more inputs will increase the waste score. If the current waste is already worse\n+            // than the best selection’s while we have insufficient funds, it is impossible for this partial selection\n+            // to beat the best selection by adding more inputs: SHIFT\n+            // At low feerates, additional inputs lower the waste score, and using this would cause us to skip exploring\n+            // combinations with more inputs of lower amounts.\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            result.SetAlgoCompleted(false);\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n+\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        while (should_shift) {\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                is_done = true;\n+                result.SetAlgoCompleted(true);\n+                break;\n             }\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+            // After SHIFTing to an omission branch, the `next_utxo` might have the same effective value as the\n+            // UTXO we just omitted. Since lower waste is our tiebreaker on UTXOs with equal effective value for sorting, if it\n+            // ties on the effective value, it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a\n+            // higher waste.  If so, selecting `next_utxo` would produce an equivalent or worse\n+            // selection as one we previously evaluated. In that case, increment `next_utxo` until we find a UTXO with a\n+            // differing amount.\n+            while (utxo_pool[next_utxo - 1].GetSelectionAmount() == utxo_pool[next_utxo].GetSelectionAmount()) {\n+                if (next_utxo >= utxo_pool.size() - 1) {\n+                    // Reached end of UTXO pool skipping clones: SHIFT instead\n+                    should_shift = true;\n+                    break;",
      "path": "src/wallet/coinselection.cpp",
      "position": 278,
      "original_position": 268,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "hmm could this be `is_done = true;` instead of break?  In general I think it would be better to replace all `is_done = true;` with `break` and then change the loop condition to `while curr_try < TOTAL_TRIES`.  That way, the entire condition which checks that the `curr_try > TOTAL_TRIES` can be removed.  In short, the combination of the usage of `break` with `is_done` could be simplified by always using break and then change the loop invariant to `while .. < TOTAL_TRIES`.",
      "created_at": "2025-08-10T22:04:20Z",
      "updated_at": "2025-08-10T22:04:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2265461764",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265461764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 255,
      "original_line": 253,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265462933",
      "pull_request_review_id": 3103766846,
      "id": 2265462933,
      "node_id": "PRRC_kwDOABII586HCDiV",
      "diff_hunk": "@@ -93,113 +115,163 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    while (!is_done) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_amount + lookahead[curr_selection.back()] < selection_target) {\n+            // Insufficient funds with lookahead: CUT\n+            should_cut = true;\n+        } else if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {\n+            // At high feerates adding more inputs will increase the waste score. If the current waste is already worse\n+            // than the best selection’s while we have insufficient funds, it is impossible for this partial selection\n+            // to beat the best selection by adding more inputs: SHIFT\n+            // At low feerates, additional inputs lower the waste score, and using this would cause us to skip exploring\n+            // combinations with more inputs of lower amounts.\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            result.SetAlgoCompleted(false);\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n+\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift  = true;\n+        }\n+\n+        while (should_shift) {\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                is_done = true;\n+                result.SetAlgoCompleted(true);\n+                break;\n             }\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift  = false;\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+            // After SHIFTing to an omission branch, the `next_utxo` might have the same effective value as the\n+            // UTXO we just omitted. Since lower waste is our tiebreaker on UTXOs with equal effective value for sorting, if it\n+            // ties on the effective value, it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a\n+            // higher waste.  If so, selecting `next_utxo` would produce an equivalent or worse\n+            // selection as one we previously evaluated. In that case, increment `next_utxo` until we find a UTXO with a\n+            // differing amount.\n+            while (utxo_pool[next_utxo - 1].GetSelectionAmount() == utxo_pool[next_utxo].GetSelectionAmount()) {\n+                if (next_utxo >= utxo_pool.size() - 1) {\n+                    // Reached end of UTXO pool skipping clones: SHIFT instead\n+                    should_shift = true;\n+                    break;",
      "path": "src/wallet/coinselection.cpp",
      "position": 278,
      "original_position": 268,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": 2265461764,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ah I see, this breaks the inner while loop.  Disregard my previous comment.",
      "created_at": "2025-08-10T22:08:15Z",
      "updated_at": "2025-08-10T22:08:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2265462933",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2265462933"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 255,
      "original_line": 253,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271156164",
      "pull_request_review_id": 3112728323,
      "id": 2271156164,
      "node_id": "PRRC_kwDOABII586HXxfE",
      "diff_hunk": "@@ -54,25 +54,47 @@ struct {\n  * set that can pay for the spending target and does not exceed the spending target by more than the\n  * cost of creating and spending a change output. The algorithm uses a depth-first search on a binary\n  * tree. In the binary tree, each node corresponds to the inclusion or the omission of a UTXO. UTXOs\n- * are sorted by their effective values and the tree is explored deterministically per the inclusion\n+ * are sorted by their effective values, tie-broken by their waste score, and the tree is explored deterministically per the inclusion\n  * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.\n  * While the selection has not reached the target range, more UTXOs are included. When a selection's\n- * value exceeds the target range, the complete subtree deriving from this selection can be omitted.\n+ * value exceeds the target range, the complete subtree deriving from this selection prefix can be omitted.\n  * At that point, the last included UTXO is deselected and the corresponding omission branch explored\n  * instead starting by adding the subsequent UTXO. The search ends after the complete tree has been searched or after a limited number of tries.\n  *\n  * The search continues to search for better solutions after one solution has been found. The best\n- * solution is chosen by minimizing the waste metric. The waste metric is defined as the cost to\n+ * solution is chosen by minimal waste score. The waste metric is defined as the cost to\n  * spend the current inputs at the given fee rate minus the long term expected cost to spend the\n- * inputs, plus the amount by which the selection exceeds the spending target:\n+ * inputs, plus the amount by which the selection exceeds the spending target (the \"excess\"):\n  *\n- * waste = selectionTotal - target + inputs × (currentFeeRate - longTermFeeRate)\n+ *    excess = selected_amount - target\n+ *    waste = inputs × (currentFeeRate - longTermFeeRate) + excess\n  *\n- * The algorithm uses two additional optimizations. A lookahead keeps track of the total value of\n- * the unexplored UTXOs. A subtree is not explored if the lookahead indicates that the target range\n- * cannot be reached. Further, it is unnecessary to test equivalent combinations. This allows us\n- * to skip testing the inclusion of UTXOs that match the effective value and waste of an omitted\n- * predecessor.\n+ * Note that this means that at fee rates higher than longTermFeeRate additional inputs increase the\n+ * waste score, while at fee rates lower than longTermFeeRate additional inputs decrease the waste\n+ * score.\n+ *\n+ * The algorithm uses the following optimizations:\n+ * 1. Lookahead: The lookahead stores the total remaining effective value of the undecided UTXOs for\n+ *    every depth of the search tree. Whenever the currently selected amount plus the potential\n+ *    amount from the lookahead falls short of the target, we can immediately stop searching the\n+ *    subtree as no more input set candidates can be found in it.\n+ * 2. Skip clones: When two UTXOs match in weight and effective value (\"are clones\"), naive\n+ *    exploration would cause redundant work: e.g., given the UTXOs A, A', and B, where A and A' are\n+ *    clones, naive exploration would combine (read underscore to as omission):\n+ *    [{}, {A}, {A, A'}, {A, A', B}, {A, _, B}, {_, A'}, {_, A', B}, {_, _, B}].\n+ *    In this case the input set candidates {A} and {A'} als well as {A, B} and {A', B} are",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 42,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb s/als/as",
      "created_at": "2025-08-12T20:33:51Z",
      "updated_at": "2025-08-12T20:33:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271156164",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271156164"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271164228",
      "pull_request_review_id": 3112740673,
      "id": 2271164228,
      "node_id": "PRRC_kwDOABII586HXzdE",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in 7596e491563d98aab10e9e0baad4850a6197844a.  Now that the set is sorted by waste as tie breaker, if the `curr_excess` is zero, there will be no future solution with a better waste score.  Therefore adding a condition testing for zero would stop the search sooner.",
      "created_at": "2025-08-12T20:37:06Z",
      "updated_at": "2025-08-12T20:37:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271164228",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271164228"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271172326",
      "pull_request_review_id": 3112752003,
      "id": 2271172326,
      "node_id": "PRRC_kwDOABII586HX1bm",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];",
      "path": "src/wallet/coinselection.cpp",
      "position": 160,
      "original_position": 111,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in 7596e491563d98aab10e9e0baad4850a6197844a is there a mechanism up the stack that prevents this from being a utxo_pool length of zero?  I notice in coin-grinder also that a utxo_pool of no length here would cause an exception.",
      "created_at": "2025-08-12T20:40:32Z",
      "updated_at": "2025-08-12T20:40:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271172326",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271172326"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 173,
      "original_line": 137,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271175757",
      "pull_request_review_id": 3112756110,
      "id": 2271175757,
      "node_id": "PRRC_kwDOABII586HX2RN",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift  = true;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 192,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in 7596e491563d98aab10e9e0baad4850a6197844a\r\n\r\nnit: extra space here before the =.  Same issue on L156",
      "created_at": "2025-08-12T20:41:59Z",
      "updated_at": "2025-08-12T20:42:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271175757",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271175757"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271180609",
      "pull_request_review_id": 3112762615,
      "id": 2271180609,
      "node_id": "PRRC_kwDOABII586HX3dB",
      "diff_hunk": "@@ -55,11 +55,11 @@ struct {\n  * cost of creating and spending a change output. The algorithm uses a depth-first search on a binary\n  * tree. In the binary tree, each node corresponds to the inclusion or the omission of a UTXO. UTXOs\n  * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 5,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in 7596e491563d98aab10e9e0baad4850a6197844a\r\n\r\nnit: line length here and in L62 breaks from the rest of the paragraph.",
      "created_at": "2025-08-12T20:44:09Z",
      "updated_at": "2025-08-12T20:44:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271180609",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271180609"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 58,
      "original_line": 58,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271188273",
      "pull_request_review_id": 3112772402,
      "id": 2271188273,
      "node_id": "PRRC_kwDOABII586HX5Ux",
      "diff_hunk": "@@ -54,25 +54,47 @@ struct {\n  * set that can pay for the spending target and does not exceed the spending target by more than the\n  * cost of creating and spending a change output. The algorithm uses a depth-first search on a binary\n  * tree. In the binary tree, each node corresponds to the inclusion or the omission of a UTXO. UTXOs\n- * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * are sorted by their effective values, tie-broken by their waste score, and the tree is explored deterministically per the inclusion\n+ * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.\n  * While the selection has not reached the target range, more UTXOs are included. When a selection's\n- * value exceeds the target range, the complete subtree deriving from this selection can be omitted.\n+ * value exceeds the target range, the complete subtree deriving from this selection prefix can be omitted.\n  * At that point, the last included UTXO is deselected and the corresponding omission branch explored\n- * instead. The search ends after the complete tree has been searched or after a limited number of tries.\n+ * instead starting by adding the subsequent UTXO. The search ends after the complete tree has been searched or after a limited number of tries.\n  *\n  * The search continues to search for better solutions after one solution has been found. The best",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": null,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: this is not part of the diff, but consider rewording this sentence to \"The search continues for better solutions..\" so that search isn't used twice redundantly in the same sentence.",
      "created_at": "2025-08-12T20:47:13Z",
      "updated_at": "2025-08-12T20:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2271188273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2271188273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 64,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2291715313",
      "pull_request_review_id": 3141675940,
      "id": 2291715313,
      "node_id": "PRRC_kwDOABII586ImMzx",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;",
      "path": "src/wallet/coinselection.cpp",
      "position": 192,
      "original_position": 133,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": null,
      "user": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 7596e491563d98aab10e9e0baad4850a6197844a: FYI my mutation testing bot reported the following mutant as not killed:\r\n\r\n```diff\r\n@@ -201,7 +201,7 @@ util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool\r\n             should_shift  = true;\r\n             // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\r\n             CAmount curr_excess = curr_amount - selection_target;\r\n-            CAmount curr_waste = curr_selection_waste + curr_excess;\r\n+            CAmount curr_waste = curr_selection_waste - curr_excess;\r\n             if (curr_waste <= best_waste) {\r\n                 // New best solution\r\n```",
      "created_at": "2025-08-21T17:26:18Z",
      "updated_at": "2025-08-21T17:26:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2291715313",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2291715313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 205,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761331013",
      "pull_request_review_id": 3747993730,
      "id": 2761331013,
      "node_id": "PRRC_kwDOABII586klpFF",
      "diff_hunk": "@@ -55,11 +55,11 @@ struct {\n  * cost of creating and spending a change output. The algorithm uses a depth-first search on a binary\n  * tree. In the binary tree, each node corresponds to the inclusion or the omission of a UTXO. UTXOs\n  * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.",
      "path": "src/wallet/coinselection.cpp",
      "position": 13,
      "original_position": 5,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271180609,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, that’s done on purpose. By leaving the line breaks in the same position it is trivially visible which words were changed to people reviewing this diff. If I shifted the position of the line breaks, it would be more work for the reviewers to see what I changed and that I didn’t completely change the last line.\n\nCompare the following (and I guess imagine that the changed words are highlighted):\n\n```diff\n- * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * are sorted by their effective values, tie-broken by their waste score, and the tree is explored deterministically per the inclusion\n+ * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.\n```\n\n```diff\n- * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * are sorted by their effective values, tie-broken by their waste score, and the tree is explored \n+ * deterministically per the inclusion branch first. For each new input set candidate, the algorithm\n+ * checks whether the selection is within the target range.\n```",
      "created_at": "2026-02-03T22:45:32Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761331013",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761331013"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 58,
      "original_line": 58,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761339563",
      "pull_request_review_id": 3747993730,
      "id": 2761339563,
      "node_id": "PRRC_kwDOABII586klrKr",
      "diff_hunk": "@@ -93,113 +115,163 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;",
      "path": "src/wallet/coinselection.cpp",
      "position": 156,
      "original_position": 148,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": 2265442605,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "No, it is named as intended. We don’t have access to the `feerate` or the currently configured `m_long_term_feerate` here, so this uses a comparison of the `fee` and the `long_term_fee` of the same UTXO as a proxy to discover whether the _feerate_ is higher than the _long term feerate estimate (LTFRE)_. \r\n\r\nSince the `fee` and `long_term_fee` are taken from the same UTXO, if the fee is higher than the long_term_fee, it follows that the feerate is higher than LTFRE.",
      "created_at": "2026-02-03T22:47:58Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761339563",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761339563"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 169,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761403209",
      "pull_request_review_id": 3747993730,
      "id": 2761403209,
      "node_id": "PRRC_kwDOABII586kl6tJ",
      "diff_hunk": "@@ -54,25 +54,47 @@ struct {\n  * set that can pay for the spending target and does not exceed the spending target by more than the\n  * cost of creating and spending a change output. The algorithm uses a depth-first search on a binary\n  * tree. In the binary tree, each node corresponds to the inclusion or the omission of a UTXO. UTXOs\n- * are sorted by their effective values and the tree is explored deterministically per the inclusion\n- * branch first. At each node, the algorithm checks whether the selection is within the target range.\n+ * are sorted by their effective values, tie-broken by their waste score, and the tree is explored deterministically per the inclusion\n+ * branch first. For each new input set candidate, the algorithm checks whether the selection is within the target range.\n  * While the selection has not reached the target range, more UTXOs are included. When a selection's\n- * value exceeds the target range, the complete subtree deriving from this selection can be omitted.\n+ * value exceeds the target range, the complete subtree deriving from this selection prefix can be omitted.\n  * At that point, the last included UTXO is deselected and the corresponding omission branch explored\n- * instead. The search ends after the complete tree has been searched or after a limited number of tries.\n+ * instead starting by adding the subsequent UTXO. The search ends after the complete tree has been searched or after a limited number of tries.\n  *\n  * The search continues to search for better solutions after one solution has been found. The best",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": 2271188273,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-02-03T23:03:00Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761403209",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761403209"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 64,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761452775",
      "pull_request_review_id": 3747993730,
      "id": 2761452775,
      "node_id": "PRRC_kwDOABII586kmGzn",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;",
      "path": "src/wallet/coinselection.cpp",
      "position": 88,
      "original_position": 39,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "4be47e58bdf530351a7bc81ae961ad0a7277fb9b",
      "in_reply_to_id": 2157539079,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, I’m gonna keep it as is. I find that `curr_smth` vs `best_smth` has a clearer contrast compared to `smth` vs `best_smth`. Especially with terms such as amount, selection, and waste, that appear everywhere in this code and surrounding documentation, I prefer the added specificity.\n\nThe `lookahead` vector merely stores the available effective value of all remaining UTXOs at each specific search depth. It is collected in a one-loop pass over the UTXO pool together with with the total available value (and in CoinGrinder with the `min_tail_weight`). Later it is read once to determine whether a subtree can be skipped in the exploration. It’s not clear to me what function you think you would be able to extract here.",
      "created_at": "2026-02-03T23:15:27Z",
      "updated_at": "2026-02-04T21:35:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761452775",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761452775"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 123,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761488670",
      "pull_request_review_id": 3747993730,
      "id": 2761488670,
      "node_id": "PRRC_kwDOABII586kmPke",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];",
      "path": "src/wallet/coinselection.cpp",
      "position": 160,
      "original_position": 111,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271172326,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "1. It throws an insufficient funds error before getting to `AttemptSelection(…), if `available_coins` has less funds than `value_to_select`: https://github.com/bitcoin/bitcoin/blob/3532e242134e8f92fb5fe99bbd024ed185839e8c/src/wallet/spend.cpp#L930\r\n\r\n2. It skips `AttemptSelection(…)`, if the result of a UTXO filter is empty: https://github.com/bitcoin/bitcoin/blob/3532e242134e8f92fb5fe99bbd024ed185839e8c/src/wallet/spend.cpp#L945\r\n\r\n3. And it would throw an insufficient funds error above because `selection_target` has to be greater than 0:\r\n\r\n```\r\n    if (total_available < selection_target) {\r\n\t\r\n        // Insufficient funds\r\n        return util::Error();\r\n    }\r\n```",
      "created_at": "2026-02-03T23:29:00Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761488670",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761488670"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 173,
      "original_line": 137,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761510915",
      "pull_request_review_id": 3747993730,
      "id": 2761510915,
      "node_id": "PRRC_kwDOABII586kmVAD",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271164228,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "No, that’s wrong. \r\n\r\n1. **At low feerates inputs have a negative waste score**. Adding more inputs improves the waste score. This means that at low feerate it is possible that a transaction with a heavier input set and a non-zero excess has a preferable waste score than one with an excess of zero and a lighter input set.\r\n\r\n2. At high feerates, you could have a single UTXO that has a large weight and zero excess, but later find a solution with two UTXOs that are in sum lighter and has a better waste score.\r\n\r\n3. This is by the way the same erroneous reasoning underlying #18257 which led to the bug fixed in #25495.\r\n\r\n\r\nCould you please put on your mental checklist:\r\n\r\n- waste score can be negative\r\n- inputs can have different weights\r\n- greedy algorithms do not guarantee finding the optimal solution\r\n\r\nand check that list between writing and posting review to coin selection PRs? Please feel free to expand that list as necessary.",
      "created_at": "2026-02-03T23:38:51Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761510915",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761510915"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761527063",
      "pull_request_review_id": 3747993730,
      "id": 2761527063,
      "node_id": "PRRC_kwDOABII586kmY8X",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift  = true;",
      "path": "src/wallet/coinselection.cpp",
      "position": 1,
      "original_position": 192,
      "commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271175757,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, fixed.",
      "created_at": "2026-02-03T23:46:23Z",
      "updated_at": "2026-02-04T21:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761527063",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761527063"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761552103",
      "pull_request_review_id": 3747993730,
      "id": 2761552103,
      "node_id": "PRRC_kwDOABII586kmfDn",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;",
      "path": "src/wallet/coinselection.cpp",
      "position": 192,
      "original_position": 133,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2291715313,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Mh, that’s somewhat surprising. We should probably add a couple tests for exact waste scores or similar.\r\n\r\nI tried to introduce this mutant and tested against the [`bnb_finds_min_waste` fuzz target](https://github.com/bitcoin/bitcoin/pull/32894#pullrequestreview-3707700984), which immediately crashes on this mutant. :)",
      "created_at": "2026-02-03T23:56:18Z",
      "updated_at": "2026-02-11T04:51:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2761552103",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2761552103"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 205,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2774207501",
      "pull_request_review_id": 3763172045,
      "id": 2774207501,
      "node_id": "PRRC_kwDOABII586lWwwN",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271164228,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It's been a while a long while since I made this comment, and so I am forgetting some detail.  I think what I had in mind is that if the pool is sorted by waste, then we are evaluation the  waste scores with the largest negative values first, so any further evaluated utxos could only be worse.  However, I think this might be wrong since it's waste score is only the tie-breaker.  Again, I'd probably need to go back over this review in more detail, but I defer to your expertise in saying that there is no sooner way to find the best solution.\r\n\r\n> Could you please put on your mental checklist:\r\n\r\n> and check that list between writing and posting review to coin selection PRs? Please feel free to expand that list as necessary.\r\n\r\nI am aware of these facts.  Please be aware I am a person and not an LLM, so it feels a bit condescending to write messages like this, as if I am not aware of some basic facts.  Maybe you would prefer I not review your PRs since I have made mistakes in past (3) but in that case, I had only filed an issue.  It was not I who created the PR, reviewed it and merged it.  Software is a team effort among people, so lets treat each other as people with dignity and respect.\r\n\r\nAnyway, I would really appreciate if there was a bit more attention to how long it takes for a response to some of this stuff.  Because of the time gap from my last review, I feel like I need to set aside time to refresh my memory and review again.  And maybe that's simply not desired if you feel the need to write messages like above.",
      "created_at": "2026-02-06T13:40:11Z",
      "updated_at": "2026-02-06T13:40:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2774207501",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2774207501"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791459811",
      "pull_request_review_id": 3782862104,
      "id": 2791459811,
      "node_id": "PRRC_kwDOABII586mYkvj",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271164228,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I adopted the wrong tone here. I’m sorry.\r\n\r\nI understand that it is a lot of work to get back into the details of the PR after a long break. Please don’t feel obligated to invest more time.",
      "created_at": "2026-02-11T05:19:23Z",
      "updated_at": "2026-02-11T05:19:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2791459811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791459811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791546135",
      "pull_request_review_id": 3782945615,
      "id": 2791546135,
      "node_id": "PRRC_kwDOABII586mY50X",
      "diff_hunk": "@@ -93,113 +115,163 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;",
      "path": "src/wallet/coinselection.cpp",
      "position": 156,
      "original_position": 148,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "cdc25b417a1cf09f9b0d9a9bf197f853daa24cdb",
      "in_reply_to_id": 2265442605,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I added a comment to explain the reasoning behind this line",
      "created_at": "2026-02-11T06:00:35Z",
      "updated_at": "2026-02-11T06:00:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2791546135",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791546135"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 169,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791573838",
      "pull_request_review_id": 3782977871,
      "id": 2791573838,
      "node_id": "PRRC_kwDOABII586mZAlO",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;",
      "path": "src/wallet/coinselection.cpp",
      "position": 192,
      "original_position": 133,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2291715313,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Since #32894 was now merged, I assume that this is resolved.",
      "created_at": "2026-02-11T06:09:22Z",
      "updated_at": "2026-02-11T06:09:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2791573838",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2791573838"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 205,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2795652978",
      "pull_request_review_id": 3787608841,
      "id": 2795652978,
      "node_id": "PRRC_kwDOABII586mokdy",
      "diff_hunk": "@@ -93,113 +115,164 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    // We don’t have access to the feerate here, but fee to long_term_fee is as feerate to LTFRE\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    while (!is_done) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_amount + lookahead[curr_selection.back()] < selection_target) {\n+            // Insufficient funds with lookahead: CUT\n+            should_cut = true;\n+        } else if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {\n+            // At high feerates adding more inputs will increase the waste score. If the current waste is already worse\n+            // than the best selection’s while we have insufficient funds, it is impossible for this partial selection\n+            // to beat the best selection by adding more inputs: SHIFT\n+            // At low feerates, additional inputs lower the waste score, and using this would cause us to skip exploring\n+            // combinations with more inputs of lower amounts.\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            result.SetAlgoCompleted(false);\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift = true;\n+        }\n+\n+        while (should_shift) {\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                is_done = true;\n+                result.SetAlgoCompleted(true);\n+                break;\n+            }\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift = false;\n+\n+            // After SHIFTing to an omission branch, the `next_utxo` might have the same effective value as the\n+            // UTXO we just omitted. Since lower waste is our tiebreaker on UTXOs with equal effective value for sorting, if it\n+            // ties on the effective value, it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a\n+            // higher waste.  If so, selecting `next_utxo` would produce an equivalent or worse\n+            // selection as one we previously evaluated. In that case, increment `next_utxo` until we find a UTXO with a\n+            // differing amount.\n+            while (utxo_pool[next_utxo - 1].GetSelectionAmount() == utxo_pool[next_utxo].GetSelectionAmount()) {",
      "path": "src/wallet/coinselection.cpp",
      "position": 274,
      "original_position": 273,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit:\n\n```suggestion\n            Assume(next_utxo < utxo_pool.size())\n            while (utxo_pool[next_utxo - 1].GetSelectionAmount() == utxo_pool[next_utxo].GetSelectionAmount()) {\n```",
      "created_at": "2026-02-11T21:38:32Z",
      "updated_at": "2026-02-11T21:38:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2795652978",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2795652978"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 251,
      "original_line": 250,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800906828",
      "pull_request_review_id": 3793471509,
      "id": 2800906828,
      "node_id": "PRRC_kwDOABII586m8nJM",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271164228,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah I sort of over-reacted as well I think.  I'd like to pick this backup and offer better feedback since I seem to have had the wrong idea, however realistically it's probably not needed other then for my own understanding.  That is to say, i'd like to circle back time permitting.",
      "created_at": "2026-02-12T20:25:14Z",
      "updated_at": "2026-02-12T20:25:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2800906828",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2800906828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801071656",
      "pull_request_review_id": 3793685264,
      "id": 2801071656,
      "node_id": "PRRC_kwDOABII586m9PYo",
      "diff_hunk": "@@ -93,114 +87,127 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n+    // Check that there are sufficient funds\n+    CAmount total_available = 0;\n     for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+        // Assert UTXOs with non-positive effective value have been filtered\n+        Assume(utxo.GetSelectionAmount() > 0);\n+        total_available += utxo.GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n     std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        result.SetSelectionsEvaluated(curr_try);\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    while (true) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift  = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift  = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;",
      "path": "src/wallet/coinselection.cpp",
      "position": 191,
      "original_position": 132,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "7596e491563d98aab10e9e0baad4850a6197844a",
      "in_reply_to_id": 2271164228,
      "user": {
        "login": "yancyribbens",
        "id": 817736,
        "node_id": "MDQ6VXNlcjgxNzczNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yancyribbens",
        "html_url": "https://github.com/yancyribbens",
        "followers_url": "https://api.github.com/users/yancyribbens/followers",
        "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
        "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
        "repos_url": "https://api.github.com/users/yancyribbens/repos",
        "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm sort of deep in the weeds in writing network stack software that makes use of advanced coin-selection algorithms, and switching gears is not always convenient or time-efficient.  I'm sure you know how it goes as well.  Time management is always one of the greatest challenges!",
      "created_at": "2026-02-12T21:09:03Z",
      "updated_at": "2026-02-12T21:09:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2801071656",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2801071656"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 204,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2819815665",
      "pull_request_review_id": 3817114421,
      "id": 2819815665,
      "node_id": "PRRC_kwDOABII586oEvjx",
      "diff_hunk": "@@ -93,113 +115,164 @@ static const size_t TOTAL_TRIES = 100000;\n util::Result<SelectionResult> SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selection_target, const CAmount& cost_of_change,\n                                              int max_selection_weight)\n {\n-    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n-    CAmount curr_value = 0;\n-    std::vector<size_t> curr_selection; // selected utxo indexes\n-    int curr_selection_weight = 0; // sum of selected utxo weight\n-\n-    // Calculate curr_available_value\n-    CAmount curr_available_value = 0;\n-    for (const OutputGroup& utxo : utxo_pool) {\n-        // Assert that this utxo is not negative. It should never be negative,\n-        // effective value calculation should have removed it\n-        assert(utxo.GetSelectionAmount() > 0);\n-        curr_available_value += utxo.GetSelectionAmount();\n+    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n+    // The sum of UTXO amounts after this UTXO index, e.g. lookahead[5] = Σ(UTXO[6+].amount)\n+    std::vector<CAmount> lookahead(utxo_pool.size());\n+\n+    // Calculate lookahead values, and check that there are sufficient funds\n+    CAmount total_available = 0;\n+    for (int index = static_cast<int>(utxo_pool.size()) - 1; index >= 0; --index) {\n+        lookahead[index] = total_available;\n+        // UTXOs with non-positive effective value must have been filtered\n+        Assume(utxo_pool[index].GetSelectionAmount() > 0);\n+        total_available += utxo_pool[index].GetSelectionAmount();\n     }\n-    if (curr_available_value < selection_target) {\n+\n+    if (total_available < selection_target) {\n+        // Insufficient funds\n         return util::Error();\n     }\n \n-    // Sort the utxo_pool\n-    std::sort(utxo_pool.begin(), utxo_pool.end(), descending);\n \n-    CAmount curr_waste = 0;\n+    // The current selection and the best input set found so far, stored as the utxo_pool indices of the UTXOs forming them\n+    std::vector<size_t> curr_selection;\n     std::vector<size_t> best_selection;\n+\n+    // The currently selected effective amount\n+    CAmount curr_amount = 0;\n+\n+    // The waste score of the current selection, and the best waste score so far\n+    CAmount curr_selection_waste = 0;\n     CAmount best_waste = MAX_MONEY;\n \n-    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    // The weight of the currently selected input set\n+    int curr_weight = 0;\n+\n+    // Whether the input sets generated during this search have exceeded the maximum transaction weight at any point\n     bool max_tx_weight_exceeded = false;\n \n-    // Depth First search loop for choosing the UTXOs\n-    for (size_t curr_try = 0, utxo_pool_index = 0; curr_try < TOTAL_TRIES; ++curr_try, ++utxo_pool_index) {\n-        // Conditions for starting a backtrack\n-        bool backtrack = false;\n-        if (curr_value + curr_available_value < selection_target || // Cannot possibly reach target with the amount remaining in the curr_available_value.\n-            curr_value > selection_target + cost_of_change || // Selected value is out of range, go back and try other branch\n-            (curr_waste > best_waste && is_feerate_high)) { // Don't select things which we know will be more wasteful if the waste is increasing\n-            backtrack = true;\n-        } else if (curr_selection_weight > max_selection_weight) { // Selected UTXOs weight exceeds the maximum weight allowed, cannot find more solutions by adding more inputs\n-            max_tx_weight_exceeded = true; // at least one selection attempt exceeded the max weight\n-            backtrack = true;\n-        } else if (curr_value >= selection_target) {       // Selected value is within range\n-            curr_waste += (curr_value - selection_target); // This is the excess value which is added to the waste for the below comparison\n-            // Adding another UTXO after this check could bring the waste down if the long term fee is higher than the current fee.\n-            // However we are not going to explore that because this optimization for the waste is only done when we have hit our target\n-            // value. Adding any more UTXOs will be just burning the UTXO; it will go entirely to fees. Thus we aren't going to\n-            // explore any more UTXOs to avoid burning money like that.\n+    // Index of the next UTXO to consider in utxo_pool\n+    size_t next_utxo = 0;\n+\n+    auto deselect_last = [&]() {\n+        OutputGroup& utxo = utxo_pool[curr_selection.back()];\n+        curr_amount -= utxo.GetSelectionAmount();\n+        curr_weight -= utxo.m_weight;\n+        curr_selection_waste -= utxo.fee - utxo.long_term_fee;\n+        curr_selection.pop_back();\n+    };\n+\n+    size_t curr_try = 0;\n+    SelectionResult result(selection_target, SelectionAlgorithm::BNB);\n+    bool is_done = false;\n+    // We don’t have access to the feerate here, but fee to long_term_fee is as feerate to LTFRE\n+    bool is_feerate_high = utxo_pool.at(0).fee > utxo_pool.at(0).long_term_fee;\n+    while (!is_done) {\n+        bool should_shift{false}, should_cut{false};\n+        // Select `next_utxo`\n+        OutputGroup& utxo = utxo_pool[next_utxo];\n+        curr_amount += utxo.GetSelectionAmount();\n+        curr_weight += utxo.m_weight;\n+        curr_selection_waste += utxo.fee - utxo.long_term_fee;\n+        curr_selection.push_back(next_utxo);\n+        ++next_utxo;\n+        ++curr_try;\n+\n+        // EVALUATE current selection: check for solutions and see whether we can CUT or SHIFT before EXPLORING further\n+        if (curr_amount + lookahead[curr_selection.back()] < selection_target) {\n+            // Insufficient funds with lookahead: CUT\n+            should_cut = true;\n+        } else if (curr_weight > max_selection_weight) {\n+            // max_weight exceeded: SHIFT\n+            max_tx_weight_exceeded = true;\n+            should_shift = true;\n+        } else if (curr_amount > selection_target + cost_of_change) {\n+            // Overshot target range: SHIFT\n+            should_shift = true;\n+        } else if (is_feerate_high && curr_selection_waste > best_waste) {\n+            // At high feerates adding more inputs will increase the waste score. If the current waste is already worse\n+            // than the best selection’s while we have insufficient funds, it is impossible for this partial selection\n+            // to beat the best selection by adding more inputs: SHIFT\n+            // At low feerates, additional inputs lower the waste score, and using this would cause us to skip exploring\n+            // combinations with more inputs of lower amounts.\n+            should_shift = true;\n+        } else if (curr_amount >= selection_target) {\n+            // Selection is within target window: potential solution\n+            // Adding more UTXOs only increases fees and cannot be better: SHIFT\n+            should_shift = true;\n+            // The amount exceeding the selection_target (the \"excess\"), would be dropped to the fees: it is waste.\n+            CAmount curr_excess = curr_amount - selection_target;\n+            CAmount curr_waste = curr_selection_waste + curr_excess;\n             if (curr_waste <= best_waste) {\n+                // New best solution\n                 best_selection = curr_selection;\n                 best_waste = curr_waste;\n             }\n-            curr_waste -= (curr_value - selection_target); // Remove the excess value as we will be selecting different coins now\n-            backtrack = true;\n         }\n \n-        if (backtrack) { // Backtracking, moving backwards\n-            if (curr_selection.empty()) { // We have walked back to the first utxo and no branch is untraversed. All solutions searched\n-                break;\n-            }\n+        if (curr_try >= TOTAL_TRIES) {\n+            // Solution is not guaranteed to be optimal if `curr_try` hit TOTAL_TRIES\n+            result.SetAlgoCompleted(false);\n+            break;\n+        }\n \n-            // Add omitted UTXOs back to lookahead before traversing the omission branch of last included UTXO.\n-            for (--utxo_pool_index; utxo_pool_index > curr_selection.back(); --utxo_pool_index) {\n-                curr_available_value += utxo_pool.at(utxo_pool_index).GetSelectionAmount();\n-            }\n+        if (next_utxo == utxo_pool.size()) {\n+            // Last added UTXO was end of UTXO pool, nothing left to add on inclusion or omission branch: CUT\n+            should_cut = true;\n+        }\n \n-            // Output was included on previous iterations, try excluding now.\n-            assert(utxo_pool_index == curr_selection.back());\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-            curr_value -= utxo.GetSelectionAmount();\n-            curr_waste -= utxo.fee - utxo.long_term_fee;\n-            curr_selection_weight -= utxo.m_weight;\n-            curr_selection.pop_back();\n-        } else { // Moving forwards, continuing down this branch\n-            OutputGroup& utxo = utxo_pool.at(utxo_pool_index);\n-\n-            // Remove this utxo from the curr_available_value utxo amount\n-            curr_available_value -= utxo.GetSelectionAmount();\n-\n-            if (curr_selection.empty() ||\n-                // The previous index is included and therefore not relevant for exclusion shortcut\n-                (utxo_pool_index - 1) == curr_selection.back() ||\n-                // Avoid searching a branch if the previous UTXO has the same value and same waste and was excluded.\n-                // Since the ratio of fee to long term fee is the same, we only need to check if one of those values match in order to know that the waste is the same.\n-                utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount() ||\n-                utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)\n-            {\n-                // Inclusion branch first (Largest First Exploration)\n-                curr_selection.push_back(utxo_pool_index);\n-                curr_value += utxo.GetSelectionAmount();\n-                curr_waste += utxo.fee - utxo.long_term_fee;\n-                curr_selection_weight += utxo.m_weight;\n+        if (should_cut) {\n+            // Neither adding to the current selection nor exploring the omission branch of the last selected UTXO can\n+            // find any solutions. Redirect to exploring the Omission branch of the penultimate selected UTXO (i.e.\n+            // set `next_utxo` to one after the penultimate selected, then deselect the last two selected UTXOs)\n+            deselect_last();\n+            should_shift = true;\n+        }\n+\n+        while (should_shift) {\n+            if (curr_selection.empty()) {\n+                // Exhausted search space before running into attempt limit\n+                is_done = true;\n+                result.SetAlgoCompleted(true);\n+                break;\n+            }\n+            // Set `next_utxo` to one after last selected, then deselect last selected UTXO\n+            next_utxo = curr_selection.back() + 1;\n+            deselect_last();\n+            should_shift = false;\n+\n+            // After SHIFTing to an omission branch, the `next_utxo` might have the same effective value as the\n+            // UTXO we just omitted. Since lower waste is our tiebreaker on UTXOs with equal effective value for sorting, if it\n+            // ties on the effective value, it _must_ have the same waste (i.e. be a \"clone\" of the prior UTXO) or a\n+            // higher waste.  If so, selecting `next_utxo` would produce an equivalent or worse\n+            // selection as one we previously evaluated. In that case, increment `next_utxo` until we find a UTXO with a\n+            // differing amount.\n+            while (utxo_pool[next_utxo - 1].GetSelectionAmount() == utxo_pool[next_utxo].GetSelectionAmount()) {",
      "path": "src/wallet/coinselection.cpp",
      "position": 274,
      "original_position": 273,
      "commit_id": "fe07afafefe99dd9994b49704c34477106be2ad1",
      "original_commit_id": "67e6de9ed8cd84d5b7e344e667618ae0a4d1b42b",
      "in_reply_to_id": 2795652978,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, I’ll add this to better document the boundaries for future readers of this section and would be editors of this algorithm.",
      "created_at": "2026-02-18T01:06:01Z",
      "updated_at": "2026-02-18T01:06:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32150#discussion_r2819815665",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2819815665"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32150"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 251,
      "original_line": 250,
      "side": "RIGHT"
    }
  ]
}
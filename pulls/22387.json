{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387",
    "id": 682257800,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjgyMjU3ODAw",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22387",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/22387.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/22387.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a4bcd687c934d47aa3922334e97e579caf5f8124",
    "number": 22387,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Rate limit the processing of rumoured addresses",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The rate at which IP addresses are rumoured (through ADDR and ADDRV2 messages) on the network seems to vary from 0 for some non-participating nodes, to 0.005-0.025 addr/s for recent Bitcoin Core nodes. However, the current codebase will happily accept and process an effectively unbounded rate from attackers. There are measures to limit the influence attackers can have on the addrman database (bucket restrictions based on source IPs), but still - there is no need to permit them to feed us addresses at a rate that's orders of magnitude larger than what is common on the network today, especially as it will cause us to spam our peers too.\r\n\r\nThis PR implements a [token bucket](https://en.wikipedia.org/wiki/Token_bucket) based rate limiter, allowing an average of 0.1 addr/s per connection, with bursts up to 1000 addresses at once. Whitelisted peers as well as responses to GETADDR requests are exempt from the limit. New connections start with 1 token, so as to not interfere with the common practice of peers' self-announcement.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/47",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/47",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/47/labels",
      "id": 5347322,
      "node_id": "MDk6TWlsZXN0b25lNTM0NzMyMg==",
      "number": 47,
      "state": "closed",
      "title": "22.0",
      "description": "",
      "creator": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 0,
      "closed_issues": 124,
      "created_at": "2020-04-25T00:14:49Z",
      "updated_at": "2021-09-14T07:16:53Z",
      "closed_at": "2021-09-09T12:47:52Z"
    },
    "active_lock_reason": "resolved",
    "created_at": "2021-07-02T00:53:33Z",
    "updated_at": "2022-08-18T18:32:52Z",
    "closed_at": "2021-07-19T10:42:41Z",
    "mergeable_state": "unknown",
    "merged_at": "2021-07-19T10:42:41Z",
    "merge_commit_sha": "d3474b8df2f973e9b9142c0b64505a8a78bcb292",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "sipa:202106_rate_limit_addr",
      "ref": "202106_rate_limit_addr",
      "sha": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 1458655,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
        "name": "bitcoin",
        "full_name": "sipa/bitcoin",
        "owner": {
          "login": "sipa",
          "id": 548488,
          "node_id": "MDQ6VXNlcjU0ODQ4OA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sipa",
          "html_url": "https://github.com/sipa",
          "followers_url": "https://api.github.com/users/sipa/followers",
          "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
          "organizations_url": "https://api.github.com/users/sipa/orgs",
          "repos_url": "https://api.github.com/users/sipa/repos",
          "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sipa/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sipa/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sipa/bitcoin",
        "archive_url": "https://api.github.com/repos/sipa/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sipa/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sipa/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sipa/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
        "svn_url": "https://github.com/sipa/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "TypeScript",
        "forks_count": 20,
        "stargazers_count": 82,
        "watchers_count": 82,
        "size": 215860,
        "default_branch": "lows",
        "open_issues_count": 16,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-06T11:52:48Z",
        "created_at": "2011-03-09T10:46:59Z",
        "updated_at": "2023-06-07T12:26:51Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a88fa1a555195af6543cdc802e8e1c2e1668dd38",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34348,
        "stargazers_count": 69854,
        "watchers_count": 69854,
        "size": 234261,
        "default_branch": "master",
        "open_issues_count": 631,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-09T10:08:42Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-09T09:00:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 159,
    "deletions": 7,
    "changed_files": 7,
    "commits": 5,
    "review_comments": 102,
    "comments": 36
  },
  "events": [
    {
      "event": "labeled",
      "id": 4968818487,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ5Njg4MTg0ODc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4968818487",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T00:54:14Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "milestoned",
      "id": 4968824149,
      "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDQ5Njg4MjQxNDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4968824149",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T00:57:24Z",
      "milestone": {
        "title": "22.0"
      }
    },
    {
      "event": "commented",
      "id": 872651861,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjY1MTg2MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872651861",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T01:41:05Z",
      "updated_at": "2021-07-19T01:51:17Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #22490 by mzumsande\n* #21528 by amitiuttarwar\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-872651861",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 872679319,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjY3OTMxOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872679319",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T03:08:32Z",
      "updated_at": "2021-07-02T03:08:32Z",
      "author_association": "NONE",
      "body": "> There are measures to limit the influence attackers can have on the addrman database (bucket restrictions based on IPs), but still - **there is no need to permit them to feed us addresses at a rate that's orders of magnitude larger than what is common on the network today**, especially as it will cause us to spam our peers too.\r\n\r\nConcept ACK",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-872679319",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 872802081,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjgwMjA4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/872802081",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T08:02:16Z",
      "updated_at": "2021-07-02T08:02:16Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-872802081",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 698062663,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk4MDYyNjYz",
      "url": null,
      "actor": null,
      "commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-698062663",
      "submitted_at": "2021-07-02T12:50:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4972460885,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk3MjQ2MDg4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4972460885",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T16:51:35Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4972473016,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk3MjQ3MzAxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4972473016",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T16:54:35Z"
    },
    {
      "event": "commented",
      "id": 873138272,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzEzODI3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873138272",
      "actor": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T17:04:11Z",
      "updated_at": "2021-07-02T17:04:11Z",
      "author_association": "NONE",
      "body": "Compiled the branch but don't want to run [test/functional/p2p_addr_relay.py](https://github.com/sipa/bitcoin/blob/202106_rate_limit_addr/test/functional/p2p_addr_relay.py). I want to test it manually on testnet.\r\n\r\n1. Can we do `send_and_ping` used in the test with some RPC?\r\n2. How can we try this on testnet? I am assuming: Compile branch, run two nodes on testnet, use `addnode`, spam other node with random addresses (not sure how to do this?) and compare the results for `getnodeaddresses` doing same on master branch.",
      "user": {
        "login": "ghost",
        "id": 10137,
        "node_id": "MDQ6VXNlcjEwMTM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ghost",
        "html_url": "https://github.com/ghost",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ghost/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ghost/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "events_url": "https://api.github.com/users/ghost/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-873138272",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 873143328,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzE0MzMyOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873143328",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T17:13:26Z",
      "updated_at": "2021-07-02T17:13:26Z",
      "author_association": "MEMBER",
      "body": "@prayank23 No, it's testing a P2P aspect, you can't do that through RPC. There is the `addpeeraddress` RPC for injecting new addresses, but it doesn't have (or need) the same rate limiting.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-873143328",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 4972552703,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk3MjU1MjcwMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4972552703",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T17:13:27Z"
    },
    {
      "event": "subscribed",
      "id": 4972552708,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5NzI1NTI3MDg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4972552708",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T17:13:27Z"
    },
    {
      "event": "commented",
      "id": 873208395,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzIwODM5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873208395",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T19:11:30Z",
      "updated_at": "2021-07-02T19:21:06Z",
      "author_association": "MEMBER",
      "body": "Concept ACK to introducing a rate limiting mechanism for addr relay, some general questions about the approach:\r\n\r\nThe approach of a constant counter increase doesn't scale with the total number of self-announcing nodes in the network, while addr traffic to a node probably does (or at least should?). Did you consider the possibility of an adaptive rate limiting approach (e.g. let the token counter increase based on recently observed addr frequency from outbound peers or something like that) that could adapt to changes in network size or in the general efficiency of gossip relay over time - or would that be too complicated/have some other downsides?\r\n\r\nChoosing the rate limit of  0.1 addr/s based on current observations of 0.005-0.025 addr/s also kind of says that we are happy with the current efficiency of addr gossip - are we though? (#21528 would likely increase it, though I'm not sure by how much)\r\n\r\nIt would be great to have some historical references about observed addr/s rate (to see whether it has changed significantly over the years with increasing SPV nodes, introduction of block-relay-only connections etc.), but I would assume this kind of data doesn't exist anywhere...\r\n",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-873208395",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 873214929,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzIxNDkyOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873214929",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T19:26:18Z",
      "updated_at": "2021-07-02T19:26:18Z",
      "author_association": "MEMBER",
      "body": "@mzumsande Those are reasonable points. My thinking is mostly that some limit here is necessary, and if this appears to be too restrictive as the network or other aspects of addr relay change, they can be revisited - those are unlikely to cause dramatic changes in short periods of time. I think an adaptive limit is too easily exploited.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-873214929",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 4973002167,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk3MzAwMjE2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4973002167",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T19:26:19Z"
    },
    {
      "event": "subscribed",
      "id": 4973002169,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5NzMwMDIxNjk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4973002169",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-02T19:26:19Z"
    },
    {
      "event": "closed",
      "id": 4974459757,
      "node_id": "MDExOkNsb3NlZEV2ZW50NDk3NDQ1OTc1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4974459757",
      "actor": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-03T19:00:19Z"
    },
    {
      "event": "reopened",
      "id": 4974459783,
      "node_id": "MDEzOlJlb3BlbmVkRXZlbnQ0OTc0NDU5Nzgz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4974459783",
      "actor": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-03T19:00:21Z"
    },
    {
      "event": "commented",
      "id": 873454941,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzQ1NDk0MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/873454941",
      "actor": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-03T19:00:59Z",
      "updated_at": "2021-07-03T19:00:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "So sorry for that accidental close / open 😳",
      "user": {
        "login": "amitiuttarwar",
        "id": 1500952,
        "node_id": "MDQ6VXNlcjE1MDA5NTI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1500952?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amitiuttarwar",
        "html_url": "https://github.com/amitiuttarwar",
        "followers_url": "https://api.github.com/users/amitiuttarwar/followers",
        "following_url": "https://api.github.com/users/amitiuttarwar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/amitiuttarwar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/amitiuttarwar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/amitiuttarwar/subscriptions",
        "organizations_url": "https://api.github.com/users/amitiuttarwar/orgs",
        "repos_url": "https://api.github.com/users/amitiuttarwar/repos",
        "events_url": "https://api.github.com/users/amitiuttarwar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/amitiuttarwar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-873454941",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 698709971,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk4NzA5OTcx",
      "url": null,
      "actor": null,
      "commit_id": "2decfa58c19d9d6b5604b0931fa34cd94ccc32c8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-698709971",
      "submitted_at": "2021-07-04T22:01:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4980908020,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk4MDkwODAyMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4980908020",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T04:46:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4980925508,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk4MDkyNTUwOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4980925508",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T04:54:59Z"
    },
    {
      "event": "reviewed",
      "id": 699937128,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk5OTM3MTI4",
      "url": null,
      "actor": null,
      "commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Approach ACK dade562ea5479e32c6a49fc92e9646f761b8e376, need to stare a bit more at the test.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-699937128",
      "submitted_at": "2021-07-06T13:34:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 699826384,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Njk5ODI2Mzg0",
      "url": null,
      "actor": null,
      "commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK dade562ea5479e32c6a49fc92e9646f761b8e376",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-699826384",
      "submitted_at": "2021-07-06T16:17:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 700147680,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAwMTQ3Njgw",
      "url": null,
      "actor": null,
      "commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-700147680",
      "submitted_at": "2021-07-06T16:19:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 700155832,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAwMTU1ODMy",
      "url": null,
      "actor": null,
      "commit_id": "87c8d2d072d52c79f092cc432f98c6157fe8e662",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "code review ACK dade562ea5479e32c6a49fc92e9646f761b8e376\r\n\r\n",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-700155832",
      "submitted_at": "2021-07-06T17:40:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4985848780,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk4NTg0ODc4MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4985848780",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-06T22:50:25Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4986284851,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk4NjI4NDg1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4986284851",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T01:37:55Z"
    },
    {
      "event": "reviewed",
      "id": 700707900,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAwNzA3OTAw",
      "url": null,
      "actor": null,
      "commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-700707900",
      "submitted_at": "2021-07-07T08:19:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 700707406,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAwNzA3NDA2",
      "url": null,
      "actor": null,
      "commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a looks good. The 0.005-0.025 addr/s and 0.1 addr/s (`MAX_ADDR_RATE_PER_SECOND`) numbers may have to be reconsidered though.\r\n\r\nI added a prinout to observe the rates on my node.\r\n\r\n<details>\r\n<summary>added printout</summary>\r\n\r\n```diff\r\n         if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n             // Don't increment bucket if it's already full\r\n             const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n             const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n             peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_AD\r\n+            LogPrintf(\"RATE LIMIT: received %u addresses, tokens %u, since last addr message: \"\r\n+                      \"%.6lf addr/sec, peer %s\\n\",\r\n+                      vAddr.size(),\r\n+                      peer->m_addr_token_bucket,\r\n+                      vAddr.size() / CountSecondsDouble(time_diff),\r\n+                      pfrom.addr.ToStringIP());\r\n         }\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>log output</summary>\r\n\r\n```\r\n2021-07-07T09:03:34Z RATE LIMIT: received 1 addresses, tokens 2.86322, since last addr message: 0.034926 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:03:37Z RATE LIMIT: received 1 addresses, tokens 2.20653, since last addr message: 0.045320 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:03:42Z RATE LIMIT: received 47 addresses, tokens 2.62511, since last addr message: 6.168826 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:03:45Z RATE LIMIT: received 5 addresses, tokens 1.39594, since last addr message: 1.262827 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:03:45Z RATE LIMIT: received 1 addresses, tokens 0.396861, since last addr message: 108.236822 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:03:50Z RATE LIMIT: received 1 addresses, tokens 2.46857, since last addr message: 0.079237 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:03:55Z RATE LIMIT: received 9 addresses, tokens 7.73186, since last addr message: 0.133693 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:03:56Z RATE LIMIT: received 1 addresses, tokens 2.12585, since last addr message: 0.152142 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:04:09Z RATE LIMIT: received 10 addresses, tokens 8.06892, since last addr message: 0.141464 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:04:10Z RATE LIMIT: received 1 addresses, tokens 2.82477, since last addr message: 0.041188 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:04:12Z RATE LIMIT: received 80 addresses, tokens 3.63509, since last addr message: 2.657828 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:04:15Z RATE LIMIT: received 1 addresses, tokens 1.87683, since last addr message: 0.053281 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:04:21Z RATE LIMIT: received 3 addresses, tokens 3.55889, since last addr message: 0.123303 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:04:35Z RATE LIMIT: received 1 addresses, tokens 2.8863, since last addr message: 0.049764 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:04:38Z RATE LIMIT: received 2 addresses, tokens 6.57941, since last addr message: 0.030398 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:04:48Z RATE LIMIT: received 1 addresses, tokens 3.14096, since last addr message: 0.079703 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:04:53Z RATE LIMIT: received 2 addresses, tokens 6.00251, since last addr message: 0.140538 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:04:53Z RATE LIMIT: received 2 addresses, tokens 4.79277, since last addr message: 0.048104 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:04:55Z RATE LIMIT: received 4 addresses, tokens 9.27792, since last addr message: 0.043113 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:04:59Z RATE LIMIT: received 2 addresses, tokens 4.60033, since last addr message: 0.334550 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:05:10Z RATE LIMIT: received 2 addresses, tokens 5.48676, since last addr message: 0.040585 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:05:10Z RATE LIMIT: received 2 addresses, tokens 3.28665, since last addr message: 0.155442 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:05:10Z RATE LIMIT: received 4 addresses, tokens 8.39984, since last addr message: 0.047620 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:05:21Z RATE LIMIT: received 2 addresses, tokens 7.83468, since last addr message: 0.078224 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:05:22Z RATE LIMIT: received 2 addresses, tokens 2.4901, since last addr message: 0.166190 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:05:30Z RATE LIMIT: received 5 addresses, tokens 9.84058, since last addr message: 0.062377 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:05:40Z RATE LIMIT: received 7 addresses, tokens 12.8494, since last addr message: 0.059075 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:05:49Z RATE LIMIT: received 4 addresses, tokens 7.42107, since last addr message: 0.101670 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:05:56Z RATE LIMIT: received 5 addresses, tokens 9.09188, since last addr message: 0.079376 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:05:58Z RATE LIMIT: received 4 addresses, tokens 9.56812, since last addr message: 0.107140 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:06:03Z RATE LIMIT: received 13 addresses, tokens 9.68901, since last addr message: 0.172230 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:06:05Z RATE LIMIT: received 5 addresses, tokens 8.38568, since last addr message: 0.141040 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:06:06Z RATE LIMIT: received 10 addresses, tokens 9.32125, since last addr message: 0.148789 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:06:11Z RATE LIMIT: received 1 addresses, tokens 1.4728, since last addr message: 0.127586 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:06:15Z RATE LIMIT: received 4 addresses, tokens 5.84985, since last addr message: 0.074630 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:06:16Z RATE LIMIT: received 1 addresses, tokens 1.37637, since last addr message: 0.094775 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:06:17Z RATE LIMIT: received 4 addresses, tokens 11.158, since last addr message: 0.059187 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:06:18Z RATE LIMIT: received 176 addresses, tokens 6.29241, since last addr message: 7.998060 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:06:28Z RATE LIMIT: received 6 addresses, tokens 8.51784, since last addr message: 0.203409 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:06:30Z RATE LIMIT: received 2 addresses, tokens 1.46008, since last addr message: 0.171282 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:06:30Z RATE LIMIT: received 4 addresses, tokens 1.75868, since last addr message: 0.289371 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:06:36Z RATE LIMIT: received 2 addresses, tokens 2.9657, since last addr message: 0.080228 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:06:36Z RATE LIMIT: received 3 addresses, tokens 3.91656, since last addr message: 0.145159 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:06:39Z RATE LIMIT: received 10 addresses, tokens 11.8759, since last addr message: 0.084204 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:06:44Z RATE LIMIT: received 2 addresses, tokens 7.27696, since last addr message: 0.051397 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:06:49Z RATE LIMIT: received 91 addresses, tokens 12.7167, since last addr message: 1.325119 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:06:51Z RATE LIMIT: received 1 addresses, tokens 2.41899, since last addr message: 0.066559 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:07:01Z RATE LIMIT: received 94 addresses, tokens 3.825, since last addr message: 3.065569 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:07:03Z RATE LIMIT: received 8 addresses, tokens 10.7864, since last addr message: 0.108616 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:07:03Z RATE LIMIT: received 6 addresses, tokens 7.15104, since last addr message: 0.320157 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:07:07Z RATE LIMIT: received 1 addresses, tokens 1.54945, since last addr message: 0.250995 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:07:07Z RATE LIMIT: received 6 addresses, tokens 4.06796, since last addr message: 0.193407 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:07:08Z RATE LIMIT: received 4 addresses, tokens 12.2409, since last addr message: 0.078696 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:07:11Z RATE LIMIT: received 2 addresses, tokens 0.442696, since last addr message: 0.533716 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:07:16Z RATE LIMIT: received 1 addresses, tokens 1.41633, since last addr message: 0.115357 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:07:16Z RATE LIMIT: received 5 addresses, tokens 5.07261, since last addr message: 0.108400 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:07:17Z RATE LIMIT: received 2 addresses, tokens 4.17754, since last addr message: 0.143771 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:07:22Z RATE LIMIT: received 8 addresses, tokens 6.1308, since last addr message: 0.188019 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:07:22Z RATE LIMIT: received 1 addresses, tokens 4.49512, since last addr message: 0.032508 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:07:29Z RATE LIMIT: received 14 addresses, tokens 3.67892, since last addr message: 0.490554 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:07:40Z RATE LIMIT: received 2 addresses, tokens 1.93094, since last addr message: 0.111102 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:07:51Z RATE LIMIT: received 1 addresses, tokens 2.06634, since last addr message: 0.088075 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:07:56Z RATE LIMIT: received 2 addresses, tokens 4.44477, since last addr message: 0.049647 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:07:57Z RATE LIMIT: received 1 addresses, tokens 6.9955, since last addr message: 0.028568 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:08:05Z RATE LIMIT: received 1 addresses, tokens 2.4855, since last addr message: 0.070464 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:08:20Z RATE LIMIT: received 10 addresses, tokens 5.77878, since last addr message: 0.196084 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:08:24Z RATE LIMIT: received 1 addresses, tokens 1.10281, since last addr message: 0.308609 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:08:28Z RATE LIMIT: received 7 addresses, tokens 9.35216, since last addr message: 0.097566 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:08:30Z RATE LIMIT: received 10 addresses, tokens 16.4104, since last addr message: 0.122406 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:08:33Z RATE LIMIT: received 5 addresses, tokens 9.62191, since last addr message: 0.137877 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:08:34Z RATE LIMIT: received 83 addresses, tokens 8.73494, since last addr message: 1.000935 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:08:40Z RATE LIMIT: received 2 addresses, tokens 3.47649, since last addr message: 0.177884 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:08:46Z RATE LIMIT: received 199 addresses, tokens 12.4127, since last addr message: 1.701439 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:08:49Z RATE LIMIT: received 2 addresses, tokens 7.70887, since last addr message: 0.037993 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:08:52Z RATE LIMIT: received 15 addresses, tokens 9.61034, since last addr message: 0.157270 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:08:59Z RATE LIMIT: received 8 addresses, tokens 31.1254, since last addr message: 0.026321 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:08:59Z RATE LIMIT: received 1 addresses, tokens 6.76573, since last addr message: 0.094620 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:08:59Z RATE LIMIT: received 7 addresses, tokens 9.35899, since last addr message: 0.237402 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:09:04Z RATE LIMIT: received 1 addresses, tokens 7.66611, since last addr message: 0.032849 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:09:06Z RATE LIMIT: received 2 addresses, tokens 6.43881, since last addr message: 0.297140 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:09:06Z RATE LIMIT: received 3 addresses, tokens 7.07634, since last addr message: 0.049372 addr/sec, peer 88.99.167.186\r\n2021-07-07T09:09:08Z RATE LIMIT: received 4 addresses, tokens 4.15081, since last addr message: 0.117101 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:09:09Z RATE LIMIT: received 6 addresses, tokens 4.63341, since last addr message: 0.132433 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:09:09Z RATE LIMIT: received 2 addresses, tokens 7.86447, since last addr message: 0.031353 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:09:14Z RATE LIMIT: received 2 addresses, tokens 4.91522, since last addr message: 0.058161 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:09:17Z RATE LIMIT: received 1 addresses, tokens 6.63053, since last addr message: 0.130539 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:09:20Z RATE LIMIT: received 1 addresses, tokens 1.77158, since last addr message: 0.087860 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:09:21Z RATE LIMIT: received 1 addresses, tokens 6.02009, since last addr message: 0.256700 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:09:33Z RATE LIMIT: received 1 addresses, tokens 2.69065, since last addr message: 0.039372 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:09:37Z RATE LIMIT: received 4 addresses, tokens 6.63737, since last addr message: 0.247329 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:09:42Z RATE LIMIT: received 5 addresses, tokens 2.89588, since last addr message: 0.235373 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:09:44Z RATE LIMIT: received 3 addresses, tokens 2.74131, since last addr message: 0.285537 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:09:48Z RATE LIMIT: received 6 addresses, tokens 6.61979, since last addr message: 0.096663 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:09:58Z RATE LIMIT: received 2 addresses, tokens 7.25036, since last addr message: 0.030120 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:10:03Z RATE LIMIT: received 6 addresses, tokens 1.12039, since last addr message: 4.983790 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:10:03Z RATE LIMIT: received 10 addresses, tokens 35.459, since last addr message: 0.028256 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:10:04Z RATE LIMIT: received 4 addresses, tokens 8.84326, since last addr message: 0.061688 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:10:06Z RATE LIMIT: received 2 addresses, tokens 3.35639, since last addr message: 0.081284 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:10:08Z RATE LIMIT: received 1 addresses, tokens 8.26627, since last addr message: 0.018688 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:10:21Z RATE LIMIT: received 2 addresses, tokens 11.9936, since last addr message: 0.026473 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:10:22Z RATE LIMIT: received 22 addresses, tokens 25.9338, since last addr message: 0.093953 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:10:25Z RATE LIMIT: received 6 addresses, tokens 14.8514, since last addr message: 0.073303 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:10:28Z RATE LIMIT: received 6 addresses, tokens 7.7032, since last addr message: 0.118441 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:10:28Z RATE LIMIT: received 4 addresses, tokens 5.13672, since last addr message: 0.091004 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:10:30Z RATE LIMIT: received 1 addresses, tokens 1.98525, since last addr message: 0.354553 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:10:31Z RATE LIMIT: received 3 addresses, tokens 3.85494, since last addr message: 0.120070 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:10:33Z RATE LIMIT: received 1 addresses, tokens 5.02189, since last addr message: 0.091907 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:10:34Z RATE LIMIT: received 8 addresses, tokens 7.1298, since last addr message: 0.130510 addr/sec, peer 188.166.69.73\r\n2021-07-07T09:10:37Z RATE LIMIT: received 1 addresses, tokens 10.0062, since last addr message: 0.086591 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:10:40Z RATE LIMIT: received 1 addresses, tokens 1.95125, since last addr message: 0.103520 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:10:40Z RATE LIMIT: received 1 addresses, tokens 1.76504, since last addr message: 0.109878 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:10:53Z RATE LIMIT: received 3 addresses, tokens 6.07525, since last addr message: 0.146101 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:11:01Z RATE LIMIT: received 1 addresses, tokens 11.3949, since last addr message: 0.041864 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:11:01Z RATE LIMIT: received 1 addresses, tokens 7.93659, since last addr message: 0.013667 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:11:04Z RATE LIMIT: received 4 addresses, tokens 4.73447, since last addr message: 0.111181 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:11:06Z RATE LIMIT: received 5 addresses, tokens 12.0644, since last addr message: 0.073378 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:11:10Z RATE LIMIT: received 1 addresses, tokens 1.39425, since last addr message: 0.151567 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:11:19Z RATE LIMIT: received 7 addresses, tokens 7.78929, since last addr message: 0.091278 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:11:25Z RATE LIMIT: received 1 addresses, tokens 12.7883, since last addr message: 0.041782 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:11:27Z RATE LIMIT: received 4 addresses, tokens 9.56786, since last addr message: 0.152018 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:11:30Z RATE LIMIT: received 11 addresses, tokens 16.8545, since last addr message: 0.160329 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:11:33Z RATE LIMIT: received 5 addresses, tokens 15.7998, since last addr message: 0.058592 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:11:37Z RATE LIMIT: received 7 addresses, tokens 14.1585, since last addr message: 0.075146 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:11:38Z RATE LIMIT: received 1 addresses, tokens 13.0788, since last addr message: 0.077490 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:11:38Z RATE LIMIT: received 1 addresses, tokens 6.52139, since last addr message: 0.017372 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:11:44Z RATE LIMIT: received 2 addresses, tokens 10.8577, since last addr message: 0.052725 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:11:49Z RATE LIMIT: received 3 addresses, tokens 8.67377, since last addr message: 0.053586 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:11:53Z RATE LIMIT: received 4 addresses, tokens 8.10142, since last addr message: 0.157881 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:11:54Z RATE LIMIT: received 5 addresses, tokens 8.37188, since last addr message: 0.067380 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:11:55Z RATE LIMIT: received 6 addresses, tokens 4.32853, since last addr message: 0.169528 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:12:05Z RATE LIMIT: received 6 addresses, tokens 1.37154, since last addr message: 1.614886 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:12:10Z RATE LIMIT: received 1 addresses, tokens 1.8576, since last addr message: 0.065399 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:12:18Z RATE LIMIT: received 1 addresses, tokens 1.6976, since last addr message: 0.075411 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:12:25Z RATE LIMIT: received 3 addresses, tokens 2.36533, since last addr message: 0.198975 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:12:27Z RATE LIMIT: received 4 addresses, tokens 9.48712, since last addr message: 0.104895 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:12:27Z RATE LIMIT: received 4 addresses, tokens 11.5973, since last addr message: 0.069652 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:12:33Z RATE LIMIT: received 3 addresses, tokens 8.14854, since last addr message: 0.074127 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:12:35Z RATE LIMIT: received 1 addresses, tokens 8.33247, since last addr message: 0.136026 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:12:36Z RATE LIMIT: received 14 addresses, tokens 8.95071, since last addr message: 0.163619 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:12:40Z RATE LIMIT: received 4 addresses, tokens 17.5469, since last addr message: 0.059285 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:12:48Z RATE LIMIT: received 2 addresses, tokens 7.52695, since last addr message: 0.098047 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:12:56Z RATE LIMIT: received 11 addresses, tokens 13.2845, since last addr message: 0.141696 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:12:57Z RATE LIMIT: received 2 addresses, tokens 15.1406, since last addr message: 0.025056 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:12:57Z RATE LIMIT: received 1 addresses, tokens 16.1891, since last addr message: 0.013640 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:12:58Z RATE LIMIT: received 7 addresses, tokens 9.76227, since last addr message: 0.109539 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:13:02Z RATE LIMIT: received 1 addresses, tokens 20.5312, since last addr message: 0.011831 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:13:05Z RATE LIMIT: received 1 addresses, tokens 3.88256, since last addr message: 0.034108 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:13:13Z RATE LIMIT: received 1 addresses, tokens 20.5826, since last addr message: 0.095115 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:13:18Z RATE LIMIT: received 2 addresses, tokens 17.2855, since last addr message: 0.053496 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:13:19Z RATE LIMIT: received 2 addresses, tokens 4.66017, since last addr message: 0.084186 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:13:21Z RATE LIMIT: received 6 addresses, tokens 5.90778, since last addr message: 0.108256 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:13:23Z RATE LIMIT: received 1 addresses, tokens 17.7021, since last addr message: 0.039794 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:13:28Z RATE LIMIT: received 6 addresses, tokens 7.67042, since last addr message: 0.086048 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:13:30Z RATE LIMIT: received 1 addresses, tokens 21.2579, since last addr message: 0.059689 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:13:34Z RATE LIMIT: received 2 addresses, tokens 11.2143, since last addr message: 0.032972 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:13:34Z RATE LIMIT: received 1 addresses, tokens 17.8771, since last addr message: 0.085106 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:13:38Z RATE LIMIT: received 1 addresses, tokens 6.73124, since last addr message: 0.025195 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:13:42Z RATE LIMIT: received 3 addresses, tokens 14.0147, since last addr message: 0.044895 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:13:42Z RATE LIMIT: received 4 addresses, tokens 10.9478, since last addr message: 0.073789 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:13:45Z RATE LIMIT: received 66 addresses, tokens 6.83065, since last addr message: 1.671692 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:13:52Z RATE LIMIT: received 9 addresses, tokens 52.4549, since last addr message: 0.030686 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:13:54Z RATE LIMIT: received 2 addresses, tokens 7.35356, since last addr message: 0.123280 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:13:57Z RATE LIMIT: received 1 addresses, tokens 4.54626, since last addr message: 0.034772 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:14:00Z RATE LIMIT: received 2 addresses, tokens 19.4917, since last addr message: 0.076494 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:14:08Z RATE LIMIT: received 2 addresses, tokens 5.61784, since last addr message: 0.042462 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:14:12Z RATE LIMIT: received 1 addresses, tokens 9.95957, since last addr message: 0.033203 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:14:20Z RATE LIMIT: received 1 addresses, tokens 25.3504, since last addr message: 0.019637 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:14:21Z RATE LIMIT: received 2 addresses, tokens 14.9628, since last addr message: 0.050657 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:14:29Z RATE LIMIT: received 3 addresses, tokens 9.6525, since last addr message: 0.042904 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:14:34Z RATE LIMIT: received 2 addresses, tokens 14.2092, since last addr message: 0.160458 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:14:34Z RATE LIMIT: received 2 addresses, tokens 11.1131, since last addr message: 0.092873 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:14:34Z RATE LIMIT: received 2 addresses, tokens 22.9471, since last addr message: 0.026104 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:14:37Z RATE LIMIT: received 4 addresses, tokens 23.1445, since last addr message: 0.039984 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:14:39Z RATE LIMIT: received 1 addresses, tokens 21.4509, since last addr message: 0.198521 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:14:44Z RATE LIMIT: received 1 addresses, tokens 19.7678, since last addr message: 0.160441 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:14:44Z RATE LIMIT: received 3 addresses, tokens 6.76405, since last addr message: 0.050561 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:14:49Z RATE LIMIT: received 5 addresses, tokens 7.78816, since last addr message: 0.119895 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:14:57Z RATE LIMIT: received 2 addresses, tokens 9.54201, since last addr message: 0.033357 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:14:58Z RATE LIMIT: received 3 addresses, tokens 11.7892, since last addr message: 0.046615 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:15:00Z RATE LIMIT: received 2 addresses, tokens 5.3318, since last addr message: 0.127571 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:15:10Z RATE LIMIT: received 1 addresses, tokens 21.4629, since last addr message: 0.037105 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:15:13Z RATE LIMIT: received 3 addresses, tokens 11.0482, since last addr message: 0.068249 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:15:19Z RATE LIMIT: received 2 addresses, tokens 10.858, since last addr message: 0.096673 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:15:20Z RATE LIMIT: received 10 addresses, tokens 16.8365, since last addr message: 0.216110 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:15:22Z RATE LIMIT: received 4 addresses, tokens 30.4833, since last addr message: 0.065221 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:15:26Z RATE LIMIT: received 2 addresses, tokens 14.3614, since last addr message: 0.038107 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:15:30Z RATE LIMIT: received 3 addresses, tokens 20.8126, since last addr message: 0.025866 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:15:32Z RATE LIMIT: received 4 addresses, tokens 25.7308, since last addr message: 0.075759 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:15:35Z RATE LIMIT: received 1 addresses, tokens 10.4747, since last addr message: 0.061857 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:15:42Z RATE LIMIT: received 1 addresses, tokens 22.7058, since last addr message: 0.102559 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:15:44Z RATE LIMIT: received 214 addresses, tokens 27.8031, since last addr message: 2.075361 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:15:46Z RATE LIMIT: received 1 addresses, tokens 19.4894, since last addr message: 0.059634 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:15:53Z RATE LIMIT: received 2 addresses, tokens 9.19042, since last addr message: 0.031239 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:15:56Z RATE LIMIT: received 1 addresses, tokens 12.2993, since last addr message: 0.023523 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:16:00Z RATE LIMIT: received 8 addresses, tokens 13.8318, since last addr message: 0.127190 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:16:04Z RATE LIMIT: received 5 addresses, tokens 23.8656, since last addr message: 0.231506 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:16:07Z RATE LIMIT: received 6 addresses, tokens 8.72865, since last addr message: 0.077633 addr/sec, peer 34.64.249.186\r\n2021-07-07T09:16:08Z RATE LIMIT: received 2 addresses, tokens 12.7048, since last addr message: 0.061916 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:16:13Z RATE LIMIT: received 4 addresses, tokens 12.1641, since last addr message: 0.075080 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:16:14Z RATE LIMIT: received 2 addresses, tokens 9.2765, since last addr message: 0.095874 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:16:21Z RATE LIMIT: received 2 addresses, tokens 27.4736, since last addr message: 0.028528 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:16:24Z RATE LIMIT: received 2 addresses, tokens 4.89172, since last addr message: 0.048917 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:16:25Z RATE LIMIT: received 6 addresses, tokens 63.6259, since last addr message: 0.015720 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:16:31Z RATE LIMIT: received 5 addresses, tokens 33.3879, since last addr message: 0.072416 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:16:36Z RATE LIMIT: received 1 addresses, tokens 9.4441, since last addr message: 0.046134 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:16:36Z RATE LIMIT: received 16 addresses, tokens 12.9596, since last addr message: 0.166185 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:16:36Z RATE LIMIT: received 1 addresses, tokens 22.1182, since last addr message: 0.030745 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:16:38Z RATE LIMIT: received 3 addresses, tokens 9.64981, since last addr message: 0.078575 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:16:40Z RATE LIMIT: received 1 addresses, tokens 10.8341, since last addr message: 0.037454 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:16:42Z RATE LIMIT: received 1 addresses, tokens 1.53153, since last addr message: 0.174854 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:16:42Z RATE LIMIT: received 1 addresses, tokens 4.65103, since last addr message: 0.056841 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:16:45Z RATE LIMIT: received 8 addresses, tokens 20.2268, since last addr message: 0.101711 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:16:46Z RATE LIMIT: received 2 addresses, tokens 10.4692, since last addr message: 0.314913 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:16:49Z RATE LIMIT: received 1 addresses, tokens 7.75894, since last addr message: 0.090161 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:16:50Z RATE LIMIT: received 3 addresses, tokens 22.5355, since last addr message: 0.211675 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:16:51Z RATE LIMIT: received 4 addresses, tokens 28.4708, since last addr message: 0.133455 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:17:01Z RATE LIMIT: received 2 addresses, tokens 25.9197, since last addr message: 0.026917 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:17:01Z RATE LIMIT: received 1 addresses, tokens 7.97517, since last addr message: 0.082222 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:17:09Z RATE LIMIT: received 1 addresses, tokens 6.37987, since last addr message: 0.036646 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:17:15Z RATE LIMIT: received 5 addresses, tokens 12.2982, since last addr message: 0.129731 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:17:27Z RATE LIMIT: received 2 addresses, tokens 34.0466, since last addr message: 0.035344 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:17:28Z RATE LIMIT: received 3 addresses, tokens 9.66036, since last addr message: 0.111724 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:17:31Z RATE LIMIT: received 6 addresses, tokens 12.9883, since last addr message: 0.132769 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:17:39Z RATE LIMIT: received 1 addresses, tokens 33.2238, since last addr message: 0.084950 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:17:40Z RATE LIMIT: received 9 addresses, tokens 19.9434, since last addr message: 0.097418 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:17:47Z RATE LIMIT: received 15 addresses, tokens 22.4076, since last addr message: 0.135034 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:17:50Z RATE LIMIT: received 8 addresses, tokens 7.37865, since last addr message: 0.116837 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:17:59Z RATE LIMIT: received 2 addresses, tokens 12.8546, since last addr message: 0.104646 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:18:04Z RATE LIMIT: received 5 addresses, tokens 30.2376, since last addr message: 0.079140 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:18:06Z RATE LIMIT: received 4 addresses, tokens 12.4384, since last addr message: 0.077818 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:18:07Z RATE LIMIT: received 3 addresses, tokens 9.46511, since last addr message: 0.145804 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:18:13Z RATE LIMIT: received 4 addresses, tokens 32.7461, since last addr message: 0.048337 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:18:18Z RATE LIMIT: received 1 addresses, tokens 12.7406, since last addr message: 0.053024 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:18:19Z RATE LIMIT: received 9 addresses, tokens 28.4098, since last addr message: 0.101416 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:18:28Z RATE LIMIT: received 7 addresses, tokens 13.2928, since last addr message: 0.088463 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:18:32Z RATE LIMIT: received 2 addresses, tokens 28.085, since last addr message: 0.070241 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:18:34Z RATE LIMIT: received 7 addresses, tokens 4.74655, since last addr message: 0.160260 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:18:37Z RATE LIMIT: received 9 addresses, tokens 71.9678, since last addr message: 0.031565 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:18:44Z RATE LIMIT: received 2 addresses, tokens 10.1363, since last addr message: 0.054478 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:18:46Z RATE LIMIT: received 3 addresses, tokens 8.03067, since last addr message: 0.172626 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:18:46Z RATE LIMIT: received 2 addresses, tokens 5.03104, since last addr message: 540.394488 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:18:46Z RATE LIMIT: received 9 addresses, tokens 14.4638, since last addr message: 0.120394 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:18:47Z RATE LIMIT: received 2 addresses, tokens 27.5203, since last addr message: 0.139338 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:18:51Z RATE LIMIT: received 4 addresses, tokens 15.0162, since last addr message: 0.122112 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:18:51Z RATE LIMIT: received 9 addresses, tokens 24.8676, since last addr message: 0.071198 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:18:53Z RATE LIMIT: received 1 addresses, tokens 2.62657, since last addr message: 0.053191 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:18:53Z RATE LIMIT: received 2 addresses, tokens 3.74545, since last addr message: 0.279951 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:18:53Z RATE LIMIT: received 5 addresses, tokens 13.1584, since last addr message: 0.105932 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:18:56Z RATE LIMIT: received 1 addresses, tokens 16.3891, since last addr message: 0.191768 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:19:02Z RATE LIMIT: received 2 addresses, tokens 15.9748, since last addr message: 0.341468 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:19:03Z RATE LIMIT: received 1 addresses, tokens 2.73152, since last addr message: 0.101413 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:19:03Z RATE LIMIT: received 14 addresses, tokens 16.171, since last addr message: 0.147203 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:19:06Z RATE LIMIT: received 1 addresses, tokens 14.3582, since last addr message: 0.260813 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:19:12Z RATE LIMIT: received 1 addresses, tokens 3.11512, since last addr message: 0.105922 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:19:15Z RATE LIMIT: received 1 addresses, tokens 2.39884, since last addr message: 0.352464 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:19:18Z RATE LIMIT: received 1 addresses, tokens 8.62582, since last addr message: 0.031625 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:19:27Z RATE LIMIT: received 5 addresses, tokens 43.0025, since last addr message: 0.046388 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:19:30Z RATE LIMIT: received 2 addresses, tokens 38.3174, since last addr message: 0.635193 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:19:32Z RATE LIMIT: received 4 addresses, tokens 15.128, since last addr message: 0.097281 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:19:33Z RATE LIMIT: received 1 addresses, tokens 30.1271, since last addr message: 0.021707 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:19:33Z RATE LIMIT: received 3 addresses, tokens 16.073, since last addr message: 0.110506 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:19:33Z RATE LIMIT: received 8 addresses, tokens 13.0779, since last addr message: 0.161893 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:19:34Z RATE LIMIT: received 5 addresses, tokens 26.8733, since last addr message: 0.066993 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:19:37Z RATE LIMIT: received 1 addresses, tokens 36.9902, since last addr message: 0.148625 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:19:42Z RATE LIMIT: received 6 addresses, tokens 37.6269, since last addr message: 0.067562 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:19:43Z RATE LIMIT: received 2 addresses, tokens 10.1248, since last addr message: 0.080033 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:19:44Z RATE LIMIT: received 4 addresses, tokens 4.23541, since last addr message: 0.141016 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:19:46Z RATE LIMIT: received 5 addresses, tokens 13.4185, since last addr message: 0.095056 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:19:50Z RATE LIMIT: received 2 addresses, tokens 8.9049, since last addr message: 0.256379 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:19:56Z RATE LIMIT: received 2 addresses, tokens 31.4362, since last addr message: 0.086615 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:19:58Z RATE LIMIT: received 4 addresses, tokens 7.20972, since last addr message: 0.073017 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:20:03Z RATE LIMIT: received 2 addresses, tokens 38.6171, since last addr message: 0.076138 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:20:05Z RATE LIMIT: received 3 addresses, tokens 24.9634, since last addr message: 0.097085 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:20:10Z RATE LIMIT: received 3 addresses, tokens 8.72288, since last addr message: 0.082304 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:20:12Z RATE LIMIT: received 2 addresses, tokens 9.03493, since last addr message: 0.093895 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:20:17Z RATE LIMIT: received 2 addresses, tokens 6.40706, since last addr message: 0.292323 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:20:19Z RATE LIMIT: received 1 addresses, tokens 7.76774, since last addr message: 0.136461 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:20:24Z RATE LIMIT: received 1 addresses, tokens 35.8485, since last addr message: 0.023687 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:20:32Z RATE LIMIT: received 5 addresses, tokens 5.11436, since last addr message: 0.102481 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:20:35Z RATE LIMIT: received 6 addresses, tokens 6.9078, since last addr message: 0.162246 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:20:38Z RATE LIMIT: received 8 addresses, tokens 12.1765, since last addr message: 0.075830 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:20:43Z RATE LIMIT: received 2 addresses, tokens 18.2824, since last addr message: 0.027955 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:20:50Z RATE LIMIT: received 1 addresses, tokens 37.4015, since last addr message: 0.039169 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:20:57Z RATE LIMIT: received 1 addresses, tokens 37.094, since last addr message: 0.144418 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:20:59Z RATE LIMIT: received 9 addresses, tokens 15.781, since last addr message: 0.122241 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:21:02Z RATE LIMIT: received 5 addresses, tokens 21.9935, since last addr message: 0.056050 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:21:03Z RATE LIMIT: received 1 addresses, tokens 3.16555, since last addr message: 0.032774 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:21:06Z RATE LIMIT: received 4 addresses, tokens 9.3157, since last addr message: 0.081489 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:21:09Z RATE LIMIT: received 3 addresses, tokens 11.7394, since last addr message: 0.060342 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:21:26Z RATE LIMIT: received 1 addresses, tokens 19.3838, since last addr message: 0.041837 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:21:27Z RATE LIMIT: received 3 addresses, tokens 10.5198, since last addr message: 0.168494 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:21:29Z RATE LIMIT: received 1 addresses, tokens 7.67079, since last addr message: 0.042461 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:21:31Z RATE LIMIT: received 9 addresses, tokens 30.6118, since last addr message: 0.104065 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:21:33Z RATE LIMIT: received 1 addresses, tokens 8.1774, since last addr message: 0.152077 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:21:39Z RATE LIMIT: received 4 addresses, tokens 39.7242, since last addr message: 0.038880 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:21:40Z RATE LIMIT: received 12 addresses, tokens 5.88517, since last addr message: 0.322613 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:21:42Z RATE LIMIT: received 10 addresses, tokens 7.64514, since last addr message: 0.148427 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:21:43Z RATE LIMIT: received 3 addresses, tokens 20.0595, since last addr message: 0.179032 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:21:44Z RATE LIMIT: received 7 addresses, tokens 11.2075, since last addr message: 0.158139 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:21:48Z RATE LIMIT: received 5 addresses, tokens 22.7058, since last addr message: 0.077841 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:21:49Z RATE LIMIT: received 1 addresses, tokens 1.24254, since last addr message: 0.412299 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:21:49Z RATE LIMIT: received 1 addresses, tokens 4.78603, since last addr message: 0.172842 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:21:55Z RATE LIMIT: received 6 addresses, tokens 41.8893, since last addr message: 0.103532 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:21:56Z RATE LIMIT: received 1 addresses, tokens 18.5135, since last addr message: 0.123799 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:21:58Z RATE LIMIT: received 10 addresses, tokens 48.1238, since last addr message: 0.086906 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:21:59Z RATE LIMIT: received 3 addresses, tokens 9.75226, since last addr message: 0.116511 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:22:01Z RATE LIMIT: received 1 addresses, tokens 18.8451, since last addr message: 0.056002 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:22:04Z RATE LIMIT: received 2 addresses, tokens 10.1175, since last addr message: 0.058026 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:22:13Z RATE LIMIT: received 17 addresses, tokens 13.6067, since last addr message: 0.180273 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:22:15Z RATE LIMIT: received 4 addresses, tokens 3.94619, since last addr message: 0.121173 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:22:17Z RATE LIMIT: received 2 addresses, tokens 19.6542, since last addr message: 0.093428 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:22:28Z RATE LIMIT: received 8 addresses, tokens 5.69023, since last addr message: 0.166491 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:22:28Z RATE LIMIT: received 2 addresses, tokens 18.7796, since last addr message: 0.177723 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:22:30Z RATE LIMIT: received 5 addresses, tokens 40.8701, since last addr message: 0.097166 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:22:32Z RATE LIMIT: received 5 addresses, tokens 8.00999, since last addr message: 0.118372 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:22:33Z RATE LIMIT: received 4 addresses, tokens 39.7383, since last addr message: 0.103922 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:22:38Z RATE LIMIT: received 3 addresses, tokens 21.595, since last addr message: 0.080003 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:22:41Z RATE LIMIT: received 4 addresses, tokens 3.42258, since last addr message: 0.142050 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:22:41Z RATE LIMIT: received 6 addresses, tokens 11.7974, since last addr message: 0.163051 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:22:44Z RATE LIMIT: received 7 addresses, tokens 5.69418, since last addr message: 0.128402 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:22:49Z RATE LIMIT: received 3 addresses, tokens 2.77222, since last addr message: 0.144092 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:22:50Z RATE LIMIT: received 2 addresses, tokens 1.28916, since last addr message: 0.336147 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:22:52Z RATE LIMIT: received 5 addresses, tokens 19.1385, since last addr message: 0.211963 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:22:53Z RATE LIMIT: received 1 addresses, tokens 4.04238, since last addr message: 0.032869 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:22:53Z RATE LIMIT: received 5 addresses, tokens 29.8344, since last addr message: 0.060808 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:22:55Z RATE LIMIT: received 1 addresses, tokens 14.3993, since last addr message: 0.383415 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:22:55Z RATE LIMIT: received 7 addresses, tokens 96.6163, since last addr message: 0.017953 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:22:56Z RATE LIMIT: received 1 addresses, tokens 38.4714, since last addr message: 0.038442 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:22:58Z RATE LIMIT: received 1 addresses, tokens 38.1765, since last addr message: 0.041014 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:23:10Z RATE LIMIT: received 2 addresses, tokens 26.4842, since last addr message: 0.121229 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:23:11Z RATE LIMIT: received 67 addresses, tokens 13.97, since last addr message: 0.928271 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:23:26Z RATE LIMIT: received 8 addresses, tokens 91.8624, since last addr message: 0.027687 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:23:30Z RATE LIMIT: received 4 addresses, tokens 8.40881, since last addr message: 0.053601 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:24:14Z RATE LIMIT: received 11 addresses, tokens 8.88125, since last addr message: 0.245951 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:24:18Z RATE LIMIT: received 2 addresses, tokens 28.5825, since last addr message: 0.020025 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:24:18Z RATE LIMIT: received 1 addresses, tokens 1.12454, since last addr message: 0.802931 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:24:31Z RATE LIMIT: received 2 addresses, tokens 14.9516, since last addr message: 0.016748 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:24:31Z RATE LIMIT: received 4 addresses, tokens 32.6281, since last addr message: 0.049116 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:24:34Z RATE LIMIT: received 2 addresses, tokens 17.1213, since last addr message: 0.017662 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:24:49Z RATE LIMIT: received 4 addresses, tokens 10.795, since last addr message: 0.040712 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:24:51Z RATE LIMIT: received 2 addresses, tokens 48.4897, since last addr message: 0.017679 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:24:54Z RATE LIMIT: received 1 addresses, tokens 55.7466, since last addr message: 0.005674 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:24:57Z RATE LIMIT: received 1 addresses, tokens 13.0575, since last addr message: 0.007832 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:25:03Z RATE LIMIT: received 2 addresses, tokens 50.1586, since last addr message: 0.015764 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:25:03Z RATE LIMIT: received 139 addresses, tokens 5.77002, since last addr message: 2.843251 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:25:05Z RATE LIMIT: received 2 addresses, tokens 14.8264, since last addr message: 0.013885 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:25:07Z RATE LIMIT: received 1 addresses, tokens 16.4715, since last addr message: 0.007447 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:25:12Z RATE LIMIT: received 1 addresses, tokens 15.0343, since last addr message: 0.007012 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:25:24Z RATE LIMIT: received 2 addresses, tokens 14.7207, since last addr message: 0.105579 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:25:28Z RATE LIMIT: received 3 addresses, tokens 15.6521, since last addr message: 0.185433 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:25:29Z RATE LIMIT: received 5 addresses, tokens 28.8106, since last addr message: 0.032444 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:25:32Z RATE LIMIT: received 7 addresses, tokens 89.8954, since last addr message: 0.007798 addr/sec, peer 188.166.69.73\r\n2021-07-07T09:25:35Z RATE LIMIT: received 1 addresses, tokens 51.3696, since last addr message: 0.031143 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:25:39Z RATE LIMIT: received 1 addresses, tokens 21.6319, since last addr message: 0.015359 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:25:49Z RATE LIMIT: received 1 addresses, tokens 14.8163, since last addr message: 0.046206 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:25:50Z RATE LIMIT: received 4 addresses, tokens 35.7147, since last addr message: 0.043801 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:25:54Z RATE LIMIT: received 1 addresses, tokens 5.84196, since last addr message: 0.019716 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:25:56Z RATE LIMIT: received 2 addresses, tokens 15.9426, since last addr message: 0.062076 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:25:59Z RATE LIMIT: received 10 addresses, tokens 7.73151, since last addr message: 0.148555 addr/sec, peer 2a03:b0c0:2:d0::4bc:2001\r\n2021-07-07T09:26:09Z RATE LIMIT: received 169 addresses, tokens 6.35832, since last addr message: 11.145061 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:26:27Z RATE LIMIT: received 2 addresses, tokens 13.0207, since last addr message: 0.015509 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:26:28Z RATE LIMIT: received 3 addresses, tokens 108.281, since last addr message: 0.002879 addr/sec, peer 88.99.167.186\r\n2021-07-07T09:26:31Z RATE LIMIT: received 1 addresses, tokens 25.827, since last addr message: 0.019249 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:26:34Z RATE LIMIT: received 1 addresses, tokens 24.1384, since last addr message: 0.011538 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:26:37Z RATE LIMIT: received 4 addresses, tokens 41.2226, since last addr message: 0.031760 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:26:47Z RATE LIMIT: received 2 addresses, tokens 57.502, since last addr message: 0.028041 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:26:55Z RATE LIMIT: received 7 addresses, tokens 66.8491, since last addr message: 0.057839 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:27:00Z RATE LIMIT: received 2 addresses, tokens 27.7685, since last addr message: 0.067991 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:27:03Z RATE LIMIT: received 2 addresses, tokens 5.74193, since last addr message: 0.037150 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:27:05Z RATE LIMIT: received 4 addresses, tokens 33.3955, since last addr message: 0.041733 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:27:13Z RATE LIMIT: received 2 addresses, tokens 40.8211, since last addr message: 0.055579 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:27:15Z RATE LIMIT: received 1 addresses, tokens 15.81, since last addr message: 0.020880 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:27:22Z RATE LIMIT: received 1 addresses, tokens 31.1008, since last addr message: 0.058641 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:27:23Z RATE LIMIT: received 7 addresses, tokens 22.1772, since last addr message: 0.045507 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:27:27Z RATE LIMIT: received 1 addresses, tokens 62.9918, since last addr message: 0.031820 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:27:30Z RATE LIMIT: received 4 addresses, tokens 30.8593, since last addr message: 0.022337 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:27:33Z RATE LIMIT: received 1 addresses, tokens 6.79025, since last addr message: 0.032805 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:27:41Z RATE LIMIT: received 2 addresses, tokens 41.6232, since last addr message: 0.071376 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:27:42Z RATE LIMIT: received 3 addresses, tokens 17.0461, since last addr message: 0.160520 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:27:46Z RATE LIMIT: received 8 addresses, tokens 24.9899, since last addr message: 0.072416 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:27:48Z RATE LIMIT: received 1 addresses, tokens 32.7755, since last addr message: 0.037387 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:27:51Z RATE LIMIT: received 7 addresses, tokens 30.8192, since last addr message: 0.138594 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:27:53Z RATE LIMIT: received 2 addresses, tokens 7.76158, since last addr message: 0.101455 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:27:54Z RATE LIMIT: received 10 addresses, tokens 29.7359, since last addr message: 0.056566 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:27:55Z RATE LIMIT: received 2 addresses, tokens 18.742, since last addr message: 0.050864 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:28:01Z RATE LIMIT: received 3 addresses, tokens 26.9711, since last addr message: 0.022805 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:28:05Z RATE LIMIT: received 3 addresses, tokens 65.8521, since last addr message: 0.077714 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:28:13Z RATE LIMIT: received 10 addresses, tokens 112.573, since last addr message: 0.034830 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:28:14Z RATE LIMIT: received 1 addresses, tokens 63.6564, since last addr message: 0.124334 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:28:14Z RATE LIMIT: received 4 addresses, tokens 19.7099, since last addr message: 0.147059 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:28:20Z RATE LIMIT: received 5 addresses, tokens 67.3685, since last addr message: 0.023948 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:28:42Z RATE LIMIT: received 2 addresses, tokens 10.5981, since last addr message: 0.041352 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:28:43Z RATE LIMIT: received 2 addresses, tokens 37.2551, since last addr message: 0.036499 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:28:45Z RATE LIMIT: received 1 addresses, tokens 8.97894, since last addr message: 0.262600 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:28:46Z RATE LIMIT: received 2 addresses, tokens 21.842, since last addr message: 0.039216 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:28:46Z RATE LIMIT: received 5 addresses, tokens 34.4238, since last addr message: 0.066099 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:28:47Z RATE LIMIT: received 2 addresses, tokens 20.0081, since last addr message: 1.203536 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:28:55Z RATE LIMIT: received 3 addresses, tokens 25.8147, since last addr message: 0.049352 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:28:55Z RATE LIMIT: received 5 addresses, tokens 30.2442, since last addr message: 0.077822 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:29:04Z RATE LIMIT: received 4 addresses, tokens 69.2401, since last addr message: 0.029116 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:29:04Z RATE LIMIT: received 1 addresses, tokens 19.7004, since last addr message: 0.059092 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:29:05Z RATE LIMIT: received 11 addresses, tokens 30.3621, since last addr message: 0.172116 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:29:12Z RATE LIMIT: received 1 addresses, tokens 66.0485, since last addr message: 0.123702 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:29:12Z RATE LIMIT: received 1 addresses, tokens 38.1886, since last addr message: 0.034089 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:29:16Z RATE LIMIT: received 4 addresses, tokens 27.2911, since last addr message: 0.195411 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:29:16Z RATE LIMIT: received 10 addresses, tokens 127.77, since last addr message: 0.026210 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:29:17Z RATE LIMIT: received 15 addresses, tokens 52.4344, since last addr message: 0.072395 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:29:22Z RATE LIMIT: received 3 addresses, tokens 49.6783, since last addr message: 0.029835 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:29:24Z RATE LIMIT: received 2 addresses, tokens 21.2732, since last addr message: 0.104653 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:29:25Z RATE LIMIT: received 8 addresses, tokens 22.8582, since last addr message: 0.111915 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:29:30Z RATE LIMIT: received 7 addresses, tokens 33.8481, since last addr message: 0.158218 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:29:31Z RATE LIMIT: received 11 addresses, tokens 24.9301, since last addr message: 0.101066 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:29:36Z RATE LIMIT: received 4 addresses, tokens 39.5649, since last addr message: 0.168328 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:29:37Z RATE LIMIT: received 1 addresses, tokens 20.5993, since last addr message: 0.075412 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:29:38Z RATE LIMIT: received 3 addresses, tokens 22.0442, since last addr message: 0.089719 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:29:38Z RATE LIMIT: received 4 addresses, tokens 71.0752, since last addr message: 0.047512 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:29:39Z RATE LIMIT: received 1 addresses, tokens 19.1469, since last addr message: 0.973562 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:29:45Z RATE LIMIT: received 10 addresses, tokens 27.8786, since last addr message: 0.197475 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:29:46Z RATE LIMIT: received 1 addresses, tokens 20.4307, since last addr message: 0.120277 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:29:53Z RATE LIMIT: received 1 addresses, tokens 19.5322, since last addr message: 0.072186 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:30:00Z RATE LIMIT: received 2 addresses, tokens 18.3813, since last addr message: 0.056769 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:30:08Z RATE LIMIT: received 6 addresses, tokens 21.6649, since last addr message: 0.268554 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:30:09Z RATE LIMIT: received 3 addresses, tokens 28.6407, since last addr message: 0.056079 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:30:14Z RATE LIMIT: received 7 addresses, tokens 31.2775, since last addr message: 0.158035 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:30:15Z RATE LIMIT: received 4 addresses, tokens 20.8598, since last addr message: 0.134174 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:30:19Z RATE LIMIT: received 2 addresses, tokens 71.1889, since last addr message: 0.048618 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:30:22Z RATE LIMIT: received 14 addresses, tokens 17.6941, since last addr message: 0.144104 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:30:29Z RATE LIMIT: received 2 addresses, tokens 27.662, since last addr message: 0.098947 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:30:30Z RATE LIMIT: received 7 addresses, tokens 19.8997, since last addr message: 0.117261 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:30:31Z RATE LIMIT: received 7 addresses, tokens 41.0844, since last addr message: 0.126824 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:30:39Z RATE LIMIT: received 6 addresses, tokens 73.6987, since last addr message: 0.069362 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:30:39Z RATE LIMIT: received 2 addresses, tokens 54.366, since last addr message: 0.026016 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:30:39Z RATE LIMIT: received 7 addresses, tokens 45.6739, since last addr message: 0.084957 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:30:39Z RATE LIMIT: received 2 addresses, tokens 26.6596, since last addr message: 0.200475 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:30:41Z RATE LIMIT: received 4 addresses, tokens 23.331, since last addr message: 0.083353 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:30:48Z RATE LIMIT: received 3 addresses, tokens 21.1905, since last addr message: 0.062381 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:30:52Z RATE LIMIT: received 2 addresses, tokens 6.60666, since last addr message: 0.068669 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:30:53Z RATE LIMIT: received 1 addresses, tokens 26.0741, since last addr message: 0.070698 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:30:57Z RATE LIMIT: received 1 addresses, tokens 20.9865, since last addr message: 0.060407 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:30:57Z RATE LIMIT: received 2 addresses, tokens 19.064, since last addr message: 0.228958 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:31:03Z RATE LIMIT: received 2 addresses, tokens 73.5559, since last addr message: 0.045798 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:31:04Z RATE LIMIT: received 9 addresses, tokens 78.864, since last addr message: 0.054560 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:31:05Z RATE LIMIT: received 1 addresses, tokens 17.8422, since last addr message: 0.128491 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:31:08Z RATE LIMIT: received 2 addresses, tokens 16.6413, since last addr message: 0.053454 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:31:08Z RATE LIMIT: received 1 addresses, tokens 41.573, since last addr message: 0.034493 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:31:14Z RATE LIMIT: received 5 addresses, tokens 22.6933, since last addr message: 0.085712 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:31:18Z RATE LIMIT: received 11 addresses, tokens 22.6464, since last addr message: 0.157558 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:31:18Z RATE LIMIT: received 1 addresses, tokens 71.2122, since last addr message: 0.074171 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:31:24Z RATE LIMIT: received 5 addresses, tokens 39.2992, since last addr message: 0.095880 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:31:25Z RATE LIMIT: received 81 addresses, tokens 28.2396, since last addr message: 2.558828 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:31:26Z RATE LIMIT: received 2 addresses, tokens 8.05444, since last addr message: 0.058008 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:31:27Z RATE LIMIT: received 2 addresses, tokens 22.9725, since last addr message: 0.066978 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:31:29Z RATE LIMIT: received 1 addresses, tokens 16.7921, since last addr message: 0.046493 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:31:32Z RATE LIMIT: received 9 addresses, tokens 32.0212, since last addr message: 0.116223 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:31:33Z RATE LIMIT: received 1 addresses, tokens 71.7163, since last addr message: 0.066484 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:31:33Z RATE LIMIT: received 3 addresses, tokens 73.1855, since last addr message: 0.054677 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:31:37Z RATE LIMIT: received 3 addresses, tokens 20.0313, since last addr message: 0.094072 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:31:43Z RATE LIMIT: received 1 addresses, tokens 36.1974, since last addr message: 0.052682 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:31:46Z RATE LIMIT: received 1 addresses, tokens 17.4726, since last addr message: 0.059506 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:31:47Z RATE LIMIT: received 2 addresses, tokens 24.4996, since last addr message: 0.135285 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:31:51Z RATE LIMIT: received 1 addresses, tokens 23.3658, since last addr message: 0.041785 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:31:51Z RATE LIMIT: received 1 addresses, tokens 44.8552, since last addr message: 0.023353 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:31:53Z RATE LIMIT: received 4 addresses, tokens 8.78532, since last addr message: 0.146473 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:32:01Z RATE LIMIT: received 6 addresses, tokens 15.9341, since last addr message: 0.139936 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:32:02Z RATE LIMIT: received 1 addresses, tokens 3.95673, since last addr message: 0.026902 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:32:15Z RATE LIMIT: received 2 addresses, tokens 74.9639, since last addr message: 0.047085 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:32:16Z RATE LIMIT: received 3 addresses, tokens 20.9848, since last addr message: 0.075882 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:32:17Z RATE LIMIT: received 1 addresses, tokens 74.5224, since last addr message: 0.023057 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:32:19Z RATE LIMIT: received 6 addresses, tokens 19.7569, since last addr message: 0.182688 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:32:19Z RATE LIMIT: received 4 addresses, tokens 11.7915, since last addr message: 0.215358 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:32:21Z RATE LIMIT: received 1 addresses, tokens 4.87072, since last addr message: 0.052247 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:32:26Z RATE LIMIT: received 1 addresses, tokens 74.4344, since last addr message: 0.109659 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:32:30Z RATE LIMIT: received 6 addresses, tokens 80.3127, since last addr message: 0.068518 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:32:35Z RATE LIMIT: received 6 addresses, tokens 25.8138, since last addr message: 0.073887 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:32:35Z RATE LIMIT: received 4 addresses, tokens 19.8732, since last addr message: 0.211816 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:32:37Z RATE LIMIT: received 5 addresses, tokens 9.1063, since last addr message: 0.115714 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:32:39Z RATE LIMIT: received 1 addresses, tokens 16.267, since last addr message: 0.253979 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:32:41Z RATE LIMIT: received 3 addresses, tokens 48.8933, since last addr message: 0.059546 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:32:42Z RATE LIMIT: received 1 addresses, tokens 75.0179, since last addr message: 0.063151 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:32:46Z RATE LIMIT: received 1 addresses, tokens 46.3505, since last addr message: 0.218705 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:32:49Z RATE LIMIT: received 5 addresses, tokens 28.7318, since last addr message: 0.080228 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:32:49Z RATE LIMIT: received 1 addresses, tokens 74.7787, since last addr message: 0.131431 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:32:49Z RATE LIMIT: received 3 addresses, tokens 6.67285, since last addr message: 0.107062 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:32:54Z RATE LIMIT: received 7 addresses, tokens 42.3425, since last addr message: 0.097968 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:32:58Z RATE LIMIT: received 1 addresses, tokens 17.1481, since last addr message: 0.053158 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:32:59Z RATE LIMIT: received 8 addresses, tokens 29.1874, since last addr message: 0.117275 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:32:59Z RATE LIMIT: received 3 addresses, tokens 46.6947, since last addr message: 0.223185 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:33:02Z RATE LIMIT: received 9 addresses, tokens 131.469, since last addr message: 0.031146 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:33:06Z RATE LIMIT: received 2 addresses, tokens 5.28086, since last addr message: 0.124377 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:33:09Z RATE LIMIT: received 6 addresses, tokens 18.7308, since last addr message: 0.120630 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:33:21Z RATE LIMIT: received 1 addresses, tokens 13.9776, since last addr message: 0.080209 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:33:22Z RATE LIMIT: received 1 addresses, tokens 27.023, since last addr message: 0.030384 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:33:23Z RATE LIMIT: received 9 addresses, tokens 14.1404, since last addr message: 0.141758 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:33:28Z RATE LIMIT: received 2 addresses, tokens 77.599, since last addr message: 0.052352 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:33:28Z RATE LIMIT: received 5 addresses, tokens 19.1636, since last addr message: 0.165813 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:33:29Z RATE LIMIT: received 1 addresses, tokens 13.7815, since last addr message: 0.124381 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:33:34Z RATE LIMIT: received 3 addresses, tokens 47.1297, since last addr message: 0.087336 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:33:35Z RATE LIMIT: received 2 addresses, tokens 6.34495, since last addr message: 0.166030 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:33:39Z RATE LIMIT: received 8 addresses, tokens 10.347, since last addr message: 0.128192 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:33:39Z RATE LIMIT: received 5 addresses, tokens 81.3454, since last addr message: 0.059655 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:33:47Z RATE LIMIT: received 4 addresses, tokens 7.41258, since last addr message: 0.096812 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:33:47Z RATE LIMIT: received 4 addresses, tokens 40.6426, since last addr message: 0.075471 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:33:52Z RATE LIMIT: received 7 addresses, tokens 82.4911, since last addr message: 0.085591 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:33:58Z RATE LIMIT: received 2 addresses, tokens 67.6079, since last addr message: 0.004497 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:34:02Z RATE LIMIT: received 4 addresses, tokens 28.542, since last addr message: 0.045828 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:34:03Z RATE LIMIT: received 1 addresses, tokens 47.0135, since last addr message: 0.034677 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:34:05Z RATE LIMIT: received 5 addresses, tokens 79.2993, since last addr message: 0.135124 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:34:07Z RATE LIMIT: received 2 addresses, tokens 79.1146, since last addr message: 0.072224 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:34:08Z RATE LIMIT: received 4 addresses, tokens 30.6025, since last addr message: 0.087346 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:34:08Z RATE LIMIT: received 1 addresses, tokens 38.7138, since last addr message: 0.048280 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:34:08Z RATE LIMIT: received 8 addresses, tokens 18.1791, since last addr message: 0.199228 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:34:14Z RATE LIMIT: received 2 addresses, tokens 8.26433, since last addr message: 0.051028 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:34:16Z RATE LIMIT: received 2 addresses, tokens 78.0296, since last addr message: 0.218570 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:34:21Z RATE LIMIT: received 7 addresses, tokens 17.9077, since last addr message: 0.136554 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:34:24Z RATE LIMIT: received 1 addresses, tokens 76.829, since last addr message: 0.125097 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:34:31Z RATE LIMIT: received 1 addresses, tokens 28.9857, since last addr message: 0.041960 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:34:35Z RATE LIMIT: received 5 addresses, tokens 8.21945, since last addr message: 0.104018 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:34:35Z RATE LIMIT: received 3 addresses, tokens 49.2939, since last addr message: 0.091453 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:34:43Z RATE LIMIT: received 1 addresses, tokens 1.01468, since last addr message: 6.813521 addr/sec, peer 46.101.235.143\r\n2021-07-07T09:34:44Z RATE LIMIT: received 2 addresses, tokens 28.6852, since last addr message: 0.048273 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:34:44Z RATE LIMIT: received 1 addresses, tokens 70.154, since last addr message: 0.021997 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:34:45Z RATE LIMIT: received 11 addresses, tokens 76.9947, since last addr message: 0.044663 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:34:45Z RATE LIMIT: received 2 addresses, tokens 78.3444, since last addr message: 0.049443 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:34:45Z RATE LIMIT: received 3 addresses, tokens 9.41524, since last addr message: 0.095211 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:34:47Z RATE LIMIT: received 3 addresses, tokens 13.5318, since last addr message: 0.114324 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:34:47Z RATE LIMIT: received 166 addresses, tokens 9.13735, since last addr message: 2.444632 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:34:48Z RATE LIMIT: received 4 addresses, tokens 78.2268, since last addr message: 0.166820 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:34:48Z RATE LIMIT: received 15 addresses, tokens 32.1046, since last addr message: 0.137398 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:34:55Z RATE LIMIT: received 4 addresses, tokens 48.2641, since last addr message: 0.203019 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:34:55Z RATE LIMIT: received 5 addresses, tokens 81.8274, since last addr message: 0.078910 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:35:01Z RATE LIMIT: received 8 addresses, tokens 152.246, since last addr message: 0.023204 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:35:01Z RATE LIMIT: received 1 addresses, tokens 7.99851, since last addr message: 0.063160 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:35:08Z RATE LIMIT: received 1 addresses, tokens 31.6315, since last addr message: 0.027429 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:35:10Z RATE LIMIT: received 1 addresses, tokens 78.2754, since last addr message: 0.069060 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:35:11Z RATE LIMIT: received 6 addresses, tokens 16.4986, since last addr message: 0.094944 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:35:13Z RATE LIMIT: received 12 addresses, tokens 7.06091, since last addr message: 0.312381 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:35:15Z RATE LIMIT: received 3 addresses, tokens 79.3107, since last addr message: 0.101138 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:35:17Z RATE LIMIT: received 2 addresses, tokens 30.0216, since last addr message: 0.059944 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:35:21Z RATE LIMIT: received 2 addresses, tokens 78.421, since last addr message: 0.174589 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:35:21Z RATE LIMIT: received 4 addresses, tokens 45.0891, since last addr message: 0.054235 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:35:22Z RATE LIMIT: received 5 addresses, tokens 3.66563, since last addr message: 0.141712 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:35:23Z RATE LIMIT: received 1 addresses, tokens 41.2917, since last addr message: 0.493515 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:35:25Z RATE LIMIT: received 1 addresses, tokens 47.2442, since last addr message: 0.033557 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:35:25Z RATE LIMIT: received 29 addresses, tokens 1.24595, since last addr message: 2.447167 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:35:27Z RATE LIMIT: received 2 addresses, tokens 12.0333, since last addr message: 0.130321 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:35:30Z RATE LIMIT: received 2 addresses, tokens 0.738324, since last addr message: 0.406198 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:35:30Z RATE LIMIT: received 2 addresses, tokens 77.8555, since last addr message: 0.129461 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:35:31Z RATE LIMIT: received 2 addresses, tokens 9.93625, since last addr message: 0.068080 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:35:31Z RATE LIMIT: received 2 addresses, tokens 77.3954, since last addr message: 0.205255 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:35:34Z RATE LIMIT: received 1 addresses, tokens 70.9405, since last addr message: 0.020219 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:35:36Z RATE LIMIT: received 4 addresses, tokens 21.8702, since last addr message: 0.083934 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:35:42Z RATE LIMIT: received 3 addresses, tokens 30.521, since last addr message: 0.120032 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:35:46Z RATE LIMIT: received 3 addresses, tokens 48.3494, since last addr message: 0.142499 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:35:50Z RATE LIMIT: received 4 addresses, tokens 80.4118, since last addr message: 0.064672 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:35:55Z RATE LIMIT: received 2 addresses, tokens 28.7855, since last addr message: 0.158164 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:35:56Z RATE LIMIT: received 1 addresses, tokens 72.1071, since last addr message: 0.046156 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:35:57Z RATE LIMIT: received 6 addresses, tokens 13.0157, since last addr message: 0.201181 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:36:01Z RATE LIMIT: received 2 addresses, tokens 77.4711, since last addr message: 0.188820 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:36:08Z RATE LIMIT: received 3 addresses, tokens 4.49408, since last addr message: 0.079877 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:36:11Z RATE LIMIT: received 4 addresses, tokens 5.58052, since last addr message: 0.081385 addr/sec, peer 70.64.27.12\r\n2021-07-07T09:36:14Z RATE LIMIT: received 6 addresses, tokens 12.2396, since last addr message: 0.139425 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:36:18Z RATE LIMIT: received 1 addresses, tokens 78.5741, since last addr message: 0.010616 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:36:19Z RATE LIMIT: received 3 addresses, tokens 48.6127, since last addr message: 0.091933 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:36:21Z RATE LIMIT: received 1 addresses, tokens 9.46512, since last addr message: 0.040826 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:36:23Z RATE LIMIT: received 9 addresses, tokens 20.1561, since last addr message: 0.093514 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:36:28Z RATE LIMIT: received 2 addresses, tokens 81.6888, since last addr message: 0.034286 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:36:30Z RATE LIMIT: received 2 addresses, tokens 9.3169, since last addr message: 0.234801 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:36:32Z RATE LIMIT: received 1 addresses, tokens 74.6905, since last addr message: 0.027906 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:36:34Z RATE LIMIT: received 2 addresses, tokens 47.1096, since last addr message: 0.133611 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:36:36Z RATE LIMIT: received 5 addresses, tokens 47.5107, since last addr message: 0.069262 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:36:48Z RATE LIMIT: received 5 addresses, tokens 9.69295, since last addr message: 0.144789 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:36:49Z RATE LIMIT: received 1 addresses, tokens 32.2199, since last addr message: 0.018401 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:36:55Z RATE LIMIT: received 1 addresses, tokens 5.36315, since last addr message: 0.149209 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:36:55Z RATE LIMIT: received 2 addresses, tokens 25.8086, since last addr message: 0.025194 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:36:56Z RATE LIMIT: received 1 addresses, tokens 31.9382, since last addr message: 0.139211 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:36:59Z RATE LIMIT: received 1 addresses, tokens 81.6314, since last addr message: 0.024647 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:37:03Z RATE LIMIT: received 6 addresses, tokens 81.7179, since last addr message: 0.096048 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:37:21Z RATE LIMIT: received 20 addresses, tokens 8.7848, since last addr message: 0.274321 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:37:22Z RATE LIMIT: received 9 addresses, tokens 47.1074, since last addr message: 0.195796 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:37:24Z RATE LIMIT: received 45 addresses, tokens 1.10409, since last addr message: 14.093766 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:37:30Z RATE LIMIT: received 3 addresses, tokens 27.231, since last addr message: 0.087656 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:37:32Z RATE LIMIT: received 147 addresses, tokens 18.0625, since last addr message: 2.128447 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:37:40Z RATE LIMIT: received 12 addresses, tokens 88.2762, since last addr message: 0.093162 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:37:46Z RATE LIMIT: received 3 addresses, tokens 9.43458, since last addr message: 0.059155 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:37:49Z RATE LIMIT: received 1 addresses, tokens 40.8886, since last addr message: 0.035954 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:38:04Z RATE LIMIT: received 18 addresses, tokens 48.2704, since last addr message: 0.102047 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:38:06Z RATE LIMIT: received 9 addresses, tokens 8.19879, since last addr message: 0.125021 addr/sec, peer 94.237.44.67\r\n2021-07-07T09:38:11Z RATE LIMIT: received 101 addresses, tokens 89.9936, since last addr message: 0.980125 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:38:12Z RATE LIMIT: received 9 addresses, tokens 83.6881, since last addr message: 0.090022 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:38:14Z RATE LIMIT: received 2 addresses, tokens 5.11676, since last addr message: 0.039899 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:38:18Z RATE LIMIT: received 5 addresses, tokens 9.68561, since last addr message: 0.153798 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:38:29Z RATE LIMIT: received 5 addresses, tokens 84.271, since last addr message: 0.058458 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:38:29Z RATE LIMIT: received 1 addresses, tokens 89.6849, since last addr message: 0.011045 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:38:30Z RATE LIMIT: received 8 addresses, tokens 19.3853, since last addr message: 0.066289 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:38:31Z RATE LIMIT: received 3 addresses, tokens 32.9822, since last addr message: 0.110629 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:38:36Z RATE LIMIT: received 1 addresses, tokens 6.5182, since last addr message: 0.054568 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:38:38Z RATE LIMIT: received 1 addresses, tokens 5.67741, since last addr message: 0.628110 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:38:40Z RATE LIMIT: received 1 addresses, tokens 77.554, since last addr message: 0.034893 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:38:43Z RATE LIMIT: received 1 addresses, tokens 90.0297, since last addr message: 0.074362 addr/sec, peer 3.236.255.16\r\n2021-07-07T09:38:43Z RATE LIMIT: received 3 addresses, tokens 82.6335, since last addr message: 0.047190 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:38:53Z RATE LIMIT: received 1 addresses, tokens 7.00546, since last addr message: 0.025716 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:38:58Z RATE LIMIT: received 70 addresses, tokens 8.67673, since last addr message: 0.812611 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:39:01Z RATE LIMIT: received 8 addresses, tokens 43.4237, since last addr message: 0.064074 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:39:03Z RATE LIMIT: received 2 addresses, tokens 6.1267, since last addr message: 0.038963 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:39:05Z RATE LIMIT: received 7 addresses, tokens 82.8845, since last addr message: 0.193719 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:39:06Z RATE LIMIT: received 1 addresses, tokens 7.3268, since last addr message: 0.075680 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:39:09Z RATE LIMIT: received 2 addresses, tokens 82.1869, since last addr message: 0.078329 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:39:10Z RATE LIMIT: received 1 addresses, tokens 15.341, since last addr message: 0.025280 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:39:14Z RATE LIMIT: received 2 addresses, tokens 79.9275, since last addr message: 0.059286 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:39:29Z RATE LIMIT: received 5 addresses, tokens 8.60318, since last addr message: 0.219647 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:39:31Z RATE LIMIT: received 14 addresses, tokens 50.0018, since last addr message: 0.138434 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:39:35Z RATE LIMIT: received 2 addresses, tokens 7.36424, since last addr message: 0.061775 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:39:36Z RATE LIMIT: received 2 addresses, tokens 79.0007, since last addr message: 0.064181 addr/sec, peer q5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion\r\n2021-07-07T09:39:37Z RATE LIMIT: received 9 addresses, tokens 36.5186, since last addr message: 0.137689 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:39:42Z RATE LIMIT: received 18 addresses, tokens 37.5215, since last addr message: 0.135436 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:39:43Z RATE LIMIT: received 8 addresses, tokens 39.622, since last addr message: 0.190555 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:39:48Z RATE LIMIT: received 2 addresses, tokens 37.7395, since last addr message: 0.115091 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:39:51Z RATE LIMIT: received 3 addresses, tokens 18.4526, since last addr message: 0.072964 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:39:57Z RATE LIMIT: received 1 addresses, tokens 7.50869, since last addr message: 0.046632 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:40:01Z RATE LIMIT: received 1 addresses, tokens 33.4199, since last addr message: 0.055620 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:40:01Z RATE LIMIT: received 2 addresses, tokens 21.4168, since last addr message: 0.105524 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:40:04Z RATE LIMIT: received 8 addresses, tokens 13.298, since last addr message: 0.092801 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:40:08Z RATE LIMIT: received 1 addresses, tokens 37.7125, since last addr message: 0.050683 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:40:08Z RATE LIMIT: received 87 addresses, tokens 7.64895, since last addr message: 7.629815 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:40:11Z RATE LIMIT: received 2 addresses, tokens 86.4075, since last addr message: 0.032151 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:40:15Z RATE LIMIT: received 1 addresses, tokens 84.8092, since last addr message: 0.248938 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:40:16Z RATE LIMIT: received 1 addresses, tokens 31.4715, since last addr message: 0.025298 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:40:18Z RATE LIMIT: received 19 addresses, tokens 67.5595, since last addr message: 0.084633 addr/sec, peer 2a01:4f8:140:948b::2\r\n2021-07-07T09:40:20Z RATE LIMIT: received 1 addresses, tokens 1.80042, since last addr message: 0.086846 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:40:20Z RATE LIMIT: received 1 addresses, tokens 6.83211, since last addr message: 0.065183 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:40:20Z RATE LIMIT: received 1 addresses, tokens 21.2516, since last addr message: 0.054502 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:40:28Z RATE LIMIT: received 6 addresses, tokens 9.50376, since last addr message: 0.101685 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:40:34Z RATE LIMIT: received 6 addresses, tokens 85.9494, since last addr message: 0.074795 addr/sec, peer 60.244.109.19\r\n2021-07-07T09:40:35Z RATE LIMIT: received 2 addresses, tokens 32.36, since last addr message: 0.105902 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:40:37Z RATE LIMIT: received 2 addresses, tokens 21.9911, since last addr message: 0.114970 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:40:39Z RATE LIMIT: received 2 addresses, tokens 86.1762, since last addr message: 0.084493 addr/sec, peer 35.197.140.219\r\n2021-07-07T09:40:39Z RATE LIMIT: received 82 addresses, tokens 10.796, since last addr message: 0.810331 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:40:41Z RATE LIMIT: received 1 addresses, tokens 20.4395, since last addr message: 0.020053 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:40:44Z RATE LIMIT: received 2 addresses, tokens 36.7779, since last addr message: 0.045893 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:40:49Z RATE LIMIT: received 6 addresses, tokens 21.1393, since last addr message: 0.522559 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:40:52Z RATE LIMIT: received 1 addresses, tokens 20.5433, since last addr message: 0.090589 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:40:55Z RATE LIMIT: received 1 addresses, tokens 6.18741, since last addr message: 0.037263 addr/sec, peer 83.150.56.145\r\n2021-07-07T09:40:55Z RATE LIMIT: received 2 addresses, tokens 41.4496, since last addr message: 0.042221 addr/sec, peer 99.108.237.173\r\n2021-07-07T09:41:02Z RATE LIMIT: received 1 addresses, tokens 36.4862, since last addr message: 0.058538 addr/sec, peer i3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p\r\n2021-07-07T09:41:02Z RATE LIMIT: received 1 addresses, tokens 20.5747, since last addr message: 0.096961 addr/sec, peer 168.119.79.89\r\n2021-07-07T09:41:03Z RATE LIMIT: received 3 addresses, tokens 3.20141, since last addr message: 0.124722 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:41:03Z RATE LIMIT: received 1 addresses, tokens 5.19149, since last addr message: 0.022773 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:41:07Z RATE LIMIT: received 1 addresses, tokens 0.602009, since last addr message: 0.249623 addr/sec, peer shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n2021-07-07T09:41:08Z RATE LIMIT: received 6 addresses, tokens 33.6194, since last addr message: 0.184085 addr/sec, peer kokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p\r\n2021-07-07T09:41:12Z RATE LIMIT: received 10 addresses, tokens 176.895, since last addr message: 0.010638 addr/sec, peer 188.166.69.73\r\n2021-07-07T09:41:14Z RATE LIMIT: received 11 addresses, tokens 11.2737, since last addr message: 0.202147 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n2021-07-07T09:41:14Z RATE LIMIT: received 7 addresses, tokens 92.2651, since last addr message: 0.007647 addr/sec, peer 2a03:b0c0:2:d0::4bc:2001\r\n2021-07-07T09:41:18Z RATE LIMIT: received 1 addresses, tokens 18.0789, since last addr message: 0.034019 addr/sec, peer 127.0.0.1\r\n2021-07-07T09:41:21Z RATE LIMIT: received 2 addresses, tokens 5.9012, since last addr message: 0.116979 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:41:23Z RATE LIMIT: received 10 addresses, tokens 182.417, since last addr message: 0.026198 addr/sec, peer 140.143.155.41\r\n2021-07-07T09:41:26Z RATE LIMIT: received 1 addresses, tokens 4.40764, since last addr message: 0.197455 addr/sec, peer ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n2021-07-07T09:41:26Z RATE LIMIT: received 1 addresses, tokens 1.49683, since last addr message: 0.081757 addr/sec, peer bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n```\r\n</details>\r\n\r\nThere seems to be way too many cases where we receive more addresses than available tokens (so addresses will be dropped) and rates of more than 0.1 addr/sec (not necessary meaning that addresses will be dropped because that is only since the last addr message received). I assume nobody was attacking my node at the time with addr messages flood.\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-700707406",
      "submitted_at": "2021-07-07T10:29:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 875536479,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTUzNjQ3OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875536479",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T11:46:55Z",
      "updated_at": "2021-07-07T11:46:55Z",
      "author_association": "MEMBER",
      "body": "I have 2 conceptual questions to this PR:\r\n\r\n1. How does it work against the \"bottlenecking problem\" (something we saw in the dandelion/rate-limiting discussion too)?\r\nLet's say your reachable node has 10 outbound conns, and couple inbounds.\r\nAn attacker makes 100 connections to your node, and constantly spends all tokens by transmitting more-than-average addrs. Now, when your peers receive announcements from your node, they might very likely exclude your honest inbounds (you announced to them) from relay, and announce only those Sybil nodes instead.\r\nPreviously, they would relay everything I guess?\r\n\r\n2. Do we want to design these tokens while keeping in mind that we also wanna reuse them for other kinds of p2p dos? Or are we going to have separate tokens for other use-cases in the future? Or do you want to ignore this aspect for now?",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-875536479",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 875592657,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTU5MjY1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875592657",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T13:13:55Z",
      "updated_at": "2021-07-07T13:13:55Z",
      "author_association": "MEMBER",
      "body": "re ACK dc8a1863f30b5944490cdbaa3271afbf8cd6da9a via `git range-diff dade562...dc8a186`\r\n\r\n- New constant `MAX_ADDR_PROCESSING_TOKEN_BUCKET` \r\n- Comments about exceeding [soft] limit when incrementing for GETADDR\r\n- const `time_diff` and `increment`\r\n- `break` out of addrs loop when tokens run out\r\n- rand ranges {1,255} + refactors in test",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-875592657",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 701347520,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAxMzQ3NTIw",
      "url": null,
      "actor": null,
      "commit_id": "cb0c885fbbe05e73581de429d0c1d451eb4d2696",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK cb0c885fbbe05e73581de429d0c1d451eb4d2696",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-701347520",
      "submitted_at": "2021-07-07T18:57:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4990974537,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk5MDk3NDUzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4990974537",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:10:31Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4990978473,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDk5MDk3ODQ3Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4990978473",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:11:27Z"
    },
    {
      "event": "commented",
      "id": 875868090,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTg2ODA5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875868090",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:21:27Z",
      "updated_at": "2021-07-07T19:21:27Z",
      "author_association": "MEMBER",
      "body": "@vasild\r\n\r\nI think your logging exaggerates the effect, ecause it only prints #addr/time for individual messages, ignoring that the token bucket can accumulate across multiple messages.\r\n\r\nOn my own nodes I do see occasional rate limiting, but they're all (a) very early in a connection's lifetime or (b) from very spammy nodes (with \"bitnodes\" or \"multiven\" in their user agent).\r\n\r\n@naumenkogs\r\n\r\n1. Good point, that's perhaps interesting for a future improvement to consider. I don't think this PR is making anything worse though - it stops spammy addr messages at a much earlier stage, but as is on the network, they are already stopped eventually due to the size limit of the `m_addr_to_send` buffer.\r\n2. I'm not sure yet, perhaps something to discuss when similar rate-limitings are being added for other things.\r\n\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-875868090",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 4991022654,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk5MTAyMjY1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4991022654",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:21:28Z"
    },
    {
      "event": "subscribed",
      "id": 4991022657,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5OTEwMjI2NTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4991022657",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:21:28Z"
    },
    {
      "event": "mentioned",
      "id": 4991022659,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk5MTAyMjY1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4991022659",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:21:28Z"
    },
    {
      "event": "subscribed",
      "id": 4991022663,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5OTEwMjI2NjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4991022663",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:21:28Z"
    },
    {
      "event": "commented",
      "id": 875889604,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NTg4OTYwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/875889604",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-07T19:56:46Z",
      "updated_at": "2021-07-07T19:56:46Z",
      "author_association": "MEMBER",
      "body": "re-ACK 8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-875889604",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 876018530,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjAxODUzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876018530",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T00:16:08Z",
      "updated_at": "2021-07-08T00:16:08Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876018530",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 701537117,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAxNTM3MTE3",
      "url": null,
      "actor": null,
      "commit_id": "f8e51a85ac0c783808fc64179fcc108aad676079",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code-Review ACK 8b60d6f538abbee5ea3ef6b49968f6afd2581877\r\n\r\n>  I don't think this PR is making anything worse though - it stops spammy addr messages at a much earlier stage, but as is on the network, they are already stopped eventually due to the size limit of the m_addr_to_send buffer.\r\n\r\nI think that for the network effects of addr relay, there is already some sort of rate limiting, because addr messages of size>10 are accepted to addrman but not relayed to other peers ([code](https://github.com/bitcoin/bitcoin/blob/4129134e844f78a89f8515cf30dad4b6074703c7/src/net_processing.cpp#L2799)) which in a way behaves like a rate limit of 0.33 addr/s with  `AVG_ADDRESS_BROADCAST_INTERVAL = 30s` . So most attempts to suppress the relay of certain addresses by intentionally triggering the rate limit were probably already possible before.\r\n\r\nBut that existing mechanism does not apply to the node accepting addrs to addrman, so in my opinion the main benefit of this PR is to make all kinds of attacks trying to take over the new tables of addrman harder to pull off.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-701537117",
      "submitted_at": "2021-07-08T00:24:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 701654647,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAxNjU0NjQ3",
      "url": null,
      "actor": null,
      "commit_id": "4291de17e9de183d1433d96047bbe135fd0821ef",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK 8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-701654647",
      "submitted_at": "2021-07-08T09:09:18Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 701956579,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAxOTU2NTc5",
      "url": null,
      "actor": null,
      "commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-701956579",
      "submitted_at": "2021-07-08T11:39:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 876379345,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjM3OTM0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876379345",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T12:01:05Z",
      "updated_at": "2021-07-08T12:01:47Z",
      "author_association": "MEMBER",
      "body": "> I think your logging exaggerates the effect, ecause it only prints #addr/time for individual messages...\r\n\r\nIt prints addr/time but it also prints number of addresses received (in the current addr message) and total tokens accumulated. If the former is larger than the latter, then addresses were dropped.\r\n\r\nHere is some crunching of the data:\r\n\r\nIn the first 1h after startup:\r\n\r\n6891 addresses received in total, in 1123 addr/addrv2 messages\r\n2496 addresses were dropped due to rate limiting\r\n\r\n![rate_limiting_1h](https://user-images.githubusercontent.com/266751/124918046-dd22ed00-dff4-11eb-9d4a-3c941a75c5d3.png)\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876379345",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 876457797,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjQ1Nzc5Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876457797",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T13:52:16Z",
      "updated_at": "2021-07-08T13:52:16Z",
      "author_association": "MEMBER",
      "body": "@vasild, I've dug into your logs a bit:\r\n\r\npeer | SUM of addresses received | PERCENTAGE of addresses received | SUM of addresses dropped | PERCENTAGE of addresses dropped\r\n-- | -- | -- | -- | --\r\n127.0.0.1 | 86 | 1.86% | 0 | 0.00%\r\n140.143.155.41 | 61 | 1.32% | 2 | 0.10%\r\n168.119.79.89 | 366 | 7.93% | 163 | 7.79%\r\n188.166.69.73 | 25 | 0.54% | 1 | 0.05%\r\n2a01:4f8:140:948b::2 | 173 | 3.75% | 0 | 0.00%\r\n2a03:b0c0:2:d0::4bc:2001 | 17 | 0.37% | 3 | 0.14%\r\n3.236.255.16 | 10 | 0.22% | 0 | 0.00%\r\n34.64.249.186 | 6 | 0.13% | 0 | 0.00%\r\n35.197.140.219 | 132 | 2.86% | 0 | 0.00%\r\n46.101.235.143 | 1 | 0.02% | 0 | 0.00%\r\n60.244.109.19 | 144 | 3.12% | 0 | 0.00%\r\n70.64.27.12 | 1146 | 24.82% | 949 | 45.34%\r\n83.150.56.145 | 479 | 10.37% | 260 | 12.42%\r\n88.99.167.186 | 6 | 0.13% | 0 | 0.00%\r\n94.237.44.67 | 71 | 1.54% | 3 | 0.14%\r\n99.108.237.173 | 181 | 3.92% | 3 | 0.14%\r\nbitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p | 193 | 4.18% | 16 | 0.76%\r\ni3hcdakiz2tyvggkwefvdjoi7444kgvd2mbdfizjvv43q7zukezq.b32.i2p | 84 | 1.82% | 3 | 0.14%\r\nkokkmpquqlkptu5hkmzqlttsmtwxicldr4so7wqsufk6bwf32nma.b32.i2p | 169 | 3.66% | 9 | 0.43%\r\nppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p | 582 | 12.60% | 358 | 17.10%\r\nq5csjdscadbsm27ceyuk7naxveak5yevqlnrowhgcnaxxauwc24zvhqd.onion | 138 | 2.99% | 0 | 0.00%\r\nshh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p | 548 | 11.87% | 323 | 15.43%\r\nGrand Total | 4618 | 100.00% | 2093 | 100.00%\r\n\r\nSo the majority of your peers are having 0-3 address records dropped, mostly in the first one or two `addr` messages received. There are a handful of peers that are sending a huge number of address records, which are consequently being strongly rate-limited. Those peers are:\r\n\r\n- 168.119.79.89\r\n- 70.64.27.12\r\n- 83.150.56.145\r\n- ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n- shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n\r\nIt's probably worth checking those peers' versions/user agent strings. I'd be very surprised to see so many addresses being gossipped by Bitcoin Core nodes. They'd have to be receiving hundreds of addr messages from _their_ peers with <10 address records in each.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876457797",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 4995115870,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDk5NTExNTg3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4995115870",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T13:52:17Z"
    },
    {
      "event": "subscribed",
      "id": 4995115880,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ5OTUxMTU4ODA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4995115880",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T13:52:17Z"
    },
    {
      "event": "commented",
      "id": 876468394,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjQ2ODM5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876468394",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T14:04:45Z",
      "updated_at": "2021-07-08T14:04:45Z",
      "author_association": "MEMBER",
      "body": "utACK 8b60d6f538",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876468394",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 876541617,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjU0MTYxNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876541617",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T15:37:28Z",
      "updated_at": "2021-07-08T15:37:28Z",
      "author_association": "MEMBER",
      "body": "> It's probably worth checking those peers' versions/user agent strings...\r\n\r\n```sh\r\n$ bitcoin-cli getpeerinfo |jq 'map(select(.addr |startswith(\"ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\") or startswith(\"shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\") or startswith(\"168.119.79.89\") or startswith(\"70.64.27.12\") or startswith(\"83.150.56.145\"))) |map({addr: .addr, subver: .subver})'\r\n[\r\n  {\r\n    \"addr\": \"shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p:0\",\r\n    \"subver\": \"/Satoshi:21.99.0/\"\r\n  },\r\n  {\r\n    \"addr\": \"ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p:0\",\r\n    \"subver\": \"/Satoshi:0.21.1/Knots:20210629/\"\r\n  },\r\n  {\r\n    \"addr\": \"168.119.79.89:8333\",\r\n    \"subver\": \"/Satoshi:0.21.1/\"\r\n  },\r\n  {\r\n    \"addr\": \"70.64.27.12:8333\",\r\n    \"subver\": \"/Satoshi:0.21.1/\"\r\n  },\r\n  {\r\n    \"addr\": \"83.150.56.145:8333\",\r\n    \"subver\": \"/Satoshi:0.21.1/\"\r\n  }\r\n]\r\n```\r\n\r\nInteresting... I am not sure how to interpret all this. My first thought is that the rate limit is too aggressive and is cutting normal traffic. OTOH I feel like I need more in order judge this properly.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876541617",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 876602300,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjYwMjMwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/876602300",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-08T17:06:07Z",
      "updated_at": "2021-07-08T17:06:07Z",
      "author_association": "MEMBER",
      "body": "> I am not sure how to interpret all this\r\n\r\nMe neither! Here's one example of addresses received from 70.64.27.12:\r\n\r\ntime | addresses received | tokens | rate | peer\r\n-- | -- | -- | -- | --\r\n2021-07-07T09:05:56 | 5 | 9.09188 | 0.079376 | 70.64.27.12\r\n2021-07-07T09:06:18 | 176 | 6.29241 | 7.99806 | 70.64.27.12\r\n\r\nThey send us an `addr` message with 5 addresses, followed 22 seconds later by an `addr` messages with 176 addresses.\r\n\r\nThere are only three ways that Bitcoin Core adds addresses to `m_addrs_to_send` for a peer:\r\n\r\n1. self announcement (on connection to outbound nodes, and once every 24 hours on average)\r\n2. a response to a `getaddr` request\r\n3. relaying to 2 random peers when receiving a gossipped addr (as long as the `addr` message it received had fewer than 10 addresses).\r\n\r\n(1) and (2) can't be responsible here, so if 70.64.27.12 really is a Bitcoin Core v0.21.1 node, then it must be receiving a huge number of `addr` messages (containing fewer than 10 addresses each) from its peers, and then relaying them on.\r\n\r\nThe next step might be to enable message capture (https://github.com/bitcoin/bitcoin/blob/master/contrib/message-capture/message-capture-docs.md) to see what the contents of those `addr` messages are.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-876602300",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 878411443,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODQxMTQ0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878411443",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T16:15:40Z",
      "updated_at": "2021-07-12T16:15:40Z",
      "author_association": "MEMBER",
      "body": "I updated the printout to show also the addresses being dropped and to calculate the average addr/sec for the sender from the time they connected to the time a particular `addr` message was received. Results from running it for 1h are below.\r\n\r\nTotal addresses received: 9917\r\nDropped addresses: 5073\r\n\r\nTotal number of peers who sent us addresses: 26\r\nDropped at least one address from this number of peers: 22\r\n\r\nThe addresses being dropped look legit. I tried connecting to a bunch of them and they are responsive and report some version of Bitcoin Core. Could not connect to some others (time out or connection refused), but it is expected that not all nodes are up all the time. So, the addresses being dropped by the rate limiter do not look like a trash.\r\n\r\nHere is a histogram of how often various addr/sec are observed (the red line is 0.1, everything right from it results in some dropping):\r\n\r\n![histo](https://user-images.githubusercontent.com/266751/125320671-3b750600-e33c-11eb-8db6-1c1a4dbff613.png)\r\n\r\nTo me it looks like that the rate limiter is too aggressive and is cutting legit traffic. What about increasing `MAX_ADDR_RATE_PER_SECOND` from `0.1` to something like `0.6`?\r\n\r\n[Log output](https://github.com/bitcoin/bitcoin/files/6802856/rate_limit.txt)\r\n\r\n<details>\r\n<summary>[patch] log print</summary>\r\n\r\n```diff\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -242,12 +242,13 @@ struct Peer {\r\n     bool m_getaddr_recvd{false};\r\n     /** Number of addr messages that can be processed from this peer. Start at 1 to\r\n      *  permit self-announcement. */\r\n     double m_addr_token_bucket{1.0};\r\n     /** When m_addr_token_bucket was last updated */\r\n     std::chrono::microseconds m_addr_token_timestamp{GetTime<std::chrono::microseconds>()};\r\n+    size_t m_total_addr_received{0};\r\n\r\n     /** Set of txids to reconsider once their parent transactions have been accepted **/\r\n     std::set<uint256> m_orphan_work_set GUARDED_BY(g_cs_orphans);\r\n\r\n     /** Protects m_getdata_requests **/\r\n     Mutex m_getdata_requests_mutex;\r\n@@ -2797,12 +2798,36 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n         const auto current_time = GetTime<std::chrono::microseconds>();\r\n         if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n             // Don't increment bucket if it's already full\r\n             const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n             const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n             peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\r\n+#if 1\r\n+            peer->m_total_addr_received += vAddr.size();\r\n+            const auto connection_duration =\r\n+                std::max(count_microseconds(current_time) / 1000000 - pfrom.nTimeConnected, 1L);\r\n+            std::string extra_msg;\r\n+            // If will drop, log how many and the addresses themselves.\r\n+            if (vAddr.size() > peer->m_addr_token_bucket) {\r\n+                const auto num_drop = static_cast<size_t>(std::ceil(vAddr.size() - peer->m_addr_token_bucket));\r\n+                extra_msg = strprintf(\",num drop:%u,dropped:\", num_drop);\r\n+                for (size_t i = vAddr.size() - num_drop; i < vAddr.size(); ++i) {\r\n+                    extra_msg += vAddr[i].ToStringIPPort();\r\n+                    if (i < vAddr.size() - 1) {\r\n+                        extra_msg += \";\";\r\n+                    }\r\n+                }\r\n+            }\r\n+            LogPrintf(\"RATE LIMIT:received addresses:%u,available tokens:%.4lf,avg \"\r\n+                      \"addr/sec:%.4lf,peer:%s%s\\n\",\r\n+                      vAddr.size(),\r\n+                      peer->m_addr_token_bucket,\r\n+                      static_cast<double>(peer->m_total_addr_received) / connection_duration,\r\n+                      pfrom.addr.ToStringIP(),\r\n+                      extra_msg);\r\n+#endif\r\n         }\r\n         peer->m_addr_token_timestamp = current_time;\r\n\r\n         Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\r\n         const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\r\n         for (CAddress& addr : vAddr)\r\n```\r\n</details>\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878411443",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 878417152,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODQxNzE1Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878417152",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T16:23:28Z",
      "updated_at": "2021-07-12T16:23:28Z",
      "author_association": "MEMBER",
      "body": "@vasild Interesting. Are these by any chance onion/i2p peers? One theory could be that those peers generally are connected only/mostly to a small subset of nodes only, and thus the \"pick one or two peers to relay to\" policy results in a \"funnel\" effect for them?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878417152",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5008565473,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAwODU2NTQ3Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5008565473",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T16:23:29Z"
    },
    {
      "event": "subscribed",
      "id": 5008565476,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMDg1NjU0NzY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5008565476",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T16:23:29Z"
    },
    {
      "event": "commented",
      "id": 878426183,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODQyNjE4Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878426183",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T16:37:27Z",
      "updated_at": "2021-07-12T16:37:27Z",
      "author_association": "MEMBER",
      "body": "Here are the 26 peers my node was connected to. The ones that triggered the rate limiter are marked with `*` (they are 22):\r\n\r\n```\r\n* 127.0.0.1\r\n* 140.143.155.41\r\n* 148.251.40.218\r\n* 158.69.72.5\r\n* 188.166.69.73\r\n* 2001:19f0:6000:9008:5400:ff:fe1b:164b\r\n* 22plzy5mqwz64iukd2hbsa5oo454iwkjko26tifi54ir4mbnpfea.b32.i2p\r\n  2600:1f18:41a0:d000:cba6:77c8:4429:7ea\r\n* 2600:1f1c:2d3:2400:4da7:c467:efd:8d03\r\n* 2600:1f1c:2d3:2403:5bac:3fc6:6513:7a63\r\n* 2604:a880:400:d0::1bdb:4001\r\n* 2a01:4f8:160:832e::2\r\n* 2a03:b0c0:2:d0::4bc:2001\r\n* 2a04:3544:1000:1510:b08f:6fff:fe1b:3007\r\n  2a0f:2a80::11\r\n  3.236.255.16\r\n* 34.87.112.13\r\n* 35.228.225.73\r\n* 35.247.228.106\r\n* 39.101.136.226\r\n* 94.237.44.67\r\n* 95.217.41.235\r\n* bitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p\r\n* ppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p\r\n* shh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p\r\n  vnqix5uljfwssvzbexzjeuoehjujtw4iqftiu34nbvig64kkmnla.b32.i2p\r\n```",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878426183",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 704584099,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA0NTg0MDk5",
      "url": null,
      "actor": null,
      "commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "GeneFerneau",
        "id": 80422284,
        "node_id": "MDQ6VXNlcjgwNDIyMjg0",
        "avatar_url": "https://avatars.githubusercontent.com/u/80422284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GeneFerneau",
        "html_url": "https://github.com/GeneFerneau",
        "followers_url": "https://api.github.com/users/GeneFerneau/followers",
        "following_url": "https://api.github.com/users/GeneFerneau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GeneFerneau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GeneFerneau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GeneFerneau/subscriptions",
        "organizations_url": "https://api.github.com/users/GeneFerneau/orgs",
        "repos_url": "https://api.github.com/users/GeneFerneau/repos",
        "events_url": "https://api.github.com/users/GeneFerneau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GeneFerneau/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-704584099",
      "submitted_at": "2021-07-12T22:08:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 878639355,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODYzOTM1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878639355",
      "actor": {
        "login": "GeneFerneau",
        "id": 80422284,
        "node_id": "MDQ6VXNlcjgwNDIyMjg0",
        "avatar_url": "https://avatars.githubusercontent.com/u/80422284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GeneFerneau",
        "html_url": "https://github.com/GeneFerneau",
        "followers_url": "https://api.github.com/users/GeneFerneau/followers",
        "following_url": "https://api.github.com/users/GeneFerneau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GeneFerneau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GeneFerneau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GeneFerneau/subscriptions",
        "organizations_url": "https://api.github.com/users/GeneFerneau/orgs",
        "repos_url": "https://api.github.com/users/GeneFerneau/repos",
        "events_url": "https://api.github.com/users/GeneFerneau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GeneFerneau/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T22:27:26Z",
      "updated_at": "2021-07-12T22:27:26Z",
      "author_association": "NONE",
      "body": "Concept + review ACK [8b60d6f](https://github.com/bitcoin/bitcoin/pull/22387/commits/8b60d6f538abbee5ea3ef6b49968f6afd2581877)",
      "user": {
        "login": "GeneFerneau",
        "id": 80422284,
        "node_id": "MDQ6VXNlcjgwNDIyMjg0",
        "avatar_url": "https://avatars.githubusercontent.com/u/80422284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GeneFerneau",
        "html_url": "https://github.com/GeneFerneau",
        "followers_url": "https://api.github.com/users/GeneFerneau/followers",
        "following_url": "https://api.github.com/users/GeneFerneau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GeneFerneau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GeneFerneau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GeneFerneau/subscriptions",
        "organizations_url": "https://api.github.com/users/GeneFerneau/orgs",
        "repos_url": "https://api.github.com/users/GeneFerneau/repos",
        "events_url": "https://api.github.com/users/GeneFerneau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GeneFerneau/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878639355",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5010282567,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAxMDI4MjU2Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5010282567",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T23:14:01Z"
    },
    {
      "event": "commented",
      "id": 878665937,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODY2NTkzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878665937",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T23:31:33Z",
      "updated_at": "2021-07-12T23:31:33Z",
      "author_association": "MEMBER",
      "body": "@vasild I've added a commit that adds some statistics to `getpeerinfo`. So far it does indeed seem there are addr messages being sent from seemingly-honest peers that are being rate limited by it. I'm going to keep running this on a few nodes for a while to gather more statistics, but I'm beginning to agree that the 0.1 addr/s limit may be too strict.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878665937",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5010332727,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAxMDMzMjcyNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5010332727",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T23:31:34Z"
    },
    {
      "event": "subscribed",
      "id": 5010332728,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMTAzMzI3Mjg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5010332728",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-12T23:31:34Z"
    },
    {
      "event": "commented",
      "id": 878689516,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODY4OTUxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878689516",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T00:38:29Z",
      "updated_at": "2021-07-13T00:38:29Z",
      "author_association": "MEMBER",
      "body": "See the bitcoin-dev list mail, where there is a link to https://bitcointalk.org/index.php?topic=5348856.0.\n\nCould that be what we're seeing?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878689516",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 878694069,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODY5NDA2OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/878694069",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T00:53:05Z",
      "updated_at": "2021-07-13T00:54:05Z",
      "author_association": "MEMBER",
      "body": "I think so too, I ran this patch last week and again today, for a few hours each. While I saw very few hits of the rate limit last week, I observed a similar pattern to @vasild's data today: Some peers send spikes of large addr messages of size 50-100, alternating with several small addrs <10. So it seems like they may have some other peer that is spamming them - not continuously but every ~3 minutes or so.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878694069",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5010527833,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAxMDUyNzgzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5010527833",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T00:53:06Z"
    },
    {
      "event": "subscribed",
      "id": 5010527837,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMTA1Mjc4Mzc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5010527837",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T00:53:06Z"
    },
    {
      "event": "reviewed",
      "id": 705145016,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA1MTQ1MDE2",
      "url": null,
      "actor": null,
      "commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I am running df1ddf8f08 and looking at the output of:\r\n\r\n```sh\r\nbitcoin-cli getpeerinfo |jq 'map({addr: .addr, addr_processed: .addr_processed, addr_rate_limited: .addr_rate_limited, avg_addr_recv_rate: ((.addr_processed + .addr_rate_limited) / (now - .conntime))})'\r\n```\r\n\r\nit looks like something like this:\r\n```json\r\n...\r\n  {\r\n    \"addr\": \"34.83.222.21:8333\",\r\n    \"addr_processed\": 144,\r\n    \"addr_rate_limited\": 0,\r\n    \"avg_addr_recv_rate\": 0.038106087594527334\r\n  },\r\n  {\r\n    \"addr\": \"46.29.19.25:8333\",\r\n    \"addr_processed\": 1362,\r\n    \"addr_rate_limited\": 1587,\r\n    \"avg_addr_recv_rate\": 0.8066360758143002\r\n  },\r\n...\r\n```",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-705145016",
      "submitted_at": "2021-07-13T13:09:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 879256798,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTI1Njc5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879256798",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T17:08:52Z",
      "updated_at": "2021-07-13T17:08:52Z",
      "author_association": "MEMBER",
      "body": "> I observed a similar pattern to @vasild's data today: Some peers send spikes of large addr messages of size 50-100, alternating with several small addrs <10\r\n\r\nI think it is more complicated :exploding_head:. From the log linked from https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-878411443:\r\n\r\nBelow, the numbers mean that an `addr` message with that many addresses was received. Messages from which addresses were dropped are marked with `*`. For example, `140.143.155.41   5 7* 15` means that this peer sent us 3 `addr` messages each containing 5, 7 and 15 addresses and something was dropped from the message that contained 7 addresses.\r\n\r\n<details>\r\n<summary>received per peer, sorted by size</summary>\r\n\r\n```\r\n127.0.0.1                                                    1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 4 4 4 4 4 4 5 5 5 5 5 5 5 5 5 5 6 6 6 7 7 7 8* 9 9 10 12 12* 14 25\r\n140.143.155.41                                               8 9 9 10 10 10 10 10*\r\n148.251.40.218                                               1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1* 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2* 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4* 4* 4* 4* 5 6 6 6* 7 7 7* 8 8 8 8* 9 9* 10 10* 12 18* 24* 25* 27* 31* 45* 52* 59* 67* 78* 99*\r\n158.69.72.5                                                  1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2* 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4* 5 5 5 5 5 5* 6 6 6 6 6 6 6* 6* 7 7 7 7 7 8 9 9 10* 12 83* 84* 88* 91* 105*\r\n188.166.69.73                                                8* 9\r\n2001:19f0:6000:9008:5400:ff:fe1b:164b                        1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2* 2* 2* 3 3 3 3 3 3 3 3* 3* 4 4 4* 5 5 5 5 5 5* 5* 6 6* 6* 6* 7 7 8* 8* 9* 10 11* 13 16 19 26*\r\n22plzy5mqwz64iukd2hbsa5oo454iwkjko26tifi54ir4mbnpfea.b32.i2p 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2* 3 3 3 3 3 3 3 3 3 3 3 4 4 5 5 5 5 6 6 7 7 7 8 8 9 9 10 11 13 14 18\r\n2600:1f18:41a0:d000:cba6:77c8:4429:7ea                       1 2\r\n2600:1f1c:2d3:2400:4da7:c467:efd:8d03                        1 1 2 2 3 5 5*\r\n2600:1f1c:2d3:2403:5bac:3fc6:6513:7a63                       1 1 1 2 3 3 3* 4 4 4 5* 6 6 11\r\n2604:a880:400:d0::1bdb:4001                                  1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1* 1* 2 2 2 2 2 2 2 2 2 2 2 2 2* 2* 3 3 3 3 3 3 3 3* 4 4 4 4 4 4 4 4* 4* 4* 4* 5 5 5 5 5 6 6 6 7* 7* 7* 8 8 8 9 9 9* 10* 15 15* 26* 29* 65* 75* 82* 90* 94* 94* 96* 102* 107*\r\n2a01:4f8:160:832e::2                                         1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2* 2* 3 3 3 3 3 4 4 4 4 4 4 4 4 4* 5 5 5 5* 5* 6 6* 8* 9 11 27* 33* 34* 37* 39* 41* 42* 46* 46* 61* 71* 79* 81* 83* 84* 87* 92* 94* 94* 100* 113*\r\n2a03:b0c0:2:d0::4bc:2001                                     10*\r\n2a04:3544:1000:1510:b08f:6fff:fe1b:3007                      7 7 8 9 9 10* 10*\r\n2a0f:2a80::11                                                2 2 2 3 3 3 3 3 3 3\r\n3.236.255.16                                                 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 3 3 3 4 4 5 5\r\n34.87.112.13                                                 1 1 1 1 1 1 1 1 1 1 1 1* 2 2 2 2 2 3 3 3 3 4 5 5 6 6 7 9 9 9* 13*\r\n35.228.225.73                                                1 1 1 1 1 1 2 3 3 3 3 4 4 4 4 5 7 8 12 18*\r\n35.247.228.106                                               1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3* 4 4 4 4 4 4* 4* 4* 5 5 5 6 6 6 6 6 6 7 8 8 8* 9 9 10 10 10 10* 11 12 12* 13*\r\n39.101.136.226                                               1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1* 2 2 2 2 2 2 2 2 2* 3 3 3 3 3 3 3 3* 3* 3* 3* 3* 3* 4 4 4 4 4* 4* 4* 4* 4* 4* 5 5* 5* 5* 5* 5* 6* 6* 6* 7 7 7* 8 8 8* 8* 8* 9* 9* 11 11* 11* 11* 11* 12* 15* 15* 16* 17* 17* 31* 37* 38* 39* 41* 44* 46* 47* 50* 55* 55* 56* 59* 59* 62*\r\n94.237.44.67                                                 6 7 7 9 9 9 9 10*\r\n95.217.41.235                                                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 4 5 10 40* 51* 63* 82* 82* 84* 87* 91* 92* 93*\r\nbitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2* 3 3 3 3 3 3 3* 4 4 4 4 4 4 4* 5 5 5 6 6 6 6 6 6 7 7 8 8 8 8 8 8* 9 9* 10* 11 12 12 12 14 16* 18\r\nppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 5 6 6 7 7 8 11 11 11 12 70* 83* 86*\r\nshh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1* 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3* 3* 4 4 4 4 4 4 4 4* 4* 4* 5 5 5 5 5 5 6 6* 6* 6* 6* 7 7* 7* 8 8 9 9* 12* 14* 15 28* 32* 40* 50* 57* 81* 86* 88* 90* 94*\r\nvnqix5uljfwssvzbexzjeuoehjujtw4iqftiu34nbvig64kkmnla.b32.i2p 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 5 5 5 5 5 6 6 6 6 7 7 9 9 10 11 14 16 19 19 23\r\n```\r\n</details>\r\n\r\nThe numbers are sorted so it is easy to spot the peers who send us `addr` messages with >10 addresses. Lots of dropping also happens from smaller (<10) `addr` messages. Why nobody sent us a message with 1000 addresses?\r\n\r\n<details>\r\n<summary>Same data, but in chronological order</summary>\r\n\r\n```\r\n127.0.0.1                                                    1 3 12 8 2 9 1 5 3 1 4 2 5 5 3 6 1 2 5 5 5 10 2 2 9 3 6 2 1 3 25 1 6 5 2 2 2 2 7 2 1 2 1 4 1 7 4 2 1 3 7 4 12 2 5 5 4 2 4 5 1 14 2 1 2\r\n140.143.155.41                                               10 9 10 10 9 10 8 10\r\n148.251.40.218                                               1 4 5 59 25 1 2 1 10 9 99 7 1 3 31 27 1 7 7 2 1 3 4 2 78 2 3 4 4 3 3 3 24 45 1 1 2 2 2 3 1 6 1 8 1 3 1 1 1 2 1 8 1 9 4 3 2 2 52 1 2 18 4 1 2 4 2 6 8 10 67 4 1 12 2 4 1 4 3 3 3 3 1 1 1 1 1 8 4 2 1 3 2 2 1 6 4\r\n158.69.72.5                                                  1 1 1 1 2 2 1 12 4 4 83 2 1 91 2 5 2 5 9 3 2 1 1 3 2 2 9 3 6 2 2 1 2 1 3 1 5 5 7 6 4 84 3 3 2 2 6 105 3 8 1 2 2 1 1 7 6 1 3 2 4 7 3 6 1 2 2 1 7 5 4 1 2 6 2 3 2 88 6 1 1 4 1 2 2 2 6 1 7 1 4 5 10 2\r\n188.166.69.73                                                8 9\r\n2001:19f0:6000:9008:5400:ff:fe1b:164b                        1 5 2 5 2 5 1 5 4 3 7 2 16 2 19 1 3 3 2 1 4 2 2 1 2 6 5 1 1 6 1 1 2 13 6 3 2 11 3 2 3 6 5 5 3 7 26 3 4 2 1 10 8 3 2 2 1 8 9\r\n22plzy5mqwz64iukd2hbsa5oo454iwkjko26tifi54ir4mbnpfea.b32.i2p 2 1 8 4 9 11 2 3 2 3 1 5 5 3 3 1 2 2 1 1 1 13 10 1 2 8 1 3 2 1 3 1 3 7 1 2 6 4 1 14 2 2 1 3 3 1 2 3 1 2 2 6 5 3 5 7 9 2 7 2 1 1 18\r\n2600:1f18:41a0:d000:cba6:77c8:4429:7ea                       1 2\r\n2600:1f1c:2d3:2400:4da7:c467:efd:8d03                        1 5 2 3 1 2 5\r\n2600:1f1c:2d3:2403:5bac:3fc6:6513:7a63                       3 6 6 4 2 1 4 11 1 3 4 3 5 1\r\n2604:a880:400:d0::1bdb:4001                                  26 7 4 3 2 1 1 1 7 1 1 2 5 4 1 6 2 1 1 5 94 1 1 2 10 2 1 65 29 1 4 2 2 2 4 5 1 2 1 107 3 1 1 94 3 8 1 9 4 6 1 1 1 15 82 3 4 9 6 4 1 2 9 1 90 1 3 4 1 2 1 1 7 96 8 15 4 1 2 1 3 3 1 102 1 2 1 4 1 1 5 4 5 8 3 75 1 2\r\n2a01:4f8:160:832e::2                                         37 1 4 46 34 2 4 11 61 27 4 8 1 2 94 1 4 79 92 5 2 1 113 2 1 1 3 2 1 5 3 1 87 2 1 1 2 81 4 1 4 2 2 2 3 1 1 1 84 6 5 3 94 1 5 2 39 46 1 1 2 100 4 1 1 3 42 1 4 1 83 1 4 2 5 71 6 2 9 1 33 41 1 1 2\r\n2a03:b0c0:2:d0::4bc:2001                                     10\r\n2a04:3544:1000:1510:b08f:6fff:fe1b:3007                      10 9 10 8 7 9 7\r\n2a0f:2a80::11                                                3 3 3 3 3 2 3 2 3 2\r\n3.236.255.16                                                 1 1 2 1 1 1 5 1 1 1 2 1 1 1 1 1 2 1 5 1 3 1 3 2 1 1 3 1 1 1 4 1 1 1 2 1 4 2 1 1 2 2 1 1 1 1\r\n34.87.112.13                                                 3 2 2 9 1 1 1 1 6 6 2 9 3 2 7 1 9 1 1 3 13 4 1 3 5 2 1 1 1 1 5\r\n35.228.225.73                                                4 1 12 18 1 8 5 3 3 4 1 2 1 3 4 1 7 1 3 4\r\n35.247.228.106                                               3 2 3 13 4 10 1 1 1 9 2 2 4 4 2 3 3 12 8 4 10 3 3 3 3 6 5 2 6 2 1 1 3 2 7 2 8 1 1 2 2 2 9 4 1 6 4 4 2 5 6 2 12 10 2 2 1 3 2 1 10 1 6 2 3 2 2 3 1 3 3 5 1 3 11 8 2 4 3 2 6 2\r\n39.101.136.226                                               11 56 1 8 2 62 1 6 4 5 1 5 1 11 15 5 4 3 1 7 3 59 2 1 6 3 4 1 46 3 8 1 2 47 3 3 11 1 2 3 55 15 4 8 38 17 2 1 2 2 1 7 55 11 5 8 1 1 3 11 3 37 4 1 1 5 9 17 31 3 4 8 3 1 2 1 2 39 3 44 1 9 3 5 1 7 6 41 12 4 4 4 59 16 50 1 1 4\r\n94.237.44.67                                                 7 9 9 10 9 6 7 9\r\n95.217.41.235                                                91 2 2 1 1 1 92 1 2 1 1 1 1 1 1 2 2 2 2 82 2 2 2 3 1 1 1 2 82 3 1 2 93 1 2 84 3 3 1 1 10 2 1 1 2 87 3 4 1 5 1 1 2 2 40 51 1 1 3 1 63 1 1 1 1 1 2 1 2 1 1 2 2\r\nbitcornrd36coazsbzsz4pdebyzvaplmsalq4kpoljmn6cg6x5zq.b32.i2p 2 1 3 2 6 4 4 4 4 6 7 1 1 3 8 7 16 9 1 3 10 1 3 8 2 4 6 6 6 2 4 4 12 8 12 5 8 8 2 1 1 8 14 5 1 3 9 6 2 1 1 2 2 2 2 1 11 2 5 12 18 2 1 1 1 1 3 3\r\nppsmb5ln3rx6mfdzx2nwsleug5etsavbbzjkdealaybrh2jo2n6a.b32.i2p 2 12 1 2 2 3 1 11 2 1 3 1 86 4 3 4 3 83 7 3 1 3 1 8 70 2 3 2 2 3 1 2 2 1 2 1 11 3 6 3 1 1 2 2 3 1 7 1 4 1 2 6 1 4 2 5 4 3 1 11 3\r\nshh2ewyegnuwnmdse5kl5toybdvzkvk2yj4zcowz6iwhhh3ykdfa.b32.i2p 3 3 9 4 1 88 8 3 6 1 28 1 4 1 5 1 1 2 57 12 1 3 6 86 2 6 9 4 7 3 3 3 2 15 3 40 5 2 3 4 1 5 1 8 1 4 1 94 1 14 4 3 1 4 1 4 2 5 32 50 3 1 2 1 2 4 1 81 2 6 6 1 7 1 1 2 3 2 5 5 4 2 7 2 90 1\r\nvnqix5uljfwssvzbexzjeuoehjujtw4iqftiu34nbvig64kkmnla.b32.i2p 1 1 1 1 2 14 1 1 1 9 2 1 1 2 5 19 1 3 1 1 2 1 1 1 2 2 3 3 5 3 4 1 5 1 5 1 1 19 7 2 1 1 5 1 23 1 1 1 2 3 6 2 3 3 3 10 6 16 3 4 6 3 7 1 1 1 2 4 4 1 1 2 9 11 2 3 6 3\r\n```\r\n</details>\r\n\r\nNext thing would be to log the accepted and dropped addresses and sample the % of the ones that are responsive. If the good/responsive VS down/unresponsive/bogus? rate is the same in the accepted and dropped then the dropped traffic was legit and should not have been dropped.\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-879256798",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5015230382,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAxNTIzMDM4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5015230382",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T17:08:52Z"
    },
    {
      "event": "subscribed",
      "id": 5015230390,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMTUyMzAzOTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5015230390",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-13T17:08:52Z"
    },
    {
      "event": "commented",
      "id": 879504816,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTUwNDgxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/879504816",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:08:02Z",
      "updated_at": "2021-07-14T01:08:02Z",
      "author_association": "MEMBER",
      "body": "@vasild I assume that whoever is creating these spam addr messages isn't sending them directly to you, and is probably sending them in batches of 10 (because when you send more, they don't trigger relay, and thus we wouldn't be seeing them). So what you're seeing is the backscatter result of what ends up randomly relayed 1 or more steps on, split by the 1-to-2 peers selection, and merged by the m_addr_to_send vectors.\r\n\r\nWhat I'm observing is that there are sometimes hours of barely any rate-limiting going on, and then suddenly a ton, from multiple peers at once. This makes me think we should be primarily looking at those low-activity periods, as they are almost certainly more representative of honest traffic. In the presence of a spam attack, rate-limiting will drop things - including legitimate traffic - but I don't think that's fundamentally different from what would otherwise be happening; the loss would just happen in a different place (rate-limiting, vs overwriting in `m_addr_to_send`). So I think I prefer keeping it at 0.1/s for now.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-879504816",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5016930618,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAxNjkzMDYxOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5016930618",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:08:02Z"
    },
    {
      "event": "subscribed",
      "id": 5016930623,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMTY5MzA2MjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5016930623",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:08:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5016955188,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAxNjk1NTE4OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5016955188",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:18:52Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5016982497,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAxNjk4MjQ5Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5016982497",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:31:34Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5016982849,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAxNjk4Mjg0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5016982849",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T01:31:45Z"
    },
    {
      "event": "reviewed",
      "id": 705989456,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA1OTg5NDU2",
      "url": null,
      "actor": null,
      "commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-705989456",
      "submitted_at": "2021-07-14T08:37:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 706054718,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA2MDU0NzE4",
      "url": null,
      "actor": null,
      "commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-706054718",
      "submitted_at": "2021-07-14T10:24:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5021521434,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAyMTUyMTQzNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5021521434",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T19:09:39Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5021550205,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAyMTU1MDIwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5021550205",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-14T19:16:37Z"
    },
    {
      "event": "commented",
      "id": 880411631,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDQxMTYzMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880411631",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T05:40:46Z",
      "updated_at": "2021-07-15T05:40:46Z",
      "author_association": "MEMBER",
      "body": "All comments addressed, I think.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-880411631",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "reviewed",
      "id": 707032297,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA3MDMyMjk3",
      "url": null,
      "actor": null,
      "commit_id": "56c8ca2844fecb980cfdd9a21c881ed0616890d8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 56c8ca2844fecb980cfdd9a21c881ed0616890d8",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-707032297",
      "submitted_at": "2021-07-15T07:50:22Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 707124589,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA3MTI0NTg5",
      "url": null,
      "actor": null,
      "commit_id": "023b0c75bb3197b23bd61a795008ce0996a260c9",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-707124589",
      "submitted_at": "2021-07-15T09:19:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 880538711,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDUzODcxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880538711",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T09:20:44Z",
      "updated_at": "2021-07-15T09:20:44Z",
      "author_association": "MEMBER",
      "body": "ACK 56c8ca2844fecb980cfdd9a21c881ed0616890d8",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-880538711",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 880725257,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDcyNTI1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880725257",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T14:08:06Z",
      "updated_at": "2021-07-15T14:08:06Z",
      "author_association": "MEMBER",
      "body": "ACK 56c8ca2844fecb980cfdd9a21c881ed0616890d8\r\n\r\nIf you touch this again, I suggest squashing _Add logging for rate limiting_ and _Add addr rate limiting statistics_ (the second commit completely reverts the changes of the first).\r\n\r\nI've made some improvements to the test here: https://github.com/jnewbery/bitcoin/tree/2021-07-addr-relay-test-changes that factors out a lot of duplicate code. Feel free to take any of those changes in this PR, or I can open a follow-up after this is merged.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-880725257",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 880799030,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDc5OTAzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880799030",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T15:37:09Z",
      "updated_at": "2021-07-15T15:49:14Z",
      "author_association": "MEMBER",
      "body": "Not sure if it is related to the changes here, but I got an ~~intermittent~~ reprodicible fail in `p2p_addrv2_relay.py` locally when running with this PR on top of master (56c8ca2844fecb980cfdd9a21c881ed0616890d8).\r\n```\r\n83/213 - p2p_addrv2_relay.py failed, Duration: 8 s\r\n                                                                                       \r\nstdout:                                                                                \r\n2021-07-15T15:33:49.927000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_₿_🏃_20210715_172622/p2p_addrv2_relay_129\r\n2021-07-15T15:33:51.721000Z TestFramework (INFO): Create connection that sends addrv2 messages\r\n2021-07-15T15:33:51.825000Z TestFramework (INFO): Send too-large addrv2 message\r\n2021-07-15T15:33:51.890000Z TestFramework (INFO): Check that addrv2 message content is relayed and added to addrman\r\n2021-07-15T15:33:52.099000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):                                                     \r\n  File \"…/bitcoin/test/functional/test_framework/test_framework.py\", line 128, in main\r\n    self.run_test()\r\n  File \"…/bitcoin/test/functional/p2p_addrv2_relay.py\", line 82, in run_test\r\n    assert addr_receiver.addrv2_received_and_checked\r\nAssertionError\r\n2021-07-15T15:33:52.152000Z TestFramework (INFO): Stopping nodes\r\n```\r\nEdit: ran the tests again and it happened again, seems reproducible.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-880799030",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 880860700,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDg2MDcwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/880860700",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T16:54:29Z",
      "updated_at": "2021-07-15T16:54:29Z",
      "author_association": "MEMBER",
      "body": "> I got an reprodicible fail in p2p_addrv2_relay.py locally when running with this PR on top of master (56c8ca2).\r\n\r\nThis is because the bitcoin core node is now shuffling the addresses before processing/relaying them, and this test depends on the exact same `addrv2` message being received by the node and relayed to another peer.\r\n\r\nThis would fix it. Sorry for the ugly python:\r\n\r\n```diff\r\n@@ -42,7 +42,10 @@ class AddrReceiver(P2PInterface):\r\n         super().__init__(support_addrv2 = True)\r\n \r\n     def on_addrv2(self, message):\r\n-        if ADDRS == message.addrs:\r\n+        sorted_addrs_received = sorted(zip([address.ip for address in message.addrs], [address.port for address in message.addrs]))\r\n+        sorted_addrs_expected = sorted(zip([address.ip for address in ADDRS], [address.port for address in ADDRS]))\r\n+        if sorted_addrs_received == sorted_addrs_expected:\r\n             self.addrv2_received_and_checked = True\r\n \r\n     def wait_for_addrv2(self):\r\n```\r\n\r\n(there's no ordering function on `CAddress` objects)",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-880860700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZDY0YjhmNzA5YjQ2NTVkODcwMmY4MTBkNDg3NmNkOGQ5NmRlZDgy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0d64b8f709b4655d8702f810d4876cd8d96ded82",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0d64b8f709b4655d8702f810d4876cd8d96ded82",
      "tree": {
        "sha": "8cb80df524d325c9fddd5f7e43202176375951ec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8cb80df524d325c9fddd5f7e43202176375951ec"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a88fa1a555195af6543cdc802e8e1c2e1668dd38",
          "sha": "a88fa1a555195af6543cdc802e8e1c2e1668dd38",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a88fa1a555195af6543cdc802e8e1c2e1668dd38"
        }
      ],
      "message": "Rate limit the processing of incoming addr messages\n\nWhile limitations on the influence of attackers on addrman already\nexist (affected buckets are restricted to a subset based on incoming\nIP / network group), there is no reason to permit them to let them\nfeed us addresses at more than a multiple of the normal network\nrate.\n\nThis commit introduces a \"token bucket\" rate limiter for the\nprocessing of addresses in incoming ADDR and ADDRV2 messages.\nEvery connection gets an associated token bucket. Processing an\naddress in an ADDR or ADDRV2 message from non-whitelisted peers\nconsumes a token from the bucket. If the bucket is empty, the\naddress is ignored (it is not forwarded or processed). The token\ncounter increases at a rate of 0.1 tokens per second, and will\naccrue up to a maximum of 1000 tokens (the maximum we accept in a\nsingle ADDR or ADDRV2). When a GETADDR is sent to a peer, it\nimmediately gets 1000 additional tokens, as we actively desire many\naddresses from such peers (this may temporarily cause the token\ncount to exceed 1000).\n\nThe rate limit of 0.1 addr/s was chosen based on observation of\nhonest nodes on the network. Activity in general from most nodes\nis either 0, or up to a maximum around 0.025 addr/s for recent\nBitcoin Core nodes. A few (self-identified, through subver) crawler\nnodes occasionally exceed 0.1 addr/s.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T19:52:38Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-06-30T18:52:40Z"
      },
      "sha": "0d64b8f709b4655d8702f810d4876cd8d96ded82"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NjQ4MTM4ZjU5NDkwMTMzMzFjMDE3Yzc0MDY0NmUyZjQwMTNiYzI0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5648138f5949013331c017c740646e2f4013bc24",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5648138f5949013331c017c740646e2f4013bc24",
      "tree": {
        "sha": "180d8e759edcd7497ff3dc78e1ec67eff8c406cb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/180d8e759edcd7497ff3dc78e1ec67eff8c406cb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0d64b8f709b4655d8702f810d4876cd8d96ded82",
          "sha": "0d64b8f709b4655d8702f810d4876cd8d96ded82",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0d64b8f709b4655d8702f810d4876cd8d96ded82"
        }
      ],
      "message": "Randomize the order of addr processing",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T19:59:23Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T19:59:23Z"
      },
      "sha": "5648138f5949013331c017c740646e2f4013bc24"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNGVjZThhMWNkYTY5Y2MyNjhkMzlkMjFiYmE1OWM1MWZhMmZiOWVk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed",
      "tree": {
        "sha": "aa77badd1339302803db3f12b2e75a304c543634",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aa77badd1339302803db3f12b2e75a304c543634"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5648138f5949013331c017c740646e2f4013bc24",
          "sha": "5648138f5949013331c017c740646e2f4013bc24",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5648138f5949013331c017c740646e2f4013bc24"
        }
      ],
      "message": "Functional tests for addr rate limiting",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T20:03:17Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-01T23:02:05Z"
      },
      "sha": "b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNDI0ZDYwMWUxYjY4NzBlMjBiYzYwZjVjY2JhMzZkMmUyMTAzNzdi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f424d601e1b6870e20bc60f5ccba36d2e210377b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f424d601e1b6870e20bc60f5ccba36d2e210377b",
      "tree": {
        "sha": "d56831c9b26dcc22796bcb39349e946cd9016175",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d56831c9b26dcc22796bcb39349e946cd9016175"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed",
          "sha": "b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b4ece8a1cda69cc268d39d21bba59c51fa2fb9ed"
        }
      ],
      "message": "Add logging and addr rate limiting statistics\n\nIncludes logging improvements by Vasil Dimov and John Newbery.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T20:03:20Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-07T18:44:40Z"
      },
      "sha": "f424d601e1b6870e20bc60f5ccba36d2e210377b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5027606452,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAyNzYwNjQ1Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5027606452",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T20:28:53Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNGJjZDY4N2M5MzRkNDdhYTM5MjIzMzRlOTdlNTc5Y2FmNWY4MTI0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a4bcd687c934d47aa3922334e97e579caf5f8124",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a4bcd687c934d47aa3922334e97e579caf5f8124",
      "tree": {
        "sha": "2ff4bd1efd38936b75bdf26e8ccae3a0538e247b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2ff4bd1efd38936b75bdf26e8ccae3a0538e247b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f424d601e1b6870e20bc60f5ccba36d2e210377b",
          "sha": "f424d601e1b6870e20bc60f5ccba36d2e210377b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f424d601e1b6870e20bc60f5ccba36d2e210377b"
        }
      ],
      "message": "Improve tests using statistics",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2021-07-15T23:31:47Z"
      },
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-07-14T18:58:50Z"
      },
      "sha": "a4bcd687c934d47aa3922334e97e579caf5f8124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5028161781,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTAyODE2MTc4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5028161781",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:32:08Z"
    },
    {
      "event": "commented",
      "id": 881074512,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg4MTA3NDUxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881074512",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:34:24Z",
      "updated_at": "2021-07-15T23:34:24Z",
      "author_association": "MEMBER",
      "body": "@laanwj Fixed using a variant of @jnewbery's suggestion. Also squashed in his commits for cleaning up the new tests.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-881074512",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "mentioned",
      "id": 5028166387,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAyODE2NjM4Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5028166387",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:34:24Z"
    },
    {
      "event": "subscribed",
      "id": 5028166391,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMjgxNjYzOTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5028166391",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:34:24Z"
    },
    {
      "event": "mentioned",
      "id": 5028166393,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NTAyODE2NjM5Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5028166393",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:34:24Z"
    },
    {
      "event": "subscribed",
      "id": 5028166395,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDUwMjgxNjYzOTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5028166395",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-15T23:34:24Z"
    },
    {
      "event": "reviewed",
      "id": 708091213,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA4MDkxMjEz",
      "url": null,
      "actor": null,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK a4bcd687c934d47aa3922334e97e579caf5f8124",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-708091213",
      "submitted_at": "2021-07-16T07:38:25Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 708186507,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA4MTg2NTA3",
      "url": null,
      "actor": null,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK a4bcd687c934d47aa3922334e97e579caf5f8124",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-708186507",
      "submitted_at": "2021-07-16T09:35:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "reviewed",
      "id": 708235682,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA4MjM1Njgy",
      "url": null,
      "actor": null,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK a4bcd687c934d47aa3922334e97e579caf5f8124",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-708235682",
      "submitted_at": "2021-07-16T10:40:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "commented",
      "id": 881381758,
      "node_id": "IC_kwDOABII5840iNF-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881381758",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-16T11:34:18Z",
      "updated_at": "2021-08-14T17:37:19Z",
      "author_association": "MEMBER",
      "body": "Here's a branch of this pull that adds the new stats to `-netinfo`, if useful to anyone for testing: https://github.com/jonatack/bitcoin/commits/netinfo-addr-statistics\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-881381758",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "commented",
      "id": 882443434,
      "node_id": "IC_kwDOABII5840mQSq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/882443434",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-19T10:41:50Z",
      "updated_at": "2021-07-19T10:41:50Z",
      "author_association": "MEMBER",
      "body": "ACK a4bcd687c934d47aa3922334e97e579caf5f8124",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-882443434",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "merged",
      "id": 5037666821,
      "node_id": "MDExOk1lcmdlZEV2ZW50NTAzNzY2NjgyMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5037666821",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d3474b8df2f973e9b9142c0b64505a8a78bcb292",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d3474b8df2f973e9b9142c0b64505a8a78bcb292",
      "created_at": "2021-07-19T10:42:41Z"
    },
    {
      "event": "closed",
      "id": 5037666837,
      "node_id": "MDExOkNsb3NlZEV2ZW50NTAzNzY2NjgzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5037666837",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-19T10:42:42Z"
    },
    {
      "event": "reviewed",
      "id": 709697940,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA5Njk3OTQw",
      "url": null,
      "actor": null,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "post-merge cr ACK",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#pullrequestreview-709697940",
      "submitted_at": "2021-07-19T15:57:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
    },
    {
      "event": "referenced",
      "id": 5058786346,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwNTg3ODYzNDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5058786346",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d2db5ff149d13f35f65bae7715b415670a18cd54",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/d2db5ff149d13f35f65bae7715b415670a18cd54",
      "created_at": "2021-07-23T01:27:00Z"
    },
    {
      "event": "referenced",
      "id": 5081298272,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODEyOTgyNzI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5081298272",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "325bf3b6fc9cc5d1c5cff49144c623ea998cbdc2",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/325bf3b6fc9cc5d1c5cff49144c623ea998cbdc2",
      "created_at": "2021-07-28T16:32:29Z"
    },
    {
      "event": "referenced",
      "id": 5081298281,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODEyOTgyODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5081298281",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6c32ceb97936ba5360f094380f7638913c661477",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/6c32ceb97936ba5360f094380f7638913c661477",
      "created_at": "2021-07-28T16:32:29Z"
    },
    {
      "event": "referenced",
      "id": 5081298293,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODEyOTgyOTM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5081298293",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6da0776042d944f7ca9f5c5a965cb75697ce233a",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/6da0776042d944f7ca9f5c5a965cb75697ce233a",
      "created_at": "2021-07-28T16:32:29Z"
    },
    {
      "event": "referenced",
      "id": 5082887222,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODI4ODcyMjI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5082887222",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a4ae2a624432675a84bf24ea02f89141d8e16a79",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/a4ae2a624432675a84bf24ea02f89141d8e16a79",
      "created_at": "2021-07-28T23:00:59Z"
    },
    {
      "event": "commented",
      "id": 888695939,
      "node_id": "IC_kwDOABII5840-GyD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/888695939",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-07-28T23:57:36Z",
      "updated_at": "2021-07-28T23:57:36Z",
      "author_association": "MEMBER",
      "body": "Backported in #22569.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#issuecomment-888695939",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22387"
    },
    {
      "event": "referenced",
      "id": 5083027624,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODMwMjc2MjQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5083027624",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "55fcbde5a9fc35b187a8cb31004e5ce94bdbbedd",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/55fcbde5a9fc35b187a8cb31004e5ce94bdbbedd",
      "created_at": "2021-07-29T00:00:25Z"
    },
    {
      "event": "referenced",
      "id": 5087002073,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODcwMDIwNzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087002073",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4534aae4f7e4bf28eb446f3d944ee9709157fad8",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/4534aae4f7e4bf28eb446f3d944ee9709157fad8",
      "created_at": "2021-07-29T16:05:23Z"
    },
    {
      "event": "referenced",
      "id": 5087002078,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODcwMDIwNzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087002078",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6dec444ca2c0b80688a0f6ba9cd43e4539891749",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/6dec444ca2c0b80688a0f6ba9cd43e4539891749",
      "created_at": "2021-07-29T16:05:23Z"
    },
    {
      "event": "referenced",
      "id": 5087002081,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODcwMDIwODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087002081",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b65129e8e38d464c0a5c2cb9ccf8a1c9ca2fd2e9",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/b65129e8e38d464c0a5c2cb9ccf8a1c9ca2fd2e9",
      "created_at": "2021-07-29T16:05:23Z"
    },
    {
      "event": "referenced",
      "id": 5087002086,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODcwMDIwODY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087002086",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "651216e70b0cd1aaa1318db07e1d89d9cbb65cf3",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/651216e70b0cd1aaa1318db07e1d89d9cbb65cf3",
      "created_at": "2021-07-29T16:05:23Z"
    },
    {
      "event": "referenced",
      "id": 5087362697,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODczNjI2OTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087362697",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1fc214f7fdc57fa10757867a8a1e865eabe3ce47",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/1fc214f7fdc57fa10757867a8a1e865eabe3ce47",
      "created_at": "2021-07-29T17:19:11Z"
    },
    {
      "event": "referenced",
      "id": 5087362699,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODczNjI2OTk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087362699",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5cf36bbdee1426312c1284333f191ea5fd6f1245",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/5cf36bbdee1426312c1284333f191ea5fd6f1245",
      "created_at": "2021-07-29T17:19:11Z"
    },
    {
      "event": "referenced",
      "id": 5087362706,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODczNjI3MDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087362706",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d21ebf622440d63a3087509e9af7fa986463c961",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/d21ebf622440d63a3087509e9af7fa986463c961",
      "created_at": "2021-07-29T17:19:11Z"
    },
    {
      "event": "referenced",
      "id": 5087362711,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUwODczNjI3MTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5087362711",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4e6661fe5c60f555246abec7e16287d951feb317",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/4e6661fe5c60f555246abec7e16287d951feb317",
      "created_at": "2021-07-29T17:19:11Z"
    },
    {
      "event": "referenced",
      "id": 5118623175,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxMTg2MjMxNzU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5118623175",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "83dfe6c65ef6c30ca01348ee5059c3d76e03d1d3",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/83dfe6c65ef6c30ca01348ee5059c3d76e03d1d3",
      "created_at": "2021-08-05T16:42:22Z"
    },
    {
      "event": "referenced",
      "id": 5118623183,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxMTg2MjMxODM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5118623183",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8df3e5bd84f2b2b60730034cbd71fe8f3276d434",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/8df3e5bd84f2b2b60730034cbd71fe8f3276d434",
      "created_at": "2021-08-05T16:42:22Z"
    },
    {
      "event": "referenced",
      "id": 5118623212,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxMTg2MjMyMTI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5118623212",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "aaa4833fc9c3d44378e232002f4b9b447a2d18cb",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/aaa4833fc9c3d44378e232002f4b9b447a2d18cb",
      "created_at": "2021-08-05T16:42:22Z"
    },
    {
      "event": "referenced",
      "id": 5118623217,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxMTg2MjMyMTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5118623217",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a653aacbd66a47edd6d14ddc62fec2d4038456b8",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/a653aacbd66a47edd6d14ddc62fec2d4038456b8",
      "created_at": "2021-08-05T16:42:22Z"
    },
    {
      "event": "referenced",
      "id": 5124103556,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxMjQxMDM1NTY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5124103556",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4b523c8f0a7288e1be01ce114336aa2bba20b4c5",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4b523c8f0a7288e1be01ce114336aa2bba20b4c5",
      "created_at": "2021-08-06T17:46:18Z"
    },
    {
      "event": "referenced",
      "id": 5158306883,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDUxNTgzMDY4ODM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5158306883",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4c87665707af838e1cc6c3c2e65434cfc826dfec",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4c87665707af838e1cc6c3c2e65434cfc826dfec",
      "created_at": "2021-08-14T05:34:10Z"
    },
    {
      "event": "referenced",
      "id": 5768789340,
      "node_id": "REFE_lADOABII5843v9m-zwAAAAFX2L1c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5768789340",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2af73be906e8c6e4f571a4615c7f8778a8404b31",
      "commit_url": "https://api.github.com/repos/bitcoinknots/bitcoin/commits/2af73be906e8c6e4f571a4615c7f8778a8404b31",
      "created_at": "2021-12-15T05:04:08Z"
    },
    {
      "event": "referenced",
      "id": 5986164247,
      "node_id": "REFE_lADOABII5843v9m-zwAAAAFkzZ4X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5986164247",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a1509f778ab76025255ac0d1f3898a86ab074ff2",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/a1509f778ab76025255ac0d1f3898a86ab074ff2",
      "created_at": "2022-02-01T07:46:53Z"
    },
    {
      "event": "referenced",
      "id": 5986164250,
      "node_id": "REFE_lADOABII5843v9m-zwAAAAFkzZ4a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5986164250",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b9ceb82661aa8cb1cfb55497d2fd6e8d88e09eae",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/b9ceb82661aa8cb1cfb55497d2fd6e8d88e09eae",
      "created_at": "2022-02-01T07:46:53Z"
    },
    {
      "event": "referenced",
      "id": 6301508700,
      "node_id": "REFE_lADOABII5843v9m-zwAAAAF3mWRc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6301508700",
      "actor": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "716a21d72835ea3081f48a379ee71ae2f44b811d",
      "commit_url": "https://api.github.com/repos/stickies-v/bitcoin-devwiki/commits/716a21d72835ea3081f48a379ee71ae2f44b811d",
      "created_at": "2022-03-24T17:57:31Z"
    },
    {
      "event": "referenced",
      "id": 6723199444,
      "node_id": "REFE_lADOABII5843v9m-zwAAAAGQu-HU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6723199444",
      "actor": {
        "login": "gwillen",
        "id": 458997,
        "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gwillen",
        "html_url": "https://github.com/gwillen",
        "followers_url": "https://api.github.com/users/gwillen/followers",
        "following_url": "https://api.github.com/users/gwillen/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gwillen/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gwillen/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
        "organizations_url": "https://api.github.com/users/gwillen/orgs",
        "repos_url": "https://api.github.com/users/gwillen/repos",
        "events_url": "https://api.github.com/users/gwillen/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gwillen/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d4c71593bb3d78c935033d83594d9858740d1a28",
      "commit_url": "https://api.github.com/repos/ElementsProject/elements/commits/d4c71593bb3d78c935033d83594d9858740d1a28",
      "created_at": "2022-06-01T21:22:39Z"
    },
    {
      "event": "locked",
      "id": 7216591177,
      "node_id": "LOE_lADOABII5843v9m-zwAAAAGuJHFJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7216591177",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-18T18:32:52Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662921032",
      "pull_request_review_id": 698062663,
      "id": 662921032,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MjkyMTAzMg==",
      "diff_hunk": "@@ -232,6 +235,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};\n+    /** When m_addr_token_bucket was last updated */\n+    std::chrono::microseconds m_addr_token_timestamp{0};",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No need for default initialization value here if this is set in the initialization list in the only ctor.",
      "created_at": "2021-07-02T10:45:40Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662921032",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662921032"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662943964",
      "pull_request_review_id": 698062663,
      "id": 662943964,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk0Mzk2NA==",
      "diff_hunk": "@@ -2776,11 +2787,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+        double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+        peer->m_addr_token_timestamp = current_time;\n+        peer->m_addr_token_bucket += std::max(0.0, std::min<double>(MAX_ADDR_TO_SEND - peer->m_addr_token_bucket, increment));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 49,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I find this line quite difficult to parse. I think the intention is that we don't cap m_addr_token_bucket to MAX_ADDR_TO_SEND (in the case where it was incremented because we sent a getaddr). Is this easier to read:\r\n\r\n```diff\r\n         // Update/increment addr rate limiting bucket.\r\n         const auto current_time = GetTime<std::chrono::microseconds>();\r\n-        auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n-        double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\r\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\r\n+            // Don't increment bucket if it's already full\r\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\r\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\r\n+        }\r\n         peer->m_addr_token_timestamp = current_time;\r\n-        peer->m_addr_token_bucket += std::max(0.0, std::min<double>(MAX_ADDR_TO_SEND - peer->m_addr_token_bucket, increment));\r\n \r\n         for (CAddress& addr : vAddr)\r\n         {\r\n```",
      "created_at": "2021-07-02T11:28:36Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662943964",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662943964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662944636",
      "pull_request_review_id": 698062663,
      "id": 662944636,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk0NDYzNg==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 70,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think this is necessary. The `add_[outbound_]p2p_connection()` methods already do a sync_with_ping.",
      "created_at": "2021-07-02T11:29:49Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662944636",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662944636"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662945737",
      "pull_request_review_id": 698062663,
      "id": 662945737,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk0NTczNw==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_0 == 0",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 74,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Consider using the `assert_equal()`/`assert_greater_than()`/`assert_greater_than_or_equal()` helper functions (they give more helpful output if the test fails).",
      "created_at": "2021-07-02T11:31:42Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662945737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662945737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662949531",
      "pull_request_review_id": 698062663,
      "id": 662949531,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk0OTUzMQ==",
      "diff_hunk": "@@ -75,6 +79,19 @@ def setup_addr_msg(self, num):\n         msg.addrs = addrs\n         return msg\n \n+    def setup_rand_addr_msg(self, num):",
      "path": "test/functional/p2p_addr_relay.py",
      "position": 65,
      "original_position": 28,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(not necessarily for this PR) should the other tests be updated to use random IP addresses? I guess you're doing this and not reusing setup_addr_msg() in case the addresses returned may result in addrman bucket collisions?",
      "created_at": "2021-07-02T11:39:22Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662949531",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662949531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 97,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662949805",
      "pull_request_review_id": 698062663,
      "id": 662949805,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk0OTgwNQ==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_0 == 0\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_1 <= tokens\n+            assert addr_count_1 <= addr_count_0 + 600\n+            assert (addr_count_1 > addr_count_0) == (tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_2 <= tokens\n+            assert addr_count_2 <= addr_count_1 + 600\n+            assert (addr_count_2 > addr_count_1) == (tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_3 <= tokens\n+            assert addr_count_3 <= addr_count_2 + 10\n+            assert (addr_count_3 > addr_count_2) == False",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 96,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            assert (addr_count_3 <= addr_count_2)\r\n```\r\n\r\n(or better yet, use `assert_greater_than_or_equal()`)",
      "created_at": "2021-07-02T11:39:58Z",
      "updated_at": "2021-07-02T12:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662949805",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662949805"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 266,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662999155",
      "pull_request_review_id": 698167580,
      "id": 662999155,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mjk5OTE1NQ==",
      "diff_hunk": "@@ -232,6 +235,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};\n+    /** When m_addr_token_bucket was last updated */\n+    std::chrono::microseconds m_addr_token_timestamp{0};",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662921032,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n    std::chrono::microseconds m_addr_token_timestamp{GetTime<std::chrono::microseconds>()};\r\n```\r\n\r\nDoes this compile? If yes, the constructor can be left untouched.",
      "created_at": "2021-07-02T13:06:55Z",
      "updated_at": "2021-07-02T13:06:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r662999155",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/662999155"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663105927",
      "pull_request_review_id": 698314916,
      "id": 663105927,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzEwNTkyNw==",
      "diff_hunk": "@@ -75,6 +79,19 @@ def setup_addr_msg(self, num):\n         msg.addrs = addrs\n         return msg\n \n+    def setup_rand_addr_msg(self, num):",
      "path": "test/functional/p2p_addr_relay.py",
      "position": 65,
      "original_position": 28,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662949531,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I tried to reuse it, but things fail because the existing setup_addr_message are limited to 256 addresses, and when I tried to generalize it, some of the other tests started failing.",
      "created_at": "2021-07-02T15:48:16Z",
      "updated_at": "2021-07-02T15:48:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663105927",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663105927"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 97,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139663",
      "pull_request_review_id": 698359194,
      "id": 663139663,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzEzOTY2Mw==",
      "diff_hunk": "@@ -232,6 +235,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};\n+    /** When m_addr_token_bucket was last updated */\n+    std::chrono::microseconds m_addr_token_timestamp{0};",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662921032,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, it works.",
      "created_at": "2021-07-02T16:51:47Z",
      "updated_at": "2021-07-02T16:51:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663139663",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139663"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139730",
      "pull_request_review_id": 698359287,
      "id": 663139730,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzEzOTczMA==",
      "diff_hunk": "@@ -2776,11 +2787,24 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+        double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+        peer->m_addr_token_timestamp = current_time;\n+        peer->m_addr_token_bucket += std::max(0.0, std::min<double>(MAX_ADDR_TO_SEND - peer->m_addr_token_bucket, increment));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 49,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662943964,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, much better.",
      "created_at": "2021-07-02T16:51:57Z",
      "updated_at": "2021-07-02T16:51:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663139730",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139801",
      "pull_request_review_id": 698359381,
      "id": 663139801,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzEzOTgwMQ==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 70,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662944636,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Gone.",
      "created_at": "2021-07-02T16:52:05Z",
      "updated_at": "2021-07-02T16:52:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663139801",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139843",
      "pull_request_review_id": 698359449,
      "id": 663139843,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzEzOTg0Mw==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_0 == 0",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 74,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662945737,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-02T16:52:11Z",
      "updated_at": "2021-07-02T16:52:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663139843",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663139843"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663141174",
      "pull_request_review_id": 698361128,
      "id": 663141174,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzE0MTE3NA==",
      "diff_hunk": "@@ -207,6 +224,71 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+            peer.sync_with_ping()\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_0 == 0\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_1 <= tokens\n+            assert addr_count_1 <= addr_count_0 + 600\n+            assert (addr_count_1 > addr_count_0) == (tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_2 <= tokens\n+            assert addr_count_2 <= addr_count_1 + 600\n+            assert (addr_count_2 > addr_count_1) == (tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert addr_count_3 <= tokens\n+            assert addr_count_3 <= addr_count_2 + 10\n+            assert (addr_count_3 > addr_count_2) == False",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 96,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "484d8fdd94265b1dc1c850fb2cc3f743b0fffb1c",
      "in_reply_to_id": 662949805,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Or even better: `assert_equal(addr_count_2, addr_count_3)`. Done.",
      "created_at": "2021-07-02T16:54:48Z",
      "updated_at": "2021-07-02T16:54:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663141174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663141174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 266,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663559469",
      "pull_request_review_id": 698709971,
      "id": 663559469,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzU1OTQ2OQ==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (pfrom.addr != addr && !pfrom.HasPermission(NetPermissionFlags::Addr)) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "2decfa58c19d9d6b5604b0931fa34cd94ccc32c8",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why the condition `pfrom.addr != addr` in addition to starting with `m_addr_token_bucket{1.0}`? Shouldn't self-announcements from our peer consume a token too?",
      "created_at": "2021-07-04T21:35:07Z",
      "updated_at": "2021-07-04T22:01:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663559469",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663559469"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663560244",
      "pull_request_review_id": 698709971,
      "id": 663560244,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzU2MDI0NA==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 66,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "bb42151fee7714360f38882a77cbf2bba08cd514",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that this could fail intermittently in the \"inbound\" case, where we have just 1 token. The first addr of the shuffled message consumes the token, but if `IsRoutable()` happens to be false for this random address, it won't be accepted to addrman (`CAddrMan::Add_()`), and other addrs of the message won't be either because there are no tokens left. ",
      "created_at": "2021-07-04T21:42:35Z",
      "updated_at": "2021-07-04T22:01:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663560244",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663560244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 251,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663560937",
      "pull_request_review_id": 698709971,
      "id": 663560937,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2MzU2MDkzNw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "2decfa58c19d9d6b5604b0931fa34cd94ccc32c8",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What is the reason for adding the `Shuffle` here, considering that the token counter grows deterministically and our peer could calculate anyway how many addrs of the packet we would process/discard if they cared to keep track of that?",
      "created_at": "2021-07-04T21:50:31Z",
      "updated_at": "2021-07-04T22:01:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r663560937",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/663560937"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2812,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664232247",
      "pull_request_review_id": 699531352,
      "id": 664232247,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDIzMjI0Nw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (pfrom.addr != addr && !pfrom.HasPermission(NetPermissionFlags::Addr)) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "2decfa58c19d9d6b5604b0931fa34cd94ccc32c8",
      "in_reply_to_id": 663559469,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's a leftover from an earlier iteration where I didn't have the `m_addr_token_bucket{1.0}` initialization. I've removed it.",
      "created_at": "2021-07-06T04:47:18Z",
      "updated_at": "2021-07-06T04:47:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664232247",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664232247"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664237309",
      "pull_request_review_id": 699537302,
      "id": 664237309,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDIzNzMwOQ==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 66,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "bb42151fee7714360f38882a77cbf2bba08cd514",
      "in_reply_to_id": 663560244,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've updated the test to generate only routable IPs.",
      "created_at": "2021-07-06T05:03:46Z",
      "updated_at": "2021-07-06T05:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664237309",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664237309"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 251,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664238361",
      "pull_request_review_id": 699538711,
      "id": 664238361,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDIzODM2MQ==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "2decfa58c19d9d6b5604b0931fa34cd94ccc32c8",
      "in_reply_to_id": 663560937,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The idea is that if we're going to be dropping some part of incoming messages because of rate-limiting, we should do it uniformly. This isn't to stop any kind of attack, but to give slightly fairer treatment to existing nodes on the network, which don't randomize on sending (there is random replacement once the outgoing buffer hits 1000, but that is rarely if ever hit under normal network conditions).",
      "created_at": "2021-07-06T05:07:27Z",
      "updated_at": "2021-07-06T05:07:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664238361",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664238361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2812,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664460746",
      "pull_request_review_id": 699826384,
      "id": 664460746,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDQ2MDc0Ng==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not being intimately familiar with the `std::chrono` library, I found this line a little difficult to parse. The `std::chrono::duration<double>` is an instantiation of `duration` with the representation set to `double` and the period set to the default ratio of `1` (i.e. one second). This line therefore initializes a `duration` object that represents seconds as doubles from the `time_diff` variable (and then multiplies by the `MAX_ADDR_RATE_PER_SECOND`).",
      "created_at": "2021-07-06T11:12:12Z",
      "updated_at": "2021-07-06T16:17:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664460746",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664460746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664467172",
      "pull_request_review_id": 699826384,
      "id": 664467172,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDQ2NzE3Mg==",
      "diff_hunk": "@@ -58,6 +58,7 @@ class InvalidMessagesTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.num_nodes = 1\n         self.setup_clean_chain = True\n+        self.extra_args = [[\"-whitelist=addr@127.0.0.1\"]]",
      "path": "test/functional/p2p_invalid_messages.py",
      "position": 4,
      "original_position": 4,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It was surprising that this test needed to be updated. My understanding was that it was testing malformed p2p messages in the net layer, but it seems that various application layer errors have also been added to the test.",
      "created_at": "2021-07-06T11:23:03Z",
      "updated_at": "2021-07-06T16:17:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664467172",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664467172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 61,
      "original_line": 61,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664543727",
      "pull_request_review_id": 699937128,
      "id": 664543727,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU0MzcyNw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (!pfrom.HasPermission(NetPermissionFlags::Addr)) {\n+                if (peer->m_addr_token_bucket < 1.0) continue;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should that not be `break;`? `peer->m_addr_token_bucket` is not going to increase inside this loop.",
      "created_at": "2021-07-06T13:14:07Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664543727",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664543727"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2809,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664547038",
      "pull_request_review_id": 699937128,
      "id": 664547038,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU0NzAzOA==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: this entire snippet can be inside `if (!pfrom.HasPermission(NetPermissionFlags::Addr)) {` to avoid making calculations that are not going to be used later. That may be insignificant wrt performance (the shuffle too?) and the deeper indentation may look ugly, so feel free to ignore.",
      "created_at": "2021-07-06T13:18:15Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664547038",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664547038"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2791,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2812,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664552110",
      "pull_request_review_id": 699937128,
      "id": 664552110,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU1MjExMA==",
      "diff_hunk": "@@ -155,6 +155,9 @@ static constexpr uint32_t MAX_GETCFHEADERS_SIZE = 2000;\n static constexpr size_t MAX_PCT_ADDR_TO_SEND = 23;\n /** The maximum number of address records permitted in an ADDR message. */\n static constexpr size_t MAX_ADDR_TO_SEND{1000};\n+/** The maximum rate of address records we're willing to process on average. Can be bypassed using\n+ *  the NetPermissionFlags::Addr permission. */\n+static constexpr double MAX_ADDR_RATE_PER_SECOND{0.1};",
      "path": "src/net_processing.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "For bucket size we use `MAX_ADDR_TO_SEND` in the code, but they are semantically different. Maybe add new constant `ADDR_RATE_BUCKET_SIZE`? Should that be a little bit higher than `MAX_ADDR_TO_SEND`? For example:\r\n\r\n1. The peer sends us some unsolicited addr\r\n2. We send getaddr and fill the bucket to the max 1000\r\n3. We receive the unsolicited addr from 1.\r\n4. We receive the getaddr response from 2. (1000 addresses)\r\n\r\n=> some address is going to be dropped unnecessary, even though the peer did not \"spam\" us.",
      "created_at": "2021-07-06T13:24:37Z",
      "updated_at": "2021-07-06T13:34:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664552110",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664552110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664553208",
      "pull_request_review_id": 699937128,
      "id": 664553208,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU1MzIwOA==",
      "diff_hunk": "@@ -2583,6 +2591,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             peer->m_getaddr_sent = true;\n+            // When requesting a getaddr, accept an additional MAX_ADDR_TO_SEND addresses in response.\n+            peer->m_addr_token_bucket += MAX_ADDR_TO_SEND;",
      "path": "src/net_processing.cpp",
      "position": 45,
      "original_position": 27,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is ok as `MAX_ADDR_TO_SEND`",
      "created_at": "2021-07-06T13:25:54Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664553208",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664553208"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2606,
      "original_line": 2606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664553943",
      "pull_request_review_id": 699937128,
      "id": 664553943,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU1Mzk0Mw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This `MAX_ADDR_TO_SEND` is semantically the bucket size, so if a new constant is added it should be used here.",
      "created_at": "2021-07-06T13:26:48Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664553943",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664553943"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2793,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664554249",
      "pull_request_review_id": 699937128,
      "id": 664554249,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU1NDI0OQ==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This `MAX_ADDR_TO_SEND` is semantically the bucket size, so if a new constant is added it should be used here.",
      "created_at": "2021-07-06T13:27:07Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664554249",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664554249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2797,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664559669",
      "pull_request_review_id": 699937128,
      "id": 664559669,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDU1OTY2OQ==",
      "diff_hunk": "@@ -75,6 +80,19 @@ def setup_addr_msg(self, num):\n         msg.addrs = addrs\n         return msg\n \n+    def setup_rand_addr_msg(self, num):\n+        addrs = []\n+        for i in range(num):\n+            addr = CAddress()\n+            addr.time = self.mocktime + i\n+            addr.nServices = NODE_NETWORK | NODE_WITNESS\n+            addr.ip = f\"{random.randrange(128,169)}.{random.randrange(1,255)}.{1+random.randrange(1,255)}.{1+random.randrange(1,255)}\"",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 36,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why the second octet in [1,254] and 3rd and 4th [2,255]?\r\n\r\n`1+randrange(1,255)` is the same as `randrange(2,256)`, why the former?",
      "created_at": "2021-07-06T13:33:26Z",
      "updated_at": "2021-07-06T13:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664559669",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664559669"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664699379",
      "pull_request_review_id": 700147680,
      "id": 664699379,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDY5OTM3OQ==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_2)\n+            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\n+            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_3)\n+            assert_equal(addr_count_2, addr_count_3)\n+\n+            # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\n+            # but verify that no more than 10 are processed.\n+            self.mocktime += 100\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 10\n+            peer.send_and_ping(self.setup_rand_addr_msg(200))\n+            addr_count_4 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_4)\n+            assert_greater_than_or_equal(addr_count_3 + 10, addr_count_4)\n+\n+            # Advance the time by 1000 seconds, permitting the processing of 100 more addresses. Send 200,\n+            # but verify that no more than 100 are processed (and at least some).\n+            self.mocktime += 1000\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 100\n+            peer.send_and_ping(self.setup_rand_addr_msg(200))\n+            addr_count_5 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_5)\n+            assert_greater_than_or_equal(addr_count_4 + 100, addr_count_5)\n+            assert_equal(addr_count_5 > addr_count_4, not no_relay)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 119,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Isn't the `Advance the time by 100 seconds` test unnecessary given the `Advance the time by 1000 seconds` test? I think the latter is testing everything that the former does.",
      "created_at": "2021-07-06T16:16:35Z",
      "updated_at": "2021-07-06T16:19:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664699379",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664699379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 267,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664699518",
      "pull_request_review_id": 699826384,
      "id": 664699518,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDY5OTUxOA==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_2)\n+            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\n+            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_3)\n+            assert_equal(addr_count_2, addr_count_3)\n+\n+            # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\n+            # but verify that no more than 10 are processed.\n+            self.mocktime += 100\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 10",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 103,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You reuse this value of 10 lower down. How about saving it as a variable to remove that repetition (and also to test that the no_relay node's addr count doesn't increase):\r\n\r\n```diff\r\n--- a/test/functional/p2p_addr_relay.py\r\n+++ b/test/functional/p2p_addr_relay.py\r\n@@ -268,23 +268,23 @@ class AddrTest(BitcoinTestFramework):\r\n             # but verify that no more than 10 are processed.\r\n             self.mocktime += 100\r\n             self.nodes[0].setmocktime(self.mocktime)\r\n-            if not no_relay:\r\n-                tokens += 10\r\n+            new_tokens = 0 if no_relay else 10\r\n+            tokens += new_tokens\r\n             peer.send_and_ping(self.setup_rand_addr_msg(200))\r\n             addr_count_4 = len(self.nodes[0].getnodeaddresses(0))\r\n             assert_greater_than_or_equal(tokens, addr_count_4)\r\n-            assert_greater_than_or_equal(addr_count_3 + 10, addr_count_4)\r\n+            assert_greater_than_or_equal(addr_count_3 + new_tokens, addr_count_4)\r\n \r\n             # Advance the time by 1000 seconds, permitting the processing of 100 more addresses. Send 200,\r\n             # but verify that no more than 100 are processed (and at least some).\r\n             self.mocktime += 1000\r\n             self.nodes[0].setmocktime(self.mocktime)\r\n-            if not no_relay:\r\n-                tokens += 100\r\n+            new_tokens = 0 if no_relay else 100\r\n+            tokens += new_tokens\r\n             peer.send_and_ping(self.setup_rand_addr_msg(200))\r\n             addr_count_5 = len(self.nodes[0].getnodeaddresses(0))\r\n             assert_greater_than_or_equal(tokens, addr_count_5)\r\n-            assert_greater_than_or_equal(addr_count_4 + 100, addr_count_5)\r\n+            assert_greater_than_or_equal(addr_count_4 + new_tokens, addr_count_5)\r\n             assert_equal(addr_count_5 > addr_count_4, not no_relay)\r\n \r\n             self.nodes[0].disconnect_p2ps()\r\n```",
      "created_at": "2021-07-06T16:16:47Z",
      "updated_at": "2021-07-06T16:17:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664699518",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664699518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664701781",
      "pull_request_review_id": 700150976,
      "id": 664701781,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDcwMTc4MQ==",
      "diff_hunk": "@@ -155,6 +155,9 @@ static constexpr uint32_t MAX_GETCFHEADERS_SIZE = 2000;\n static constexpr size_t MAX_PCT_ADDR_TO_SEND = 23;\n /** The maximum number of address records permitted in an ADDR message. */\n static constexpr size_t MAX_ADDR_TO_SEND{1000};\n+/** The maximum rate of address records we're willing to process on average. Can be bypassed using\n+ *  the NetPermissionFlags::Addr permission. */\n+static constexpr double MAX_ADDR_RATE_PER_SECOND{0.1};",
      "path": "src/net_processing.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664552110,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "2 is incorrect. We increment the bucket by 1000, not set it to 1000.",
      "created_at": "2021-07-06T16:20:02Z",
      "updated_at": "2021-07-06T16:20:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664701781",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664701781"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664704257",
      "pull_request_review_id": 700154088,
      "id": 664704257,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDcwNDI1Nw==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_2)\n+            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\n+            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_3)\n+            assert_equal(addr_count_2, addr_count_3)\n+\n+            # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\n+            # but verify that no more than 10 are processed.\n+            self.mocktime += 100\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 10",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 103,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664699518,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe have just one constant in the test \"bucket size = 1000\" and derive everything from it? So that if the bucket size is changed in the future in `net_processing.cpp` this test is easier to adjust.",
      "created_at": "2021-07-06T16:23:24Z",
      "updated_at": "2021-07-06T16:23:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664704257",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664704257"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664705551",
      "pull_request_review_id": 700155832,
      "id": 664705551,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDcwNTU1MQ==",
      "diff_hunk": "@@ -2583,6 +2591,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             peer->m_getaddr_sent = true;\n+            // When requesting a getaddr, accept an additional MAX_ADDR_TO_SEND addresses in response.\n+            peer->m_addr_token_bucket += MAX_ADDR_TO_SEND;",
      "path": "src/net_processing.cpp",
      "position": 45,
      "original_position": 27,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "87c8d2d072d52c79f092cc432f98c6157fe8e662",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 87c8d2d072d52c79f092cc432f98c6157fe8e662\r\n\r\nThe commit message states that \"The token counter increases at a rate of 0.1 tokens per second, and will accrue up to a maximum of 1000 tokens\" but this seems a bit misleading. Since 1000 tokens are added upon sending a GETADDR, we could bump it past 1000 (I think the maximum is perhaps 1007, and 1001 seems likely). Perhaps something like \"The token counter increases at a rate of 0.1 tokens per second unless it has already reached 1000...\" would be more clear.",
      "created_at": "2021-07-06T16:25:15Z",
      "updated_at": "2021-07-06T17:40:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664705551",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664705551"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2606,
      "original_line": 2606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664711094",
      "pull_request_review_id": 700163040,
      "id": 664711094,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDcxMTA5NA==",
      "diff_hunk": "@@ -155,6 +155,9 @@ static constexpr uint32_t MAX_GETCFHEADERS_SIZE = 2000;\n static constexpr size_t MAX_PCT_ADDR_TO_SEND = 23;\n /** The maximum number of address records permitted in an ADDR message. */\n static constexpr size_t MAX_ADDR_TO_SEND{1000};\n+/** The maximum rate of address records we're willing to process on average. Can be bypassed using\n+ *  the NetPermissionFlags::Addr permission. */\n+static constexpr double MAX_ADDR_RATE_PER_SECOND{0.1};",
      "path": "src/net_processing.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664552110,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right! It is capped to `1000`, but when expecting getaddr response we just do `+= 1000` without checking. Sorry for the noise.",
      "created_at": "2021-07-06T16:32:47Z",
      "updated_at": "2021-07-06T16:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664711094",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664711094"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664750999",
      "pull_request_review_id": 700155832,
      "id": 664750999,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDc1MDk5OQ==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (!pfrom.HasPermission(NetPermissionFlags::Addr)) {\n+                if (peer->m_addr_token_bucket < 1.0) continue;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664543727,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't understand why it should be `break` - am I missing something? There are other things happening in the loop as well",
      "created_at": "2021-07-06T17:31:59Z",
      "updated_at": "2021-07-06T17:40:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664750999",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664750999"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2809,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664752631",
      "pull_request_review_id": 700155832,
      "id": 664752631,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDc1MjYzMQ==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n            const double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\r\n```",
      "created_at": "2021-07-06T17:34:35Z",
      "updated_at": "2021-07-06T17:40:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664752631",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664752631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2795,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664927787",
      "pull_request_review_id": 700443590,
      "id": 664927787,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkyNzc4Nw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (!pfrom.HasPermission(NetPermissionFlags::Addr)) {\n+                if (peer->m_addr_token_bucket < 1.0) continue;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664543727,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, a break is enough. Fixed.\r\n\r\n@glozow The loop does many things, but if if at some point the rate-limiting condition is reached, it will be reached for all further loop iterations too.",
      "created_at": "2021-07-06T22:57:35Z",
      "updated_at": "2021-07-06T22:57:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664927787",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664927787"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2809,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928077",
      "pull_request_review_id": 700443993,
      "id": 664928077,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkyODA3Nw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664547038,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, if `pfrom.HasPermission(NetPermissionFlags::Addr)` is true, the loop still has to run - just the rate-limiting check is skipped.",
      "created_at": "2021-07-06T22:58:31Z",
      "updated_at": "2021-07-06T22:58:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664928077",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928077"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2791,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2812,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928627",
      "pull_request_review_id": 700444681,
      "id": 664928627,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkyODYyNw==",
      "diff_hunk": "@@ -155,6 +155,9 @@ static constexpr uint32_t MAX_GETCFHEADERS_SIZE = 2000;\n static constexpr size_t MAX_PCT_ADDR_TO_SEND = 23;\n /** The maximum number of address records permitted in an ADDR message. */\n static constexpr size_t MAX_ADDR_TO_SEND{1000};\n+/** The maximum rate of address records we're willing to process on average. Can be bypassed using\n+ *  the NetPermissionFlags::Addr permission. */\n+static constexpr double MAX_ADDR_RATE_PER_SECOND{0.1};",
      "path": "src/net_processing.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664552110,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've introduced a separate `MAX_ADDR_PROCESSING_TOKEN_BUCKET` constant, also initialized to 0. Also amended a few comments to be clearer about the fact that GETADDR can exceed this limit.",
      "created_at": "2021-07-06T23:00:03Z",
      "updated_at": "2021-07-06T23:00:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664928627",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928627"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928716",
      "pull_request_review_id": 700444765,
      "id": 664928716,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkyODcxNg==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664554249,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2021-07-06T23:00:14Z",
      "updated_at": "2021-07-06T23:00:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664928716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2797,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928779",
      "pull_request_review_id": 700444831,
      "id": 664928779,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkyODc3OQ==",
      "diff_hunk": "@@ -75,6 +80,19 @@ def setup_addr_msg(self, num):\n         msg.addrs = addrs\n         return msg\n \n+    def setup_rand_addr_msg(self, num):\n+        addrs = []\n+        for i in range(num):\n+            addr = CAddress()\n+            addr.time = self.mocktime + i\n+            addr.nServices = NODE_NETWORK | NODE_WITNESS\n+            addr.ip = f\"{random.randrange(128,169)}.{random.randrange(1,255)}.{1+random.randrange(1,255)}.{1+random.randrange(1,255)}\"",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 36,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664559669,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "A typo, fixed.",
      "created_at": "2021-07-06T23:00:24Z",
      "updated_at": "2021-07-06T23:00:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664928779",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664928779"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664930730",
      "pull_request_review_id": 700447323,
      "id": 664930730,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDkzMDczMA==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664460746,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've replaced it with the helpful `CountSecondsDouble` we have in util/time.h.",
      "created_at": "2021-07-06T23:06:03Z",
      "updated_at": "2021-07-06T23:06:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664930730",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664930730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664967887",
      "pull_request_review_id": 700489761,
      "id": 664967887,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDk2Nzg4Nw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664553943,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-07T01:04:01Z",
      "updated_at": "2021-07-07T01:04:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664967887",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664967887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2793,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978068",
      "pull_request_review_id": 700502053,
      "id": 664978068,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDk3ODA2OA==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 41,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664752631,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-07T01:37:38Z",
      "updated_at": "2021-07-07T01:37:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664978068",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2795,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2796,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978166",
      "pull_request_review_id": 700502167,
      "id": 664978166,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDk3ODE2Ng==",
      "diff_hunk": "@@ -2583,6 +2591,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             // Get recent addresses\n             m_connman.PushMessage(&pfrom, CNetMsgMaker(greatest_common_version).Make(NetMsgType::GETADDR));\n             peer->m_getaddr_sent = true;\n+            // When requesting a getaddr, accept an additional MAX_ADDR_TO_SEND addresses in response.\n+            peer->m_addr_token_bucket += MAX_ADDR_TO_SEND;",
      "path": "src/net_processing.cpp",
      "position": 45,
      "original_position": 27,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "87c8d2d072d52c79f092cc432f98c6157fe8e662",
      "in_reply_to_id": 664705551,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comment about this to the commit message.",
      "created_at": "2021-07-07T01:37:59Z",
      "updated_at": "2021-07-07T01:38:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664978166",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2606,
      "original_line": 2606,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978731",
      "pull_request_review_id": 700502852,
      "id": 664978731,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDk3ODczMQ==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_2)\n+            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\n+            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_3)\n+            assert_equal(addr_count_2, addr_count_3)\n+\n+            # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\n+            # but verify that no more than 10 are processed.\n+            self.mocktime += 100\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 10\n+            peer.send_and_ping(self.setup_rand_addr_msg(200))\n+            addr_count_4 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_4)\n+            assert_greater_than_or_equal(addr_count_3 + 10, addr_count_4)\n+\n+            # Advance the time by 1000 seconds, permitting the processing of 100 more addresses. Send 200,\n+            # but verify that no more than 100 are processed (and at least some).\n+            self.mocktime += 1000\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 100\n+            peer.send_and_ping(self.setup_rand_addr_msg(200))\n+            addr_count_5 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_5)\n+            assert_greater_than_or_equal(addr_count_4 + 100, addr_count_5)\n+            assert_equal(addr_count_5 > addr_count_4, not no_relay)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 119,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664699379,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps, I'm not entirely sure. The issue is that the last test is a bit weak, as a ton of entries have already been added to addrman (which fills up the relevant buckets asymptotically), so not that much is expected to be added anymore. The test before happens at a point when it's somewhat less full, so it's more appropriate a place to test that not too much is being added. The value of the last test is really only the ability to test that it incremented at all (which isn't guaranteed with 10 extra tokens).",
      "created_at": "2021-07-07T01:39:59Z",
      "updated_at": "2021-07-07T01:39:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664978731",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664978731"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 267,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 288,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664979029",
      "pull_request_review_id": 700503171,
      "id": 664979029,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NDk3OTAyOQ==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\n+            # process up to 1001 incoming addresses), this means more entries will appear.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_2)\n+            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\n+            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\n+\n+            # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\n+            peer.send_and_ping(self.setup_rand_addr_msg(10))\n+            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_3)\n+            assert_equal(addr_count_2, addr_count_3)\n+\n+            # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\n+            # but verify that no more than 10 are processed.\n+            self.mocktime += 100\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if not no_relay:\n+                tokens += 10",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 103,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664699518,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jnewbery Done.\r\n\r\n@vasild It's not entirely clear how to do that sufficiently generically (we'll probably want different test cases entirely if the rate limit changes).",
      "created_at": "2021-07-07T01:40:44Z",
      "updated_at": "2021-07-07T01:40:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r664979029",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/664979029"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665141497",
      "pull_request_review_id": 700701796,
      "id": 665141497,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTE0MTQ5Nw==",
      "diff_hunk": "@@ -2777,11 +2787,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_TO_SEND) {\n+            // Don't increment bucket if it's already full\n+            auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            double increment = std::chrono::duration<double>(time_diff).count() * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_TO_SEND);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dade562ea5479e32c6a49fc92e9646f761b8e376",
      "in_reply_to_id": 664547038,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> this entire snippet can be inside ...\r\n> ... the loop still has to run ...\r\n\r\nThe loop if after the snippet, it will run. Just to clarify:\r\n\r\n```diff\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -2790,24 +2790,28 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n \r\n         // Store the new addresses\r\n         std::vector<CAddress> vAddrOk;\r\n         int64_t nNow = GetAdjustedTime();\r\n         int64_t nSince = nNow - 10 * 60;\r\n \r\n-        // Update/increment addr rate limiting bucket.\r\n-        const auto current_time = GetTime<std::chrono::microseconds>();\r\n-        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n-            // Don't increment bucket if it's already full\r\n-            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n-            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n-            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\r\n-        }\r\n-        peer->m_addr_token_timestamp = current_time;\r\n-\r\n-        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\r\n         const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\r\n+\r\n+        if (rate_limited) {\r\n+            // Update/increment addr rate limiting bucket.\r\n+            const auto current_time = GetTime<std::chrono::microseconds>();\r\n+            if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n+                // Don't increment bucket if it's already full\r\n+                const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n+                const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n+                peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\r\n+            }\r\n+            peer->m_addr_token_timestamp = current_time;\r\n+\r\n+            Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\r\n+        }\r\n+\r\n         for (CAddress& addr : vAddr)\r\n```\r\n\r\nDoes not change the behavior, but is slightly more performant :+1: (and deeply indented :-1:). Again, feel free to ignore. This comment is just for clarification, not an insistence :)",
      "created_at": "2021-07-07T08:07:14Z",
      "updated_at": "2021-07-07T08:08:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665141497",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665141497"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2791,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2812,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665145646",
      "pull_request_review_id": 700707406,
      "id": 665145646,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTE0NTY0Ng==",
      "diff_hunk": "@@ -2777,11 +2792,29 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) break;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do you think it makes sense to log a (debug) message if this occurs? The assumption is that it will happen very rarely, if ever, so it might be of interest if it happens in order to have an idea of its frequency.",
      "created_at": "2021-07-07T08:13:00Z",
      "updated_at": "2021-07-07T10:29:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665145646",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665145646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2813,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2815,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665146003",
      "pull_request_review_id": 700707900,
      "id": 665146003,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTE0NjAwMw==",
      "diff_hunk": "@@ -215,7 +222,7 @@ struct Peer {\n     /** Whether a ping has been requested by the user */\n     std::atomic<bool> m_ping_queued{false};\n \n-    /** A vector of addresses to send to the peer, limited to MAX_ADDR_TO_SEND. */",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There's no need to change this comment.",
      "created_at": "2021-07-07T08:13:29Z",
      "updated_at": "2021-07-07T08:19:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665146003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665146003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 218,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665377495",
      "pull_request_review_id": 701015174,
      "id": 665377495,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTM3NzQ5NQ==",
      "diff_hunk": "@@ -2777,11 +2792,29 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) break;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665145646,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It seems reasonable to print a single log in the `BCLog::NET` if an `addr` or `addrv2` p2p message has address records dropped.",
      "created_at": "2021-07-07T13:35:53Z",
      "updated_at": "2021-07-07T13:35:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665377495",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665377495"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2813,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2815,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665624211",
      "pull_request_review_id": 701339111,
      "id": 665624211,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTYyNDIxMQ==",
      "diff_hunk": "@@ -2777,11 +2792,29 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) break;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665145646,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It does happen occasionally very early in a connection's lifetime, if an address send event happens in the first 10 seconds. A few crawlers that very actively provide addresses also trigger it sometimes. I think both of these are harmless.\r\n\r\nAdded a commit to add logging.",
      "created_at": "2021-07-07T18:46:28Z",
      "updated_at": "2021-07-07T18:46:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665624211",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665624211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2813,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2815,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665630867",
      "pull_request_review_id": 701347520,
      "id": 665630867,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTYzMDg2Nw==",
      "diff_hunk": "@@ -2837,6 +2841,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             if (fReachable)\n                 vAddrOk.push_back(addr);\n         }\n+        if (rate_limiting_triggered) {\n+            LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "cb0c885fbbe05e73581de429d0c1d451eb4d2696",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Couldn't this just be in the `if` where `rate_limiting_triggered` is being set and thus remove the need for the bool?",
      "created_at": "2021-07-07T18:56:49Z",
      "updated_at": "2021-07-07T18:57:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665630867",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665630867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665631239",
      "pull_request_review_id": 701347520,
      "id": 665631239,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTYzMTIzOQ==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: use f-string instead?",
      "created_at": "2021-07-07T18:57:22Z",
      "updated_at": "2021-07-07T18:57:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665631239",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665631239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665639769",
      "pull_request_review_id": 701359496,
      "id": 665639769,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTYzOTc2OQ==",
      "diff_hunk": "@@ -215,7 +222,7 @@ struct Peer {\n     /** Whether a ping has been requested by the user */\n     std::atomic<bool> m_ping_queued{false};\n \n-    /** A vector of addresses to send to the peer, limited to MAX_ADDR_TO_SEND. */",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665146003,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-07T19:11:18Z",
      "updated_at": "2021-07-07T19:11:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665639769",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665639769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 218,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665640098",
      "pull_request_review_id": 701359930,
      "id": 665640098,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTY0MDA5OA==",
      "diff_hunk": "@@ -2837,6 +2841,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             if (fReachable)\n                 vAddrOk.push_back(addr);\n         }\n+        if (rate_limiting_triggered) {\n+            LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "cb0c885fbbe05e73581de429d0c1d451eb4d2696",
      "in_reply_to_id": 665630867,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good idea, done.",
      "created_at": "2021-07-07T19:11:55Z",
      "updated_at": "2021-07-07T19:11:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665640098",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665640098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2845,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665640237",
      "pull_request_review_id": 701360102,
      "id": 665640237,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTY0MDIzNw==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665631239,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't find those generally more readable.",
      "created_at": "2021-07-07T19:12:08Z",
      "updated_at": "2021-07-07T19:12:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665640237",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665640237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665780690",
      "pull_request_review_id": 701537117,
      "id": 665780690,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTc4MDY5MA==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 68,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "f8e51a85ac0c783808fc64179fcc108aad676079",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: this comment is backwards (our node sends a GETADDR and processes the incoming addresses, not the outbound peer)",
      "created_at": "2021-07-08T00:03:45Z",
      "updated_at": "2021-07-08T00:24:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665780690",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665780690"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 257,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665882202",
      "pull_request_review_id": 701654647,
      "id": 665882202,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTg4MjIwMg==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to",
      "path": "src/net_processing.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "4291de17e9de183d1433d96047bbe135fd0821ef",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I believe this is not about  'Number of addr messages' (because one message can contain 1000 items), but about number of addr items?",
      "created_at": "2021-07-08T05:34:19Z",
      "updated_at": "2021-07-08T09:09:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r665882202",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/665882202"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 243,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666114299",
      "pull_request_review_id": 701956579,
      "id": 666114299,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjExNDI5OQ==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": null,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It looks like the code makes sure that this number never leaves the range `0.0..MAX_ADDR_PROCESSING_TOKEN_BUCKET`, right?\r\n(I generally don't like using floating point for countable objects because of potential infinite loops when the value becomes too large or negative to be represented with a granularity of 1, but I think this issue is avoided)",
      "created_at": "2021-07-08T11:39:42Z",
      "updated_at": "2021-07-08T11:39:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r666114299",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666114299"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666132900",
      "pull_request_review_id": 701981682,
      "id": 666132900,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjEzMjkwMA==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 666114299,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It could exceed that limit - when we send `getaddr` we increment it with `MAX_ADDR_TO_SEND` (1000) regardless of its current value. It should be ok wrt concerns about floating point, given that we send `getaddr` just once.",
      "created_at": "2021-07-08T12:09:35Z",
      "updated_at": "2021-07-08T12:09:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r666132900",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666132900"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666155905",
      "pull_request_review_id": 702012096,
      "id": 666155905,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NjE1NTkwNQ==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 666114299,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It looks like the code makes sure that this number never leaves the range 0.0..MAX_ADDR_PROCESSING_TOKEN_BUCKET, right?\r\n\r\nNot quite. `m_addr_token_bucket` may exceed `MAX_ADDR_PROCESSING_TOKEN_BUCKET` immediately after we send a `getaddr` message. I think that the theoretic maximum it can reach is 1007 (we send the `getaddr` as soon as we receive the peer's `version` message, which can be up to 60 seconds after the connection is established).",
      "created_at": "2021-07-08T12:42:02Z",
      "updated_at": "2021-07-08T12:42:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r666155905",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/666155905"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667692734",
      "pull_request_review_id": 703800705,
      "id": 667692734,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzY5MjczNA==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to\n+     *  permit self-announcement. */\n+    double m_addr_token_bucket{1.0};",
      "path": "src/net_processing.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 666114299,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, thanks, that's not really going to give problems.",
      "created_at": "2021-07-12T07:33:49Z",
      "updated_at": "2021-07-12T07:33:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r667692734",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667692734"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667694456",
      "pull_request_review_id": 703803113,
      "id": 667694456,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzY5NDQ1Ng==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665631239,
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "For more complex formatting I think f-strings are more readable, because they specify the value where it is inserted, but if there is only one value, I agree that doesn't win anything.",
      "created_at": "2021-07-12T07:36:05Z",
      "updated_at": "2021-07-12T07:36:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r667694456",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/667694456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668289378",
      "pull_request_review_id": 704584099,
      "id": 668289378,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODI4OTM3OA==",
      "diff_hunk": "@@ -2777,11 +2792,32 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);",
      "path": "src/net_processing.cpp",
      "position": 58,
      "original_position": 45,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": null,
      "user": {
        "login": "GeneFerneau",
        "id": 80422284,
        "node_id": "MDQ6VXNlcjgwNDIyMjg0",
        "avatar_url": "https://avatars.githubusercontent.com/u/80422284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GeneFerneau",
        "html_url": "https://github.com/GeneFerneau",
        "followers_url": "https://api.github.com/users/GeneFerneau/followers",
        "following_url": "https://api.github.com/users/GeneFerneau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GeneFerneau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GeneFerneau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GeneFerneau/subscriptions",
        "organizations_url": "https://api.github.com/users/GeneFerneau/orgs",
        "repos_url": "https://api.github.com/users/GeneFerneau/repos",
        "events_url": "https://api.github.com/users/GeneFerneau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GeneFerneau/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This could result in a very large number if `peer->m_addr_token_timestamp` is negative. Maybe a check that `peer->m_addr_token_timestamp` is positive? Probably doesn't matter with the `std::min` check below, just a thought.",
      "created_at": "2021-07-12T22:08:50Z",
      "updated_at": "2021-07-12T22:12:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668289378",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668289378"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2806,
      "original_line": 2806,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668291499",
      "pull_request_review_id": 704586558,
      "id": 668291499,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODI5MTQ5OQ==",
      "diff_hunk": "@@ -2777,11 +2792,32 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);",
      "path": "src/net_processing.cpp",
      "position": 58,
      "original_position": 45,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 668289378,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That variable is initialized to the current time, so it can't be negative.",
      "created_at": "2021-07-12T22:13:23Z",
      "updated_at": "2021-07-12T22:13:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668291499",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668291499"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2806,
      "original_line": 2806,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668294202",
      "pull_request_review_id": 704589696,
      "id": 668294202,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODI5NDIwMg==",
      "diff_hunk": "@@ -2777,11 +2792,32 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);",
      "path": "src/net_processing.cpp",
      "position": 58,
      "original_position": 45,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 668289378,
      "user": {
        "login": "GeneFerneau",
        "id": 80422284,
        "node_id": "MDQ6VXNlcjgwNDIyMjg0",
        "avatar_url": "https://avatars.githubusercontent.com/u/80422284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/GeneFerneau",
        "html_url": "https://github.com/GeneFerneau",
        "followers_url": "https://api.github.com/users/GeneFerneau/followers",
        "following_url": "https://api.github.com/users/GeneFerneau/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/GeneFerneau/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/GeneFerneau/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/GeneFerneau/subscriptions",
        "organizations_url": "https://api.github.com/users/GeneFerneau/orgs",
        "repos_url": "https://api.github.com/users/GeneFerneau/repos",
        "events_url": "https://api.github.com/users/GeneFerneau/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/GeneFerneau/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was under the impression this variable is under peer (attacker) control, so could take on any value.",
      "created_at": "2021-07-12T22:19:18Z",
      "updated_at": "2021-07-12T22:19:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668294202",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668294202"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2806,
      "original_line": 2806,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668294737",
      "pull_request_review_id": 704590356,
      "id": 668294737,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODI5NDczNw==",
      "diff_hunk": "@@ -2777,11 +2792,32 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);",
      "path": "src/net_processing.cpp",
      "position": 58,
      "original_position": 45,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "8b60d6f538abbee5ea3ef6b49968f6afd2581877",
      "in_reply_to_id": 668289378,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's incorrect. It's just our local time when the m_addr_token_bucket variable was last updated.",
      "created_at": "2021-07-12T22:20:33Z",
      "updated_at": "2021-07-12T22:20:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668294737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668294737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2806,
      "original_line": 2806,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668733056",
      "pull_request_review_id": 705145016,
      "id": 668733056,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODczMzA1Ng==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());\n+                    num_rate_limit++;\n+                    continue;\n+                }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If the peer sends us an `addr` message with 50 addresses and we drop the last 30, this would cause 30 printouts to the log, which may be a bit excessive. I think it would be possible to do the counting before the loop and also make the log message a bit more useful by printing the total number of addresses in the message and the number of the dropped ones.",
      "created_at": "2021-07-13T12:52:45Z",
      "updated_at": "2021-07-13T13:10:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668733056",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668733056"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2826,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668743463",
      "pull_request_review_id": 705145016,
      "id": 668743463,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc0MzQ2Mw==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);",
      "path": "src/net_processing.cpp",
      "position": 60,
      "original_position": 60,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Here we can calculate the number of to be dropped addresses and also log the message, for example:\r\n\r\n```diff\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -2796,36 +2796,46 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n \r\n         // Store the new addresses\r\n         std::vector<CAddress> vAddrOk;\r\n         int64_t nNow = GetAdjustedTime();\r\n         int64_t nSince = nNow - 10 * 60;\r\n \r\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\r\n+        uint64_t num_proc = 0, num_rate_limit = 0;\r\n+\r\n         // Update/increment addr rate limiting bucket.\r\n         const auto current_time = GetTime<std::chrono::microseconds>();\r\n         if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n             // Don't increment bucket if it's already full\r\n             const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n             const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n             peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\r\n+\r\n+            if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\r\n+                num_rate_limit =\r\n+                    static_cast<uint64_t>(std::ceil(vAddr.size() - peer->m_addr_token_bucket));\r\n+                LogPrint(BCLog::NET,\r\n+                         \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\",\r\n+                         pfrom.GetId(),\r\n+                         num_rate_limit,\r\n+                         vAddr.size(),\r\n+                         fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n+            }\r\n         }\r\n         peer->m_addr_token_timestamp = current_time;\r\n \r\n         Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\r\n-        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\r\n-        uint64_t num_proc = 0, num_rate_limit = 0;\r\n         for (CAddress& addr : vAddr)\r\n         {\r\n             if (interruptMsgProc)\r\n                 return;\r\n \r\n             // Apply rate limiting.\r\n             if (rate_limited) {\r\n                 if (peer->m_addr_token_bucket < 1.0) {\r\n-                    LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());\r\n-                    num_rate_limit++;\r\n-                    continue;\r\n+                    break;\r\n                 }\r\n                 peer->m_addr_token_bucket -= 1.0;\r\n             }\r\n             // We only bother storing full nodes, though this may include\r\n             // things which we would not make an outbound connection to, in\r\n             // part because we may make feeler connections to them.\r\n```",
      "created_at": "2021-07-13T13:05:22Z",
      "updated_at": "2021-07-13T13:09:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668743463",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668743463"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2808,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668771763",
      "pull_request_review_id": 705198585,
      "id": 668771763,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODc3MTc2Mw==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());\n+                    num_rate_limit++;\n+                    continue;\n+                }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668733056,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This used to be a `break`, which would mean that the log is printed only once. Is there a reason that it's been reverted to `continue`?",
      "created_at": "2021-07-13T13:37:37Z",
      "updated_at": "2021-07-13T13:37:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668771763",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668771763"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2826,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668814369",
      "pull_request_review_id": 705257630,
      "id": 668814369,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODgxNDM2OQ==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());\n+                    num_rate_limit++;\n+                    continue;\n+                }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668733056,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "oh, I see it's for the new metrics.",
      "created_at": "2021-07-13T14:23:23Z",
      "updated_at": "2021-07-13T14:23:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r668814369",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/668814369"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2826,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669385730",
      "pull_request_review_id": 705973344,
      "id": 669385730,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTM4NTczMA==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);",
      "path": "src/net_processing.cpp",
      "position": 60,
      "original_position": 60,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668743463,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Now I see that I have messed up the order of the arguments to `LogPrint()` :facepalm:. Correction:\r\n\r\n```diff\r\n                 LogPrint(BCLog::NET, \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\r\n-                         pfrom.GetId(),\r\n                          num_rate_limit,\r\n                          vAddr.size(),\r\n+                         pfrom.GetId(),\r\n                          fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n```",
      "created_at": "2021-07-14T08:04:47Z",
      "updated_at": "2021-07-14T08:04:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669385730",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669385730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2808,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669397937",
      "pull_request_review_id": 705989456,
      "id": 669397937,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTM5NzkzNw==",
      "diff_hunk": "@@ -2795,6 +2845,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 // Do not process banned/discouraged addresses beyond remembering we received them\n                 continue;\n             }\n+            num_proc++;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This was `if (!peer->m_getaddr_sent) num_proc++;` in a previous incarnation and I thought it was ok. With unconditional `num_proc++`, observing addr/sec (`(addr_processed + addr_rate_limited) / connection_duration`) in order to find a better value for `MAX_ADDR_RATE_PER_SECOND` is not appropriate because the calculated addr/sec may be allowed to go higher than 0.1 without causing any rate limiting (we increment the tokens by 1000 when we send `getaddr`). I guess either way is fine.\r\n\r\nAbout putting this increment after two possible `continue`s: I think that if we do some processing (`MayHaveUsefulAddressDB()` or banmap lookup) and decide to `continue`, that should be counted as \"processing\" too. I.e. `num_proc++;` should be put before `MayHaveUsefulAddressDB()` above. Or if it remains here, then maybe `addr_accepted` or `addr_added` is a name that would better describe what we have done. Maybe have both `addr_received` (`vAddr.size()`) and `addr_accepted`?",
      "created_at": "2021-07-14T08:22:09Z",
      "updated_at": "2021-07-14T08:37:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669397937",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669397937"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2848,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669439983",
      "pull_request_review_id": 706044276,
      "id": 669439983,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTQzOTk4Mw==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);",
      "path": "src/net_processing.cpp",
      "position": 60,
      "original_position": 60,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668743463,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This better be outside of the `if`:\r\n\r\n```diff\r\n         if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\r\n             // Don't increment bucket if it's already full\r\n             const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n             const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n             peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_AD\r\n-            if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\r\n-                num_rate_limit = (uint64_t)std::ceil(vAddr.size() - peer->m_addr_token_bucket);\r\n-                LogPrint(BCLog::NET, \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\r\n-                         pfrom.GetId(),\r\n-                         num_rate_limit,\r\n-                         vAddr.size(),\r\n-                         fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n-            }\r\n         }\r\n+        if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\r\n+            num_rate_limit = (uint64_t)std::ceil(vAddr.size() - peer->m_addr_token_bucket);\r\n+            LogPrint(BCLog::NET,\r\n+                     \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\",\r\n+                     num_rate_limit,\r\n+                     vAddr.size(),\r\n+                     pfrom.GetId(),\r\n+                     fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n+        }\r\n         peer->m_addr_token_timestamp = current_time;\r\n```",
      "created_at": "2021-07-14T09:18:04Z",
      "updated_at": "2021-07-14T09:18:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669439983",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669439983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2808,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669448082",
      "pull_request_review_id": 706054718,
      "id": 669448082,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTQ0ODA4Mg==",
      "diff_hunk": "@@ -2777,11 +2798,40 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+            if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\n+                num_rate_limit = (uint64_t)std::ceil(vAddr.size() - peer->m_addr_token_bucket);\n+                LogPrint(BCLog::NET, \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\",\n+                         pfrom.GetId(),\n+                         num_rate_limit,\n+                         vAddr.size(),\n+                         fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\n+            }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 70,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think instead of making this calculation up here and logging, it'd be clearer just to use a counter in the loop below and then log in the same place that the statistics are updated. That way, if the logic for address processing changes, then the logging will automatically be consistent with the true values and the statistics:\r\n\r\n```diff\r\n             const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\r\n             const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\r\n             peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\r\n-            if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\r\n-                num_rate_limit = (uint64_t)std::ceil(vAddr.size() - peer->m_addr_token_bucket);\r\n-                LogPrint(BCLog::NET, \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\",\r\n-                         pfrom.GetId(),\r\n-                         num_rate_limit,\r\n-                         vAddr.size(),\r\n-                         fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n-            }\r\n         }\r\n         peer->m_addr_token_timestamp = current_time;\r\n \r\n@@ -2828,7 +2820,8 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n             // Apply rate limiting.\r\n             if (rate_limited) {\r\n                 if (peer->m_addr_token_bucket < 1.0) {\r\n-                    break;\r\n+                    num_rate_limit++;\r\n+                    continue;\r\n                 }\r\n                 peer->m_addr_token_bucket -= 1.0;\r\n             }\r\n@@ -2857,6 +2850,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\r\n         }\r\n         peer->m_addr_processed += num_proc;\r\n         peer->m_addr_rate_limited += num_rate_limit;\r\n+        if (num_rate_limit > 0) {\r\n+            // Conditionally log if we rate-limited addresses from this peer.\r\n+            LogPrint(BCLog::NET, \"Received addr: %u addresses (%u processed, %u rate-limited) from peer=%d%s\\n\",\r\n+                     vAddr.size(),\r\n+                     num_proc,\r\n+                     num_rate_limit,\r\n+                     pfrom.GetId(),\r\n+                     fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\r\n+        }\r\n+\r\n         m_addrman.Add(vAddrOk, pfrom.addr, 2 * 60 * 60);\r\n         if (vAddr.size() < 1000) peer->m_getaddr_sent = false;\r\n         if (pfrom.IsAddrFetchConn()) {\r\n\r\n```\r\n\r\n(we could also log even if no addresses were rate-limited. We already log to `BCLog::NET` at the top of every `ProcessMessage()` call).",
      "created_at": "2021-07-14T09:29:15Z",
      "updated_at": "2021-07-14T10:24:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669448082",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669448082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2812,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669448632",
      "pull_request_review_id": 706054718,
      "id": 669448632,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTQ0ODYzMg==",
      "diff_hunk": "@@ -2777,11 +2798,40 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 56,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's generally best to avoid multiple declarations per line: https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#es10-declare-one-name-only-per-declaration.",
      "created_at": "2021-07-14T09:30:01Z",
      "updated_at": "2021-07-14T10:24:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669448632",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669448632"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2804,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669453482",
      "pull_request_review_id": 706054718,
      "id": 669453482,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTQ1MzQ4Mg==",
      "diff_hunk": "@@ -2795,6 +2845,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 // Do not process banned/discouraged addresses beyond remembering we received them\n                 continue;\n             }\n+            num_proc++;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": 669397937,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agree with logging the vAddr.size() as well as `num_proc`. I don't have any strong opinion about the name: `addrs_accepted` or `addrs_added` implies that the address has been added to addrman, which is not necessarily the case. `addrs_relayed` is also inaccurate since the address might not actually be relayed. `addrs_processed` seems fine to me.",
      "created_at": "2021-07-14T09:37:05Z",
      "updated_at": "2021-07-14T10:24:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669453482",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669453482"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2848,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669485429",
      "pull_request_review_id": 706054718,
      "id": 669485429,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTQ4NTQyOQ==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 79,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Now that you've added addr relay statistics to `getpeerinfo`, you can isolate and observe the (predictable) p2p behaviour, rather than the (stochastic) addrman effects:\r\n\r\n<details>\r\n<summary>Diff</summary>\r\n\r\n```diff\r\n@@ -244,25 +244,55 @@ class AddrTest(BitcoinTestFramework):\r\n             assert_equal(addr_count_0, 0)\r\n \r\n             # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\r\n-            peer.send_and_ping(self.setup_rand_addr_msg(600))\r\n-            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\r\n-            assert_greater_than_or_equal(tokens, addr_count_1)\r\n-            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\r\n-            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\r\n+            addrs = 600\r\n+            peer.send_and_ping(self.setup_rand_addr_msg(addrs))\r\n+\r\n+            peerinfo_1 = self.nodes[0].getpeerinfo()[0]\r\n+            addrs_processed_1 = peerinfo_1['addr_processed']\r\n+            addrs_rate_limited_1 = peerinfo_1['addr_rate_limited']\r\n+            self.log.info(f\"addrs_processed = {addrs_processed_1}, addrs_rate_limited = {addrs_rate_limited_1}\")\r\n+\r\n+            if not no_relay:\r\n+                assert_equal(addrs_processed_1, min(addrs, tokens))\r\n+                assert_equal(addrs_rate_limited_1, addrs - min(addrs, tokens))\r\n+            else:\r\n+                assert_equal(addrs_processed_1, 0)\r\n+                assert_equal(addrs_rate_limited_1, 0)\r\n \r\n             # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will\r\n             # process up to 1001 incoming addresses), this means more entries will appear.\r\n-            peer.send_and_ping(self.setup_rand_addr_msg(600))\r\n-            addr_count_2 = len(self.nodes[0].getnodeaddresses(0))\r\n-            assert_greater_than_or_equal(tokens, addr_count_2)\r\n-            assert_greater_than_or_equal(addr_count_1 + 600, addr_count_2)\r\n-            assert_equal(addr_count_2 > addr_count_1, tokens > 600)\r\n+            new_addrs = 600\r\n+            peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\r\n+\r\n+            addrs += new_addrs\r\n+            peerinfo_2 = self.nodes[0].getpeerinfo()[0]\r\n+            addrs_processed_2 = peerinfo_2['addr_processed']\r\n+            addrs_rate_limited_2 = peerinfo_2['addr_rate_limited']\r\n+            self.log.info(f\"addrs_processed = {addrs_processed_2}, addrs_rate_limited = {addrs_rate_limited_2}\")\r\n+\r\n+            if not no_relay:\r\n+                assert_equal(addrs_processed_2, min(addrs, tokens))\r\n+                assert_equal(addrs_rate_limited_2, addrs - min(addrs, tokens))\r\n+            else:\r\n+                assert_equal(addrs_processed_2, 0)\r\n+                assert_equal(addrs_rate_limited_2, 0)\r\n\r\n             # Send 10 more. As we reached the processing limit for all nodes, this should have no effect.\r\n-            peer.send_and_ping(self.setup_rand_addr_msg(10))\r\n-            addr_count_3 = len(self.nodes[0].getnodeaddresses(0))\r\n-            assert_greater_than_or_equal(tokens, addr_count_3)\r\n-            assert_equal(addr_count_2, addr_count_3)\r\n+            new_addrs = 10\r\n+            peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\r\n+\r\n+            addrs += new_addrs\r\n+            peerinfo_3 = self.nodes[0].getpeerinfo()[0]\r\n+            addrs_processed_3 = peerinfo_3['addr_processed']\r\n+            addrs_rate_limited_3 = peerinfo_3['addr_rate_limited']\r\n+            self.log.info(f\"addrs_processed = {addrs_processed_3}, addrs_rate_limited = {addrs_rate_limited_3}\")\r\n+\r\n+            if not no_relay:\r\n+                assert_equal(addrs_processed_3, min(addrs, tokens))\r\n+                assert_equal(addrs_rate_limited_3, addrs - min(addrs, tokens))\r\n+            else:\r\n+                assert_equal(addrs_processed_3, 0)\r\n+                assert_equal(addrs_rate_limited_3, 0)\r\n \r\n             # Advance the time by 100 seconds, permitting the processing of 10 more addresses. Send 200,\r\n             # but verify that no more than 10 are processed.\r\n@@ -270,10 +300,21 @@ class AddrTest(BitcoinTestFramework):\r\n             self.nodes[0].setmocktime(self.mocktime)\r\n             new_tokens = 0 if no_relay else 10\r\n             tokens += new_tokens\r\n-            peer.send_and_ping(self.setup_rand_addr_msg(200))\r\n-            addr_count_4 = len(self.nodes[0].getnodeaddresses(0))\r\n-            assert_greater_than_or_equal(tokens, addr_count_4)\r\n-            assert_greater_than_or_equal(addr_count_3 + new_tokens, addr_count_4)\r\n+            new_addrs = 200\r\n+            peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\r\n+\r\n+            addrs += new_addrs\r\n+            peerinfo_4 = self.nodes[0].getpeerinfo()[0]\r\n+            addrs_processed_4 = peerinfo_4['addr_processed']\r\n+            addrs_rate_limited_4 = peerinfo_4['addr_rate_limited']\r\n+            self.log.info(f\"addrs_processed = {addrs_processed_4}, addrs_rate_limited = {addrs_rate_limited_4}\")\r\n+\r\n+            if not no_relay:\r\n+                assert_equal(addrs_processed_4, min(addrs, tokens))\r\n+                assert_equal(addrs_rate_limited_4, addrs - min(addrs, tokens))\r\n+            else:\r\n+                assert_equal(addrs_processed_4, 0)\r\n+                assert_equal(addrs_rate_limited_4, 0)\r\n \r\n             # Advance the time by 1000 seconds, permitting the processing of 100 more addresses. Send 200,\r\n             # but verify that no more than 100 are processed (and at least some).\r\n@@ -281,11 +322,21 @@ class AddrTest(BitcoinTestFramework):\r\n             self.nodes[0].setmocktime(self.mocktime)\r\n             new_tokens = 0 if no_relay else 100\r\n             tokens += new_tokens\r\n-            peer.send_and_ping(self.setup_rand_addr_msg(200))\r\n-            addr_count_5 = len(self.nodes[0].getnodeaddresses(0))\r\n-            assert_greater_than_or_equal(tokens, addr_count_5)\r\n-            assert_greater_than_or_equal(addr_count_4 + new_tokens, addr_count_5)\r\n-            assert_equal(addr_count_5 > addr_count_4, not no_relay)\r\n+            new_addrs = 200\r\n+            peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\r\n+\r\n+            addrs += new_addrs\r\n+            peerinfo_5 = self.nodes[0].getpeerinfo()[0]\r\n+            addrs_processed_5 = peerinfo_5['addr_processed']\r\n+            addrs_rate_limited_5 = peerinfo_5['addr_rate_limited']\r\n+            self.log.info(f\"addrs_processed = {addrs_processed_5}, addrs_rate_limited = {addrs_rate_limited_5}\")\r\n+\r\n+            if not no_relay:\r\n+                assert_equal(addrs_processed_5, min(addrs, tokens))\r\n+                assert_equal(addrs_rate_limited_5, addrs - min(addrs, tokens))\r\n+            else:\r\n+                assert_equal(addrs_processed_5, 0)\r\n+                assert_equal(addrs_rate_limited_5, 0)\r\n \r\n             self.nodes[0].disconnect_p2ps()\r\n```\r\n</details>\r\n\r\n(Obviously, there's a lot of duplicate code above that can be factored out into a `send_and_test()` routine.)",
      "created_at": "2021-07-14T10:23:25Z",
      "updated_at": "2021-07-14T10:24:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669485429",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669485429"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669784245",
      "pull_request_review_id": 706500330,
      "id": 669784245,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTc4NDI0NQ==",
      "diff_hunk": "@@ -2795,6 +2845,7 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 // Do not process banned/discouraged addresses beyond remembering we received them\n                 continue;\n             }\n+            num_proc++;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": 669397937,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@vasild I removed the \"!peer->m_getaddr_sent\" because it doesn't work reliably. If we receive a randomly relayed addr before receiving the response to GETADDR, the getaddr response will still be counted (and I see that happen fairly regularly).",
      "created_at": "2021-07-14T16:45:18Z",
      "updated_at": "2021-07-14T16:45:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669784245",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669784245"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2848,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883193",
      "pull_request_review_id": 706628732,
      "id": 669883193,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4MzE5Mw==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    LogPrint(BCLog::NET, \"Rate limiting an address message from peer=%d\\n\", pfrom.GetId());\n+                    num_rate_limit++;\n+                    continue;\n+                }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 78,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668733056,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This has been reverted by using your suggestion below.",
      "created_at": "2021-07-14T19:12:40Z",
      "updated_at": "2021-07-14T19:12:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669883193",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883193"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2826,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883402",
      "pull_request_review_id": 706629009,
      "id": 669883402,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4MzQwMg==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);",
      "path": "src/net_processing.cpp",
      "position": 60,
      "original_position": 60,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "df1ddf8f085a1db31dd1bd420e5e1a5a7fc301b0",
      "in_reply_to_id": 668743463,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, and moved using @jnewbery's suggestion below.",
      "created_at": "2021-07-14T19:12:59Z",
      "updated_at": "2021-07-14T19:12:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669883402",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883402"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2808,
      "original_line": 2808,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883764",
      "pull_request_review_id": 706629491,
      "id": 669883764,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4Mzc2NA==",
      "diff_hunk": "@@ -2777,11 +2798,40 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+            if (rate_limited && vAddr.size() > peer->m_addr_token_bucket) {\n+                num_rate_limit = (uint64_t)std::ceil(vAddr.size() - peer->m_addr_token_bucket);\n+                LogPrint(BCLog::NET, \"Rate limiting %u of %u addresses from a message from peer=%d%s\\n\",\n+                         pfrom.GetId(),\n+                         num_rate_limit,\n+                         vAddr.size(),\n+                         fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");\n+            }",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 70,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": 669448082,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's a lot cleaner; done (and made it unconditional).",
      "created_at": "2021-07-14T19:13:37Z",
      "updated_at": "2021-07-14T19:13:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669883764",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883764"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 2812,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2818,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883932",
      "pull_request_review_id": 706629769,
      "id": 669883932,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4MzkzMg==",
      "diff_hunk": "@@ -207,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 79,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": 669485429,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added as a separate commit.",
      "created_at": "2021-07-14T19:13:57Z",
      "updated_at": "2021-07-14T19:13:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669883932",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669883932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669885542",
      "pull_request_review_id": 706631817,
      "id": 669885542,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4NTU0Mg==",
      "diff_hunk": "@@ -2777,11 +2798,40 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0, num_rate_limit = 0;",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 56,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "759c3d4d28874ea6c0b97ad910635d7858d41884",
      "in_reply_to_id": 669448632,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Gone.",
      "created_at": "2021-07-14T19:16:36Z",
      "updated_at": "2021-07-14T19:16:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669885542",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669885542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2804,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669885704",
      "pull_request_review_id": 706632063,
      "id": 669885704,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTg4NTcwNA==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 46,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "dc8a1863f30b5944490cdbaa3271afbf8cd6da9a",
      "in_reply_to_id": 665631239,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-14T19:16:56Z",
      "updated_at": "2021-07-14T19:16:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r669885704",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/669885704"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670219126",
      "pull_request_review_id": 707032297,
      "id": 670219126,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDIxOTEyNg==",
      "diff_hunk": "@@ -207,6 +222,110 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info(f'Test rate limiting of addr processing for {contype} peers')\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            addrs = 600\n+            peer.send_and_ping(self.setup_rand_addr_msg(addrs))\n+            peerinfo_1 = self.nodes[0].getpeerinfo()[0]\n+            addrs_processed_1 = peerinfo_1['addr_processed']\n+            addrs_rate_limited_1 = peerinfo_1['addr_rate_limited']\n+            self.log.info(f\"addrs_processed = {addrs_processed_1}, addrs_rate_limited = {addrs_rate_limited_1}\")\n+            if not no_relay:\n+                assert_equal(addrs_processed_1, min(addrs, tokens))\n+                assert_equal(addrs_rate_limited_1, addrs - min(addrs, tokens))\n+            else:\n+                assert_equal(addrs_processed_1, 0)\n+                assert_equal(addrs_rate_limited_1, 0)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 91,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "56c8ca2844fecb980cfdd9a21c881ed0616890d8",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This and similar statements below can be shortened:\r\n```suggestion\r\n            assert_equal(addrs_processed_1, min(addrs, tokens))\r\n            assert_equal(addrs_rate_limited_1, 0 if no_relay else addrs - addrs_processed_1)\r\n```",
      "created_at": "2021-07-15T07:48:01Z",
      "updated_at": "2021-07-15T07:50:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r670219126",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670219126"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": 250,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 255,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670289045",
      "pull_request_review_id": 707124589,
      "id": 670289045,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDI4OTA0NQ==",
      "diff_hunk": "@@ -245,6 +245,10 @@ struct Peer {\n     double m_addr_token_bucket{1.0};\n     /** When m_addr_token_bucket was last updated */\n     std::chrono::microseconds m_addr_token_timestamp{GetTime<std::chrono::microseconds>()};\n+    /** Total number of addresses processed. */\n+    std::atomic<uint64_t> m_addr_processed{0};",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "023b0c75bb3197b23bd61a795008ce0996a260c9",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: the name \"processed\" is confusing because from the first glance it's unclear whether it includes limited or not",
      "created_at": "2021-07-15T09:19:59Z",
      "updated_at": "2021-07-15T09:19:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r670289045",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670289045"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 249,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670867989",
      "pull_request_review_id": 707895392,
      "id": 670867989,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDg2Nzk4OQ==",
      "diff_hunk": "@@ -208,6 +225,69 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def rate_limit_tests(self):\n+\n+        for contype, tokens, no_relay in [(\"outbound-full-relay\", 1001, False), (\"block-relay-only\", 0, True), (\"inbound\", 1, False)]:\n+            self.log.info('Test rate limiting of addr processing for %s peers' % contype)\n+            self.stop_node(0)\n+            os.remove(os.path.join(self.nodes[0].datadir, \"regtest\", \"peers.dat\"))\n+            self.start_node(0, [])\n+            self.mocktime = int(time.time())\n+            self.nodes[0].setmocktime(self.mocktime)\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Check that we start off with empty addrman\n+            addr_count_0 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_equal(addr_count_0, 0)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in at least 1 address.\n+            peer.send_and_ping(self.setup_rand_addr_msg(600))\n+            addr_count_1 = len(self.nodes[0].getnodeaddresses(0))\n+            assert_greater_than_or_equal(tokens, addr_count_1)\n+            assert_greater_than_or_equal(addr_count_0 + 600, addr_count_1)\n+            assert_equal(addr_count_1 > addr_count_0, tokens > 0)\n+\n+            # Send 600 more addresses. For the outbound-full-relay peer (which sends a GETADDR, and thus will",
      "path": "test/functional/p2p_addr_relay.py",
      "position": null,
      "original_position": 68,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "f8e51a85ac0c783808fc64179fcc108aad676079",
      "in_reply_to_id": 665780690,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2021-07-15T23:30:40Z",
      "updated_at": "2021-07-15T23:30:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r670867989",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670867989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 257,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670868922",
      "pull_request_review_id": 707896457,
      "id": 670868922,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDg2ODkyMg==",
      "diff_hunk": "@@ -245,6 +245,10 @@ struct Peer {\n     double m_addr_token_bucket{1.0};\n     /** When m_addr_token_bucket was last updated */\n     std::chrono::microseconds m_addr_token_timestamp{GetTime<std::chrono::microseconds>()};\n+    /** Total number of addresses processed. */\n+    std::atomic<uint64_t> m_addr_processed{0};",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "023b0c75bb3197b23bd61a795008ce0996a260c9",
      "in_reply_to_id": 670289045,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added more comments.",
      "created_at": "2021-07-15T23:33:32Z",
      "updated_at": "2021-07-15T23:33:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r670868922",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/670868922"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 249,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671107215",
      "pull_request_review_id": 708186507,
      "id": 671107215,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MTEwNzIxNQ==",
      "diff_hunk": "@@ -42,7 +42,9 @@ def __init__(self):\n         super().__init__(support_addrv2 = True)\n \n     def on_addrv2(self, message):\n-        if ADDRS == message.addrs:\n+        expected_set = set((addr.ip, addr.port) for addr in ADDRS)\n+        received_set = set((addr.ip, addr.port) for addr in message.addrs)",
      "path": "test/functional/p2p_addrv2_relay.py",
      "position": 6,
      "original_position": 6,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Much nicer!",
      "created_at": "2021-07-16T09:33:11Z",
      "updated_at": "2021-07-16T09:35:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r671107215",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671107215"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": 45,
      "original_start_line": 45,
      "start_side": "RIGHT",
      "line": 46,
      "original_line": 46,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671144448",
      "pull_request_review_id": 708235682,
      "id": 671144448,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MTE0NDQ0OA==",
      "diff_hunk": "@@ -207,6 +239,63 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def send_addrs_and_test_rate_limiting(self, peer, no_relay, new_addrs, total_addrs):\n+        \"\"\"Send an addr message and check that the number of addresses processed and rate-limited is as expected\"\"\"\n+\n+        peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\n+\n+        peerinfo = self.nodes[0].getpeerinfo()[0]\n+        addrs_processed = peerinfo['addr_processed']\n+        addrs_rate_limited = peerinfo['addr_rate_limited']\n+        self.log.debug(f\"addrs_processed = {addrs_processed}, addrs_rate_limited = {addrs_rate_limited}\")\n+\n+        if no_relay:\n+            assert_equal(addrs_processed, 0)\n+            assert_equal(addrs_rate_limited, 0)\n+        else:\n+            assert_equal(addrs_processed, min(total_addrs, peer.tokens))\n+            assert_equal(addrs_rate_limited, max(0, total_addrs - peer.tokens))\n+\n+    def rate_limit_tests(self):\n+\n+        self.mocktime = int(time.time())\n+        self.restart_node(0, [])\n+        self.nodes[0].setmocktime(self.mocktime)\n+\n+        for contype, no_relay in [(\"outbound-full-relay\", False), (\"block-relay-only\", True), (\"inbound\", False)]:\n+            self.log.info(f'Test rate limiting of addr processing for {contype} peers')\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in addresses being processed.\n+            self.send_addrs_and_test_rate_limiting(peer, no_relay, 600, 600)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": 125,
      "original_position": 125,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "a4bcd687c934d47aa3 In the five `send_addrs_and_test_rate_limiting` calls, could use named arguments for these passed integer values.\r\n```suggestion\r\n            self.send_addrs_and_test_rate_limiting(peer, no_relay, new_addrs=600, total_addrs=600)\r\n```",
      "created_at": "2021-07-16T10:36:28Z",
      "updated_at": "2021-07-16T10:40:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r671144448",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/671144448"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 273,
      "original_line": 273,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672410564",
      "pull_request_review_id": 709697940,
      "id": 672410564,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQxMDU2NA==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0;\n+        uint64_t num_rate_limit = 0;\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    ++num_rate_limit;\n+                    continue;\n+                }\n+                peer->m_addr_token_bucket -= 1.0;\n+            }",
      "path": "src/net_processing.cpp",
      "position": 80,
      "original_position": 80,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is there a reason to increment the bucket when rate limiting is disabled? I presume you want to prepare for the future where permission flags can be changed at runtime? In that case, shouldn't the code here be:\r\n\r\n```cpp\r\n            if (peer->m_addr_token_bucket < 1.0) {\r\n                if (rate_limited) {\r\n                    ++num_rate_limit;\r\n                    continue;\r\n                }\r\n            } else {\r\n                peer->m_addr_token_bucket -= 1.0;\r\n            }",
      "created_at": "2021-07-19T15:36:44Z",
      "updated_at": "2021-07-19T15:57:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r672410564",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672410564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": 2822,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": 2828,
      "original_line": 2828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672414835",
      "pull_request_review_id": 709697940,
      "id": 672414835,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQxNDgzNQ==",
      "diff_hunk": "@@ -2804,6 +2849,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             if (fReachable)\n                 vAddrOk.push_back(addr);\n         }\n+        peer->m_addr_processed += num_proc;\n+        peer->m_addr_rate_limited += num_rate_limit;\n+        LogPrint(BCLog::NET, \"Received addr: %u addresses (%u processed, %u rate-limited) from peer=%d%s\\n\",\n+                 vAddr.size(),\n+                 num_proc,\n+                 num_rate_limit,\n+                 pfrom.GetId(),\n+                 fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");",
      "path": "src/net_processing.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is there a reason to log the ip address outside of the version handshake? This seems redundant, as the ip shouldn't change afterwards and should be easy to lookup by grepping for the handshake of the peer id.\r\n\r\nOtherwise this encourages to put other redundant stuff (ua-string, ...) into this log messages and other log messages as well.",
      "created_at": "2021-07-19T15:41:47Z",
      "updated_at": "2021-07-19T15:57:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r672414835",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672414835"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2859,
      "original_line": 2859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672417898",
      "pull_request_review_id": 709697940,
      "id": 672417898,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQxNzg5OA==",
      "diff_hunk": "@@ -242,6 +242,8 @@ static RPCHelpMan getpeerinfo()\n                 heights.push_back(height);\n             }\n             obj.pushKV(\"inflight\", heights);\n+            obj.pushKV(\"addr_processed\", statestats.m_addr_processed);\n+            obj.pushKV(\"addr_rate_limited\", statestats.m_addr_rate_limited);",
      "path": "src/rpc/net.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "is there a reason to omit this from the documentation?",
      "created_at": "2021-07-19T15:45:28Z",
      "updated_at": "2021-07-19T15:57:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r672417898",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672417898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672447534",
      "pull_request_review_id": 709746487,
      "id": 672447534,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjQ0NzUzNA==",
      "diff_hunk": "@@ -242,6 +242,8 @@ static RPCHelpMan getpeerinfo()\n                 heights.push_back(height);\n             }\n             obj.pushKV(\"inflight\", heights);\n+            obj.pushKV(\"addr_processed\", statestats.m_addr_processed);\n+            obj.pushKV(\"addr_rate_limited\", statestats.m_addr_rate_limited);",
      "path": "src/rpc/net.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": 672417898,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "can use the descriptions in a5cc9e28f9e125a62168dcbe0b3484d098e56c1f if so inclined",
      "created_at": "2021-07-19T16:22:40Z",
      "updated_at": "2021-07-19T16:22:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r672447534",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/672447534"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681037829",
      "pull_request_review_id": 720292568,
      "id": 681037829,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTAzNzgyOQ==",
      "diff_hunk": "@@ -2777,11 +2798,34 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         std::vector<CAddress> vAddrOk;\n         int64_t nNow = GetAdjustedTime();\n         int64_t nSince = nNow - 10 * 60;\n+\n+        // Update/increment addr rate limiting bucket.\n+        const auto current_time = GetTime<std::chrono::microseconds>();\n+        if (peer->m_addr_token_bucket < MAX_ADDR_PROCESSING_TOKEN_BUCKET) {\n+            // Don't increment bucket if it's already full\n+            const auto time_diff = std::max(current_time - peer->m_addr_token_timestamp, 0us);\n+            const double increment = CountSecondsDouble(time_diff) * MAX_ADDR_RATE_PER_SECOND;\n+            peer->m_addr_token_bucket = std::min<double>(peer->m_addr_token_bucket + increment, MAX_ADDR_PROCESSING_TOKEN_BUCKET);\n+        }\n+        peer->m_addr_token_timestamp = current_time;\n+\n+        const bool rate_limited = !pfrom.HasPermission(NetPermissionFlags::Addr);\n+        uint64_t num_proc = 0;\n+        uint64_t num_rate_limit = 0;\n+        Shuffle(vAddr.begin(), vAddr.end(), FastRandomContext());\n         for (CAddress& addr : vAddr)\n         {\n             if (interruptMsgProc)\n                 return;\n \n+            // Apply rate limiting.\n+            if (rate_limited) {\n+                if (peer->m_addr_token_bucket < 1.0) {\n+                    ++num_rate_limit;\n+                    continue;\n+                }\n+                peer->m_addr_token_bucket -= 1.0;\n+            }",
      "path": "src/net_processing.cpp",
      "position": 80,
      "original_position": 80,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": 672410564,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Proposed in #22604.",
      "created_at": "2021-08-02T14:50:42Z",
      "updated_at": "2021-08-02T14:50:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r681037829",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681037829"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": 2822,
      "original_start_line": 2822,
      "start_side": "RIGHT",
      "line": 2828,
      "original_line": 2828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038307",
      "pull_request_review_id": 720293170,
      "id": 681038307,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTAzODMwNw==",
      "diff_hunk": "@@ -233,6 +240,11 @@ struct Peer {\n     std::atomic_bool m_wants_addrv2{false};\n     /** Whether this peer has already sent us a getaddr message. */\n     bool m_getaddr_recvd{false};\n+    /** Number of addr messages that can be processed from this peer. Start at 1 to",
      "path": "src/net_processing.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "4291de17e9de183d1433d96047bbe135fd0821ef",
      "in_reply_to_id": 665882202,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Proposed \"addresses\" in #22604.",
      "created_at": "2021-08-02T14:51:14Z",
      "updated_at": "2021-08-02T14:51:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r681038307",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038307"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 243,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038622",
      "pull_request_review_id": 720293622,
      "id": 681038622,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTAzODYyMg==",
      "diff_hunk": "@@ -242,6 +242,8 @@ static RPCHelpMan getpeerinfo()\n                 heights.push_back(height);\n             }\n             obj.pushKV(\"inflight\", heights);\n+            obj.pushKV(\"addr_processed\", statestats.m_addr_processed);\n+            obj.pushKV(\"addr_rate_limited\", statestats.m_addr_rate_limited);",
      "path": "src/rpc/net.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": 672417898,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "helps added in #22604.",
      "created_at": "2021-08-02T14:51:42Z",
      "updated_at": "2021-08-02T14:51:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r681038622",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038622"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038735",
      "pull_request_review_id": 720293750,
      "id": 681038735,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTAzODczNQ==",
      "diff_hunk": "@@ -2804,6 +2849,15 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n             if (fReachable)\n                 vAddrOk.push_back(addr);\n         }\n+        peer->m_addr_processed += num_proc;\n+        peer->m_addr_rate_limited += num_rate_limit;\n+        LogPrint(BCLog::NET, \"Received addr: %u addresses (%u processed, %u rate-limited) from peer=%d%s\\n\",\n+                 vAddr.size(),\n+                 num_proc,\n+                 num_rate_limit,\n+                 pfrom.GetId(),\n+                 fLogIPs ? \", peeraddr=\" + pfrom.addr.ToString() : \"\");",
      "path": "src/net_processing.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": 672414835,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Proposed in #22604.",
      "created_at": "2021-08-02T14:51:49Z",
      "updated_at": "2021-08-02T14:51:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r681038735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2859,
      "original_line": 2859,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038906",
      "pull_request_review_id": 720293959,
      "id": 681038906,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MTAzODkwNg==",
      "diff_hunk": "@@ -207,6 +239,63 @@ def blocksonly_mode_tests(self):\n \n         self.nodes[0].disconnect_p2ps()\n \n+    def send_addrs_and_test_rate_limiting(self, peer, no_relay, new_addrs, total_addrs):\n+        \"\"\"Send an addr message and check that the number of addresses processed and rate-limited is as expected\"\"\"\n+\n+        peer.send_and_ping(self.setup_rand_addr_msg(new_addrs))\n+\n+        peerinfo = self.nodes[0].getpeerinfo()[0]\n+        addrs_processed = peerinfo['addr_processed']\n+        addrs_rate_limited = peerinfo['addr_rate_limited']\n+        self.log.debug(f\"addrs_processed = {addrs_processed}, addrs_rate_limited = {addrs_rate_limited}\")\n+\n+        if no_relay:\n+            assert_equal(addrs_processed, 0)\n+            assert_equal(addrs_rate_limited, 0)\n+        else:\n+            assert_equal(addrs_processed, min(total_addrs, peer.tokens))\n+            assert_equal(addrs_rate_limited, max(0, total_addrs - peer.tokens))\n+\n+    def rate_limit_tests(self):\n+\n+        self.mocktime = int(time.time())\n+        self.restart_node(0, [])\n+        self.nodes[0].setmocktime(self.mocktime)\n+\n+        for contype, no_relay in [(\"outbound-full-relay\", False), (\"block-relay-only\", True), (\"inbound\", False)]:\n+            self.log.info(f'Test rate limiting of addr processing for {contype} peers')\n+            if contype == \"inbound\":\n+                peer = self.nodes[0].add_p2p_connection(AddrReceiver())\n+            else:\n+                peer = self.nodes[0].add_outbound_p2p_connection(AddrReceiver(), p2p_idx=0, connection_type=contype)\n+\n+            # Send 600 addresses. For all but the block-relay-only peer this should result in addresses being processed.\n+            self.send_addrs_and_test_rate_limiting(peer, no_relay, 600, 600)",
      "path": "test/functional/p2p_addr_relay.py",
      "position": 125,
      "original_position": 125,
      "commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "original_commit_id": "a4bcd687c934d47aa3922334e97e579caf5f8124",
      "in_reply_to_id": 671144448,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Proposed in #22604.",
      "created_at": "2021-08-02T14:52:01Z",
      "updated_at": "2021-08-02T14:52:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/22387#discussion_r681038906",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/681038906"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22387"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 273,
      "original_line": 273,
      "side": "RIGHT"
    }
  ]
}
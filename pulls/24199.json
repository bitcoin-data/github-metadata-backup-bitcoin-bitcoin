{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199",
    "id": 834915961,
    "node_id": "PR_kwDOABII584xw855",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/24199",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/24199.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/24199.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0e052eb04fa07fc4915c11faa8866ab759365dc4",
    "number": 24199,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Add cs_main annotation to WriteBatchSync(), drop lock in CDiskBlockIndex",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Addresses review feedback by Marco Falke in https://github.com/bitcoin/bitcoin/pull/22932#discussion_r794493058:\r\n\r\n1. add `cs_main` thread safety annotation to `CBlockTreeDB::WriteBatchSync()`, which allows us to\r\n\r\n2. remove the `cs_main` lock in `CDiskBlockIndex::SERIALIZE_METHODS` with respect to its 2 callers in the codebase, `CBlockTreeDB::LoadBlockIndexGuts()` and `CBlockTreeDB::WriteBatchSync()`,  that already hold the lock and whose callers hold the lock.\r\n\r\nI didn't manage to remove the thread safety warnings generated by the fuzz tests (suggestions welcome) and resolved them here with a `NO_THREAD_SAFETY_ANALYSIS` annotation and explanatory documentation.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      },
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2022-01-29T00:10:22Z",
    "updated_at": "2024-04-24T12:44:27Z",
    "closed_at": "2023-04-25T11:09:20Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "63bdfa96df600f7cffe6f052b3cf27f776e8b9c1",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "jonatack:remove-cs_main-lock-in-CDiskBlockIndex",
      "ref": "remove-cs_main-lock-in-CDiskBlockIndex",
      "sha": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 173103842,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNzMxMDM4NDI=",
        "name": "bitcoin",
        "full_name": "jonatack/bitcoin",
        "owner": {
          "login": "jonatack",
          "id": 2415484,
          "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jonatack",
          "html_url": "https://github.com/jonatack",
          "followers_url": "https://api.github.com/users/jonatack/followers",
          "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
          "organizations_url": "https://api.github.com/users/jonatack/orgs",
          "repos_url": "https://api.github.com/users/jonatack/repos",
          "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jonatack/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jonatack/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jonatack/bitcoin",
        "archive_url": "https://api.github.com/repos/jonatack/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jonatack/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jonatack/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jonatack/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jonatack/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jonatack/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jonatack/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jonatack/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jonatack/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jonatack/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jonatack/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jonatack/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jonatack/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jonatack/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jonatack/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jonatack/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jonatack/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jonatack/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jonatack/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jonatack/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jonatack/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jonatack/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jonatack/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jonatack/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jonatack/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jonatack/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jonatack/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jonatack/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jonatack/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jonatack/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jonatack/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jonatack/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jonatack/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jonatack/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jonatack/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jonatack/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jonatack/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jonatack/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jonatack/bitcoin/hooks",
        "svn_url": "https://github.com/jonatack/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 231991,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-08T20:32:27Z",
        "created_at": "2019-02-28T11:57:18Z",
        "updated_at": "2024-02-03T19:41:27Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "29d540b7ada890dd588c4825d40c27c5e6f20061",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35288,
        "stargazers_count": 75966,
        "watchers_count": 75966,
        "size": 254972,
        "default_branch": "master",
        "open_issues_count": 704,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-04-24T12:59:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-04-24T12:56:03Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 9,
    "deletions": 3,
    "changed_files": 3,
    "commits": 2,
    "review_comments": 11,
    "comments": 12
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDliNWY5MDEyN2RkNGJiMzkxODdiZjQ2OTZjMWM4NGJjYmUxZmVkMGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c",
      "tree": {
        "sha": "96e33f98cd93babef94d30519d38d330df03dbbc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/96e33f98cd93babef94d30519d38d330df03dbbc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 96e33f98cd93babef94d30519d38d330df03dbbc\nparent d4e92d843650b0480b86d15ce46ed02b6fd9b5be\nauthor Jon Atack <jon@atack.com> 1643408646 +0100\ncommitter Jon Atack <jon@atack.com> 1643409697 +0100\n\nAdd cs_main thread safety annotation to CBlockTreeDB::WriteBatchSync()\n\nThis allows us to remove the cs_main lock in CDiskBlockIndex::SERIALIZE_METHODS\nwith the remaining thread safety warnings generated only by the tests.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQHCBAABCAAsFiEEgpIaS4j9RUt+uM48eWxBCQY9Tq8FAmH0cSIOHGpvbkBhdGFj\nay5jb20ACgkQeWxBCQY9Tq9V7AwAyAtxOT7+CImz3iIGWpA3RU0Z/BIVJgC0pxU1\nGCv3z8HR9mD3OokYfgt9khiIFHNtHuDydv4MprTTy5QcfHaET1+AmQ6vcE7YHxmU\nFU68Kba/jk/qDiy1hKLOL5SdKT0IBgyJKMrO/hEuKpEMcRpOuXWBjMl65YLZVGaw\n50Mkp2eY5w2+Tn3eStGHoSWsaBP5F9oYBx4btCYZlfsFUg5BFSc5RgHNjcjsut5v\nA1a9HrG5Y0cNdYEl7ZeET9FSPQ8SPweNd2wc3TfOfYhQ2ojPxHCk+pnJp2L6x4F1\njSgcU8rvSPH9ezkLPfOULBmdy7bhyXRpAhjKsJLmQ59OwOvT8JhM60d95+7He+kp\nxzf0nh6OTb+NFFjrXurOiU7ybo+RpZPChDzvZe3nywP+Ye2FIz9odFguEpTHy5l/\nYATtpB7ojZFFE1Vkx2jhgvFms0VWgTDBYKSJSJysIDjcJnqMWMZRHosheoc/TFkN\noSx7BpqzU9BKXdYeBxOQfuOTk/A+\n=yppf\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIIAkvp62J7cBeuwRySy2hEGBI2Tkn6kQje8di4/0gtCyCP/wEHITqWu67lto\nIf+F4ZDeRVEI8SDjb9YnLNn9L+knD1miqgDGfSqNzowiVoZWt2hvTsic1wjxBGH0\ncSPwCB88+zhGtIp3AIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5jYWxlbmRhci5l\ndGVybml0eXdhbGwuY29t//AQh9AZy7JmyZs48L+1qEfN0AjxIMK+4pCaw95crSEk\nFeasjXmhj+AE6OrtZJI1KEcYXtK/CPEEYfRxI/AIFk9jwTV+dygAg9/jDS75DI4s\nK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5vcmf/8BDd\nicJdIeF/sYCtnmGaYBScCPEEYfRxI/AIK5ok7TkLDPQAg9/jDS75DI4jImh0dHBz\nOi8vYnRjLmNhbGVuZGFyLmNhdGFsbGF4eS5jb23wEOQ/RbGhMetbAvKsV3peiboI\n8CAALyRILNz9uPfT8GG03JR9qSQNBZ9StctJ8flLEYhVFwjxBGH0cSPwCJbulJvo\nC8/RAIPf4w0u+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGlt\nZXN0YW1wcy5vcmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d4e92d843650b0480b86d15ce46ed02b6fd9b5be",
          "sha": "d4e92d843650b0480b86d15ce46ed02b6fd9b5be",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d4e92d843650b0480b86d15ce46ed02b6fd9b5be"
        }
      ],
      "message": "Add cs_main thread safety annotation to CBlockTreeDB::WriteBatchSync()\n\nThis allows us to remove the cs_main lock in CDiskBlockIndex::SERIALIZE_METHODS\nwith the remaining thread safety warnings generated only by the tests.",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2022-01-28T22:41:37Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2022-01-28T22:24:06Z"
      },
      "sha": "9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBlMDUyZWIwNGZhMDdmYzQ5MTVjMTFmYWE4ODY2YWI3NTkzNjVkYzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "tree": {
        "sha": "b80a9376a0f876fa104cf0966d7713acf1c350c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b80a9376a0f876fa104cf0966d7713acf1c350c7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b80a9376a0f876fa104cf0966d7713acf1c350c7\nparent 9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c\nauthor Jon Atack <jon@atack.com> 1643409282 +0100\ncommitter Jon Atack <jon@atack.com> 1643409700 +0100\n\nDrop lock and thread safety analysis in CDiskBlockIndex serialization\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQHCBAABCAAsFiEEgpIaS4j9RUt+uM48eWxBCQY9Tq8FAmH0cSQOHGpvbkBhdGFj\nay5jb20ACgkQeWxBCQY9Tq9oZAwA2IEnZA2HN5TJNkWjiJR3hOmnhv80SCC4A65b\nV3ifUYWSRQ/CoqFXE3Nv9HChVTrSBbZZc4w2XpdhKtnvzcy+QLlmmZNuOUrQk+wN\nMn9ll/YJ+5+pAFf+1uDdUscdNQOUaPeB+paFFV8mjppP+JWfmJg4SoJj8Twgm37x\nXVdDN6Ll6FlFR0CO10XsMUU+MaaiM7pVVQPrSVu674dmHqYIc/u7xOAQjpYIn9Yn\nJrg2eWAiwR2tu7fdt7MoIjn0jcz7FwimyJ1n5mxyN2nuSX6F34yttZEGCmUT+qo2\nCRatKOxADtmyX6rlDHNWcHkUr6SVzXalERuiXRMUA1vynHJ+Xrfqjgunf9SPokqq\nsYhYBV/utBBkKLNrE8m8gmWX0by1i2u0EB4u3Bn7Zm6A0QYAXdZal1HAuubG8J9e\nsggHp3Hg1yyqZPs81GGiLrIB/Nc42VJm0qyBxgA8HVx7OdJNiKFVNEQlzM2xvsKX\n5Z0cyk+K/bsqWlklwJqF9anb7igs\n=LGHP\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwILnts1RFsIuCb9FFfE6KQWT4Cj/2GWWCG81lKMPCKCRECP/wEDmZnTJYT3ik\nRdJccfTeKx0I8QRh9HEl8AjhtUlsNkCpwwCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEEHsggSoiUm4qNngstbhiNsI8QRh9HEl\n8AhKe6IMUcOwiwCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9w\nZW50aW1lc3RhbXBzLm9yZ//wEGqHTcCH2C2k68R5//A2SfwI8QRh9HEl8Ah8gxjQ\nLp5yxACD3+MNLvkMjikoaHR0cHM6Ly9maW5uZXkuY2FsZW5kYXIuZXRlcm5pdHl3\nYWxsLmNvbfAQq/ARmA/JakFUTTcaAr/NfgjxBGH0cSXwCKWTzGiBgLXHAIPf4w0u\n+QyOLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c",
          "sha": "9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9b5f90127dd4bb39187bf4696c1c84bcbe1fed0c"
        }
      ],
      "message": "Drop lock and thread safety analysis in CDiskBlockIndex serialization",
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2022-01-28T22:41:40Z"
      },
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2022-01-28T22:34:42Z"
      },
      "sha": "0e052eb04fa07fc4915c11faa8866ab759365dc4"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-29T00:13:17Z",
      "updated_at": "2022-01-29T00:13:17Z",
      "source": {
        "issue": {
          "id": 992389027,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NzMwNzI4MzAy",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22932",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22932/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22932/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22932/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/22932",
          "number": 22932,
          "state": "closed",
          "state_reason": null,
          "title": "Add CBlockIndex lock annotations, guard nStatus/nFile/nDataPos/nUndoPos by cs_main",
          "body": "Issues:\r\n\r\n- `CBlockIndex` member functions `GetBlockPos()`, `GetUndoPos()`, `IsAssumedValid()`, `RaiseValidity()`, and `IsValid()` and block storage functions `WriteUndoDataForBlock()` and `IsBlockPruned()` are missing thread safety lock annotations to help ensure that they are called with mutex cs_main to avoid bugs like #22895. Doing this also enables the next step:\r\n\r\n- `CBlockIndex::nStatus` may be racy, i.e. potentially accessed by multiple threads, see #17161. A solution is to guard it by cs_main, along with fellow data members `nFile`, `nDataPos` and `nUndoPos`.\r\n\r\nThis pull:\r\n\r\n- adds thread safety lock annotations for the functions listed above\r\n- guards `CBlockIndex::nStatus`, `nFile`, `nDataPos` and `nUndoPos` by cs_main\r\n\r\nHow to review and test:\r\n- debug build with clang and verify there are no `-Wthread-safety-analysis` warnings\r\n- review the code to verify each annotation or lock is necessary and sensible, or if any are missing\r\n- look for whether taking a lock can be replaced by a lock annotation instead\r\n- for more information about Clang thread safety analysis, see\r\n    - https://clang.llvm.org/docs/ThreadSafetyAnalysis.html\r\n    - https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#lockingmutex-usage-notes\r\n    - https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#threads-and-synchronization\r\n\r\nMitigates/potentially closes #17161.",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 219890555,
              "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
              "name": "Block storage",
              "color": "000000",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 20,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22932",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/22932",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/22932.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/22932.patch"
          },
          "closed_at": "2022-01-27T09:58:01Z",
          "created_at": "2021-09-09T16:00:41Z",
          "updated_at": "2023-01-29T10:10:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 5974322767,
      "node_id": "LE_lADOABII585Cor_GzwAAAAFkGO5P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5974322767",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-29T02:12:55Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "labeled",
      "id": 5974322768,
      "node_id": "LE_lADOABII585Cor_GzwAAAAFkGO5Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5974322768",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-29T02:12:55Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 1025353705,
      "node_id": "IC_kwDOABII5849Hafp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1025353705",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T03:58:09Z",
      "updated_at": "2022-01-31T03:58:09Z",
      "author_association": "MEMBER",
      "body": "Concept NACK. Prefer recursive locks over fragile assumptions about the rest of the codebase.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025353705",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1025464313,
      "node_id": "IC_kwDOABII5849H1f5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1025464313",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T07:54:59Z",
      "updated_at": "2022-01-31T07:54:59Z",
      "author_association": "MEMBER",
      "body": "> Concept NACK. Prefer recursive locks over fragile assumptions about the rest of the codebase.\r\n\r\nMy point was that the lock isn't needed to be recursively taken during serialization since the data is copied before serialization.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025464313",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1025479698,
      "node_id": "IC_kwDOABII5849H5QS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1025479698",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T08:16:39Z",
      "updated_at": "2022-01-31T08:16:39Z",
      "author_association": "MEMBER",
      "body": "Specifically, I don't think we should need `NO_THREAD_SAFETY_ANALYSIS` - surely there's a better way?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025479698",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1025482990,
      "node_id": "IC_kwDOABII5849H6Du",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1025482990",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-01-31T08:20:28Z",
      "updated_at": "2022-01-31T08:20:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "I agree but didn't see how to update the fuzz tests to do it -- happy to update with suggestions.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025482990",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1060769137,
      "node_id": "IC_kwDOABII584_Og1x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1060769137",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-03-07T14:49:47Z",
      "updated_at": "2022-03-07T14:49:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "To me it looks like that it is not just the tests that would be problematic:\r\n\r\n1. This `CDBBatch::Write()` call would internally invoke the `CDiskBlockIndex` serialization method:\r\nhttps://github.com/bitcoin/bitcoin/blob/5e49b2a2529adc737175ebdcbf312635c52b05f6/src/txdb.cpp#L280\r\n\r\n2. This `CDBIterator::GetValue()` call would internally invoke the `CDiskBlockIndex` deserialization method:\r\nhttps://github.com/bitcoin/bitcoin/blob/5e49b2a2529adc737175ebdcbf312635c52b05f6/src/txdb.cpp#L309\r\n\r\nBoth `Write()` and `GetValue()` are too generic and we can't tag them as requiring `cs_main` or acquire `cs_main` from within them.\r\n\r\nSo, we have some methods in the (non-test) code that invoke `CDiskBlockIndex` ser/deser and can't acquire `cs_main` or require their callers to acquire it.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1060769137",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "reviewed",
      "id": 903405458,
      "node_id": "PRR_kwDOABII58412N-S",
      "url": null,
      "actor": null,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 0e052eb04fa07fc4915c11faa8866ab759365dc4\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1060769137\r\n\r\n> To me it looks like that it is not just the tests that would be problematic [...]\r\n\r\nThis is all true, `CDiskBlockIndex` flow is a little convoluted. I think following my suggestion below to make relevant `CBlockIndex` member variables private & nonguarded, you could keep the `CDiskBlockIndex` class working by declaring it as a friend of `CBlockIndex`, or by changing it to use SER_READ / SER_WRITE macros with specialized Set/Get accessor methods that don't require cs_main.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#pullrequestreview-903405458",
      "submitted_at": "2022-03-08T18:43:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-17T17:38:23Z",
      "updated_at": "2022-08-17T17:38:23Z",
      "source": {
        "issue": {
          "id": 1341891304,
          "node_id": "PR_kwDOABII5849VJRd",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25862",
          "number": 25862,
          "state": "closed",
          "state_reason": null,
          "title": "refactor, kernel: Remove gArgs accesses from dbwrapper and txdb",
          "body": "Code in the libbitcoin_kernel library should not be calling `ArgsManager` methods or trying to read options from the command line. Instead it should just get options values from simple structs and function arguments that are passed in externally. This PR removes `gArgs` accesses from `dbwrapper` and `txdb` modules by defining appropriate options structs, and is a followup to PR's #25290 #25487 #25527 which remove other `ArgsManager` calls from kernel modules.\r\n\r\nThis PR does not change behavior in any way. It is a simpler alternative to #25623 because the only thing it does is remove `gArgs` references from kernel code. It avoids other unnecessary changes like adding options to the kernel API (they can be added separately later).",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25862",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25862",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25862.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25862.patch"
          },
          "closed_at": "2023-02-17T21:55:24Z",
          "created_at": "2022-08-17T14:51:35Z",
          "updated_at": "2024-02-17T12:33:05Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1218641707,
      "node_id": "IC_kwDOABII585Iov8r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1218641707",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-17T23:26:47Z",
      "updated_at": "2023-02-11T01:42:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/24199#pullrequestreview-903405458) |\n| Concept NACK | [luke-jr](https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025353705) |\n\nIf your review is incorrectly listed, please react with  to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25862](https://github.com/bitcoin/bitcoin/pull/25862) (refactor, kernel: Remove gArgs accesses from dbwrapper and txdb by ryanofsky)\n* [#19463](https://github.com/bitcoin/bitcoin/pull/19463) (Prune locks by luke-jr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1218641707",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1276608379,
      "node_id": "IC_kwDOABII585MF397",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1276608379",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T19:01:11Z",
      "updated_at": "2022-10-12T19:01:11Z",
      "author_association": "MEMBER",
      "body": "Are you still working on this?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1276608379",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1310621131,
      "node_id": "IC_kwDOABII585OHn3L",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310621131",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:13:35Z",
      "updated_at": "2022-11-10T17:13:35Z",
      "author_association": "MEMBER",
      "body": "Closing this as it has not had any activity in a while. If you are interested in continuing work on this, please leave a comment so that it can be reopened.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1310621131",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "closed",
      "id": 7785419102,
      "node_id": "CE_lADOABII585Cor_GzwAAAAHQDBFe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7785419102",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:13:35Z"
    },
    {
      "event": "commented",
      "id": 1310628492,
      "node_id": "IC_kwDOABII585OHpqM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1310628492",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:19:44Z",
      "updated_at": "2022-11-10T17:19:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are you still working on this?\r\n\r\nYes, sorry not to have seen this comment and replied. There is valuable review feedback here so it may be helpful to re-open here rather than open a new pull (mentioning as I do not have the privileges to re-open it.)",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1310628492",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "reopened",
      "id": 7785476451,
      "node_id": "REE_lADOABII585Cor_GzwAAAAHQDPFj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7785476451",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-10T17:20:40Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-16T23:52:21Z",
      "updated_at": "2022-11-16T23:52:21Z",
      "source": {
        "issue": {
          "id": 652920165,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDQ1OTI3NjM1",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19463",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19463/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19463/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19463/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19463",
          "number": 19463,
          "state": "open",
          "state_reason": null,
          "title": "Prune locks",
          "body": "This adds the ability to have any number of internal or external locks to prevent pruning specific block ranges.\r\n\r\nSome examples where this would be useful:\r\n\r\n* Ensuring any known Core wallet won't become unable to sync due to pruning when it is unloaded. (Included in this PR)\r\n* Ensuring pruning doesn't go too far for a desired-functional wallet backup. (Questionable, since you probably lose the node if you need the backup anyway?)\r\n* Allowing users to temporarily disable block indexes and filters, without pruning cutting them off from catching up later.\r\n* Avoiding pruning out from under external wallets (Armory, EPS, etc) that might need block data.\r\n* External block indexes/filters, etc.\r\n\r\nBy design, users retain complete control over prune locks, and can delete them out from under applications using them. This is to avoid circumstances where a prune lock has been set, by an application that may no longer be used.\r\n",
          "user": {
            "login": "luke-jr",
            "id": 1095675,
            "node_id": "MDQ6VXNlcjEwOTU2NzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/luke-jr",
            "html_url": "https://github.com/luke-jr",
            "followers_url": "https://api.github.com/users/luke-jr/followers",
            "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
            "organizations_url": "https://api.github.com/users/luke-jr/orgs",
            "repos_url": "https://api.github.com/users/luke-jr/repos",
            "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/luke-jr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 219890555,
              "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
              "name": "Block storage",
              "color": "000000",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 21,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19463",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19463",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19463.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19463.patch"
          },
          "created_at": "2020-07-08T04:03:17Z",
          "updated_at": "2024-04-23T06:44:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "convert_to_draft",
      "id": 8448413620,
      "node_id": "CTDE_lADOABII585Cor_GzwAAAAH3kI-0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8448413620",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-06T15:02:02Z"
    },
    {
      "event": "commented",
      "id": 1419224245,
      "node_id": "IC_kwDOABII585Ul6S1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1419224245",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-06T15:02:27Z",
      "updated_at": "2023-02-06T15:02:27Z",
      "author_association": "MEMBER",
      "body": "Moved this to draft. It's not clear what the status of this is. There is clearly disagreement about the approach amongst contributors. Was re-opened to address feedback, but no activity in the 4 months since.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1419224245",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "commented",
      "id": 1435396126,
      "node_id": "IC_kwDOABII585Vjmge",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1435396126",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T23:35:53Z",
      "updated_at": "2023-02-17T23:35:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1435396126",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "labeled",
      "id": 8551782966,
      "node_id": "LE_lADOABII585Cor_GzwAAAAH9udo2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8551782966",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T23:35:53Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1521606641,
      "node_id": "IC_kwDOABII585asd_x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1521606641",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-25T11:09:20Z",
      "updated_at": "2023-04-25T11:09:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "Closing temporarily so that I can re-open it -- am still interested to work on this.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1521606641",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24199"
    },
    {
      "event": "closed",
      "id": 9091080200,
      "node_id": "CE_lADOABII585Cor_GzwAAAAId3uAI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9091080200",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-25T11:09:20Z"
    },
    {
      "event": "locked",
      "id": 12591349028,
      "node_id": "LOE_lADOABII585Cor_GzwAAAALugL0k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12591349028",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-24T12:44:27Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/821942074",
      "pull_request_review_id": 903405458,
      "id": 821942074,
      "node_id": "PRRC_kwDOABII584w_dc6",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Drop lock and thread safety analysis in CDiskBlockIndex serialization\" (0e052eb04fa07fc4915c11faa8866ab759365dc4)\r\n\r\nIt'd be nice to do this without disabling thread safety checks. Though I can see it would require more work, and maybe better to do separately or as a followup. (IMO ideally we would have a linter to make sure every `NO_THREAD_SAFETY_ANALYSIS` usage was accompanied by a link to a github issue where we could discuss the plan to reenable thread safety checks.)\r\n\r\nIn this case it looks like most obvious way of removing `NO_THREAD_SAFETY_ANALYSIS` would be to replace public guarded variables with private unguarded variables, changing:\r\n\r\n```c++\r\npublic:\r\n    int nFile GUARDED_BY(::cs_main){0};\r\n    unsigned int nDataPos GUARDED_BY(::cs_main){0};\r\n    unsigned int nUndoPos GUARDED_BY(::cs_main){0};\r\n    uint32_t nStatus GUARDED_BY(::cs_main){0};\r\n```\r\n\r\nto:\r\n\r\n```c++\r\nprivate:\r\n    int m_file_num = 0;\r\n    unsigned int m_data_pos = 0;\r\n    unsigned int m_undo_pos = 0;\r\n    uint32_t m_status = 0;\r\n```\r\n\r\nAnd add `EXCLUSIVE_LOCKS_REQUIRED` accessor methods as needed to ensure variables are always accessed with the right locks held.",
      "created_at": "2022-03-08T18:16:41Z",
      "updated_at": "2022-03-08T18:43:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r821942074",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/821942074"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822371673",
      "pull_request_review_id": 903977548,
      "id": 822371673,
      "node_id": "PRRC_kwDOABII584xBGVZ",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, how would that be different than the current code?\r\n\r\ncurrent: `LOCK(cs_main); read nStatus`\r\nproposed: `LOCK(cs_main); call GetNStatus()`\r\n\r\nand the ser/deser methods would still need to acquire `cs_main`, no?\r\n\r\nThe access to all `nStatus`/`nDataPos`/`nUndoPos` from within ser/deser has to happen in one atomic block. I mean that this is not ok:\r\n```\r\nlock\r\nread nStatus\r\nunlock\r\nlock\r\nread nDataPos\r\nunlock\r\n```\r\nit has to be\r\n```\r\nlock\r\nread nStatus\r\nread nDataPos\r\nunlock\r\n```",
      "created_at": "2022-03-09T07:54:18Z",
      "updated_at": "2022-03-09T07:54:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822371673",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822371673"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822390873",
      "pull_request_review_id": 904004358,
      "id": 822390873,
      "node_id": "PRRC_kwDOABII584xBLBZ",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "All `CDiskBlockIndex` are short-lived copied data on the stack, shared with no other thread, so they don't need any locks. If there is a missing lock then it can at most be missed while copying the data.",
      "created_at": "2022-03-09T08:20:54Z",
      "updated_at": "2022-03-09T08:20:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822390873",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822390873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822470287",
      "pull_request_review_id": 904113356,
      "id": 822470287,
      "node_id": "PRRC_kwDOABII584xBeaP",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@ryanofsky, now I see your point - to change the members of the parent class `CBlockIndex` to be not-tagged as guarded by `cs_main` and change them to private, in the hopes that the methods that touch them respect the implicit guarding. Then, access them without guarding from the child class `CDiskBlockIndex`. I do not like this much because the members in `CBlockIndex` need to be guarded, but will be without a `GUARDED_BY()` tag. Hmm...\r\n\r\n@MarcoFalke, I did not realize this before, thanks for pointing it out!\r\n> If there is a missing lock then it can at most be missed while copying the data\r\n\r\nthere is not - both users of `CDiskBlockIndex` own `cs_main` when creating such objects.",
      "created_at": "2022-03-09T09:52:14Z",
      "updated_at": "2022-03-09T09:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822470287",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822470287"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822473212",
      "pull_request_review_id": 904117238,
      "id": 822473212,
      "node_id": "PRRC_kwDOABII584xBfH8",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> @MarcoFalke, I did not realize this before, thanks for pointing it out!\r\n\r\nI pointed it only out thrice up to now :sweat_smile: . https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025464313 and https://github.com/bitcoin/bitcoin/pull/22932#discussion_r794493058",
      "created_at": "2022-03-09T09:55:11Z",
      "updated_at": "2022-03-09T09:55:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822473212",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822473212"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822528035",
      "pull_request_review_id": 904192009,
      "id": 822528035,
      "node_id": "PRRC_kwDOABII584xBsgj",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, I needed a few days to grasp that :exploding_head: ",
      "created_at": "2022-03-09T10:57:54Z",
      "updated_at": "2022-03-09T10:57:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822528035",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822528035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822653623",
      "pull_request_review_id": 904367531,
      "id": 822653623,
      "node_id": "PRRC_kwDOABII584xCLK3",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">  I do not like this much because the members in CBlockIndex need to be guarded, but will be without a GUARDED_BY() tag.\r\n\r\nI should probably explain reasoning behind what I suggested yesterday. I don't think this is a question what anybody likes or doesn't like, but a question of what's right and wrong. It's wrong to annotate these struct members as being guarded by cs_main, because they aren't guarded by it. The whole struct is not even guarded by cs_main, just certain instances of it are. What *is* guarded by cs_main is the `m_block_index` map and pointers & references to CBlockIndex instances specifically inside that map. \r\n\r\nThe correct way to annotate this code would be not to annotate anything in CBlockIndex (Ideally I would rename it to `struct BlockInfo` and make it plain struct with no methods), but to not expose this low-level struct to high level application code. Higher level code would use a `BlockReference` accessor class that has a `BlockInfo&` member and methods appropriately annotated with EXCLUSIVE_LOCKS_REQUIRED(cs_main) to enforce the access pattern which enables our lock usage. `CBlockIndex*` pointers throughout the code would be replaced by `BlockReference` objects. In my ideal world, this would look something like:\r\n\r\n```c++\r\nstruct BlockInfo {\r\n   uint256 hash;\r\n   int height = 0;\r\n   BlockInfo* prev = nullptr;\r\n   /// ... more members here ... ///\r\n};\r\n\r\nstruct BlockState : public BlockInfo {\r\n  int flags = 0;\r\n  int file_num = -1;\r\n  unsigned data_pos = 0;\r\n  unsigned undo_pos = 0;\r\n};\r\n\r\nclass BlockReference {\r\nprivate:\r\n   BlockState& m_block;\r\npublic:\r\n   BlockInfo& info() const { return m_block; }\r\n   BlockState& state() EXCLUSIVE_LOCKS_REQUIRED(cs_main) { return m_block; }\r\n   BlockReference prev() const { return {static_cast<BlockState&>(*Assert(m_block.prev))}; }\r\n   // Could add more fine-grained accessors like height() or flags() or whatever.\r\n};\r\n\r\nclass BlockManager {\r\nprivate:\r\n  std::unordered_set<BlockState> m_blocks GUARDED_BY(cs_main);\r\npublic:\r\n  BlockReference FindBlock(const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n   /// ... more stuff ... ///\r\n}\r\n```\r\n\r\nThe appoach I suggested yesterday does the same thing but keeps everything mushed into the same CBlockIndex class/struct hybrid instead of splitting it out. It would be pretty easy to implement what I suggested yesterday as a followup to this PR to re-enable thread safety checking. In any case I was not suggesting doing something bigger like that in this PR.",
      "created_at": "2022-03-09T13:35:38Z",
      "updated_at": "2022-03-09T13:39:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822653623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/822653623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823521820",
      "pull_request_review_id": 905558001,
      "id": 823521820,
      "node_id": "PRRC_kwDOABII584xFfIc",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "_to use another wording (not like/dislike):_\r\n\r\nIt is a [design smell](https://en.wikipedia.org/wiki/Design_smell) to have a variable without `GUARDED_BY()` and rely on `EXCLUSIVE_LOCKS_REQUIRED()` on some methods to protect it. This way, if the code goes wrong (like, new access is added to the variable from a function not marked with `EXCLUSIVE_LOCKS_REQUIRED()`) then the compiler has no way to detect that. This defeats the purpose of thread safety annotations which is to **enforce** proper access and detect mistakes if the code goes wrong.\r\n\r\nYour [suggestion above](https://github.com/bitcoin/bitcoin/pull/24199#discussion_r821942074) does that:\r\n> replace public guarded variables with private unguarded variables ... And add `EXCLUSIVE_LOCKS_REQUIRED` accessor methods as needed to ensure variables are always accessed with the right locks held.",
      "created_at": "2022-03-10T09:36:09Z",
      "updated_at": "2022-03-10T09:36:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r823521820",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823521820"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823530377",
      "pull_request_review_id": 905569646,
      "id": 823530377,
      "node_id": "PRRC_kwDOABII584xFhOJ",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for the review feedback! Given the number of pulls that are currently touching this area of the codebase, it seems good to keep this change minimal and perhaps propose these ideas as a follow-up (happy to review them).",
      "created_at": "2022-03-10T09:44:54Z",
      "updated_at": "2022-03-10T09:44:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r823530377",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823530377"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823670409",
      "pull_request_review_id": 905765226,
      "id": 823670409,
      "node_id": "PRRC_kwDOABII584xGDaJ",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It is a [design smell](https://en.wikipedia.org/wiki/Design_smell) to have a variable without `GUARDED_BY()` and rely on `EXCLUSIVE_LOCKS_REQUIRED()` on some methods to protect it. This way, if the code goes wrong (like, new access is added to the variable from a function not marked with `EXCLUSIVE_LOCKS_REQUIRED()`) then the compiler has no way to detect that. This defeats the purpose of thread safety annotations which is to **enforce** proper access and detect mistakes if the code goes wrong.\r\n\r\nThese are mostly incorrect claims made without specific reasoning or justification. If you have an inner variable that does *not* require lucking, and an outer data structure containing the variable, or an outer pointer pointing to the variable, or an outer function accessing the variable, and the outer container/pointer/function *does* require locking, the correct way of annotating the code is to _not annotate_ the variable, and _to annotate_ the outer container/pointer/function.\r\n\r\nIf you look at the actual code I posted in https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822653623, you can see that the compiler will detect all unsafe accesses. If you want to talk about a code smell, NO_THREAD_SAFETY_ANALYSIS is the code smell, and the design in that post shows how to get rid of it.\r\n\r\nThat said, there is a difference between the bigger change I posted yesterday https://github.com/bitcoin/bitcoin/pull/24199#discussion_r822653623, and the smaller suggestion https://github.com/bitcoin/bitcoin/pull/24199#discussion_r821942074 I posted two days ago. In both cases the compiler can guarantee thread safety outside of chain.h/chain.cpp if these files are annotated correctly. But in the bigger change where I split up CBlockIndex class into separate BlockInfo / BlockState / BlockReference components, it's easy to annotate everything correctly, while in the smaller change where CBlockIndex is kept as a monolithic class, what you are saying about it being trickier to see notice missing EXCLUSIVE_LOCKS_REQUIRED annotations on CBlockIndex methods is true.\r\n\r\nIf you want to argue that using incorrect annotations is better than using correct ones for practical reasons (e.g. it is better to use NO_THREAD_SAFETY_ANALYSIS in one method, so the rest of the file is easier to maintain), that's fine. But let's not create confusion about what correct annotations are and what incorrect annotations are. Correct annotations do not require using NO_THREAD_SAFETY_ANALYSIS, and that's just the most obvious clue.",
      "created_at": "2022-03-10T12:33:11Z",
      "updated_at": "2022-03-10T12:33:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r823670409",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/823670409"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/827927512",
      "pull_request_review_id": 911512326,
      "id": 827927512,
      "node_id": "PRRC_kwDOABII584xWSvY",
      "diff_hunk": "@@ -380,9 +380,13 @@ class CDiskBlockIndex : public CBlockIndex\n         hashPrev = (pprev ? pprev->GetBlockHash() : uint256());\n     }\n \n-    SERIALIZE_METHODS(CDiskBlockIndex, obj)\n+    // Thread safety analysis is disabled because (a) CDiskBlockIndex creates a\n+    // copy of the data to serialize a struct that is subsequently discarded,\n+    // and (b) if the analysis is enabled the nStatus compiler warnings are only\n+    // generated by the tests, as the callers in the codebase that invoke this\n+    // serialization hold cs_main and have lock annotations and assertions.\n+    SERIALIZE_METHODS(CDiskBlockIndex, obj) NO_THREAD_SAFETY_ANALYSIS",
      "path": "src/chain.h",
      "position": 10,
      "original_position": 10,
      "commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "original_commit_id": "0e052eb04fa07fc4915c11faa8866ab759365dc4",
      "in_reply_to_id": 821942074,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Wrt `NO_THREAD_SAFETY_ANALYSIS` I tend to agree with @luke-jr: https://github.com/bitcoin/bitcoin/pull/24199#issuecomment-1025479698. This is why I did not ACK this PR, which contains `NO_THREAD_SAFETY_ANALYSIS`. Personally, I do not see a good and elegant solution to the problem this PR aims to fix (yet).",
      "created_at": "2022-03-16T11:58:44Z",
      "updated_at": "2022-03-16T11:58:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/24199#discussion_r827927512",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/827927512"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24199"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    }
  ]
}
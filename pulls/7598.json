{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598",
    "id": 60714576,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjA3MTQ1NzY=",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/7598",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/7598.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/7598.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
    "number": 7598,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Refactor CreateNewBlock to be a method of the BlockAssembler class",
    "user": {
      "login": "morcos",
      "id": 4360349,
      "node_id": "MDQ6VXNlcjQzNjAzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/morcos",
      "html_url": "https://github.com/morcos",
      "followers_url": "https://api.github.com/users/morcos/followers",
      "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
      "organizations_url": "https://api.github.com/users/morcos/orgs",
      "repos_url": "https://api.github.com/users/morcos/repos",
      "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/morcos/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This **should** have no functional changes. I'll do more extensive testing to make sure it generates the exact same blocks. This refactor will make it easier to add new algorithms for block filling.\n",
    "labels": [
      {
        "id": 118378960,
        "node_id": "MDU6TGFiZWwxMTgzNzg5NjA=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mining",
        "name": "Mining",
        "color": "c7def8",
        "default": false
      }
    ],
    "active_lock_reason": "resolved",
    "created_at": "2016-02-25T17:19:21Z",
    "updated_at": "2021-09-08T11:20:56Z",
    "closed_at": "2016-06-13T09:36:04Z",
    "mergeable_state": "unknown",
    "merged_at": "2016-06-13T09:36:04Z",
    "merge_commit_sha": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "morcos:BlockAssembler",
      "ref": "BlockAssembler",
      "sha": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 21699686,
        "node_id": "MDEwOlJlcG9zaXRvcnkyMTY5OTY4Ng==",
        "name": "bitcoin",
        "full_name": "morcos/bitcoin",
        "owner": {
          "login": "morcos",
          "id": 4360349,
          "node_id": "MDQ6VXNlcjQzNjAzNDk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/morcos",
          "html_url": "https://github.com/morcos",
          "followers_url": "https://api.github.com/users/morcos/followers",
          "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
          "organizations_url": "https://api.github.com/users/morcos/orgs",
          "repos_url": "https://api.github.com/users/morcos/repos",
          "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/morcos/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/morcos/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/morcos/bitcoin",
        "archive_url": "https://api.github.com/repos/morcos/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/morcos/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/morcos/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/morcos/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/morcos/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/morcos/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/morcos/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/morcos/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/morcos/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/morcos/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/morcos/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/morcos/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/morcos/bitcoin/events",
        "forks_url": "https://api.github.com/repos/morcos/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/morcos/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/morcos/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/morcos/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/morcos/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/morcos/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/morcos/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/morcos/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/morcos/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/morcos/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/morcos/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/morcos/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/morcos/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/morcos/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/morcos/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/morcos/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:morcos/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/morcos/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/morcos/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/morcos/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/morcos/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/morcos/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/morcos/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/morcos/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/morcos/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/morcos/bitcoin/hooks",
        "svn_url": "https://github.com/morcos/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 119327,
        "default_branch": "master",
        "open_issues_count": 3,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2019-05-22T19:49:00Z",
        "created_at": "2014-07-10T15:39:10Z",
        "updated_at": "2022-02-11T23:59:55Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "239d4198645434542b01916dae5eebc7a3a7bbcc",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35475,
        "stargazers_count": 70608,
        "watchers_count": 70608,
        "size": 236222,
        "default_branch": "master",
        "open_issues_count": 668,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-02T14:29:40Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-08-02T14:31:15Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 333,
    "deletions": 206,
    "changed_files": 5,
    "commits": 3,
    "review_comments": 12,
    "comments": 6
  },
  "events": [
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-02-25T20:48:01Z",
      "updated_at": "2016-02-25T20:48:01Z",
      "source": {
        "issue": {
          "id": 136507023,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NjA3NDQ0MzQ=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7600",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7600/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7600/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7600/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/7600",
          "number": 7600,
          "state": "closed",
          "state_reason": null,
          "title": "Mining: Select transactions using feerate-with-ancestors",
          "body": "This implements \"Child-pays-for-parent\" transaction selection in `CreateNewBlock`, where we sort the mempool using (modified) feerate with ancestors and consider transactions in that order during block creation.  As transactions are selected, a separate map is used to track the new feerate-with-ancestors value to use for in-mempool descendants that haven't yet been selected.\n\nThis is almost strictly better (ie, results in higher-fee blocks) than the existing mining algorithm, with some small variance due to edge cases around which transactions might get selected as the new block's size approaches the maximum allowed.  Moreover the performance impact on `CreateNewBlock` is minimal -- I observed that the total run time of the function actually slightly improved, apparently due to `TestBlockValidity` being on average slightly faster (a somewhat surprising result).\n\nThe actual fee improvements observed were fairly low in the time period I looked at (October 2015), roughly a 1% fee improvement overall.  I think that is driven first and foremost by blocks not really being full for a large bulk of the time period, so on a large number of data points the results were identical.  Additionally, my guess is that user behavior may not have adapted to this type of transaction selection being widely deployed, and so in the future perhaps we might expect to see larger differences.  I did note a handful of instances where the implementation here notably outperformed the existing algorithm, in some instances more than 20% better, but those were the exception and not the rule.  \n\nFor comparison, I found no examples where the old algorithm produced a block with 0.5% or more in fees than the new algorithm (and few examples where the old algorithm's block had more fees at all, around 1% of samples).\n\nI've labeled this PR as a work-in-progress for now, as it builds off two other open PR's (#7594 and #7598).  Once those are reviewed and merged, I'll rebase this and remove the WIP label.  I opened this now to help motivate the work in those two PRs.\n\nOne open question I have is whether it's worth keeping around the old transaction selection algorithm.  The refactor in #7598 that this builds on makes it easy to leave it around, and I don't think it would be hard to add command line arguments for policy configuration that would enable using the older algorithm.  But I don't know if that's of interest to anyone, so for now I figure we can let people mull it over and decide what to do in a future PR.\n\nA related question to that is whether to get rid of the existing mempool \"score\" index. The ancestor tracking pull adds a new ancestor feerate index without removing the old feerate index, but if we decide to get rid of the mining algorithm that uses that index, then perhaps we could also eliminate this mempool index as well.\n\nTo do:\n- [x] Review/merge #7594 \n- [x] Review/merge #7598\n",
          "user": {
            "login": "sdaftuar",
            "id": 7463573,
            "node_id": "MDQ6VXNlcjc0NjM1NzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sdaftuar",
            "html_url": "https://github.com/sdaftuar",
            "followers_url": "https://api.github.com/users/sdaftuar/followers",
            "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
            "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
            "repos_url": "https://api.github.com/users/sdaftuar/repos",
            "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118378960,
              "node_id": "MDU6TGFiZWwxMTgzNzg5NjA=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Mining",
              "name": "Mining",
              "color": "c7def8",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 22,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7600",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/7600",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/7600.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/7600.patch"
          },
          "closed_at": "2016-06-16T17:21:07Z",
          "created_at": "2016-02-25T20:48:01Z",
          "updated_at": "2021-09-08T11:21:00Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 566359657,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDU2NjM1OTY1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/566359657",
      "actor": {
        "login": "jonasschnelli",
        "id": 178464,
        "node_id": "MDQ6VXNlcjE3ODQ2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonasschnelli",
        "html_url": "https://github.com/jonasschnelli",
        "followers_url": "https://api.github.com/users/jonasschnelli/followers",
        "following_url": "https://api.github.com/users/jonasschnelli/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonasschnelli/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonasschnelli/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
        "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
        "repos_url": "https://api.github.com/users/jonasschnelli/repos",
        "events_url": "https://api.github.com/users/jonasschnelli/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-02-25T21:12:47Z",
      "label": {
        "name": "Mining",
        "color": "c7def8"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 583733797,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTgzNzMzNzk3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/583733797",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-03-09T18:40:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 592026206,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTkyMDI2MjA2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/592026206",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-03-16T15:40:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 611408677,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NjExNDA4Njc3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/611408677",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-04-01T15:19:08Z"
    },
    {
      "event": "commented",
      "id": 218617610,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIxODYxNzYxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/218617610",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-05-11T23:14:50Z",
      "updated_at": "2016-05-11T23:14:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "Needs rebase.\n",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-218617610",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0ZGM5NGQxMDM2NTc2ZmU5ODhhMDY2ZmRhYmMwNDczNTBjY2RkZGE5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4dc94d1036576fe988a066fdabc047350ccddda9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4dc94d1036576fe988a066fdabc047350ccddda9",
      "tree": {
        "sha": "f78d4e5795a752408f165356cafc8f7bce8f5852",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f78d4e5795a752408f165356cafc8f7bce8f5852"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/239d4198645434542b01916dae5eebc7a3a7bbcc",
          "sha": "239d4198645434542b01916dae5eebc7a3a7bbcc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/239d4198645434542b01916dae5eebc7a3a7bbcc"
        }
      ],
      "message": "Refactor CreateNewBlock to be a method of the BlockAssembler class",
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2016-05-18T18:11:12Z"
      },
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2015-12-15T20:26:44Z"
      },
      "sha": "4dc94d1036576fe988a066fdabc047350ccddda9"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 664789164,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NjY0Nzg5MTY0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/664789164",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-05-18T18:14:19Z"
    },
    {
      "event": "commented",
      "id": 220112886,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIyMDExMjg4Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/220112886",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-05-18T18:15:35Z",
      "updated_at": "2016-05-18T18:15:35Z",
      "author_association": "MEMBER",
      "body": "rebased\n",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-220112886",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMDI6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMDU6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "commented",
      "id": 220868794,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIyMDg2ODc5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/220868794",
      "actor": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-05-23T01:13:10Z",
      "updated_at": "2016-05-23T01:13:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "utACK 4dc94d1036576fe988a066fdabc047350ccddda9 +/- whitespace.\n",
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-220868794",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzphMjc4NzY0NzQ4MTlmZmZmODA2MTRmOTY2ZmVhMDZkNWRhMmQ1YzE1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a27876474819ffff80614f966fea06d5da2d5c15",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a27876474819ffff80614f966fea06d5da2d5c15",
      "tree": {
        "sha": "ae4cc097a99dc4f8904596b0d9f4107dbf3ebf27",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ae4cc097a99dc4f8904596b0d9f4107dbf3ebf27"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4dc94d1036576fe988a066fdabc047350ccddda9",
          "sha": "4dc94d1036576fe988a066fdabc047350ccddda9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4dc94d1036576fe988a066fdabc047350ccddda9"
        }
      ],
      "message": "FIX: Account for txs already added to block in addPriorityTxs",
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2016-05-24T19:01:14Z"
      },
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2016-05-24T18:23:15Z"
      },
      "sha": "a27876474819ffff80614f966fea06d5da2d5c15"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMmRkNWEzYzM5MTU2NzQ5ZThlZTI0NzcyZDFmY2IwMTQwNGYyYjZm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "tree": {
        "sha": "8e6b62d05cc1399db28a8d00f634add8cee0df60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8e6b62d05cc1399db28a8d00f634add8cee0df60"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a27876474819ffff80614f966fea06d5da2d5c15",
          "sha": "a27876474819ffff80614f966fea06d5da2d5c15",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a27876474819ffff80614f966fea06d5da2d5c15"
        }
      ],
      "message": "FIX: correctly measure size of priority block",
      "committer": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2016-06-01T16:29:03Z"
      },
      "author": {
        "name": "Alex Morcos",
        "email": "morcos@chaincode.com",
        "date": "2016-06-01T16:29:03Z"
      },
      "sha": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f"
    },
    {
      "event": "commented",
      "id": 223053821,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzA1MzgyMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223053821",
      "actor": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-01T16:46:24Z",
      "updated_at": "2016-06-01T16:46:24Z",
      "author_association": "MEMBER",
      "body": "Fix two bugs identified by @sdaftuar \n",
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-223053821",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "mentioned",
      "id": 678697462,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Njc4Njk3NDYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/678697462",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-01T16:46:24Z"
    },
    {
      "event": "subscribed",
      "id": 678697463,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDY3ODY5NzQ2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/678697463",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-01T16:46:24Z"
    },
    {
      "event": "commented",
      "id": 223078058,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIyMzA3ODA1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/223078058",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-01T18:11:08Z",
      "updated_at": "2016-06-01T18:11:08Z",
      "author_association": "MEMBER",
      "body": "ACK\n\nVerified that the old code and new code produce identical blocks (calling CreateNewBlock every 100 transactions, over two weeks of data from February).\n",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-223078058",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMDg6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "merged",
      "id": 690184335,
      "node_id": "MDExOk1lcmdlZEV2ZW50NjkwMTg0MzM1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/690184335",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "created_at": "2016-06-13T09:36:04Z"
    },
    {
      "event": "closed",
      "id": 690184336,
      "node_id": "MDExOkNsb3NlZEV2ZW50NjkwMTg0MzM2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/690184336",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-13T09:36:04Z"
    },
    {
      "event": "referenced",
      "id": 690184426,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDY5MDE4NDQyNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/690184426",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e1486eb95c50834179d42e3d056e11c2f7b4ebff",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1486eb95c50834179d42e3d056e11c2f7b4ebff",
      "created_at": "2016-06-13T09:36:09Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-13T20:28:13Z",
      "updated_at": "2016-06-13T20:28:13Z",
      "source": {
        "issue": {
          "id": 149494174,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NjcwMzgxMzU=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7910",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7910/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7910/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7910/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/7910",
          "number": 7910,
          "state": "closed",
          "state_reason": null,
          "title": "Segregated witness",
          "body": "This is the complete code for segregated witness on top of master (implementing BIP141, BIP143, BIP144, BIP145). Apart from commentary and merging (see further), the code is never rewritten/squashed/rebased, in order not to invalidate review. A rebased/squashed version is available here: #8149.\n\nSee also the detailed and up-to-date list of commits here: https://github.com/bitcoin/bitcoin/pull/7910#issuecomment-211998958\n\nThere are certainly some items left to do:\n- [x] Incorporate changes to BIP145/BIP9 when finalized (see https://github.com/bitcoin/bips/pull/365)\n- [x] Define a deployment time for testnet\n- [x] Seed nodes that provide segwit-capable peers\n- [x] Do tests in a mixed network of upgraded and non-upgraded nodes\n- [x] Remove segnet from mainline merge\n- [ ] Define a deployment time for mainnet\n- [ ] Per-transaction caching of sighashes to fix the O(n^2) sighash problem (see https://github.com/sipa/bitcoin/pull/70)\n\nMany thanks to all contributors so far (including @jl2012, @NicolasDorier, @CodeShark, @sdaftuar, @morcos, @luke-jr, @afk11, @theuni, @TheBlueMatt, @MarcoFalke, @LongShao007, @jonasnick, @mruddy), the ideas it is based on (by @gmaxwell and @luke-jr), and many reviewers (including @SergioDemianLerner, @instagibbs, @dcousens, and @btcdrak).\n",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 192202000,
              "node_id": "MDU6TGFiZWwxOTIyMDIwMDA=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus",
              "name": "Consensus",
              "color": "009800",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 35,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7910",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/7910",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/7910.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/7910.patch"
          },
          "closed_at": "2016-06-24T16:20:54Z",
          "created_at": "2016-04-19T15:22:33Z",
          "updated_at": "2021-09-08T11:03:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMDk6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMTI6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "line-commented",
      "id": null,
      "node_id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY0NjkxMTQ6djI=",
      "url": null,
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null
    },
    {
      "event": "commented",
      "id": 225939045,
      "node_id": "MDEyOklzc3VlQ29tbWVudDIyNTkzOTA0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/225939045",
      "actor": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2016-06-14T16:32:54Z",
      "updated_at": "2016-06-14T16:32:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "utAck -- apologies for line noise on the time thing, wasn't highly related to this.\n",
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#issuecomment-225939045",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/7598"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "kyuupichan",
        "id": 3319176,
        "node_id": "MDQ6VXNlcjMzMTkxNzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3319176?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kyuupichan",
        "html_url": "https://github.com/kyuupichan",
        "followers_url": "https://api.github.com/users/kyuupichan/followers",
        "following_url": "https://api.github.com/users/kyuupichan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kyuupichan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kyuupichan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kyuupichan/subscriptions",
        "organizations_url": "https://api.github.com/users/kyuupichan/orgs",
        "repos_url": "https://api.github.com/users/kyuupichan/repos",
        "events_url": "https://api.github.com/users/kyuupichan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kyuupichan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-03-04T10:36:04Z",
      "updated_at": "2017-03-04T10:36:04Z",
      "source": {
        "issue": {
          "id": 211871572,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MTA5MTAzMjE1",
          "url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/334",
          "repository_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited",
          "labels_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/334/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/334/comments",
          "events_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/334/events",
          "html_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/334",
          "number": 334,
          "state": "closed",
          "state_reason": null,
          "title": "Backports to miner.cpp",
          "body": "Ultimate goal here is a backport of CPFP. That depends on various prior changes to miner.cpp/h that we don't have backported to BU yet. This series of commits are backports of 2 Core PRs that take us right up to the point where CPFP related PRs start to go in.\r\n\r\nPR https://github.com/bitcoin/bitcoin/pull/7539  \r\nPR https://github.com/bitcoin/bitcoin/pull/7598\r\n\r\nThis is obviously very sensitive code given the recent big block that was generated.  I've done my best to preserve existing semantics except for one case.  The old code had a 16 byte reserve for extra varints in the coinbase.  I've reduced this to 4 bytes in reserveBlockSize() because a) one isn't a varint - a tx_out value is always 8 bytes, and secondly for the height varint - 5 bytes in all (1 plus 4 extra) is enough for 10s of thousands of years of block heights.\r\n\r\n@sickpig @gandrewstone  I'd appreciate very careful review.  Thanks!",
          "user": {
            "login": "kyuupichan",
            "id": 3319176,
            "node_id": "MDQ6VXNlcjMzMTkxNzY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3319176?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kyuupichan",
            "html_url": "https://github.com/kyuupichan",
            "followers_url": "https://api.github.com/users/kyuupichan/followers",
            "following_url": "https://api.github.com/users/kyuupichan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/kyuupichan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/kyuupichan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/kyuupichan/subscriptions",
            "organizations_url": "https://api.github.com/users/kyuupichan/orgs",
            "repos_url": "https://api.github.com/users/kyuupichan/repos",
            "events_url": "https://api.github.com/users/kyuupichan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/kyuupichan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/pulls/334",
            "html_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/334",
            "diff_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/334.diff",
            "patch_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/334.patch"
          },
          "closed_at": "2017-03-18T07:47:14Z",
          "created_at": "2017-03-04T10:36:04Z",
          "updated_at": "2017-03-19T06:22:08Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "kyuupichan",
        "id": 3319176,
        "node_id": "MDQ6VXNlcjMzMTkxNzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3319176?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kyuupichan",
        "html_url": "https://github.com/kyuupichan",
        "followers_url": "https://api.github.com/users/kyuupichan/followers",
        "following_url": "https://api.github.com/users/kyuupichan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kyuupichan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kyuupichan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kyuupichan/subscriptions",
        "organizations_url": "https://api.github.com/users/kyuupichan/orgs",
        "repos_url": "https://api.github.com/users/kyuupichan/repos",
        "events_url": "https://api.github.com/users/kyuupichan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kyuupichan/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2017-03-19T06:30:35Z",
      "updated_at": "2017-03-19T06:30:35Z",
      "source": {
        "issue": {
          "id": 215245083,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MTExNDM5MDY1",
          "url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/380",
          "repository_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited",
          "labels_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/380/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/380/comments",
          "events_url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/issues/380/events",
          "html_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/380",
          "number": 380,
          "state": "closed",
          "state_reason": null,
          "title": "Miner backport",
          "body": "Ultimate goal here is a backport of CPFP. That depends on various prior changes to miner.cpp/h that we don't have backported to BU yet. This series of commits are backports of 2 Core PRs that take us right up to the point where CPFP related PRs start to go in.\r\n\r\nPR bitcoin#7539\r\nPR bitcoin#7598\r\n\r\nThis is obviously very sensitive code given the recent big block that was generated. I've done my best to preserve existing semantics except for one case. The old code had a 16 byte reserve for extra varints in the coinbase.  I've replaced it; there were 3 incorrect assumptions:\r\n\r\n1) The height in the coinbase isn't a varint, it's a script serialized integer, which is a minimum of 2 bytes and currently 4 bytes (for heights of 32768 and higher) and will be 4 bytes for another 150 years.  See BIP34\r\n2) The coinbase output amount isn't a varint, it's always 8 bytes like all txout values.\r\n3) There was no accounting for the txCount varint in the serialized block.  I reserve 5 bytes for 4 billion txs, which should be enough for a while :)  Current full blocks will only be using 3 bytes, but that will bump to 5 once blocks can hold 65536 txs.\r\n\r\nThe test loops are more fine-grained, and assert that blocks up to and including a tighter limit (because of the reasons above, such as a 2-byte height of 110) are created, but no greater.  Comments are included that explain the limits.  This gives me a high degree of confidence my understanding and implementation is correct.\r\n\r\nNevertheless careful review appreciated @gandrewstone and @ptschip",
          "user": {
            "login": "kyuupichan",
            "id": 3319176,
            "node_id": "MDQ6VXNlcjMzMTkxNzY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3319176?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kyuupichan",
            "html_url": "https://github.com/kyuupichan",
            "followers_url": "https://api.github.com/users/kyuupichan/followers",
            "following_url": "https://api.github.com/users/kyuupichan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/kyuupichan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/kyuupichan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/kyuupichan/subscriptions",
            "organizations_url": "https://api.github.com/users/kyuupichan/orgs",
            "repos_url": "https://api.github.com/users/kyuupichan/repos",
            "events_url": "https://api.github.com/users/kyuupichan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/kyuupichan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/BitcoinUnlimited/BitcoinUnlimited/pulls/380",
            "html_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/380",
            "diff_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/380.diff",
            "patch_url": "https://github.com/BitcoinUnlimited/BitcoinUnlimited/pull/380.patch"
          },
          "closed_at": "2017-04-08T01:47:04Z",
          "created_at": "2017-03-19T06:30:35Z",
          "updated_at": "2017-05-02T03:23:55Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 1252235298,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDEyNTIyMzUyOTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1252235298",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "287af63af3d01e94a003608be92c14e5b5748fcc",
      "commit_url": "https://api.github.com/repos/codablock/dash/commits/287af63af3d01e94a003608be92c14e5b5748fcc",
      "created_at": "2017-09-16T17:57:36Z"
    },
    {
      "event": "referenced",
      "id": 1255585382,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDEyNTU1ODUzODI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1255585382",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5571b6eacf33d460005cfe84353a23b8681d82f2",
      "commit_url": "https://api.github.com/repos/codablock/dash/commits/5571b6eacf33d460005cfe84353a23b8681d82f2",
      "created_at": "2017-09-19T14:38:14Z"
    },
    {
      "event": "referenced",
      "id": 1399972047,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDEzOTk5NzIwNDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/1399972047",
      "actor": {
        "login": "codablock",
        "id": 1884269,
        "node_id": "MDQ6VXNlcjE4ODQyNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1884269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codablock",
        "html_url": "https://github.com/codablock",
        "followers_url": "https://api.github.com/users/codablock/followers",
        "following_url": "https://api.github.com/users/codablock/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/codablock/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/codablock/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/codablock/subscriptions",
        "organizations_url": "https://api.github.com/users/codablock/orgs",
        "repos_url": "https://api.github.com/users/codablock/repos",
        "events_url": "https://api.github.com/users/codablock/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/codablock/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "6a698300ab475461bdb0f6681763db2b197a9ab7",
      "commit_url": "https://api.github.com/repos/codablock/dash/commits/6a698300ab475461bdb0f6681763db2b197a9ab7",
      "created_at": "2017-12-22T18:35:55Z"
    },
    {
      "event": "referenced",
      "id": 2056234897,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDIwNTYyMzQ4OTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2056234897",
      "actor": {
        "login": "andvgal",
        "id": 6080632,
        "node_id": "MDQ6VXNlcjYwODA2MzI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6080632?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andvgal",
        "html_url": "https://github.com/andvgal",
        "followers_url": "https://api.github.com/users/andvgal/followers",
        "following_url": "https://api.github.com/users/andvgal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andvgal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andvgal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andvgal/subscriptions",
        "organizations_url": "https://api.github.com/users/andvgal/orgs",
        "repos_url": "https://api.github.com/users/andvgal/repos",
        "events_url": "https://api.github.com/users/andvgal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andvgal/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "650cac81cf132da425e39a59d0544acfe19ea92a",
      "commit_url": "https://api.github.com/repos/energicryptocurrency/gen2-energi/commits/650cac81cf132da425e39a59d0544acfe19ea92a",
      "created_at": "2019-01-06T10:40:04Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-04T16:37:16Z",
      "updated_at": "2020-07-04T16:37:16Z",
      "source": {
        "issue": {
          "id": 650732615,
          "node_id": "MDU6SXNzdWU2NTA3MzI2MTU=",
          "url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/1726",
          "repository_url": "https://api.github.com/repos/PIVX-Project/PIVX",
          "labels_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/1726/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/1726/comments",
          "events_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/1726/events",
          "html_url": "https://github.com/PIVX-Project/PIVX/issues/1726",
          "number": 1726,
          "state": "closed",
          "state_reason": "completed",
          "title": "Up to CTransactionRef point back ports to do list.",
          "body": "This issue tracker is for tracking some specific back ports to get up to the final migration to `CTransactionRef` point.\r\n\r\n- [x] https://github.com/bitcoin/bitcoin/pull/6898 -> (partially in #1725)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/7062 -> (in #2118)\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/7187\r\n- [x] https://github.com/bitcoin/bitcoin/pull/7539 -> (in #1727)\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/7598\r\n- [x] https://github.com/bitcoin/bitcoin/pull/7594 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/7840 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/7997 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/8080 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/8126 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/8448 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/8515 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/8865 -> (in #1872)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9014 -> (in #1915)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9125 -> (in #1815) \r\n- [x] https://github.com/bitcoin/bitcoin/pull/9240 -> (in #2150)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9371  -> (in #2150)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9408 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9966 -> (in #2118)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/9725 -> (in #2150)\r\n- [x] https://github.com/bitcoin/bitcoin/pull/10330 -> (in #2118)\r\n\r\nWill try to continue adding more as them appear down the back porting rabbit hole. Most likely there are more PRs in-between the ones above that need to be back ported too.\r\n\r\nEveryone is more than welcome to join this effort :) . Just pick one on the list and start doing it.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "NONE",
          "locked": false,
          "comments": 1,
          "closed_at": "2021-02-01T14:29:16Z",
          "created_at": "2020-07-03T18:58:41Z",
          "updated_at": "2021-02-01T14:29:17Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-01-25T13:31:38Z",
      "updated_at": "2021-01-25T13:31:38Z",
      "source": {
        "issue": {
          "id": 793384721,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NTYxMDgxNzgy",
          "url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/2155",
          "repository_url": "https://api.github.com/repos/PIVX-Project/PIVX",
          "labels_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/2155/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/2155/comments",
          "events_url": "https://api.github.com/repos/PIVX-Project/PIVX/issues/2155/events",
          "html_url": "https://github.com/PIVX-Project/PIVX/pull/2155",
          "number": 2155,
          "state": "closed",
          "state_reason": null,
          "title": "[Miner] Rewrite miner code with proper encapsulation + test coverage",
          "body": "Have rewritten the miner code sources, dividing the miner thread from the block assembling process, encapsulating the block creation state inside a new `BlockAssembler` class (adapting #7598).\r\n\r\nCleaned several mempool redundant checks inside the assembly process (adaptation of #6898):\r\n> The mempool is explicitly assumed to be responsible for maintaining consistency of transactions with respect to not spending non-existent outputs, not double spending, script validity and coinbase maturity. Only finality of transactions is checked before assembling a block.\r\n\r\nAnother point added here is the rework of the previously non-functional `miner_tests` unit test. Which.. have essentially made it work, adding coverage for the miner process, updating it to a fairly recent point down upstream's path + adapting it to our blockchain and consensus rules.\r\n \r\nThe result is a large speed up in the block assembly process, a much better and cleaner code architecture and enable an easier add of new algorithms for block filling in the future.\r\n\r\n------------\r\n\r\nA good work path on top of this would be to add unit test coverage for PoS, cold staking and Sapling block creation (among others). At the moment, most of the block creation tests are functional ones which are slow and require to setup entire nodes etc.\r\n\r\n",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 566257187,
              "node_id": "MDU6TGFiZWw1NjYyNTcxODc=",
              "url": "https://api.github.com/repos/PIVX-Project/PIVX/labels/Upstream",
              "name": "Upstream",
              "color": "bfd4f2",
              "default": false
            },
            {
              "id": 1303579948,
              "node_id": "MDU6TGFiZWwxMzAzNTc5OTQ4",
              "url": "https://api.github.com/repos/PIVX-Project/PIVX/labels/Block%20Generation",
              "name": "Block Generation",
              "description": "Mining/Staking related issues",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignee": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "furszy",
              "id": 5377650,
              "node_id": "MDQ6VXNlcjUzNzc2NTA=",
              "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/furszy",
              "html_url": "https://github.com/furszy",
              "followers_url": "https://api.github.com/users/furszy/followers",
              "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
              "organizations_url": "https://api.github.com/users/furszy/orgs",
              "repos_url": "https://api.github.com/users/furszy/repos",
              "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/furszy/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "NONE",
          "milestone": {
            "url": "https://api.github.com/repos/PIVX-Project/PIVX/milestones/31",
            "html_url": "https://github.com/PIVX-Project/PIVX/milestone/31",
            "labels_url": "https://api.github.com/repos/PIVX-Project/PIVX/milestones/31/labels",
            "id": 6320078,
            "node_id": "MDk6TWlsZXN0b25lNjMyMDA3OA==",
            "number": 31,
            "state": "closed",
            "title": "5.1.0",
            "description": "",
            "creator": {
              "login": "random-zebra",
              "id": 18186894,
              "node_id": "MDQ6VXNlcjE4MTg2ODk0",
              "avatar_url": "https://avatars.githubusercontent.com/u/18186894?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/random-zebra",
              "html_url": "https://github.com/random-zebra",
              "followers_url": "https://api.github.com/users/random-zebra/followers",
              "following_url": "https://api.github.com/users/random-zebra/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/random-zebra/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/random-zebra/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/random-zebra/subscriptions",
              "organizations_url": "https://api.github.com/users/random-zebra/orgs",
              "repos_url": "https://api.github.com/users/random-zebra/repos",
              "events_url": "https://api.github.com/users/random-zebra/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/random-zebra/received_events",
              "type": "User",
              "site_admin": false
            },
            "open_issues": 0,
            "closed_issues": 116,
            "created_at": "2021-01-17T13:13:22Z",
            "updated_at": "2021-04-27T15:21:50Z",
            "closed_at": "2021-04-27T15:21:50Z"
          },
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/PIVX-Project/PIVX/pulls/2155",
            "html_url": "https://github.com/PIVX-Project/PIVX/pull/2155",
            "diff_url": "https://github.com/PIVX-Project/PIVX/pull/2155.diff",
            "patch_url": "https://github.com/PIVX-Project/PIVX/pull/2155.patch"
          },
          "closed_at": "2021-02-03T06:30:38Z",
          "created_at": "2021-01-25T13:31:38Z",
          "updated_at": "2022-11-29T14:26:07Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 4283427809,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQyODM0Mjc4MDk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4283427809",
      "actor": {
        "login": "Fuzzbawls",
        "id": 7393257,
        "node_id": "MDQ6VXNlcjczOTMyNTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7393257?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fuzzbawls",
        "html_url": "https://github.com/Fuzzbawls",
        "followers_url": "https://api.github.com/users/Fuzzbawls/followers",
        "following_url": "https://api.github.com/users/Fuzzbawls/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fuzzbawls/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fuzzbawls/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fuzzbawls/subscriptions",
        "organizations_url": "https://api.github.com/users/Fuzzbawls/orgs",
        "repos_url": "https://api.github.com/users/Fuzzbawls/repos",
        "events_url": "https://api.github.com/users/Fuzzbawls/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fuzzbawls/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "a88b6ea83fa328bed77742032ba2eb949955ce99",
      "commit_url": "https://api.github.com/repos/PIVX-Project/PIVX/commits/a88b6ea83fa328bed77742032ba2eb949955ce99",
      "created_at": "2021-02-03T06:30:38Z"
    },
    {
      "event": "locked",
      "id": 5271643384,
      "node_id": "LOE_lADOABII584IIhlQzwAAAAE6NuT4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5271643384",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-09-08T11:20:56Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160653",
      "pull_request_review_id": null,
      "id": 64160653,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTYwNjUz",
      "diff_hunk": "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:",
      "path": "src/miner.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "4dc94d1036576fe988a066fdabc047350ccddda9",
      "in_reply_to_id": null,
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: whitespace.\n",
      "created_at": "2016-05-23T01:09:46Z",
      "updated_at": "2016-06-01T16:45:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160653",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160653"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160685",
      "pull_request_review_id": null,
      "id": 64160685,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTYwNjg1",
      "diff_hunk": "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);",
      "path": "src/miner.cpp",
      "position": 64,
      "original_position": 64,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "4dc94d1036576fe988a066fdabc047350ccddda9",
      "in_reply_to_id": null,
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The old code deliberately unlocks before calling TestBlockValidity...I'm not actually sure its worth anything, but just noting that there is actually a behavior change here.\n",
      "created_at": "2016-05-23T01:10:42Z",
      "updated_at": "2016-06-01T16:45:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64160685",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64160685"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64463769",
      "pull_request_review_id": null,
      "id": 64463769,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDYzNzY5",
      "diff_hunk": "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);",
      "path": "src/miner.cpp",
      "position": 64,
      "original_position": 64,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "4dc94d1036576fe988a066fdabc047350ccddda9",
      "in_reply_to_id": null,
      "user": {
        "login": "morcos",
        "id": 4360349,
        "node_id": "MDQ6VXNlcjQzNjAzNDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4360349?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/morcos",
        "html_url": "https://github.com/morcos",
        "followers_url": "https://api.github.com/users/morcos/followers",
        "following_url": "https://api.github.com/users/morcos/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/morcos/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/morcos/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/morcos/subscriptions",
        "organizations_url": "https://api.github.com/users/morcos/orgs",
        "repos_url": "https://api.github.com/users/morcos/repos",
        "events_url": "https://api.github.com/users/morcos/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/morcos/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Are you sure?\n",
      "created_at": "2016-05-24T20:03:08Z",
      "updated_at": "2016-06-01T16:45:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64463769",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64463769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64494596",
      "pull_request_review_id": null,
      "id": 64494596,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDk0NTk2",
      "diff_hunk": "@@ -71,231 +71,299 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+   // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);",
      "path": "src/miner.cpp",
      "position": 64,
      "original_position": 64,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "4dc94d1036576fe988a066fdabc047350ccddda9",
      "in_reply_to_id": null,
      "user": {
        "login": "TheBlueMatt",
        "id": 649246,
        "node_id": "MDQ6VXNlcjY0OTI0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheBlueMatt",
        "html_url": "https://github.com/TheBlueMatt",
        "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
        "following_url": "https://api.github.com/users/TheBlueMatt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheBlueMatt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheBlueMatt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
        "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
        "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
        "events_url": "https://api.github.com/users/TheBlueMatt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, oops, I thought the deliberate scoping had a purpose, but it looks like it does absolutely nothing.\n",
      "created_at": "2016-05-24T23:45:18Z",
      "updated_at": "2016-06-01T16:45:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r64494596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/64494596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65414446",
      "pull_request_review_id": null,
      "id": 65414446,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NDE0NDQ2",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{",
      "path": "src/miner.cpp",
      "position": 22,
      "original_position": 22,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This doesn't seem to reset at least pblock. What's the point of having a reset independent from the constructor?\n",
      "created_at": "2016-06-01T18:16:30Z",
      "updated_at": "2016-06-01T18:16:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r65414446",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/65414446"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 89,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66991998",
      "pull_request_review_id": null,
      "id": 66991998,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTkxOTk4",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);",
      "path": "src/miner.cpp",
      "position": 101,
      "original_position": 101,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that this is fine to leave as-is, but I suspect that the time should ideally be set by the client (e.g. if the block takes a long time to be found say 70 minutes than the client would have had to update their timestamp in their block).\n\nThis could cause a real problem at the halving if there is a sudden reduction in hashpower and mining time goes up past the two hour threshold and all mining clients using this code need to be manually kicked to get a new timestamp. Not setting it at all would cause miners trying to use it to fail always so they would have to be aware of setting it to get anything at all.\n\nIf the code is being refactored than this may be an appropriate time to drop it, or at least mark it for future deprecation as I bet someone is relying on it.\n",
      "created_at": "2016-06-14T15:19:15Z",
      "updated_at": "2016-06-14T15:19:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66991998",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66991998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 156,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66992624",
      "pull_request_review_id": null,
      "id": 66992624,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTkyNjI0",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);",
      "path": "src/miner.cpp",
      "position": 101,
      "original_position": 101,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(of course this is not a correctness thing, just a potential network edge case if users improperly program against this -- I'm well aware this has been the way this code worked for a long time)\n",
      "created_at": "2016-06-14T15:22:09Z",
      "updated_at": "2016-06-14T15:22:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66992624",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66992624"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 156,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66993642",
      "pull_request_review_id": null,
      "id": 66993642,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTkzNjQy",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);",
      "path": "src/miner.cpp",
      "position": 101,
      "original_position": 101,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There is never a requirement to update the time: the constraints are:\n- block.nTime >= median(block.prev^(n).nTime, n=1..11) [which never changes if no block is found to work on top of]\n- block.nTime <= realtime + 120 minutes [which never goes from valid to invalid as time passes]\n",
      "created_at": "2016-06-14T15:27:02Z",
      "updated_at": "2016-06-14T15:27:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66993642",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66993642"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 156,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66993861",
      "pull_request_review_id": null,
      "id": 66993861,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTkzODYx",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);",
      "path": "src/miner.cpp",
      "position": 101,
      "original_position": 101,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In any case, that's a mining protocol suggestion (ntime rolling is used in many places anyway), not something that affects the internal mining code.\n",
      "created_at": "2016-06-14T15:28:09Z",
      "updated_at": "2016-06-14T15:28:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66993861",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66993861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 156,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66995099",
      "pull_request_review_id": null,
      "id": 66995099,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTk1MDk5",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);",
      "path": "src/miner.cpp",
      "position": 101,
      "original_position": 101,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "\n\nhad misread the constraints to have blocks as more time dependent.\n",
      "created_at": "2016-06-14T15:33:34Z",
      "updated_at": "2016-06-14T15:33:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66995099",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66995099"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 156,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66997894",
      "pull_request_review_id": null,
      "id": 66997894,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2OTk3ODk0",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);\n+    pblock->nBits          = GetNextWorkRequired(pindexPrev, pblock, chainparams.GetConsensus());\n+    pblock->nNonce         = 0;\n+    pblocktemplate->vTxSigOps[0] = GetLegacySigOpCount(pblock->vtx[0]);\n+\n+    CValidationState state;\n+    if (!TestBlockValidity(state, chainparams, *pblock, pindexPrev, false, false)) {\n+        throw std::runtime_error(strprintf(\"%s: TestBlockValidity failed: %s\", __func__, FormatStateMessage(state)));\n+    }\n \n-    // How much of the block should be dedicated to high-priority transactions,\n-    // included regardless of the fees they pay\n-    unsigned int nBlockPrioritySize = GetArg(\"-blockprioritysize\", DEFAULT_BLOCK_PRIORITY_SIZE);\n-    nBlockPrioritySize = std::min(nBlockMaxSize, nBlockPrioritySize);\n+    return pblocktemplate.release();\n+}\n \n-    // Minimum block size you want to create; block will be filled with free transactions\n-    // until there are no more or the block reaches this size:\n-    unsigned int nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n-    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+bool BlockAssembler::isStillDependent(CTxMemPool::txiter iter)\n+{\n+    BOOST_FOREACH(CTxMemPool::txiter parent, mempool.GetMemPoolParents(iter))\n+    {\n+        if (!inBlock.count(parent)) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n \n-    // Collect memory pool transactions into the block\n-    CTxMemPool::setEntries inBlock;\n-    CTxMemPool::setEntries waitSet;\n \n-    // This vector will be sorted into a priority queue:\n-    vector<TxCoinAgePriority> vecPriority;\n-    TxCoinAgePriorityCompare pricomparer;\n-    std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash> waitPriMap;\n-    typedef std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash>::iterator waitPriIter;\n-    double actualPriority = -1;\n \n-    std::priority_queue<CTxMemPool::txiter, std::vector<CTxMemPool::txiter>, ScoreCompare> clearedTxs;\n+bool BlockAssembler::TestForBlock(CTxMemPool::txiter iter)\n+{\n+    if (nBlockSize + iter->GetTxSize() >= nBlockMaxSize) {\n+        // If the block is so close to full that no more txs will fit\n+        // or if we've tried more than 50 times to fill remaining space\n+        // then flag that the block is finished\n+        if (nBlockSize >  nBlockMaxSize - 100 || lastFewTxs > 50) {\n+             blockFinished = true;\n+             return false;\n+        }\n+        // Once we're within 1000 bytes of a full block, only look at 50 more txs\n+        // to try to fill the remaining space.\n+        if (nBlockSize > nBlockMaxSize - 1000) {\n+            lastFewTxs++;\n+        }\n+        return false;\n+    }\n+\n+    if (nBlockSigOps + iter->GetSigOpCount() >= MAX_BLOCK_SIGOPS) {\n+        // If the block has room for no more sig ops then\n+        // flag that the block is finished\n+        if (nBlockSigOps > MAX_BLOCK_SIGOPS - 2) {\n+            blockFinished = true;\n+            return false;\n+        }\n+        // Otherwise attempt to find another tx with fewer sigops\n+        // to put in the block.\n+        return false;\n+    }\n+\n+    // Must check that lock times are still valid\n+    // This can be removed once MTP is always enforced\n+    // as long as reorgs keep the mempool consistent.\n+    if (!IsFinalTx(iter->GetTx(), nHeight, nLockTimeCutoff))\n+        return false;\n+\n+    return true;\n+}\n+\n+void BlockAssembler::AddToBlock(CTxMemPool::txiter iter)\n+{\n+    pblock->vtx.push_back(iter->GetTx());\n+    pblocktemplate->vTxFees.push_back(iter->GetFee());\n+    pblocktemplate->vTxSigOps.push_back(iter->GetSigOpCount());\n+    nBlockSize += iter->GetTxSize();\n+    ++nBlockTx;\n+    nBlockSigOps += iter->GetSigOpCount();\n+    nFees += iter->GetFee();\n+    inBlock.insert(iter);\n+\n     bool fPrintPriority = GetBoolArg(\"-printpriority\", DEFAULT_PRINTPRIORITY);\n-    uint64_t nBlockSize = 1000;\n-    uint64_t nBlockTx = 0;\n-    unsigned int nBlockSigOps = 100;\n-    int lastFewTxs = 0;\n-    CAmount nFees = 0;\n+    if (fPrintPriority) {\n+        double dPriority = iter->GetPriority(nHeight);\n+        CAmount dummy;\n+        mempool.ApplyDeltas(iter->GetTx().GetHash(), dPriority, dummy);\n+        LogPrintf(\"priority %.1f fee %s txid %s\\n\",\n+                  dPriority,\n+                  CFeeRate(iter->GetModifiedFee(), iter->GetTxSize()).ToString(),\n+                  iter->GetTx().GetHash().ToString());\n+    }\n+}\n \n+void BlockAssembler::addScoreTxs()\n+{\n+    std::priority_queue<CTxMemPool::txiter, std::vector<CTxMemPool::txiter>, ScoreCompare> clearedTxs;\n+    CTxMemPool::setEntries waitSet;\n+    CTxMemPool::indexed_transaction_set::index<mining_score>::type::iterator mi = mempool.mapTx.get<mining_score>().begin();\n+    CTxMemPool::txiter iter;\n+    while (!blockFinished && (mi != mempool.mapTx.get<mining_score>().end() || !clearedTxs.empty()))\n     {\n-        LOCK2(cs_main, mempool.cs);\n-        CBlockIndex* pindexPrev = chainActive.Tip();\n-        const int nHeight = pindexPrev->nHeight + 1;\n-        pblock->nTime = GetAdjustedTime();\n-        const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n-\n-        pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n-        // -regtest only: allow overriding block.nVersion with\n-        // -blockversion=N to test forking scenarios\n-        if (chainparams.MineBlocksOnDemand())\n-            pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n-\n-        int64_t nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n-                                ? nMedianTimePast\n-                                : pblock->GetBlockTime();\n-\n-        bool fPriorityBlock = nBlockPrioritySize > 0;\n-        if (fPriorityBlock) {\n-            vecPriority.reserve(mempool.mapTx.size());\n-            for (CTxMemPool::indexed_transaction_set::iterator mi = mempool.mapTx.begin();\n-                 mi != mempool.mapTx.end(); ++mi)\n-            {\n-                double dPriority = mi->GetPriority(nHeight);\n-                CAmount dummy;\n-                mempool.ApplyDeltas(mi->GetTx().GetHash(), dPriority, dummy);\n-                vecPriority.push_back(TxCoinAgePriority(dPriority, mi));\n-            }\n-            std::make_heap(vecPriority.begin(), vecPriority.end(), pricomparer);\n+        // If no txs that were previously postponed are available to try\n+        // again, then try the next highest score tx\n+        if (clearedTxs.empty()) {\n+            iter = mempool.mapTx.project<0>(mi);\n+            mi++;\n+        }\n+        // If a previously postponed tx is available to try again, then it\n+        // has higher score than all untried so far txs\n+        else {\n+            iter = clearedTxs.top();\n+            clearedTxs.pop();\n         }\n \n-        CTxMemPool::indexed_transaction_set::index<mining_score>::type::iterator mi = mempool.mapTx.get<mining_score>().begin();\n-        CTxMemPool::txiter iter;\n-\n-        while (mi != mempool.mapTx.get<mining_score>().end() || !clearedTxs.empty())\n-        {\n-            bool priorityTx = false;\n-            if (fPriorityBlock && !vecPriority.empty()) { // add a tx from priority queue to fill the blockprioritysize\n-                priorityTx = true;\n-                iter = vecPriority.front().second;\n-                actualPriority = vecPriority.front().first;\n-                std::pop_heap(vecPriority.begin(), vecPriority.end(), pricomparer);\n-                vecPriority.pop_back();\n-            }\n-            else if (clearedTxs.empty()) { // add tx with next highest score\n-                iter = mempool.mapTx.project<0>(mi);\n-                mi++;\n-            }\n-            else {  // try to add a previously postponed child tx\n-                iter = clearedTxs.top();\n-                clearedTxs.pop();\n-            }\n+        // If tx already in block, skip  (added by addPriorityTxs)\n+        if (inBlock.count(iter)) {\n+            continue;\n+        }\n+\n+        // If tx is dependent on other mempool txs which haven't yet been included\n+        // then put it in the waitSet\n+        if (isStillDependent(iter)) {\n+            waitSet.insert(iter);\n+            continue;\n+        }\n \n-            if (inBlock.count(iter))\n-                continue; // could have been added to the priorityBlock\n+        // If the fee rate is below the min fee rate for mining, then we're done\n+        // adding txs based on score (fee rate)\n+        if (iter->GetModifiedFee() < ::minRelayTxFee.GetFee(iter->GetTxSize()) && nBlockSize >= nBlockMinSize) {\n+            return;\n+        }\n \n-            const CTransaction& tx = iter->GetTx();\n+        // If this tx fits in the block add it, otherwise keep looping\n+        if (TestForBlock(iter)) {\n+            AddToBlock(iter);\n \n-            bool fOrphan = false;\n-            BOOST_FOREACH(CTxMemPool::txiter parent, mempool.GetMemPoolParents(iter))\n+            // This tx was successfully added, so\n+            // add transactions that depend on this one to the priority queue to try again\n+            BOOST_FOREACH(CTxMemPool::txiter child, mempool.GetMemPoolChildren(iter))\n             {\n-                if (!inBlock.count(parent)) {\n-                    fOrphan = true;\n-                    break;\n+                if (waitSet.count(child)) {\n+                    clearedTxs.push(child);\n+                    waitSet.erase(child);\n                 }\n             }\n-            if (fOrphan) {\n-                if (priorityTx)\n-                    waitPriMap.insert(std::make_pair(iter,actualPriority));\n-                else\n-                    waitSet.insert(iter);\n-                continue;\n-            }\n+        }\n+    }\n+}\n \n-            unsigned int nTxSize = iter->GetTxSize();\n-            if (fPriorityBlock &&\n-                (nBlockSize + nTxSize >= nBlockPrioritySize || !AllowFree(actualPriority))) {\n-                fPriorityBlock = false;\n-                waitPriMap.clear();\n-            }\n-            if (!priorityTx &&\n-                (iter->GetModifiedFee() < ::minRelayTxFee.GetFee(nTxSize) && nBlockSize >= nBlockMinSize)) {\n-                break;\n-            }\n-            if (nBlockSize + nTxSize >= nBlockMaxSize) {\n-                if (nBlockSize >  nBlockMaxSize - 100 || lastFewTxs > 50) {\n-                    break;\n-                }\n-                // Once we're within 1000 bytes of a full block, only look at 50 more txs\n-                // to try to fill the remaining space.\n-                if (nBlockSize > nBlockMaxSize - 1000) {\n-                    lastFewTxs++;\n-                }\n-                continue;\n-            }\n+void BlockAssembler::addPriorityTxs()\n+{\n+    // How much of the block should be dedicated to high-priority transactions,\n+    // included regardless of the fees they pay\n+    unsigned int nBlockPrioritySize = GetArg(\"-blockprioritysize\", DEFAULT_BLOCK_PRIORITY_SIZE);\n+    nBlockPrioritySize = std::min(nBlockMaxSize, nBlockPrioritySize);\n \n-            if (!IsFinalTx(tx, nHeight, nLockTimeCutoff))\n-                continue;\n+    if (nBlockPrioritySize == 0) {\n+        return;\n+    }\n \n-            unsigned int nTxSigOps = iter->GetSigOpCount();\n-            if (nBlockSigOps + nTxSigOps >= MAX_BLOCK_SIGOPS) {\n-                if (nBlockSigOps > MAX_BLOCK_SIGOPS - 2) {\n-                    break;\n-                }\n-                continue;\n-            }\n+    // This vector will be sorted into a priority queue:\n+    vector<TxCoinAgePriority> vecPriority;\n+    TxCoinAgePriorityCompare pricomparer;\n+    std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash> waitPriMap;\n+    typedef std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash>::iterator waitPriIter;\n+    double actualPriority = -1;\n \n-            CAmount nTxFees = iter->GetFee();\n-            // Added\n-            pblock->vtx.push_back(tx);\n-            pblocktemplate->vTxFees.push_back(nTxFees);\n-            pblocktemplate->vTxSigOps.push_back(nTxSigOps);\n-            nBlockSize += nTxSize;\n-            ++nBlockTx;\n-            nBlockSigOps += nTxSigOps;\n-            nFees += nTxFees;\n-\n-            if (fPrintPriority)\n-            {\n-                double dPriority = iter->GetPriority(nHeight);\n-                CAmount dummy;\n-                mempool.ApplyDeltas(tx.GetHash(), dPriority, dummy);\n-                LogPrintf(\"priority %.1f fee %s txid %s\\n\",\n-                          dPriority , CFeeRate(iter->GetModifiedFee(), nTxSize).ToString(), tx.GetHash().ToString());\n-            }\n+    vecPriority.reserve(mempool.mapTx.size());\n+    for (CTxMemPool::indexed_transaction_set::iterator mi = mempool.mapTx.begin();\n+         mi != mempool.mapTx.end(); ++mi)\n+    {\n+        double dPriority = mi->GetPriority(nHeight);\n+        CAmount dummy;\n+        mempool.ApplyDeltas(mi->GetTx().GetHash(), dPriority, dummy);\n+        vecPriority.push_back(TxCoinAgePriority(dPriority, mi));\n+    }\n+    std::make_heap(vecPriority.begin(), vecPriority.end(), pricomparer);",
      "path": "src/miner.cpp",
      "position": 407,
      "original_position": 407,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Unless there is a reason I am missing, it would be good to refactor this to use std::priority_queue like addScoreTxs for consistency. (std::priority_queue is also safer to use for preserving heap invariants)\n",
      "created_at": "2016-06-14T15:45:53Z",
      "updated_at": "2016-06-14T15:46:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r66997894",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/66997894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 327,
      "original_line": null,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/67006098",
      "pull_request_review_id": null,
      "id": 67006098,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MDA2MDk4",
      "diff_hunk": "@@ -71,231 +71,304 @@ int64_t UpdateTime(CBlockHeader* pblock, const Consensus::Params& consensusParam\n     return nNewTime - nOldTime;\n }\n \n-CBlockTemplate* CreateNewBlock(const CChainParams& chainparams, const CScript& scriptPubKeyIn)\n+BlockAssembler::BlockAssembler(const CChainParams& _chainparams)\n+    : chainparams(_chainparams)\n {\n-    // Create new block\n-    std::unique_ptr<CBlockTemplate> pblocktemplate(new CBlockTemplate());\n+    // Largest block you're willing to create:\n+    nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n+    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n+    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+\n+    // Minimum block size you want to create; block will be filled with free transactions\n+    // until there are no more or the block reaches this size:\n+    nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n+    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+}\n+\n+void BlockAssembler::resetBlock()\n+{\n+    inBlock.clear();\n+\n+    // Reserve space for coinbase tx\n+    nBlockSize = 1000;\n+    nBlockSigOps = 100;\n+\n+    // These counters do not include coinbase tx\n+    nBlockTx = 0;\n+    nFees = 0;\n+\n+    lastFewTxs = 0;\n+    blockFinished = false;\n+}\n+\n+CBlockTemplate* BlockAssembler::CreateNewBlock(const CScript& scriptPubKeyIn)\n+{\n+    resetBlock();\n+\n+    pblocktemplate.reset(new CBlockTemplate());\n+\n     if(!pblocktemplate.get())\n         return NULL;\n-    CBlock *pblock = &pblocktemplate->block; // pointer for convenience\n-\n-    // Create coinbase tx\n-    CMutableTransaction txNew;\n-    txNew.vin.resize(1);\n-    txNew.vin[0].prevout.SetNull();\n-    txNew.vout.resize(1);\n-    txNew.vout[0].scriptPubKey = scriptPubKeyIn;\n+    pblock = &pblocktemplate->block; // pointer for convenience\n \n     // Add dummy coinbase tx as first transaction\n     pblock->vtx.push_back(CTransaction());\n     pblocktemplate->vTxFees.push_back(-1); // updated at end\n     pblocktemplate->vTxSigOps.push_back(-1); // updated at end\n \n-    // Largest block you're willing to create:\n-    unsigned int nBlockMaxSize = GetArg(\"-blockmaxsize\", DEFAULT_BLOCK_MAX_SIZE);\n-    // Limit to between 1K and MAX_BLOCK_SIZE-1K for sanity:\n-    nBlockMaxSize = std::max((unsigned int)1000, std::min((unsigned int)(MAX_BLOCK_SIZE-1000), nBlockMaxSize));\n+    LOCK2(cs_main, mempool.cs);\n+    CBlockIndex* pindexPrev = chainActive.Tip();\n+    nHeight = pindexPrev->nHeight + 1;\n+\n+    pblock->nVersion = ComputeBlockVersion(pindexPrev, chainparams.GetConsensus());\n+    // -regtest only: allow overriding block.nVersion with\n+    // -blockversion=N to test forking scenarios\n+    if (chainparams.MineBlocksOnDemand())\n+        pblock->nVersion = GetArg(\"-blockversion\", pblock->nVersion);\n+\n+    pblock->nTime = GetAdjustedTime();\n+    const int64_t nMedianTimePast = pindexPrev->GetMedianTimePast();\n+\n+    nLockTimeCutoff = (STANDARD_LOCKTIME_VERIFY_FLAGS & LOCKTIME_MEDIAN_TIME_PAST)\n+                       ? nMedianTimePast\n+                       : pblock->GetBlockTime();\n+\n+    addPriorityTxs();\n+    addScoreTxs();\n+\n+    nLastBlockTx = nBlockTx;\n+    nLastBlockSize = nBlockSize;\n+    LogPrintf(\"CreateNewBlock(): total size %u txs: %u fees: %ld sigops %d\\n\", nBlockSize, nBlockTx, nFees, nBlockSigOps);\n+\n+    // Create coinbase transaction.\n+    CMutableTransaction coinbaseTx;\n+    coinbaseTx.vin.resize(1);\n+    coinbaseTx.vin[0].prevout.SetNull();\n+    coinbaseTx.vout.resize(1);\n+    coinbaseTx.vout[0].scriptPubKey = scriptPubKeyIn;\n+    coinbaseTx.vout[0].nValue = nFees + GetBlockSubsidy(nHeight, chainparams.GetConsensus());\n+    coinbaseTx.vin[0].scriptSig = CScript() << nHeight << OP_0;\n+    pblock->vtx[0] = coinbaseTx;\n+    pblocktemplate->vTxFees[0] = -nFees;\n+\n+    // Fill in header\n+    pblock->hashPrevBlock  = pindexPrev->GetBlockHash();\n+    UpdateTime(pblock, chainparams.GetConsensus(), pindexPrev);\n+    pblock->nBits          = GetNextWorkRequired(pindexPrev, pblock, chainparams.GetConsensus());\n+    pblock->nNonce         = 0;\n+    pblocktemplate->vTxSigOps[0] = GetLegacySigOpCount(pblock->vtx[0]);\n+\n+    CValidationState state;\n+    if (!TestBlockValidity(state, chainparams, *pblock, pindexPrev, false, false)) {\n+        throw std::runtime_error(strprintf(\"%s: TestBlockValidity failed: %s\", __func__, FormatStateMessage(state)));\n+    }\n \n-    // How much of the block should be dedicated to high-priority transactions,\n-    // included regardless of the fees they pay\n-    unsigned int nBlockPrioritySize = GetArg(\"-blockprioritysize\", DEFAULT_BLOCK_PRIORITY_SIZE);\n-    nBlockPrioritySize = std::min(nBlockMaxSize, nBlockPrioritySize);\n+    return pblocktemplate.release();\n+}\n \n-    // Minimum block size you want to create; block will be filled with free transactions\n-    // until there are no more or the block reaches this size:\n-    unsigned int nBlockMinSize = GetArg(\"-blockminsize\", DEFAULT_BLOCK_MIN_SIZE);\n-    nBlockMinSize = std::min(nBlockMaxSize, nBlockMinSize);\n+bool BlockAssembler::isStillDependent(CTxMemPool::txiter iter)\n+{\n+    BOOST_FOREACH(CTxMemPool::txiter parent, mempool.GetMemPoolParents(iter))\n+    {\n+        if (!inBlock.count(parent)) {\n+            return true;\n+        }\n+    }\n+    return false;\n+}\n \n-    // Collect memory pool transactions into the block\n-    CTxMemPool::setEntries inBlock;\n-    CTxMemPool::setEntries waitSet;\n \n-    // This vector will be sorted into a priority queue:\n-    vector<TxCoinAgePriority> vecPriority;\n-    TxCoinAgePriorityCompare pricomparer;\n-    std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash> waitPriMap;\n-    typedef std::map<CTxMemPool::txiter, double, CTxMemPool::CompareIteratorByHash>::iterator waitPriIter;\n-    double actualPriority = -1;\n \n-    std::priority_queue<CTxMemPool::txiter, std::vector<CTxMemPool::txiter>, ScoreCompare> clearedTxs;\n+bool BlockAssembler::TestForBlock(CTxMemPool::txiter iter)\n+{\n+    if (nBlockSize + iter->GetTxSize() >= nBlockMaxSize) {\n+        // If the block is so close to full that no more txs will fit\n+        // or if we've tried more than 50 times to fill remaining space\n+        // then flag that the block is finished\n+        if (nBlockSize >  nBlockMaxSize - 100 || lastFewTxs > 50) {\n+             blockFinished = true;\n+             return false;\n+        }\n+        // Once we're within 1000 bytes of a full block, only look at 50 more txs\n+        // to try to fill the remaining space.\n+        if (nBlockSize > nBlockMaxSize - 1000) {\n+            lastFewTxs++;\n+        }\n+        return false;\n+    }\n+\n+    if (nBlockSigOps + iter->GetSigOpCount() >= MAX_BLOCK_SIGOPS) {\n+        // If the block has room for no more sig ops then\n+        // flag that the block is finished\n+        if (nBlockSigOps > MAX_BLOCK_SIGOPS - 2) {\n+            blockFinished = true;\n+            return false;\n+        }\n+        // Otherwise attempt to find another tx with fewer sigops\n+        // to put in the block.\n+        return false;\n+    }\n+\n+    // Must check that lock times are still valid\n+    // This can be removed once MTP is always enforced\n+    // as long as reorgs keep the mempool consistent.\n+    if (!IsFinalTx(iter->GetTx(), nHeight, nLockTimeCutoff))\n+        return false;\n+\n+    return true;\n+}\n+\n+void BlockAssembler::AddToBlock(CTxMemPool::txiter iter)\n+{\n+    pblock->vtx.push_back(iter->GetTx());\n+    pblocktemplate->vTxFees.push_back(iter->GetFee());\n+    pblocktemplate->vTxSigOps.push_back(iter->GetSigOpCount());\n+    nBlockSize += iter->GetTxSize();\n+    ++nBlockTx;\n+    nBlockSigOps += iter->GetSigOpCount();\n+    nFees += iter->GetFee();\n+    inBlock.insert(iter);\n+\n     bool fPrintPriority = GetBoolArg(\"-printpriority\", DEFAULT_PRINTPRIORITY);\n-    uint64_t nBlockSize = 1000;\n-    uint64_t nBlockTx = 0;\n-    unsigned int nBlockSigOps = 100;\n-    int lastFewTxs = 0;\n-    CAmount nFees = 0;\n+    if (fPrintPriority) {\n+        double dPriority = iter->GetPriority(nHeight);\n+        CAmount dummy;\n+        mempool.ApplyDeltas(iter->GetTx().GetHash(), dPriority, dummy);\n+        LogPrintf(\"priority %.1f fee %s txid %s\\n\",\n+                  dPriority,\n+                  CFeeRate(iter->GetModifiedFee(), iter->GetTxSize()).ToString(),\n+                  iter->GetTx().GetHash().ToString());\n+    }\n+}\n \n+void BlockAssembler::addScoreTxs()\n+{\n+    std::priority_queue<CTxMemPool::txiter, std::vector<CTxMemPool::txiter>, ScoreCompare> clearedTxs;\n+    CTxMemPool::setEntries waitSet;\n+    CTxMemPool::indexed_transaction_set::index<mining_score>::type::iterator mi = mempool.mapTx.get<mining_score>().begin();\n+    CTxMemPool::txiter iter;\n+    while (!blockFinished && (mi != mempool.mapTx.get<mining_score>().end() || !clearedTxs.empty()))",
      "path": "src/miner.cpp",
      "position": 218,
      "original_position": 218,
      "commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "original_commit_id": "c2dd5a3c39156749e8ee24772d1fcb01404f2b6f",
      "in_reply_to_id": null,
      "user": {
        "login": "JeremyRubin",
        "id": 886523,
        "node_id": "MDQ6VXNlcjg4NjUyMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JeremyRubin",
        "html_url": "https://github.com/JeremyRubin",
        "followers_url": "https://api.github.com/users/JeremyRubin/followers",
        "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
        "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
        "repos_url": "https://api.github.com/users/JeremyRubin/repos",
        "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: could be `!(blockFinished || (mi == mempool.mapTx.get<mining_score>().end() && clearedTxs.empty()))` via demorgan's which is (maybe?) a bit easier to read.\n",
      "created_at": "2016-06-14T16:30:06Z",
      "updated_at": "2016-06-14T16:30:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/7598#discussion_r67006098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/67006098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/7598"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 250,
      "original_line": null,
      "side": "RIGHT"
    }
  ]
}
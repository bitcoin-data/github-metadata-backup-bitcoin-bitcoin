{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378",
    "id": 2488959348,
    "node_id": "PR_kwDOABII586UWoF0",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32378",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32378.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32378.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/31e3808df9c59d36a07cad07df89ae1bf9e63000",
    "number": 32378,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "interfaces: refactor: move `Mining` and `BlockTemplate`  implementation to miner",
    "user": {
      "login": "ismaelsadeeq",
      "id": 48946461,
      "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ismaelsadeeq",
      "html_url": "https://github.com/ismaelsadeeq",
      "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
      "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
      "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
      "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
      "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "#### Motivation\r\n\r\nIn  [Internal interface guidelines](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#internal-interface-guidelines)\r\n\r\nIt's stated that \r\n\r\n> Interface method definitions should wrap existing functionality instead of implementing new functionality. Any substantial new node or wallet functionality should be implemented in [src/node/](https://github.com/bitcoin/bitcoin/blob/master/src/node) or [src/wallet/](https://github.com/bitcoin/bitcoin/blob/master/src/wallet) and just exposed in [src/interfaces/](https://github.com/bitcoin/bitcoin/blob/master/src/interfaces) instead of being implemented there, so it can be more modular and accessible to unit tests.\r\n\r\nHowever the some methods in the newly added  `BlockTemplateImpl` and `MinerImpl`  classes partially enforces this guideline, as the implementations of the `submitSolution`, `waitNext`, and `waitTipChanged` methods reside within the class itself.\r\n\r\n#### What the PR Does\r\n\r\nThis PR introduces a simple refactor by moving certain method implementations from `BlockTemplateImpl` into the miner module. It introduces three new functions:\r\n\r\n1. **`AddMerkleRootAndCoinbase`**: Computes the block's Merkle root, inserts the coinbase transaction, and sets the Merkle root in the block. This function is called by `submitSolution` before the block is submitted for processing.\r\n\r\n2. **`WaitAndCreateNewBlock`**: Returns a new block template either when transaction fees reach a certain threshold or when a new tip is detected. If a timeout is reached, it returns `nullptr`. The `waitNext` method in `BlockTemplateImpl` now simply wraps this function.\r\n\r\n3. **`WaitTipChanged`**: Returns the tip when the chain it changes, or `nullopt` if a timeout or interrupt occurs. The `waitTipChanged` method in `MinerImpl` now calls `GetTip` after invoking `ChainTipChanged`, and returns the tip.\r\n\r\n#### Behavior Change\r\n\r\n- We now only `Assert` for  a valid chainman and notifications pointer once.\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "labels": [
      {
        "id": 2260068353,
        "node_id": "MDU6TGFiZWwyMjYwMDY4MzUz",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/interfaces",
        "name": "interfaces",
        "description": "",
        "color": "83c9fc",
        "default": false
      }
    ],
    "created_at": "2025-04-29T13:48:42Z",
    "updated_at": "2025-05-13T12:33:54Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "01ff6b9113a96d62cf36ba50d2c18c8376231635",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "ismaelsadeeq:04-2025-refactor-mining-interface",
      "ref": "04-2025-refactor-mining-interface",
      "sha": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 577730599,
        "node_id": "R_kgDOIm94Jw",
        "name": "bitcoin",
        "full_name": "ismaelsadeeq/bitcoin",
        "owner": {
          "login": "ismaelsadeeq",
          "id": 48946461,
          "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
          "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ismaelsadeeq",
          "html_url": "https://github.com/ismaelsadeeq",
          "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
          "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
          "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
          "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
          "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/ismaelsadeeq/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ismaelsadeeq/bitcoin",
        "archive_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ismaelsadeeq/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ismaelsadeeq/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ismaelsadeeq/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/hooks",
        "svn_url": "https://github.com/ismaelsadeeq/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 276284,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-09T18:06:58Z",
        "created_at": "2022-12-13T11:54:34Z",
        "updated_at": "2023-03-10T09:46:26Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "9a05b45da60d214cb1e5a50c3d2293b1defc9bb0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37209,
        "stargazers_count": 83542,
        "watchers_count": 83542,
        "size": 281622,
        "default_branch": "master",
        "open_issues_count": 722,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-13T11:34:39Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-05-13T11:34:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 150,
    "deletions": 128,
    "changed_files": 3,
    "commits": 3,
    "review_comments": 11,
    "comments": 4
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQzZjRlNjRkNDE2YWEyOWQ0NDQ4ZGZmYjRkNDdlNTI5OTdiNDAyNzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d3f4e64d416aa29d4448dffb4d47e52997b40271",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d3f4e64d416aa29d4448dffb4d47e52997b40271",
      "tree": {
        "sha": "0c5cc1d4b0ff8ee2da535feb4921903692a1d1b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0c5cc1d4b0ff8ee2da535feb4921903692a1d1b9"
      },
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "payload": "tree 0c5cc1d4b0ff8ee2da535feb4921903692a1d1b9\nparent de90b47ea09826d52043f4ce40c734847187c075\nauthor ismaelsadeeq <ask4ismailsadiq@gmail.com> 1745856050 +0100\ncommitter ismaelsadeeq <ask4ismailsadiq@gmail.com> 1745920320 +0100\n\ninterfaces: refactor: move `submitSolution` implementation to miner\n\n- Create a new function `AddMerkleRootAndCoinbase` that compute the\n  block's merkle root, insert the coinbase transaction and the merkle\n  root into the block.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTp92/X8LZmU6fYk5kOOQjzZJiYiAUCaBChSgAKCRAOOQjzZJiY\niMjFAQDGCRXppXc5sUTKilIA/xlyf3e1vDTbwikP/nUfU4EaHwD/fkVGe7hxNAHZ\nQvTfXH65Kl8a709HL/OesNYG3tEUuAI=\n=RYdY\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/de90b47ea09826d52043f4ce40c734847187c075",
          "sha": "de90b47ea09826d52043f4ce40c734847187c075",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/de90b47ea09826d52043f4ce40c734847187c075"
        }
      ],
      "message": "interfaces: refactor: move `submitSolution` implementation to miner\n\n- Create a new function `AddMerkleRootAndCoinbase` that compute the\n  block's merkle root, insert the coinbase transaction and the merkle\n  root into the block.",
      "committer": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-04-29T09:52:00Z"
      },
      "author": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-04-28T16:00:50Z"
      },
      "sha": "d3f4e64d416aa29d4448dffb4d47e52997b40271"
    },
    {
      "event": "commented",
      "id": 2839000864,
      "node_id": "IC_kwDOABII586pN7cg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2839000864",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T13:48:46Z",
      "updated_at": "2025-05-13T12:32:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32378.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/32378#pullrequestreview-2836498591) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/32378#pullrequestreview-2826281937) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\nPossible typos and grammar issues:\n\n- `+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`).` -> `+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). */` [Missing comment block closing `*/`, causing subsequent code to be commented out incorrectly]\n- `+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`).` -> `+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). */` [Missing comment block closing `*/`, causing subsequent code to be commented out incorrectly]\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#issuecomment-2839000864",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378"
    },
    {
      "event": "labeled",
      "id": 17456005259,
      "node_id": "LE_lADOABII5860gjrLzwAAAAQQdYCL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17456005259",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T13:48:57Z",
      "label": {
        "name": "interfaces",
        "color": "83c9fc"
      }
    },
    {
      "event": "renamed",
      "id": 17456054945,
      "node_id": "RTE_lADOABII5860gjrLzwAAAAQQdkKh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17456054945",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T13:50:59Z",
      "rename": {
        "from": "interfaces: move `Mining` and `BlockTemplate`  implementation to miner",
        "to": "interfaces: refactor: move `Mining` and `BlockTemplate`  implementation to miner"
      }
    },
    {
      "event": "reviewed",
      "id": 2804058013,
      "node_id": "PRR_kwDOABII586nIoed",
      "url": null,
      "actor": null,
      "commit_id": "a5145ba0fc3339392ff71bf20613812e0d8c8efc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#pullrequestreview-2804058013",
      "submitted_at": "2025-04-29T15:09:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
    },
    {
      "event": "labeled",
      "id": 17457980993,
      "node_id": "LE_lADOABII5860gjrLzwAAAAQQk6ZB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17457980993",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T15:22:15Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2839327068,
      "node_id": "IC_kwDOABII586pPLFc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2839327068",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T15:22:17Z",
      "updated_at": "2025-04-29T15:22:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `tidy`: https://github.com/bitcoin/bitcoin/runs/41351512028</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failure was caused by clang-tidy generating errors due to an unused using-declaration in testnet4_miner_tests.cpp.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#issuecomment-2839327068",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17459195419,
      "node_id": "HRFPE_lADOABII5860gjrLzwAAAAQQpi4b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17459195419",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6",
      "commit_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/commits/c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6",
      "created_at": "2025-04-29T16:38:57Z"
    },
    {
      "event": "commented",
      "id": 2839569970,
      "node_id": "IC_kwDOABII586pQGYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2839569970",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T16:47:48Z",
      "updated_at": "2025-04-29T16:47:48Z",
      "author_association": "MEMBER",
      "body": "- Updated to fix recent comment by @ryanofsky  see [5fa54e2..c8a3fab](https://github.com/bitcoin/bitcoin/compare/77949ef5267e4de4e68a19560bab81e8d5fa54e2..c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6)\r\n\r\n- Also fixed tidy issues",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#issuecomment-2839569970",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378"
    },
    {
      "event": "mentioned",
      "id": 17459320045,
      "node_id": "MEE_lADOABII5860gjrLzwAAAAQQqBTt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17459320045",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T16:47:49Z"
    },
    {
      "event": "subscribed",
      "id": 17459320067,
      "node_id": "SE_lADOABII5860gjrLzwAAAAQQqBUD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17459320067",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T16:47:49Z"
    },
    {
      "event": "unlabeled",
      "id": 17460268566,
      "node_id": "UNLE_lADOABII5860gjrLzwAAAAQQto4W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17460268566",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-29T17:59:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2826281937,
      "node_id": "PRR_kwDOABII586odaPR",
      "url": null,
      "actor": null,
      "commit_id": "c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6\r\n\r\nThanks for the cleanup! This change should make the node interfaces.cpp more managable and organize code better. I left some suggestions for renames and API tweaks but they are not very important.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#pullrequestreview-2826281937",
      "submitted_at": "2025-05-08T20:55:49Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ5Nzk5NmMzZTU3MmM4OTkyZDM0ZTU0ZmQxM2Q5Mjk4NGU5ZWMyMWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/497996c3e572c8992d34e54fd13d92984e9ec21c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/497996c3e572c8992d34e54fd13d92984e9ec21c",
      "tree": {
        "sha": "ee8ec6359d6e1af7d9fad9189eb39b59d605f8a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee8ec6359d6e1af7d9fad9189eb39b59d605f8a4"
      },
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "payload": "tree ee8ec6359d6e1af7d9fad9189eb39b59d605f8a4\nparent d3f4e64d416aa29d4448dffb4d47e52997b40271\nauthor ismaelsadeeq <ask4ismailsadiq@gmail.com> 1745859220 +0100\ncommitter ismaelsadeeq <ask4ismailsadiq@gmail.com> 1746807087 +0100\n\ninterfaces: refactor: move `waitNext` implementation to miner\n\n- We now assert for a valid chainman and notifications once when\n invoking WaitAndCreateNewBlock function.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTp92/X8LZmU6fYk5kOOQjzZJiYiAUCaB4pLwAKCRAOOQjzZJiY\niF6sAQCdADTHrXaJktyNbYARptdW9aOv0k5SuPQiS/BOgH2jAwEAm0HoqN6Grtjb\nLJj2jXd1OPaDDsq+Aon9OGyW1RxlZwo=\n=XMK3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d3f4e64d416aa29d4448dffb4d47e52997b40271",
          "sha": "d3f4e64d416aa29d4448dffb4d47e52997b40271",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d3f4e64d416aa29d4448dffb4d47e52997b40271"
        }
      ],
      "message": "interfaces: refactor: move `waitNext` implementation to miner\n\n- We now assert for a valid chainman and notifications once when\n invoking WaitAndCreateNewBlock function.",
      "committer": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-05-09T16:11:27Z"
      },
      "author": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-04-28T16:53:40Z"
      },
      "sha": "497996c3e572c8992d34e54fd13d92984e9ec21c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMxZTM4MDhkZjljNTlkMzZhMDdjYWQwN2RmODlhZTFiZjllNjMwMDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "tree": {
        "sha": "af8e33f3886cdcf0601dad09ed7d961b89cfb64d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/af8e33f3886cdcf0601dad09ed7d961b89cfb64d"
      },
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "payload": "tree af8e33f3886cdcf0601dad09ed7d961b89cfb64d\nparent 497996c3e572c8992d34e54fd13d92984e9ec21c\nauthor ismaelsadeeq <ask4ismailsadiq@gmail.com> 1745927663 +0100\ncommitter ismaelsadeeq <ask4ismailsadiq@gmail.com> 1746807780 +0100\n\ninterfaces: refactor: move `waitTipChanged` implementation to miner\n\n- This commit creates a function `WaitTipChanged` that waits for the connected\n  tip to change until timeout elapsed.\n\n- This function is now used by `waitTipChanged`\n\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTp92/X8LZmU6fYk5kOOQjzZJiYiAUCaB4r5QAKCRAOOQjzZJiY\niNM0AQCKIWbn8fCBeH1Os3vPYQswE38y6ik7G6ixor+1bfWZ3AEA2Nv/7PbpW0ui\nykQ1VmaFhxmSoHCImrBjyxTGd1BfYQw=\n=rlQx\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/497996c3e572c8992d34e54fd13d92984e9ec21c",
          "sha": "497996c3e572c8992d34e54fd13d92984e9ec21c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/497996c3e572c8992d34e54fd13d92984e9ec21c"
        }
      ],
      "message": "interfaces: refactor: move `waitTipChanged` implementation to miner\n\n- This commit creates a function `WaitTipChanged` that waits for the connected\n  tip to change until timeout elapsed.\n\n- This function is now used by `waitTipChanged`\n\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>",
      "committer": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-05-09T16:23:00Z"
      },
      "author": {
        "name": "ismaelsadeeq",
        "email": "ask4ismailsadiq@gmail.com",
        "date": "2025-04-29T11:54:23Z"
      },
      "sha": "31e3808df9c59d36a07cad07df89ae1bf9e63000"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17593952628,
      "node_id": "HRFPE_lADOABII5860gjrLzwAAAAQYrml0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17593952628",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "commit_url": "https://api.github.com/repos/ismaelsadeeq/bitcoin/commits/31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "created_at": "2025-05-09T16:34:37Z"
    },
    {
      "event": "commented",
      "id": 2867201958,
      "node_id": "IC_kwDOABII586q5gem",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2867201958",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-09T16:38:45Z",
      "updated_at": "2025-05-09T16:38:45Z",
      "author_association": "MEMBER",
      "body": "Forced pushed to address recent comments see [c8a3fabe..31e3808d](https://github.com/bitcoin/bitcoin/compare/c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6..31e3808df9c59d36a07cad07df89ae1bf9e63000)",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#issuecomment-2867201958",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32378"
    },
    {
      "event": "reviewed",
      "id": 2836498591,
      "node_id": "PRR_kwDOABII586pEYif",
      "url": null,
      "actor": null,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nMostly happy with 31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#pullrequestreview-2836498591",
      "submitted_at": "2025-05-13T12:32:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2066785147",
      "pull_request_review_id": 2804058013,
      "id": 2066785147,
      "node_id": "PRRC_kwDOABII5857MKN7",
      "diff_hunk": "@@ -446,4 +449,94 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\n     block.nNonce = nonce;\n     block.hashMerkleRoot = BlockMerkleRoot(block);\n }\n+\n+std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(NodeContext& node, const uint256& prev_block_hash, const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options)",
      "path": "src/node/miner.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "a5145ba0fc3339392ff71bf20613812e0d8c8efc",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"interfaces: refactor: move `waitNext` implementation to miner\" (a5145ba0fc3339392ff71bf20613812e0d8c8efc)\r\n\r\nThis change generally looks good, but I would suggest tweaking this commit and the next one to pass Chainman& and KernelNotification& parameters directly instead of NodeContext& because NodeContext exposes a lot of node state that this code shouldn't need access to and also brings in dependencies this code shouldn't need to depend on.",
      "created_at": "2025-04-29T15:09:53Z",
      "updated_at": "2025-04-29T15:09:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2066785147",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2066785147"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 453,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2066957921",
      "pull_request_review_id": 2804346372,
      "id": 2066957921,
      "node_id": "PRRC_kwDOABII5857M0Zh",
      "diff_hunk": "@@ -446,4 +449,94 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\n     block.nNonce = nonce;\n     block.hashMerkleRoot = BlockMerkleRoot(block);\n }\n+\n+std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(NodeContext& node, const uint256& prev_block_hash, const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options)",
      "path": "src/node/miner.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "a5145ba0fc3339392ff71bf20613812e0d8c8efc",
      "in_reply_to_id": 2066785147,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks for taking a look\r\nI've taken your suggestion with the addition of `CTxMemPool*` as a parameter to `WaitNext`.\r\nI think it's best to pass it as well, to make the method self contained and allow for testing with a custom mempool.\r\n\r\nAlso, if I use the mempool pointer in the active chainstate not the node, a miner test fails.\r\nThis happens because in `TestPackageSelection`, we construct a new mempool and update the node interfaces' mempool pointer, but we don't update the raw pointer stored in the active chainstate.\r\n",
      "created_at": "2025-04-29T16:45:48Z",
      "updated_at": "2025-04-29T16:45:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2066957921",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2066957921"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 453,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2080413780",
      "pull_request_review_id": 2826281937,
      "id": 2080413780,
      "node_id": "PRRC_kwDOABII5858AJhU",
      "diff_hunk": "@@ -232,6 +234,10 @@ void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& opti\n \n /* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */\n void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t version, uint32_t timestamp, uint32_t nonce);\n+\n+/* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n+std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,",
      "path": "src/node/miner.h",
      "position": null,
      "original_position": 15,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "d11db291d492785125dc0971ed8eaf0a4c981932",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"interfaces: refactor: move `waitNext` implementation to miner\" (d11db291d492785125dc0971ed8eaf0a4c981932)\r\n\r\nWould be better to return `std::unique_ptr<CBlockTemplate>` instead of `std::optional<std::unique_ptr<CBlockTemplate>>` here because unique_ptr is already nullable.\r\n\r\nAlso `node::WaitNext` is kind of a vague name. Maybe a name like `WaitAndCreateNewBlock` could be more descriptive. Or maybe something like `CreateNextBlock` or `CreateUpdatedBlock`. Could be other ideas.",
      "created_at": "2025-05-08T20:24:33Z",
      "updated_at": "2025-05-08T21:30:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2080413780",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2080413780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2080452135",
      "pull_request_review_id": 2826281937,
      "id": 2080452135,
      "node_id": "PRRC_kwDOABII5858AS4n",
      "diff_hunk": "@@ -238,6 +238,9 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\n /* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\n                                                         const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);\n+\n+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). */\n+bool ChainTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout);",
      "path": "src/node/miner.h",
      "position": null,
      "original_position": 6,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"interfaces: refactor: move `waitTipChanged` implementation to miner\" (c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6)\r\n\r\nI think name `ChainTipChanged` could be a little misleading since this returns a bool and you might think it returns true when the tip has changed, false otherwise. But in reality it returns true whether or not this tip has changed (after the timeout), and the only case it returns false is when the node is shutting down.\r\n\r\nTo be less confusing I think it would be good to rename this and return the actual tip instead of a bool. Could do:\r\n\r\n```diff\r\n```diff\r\n--- a/src/node/interfaces.cpp\r\n+++ b/src/node/interfaces.cpp\r\n@@ -974,7 +974,7 @@ public:\r\n \r\n     std::optional<BlockRef> waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\r\n     {\r\n-        if (ChainTipChanged(chainman(), notifications(), current_tip, timeout)) return getTip();\r\n+        if (WaitTipChanged(chainman(), notifications(), current_tip, timeout)) return getTip();\r\n         return {};\r\n     }\r\n \r\n--- a/src/node/miner.cpp\r\n+++ b/src/node/miner.cpp\r\n@@ -539,7 +539,7 @@ std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chain\r\n     return std::nullopt;\r\n }\r\n \r\n-bool ChainTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout)\r\n+std::optional<uint256> WaitTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout)\r\n {\r\n     Assume(timeout >= 0ms); // No internal callers should use a negative timeout\r\n     if (timeout < 0ms) timeout = 0ms;\r\n@@ -554,16 +554,14 @@ bool ChainTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_no\r\n         kernel_notifications.m_tip_block_cv.wait(lock, [&]() EXCLUSIVE_LOCKS_REQUIRED(kernel_notifications.m_tip_block_mutex) {\r\n             return kernel_notifications.TipBlock() || chainman.m_interrupt;\r\n         });\r\n-        if (chainman.m_interrupt) return false;\r\n+        if (chainman.m_interrupt) return {};\r\n         // At this point TipBlock is set, so continue to wait until it is\r\n         // different then `current_tip` provided by caller.\r\n         kernel_notifications.m_tip_block_cv.wait_until(lock, deadline, [&]() EXCLUSIVE_LOCKS_REQUIRED(kernel_notifications.m_tip_block_mutex) {\r\n             return Assume(kernel_notifications.TipBlock()) != current_tip || chainman.m_interrupt;\r\n         });\r\n+        if (chainman.m_interrupt) return {};\r\n+        return Assume(kernel_notifications.TipBlock());\r\n     }\r\n-\r\n-    if (chainman.m_interrupt) return false;\r\n-\r\n-    return true;\r\n }\r\n } // namespace node\r\n--- a/src/node/miner.h\r\n+++ b/src/node/miner.h\r\n@@ -239,8 +239,8 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\r\n std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\r\n                                                         const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);\r\n \r\n-/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). */\r\n-bool ChainTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout);\r\n+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). Returns the current tip hash, or nullopt if the node is shutting down. */\r\n+std::optional<uint256> WaitTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout);\r\n } // namespace node\r\n \r\n #endif // BITCOIN_NODE_MINER_H\r\n```\r\n\r\n\r\n\r\n",
      "created_at": "2025-05-08T20:54:00Z",
      "updated_at": "2025-05-08T20:55:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2080452135",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2080452135"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2082064876",
      "pull_request_review_id": 2829001691,
      "id": 2082064876,
      "node_id": "PRRC_kwDOABII5858Gcns",
      "diff_hunk": "@@ -232,6 +234,10 @@ void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& opti\n \n /* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */\n void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t version, uint32_t timestamp, uint32_t nonce);\n+\n+/* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n+std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,",
      "path": "src/node/miner.h",
      "position": null,
      "original_position": 15,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "d11db291d492785125dc0971ed8eaf0a4c981932",
      "in_reply_to_id": 2080413780,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Fixed",
      "created_at": "2025-05-09T16:37:03Z",
      "updated_at": "2025-05-09T16:37:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2082064876",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2082064876"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2082066284",
      "pull_request_review_id": 2829003862,
      "id": 2082066284,
      "node_id": "PRRC_kwDOABII5858Gc9s",
      "diff_hunk": "@@ -238,6 +238,9 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\n /* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n std::optional<std::unique_ptr<CBlockTemplate>> WaitNext(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\n                                                         const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);\n+\n+/* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`). */\n+bool ChainTipChanged(ChainstateManager& chainman, KernelNotifications& kernel_notifications, const uint256& current_tip, MillisecondsDouble& timeout);",
      "path": "src/node/miner.h",
      "position": null,
      "original_position": 6,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "c8a3fabe4090fa2b9a0e8cef73ed5365e8221ad6",
      "in_reply_to_id": 2080452135,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Taken, thanks",
      "created_at": "2025-05-09T16:37:19Z",
      "updated_at": "2025-05-09T16:37:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2082066284",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2082066284"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086664914",
      "pull_request_review_id": 2836498591,
      "id": 2086664914,
      "node_id": "PRRC_kwDOABII5858X_rS",
      "diff_hunk": "@@ -229,6 +229,9 @@ void RegenerateCommitments(CBlock& block, ChainstateManager& chainman);\n \n /** Apply -blockmintxfee and -blockmaxweight options from ArgsManager to BlockAssembler options. */\n void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& options);\n+\n+/* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */",
      "path": "src/node/miner.h",
      "position": 14,
      "original_position": 5,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "d3f4e64d416aa29d4448dffb4d47e52997b40271",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In d3f4e64d416aa29d4448dffb4d47e52997b40271 \"interfaces: refactor: move `submitSolution` implementation to miner\": maybe say \"insert or replace\"\r\n\r\nIt's unlikely for `vtx` to be empty, since we we add a coinbase during template creation.\r\n\r\nMore importantly, it's possible to call `submitSolution()` multiple times, with each call updating the coinbase. This could happen as a race condition or because the first solution was somehow incorrect.",
      "created_at": "2025-05-13T12:08:09Z",
      "updated_at": "2025-05-13T12:32:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2086664914",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086664914"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 235,
      "original_line": 233,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086672679",
      "pull_request_review_id": 2836498591,
      "id": 2086672679,
      "node_id": "PRRC_kwDOABII5858YBkn",
      "diff_hunk": "@@ -232,6 +234,10 @@ void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& opti\n \n /* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */\n void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t version, uint32_t timestamp, uint32_t nonce);\n+\n+/* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n+std::unique_ptr<CBlockTemplate> WaitAndCreateNewBlock(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\n+                                                      const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);",
      "path": "src/node/miner.h",
      "position": 19,
      "original_position": 16,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "497996c3e572c8992d34e54fd13d92984e9ec21c",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 497996c3e572c8992d34e54fd13d92984e9ec21c \"interfaces: refactor: move `waitNext` implementation to miner\" nit, a little less wide:\r\n\r\n```diff\r\ndiff --git a/src/node/miner.h b/src/node/miner.h\r\nindex e20cab0d08..04b12f065e 100644\r\n--- a/src/node/miner.h\r\n+++ b/src/node/miner.h\r\n@@ -235,9 +235,17 @@ void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& opti\r\n /* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */\r\n void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t version, uint32_t timestamp, uint32_t nonce);\r\n\r\n-/* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\r\n-std::unique_ptr<CBlockTemplate> WaitAndCreateNewBlock(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\r\n-                                                      const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);\r\n+/**\r\n+ * Return a new block template when fees rise to a certain threshold or after a\r\n+ * new tip; return nullopt if timeout is reached.\r\n+ */\r\n+std::unique_ptr<CBlockTemplate> WaitAndCreateNewBlock(ChainstateManager& chainman,\r\n+                                                      KernelNotifications& kernel_notifications,\r\n+                                                      CTxMemPool* mempool,\r\n+                                                      const uint256& prev_block_hash,\r\n+                                                      const std::vector<CAmount>& tx_fees,\r\n+                                                      const BlockWaitOptions& options,\r\n+                                                      const BlockAssembler::Options& assemble_options);\r\n\r\n /* Waits for the connected tip to change until timeout has elapsed. During node initialization, this will wait until the tip is connected (regardless of `timeout`).\r\n```",
      "created_at": "2025-05-13T12:12:43Z",
      "updated_at": "2025-05-13T12:32:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2086672679",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086672679"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 240,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086689234",
      "pull_request_review_id": 2836498591,
      "id": 2086689234,
      "node_id": "PRRC_kwDOABII5858YFnS",
      "diff_hunk": "@@ -232,6 +234,10 @@ void ApplyArgsManOptions(const ArgsManager& gArgs, BlockAssembler::Options& opti\n \n /* Compute the block's merkle root, insert the coinbase transaction and the merkle root into the block */\n void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t version, uint32_t timestamp, uint32_t nonce);\n+\n+/* Return a new block template when fees rise to a certain threshold or after a new tip; return nullopt if timeout is reached. */\n+std::unique_ptr<CBlockTemplate> WaitAndCreateNewBlock(ChainstateManager& chainman, KernelNotifications& kernel_notifications, CTxMemPool* mempool, const uint256& prev_block_hash,\n+                                                      const std::vector<CAmount>& tx_fees, const BlockWaitOptions& options, const BlockAssembler::Options& assemble_options);",
      "path": "src/node/miner.h",
      "position": 19,
      "original_position": 16,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "497996c3e572c8992d34e54fd13d92984e9ec21c",
      "in_reply_to_id": 2086672679,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In the same commit, it's better to pass  you should pass the `CBlockTemplate` as an argument rather than `tx_fees`. With cluster mempool we might overhaul the way we do this fee calculation. Even without that, we might add a helper method to `CBlockTemplate` to get the total fees. In both cases I'd rather not have to change the function signature.\r\n\r\n(if you do this, you can also drop the `prev_block_hash` argument)",
      "created_at": "2025-05-13T12:21:55Z",
      "updated_at": "2025-05-13T12:32:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2086689234",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086689234"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 240,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086709335",
      "pull_request_review_id": 2836498591,
      "id": 2086709335,
      "node_id": "PRRC_kwDOABII5858YKhX",
      "diff_hunk": "@@ -974,32 +974,8 @@ class MinerImpl : public Mining\n \n     std::optional<BlockRef> waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n     {\n-        Assume(timeout >= 0ms); // No internal callers should use a negative timeout\n-        if (timeout < 0ms) timeout = 0ms;\n-        if (timeout > std::chrono::years{100}) timeout = std::chrono::years{100}; // Upper bound to avoid UB in std::chrono\n-        auto deadline{std::chrono::steady_clock::now() + timeout};\n-        {\n-            WAIT_LOCK(notifications().m_tip_block_mutex, lock);\n-            // For callers convenience, wait longer than the provided timeout\n-            // during startup for the tip to be non-null. That way this function\n-            // always returns valid tip information when possible and only\n-            // returns null when shutting down, not when timing out.\n-            notifications().m_tip_block_cv.wait(lock, [&]() EXCLUSIVE_LOCKS_REQUIRED(notifications().m_tip_block_mutex) {\n-                return notifications().TipBlock() || chainman().m_interrupt;\n-            });\n-            if (chainman().m_interrupt) return {};\n-            // At this point TipBlock is set, so continue to wait until it is\n-            // different then `current_tip` provided by caller.\n-            notifications().m_tip_block_cv.wait_until(lock, deadline, [&]() EXCLUSIVE_LOCKS_REQUIRED(notifications().m_tip_block_mutex) {\n-                return Assume(notifications().TipBlock()) != current_tip || chainman().m_interrupt;\n-            });\n-        }\n-\n-        if (chainman().m_interrupt) return {};\n-\n-        // Must release m_tip_block_mutex before getTip() locks cs_main, to\n-        // avoid deadlocks.\n-        return getTip();\n+        if (WaitTipChanged(chainman(), notifications(), current_tip, timeout)) return getTip();",
      "path": "src/node/interfaces.cpp",
      "position": 30,
      "original_position": 30,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 31e3808df9c59d36a07cad07df89ae1bf9e63000 \"interfaces: refactor: move `waitTipChanged` implementation to miner\": this neatly solves the deadlock issue, but I think we should preserve that comment.\r\n\r\nAdditionally we should explain why `getTip()` is called here, ignoring the block hash returned by `WaitTipChanged`. Perhaps the latter should just return a boolean?",
      "created_at": "2025-05-13T12:31:48Z",
      "updated_at": "2025-05-13T12:32:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2086709335",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086709335"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 977,
      "original_line": 977,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086713176",
      "pull_request_review_id": 2836585389,
      "id": 2086713176,
      "node_id": "PRRC_kwDOABII5858YLdY",
      "diff_hunk": "@@ -974,32 +974,8 @@ class MinerImpl : public Mining\n \n     std::optional<BlockRef> waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n     {\n-        Assume(timeout >= 0ms); // No internal callers should use a negative timeout\n-        if (timeout < 0ms) timeout = 0ms;\n-        if (timeout > std::chrono::years{100}) timeout = std::chrono::years{100}; // Upper bound to avoid UB in std::chrono\n-        auto deadline{std::chrono::steady_clock::now() + timeout};\n-        {\n-            WAIT_LOCK(notifications().m_tip_block_mutex, lock);\n-            // For callers convenience, wait longer than the provided timeout\n-            // during startup for the tip to be non-null. That way this function\n-            // always returns valid tip information when possible and only\n-            // returns null when shutting down, not when timing out.\n-            notifications().m_tip_block_cv.wait(lock, [&]() EXCLUSIVE_LOCKS_REQUIRED(notifications().m_tip_block_mutex) {\n-                return notifications().TipBlock() || chainman().m_interrupt;\n-            });\n-            if (chainman().m_interrupt) return {};\n-            // At this point TipBlock is set, so continue to wait until it is\n-            // different then `current_tip` provided by caller.\n-            notifications().m_tip_block_cv.wait_until(lock, deadline, [&]() EXCLUSIVE_LOCKS_REQUIRED(notifications().m_tip_block_mutex) {\n-                return Assume(notifications().TipBlock()) != current_tip || chainman().m_interrupt;\n-            });\n-        }\n-\n-        if (chainman().m_interrupt) return {};\n-\n-        // Must release m_tip_block_mutex before getTip() locks cs_main, to\n-        // avoid deadlocks.\n-        return getTip();\n+        if (WaitTipChanged(chainman(), notifications(), current_tip, timeout)) return getTip();",
      "path": "src/node/interfaces.cpp",
      "position": 30,
      "original_position": 30,
      "commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "original_commit_id": "31e3808df9c59d36a07cad07df89ae1bf9e63000",
      "in_reply_to_id": 2086709335,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Regarding the latter, I see @ryanofsky's point: https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2080452135\r\n\r\nBut we should still explain why we ignore the result.",
      "created_at": "2025-05-13T12:33:54Z",
      "updated_at": "2025-05-13T12:33:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32378#discussion_r2086713176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2086713176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32378"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 977,
      "original_line": 977,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124",
    "id": 3119599294,
    "node_id": "PR_kwDOABII58658U6-",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34124",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34124.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34124.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b23d784b6baee140f75882fe009be5676db4cb0b",
    "number": 34124,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "refactor: make `CCoinsView` a purely virtual abstract base class",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Problem\r\n`CCoinsView` serves as the interface for the coins database layer, but historically had a dual nature that caused confusion:\r\n\r\n* It provided default noop implementations (returning `std::nullopt`, `uint256()`, `false`, `nullptr`) instead of being pure virtual\r\n* Callers could instantiate a bare `CCoinsView` and get silent no-op behavior\r\n* Mixing the interface definition with a built-in dummy implementation blurred the abstraction boundary\r\n\r\n### Context\r\n\r\nThis is part of ongoing coins caching cleanup efforts such as #34132, #33866, #33018, and #33512.\r\n\r\n### Fix\r\n\r\nThis PR makes `CCoinsView` a pure abstract interface and introduces an explicit noop implementation, in tiny incremental steps to ease review:\r\n\r\n* Add `CCoinsViewEmpty` as an explicit noop coins view for tests, benchmarks, and dummy backends\r\n* Replace all direct `CCoinsView` instantiations with `CCoinsViewEmpty`\r\n* Incrementally make all `CCoinsView` methods pure virtual (`GetCoin`, `GetBestBlock`, `BatchWrite`, `EstimateSize`, `Cursor`, `GetHeadBlocks`, `HaveCoin`)\r\n* Remove the legacy default implementations from `coins.cpp`\r\n* Update the coins view fuzzer to switch between a real database-backed view and `CCoinsViewEmpty`\r\n",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2025-12-20T08:47:33Z",
    "updated_at": "2025-12-30T23:34:50Z",
    "mergeable_state": "unknown",
    "merged": false,
    "merge_commit_sha": "acca97c4bba0871a3490f0e2fddc48606bd4300d",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "l0rinc:l0rinc/pure-virtual-CCoinsView",
      "ref": "l0rinc/pure-virtual-CCoinsView",
      "sha": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 281004,
        "default_branch": "master",
        "open_issues_count": 26,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-30T23:14:11Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-12-30T20:34:36Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2bcb3f64648ad27d4df10013b5bf0441124f1372",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38690,
        "stargazers_count": 87455,
        "watchers_count": 87455,
        "size": 301053,
        "default_branch": "master",
        "open_issues_count": 742,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-30T23:52:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-12-30T23:55:00Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 84,
    "deletions": 90,
    "changed_files": 15,
    "commits": 8,
    "review_comments": 19,
    "comments": 3
  },
  "events": [
    {
      "event": "labeled",
      "id": 21683616602,
      "node_id": "LE_lADOABII587fgV9xzwAAAAUMcbta",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21683616602",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T08:47:37Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "commented",
      "id": 3677609717,
      "node_id": "IC_kwDOABII587bM971",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3677609717",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T08:47:41Z",
      "updated_at": "2025-12-30T23:14:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34124.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [andrewtoth](https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3678038276), [ajtowns](https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3602578034), [sipa](https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3618585105) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34165](https://github.com/bitcoin/bitcoin/pull/34165) (coins: don't mutate main cache when connecting block by andrewtoth)\n* [#34125](https://github.com/bitcoin/bitcoin/pull/34125) (refactor: reuse `should_empty` for chainstate flush condition by l0rinc)\n* [#33866](https://github.com/bitcoin/bitcoin/pull/33866) (refactor: Let CCoinsViewCache::BatchWrite return void by sedited)\n* [#32840](https://github.com/bitcoin/bitcoin/pull/32840) (test: Enhance GetTxSigOpCost tests for coinbase transactions by average-gary)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n* [#29060](https://github.com/bitcoin/bitcoin/pull/29060) (Policy: Report debug message why inputs are non standard by ismaelsadeeq)\n* [#21283](https://github.com/bitcoin/bitcoin/pull/21283) (Implement BIP 370 PSBTv2 by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3677609717",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "commented",
      "id": 3678038276,
      "node_id": "IC_kwDOABII587bOmkE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678038276",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T19:02:06Z",
      "updated_at": "2025-12-20T19:02:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\n\nMakes sense to make an empty view explicit, and having the base class be purely virtual.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3678038276",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "renamed",
      "id": 21686184225,
      "node_id": "RTE_lADOABII587fgV9xzwAAAAUMmOkh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21686184225",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T19:16:47Z",
      "rename": {
        "from": "refactor: make `CCoinsView` a purely abstract base class",
        "to": "refactor: make `CCoinsView` a purely virtual abstract base class"
      }
    },
    {
      "event": "reviewed",
      "id": 3602578034,
      "node_id": "PRR_kwDOABII587Wuvpy",
      "url": null,
      "actor": null,
      "commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-22T04:23:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, this seemed better separated as an interface and a dummy implementation to me too.\r\n\r\nI think squashing all the commits after the first into a single commit would be better though.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3602578034",
      "submitted_at": "2025-12-22T04:23:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21713218511,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUONWvP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21713218511",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "created_at": "2025-12-22T21:19:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21769399409,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAURjqxx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21769399409",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/784769b5b1a8465d1a09ec489a303c4616d11896",
      "created_at": "2025-12-28T10:58:14Z"
    },
    {
      "event": "commented",
      "id": 3694658009,
      "node_id": "IC_kwDOABII587cOAHZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694658009",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T11:04:11Z",
      "updated_at": "2025-12-28T11:04:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "This change also revealed a potential UB in `MemPoolAccept` member init order. Since class members are constructed in [declaration order](https://en.cppreference.com/w/cpp/language/initializer_list.html#Initialization_order) (not initializer-list order), calls to a virtual method (having `m_view` depend on `m_dummy` but declared before it) can result in a virtual call through an uninitialized vptr and crash.\r\nSince the constructor didn't dereference `m_dummy` during `m_view` construction, the latent ordering hazard stayed dormant. This cleanup accidentally fixed it, but to make it explicit, I have extracted it to the first commit as a temporary fix.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3694658009",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "reviewed",
      "id": 3614915324,
      "node_id": "PRR_kwDOABII587Xdzr8",
      "url": null,
      "actor": null,
      "commit_id": "436765c23a009c18a2a8e29e8b9534924e80d1d0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T01:33:36Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3614915324",
      "submitted_at": "2025-12-29T01:33:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "reviewed",
      "id": 3615075843,
      "node_id": "PRR_kwDOABII587Xea4D",
      "url": null,
      "actor": null,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T05:39:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3615075843",
      "submitted_at": "2025-12-29T05:39:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "reviewed",
      "id": 3615082648,
      "node_id": "PRR_kwDOABII587XeciY",
      "url": null,
      "actor": null,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T05:46:39Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3615082648",
      "submitted_at": "2025-12-29T05:46:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVmNWZmOTc5ODA5OGE3Y2Y5YzUzMTFkYzU0YzYxNTI0NWZlYzFhM2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f5ff9798098a7cf9c5311dc54c615245fec1a3b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5f5ff9798098a7cf9c5311dc54c615245fec1a3b",
      "tree": {
        "sha": "e4c65a9af834cde79d86d1df573671a427738231",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e4c65a9af834cde79d86d1df573671a427738231"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e4c65a9af834cde79d86d1df573671a427738231\nparent 94ddc2dced5736612e358a3b80f2bc718fbd8161\nauthor Lőrinc <pap.lorinc@gmail.com> 1766917892 +0200\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767039335 +0100\n\nvalidation: fix `MemPoolAccept` member init order\n\n`MemPoolAccept` constructs `m_view` with a backend pointer to a `CCoinsView`.\nSince class members are constructed in declaration order (not initializer-list order), calls to a virtual method (having `m_view` declared before `m_dummy`) can result in a virtual call through an uninitialized vptr and crash.\n\nWithout the move:\n```\nThe following tests FAILED:\n        112 - txdownload_tests (SEGFAULT)\n        115 - txpackage_tests (SEGFAULT)\n        118 - txvalidation_tests (SEGFAULT)\n        119 - txvalidationcache_tests (SEGFAULT)\n        127 - validation_block_tests (SEGFAULT)\n        146 - wallet_tests (SEGFAULT)\n```\n\nMove `m_dummy` before `m_view` so it is constructed first.\nIn a follow-up `m_dummy` will be completely removed, this commit was meant to demonstrate why that was necessarry.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlS4WcACgkQZp//D/pH\nenYSCA//R5fm/bRdcBJgrShpI0inhrmTxybJw8I+Fb+029zd1uLjYCInKf0vajom\nUf4BGhFaCsRMEkPvQjsafGdNeCXqBhzMlWU29ImcF2K07Rep47pD1Ir1ThZFzRrv\nnbhydAB4mvTSNCRkXYGMkJDg070kLa5z4yj26sCzk4CwCRgBygvPEzfCPoDl+VQ+\nITq1t+DJhVjyOVDVX8eP/kJjYTtpBBJt+ivqmoVTfqX92banrUnx9bfOj8CcQJhu\nfDrw/iganlUlkZdEd0gpLIiZT9Ce6SfgnOMxdd0thMvhDm5iLjUz3PmUg7bIpQ6N\ngoNSfEQJFD5SWBvsOuYa5X8m/DlBgJGrAM7wADrJU/E+bhEyiQ3DkIAaczfOky89\nUKVR1YAk2uLqmer4tS0vTway1aH6ibAqluK6XRjwN3Q75xoG4w8YsuBMtOIO5AHP\n3C/OoRGzYC94RSSDJw+YvslLlmb0rItIhul/new6w38S7ccvYxrlyd/zK9LDVqx5\ne1OmGq40cXgs2W4UEY7Uy9QGg4YHih/6R9nrH0a4nNp/LdrqabKyDS2Dilz7IdlL\ntd7w0IkvpXsYn+Qu3dNAfZac4dSsZgrHN+Qyk1VKRmj8ZQxhq0XFKoY2ra07cBjl\nYImyar556AvSZuDR8erDgqnqwZ/a9U4ZKu5UNkwF5XRRJsict14=\n=6vEZ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/94ddc2dced5736612e358a3b80f2bc718fbd8161",
          "sha": "94ddc2dced5736612e358a3b80f2bc718fbd8161",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/94ddc2dced5736612e358a3b80f2bc718fbd8161"
        }
      ],
      "message": "validation: fix `MemPoolAccept` member init order\n\n`MemPoolAccept` constructs `m_view` with a backend pointer to a `CCoinsView`.\nSince class members are constructed in declaration order (not initializer-list order), calls to a virtual method (having `m_view` declared before `m_dummy`) can result in a virtual call through an uninitialized vptr and crash.\n\nWithout the move:\n```\nThe following tests FAILED:\n        112 - txdownload_tests (SEGFAULT)\n        115 - txpackage_tests (SEGFAULT)\n        118 - txvalidation_tests (SEGFAULT)\n        119 - txvalidationcache_tests (SEGFAULT)\n        127 - validation_block_tests (SEGFAULT)\n        146 - wallet_tests (SEGFAULT)\n```\n\nMove `m_dummy` before `m_view` so it is constructed first.\nIn a follow-up `m_dummy` will be completely removed, this commit was meant to demonstrate why that was necessarry.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-29T20:15:35Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-28T10:31:32Z"
      },
      "sha": "5f5ff9798098a7cf9c5311dc54c615245fec1a3b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21783858694,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUSa04G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21783858694",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "created_at": "2025-12-29T20:21:41Z"
    },
    {
      "event": "reviewed",
      "id": 3618585105,
      "node_id": "PRR_kwDOABII587XrzoR",
      "url": null,
      "actor": null,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-30T16:21:26Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3618585105",
      "submitted_at": "2025-12-30T16:21:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE2MTJlYzI1YmVjNDYxZWJlNzcwYzZiYWY5NzI5NTQ1NWM2ODFjMWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1612ec25bec461ebe770c6baf97295455c681c1f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1612ec25bec461ebe770c6baf97295455c681c1f",
      "tree": {
        "sha": "53536ef5fe2f49e3ed9bf675716e8de6848b2cf5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/53536ef5fe2f49e3ed9bf675716e8de6848b2cf5"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 53536ef5fe2f49e3ed9bf675716e8de6848b2cf5\nparent 5f5ff9798098a7cf9c5311dc54c615245fec1a3b\nauthor Lőrinc <pap.lorinc@gmail.com> 1766146162 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136410 +0100\n\nrefactor: add `CCoinsViewEmpty` as a noop implementation for base and testing\n\nThis enables making `CCoinsView` purely virtual - which is done step-by-step in the following commits.\n\n`CCoinsViewEmpty` is now only constructible via `CCoinsViewEmpty::Get()`.\nSimplified all usages to delegate to the stateless singleton instead.\n\nThe fuzzer was also updated to switch randomly between real db backing and empty view.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJoACgkQZp//D/pH\nenZ+JxAAnubmLp75zUMBRA+COM8os+SUMNiC6ZlJydLqb93T+JGr2J6QBlX9o6vI\nzcENXWx6xBL/TSLrn5JW97mIOrFq3BPOQCOfpD2nGll7Jyxgofbslqs3PHvN9k6w\nDmrwC6cSxh+9D/nyET5voyWy+QIIPeqVdAV2yKGBXQSZXEyUo9wGNgSEcKd5887m\nM5LyszxHQfgNf5iEdCHBhFhJ7VzN2hmz0w4lbn5fCFiecuZvOTFk5qlj7rCXBTjA\nosd0c6WEDkl7g7zeH0ujoy8heoC0cvSE21wx70nZ9ckAthXZ0qSw5Oe+cl28WEu5\nBM6zVUHWegxmjyei8Lmg7JBCwoXjXpGvllkf2DUX2pOr3Jp+8b/C1GkjL4ZUNwEP\nS7vXPwJGgY0m2x5kVPSMdHsDlEd4xxWuvrHenjnWCsu2nNvUe3ByCveeormU05wC\nyOUp6oGzDj0En98+c84MAnLGKRWHE243V72MSvaLsy4nBwBuup7YLM/5dzDgptOa\noLVjUbjc7AwbO4Uv6j9cltvMevVpBokTut4uPnapwu7rqavYjQYow++++j/Ornhb\ncnUtptX1zbnLwBI2HlZtPr4IQUaTC+zSNiJ687RgkJf3NfefqNnMLZOsI6JMRZYj\n0tXBcxBFtNvMLZGLXW2MD8hd9Dnx+Rtpv/rStyJ97OoMkuue9S4=\n=tfOi\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f5ff9798098a7cf9c5311dc54c615245fec1a3b",
          "sha": "5f5ff9798098a7cf9c5311dc54c615245fec1a3b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5f5ff9798098a7cf9c5311dc54c615245fec1a3b"
        }
      ],
      "message": "refactor: add `CCoinsViewEmpty` as a noop implementation for base and testing\n\nThis enables making `CCoinsView` purely virtual - which is done step-by-step in the following commits.\n\n`CCoinsViewEmpty` is now only constructible via `CCoinsViewEmpty::Get()`.\nSimplified all usages to delegate to the stateless singleton instead.\n\nThe fuzzer was also updated to switch randomly between real db backing and empty view.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:30Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:09:22Z"
      },
      "sha": "1612ec25bec461ebe770c6baf97295455c681c1f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhlOTAzNjY3MTQzOTQ1Zjg1NWQ2Yjg2YjgwOTRlZDQ0MThiNzg0ZTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8e903667143945f855d6b86b8094ed4418b784e3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8e903667143945f855d6b86b8094ed4418b784e3",
      "tree": {
        "sha": "db4ebe242730f2124030d9dccf6fa1ead1ee09fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/db4ebe242730f2124030d9dccf6fa1ead1ee09fd"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree db4ebe242730f2124030d9dccf6fa1ead1ee09fd\nparent 1612ec25bec461ebe770c6baf97295455c681c1f\nauthor Lőrinc <pap.lorinc@gmail.com> 1766147559 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136412 +0100\n\nrefactor: make `GetCoin`, `GetBestBlock`, and `BatchWrite` purely virtual in `CCoinsView`\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJwACgkQZp//D/pH\nenahLw//a9YQUGWNRzyhen2ENGOWmxDKJAqcyQj4xAtUnkuO75itCK43X3gzXWqI\neDtl22axEmLdUykeAX/kon8VzIH4HakrxtzEizY51EMKZTnoW1nF0k7EsIX8wSY8\nc4loTPBLh6KaX5sIWFPmsFMMBo4V25aQOBJWEbDQs8ND4+8tcVUnVPnfQ5SXQ3Pb\nbT3m0bnYzHtC3YfyuateC36R9HNMd1/j63kT6iwO1lBS2Pxm7tEUR+ZZFVOJNv5o\nNWAz96sjvynAN7EyASbssWwlL46zfcd+StUr/osjAsXB1ItStQUIQ6HUFt3XOmmq\nMRvSSHV7+1uTYOKsMsrenFYLUt0ev08Bp1iPaY6OUl/fOa76BICn2tNVW5kqDgK0\n2sTCWjjaT1P0k+Gt7P7j+5Ofc0Hk4YhxjUK5iLBqK8DcWvyTvdIVA4AuyuC6RsSz\n1SusqJQOmfS6yIJqsJ3CCuBYv4lzj6m65x0gx6DHW8PYhDb3msiwHzMPriTwGKPI\nCeTh2R9W7LrzVm09snLCT0QQTldALEHeTnzHKD0S/nyiFqPr9DjoHxQ0ZXyZ48zT\nmRZkHbcmnN4dlQ6v+bkdw4kSkt164qJux2vALkQLEPI9c/p7ovvLdXF2gqhAG663\nUmT8Kcxor1k1/w1b/PSju2Ac64vRL8S/pkJRcsCEjqoCHchinMc=\n=lUxF\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1612ec25bec461ebe770c6baf97295455c681c1f",
          "sha": "1612ec25bec461ebe770c6baf97295455c681c1f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1612ec25bec461ebe770c6baf97295455c681c1f"
        }
      ],
      "message": "refactor: make `GetCoin`, `GetBestBlock`, and `BatchWrite` purely virtual in `CCoinsView`",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:32:39Z"
      },
      "sha": "8e903667143945f855d6b86b8094ed4418b784e3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRhYTQwMjcxNGZhODlmOTAxMGI0Njc3MGI4MTNjM2M5OTNhZmVmNjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/daa402714fa89f9010b46770b813c3c993afef64",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/daa402714fa89f9010b46770b813c3c993afef64",
      "tree": {
        "sha": "ea22edeeb6c6fb5ed135abfb84cda81d5a4c43fe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ea22edeeb6c6fb5ed135abfb84cda81d5a4c43fe"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree ea22edeeb6c6fb5ed135abfb84cda81d5a4c43fe\nparent 8e903667143945f855d6b86b8094ed4418b784e3\nauthor Lőrinc <pap.lorinc@gmail.com> 1766146666 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136412 +0100\n\nrefactor: make `CCoinsView::EstimateSize` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJwACgkQZp//D/pH\nena1DxAAiJdIEDkUnHemdIv81FgujE1kB7yxjWw0hE3NpdXaebb1SQMZVUevxgAp\nfLRf4gLqUD+AgoobQe5X+Q9ylQyP0F3lgTUnOBHgN40YFpPxzqoyemkeucZahetd\nkr+muFQCToboS4eNcbxInRkEJ3BYi8Y1RCicwoEdYOkgPpr79Bm7k44ykxOTIaXN\nQEKk2BUoz9bv+np75WcfZxJ912XLZxsoTEriAfWK/cpImiE2xnWS8KkKF1tHBLkB\nMj++oV8E4c02LnJSo2kgKGceqBDk1N2baW2OytgaO70eTSTsIFsr5XYp6AFZedMa\nLAgn3Lm7WcXzaH3b3Bf3MnFQKiobv8jxrG2nVT2QI/mZXtDm+15Ik0kQ3QAq4mXd\nXC5V8HUtk+UWWrjiv3JbFMvI8EuQYNzTCYkdWchfc25rxb0zMEPOkrfXpkkguf40\ngZDZdTxYCPdoLpOPhx8HKz+If6dU2bCC1TP1mRQBsTek43KxhIgKFl/4i0n6RQ6G\n09Ne+UmJeeQAEBej7s/+vzsxFPA4AQsbeG0kP0FOWrYH4g7AWWGd7Y0GSFZbB8D+\n53qP0QGeYDmjsAf1/0HMRswUGbeufNoQg3NNNnbtO8mXtiuYy/CO5GsSMdO7HZ6h\nxOHVGjvmeSOQlZJmroXN01eeIZoWMP0ppi6ZX0jHod3P7ToqlSE=\n=TN2K\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8e903667143945f855d6b86b8094ed4418b784e3",
          "sha": "8e903667143945f855d6b86b8094ed4418b784e3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8e903667143945f855d6b86b8094ed4418b784e3"
        }
      ],
      "message": "refactor: make `CCoinsView::EstimateSize` purely virtual",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:17:46Z"
      },
      "sha": "daa402714fa89f9010b46770b813c3c993afef64"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRkZGU2NzMyOTM2NzFmMWZjNDk0OWY1ZTE3ZmZkYjEyZjdlOTQ1OWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4dde673293671f1fc4949f5e17ffdb12f7e9459f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4dde673293671f1fc4949f5e17ffdb12f7e9459f",
      "tree": {
        "sha": "045af14b8ea223b2e25e3eefe1144b84a2f408e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/045af14b8ea223b2e25e3eefe1144b84a2f408e1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 045af14b8ea223b2e25e3eefe1144b84a2f408e1\nparent daa402714fa89f9010b46770b813c3c993afef64\nauthor Lőrinc <pap.lorinc@gmail.com> 1766147174 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136412 +0100\n\nrefactor: make `CCoinsView::Cursor` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJwACgkQZp//D/pH\nenazRBAAjRt9/gO+s4QZAg9CeD+TqnAh38Uvj6lHmm+VHhI8df5Q1wImlZ6VhG8U\n6pikgx0PKc/RQS+SSlPysuGRKBVGER4PlNYTSbSR8xmXxmyX2VL4pUwkiF3aH/UJ\nBMdPTTN2R+6iNOYfNzyUCr1eb8k1m4jxwfDf676POQpskXBaORj+86xMosh53TMt\n5KVm9fzUDNARJG9FD7cMJ7aWO+FtxELAUgqMS7tM7B1EStQ5SaWE8s2uE1IT9f6Z\nnv51UOG1estkhOUZ5J1YkSqHknsIk78lrmUoTCqwkU4oiWfh45o0H5kSygplLCCp\nAMpGjM3n6l4H4ZDxfcMuBYaIZ3X6U+TkM+/w0fd/+GbwENmw1QRf8WcK1ErKsBtq\n9/ki1pBSFwyRiTSzVRswwxrQhHJSi6enEnkRvVITTf4HirCWaVeRqK7uh4W1zBI+\ni9a/CdzVoqgiKP4j19fjKWDM4d2132Yazc1/r+Hh/4YZJOyxzS1BLAfQ4FG1v/Q4\nfrVVqP6RjvlJVAhLw3mY7/YUpd5Hunb78rc6jRablmJjmut1hQxob2SVk4anUoRm\n465bN83L93iEINOzt2msIlShJ3s/5tDj2Zzjx32I0/sy2kaQYTRyIDdENz/Z98rY\nlzDw+bYFSSxDnjkjy1QsrySQepM0inewUaPkAX/uNeVIjnT4e5k=\n=zNY7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/daa402714fa89f9010b46770b813c3c993afef64",
          "sha": "daa402714fa89f9010b46770b813c3c993afef64",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/daa402714fa89f9010b46770b813c3c993afef64"
        }
      ],
      "message": "refactor: make `CCoinsView::Cursor` purely virtual",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:26:14Z"
      },
      "sha": "4dde673293671f1fc4949f5e17ffdb12f7e9459f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhmM2E0M2ZmNTg2MzE4ODcyNDM5MjUzYTc1YmEzODcxMzRjZGE2Y2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f3a43ff586318872439253a75ba387134cda6cc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8f3a43ff586318872439253a75ba387134cda6cc",
      "tree": {
        "sha": "65c4df854e8da3079a6e46930738c67a60b0e706",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/65c4df854e8da3079a6e46930738c67a60b0e706"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 65c4df854e8da3079a6e46930738c67a60b0e706\nparent 4dde673293671f1fc4949f5e17ffdb12f7e9459f\nauthor Lőrinc <pap.lorinc@gmail.com> 1766147680 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136412 +0100\n\nrefactor: make `CCoinsView::GetHeadBlocks` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJwACgkQZp//D/pH\nenZI4Q//eBdnGTgpY4p2x2xH0LNfYfiTfauzeASL7lb5d0fetvBRzOUs85f8sF1m\n4xPhurPPu4mYlNCd1maMsgvWKsIz3gmb7a0WXi8Bnjygv3Q8jvsq56LqNa1ooHEe\nDiZW089GTj2hdmeupbXNZb9BNRAkXmkKGU/08hd1xxEAiIKzXmBrHWV3jxQ6lrvk\ns6kFJus+KylW35ft5FUlJtHhsNWVQnync+0eVDkrtvqQFr2aH0zvwAN8fJ9sBmGW\nQGfFoxehhutr5+iZeERt6BwX94DHI3j3pjbVUFVA52yBiIiAIahSa4jpi19uYz5U\nljXyh4vJcOTealLmUEyHeDKo1afKvl7qlACIQBzI1hsyXE7xsqXMgvN7bZi5w9a4\nAQ/gBEzYLh+Uh4E9bKuihD/WLfxYTvOIuv8aCVm17t88UzBuUrafbrErCs+Pjjlk\nY+Y0+JUiDNY+II1RcncoMNjojAbazJds+Fnc/YmjL+4ll/szeJoDOBhRuTe8LP9j\nQly/4Gk2ngOLu1HFzfscAJeMIi//qZvTaRBKKbhhOVSVwaWuhOcSU/Mdbe9xLbYW\nEBZb04MkQYmDasTZXZzaDS1IGKM81hZQjX2qU7Npsaw8sWMzZHzDl5yQu/3/DWVn\nCscFNhH4V8ssimgpO0T/NVKGLne0BxUMaJ8CksMYhh3CObXQFXk=\n=5Cj0\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4dde673293671f1fc4949f5e17ffdb12f7e9459f",
          "sha": "4dde673293671f1fc4949f5e17ffdb12f7e9459f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4dde673293671f1fc4949f5e17ffdb12f7e9459f"
        }
      ],
      "message": "refactor: make `CCoinsView::GetHeadBlocks` purely virtual",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:34:40Z"
      },
      "sha": "8f3a43ff586318872439253a75ba387134cda6cc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNjMDA5YmZiNWExNzM1ZWE3NDFmYjA0ZjYyMmQ3ZDZjNjBlMDUxNDU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c009bfb5a1735ea741fb04f622d7d6c60e05145",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3c009bfb5a1735ea741fb04f622d7d6c60e05145",
      "tree": {
        "sha": "26372c2e94bdb2e3db43cfc39cd11abf461c3f1b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/26372c2e94bdb2e3db43cfc39cd11abf461c3f1b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 26372c2e94bdb2e3db43cfc39cd11abf461c3f1b\nparent 8f3a43ff586318872439253a75ba387134cda6cc\nauthor Lőrinc <pap.lorinc@gmail.com> 1766147784 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136412 +0100\n\nrefactor: make `CCoinsView::HaveCoin` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJwACgkQZp//D/pH\nenY3sg/8CCb/EOG8zCNl2j1mEyen2gj8laKEHiklrbm4vPfVhHE+yWobcc42qeyQ\nZRUCbI/MMi5JynFEuX0OstASV2tAqa3uRRvINEcJQJ1sRhKMUbKeK3ZieuhaHrF8\nUdcuTh81XC+qZXh/29dgao+Fzm7pMHSvoZy7bc4szv9UfQvFrVjm/jhDSDJ0bVDn\nwvgnbIMRjpScgSAURWQLgNabEJiiCTMDF6SwzvkBaE9yoSLYQ9/rjbbd09XKH3nH\nEdVMFTiHWBvb04I9SbW0i1CPr0gs7tVcqajK1rnuOOU8WCyUE5lEc/bUIlxp3pmT\nlTYnUusIcXWSMCdcEAK0vTamXbw2+FUBj8Myexxv2nPFcrHGg6rnNY9IhNcJEOvP\n4mdAFEPeQ/DeG5eC0ZmOlyh4P7/JXA3dtnMWnr1AyJFMHjF3hUtsm8zs++wcsUEx\noPDXStT2+5Bg9Zv7VMkHS/JjnhHScRASyBc+VpM4GDBnmmTKbqqq7BQB8s9PUF9f\n3tja8yai/LPL119C+8t8X8glDeAaYMcl9v5v1eg8PntgTrn76vyrf/8hzS5FbG7V\ndv5vcyOjYKJoEusDzhqb9eLFxARzQ+71heBthjZUobkkXa7uecgLkrfJpCWN3NAN\nnRnRtBbrmWrnmlOH7ZxKBruqxGLPc+qdaSzXC32jIcSPmFJaaTs=\n=obTB\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f3a43ff586318872439253a75ba387134cda6cc",
          "sha": "8f3a43ff586318872439253a75ba387134cda6cc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8f3a43ff586318872439253a75ba387134cda6cc"
        }
      ],
      "message": "refactor: make `CCoinsView::HaveCoin` purely virtual",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:32Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:36:24Z"
      },
      "sha": "3c009bfb5a1735ea741fb04f622d7d6c60e05145"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIyM2Q3ODRiNmJhZWUxNDBmNzU4ODJmZTAwOWJlNTY3NmRiNGNiMGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b23d784b6baee140f75882fe009be5676db4cb0b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b23d784b6baee140f75882fe009be5676db4cb0b",
      "tree": {
        "sha": "02b25f85bbaf2b7229c99fd0d731d0ca721baefc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/02b25f85bbaf2b7229c99fd0d731d0ca721baefc"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 02b25f85bbaf2b7229c99fd0d731d0ca721baefc\nparent 3c009bfb5a1735ea741fb04f622d7d6c60e05145\nauthor Lőrinc <pap.lorinc@gmail.com> 1766438006 +0200\ncommitter Lőrinc <pap.lorinc@gmail.com> 1767136413 +0100\n\nrefactor: inline `CCoinsViewBacked` implementation to header\n\nIt's a simple delegate, the cpp is already really crowded, let's do these inline.\n\nAlso note that the `CCoinsViewBacked` constructor is asserted to not take any `nullptr` values anymore, since the reason why `base` was stored as a pointer was that references cannot be reallocated, and we need to call `SetBackend` in a few places - which takes a reference, also proving that `nullptr` was never the goal.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlUXJ0ACgkQZp//D/pH\nenaKRA//fiacHExgcf40KGtXVYvNHcEtGWoh8v7Zxl9Ll9bxjoX66rEx8ZQpd/Ze\nUKWSZ2bLUo4BOj/YaRmKgu24gzOAxEnoXUAkh/y+xBnPp6kewhAh4UUQ4d6BkCky\nysyRCW5laGXFEzOBuhspRyeEK3J6SYYu62DmiUQ7iwqmICDqZ2BcLNhoxqo5+sIP\n+dgNwm0+5xjziOtWVjHIo2eHUJPeax2/QSDmALKcvXC8dEUr0EKT+3OOSA7zT20p\nAlI3FbU4hMEwKb4RVWu6GS9R8ogJBYWobx/sD6Ml9wqnIbTkQWycq5YdZbLcVI0w\n6ySWsOgqb/iH8Hgxl2HDZodoW/CxgpBa8h0KoIBA7wmhhrj+YPzRTX7SyL9UFDH/\ntX47GIABBpWhMLep5C0uoQwk3bOguSj6txVk3hMCkDtO7SRq5S25hyYBXhZ0LNwI\np9lWziS+cjCNYSxWBjZlBMbUjR0MJOzrASlu8S3YNSZYFsXVcJ39vLd1BsMvB54s\niUGC7RWR4yiUWKvOiPPtoreRkLqRoXJVMJD7S/DZAY65DgtQkZ0A00d2+nyjlCj5\nqVc9zttrVHvZzHF0zZN8uI1li3iTtqsMqf54PP1DzOXCUPWtG2lqmhenHfe2A6se\nQdbHPn+V5zKSSAlp4f8g0GwtcMu0jvdQ7acELHQvJo0yQr6NyPc=\n=ozQL\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c009bfb5a1735ea741fb04f622d7d6c60e05145",
          "sha": "3c009bfb5a1735ea741fb04f622d7d6c60e05145",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3c009bfb5a1735ea741fb04f622d7d6c60e05145"
        }
      ],
      "message": "refactor: inline `CCoinsViewBacked` implementation to header\n\nIt's a simple delegate, the cpp is already really crowded, let's do these inline.\n\nAlso note that the `CCoinsViewBacked` constructor is asserted to not take any `nullptr` values anymore, since the reason why `base` was stored as a pointer was that references cannot be reallocated, and we need to call `SetBackend` in a few places - which takes a reference, also proving that `nullptr` was never the goal.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-30T23:13:33Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-22T21:13:26Z"
      },
      "sha": "b23d784b6baee140f75882fe009be5676db4cb0b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21801346703,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUTdiaP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21801346703",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b23d784b6baee140f75882fe009be5676db4cb0b",
      "created_at": "2025-12-30T23:14:12Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581366",
      "pull_request_review_id": 3602578034,
      "id": 2638581366,
      "node_id": "PRRC_kwDOABII586dRY52",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Don't see any value in deleting these in a separate commit from making them pure virtual.",
      "created_at": "2025-12-22T04:18:46Z",
      "updated_at": "2025-12-22T04:23:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2638581366",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581846",
      "pull_request_review_id": 3602578034,
      "id": 2638581846,
      "node_id": "PRRC_kwDOABII586dRZBW",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}",
      "path": "src/coins.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I could see keeping this one; it seems like a reasonable default?",
      "created_at": "2025-12-22T04:19:14Z",
      "updated_at": "2025-12-22T04:23:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2638581846",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581846"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 25,
      "original_line": 25,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641275940",
      "pull_request_review_id": 3605780432,
      "id": 2641275940,
      "node_id": "PRRC_kwDOABII586dbqwk",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": 2638581366,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Indeed, moved each deletion to the commit that made the method pure, thanks.\r\nAlso made the empty class a singleton which simplified all nested usages significantly.\r\nAnd inlined the trivial implementation of `*Backing` to the header to reduce the clutter in the cpp a bit more.\r\nhttps://github.com/bitcoin/bitcoin/compare/38ae4082a13b2e6dd07e84d228c9e58d3df27b11..d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "created_at": "2025-12-22T21:19:08Z",
      "updated_at": "2025-12-23T08:08:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2641275940",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641275940"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641276223",
      "pull_request_review_id": 3605780748,
      "id": 2641276223,
      "node_id": "PRRC_kwDOABII586dbq0_",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}",
      "path": "src/coins.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": 2638581846,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We need this method because of the specialized database access which doesn't need to deserialize the read value:\r\n* https://github.com/bitcoin/bitcoin/blob/fa5f29774872d18febc0df38831a6e45f3de69cc/src/txdb.cpp#L74-L76\r\n\r\nOtherwise we could of course replace it with `!!GetCoin(outpoint)`:\r\n* https://github.com/bitcoin/bitcoin/blob/7f295e1d9b44c225c823242c1f04239f46fb27a6/src/coins.cpp#L166-L169\r\n\r\nWe're not even really using the former in production code anyway (see https://github.com/bitcoin/bitcoin/pull/34132), we could probably easily inline the `!!GetCoin(outpoint)` to the few remaining call sites instead. Regardless, the current change should simplify usage and we can investigate that later.\r\n\r\n------\r\n\r\nAlso, the underlying problem is that having a separate `CCoinsView` makes adding defaults weird, there's no logical default behavior.\r\nBut we could inline it into `CCoinsViewBacked` (and delete `CCoinsView` and rename `CCoinsViewBacked` back to `CCoinsView`)  and use that as the base for the other caches, with the default implementation simply delegating to `base`, something like:\r\n```patch\r\ndiff --git a/src/coins.cpp b/src/coins.cpp\r\nindex 9bdcb42f45..4f66ed447b 100644\r\n--- a/src/coins.cpp\r\n+++ b/src/coins.cpp\r\n@@ -14,7 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\r\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\r\n \r\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\r\n-    CCoinsViewBacked(baseIn), m_deterministic(deterministic),\r\n+    CCoinsView(baseIn), m_deterministic(deterministic),\r\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\r\n {\r\n     m_sentinel.second.SelfRef(m_sentinel);\r\n@@ -362,10 +362,10 @@ static ReturnType ExecuteBackedWrapper(Func func, const std::vector<std::functio\r\n \r\n std::optional<Coin> CCoinsViewErrorCatcher::GetCoin(const COutPoint& outpoint) const\r\n {\r\n-    return ExecuteBackedWrapper<std::optional<Coin>>([&]() { return CCoinsViewBacked::GetCoin(outpoint); }, m_err_callbacks);\r\n+    return ExecuteBackedWrapper<std::optional<Coin>>([&]() { return CCoinsView::GetCoin(outpoint); }, m_err_callbacks);\r\n }\r\n \r\n bool CCoinsViewErrorCatcher::HaveCoin(const COutPoint& outpoint) const\r\n {\r\n-    return ExecuteBackedWrapper<bool>([&]() { return CCoinsViewBacked::HaveCoin(outpoint); }, m_err_callbacks);\r\n+    return ExecuteBackedWrapper<bool>([&]() { return CCoinsView::HaveCoin(outpoint); }, m_err_callbacks);\r\n }\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex a64f30376d..7e8120f710 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -303,37 +303,46 @@ private:\r\n     bool m_will_erase;\r\n };\r\n \r\n-/** Pure abstract view on the open txout dataset. */\r\n+/** Coins view backed by another CCoinsView. */\r\n class CCoinsView\r\n {\r\n+protected:\r\n+    CCoinsView* base{nullptr};\r\n+\r\n+    CCoinsView() = default;\r\n+\r\n public:\r\n+    explicit CCoinsView(CCoinsView* viewIn) : base(Assert(viewIn)) {}\r\n+\r\n     //! As we use CCoinsViews polymorphically, have a virtual destructor\r\n     virtual ~CCoinsView() = default;\r\n \r\n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\r\n+\r\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\r\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\r\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\r\n \r\n     //! Just check whether a given outpoint is unspent.\r\n-    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\r\n+    virtual bool HaveCoin(const COutPoint& outpoint) const { return base->HaveCoin(outpoint); }\r\n \r\n     //! Retrieve the block hash whose state this CCoinsView currently represents\r\n-    virtual uint256 GetBestBlock() const = 0;\r\n+    virtual uint256 GetBestBlock() const { return base->GetBestBlock(); }\r\n \r\n     //! Retrieve the range of blocks that may have been only partially written.\r\n     //! If the database is in a consistent state, the result is the empty vector.\r\n     //! Otherwise, a two-element vector is returned consisting of the new and\r\n     //! the old block hash, in that order.\r\n-    virtual std::vector<uint256> GetHeadBlocks() const = 0;\r\n+    virtual std::vector<uint256> GetHeadBlocks() const { return base->GetHeadBlocks(); }\r\n \r\n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\r\n     //! The passed cursor is used to iterate through the coins.\r\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\r\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) { return base->BatchWrite(cursor, hashBlock); }\r\n \r\n     //! Get a cursor to iterate over the whole state\r\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\r\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const { return base->Cursor(); }\r\n \r\n     //! Estimate database size\r\n-    virtual size_t EstimateSize() const = 0;\r\n+    virtual size_t EstimateSize() const { return base->EstimateSize(); }\r\n };\r\n \r\n /** Noop coins view. */\r\n@@ -361,28 +370,8 @@ public:\r\n     size_t EstimateSize() const override { return 0; }\r\n };\r\n \r\n-/** CCoinsView backed by another CCoinsView */\r\n-class CCoinsViewBacked : public CCoinsView\r\n-{\r\n-protected:\r\n-    CCoinsView* base;\r\n-\r\n-public:\r\n-    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{viewIn} {}\r\n-\r\n-    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\r\n-\r\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base->GetCoin(outpoint); }\r\n-    bool HaveCoin(const COutPoint& outpoint) const override { return base->HaveCoin(outpoint); }\r\n-    uint256 GetBestBlock() const override { return base->GetBestBlock(); }\r\n-    std::vector<uint256> GetHeadBlocks() const override { return base->GetHeadBlocks(); }\r\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base->BatchWrite(cursor, hashBlock); }\r\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return base->Cursor(); }\r\n-    size_t EstimateSize() const override { return base->EstimateSize(); }\r\n-};\r\n-\r\n /** CCoinsView that adds a memory cache for transactions to another CCoinsView */\r\n-class CCoinsViewCache : public CCoinsViewBacked\r\n+class CCoinsViewCache : public CCoinsView\r\n {\r\n private:\r\n     const bool m_deterministic;\r\n@@ -534,10 +523,10 @@ const Coin& AccessByTxid(const CCoinsViewCache& cache, const Txid& txid);\r\n  *\r\n  * Writes do not need similar protection, as failure to write is handled by the caller.\r\n */\r\n-class CCoinsViewErrorCatcher final : public CCoinsViewBacked\r\n+class CCoinsViewErrorCatcher final : public CCoinsView\r\n {\r\n public:\r\n-    explicit CCoinsViewErrorCatcher(CCoinsView* view) : CCoinsViewBacked(view) {}\r\n+    explicit CCoinsViewErrorCatcher(CCoinsView* view) : CCoinsView(view) {}\r\n \r\n     void AddReadErrCallback(std::function<void()> f) {\r\n         m_err_callbacks.emplace_back(std::move(f));\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 4dc692bfd8..3e47428e8e 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -720,7 +720,7 @@ bool CTxMemPool::HasNoInputsOf(const CTransaction &tx) const\r\n     return true;\r\n }\r\n \r\n-CCoinsViewMemPool::CCoinsViewMemPool(CCoinsView* baseIn, const CTxMemPool& mempoolIn) : CCoinsViewBacked(baseIn), mempool(mempoolIn) { }\r\n+CCoinsViewMemPool::CCoinsViewMemPool(CCoinsView* baseIn, const CTxMemPool& mempoolIn) : CCoinsView(baseIn), mempool(mempoolIn) { }\r\n \r\n std::optional<Coin> CCoinsViewMemPool::GetCoin(const COutPoint& outpoint) const\r\n {\r\ndiff --git a/src/txmempool.h b/src/txmempool.h\r\nindex 166a024823..4c24766c77 100644\r\n--- a/src/txmempool.h\r\n+++ b/src/txmempool.h\r\n@@ -778,7 +778,7 @@ public:\r\n  * signrawtransactionwithkey and signrawtransactionwithwallet,\r\n  * as long as the conflicting transaction is not yet confirmed.\r\n  */\r\n-class CCoinsViewMemPool : public CCoinsViewBacked\r\n+class CCoinsViewMemPool : public CCoinsView\r\n {\r\n     /**\r\n     * Coins made available by transactions being validated. Tracking these allows for package\r\n\r\n```\r\n\r\nThis would introduce a sensible default as the base class behavior (always delegating) and we'd instantiate it with the empty sigleton, which would always do nothin'.\r\nI haven't included this yet, we can discuss if it's a good idea.",
      "created_at": "2025-12-22T21:19:13Z",
      "updated_at": "2025-12-22T21:19:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2641276223",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641276223"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 25,
      "original_line": 25,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650048046",
      "pull_request_review_id": 3614915324,
      "id": 2650048046,
      "node_id": "PRRC_kwDOABII586d9IYu",
      "diff_hunk": "@@ -722,6 +722,11 @@ class MemPoolAccept\n     }\n \n private:\n+    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\n+     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\n+     * were pulled from disk. */\n+    CCoinsView m_dummy;\n+",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "original_commit_id": "436765c23a009c18a2a8e29e8b9534924e80d1d0",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit 436765c23a009c18a2a8e29e8b9534924e80d1d0, it looks like you forgot to include the removal diff.\r\n\r\nEdit: It's doubly removed in 148a0a94c65425b7ea9b6cc667502167b8c1c7a0, but that second removal should be here.",
      "created_at": "2025-12-29T01:33:36Z",
      "updated_at": "2025-12-29T05:31:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650048046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650048046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 729,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650227623",
      "pull_request_review_id": 3615075843,
      "id": 2650227623,
      "node_id": "PRRC_kwDOABII586d90On",
      "diff_hunk": "@@ -378,6 +403,7 @@ class CCoinsViewCache : public CCoinsViewBacked\n \n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n+    CCoinsViewCache() : CCoinsViewCache{&CCoinsViewEmpty::Get()} {}",
      "path": "src/coins.h",
      "position": 111,
      "original_position": 111,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should this constructor be on `CCoinsViewBacked` instead?",
      "created_at": "2025-12-29T05:39:46Z",
      "updated_at": "2025-12-29T05:39:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650227623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650227623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 406,
      "original_line": 406,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650234336",
      "pull_request_review_id": 3615082648,
      "id": 2650234336,
      "node_id": "PRRC_kwDOABII586d913g",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure about this sanity check. We're checking that a call to this method will work? Is this better than an assertion that baseIn is non-null? Why not refactor `baseIn` to be a reference?",
      "created_at": "2025-12-29T05:46:39Z",
      "updated_at": "2025-12-29T05:46:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650234336",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650234336"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650833138",
      "pull_request_review_id": 3615731889,
      "id": 2650833138,
      "node_id": "PRRC_kwDOABII586eAIDy",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "it's not null, it will give illegal access since it points to a random address. Try reverting and running any of the mentioned tests from the commit message.",
      "created_at": "2025-12-29T12:07:36Z",
      "updated_at": "2025-12-29T12:07:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650833138",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650833138"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651156940",
      "pull_request_review_id": 3616078914,
      "id": 2651156940,
      "node_id": "PRRC_kwDOABII586eBXHM",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ok, but if it's a pointer it is legal for it to be a nullptr. So we should check first if it is not nullptr.\r\nAlso, instead of accessing a method, we could do a dynamic cast to `CCoinsView*` and assert the result.\r\n```suggestion\r\n    assert(!base || dynamic_cast<CCoinsView*>(base));\r\n```",
      "created_at": "2025-12-29T14:58:56Z",
      "updated_at": "2025-12-29T17:13:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651156940",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651156940"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651708755",
      "pull_request_review_id": 3616683354,
      "id": 2651708755,
      "node_id": "PRRC_kwDOABII586eDd1T",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`assert(!base || dynamic_cast<CCoinsView*>(base));` doesn't trigger the failure.\r\n\r\nReverting `m_dummy` (which I did accidentally in the first commit already):\r\n```patch\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\n--- a/src/validation.cpp\t(revision 5f5ff9798098a7cf9c5311dc54c615245fec1a3b)\r\n+++ b/src/validation.cpp\t(date 1767039346685)\r\n@@ -722,11 +722,6 @@\r\n     }\r\n \r\n private:\r\n-    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\r\n-     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\r\n-     * were pulled from disk. */\r\n-    CCoinsView m_dummy;\r\n-\r\n     CTxMemPool& m_pool;\r\n \r\n     /** Holds a cached view of available coins from the UTXO set, mempool, and artificial temporary coins (to enable package validation).\r\n@@ -746,6 +741,10 @@\r\n     /** When m_view is connected to m_viewmempool as its backend, it can pull coins from the mempool and from the UTXO\r\n      * set. This is also where temporary coins are stored. */\r\n     CCoinsViewMemPool m_viewmempool;\r\n+    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\r\n+     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\r\n+     * were pulled from disk. */\r\n+    CCoinsView m_dummy;\r\n \r\n     Chainstate& m_active_chainstate;\r\n```\r\n\r\nAnd running:\r\n> cmake -B build  -DCMAKE_BUILD_TYPE=Debug && cmake --build build && ./build/bin/test_bitcoin --run_test=wallet_tests\r\n\r\nfails correctly with:\r\n> Running 13 test cases...\r\n> ******** errors disabling the alternate stack:\r\n>         #error:22\r\n>         Invalid argument\r\n> unknown location:0: fatal error: in \"wallet_tests/CreateWallet\": memory access violation at address: 0x5f4d1884: invalid permissions\r\n>  wallet/test/wallet_tests.cpp:622: last checkpoint\r\n\r\nMoved the proper removal to the first commit: https://github.com/bitcoin/bitcoin/compare/784769b5b1a8465d1a09ec489a303c4616d11896..a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "created_at": "2025-12-29T20:20:22Z",
      "updated_at": "2025-12-29T20:22:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651708755",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651708755"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651711783",
      "pull_request_review_id": 3616686593,
      "id": 2651711783,
      "node_id": "PRRC_kwDOABII586eDekn",
      "diff_hunk": "@@ -378,6 +403,7 @@ class CCoinsViewCache : public CCoinsViewBacked\n \n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n+    CCoinsViewCache() : CCoinsViewCache{&CCoinsViewEmpty::Get()} {}",
      "path": "src/coins.h",
      "position": 111,
      "original_position": 111,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650227623,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How so? We have to init `m_deterministic` as well...",
      "created_at": "2025-12-29T20:21:32Z",
      "updated_at": "2025-12-29T20:21:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651711783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651711783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 406,
      "original_line": 406,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652027175",
      "pull_request_review_id": 3617058212,
      "id": 2652027175,
      "node_id": "PRRC_kwDOABII586eErkn",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hmm dynamic casting uninitialized memory should be UB as well, but I guess it doesn't trigger a memory access violation.\r\nBut, we still need to check that `base` is not `nullptr` before accessing, otherwise passing `nullptr` would trigger undefined behavior.",
      "created_at": "2025-12-30T01:08:33Z",
      "updated_at": "2025-12-30T01:08:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2652027175",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652027175"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652387942",
      "pull_request_review_id": 3617447177,
      "id": 2652387942,
      "node_id": "PRRC_kwDOABII586eGDpm",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "i don't think we support nullptr currently - it's why we have a default implementation with dummy values. ",
      "created_at": "2025-12-30T07:21:04Z",
      "updated_at": "2025-12-30T07:21:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2652387942",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652387942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653138327",
      "pull_request_review_id": 3618429076,
      "id": 2653138327,
      "node_id": "PRRC_kwDOABII586eI62X",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The API supports it. I use it in #31132. If we want to disallow it then we should change the parameter to a reference.",
      "created_at": "2025-12-30T14:35:02Z",
      "updated_at": "2025-12-30T14:35:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653138327",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653138327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653248652",
      "pull_request_review_id": 3618585105,
      "id": 2653248652,
      "node_id": "PRRC_kwDOABII586eJVyM",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "As I understand it, this is sanity testing through triggering UB in the case the bug is present. I don't think that is ideal, as the compiler is allowed to assume it won't happen and optimize it away. This isn't too far fetched - if it could be inferred that (all implementations of) `CCoinsView::GetBestBlock` are side-effect free, then the statement `(void)base->GetBestBlock();` could just be optimized away.\n\nTesting for bugs due to initialization order seems more like a job for UBSan. Unfortunately, it seems none of the current fuzz tests (with UBSan enabled) trigger with the following patch (on master):\n\n```diff\ndiff --git a/src/coins.cpp b/src/coins.cpp\nindex 14381ecb0aa..c7206c22554 100644\n--- a/src/coins.cpp\n+++ b/src/coins.cpp\n@@ -38,6 +38,7 @@ CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    assert(!base || dynamic_cast<CCoinsView*>(base));\n     m_sentinel.second.SelfRef(m_sentinel);\n }\n```\n\nI'm not objecting to this change, but I think it would be better if we could test for bugs of this class in a more systematic way.\n",
      "created_at": "2025-12-30T15:31:21Z",
      "updated_at": "2025-12-30T16:21:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653248652",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653248652"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653974593",
      "pull_request_review_id": 3619382385,
      "id": 2653974593,
      "node_id": "PRRC_kwDOABII586eMHBB",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> The API supports it. I use it in https://github.com/bitcoin/bitcoin/pull/31132. If we want to disallow it then we should change the parameter to a reference.\r\n\r\nMy understanding is that it was stored as a pointer since references cannot be reallocated and we need to call `SetBackend` currently in a few places (which takes a reference, also proving that `nullptr` was never the goal).\r\nWe can change it to `std::reference_wrapper<CCoinsView> base` but it would trigger a huge changeset if it percolates to getting rid of all pointers in the constructors. But I don't mind adding an `Assert` to forbid that at least during runtime and fix the constructor and call sites after this PR is merged:\r\n```C++\r\nclass CCoinsViewBacked : public CCoinsView\r\n{\r\nprotected:\r\n    std::reference_wrapper<CCoinsView> base;\r\n\r\npublic:\r\n    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{*Assert(viewIn)} {} // TODO change to reference\r\n\r\n    void SetBackend(CCoinsView& viewIn) { base = std::ref(viewIn); }\r\n\r\n    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base.get().GetCoin(outpoint); }\r\n    bool HaveCoin(const COutPoint& outpoint) const override { return base.get().HaveCoin(outpoint); }\r\n    uint256 GetBestBlock() const override { return base.get().GetBestBlock(); }\r\n    std::vector<uint256> GetHeadBlocks() const override { return base.get().GetHeadBlocks(); }\r\n    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base.get().BatchWrite(cursor, hashBlock); }\r\n    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return base.get().Cursor(); }\r\n    size_t EstimateSize() const override { return base.get().EstimateSize(); }\r\n};\r\n```",
      "created_at": "2025-12-30T22:07:07Z",
      "updated_at": "2025-12-30T22:07:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653974593",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653974593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653979894",
      "pull_request_review_id": 3619387129,
      "id": 2653979894,
      "node_id": "PRRC_kwDOABII586eMIT2",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Sorry if I was unclear. `base` should remain a pointer. `viewIn` should be a reference in the constructor, as it is in `SetBackend`.",
      "created_at": "2025-12-30T22:09:14Z",
      "updated_at": "2025-12-30T22:09:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653979894",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653979894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654002456",
      "pull_request_review_id": 3619410447,
      "id": 2654002456,
      "node_id": "PRRC_kwDOABII586eMN0Y",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> viewIn should be a reference in the constructor\r\n\r\nyeah, that's what I meant by:\r\n\r\n> it would trigger a huge changeset if it percolates to getting rid of all pointers in the constructors\r\n\r\nIt triggered changes in 22 files so far - I have stopped refactoring after a while. We can prohibit new `nullptr` bases via an `Assert` for now, and clean up this area in a separate PR since it's a bit messy.",
      "created_at": "2025-12-30T22:17:45Z",
      "updated_at": "2025-12-30T22:19:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2654002456",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654002456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654282589",
      "pull_request_review_id": 3619698402,
      "id": 2654282589,
      "node_id": "PRRC_kwDOABII586eNSNd",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I don't think that is ideal, as the compiler is allowed to assume it won't happen and optimize it away.\r\n\r\nI needed something to demonstrate the UB - and that it's fixed now, so [I have removed this reproducer in the second commit](https://github.com/bitcoin/bitcoin/compare/a69ea84b83d22c66ddeeba6d27b761036d6fec40..b23d784b6baee140f75882fe009be5676db4cb0b#diff-f0ed73d62dae6ca28ebd3045e5fc0d5d02eaaacadb4c2a292985a3fbd7e1c77cL20). Would be cool if we could instrument the code with something like `-fsanitize=undefined` or `-fsanitize=vptr` or `-Wreorder-ctor` (haven't tried any of them, not sure they would have found this one).\r\n\r\nI've also [added the `Assert`](https://github.com/bitcoin/bitcoin/compare/a69ea84b83d22c66ddeeba6d27b761036d6fec40..b23d784b6baee140f75882fe009be5676db4cb0b#diff-095ce1081a930998a10b37358fae5499ac47f8cb6f25f5df5d88e920a54e0341L371) to prohibit `nullptr` bases in `CCoinsViewBacked` - we should use `CCoinsViewEmpty::Get()` from now on to stop the propagation.",
      "created_at": "2025-12-30T23:18:12Z",
      "updated_at": "2025-12-30T23:20:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2654282589",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654282589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    }
  ]
}
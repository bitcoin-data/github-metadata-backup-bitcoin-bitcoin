{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124",
    "id": 3119599294,
    "node_id": "PR_kwDOABII58658U6-",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34124",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34124.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34124.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
    "number": 34124,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "refactor: make `CCoinsView` a purely virtual abstract base class",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Problem\r\n`CCoinsView` serves as the interface for the coins database layer, but historically had a dual nature that caused confusion:\r\n\r\n* It provided default noop implementations (returning `std::nullopt`, `uint256()`, `false`, `nullptr`) instead of being pure virtual\r\n* Callers could instantiate a bare `CCoinsView` and get silent no-op behavior\r\n* Mixing the interface definition with a built-in dummy implementation blurred the abstraction boundary\r\n\r\n### Context\r\n\r\nThis is part of ongoing coins caching cleanup efforts such as #34132, #33866, #33018, and #33512.\r\n\r\n### Fix\r\n\r\nThis PR makes `CCoinsView` a pure abstract interface and introduces an explicit noop implementation, in tiny incremental steps to ease review:\r\n\r\n* Add `CCoinsViewEmpty` as an explicit noop coins view for tests, benchmarks, and dummy backends\r\n* Replace all direct `CCoinsView` instantiations with `CCoinsViewEmpty`\r\n* Incrementally make all `CCoinsView` methods pure virtual (`GetCoin`, `GetBestBlock`, `BatchWrite`, `EstimateSize`, `Cursor`, `GetHeadBlocks`, `HaveCoin`)\r\n* Remove the legacy default implementations from `coins.cpp`\r\n* Update the coins view fuzzer to switch between a real database-backed view and `CCoinsViewEmpty`\r\n",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-12-20T08:47:33Z",
    "updated_at": "2026-01-03T12:49:43Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "l0rinc:l0rinc/pure-virtual-CCoinsView",
      "ref": "l0rinc/pure-virtual-CCoinsView",
      "sha": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 281367,
        "default_branch": "master",
        "open_issues_count": 27,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-03T11:44:26Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-01T18:17:55Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "adbb4b320834516dc97fa33aaa853a45cbabca67",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38570,
        "stargazers_count": 87498,
        "watchers_count": 87498,
        "size": 301125,
        "default_branch": "master",
        "open_issues_count": 738,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-03T00:49:36Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-03T12:47:47Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 113,
    "deletions": 116,
    "changed_files": 17,
    "commits": 8,
    "review_comments": 38,
    "comments": 4
  },
  "events": [
    {
      "event": "labeled",
      "id": 21683616602,
      "node_id": "LE_lADOABII587fgV9xzwAAAAUMcbta",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21683616602",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T08:47:37Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "commented",
      "id": 3677609717,
      "node_id": "IC_kwDOABII587bM971",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3677609717",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T08:47:41Z",
      "updated_at": "2026-01-02T12:59:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34124.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [andrewtoth](https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3678038276), [ajtowns](https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3602578034), [sipa](https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3618585105) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34165](https://github.com/bitcoin/bitcoin/pull/34165) (coins: don't mutate main cache when connecting block by andrewtoth)\n* [#34125](https://github.com/bitcoin/bitcoin/pull/34125) (refactor: reuse `should_empty` for chainstate flush condition by l0rinc)\n* [#33866](https://github.com/bitcoin/bitcoin/pull/33866) (refactor: Let CCoinsViewCache::BatchWrite return void by sedited)\n* [#33512](https://github.com/bitcoin/bitcoin/pull/33512) (coins: use number of dirty cache entries in flush warnings/logs by l0rinc)\n* [#32840](https://github.com/bitcoin/bitcoin/pull/32840) (test: Enhance GetTxSigOpCost tests for coinbase transactions by average-gary)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n* [#29060](https://github.com/bitcoin/bitcoin/pull/29060) (Policy: Report debug message why inputs are non standard by ismaelsadeeq)\n* [#21283](https://github.com/bitcoin/bitcoin/pull/21283) (Implement BIP 370 PSBTv2 by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3677609717",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "commented",
      "id": 3678038276,
      "node_id": "IC_kwDOABII587bOmkE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678038276",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T19:02:06Z",
      "updated_at": "2025-12-20T19:02:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\n\nMakes sense to make an empty view explicit, and having the base class be purely virtual.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3678038276",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "renamed",
      "id": 21686184225,
      "node_id": "RTE_lADOABII587fgV9xzwAAAAUMmOkh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21686184225",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T19:16:47Z",
      "rename": {
        "from": "refactor: make `CCoinsView` a purely abstract base class",
        "to": "refactor: make `CCoinsView` a purely virtual abstract base class"
      }
    },
    {
      "event": "reviewed",
      "id": 3602578034,
      "node_id": "PRR_kwDOABII587Wuvpy",
      "url": null,
      "actor": null,
      "commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-22T04:23:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, this seemed better separated as an interface and a dummy implementation to me too.\r\n\r\nI think squashing all the commits after the first into a single commit would be better though.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3602578034",
      "submitted_at": "2025-12-22T04:23:14Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21713218511,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUONWvP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21713218511",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "created_at": "2025-12-22T21:19:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21769399409,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAURjqxx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21769399409",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/784769b5b1a8465d1a09ec489a303c4616d11896",
      "created_at": "2025-12-28T10:58:14Z"
    },
    {
      "event": "commented",
      "id": 3694658009,
      "node_id": "IC_kwDOABII587cOAHZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694658009",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T11:04:11Z",
      "updated_at": "2025-12-28T11:04:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "This change also revealed a potential UB in `MemPoolAccept` member init order. Since class members are constructed in [declaration order](https://en.cppreference.com/w/cpp/language/initializer_list.html#Initialization_order) (not initializer-list order), calls to a virtual method (having `m_view` depend on `m_dummy` but declared before it) can result in a virtual call through an uninitialized vptr and crash.\r\nSince the constructor didn't dereference `m_dummy` during `m_view` construction, the latent ordering hazard stayed dormant. This cleanup accidentally fixed it, but to make it explicit, I have extracted it to the first commit as a temporary fix.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3694658009",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "reviewed",
      "id": 3614915324,
      "node_id": "PRR_kwDOABII587Xdzr8",
      "url": null,
      "actor": null,
      "commit_id": "436765c23a009c18a2a8e29e8b9534924e80d1d0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T01:33:36Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3614915324",
      "submitted_at": "2025-12-29T01:33:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "reviewed",
      "id": 3615075843,
      "node_id": "PRR_kwDOABII587Xea4D",
      "url": null,
      "actor": null,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T05:39:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3615075843",
      "submitted_at": "2025-12-29T05:39:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "reviewed",
      "id": 3615082648,
      "node_id": "PRR_kwDOABII587XeciY",
      "url": null,
      "actor": null,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-29T05:46:39Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3615082648",
      "submitted_at": "2025-12-29T05:46:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21783858694,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUSa04G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21783858694",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "created_at": "2025-12-29T20:21:41Z"
    },
    {
      "event": "reviewed",
      "id": 3618585105,
      "node_id": "PRR_kwDOABII587XrzoR",
      "url": null,
      "actor": null,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-30T16:21:26Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3618585105",
      "submitted_at": "2025-12-30T16:21:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21801346703,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUTdiaP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21801346703",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b23d784b6baee140f75882fe009be5676db4cb0b",
      "created_at": "2025-12-30T23:14:12Z"
    },
    {
      "event": "reviewed",
      "id": 3622026233,
      "node_id": "PRR_kwDOABII587X47v5",
      "url": null,
      "actor": null,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-01T19:50:51Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3622026233",
      "submitted_at": "2026-01-01T19:50:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkxOGJlZmMyYTIzNDEyMjFmMGZiZGNjYmQyYzg5ZjI5NzUxMTIyYjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/918befc2a2341221f0fbdccbd2c89f29751122b3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/918befc2a2341221f0fbdccbd2c89f29751122b3",
      "tree": {
        "sha": "e4c65a9af834cde79d86d1df573671a427738231",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e4c65a9af834cde79d86d1df573671a427738231"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e4c65a9af834cde79d86d1df573671a427738231\nparent 94ddc2dced5736612e358a3b80f2bc718fbd8161\nauthor Lrinc <pap.lorinc@gmail.com> 1766917892 +0200\ncommitter Lrinc <pap.lorinc@gmail.com> 1767299141 +0100\n\nvalidation: fix `MemPoolAccept` member init order\n\n`MemPoolAccept` constructs `m_view` with a backend pointer to a `CCoinsView`.\nSince class members are constructed in declaration order (not initializer-list order), calls to a virtual method (having `m_view` declared before `m_dummy`) can result in a virtual call through an uninitialized vptr and crash.\n\nWithout the move:\n```\nThe following tests FAILED:\n        112 - txdownload_tests (SEGFAULT)\n        115 - txpackage_tests (SEGFAULT)\n        118 - txvalidation_tests (SEGFAULT)\n        119 - txvalidationcache_tests (SEGFAULT)\n        127 - validation_block_tests (SEGFAULT)\n        146 - wallet_tests (SEGFAULT)\n```\n\nMove `m_dummy` before `m_view` so it is constructed first.\nIn a follow-up `m_dummy` will be completely removed, this commit was meant to demonstrate why that was necessary.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW2EUACgkQZp//D/pH\nenaNlQ//V1o8Jg7xxp8XJEerK+XOrus2XRYCqjscy7M8xpVQagRJM+bRmY0iGjjC\nPan7+0F43rwkKMHYyaw8mqEv/TOUHXBZLahH+/NTKbY39Df58NB7ObBR2jS7kC1+\nNHzDYm3OWBB/c1XPPAauN0bjSaL7orG5UZVtLPzsy1M9zHY8jqYPXFGswI1ENexr\ntfVNjlQksxEj7EGfSdcl+/7jGfOaOQfJpa4PW+FbHwcIkguQT11Pvn7DcpIRVSVD\nIWLdYwzVj5b+XfyWgouDtCcRdfhM3oRC00y6QWFyQzgHbZosVddV+64+ZMKyArsH\nLHZb7K/cdX9G0lPbvO7ppfjBCBMIyNvqLvJTj/k5tNBX/1u4lU+XXhJiTTHAFi6l\n/qCs7auj6H5rfv6qnAbw+H3LdIfgv+PGeNSz5pD3OuTDioByVNbsLTauI2mb1HI9\nwt8mZWdzHyJFLBq1YOJcDzTo4Sq2VUYMpf4O+lY9YdU4i4EP7i1tZy+5eMDBxl5W\nqu4R4KIU2JCU1ezLxlfDfUOjcgaWEsGSxU9qYWAsiN/OnCr7r8AzrC2FkNNkQUAq\nK5DunfLrz+bg8RiNgdjK5RPoAdG4WIjNkWIJyUdkSdmKzSjtcpnccqhA/F3tZp35\nWNwOVVfKPAA3kVE5TvFA2nKBf4yNlGdq0lzYTi/9vfUbAJdhjAg=\n=AuT1\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/94ddc2dced5736612e358a3b80f2bc718fbd8161",
          "sha": "94ddc2dced5736612e358a3b80f2bc718fbd8161",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/94ddc2dced5736612e358a3b80f2bc718fbd8161"
        }
      ],
      "message": "validation: fix `MemPoolAccept` member init order\n\n`MemPoolAccept` constructs `m_view` with a backend pointer to a `CCoinsView`.\nSince class members are constructed in declaration order (not initializer-list order), calls to a virtual method (having `m_view` declared before `m_dummy`) can result in a virtual call through an uninitialized vptr and crash.\n\nWithout the move:\n```\nThe following tests FAILED:\n        112 - txdownload_tests (SEGFAULT)\n        115 - txpackage_tests (SEGFAULT)\n        118 - txvalidation_tests (SEGFAULT)\n        119 - txvalidationcache_tests (SEGFAULT)\n        127 - validation_block_tests (SEGFAULT)\n        146 - wallet_tests (SEGFAULT)\n```\n\nMove `m_dummy` before `m_view` so it is constructed first.\nIn a follow-up `m_dummy` will be completely removed, this commit was meant to demonstrate why that was necessary.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T20:25:41Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-28T10:31:32Z"
      },
      "sha": "918befc2a2341221f0fbdccbd2c89f29751122b3"
    },
    {
      "event": "reviewed",
      "id": 3622038231,
      "node_id": "PRR_kwDOABII587X4-rX",
      "url": null,
      "actor": null,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-01T20:27:10Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#pullrequestreview-3622038231",
      "submitted_at": "2026-01-01T20:27:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21821003039,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUUohUf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21821003039",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "created_at": "2026-01-01T20:42:56Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRmZDIyNmY4MTIzNjFlMjY1ZmNlZjQ0MzEyMGJkOTQ0YTgzNGViYTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4fd226f812361e265fcef443120bd944a834eba3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4fd226f812361e265fcef443120bd944a834eba3",
      "tree": {
        "sha": "90bff1e126eb0f681299faeeeb18b7ce50a5dcbe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/90bff1e126eb0f681299faeeeb18b7ce50a5dcbe"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 90bff1e126eb0f681299faeeeb18b7ce50a5dcbe\nparent 918befc2a2341221f0fbdccbd2c89f29751122b3\nauthor Lrinc <pap.lorinc@gmail.com> 1766146162 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303365 +0100\n\nrefactor: add `CCoinsViewEmpty` as a noop implementation for base and testing\n\nThis enables making `CCoinsView` purely virtual - which is done step-by-step in the following commits.\n\n`CCoinsViewEmpty` is now only constructible via `CCoinsViewEmpty::Get()`.\nSimplified all usages to delegate to the stateless singleton instead.\n\nThe fuzzer was also updated to switch randomly between real db backing and empty view.\n\nAlso reformatted and renamed affected arguments to get that out of the way.\n\nCo-authored-by: Andrew Toth <andrewstoth@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6MUACgkQZp//D/pH\nenZyUxAAs8QgRIRe4GuEPWNTPpdaTqRtOqyNe4E4Gz8bOjzW6PDzmzdQTbQ+9aWt\nUOH7cMtpZkj6Y8r3ShE0i39GpqaeeNLFfwStyulq0Pzlgux1znaClVvOjmElHeEg\nvuYgL6KVbZlKM4vkEINAbN4Q0gqox1iCvB7v1DLHEeC2c1WtGLcppLCZj0bLHpB2\nCTYZli0KH93Y1/V+nHlnnKNnb0DXazNeewmqPRGbw7sl+lHvVEsYEuMWWJHtjjTZ\n0vpkzUIGqBSm9KZzdFNfS8UjONncO0yp+Rsb5N7mTEJGHZeOATF5y0ioRYpbp6Zk\nUWYQ1p1ewL6Yn13z8q9yMT7mhGT8xMrqf7EWIAKLM5tIZ6MkWrX2JvJwL5Sjl76x\nAwmMoyi4HNXO7wjF5xaPeXRZRyhSIk8JeZU0y0oEVMFUpmTWVjfAPN3HPeKRE/GS\nuUvCeectWZYPn+g11vSlX9khBWo8MH1YvL6k5epyKSPyOZd58e2HpzmATDMW2M3G\nqPjDuEMDQZdYM9esvIK3UTc8/3BzcJDmvckIXpBjRWVXhn3waggXkCM4wHdFHmxV\nBRUhTfugyGkvnIYI6ss7BHxTJdWEz5oPEmL5dPzj+eJXIyJZkcnvoiDEHbEJEnWz\nM2looFOAUUXWkNewxnenmv39IRDVqagHUz4sGzbCs19E6Ah+cbQ=\n=u5jW\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/918befc2a2341221f0fbdccbd2c89f29751122b3",
          "sha": "918befc2a2341221f0fbdccbd2c89f29751122b3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/918befc2a2341221f0fbdccbd2c89f29751122b3"
        }
      ],
      "message": "refactor: add `CCoinsViewEmpty` as a noop implementation for base and testing\n\nThis enables making `CCoinsView` purely virtual - which is done step-by-step in the following commits.\n\n`CCoinsViewEmpty` is now only constructible via `CCoinsViewEmpty::Get()`.\nSimplified all usages to delegate to the stateless singleton instead.\n\nThe fuzzer was also updated to switch randomly between real db backing and empty view.\n\nAlso reformatted and renamed affected arguments to get that out of the way.\n\nCo-authored-by: Andrew Toth <andrewstoth@gmail.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:05Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:09:22Z"
      },
      "sha": "4fd226f812361e265fcef443120bd944a834eba3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdjMzI3Y2MwOTAzNGZkMTM3NzYxYTJlNGRjYWQ5ZWJjYzVkY2EyNWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c327cc09034fd137761a2e4dcad9ebcc5dca25a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7c327cc09034fd137761a2e4dcad9ebcc5dca25a",
      "tree": {
        "sha": "7feef7e2a813f79bac467bcae4987bfcf62b5b04",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7feef7e2a813f79bac467bcae4987bfcf62b5b04"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7feef7e2a813f79bac467bcae4987bfcf62b5b04\nparent 4fd226f812361e265fcef443120bd944a834eba3\nauthor Lrinc <pap.lorinc@gmail.com> 1766147559 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303367 +0100\n\nrefactor: make `GetCoin`, `GetBestBlock`, and `BatchWrite` purely virtual in `CCoinsView`\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6McACgkQZp//D/pH\nenYiwxAAw0wp8oiXnmqWLUKcbSSkZ74ppLxO5tqiE9uZdV82z1nXWPUo15KV7uX+\nSBPqM9A7qT4eZb7V36F84vqqPl9Xj5RDPfdkwkYhrNJSd/IAXMWVzwx9vAnTSvK9\n5gy44CFhNYtycXx22/7Gt4aht5+f/9ybcMC7PvD/wdfuR0NNN5aLMgECPyw9Prre\n3C2KW3ZQLtvfokzFA6rZEennU5eSk+MDETOOU6EReF/BD3OcAJMorplEJX3KVJ9N\nWCSgPF+IYkUv0wBJfGT0rSBqZ9b9EKwA3Sq0LQ3j8k6DmEknrtkLv5SLsVFMBDp4\nf7YuAnI7ZpVuSSapVyAn07kK1FNqY/dEhpZng7wp3vVRRt6yhlKlLLz6OQ6j8SnK\noGdC/N6aYA3HQoEH8ivl2XL8Dfdk1qYKrgGgjjVGLT27nuJIXuJoWgXU/5+pC177\ncE06oDiAi37JZYWP1D1J1X3Tci45nx4aCN4uyse99lXTyn6/xh5FM6n/eiTtENR/\n6R8CZRKs8tq2U86/fzk+tWyClx0iNRYcxQEd65lOujvi8mDJTz0WYugG4puiTGm0\n2jaOSv4pL/hNs/ffX7A2RGve6xqGRDIbjpJNptRmJ+Nc5RKNyYj3K0gGgBbZ4vla\nkZgRoeRSU8ovZS2rcgmnAN3fJDcgfgkP1ep+LNjDIcPkQr5FHmw=\n=y38m\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4fd226f812361e265fcef443120bd944a834eba3",
          "sha": "4fd226f812361e265fcef443120bd944a834eba3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4fd226f812361e265fcef443120bd944a834eba3"
        }
      ],
      "message": "refactor: make `GetCoin`, `GetBestBlock`, and `BatchWrite` purely virtual in `CCoinsView`",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:07Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:32:39Z"
      },
      "sha": "7c327cc09034fd137761a2e4dcad9ebcc5dca25a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBkYmEyYjBhMjNjYmFmZmE1NjQyZDdkMDE1OGM0MjM3NTFmMDJhZTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0dba2b0a23cbaffa5642d7d0158c423751f02ae8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0dba2b0a23cbaffa5642d7d0158c423751f02ae8",
      "tree": {
        "sha": "14463c99b657c2cee20160a1a95501aca7213231",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/14463c99b657c2cee20160a1a95501aca7213231"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 14463c99b657c2cee20160a1a95501aca7213231\nparent 7c327cc09034fd137761a2e4dcad9ebcc5dca25a\nauthor Lrinc <pap.lorinc@gmail.com> 1766146666 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303367 +0100\n\nrefactor: make `CCoinsView::EstimateSize` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6McACgkQZp//D/pH\nenb0lRAAo3SibW1M5kKw9syaPT0I0kmYQXdTnrZq2R4N/NMAijGpTdiUombGQylZ\nNhkVKqxiSZvpZloRJJ29Wn6q5RikTQ1krCwH5+VO9CV1ucXJpH1ox1tPA5/Nrdui\nMbQTTBFzKE1NpJoBV6wd2ENb+y8UvroXfWNsCU7F0dkhv0mLqjd6zI8Npq4CiSIe\nFNobrFFmkc2WInTlPGv5HgiMYHolTq5bjq443tu5XNtsXSJzz/k7kKInsB0CfbZv\nhOO0vaS1lHJR+67qhTIeT4fvlFFWzpMPEyvShweuwqRg0gAes5gNS15FmymSjTmA\nZfQlwEe4h2I0GZQ+Y7utMTwv8ZjdloWk0JYhnGC9WKtz+WApwxF3kpH1kGPGba5t\nKT73bxiXqrL2fcb7LsJB/WIPZ9AMY0j6m3zuPu2Wv1OLDo82GEAjMV05pBr6Dx3F\nJZ0SL4hjB/kCykxRMYqP1UDSj2uoAE+6b4zTsidRG5Rml59VpRVRy9jzmCoWXe4c\n73kelQ04QjX+rWeJitZunvY2rRR6t9dbvy6i8VueWAGV7xpqPswiyWAOPBM26xxe\na3YuHX8eYTEAbJvfOLfKBWChPHsUHE5RsGuTldegzvGfno3/8muFBTP+jYwoEgEB\nmBG2MzRb3mmyKzu3gOHzfFVLdaSmWCAGua3B27PGc7ggJ1oBoqA=\n=IE0r\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c327cc09034fd137761a2e4dcad9ebcc5dca25a",
          "sha": "7c327cc09034fd137761a2e4dcad9ebcc5dca25a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7c327cc09034fd137761a2e4dcad9ebcc5dca25a"
        }
      ],
      "message": "refactor: make `CCoinsView::EstimateSize` purely virtual",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:07Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:17:46Z"
      },
      "sha": "0dba2b0a23cbaffa5642d7d0158c423751f02ae8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFlZDkwNTE0YjEyYmNlNGJkZGI4MWRiNWE4OWJiYzU4Y2FjZTI0ZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ed90514b12bce4bddb81db5a89bbc58cace24ed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1ed90514b12bce4bddb81db5a89bbc58cace24ed",
      "tree": {
        "sha": "5a1ac4f9cd85e458c565260610b6b9470da6aca6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5a1ac4f9cd85e458c565260610b6b9470da6aca6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5a1ac4f9cd85e458c565260610b6b9470da6aca6\nparent 0dba2b0a23cbaffa5642d7d0158c423751f02ae8\nauthor Lrinc <pap.lorinc@gmail.com> 1766147174 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303368 +0100\n\nrefactor: make `CCoinsView::Cursor` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6MgACgkQZp//D/pH\nenarrA/9HSrDonegW3BKF44GwfsYI6y3ryuCBrLV76hXJSWvoKBDpKysxb56/ukY\n8fYWCRcrQyTyt2rVoDjU9/5FkVEabCrSHFaCjgSS7MehU0P+q37d9kpJe0dDHgoZ\nXCixVW/i7hsIv3aG09s2U4Lcs/W2bpVWGSbWQY5/z/2KASHZBVCp+RRLvLQM0p4i\nEwDRqLAOT8OYO7QHi9iUbun80jTLSMRSVlmwMGzNS5+pwwyVLfR/jDe+76YwhSPe\nPlggTxEAfv7Wl2klwjTntbyxR+5jiyL/3wYUN/+VCyYZYN4wT3vwjVvzCv+MdsIA\nYZuUbDZPVigJue1dKcmRpfLgWdOxVGy/AdkZCytpUeKfjCIGi1wk+XR9VmYkbTt9\nWlANSjdqhfnm2Bqai4MaDq3RZAtGel3vTqECLaGUt73HoALuLw26qNkkuxZNSh2X\nqRq2On7YKVtz1aHrB+qvH3ojen9W1DYPpBrFRu6yLHIGpPzhhJkmjLHytEX9eg2M\nXGt9a0dtvP5jW9M9wCwxchQP+yWqaC0Oh/T0G9LBVrC17/HD+5wOWrqhTWEJxetb\nzAOVIwWtae8pycv/+mkvuye3v9d2NvyO/qhNPQNvkokYUYqfVEpy5IC8mtCETW5i\n5hHfMRh6KMiieqaU16VeNgHZzyfDATDvDs6qfje42lZjEqfSY04=\n=pPdS\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0dba2b0a23cbaffa5642d7d0158c423751f02ae8",
          "sha": "0dba2b0a23cbaffa5642d7d0158c423751f02ae8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0dba2b0a23cbaffa5642d7d0158c423751f02ae8"
        }
      ],
      "message": "refactor: make `CCoinsView::Cursor` purely virtual",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:08Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:26:14Z"
      },
      "sha": "1ed90514b12bce4bddb81db5a89bbc58cace24ed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk1N2FjZTFjZWQzYjAwNWJiYTI2OGI5MjNhZDdlNjhlZmFjMzI0Nzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/957ace1ced3b005bba268b923ad7e68efac32478",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/957ace1ced3b005bba268b923ad7e68efac32478",
      "tree": {
        "sha": "3e574168bc61d59d0bf2e6be3c70359bdc496904",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e574168bc61d59d0bf2e6be3c70359bdc496904"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3e574168bc61d59d0bf2e6be3c70359bdc496904\nparent 1ed90514b12bce4bddb81db5a89bbc58cace24ed\nauthor Lrinc <pap.lorinc@gmail.com> 1766147680 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303368 +0100\n\nrefactor: make `CCoinsView::GetHeadBlocks` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6MgACgkQZp//D/pH\nenafWQ//RksE3ig3ksyyxn+OJF9UYcuo1aHqf1L7NaMVJr5p/lv23uAKCjHbwiB+\npyDt7faev1q5JfexB+3oUX0zjwEfbEnLoZj65xkS+KV57a6TJrDbwZZIDrRVsfa1\nFomej7epI0KGv246xZQ88PFcvitybPHK5waY/EHObpqPGU4fKRBC6RQXdX/uT9pT\nlKlx1DsEPob1iu14/2Saj5ly865ERYUcYW4+foEab2yq8yDUu/0hsea7IMfzUiml\nG9SAlmPwkSmG9x1ZXeSKFRTYzAY4Pz1Qe0YqEn/ejFdaOZspi0HLbdT9jexwsoj6\nKtesoNfMrAc9JcIs8dGrYfIIety786BUq4c4n6uuQwHXkswNu1CdhQhCzPkSPv5+\nub58MTfdBPWdqrkc3Hw2Dz5Q3/zdGDVwyYdFAd3UtmvY8g54MU1GkHtRJZC6Yiac\nF5ZF3QORZtCa+x9F+099q6uOG/B1PrbV3dNd2Gry9dENFwZFBdo/2R9p5VP0MMrT\n64FLEFLuoAGfrlUrqc+LwICgUA/p7BqeR8x6M838TFF42kxoemhavW24N5d+5WEr\nO24v9WGRBUxJmDqjJygMEQmV53MvCOP3Dk55ASRwPqCuRiZBuP9bXV6m/kAGroDZ\n/5dvl9FOt7muE96TWFEK26tAMh76uBqkSAGRbaOauzL0LfTnmQ8=\n=G3W7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ed90514b12bce4bddb81db5a89bbc58cace24ed",
          "sha": "1ed90514b12bce4bddb81db5a89bbc58cace24ed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1ed90514b12bce4bddb81db5a89bbc58cace24ed"
        }
      ],
      "message": "refactor: make `CCoinsView::GetHeadBlocks` purely virtual",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:08Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:34:40Z"
      },
      "sha": "957ace1ced3b005bba268b923ad7e68efac32478"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk5NTY2MTY2ZTE3NjczMTQ2YjI4NDA0OWIxZjQ5OWRhYmRiZDg5NTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/99566166e17673146b284049b1f499dabdbd8953",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/99566166e17673146b284049b1f499dabdbd8953",
      "tree": {
        "sha": "96097f625ab9824bb93f1c38a77c4daa7dadd62a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/96097f625ab9824bb93f1c38a77c4daa7dadd62a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 96097f625ab9824bb93f1c38a77c4daa7dadd62a\nparent 957ace1ced3b005bba268b923ad7e68efac32478\nauthor Lrinc <pap.lorinc@gmail.com> 1766147784 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303368 +0100\n\nrefactor: make `CCoinsView::HaveCoin` purely virtual\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6MkACgkQZp//D/pH\nenbcug/+IQ4iEQYWt7C+jUS5dQPCuJMCvZtDP12el7NEVI6Nb1ITdplzHyjx8X64\n2U6dzHLjPSE+IqOD8FEOoby1oYv084Z+PxAgXZHiCjJPItpYdtCg0Xar/mJCvHWc\ncDykLMgFpFES6fjPvmyaHlGMTXd8JHXrlDvANubN/A0wwDl+nrWSyKAv//WcVZJx\n2Ciilhoxo8ty7/XBXoGn+9v6iWYPJhKg1kOQ0rmGCz2qMwdbwGrVImEwaorDK4+f\nR48RetnRcn+oCB246UxGMNqWLIhg8EoeClUynzBq62jDyTgPGS9eam5RhbEyZxrR\n3Fgms4AEFAGhloL0+HsxIdItDOAhZYoqrELBLJe6BaNkDP7oj9HTKaiY1a+1TR6l\n5/2AjGxLpLZ1ESqRblQ+kY7K2wkl4KSFeowjbTCE9fydc0V/RSTS6Ti5RTnBWcMV\n4mU9sXyhb93f56OP1x1b1YShgKjrm9TJQgMTgDeU7XFLNnuMUhFDq/3kG1yvBJZP\nfXGMasyAfdjzbl+ZUZcRz+0uXSUKvhY2c+XLp54pSSozNilJyyqRdUutinQF1yaq\neP1aQPv8ir50watAc8gXYrXlmRxwdsEM4UApyT3n+IXC8aKf/VV2kBfh8kQ1+hEQ\nt448mvFK+YbmdV8pQ3QjnSb/S5RS+w7/ChE0kQ55J2u2pvdmEV0=\n=gubV\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/957ace1ced3b005bba268b923ad7e68efac32478",
          "sha": "957ace1ced3b005bba268b923ad7e68efac32478",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/957ace1ced3b005bba268b923ad7e68efac32478"
        }
      ],
      "message": "refactor: make `CCoinsView::HaveCoin` purely virtual",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:08Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-19T12:36:24Z"
      },
      "sha": "99566166e17673146b284049b1f499dabdbd8953"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUzZDQ0MzViOTRmZjdhMTE1M2QwNmUzZTZiYjcwOTQzMWIxOGI3NmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "tree": {
        "sha": "6c863716a13cb9ae4704498aaae90c80f4bb5ba2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6c863716a13cb9ae4704498aaae90c80f4bb5ba2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6c863716a13cb9ae4704498aaae90c80f4bb5ba2\nparent 99566166e17673146b284049b1f499dabdbd8953\nauthor Lrinc <pap.lorinc@gmail.com> 1766438006 +0200\ncommitter Lrinc <pap.lorinc@gmail.com> 1767303369 +0100\n\nrefactor: inline `CCoinsViewBacked` implementation to header\n\nIt's a simple delegate, the cpp is already really crowded, let's do these inline.\n\nAlso note that the `CCoinsViewBacked` constructor is asserted to not take any `nullptr` values anymore, since the reason why `base` was stored as a pointer was that references cannot be reallocated, and we need to call `SetBackend` in a few places - which takes a reference, also proving that `nullptr` was never the goal.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlW6MkACgkQZp//D/pH\nenYZZA/+IOvBzQ5LtP5bfDf5xVP87/u6OLWD9x8/ZJXt6oCayMZ9XcYIKjc07Ed2\nATnFXAGu3YHzlX7vjSyyolqLp3DHNkEklMn0cED9O4nGmHUaIFUnNO693NSYGPMJ\nnW/XWHgXgbNGB/aH4Vgxl9qzg//wWqyb2LxMBLLC+ti0/9r154r6zGOpZS15AnsV\n4j7vIPY+Al210PWVZbFla82XYTgiRf8LPDaKejA1W5pxk42C67ugMTjDyFo1W7CX\nqiT/t5tecwvmLvT3xFov1qw2JGsN5e8VM09hOX6NbgjvgFSKMqJ4jDgIQ5KJnCue\nKuZPepKrsy60ZxVitWM5pxuTR1bLsZBxlEWBFo8UFF3+Cqr22/W5Bd0pzJsDtdfq\nNB5bnetItaaCC6whpfaDoMXbTnKQIWNT8e6Wr3PKR62kujyyT94qAUu06rs/0bt4\n8MbCfKay7ces9wTrxbv5SopyM2jgxtSYp0xHdghF2btsd5fkiSeMbM66+PNaN+Jm\nsr6QVKocXfYVGhoUh7cZSbcvS5l/92ShNcNshay19oZbp8VtihT2ZT5v8i2LurPd\nkG6UcYXuBCKxXFbkauzLVNPvnSqVrOGmq2Q2yBSq2m7ybuA0Jw4fBDLDE2WznP3Y\nghciAbafKpxNOJYEkcUx5DDuiXvtSYKEEY8i+aeS01HAZZDe3DE=\n=uce3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/99566166e17673146b284049b1f499dabdbd8953",
          "sha": "99566166e17673146b284049b1f499dabdbd8953",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/99566166e17673146b284049b1f499dabdbd8953"
        }
      ],
      "message": "refactor: inline `CCoinsViewBacked` implementation to header\n\nIt's a simple delegate, the cpp is already really crowded, let's do these inline.\n\nAlso note that the `CCoinsViewBacked` constructor is asserted to not take any `nullptr` values anymore, since the reason why `base` was stored as a pointer was that references cannot be reallocated, and we need to call `SetBackend` in a few places - which takes a reference, also proving that `nullptr` was never the goal.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-01T21:36:09Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-22T21:13:26Z"
      },
      "sha": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21821305216,
      "node_id": "HRFPE_lADOABII587fgV9xzwAAAAUUprGA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21821305216",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "created_at": "2026-01-01T21:36:41Z"
    },
    {
      "event": "commented",
      "id": 3706625018,
      "node_id": "IC_kwDOABII587c7pv6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3706625018",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T02:36:48Z",
      "updated_at": "2026-01-03T02:36:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#issuecomment-3706625018",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34124"
    },
    {
      "event": "labeled",
      "id": 21833960474,
      "node_id": "LE_lADOABII587fgV9xzwAAAAUVZ8wa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21833960474",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T02:36:48Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581366",
      "pull_request_review_id": 3602578034,
      "id": 2638581366,
      "node_id": "PRRC_kwDOABII586dRY52",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Don't see any value in deleting these in a separate commit from making them pure virtual.",
      "created_at": "2025-12-22T04:18:46Z",
      "updated_at": "2025-12-22T04:23:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2638581366",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581846",
      "pull_request_review_id": 3602578034,
      "id": 2638581846,
      "node_id": "PRRC_kwDOABII586dRZBW",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}",
      "path": "src/coins.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I could see keeping this one; it seems like a reasonable default?",
      "created_at": "2025-12-22T04:19:14Z",
      "updated_at": "2025-12-22T04:23:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2638581846",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2638581846"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 25,
      "original_line": 25,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641275940",
      "pull_request_review_id": 3605780432,
      "id": 2641275940,
      "node_id": "PRRC_kwDOABII586dbqwk",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": 2638581366,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Indeed, moved each deletion to the commit that made the method pure, thanks.\r\nAlso made the empty class a singleton which simplified all nested usages significantly.\r\nAnd inlined the trivial implementation of `*Backing` to the header to reduce the clutter in the cpp a bit more.\r\nhttps://github.com/bitcoin/bitcoin/compare/38ae4082a13b2e6dd07e84d228c9e58d3df27b11..d5c77c71428b667b9c9f1a8eb84a75d5874b85af",
      "created_at": "2025-12-22T21:19:08Z",
      "updated_at": "2025-12-23T08:08:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2641275940",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641275940"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 20,
      "original_line": 20,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641276223",
      "pull_request_review_id": 3605780748,
      "id": 2641276223,
      "node_id": "PRRC_kwDOABII586dbq0_",
      "diff_hunk": "@@ -13,17 +13,6 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}",
      "path": "src/coins.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "38ae4082a13b2e6dd07e84d228c9e58d3df27b11",
      "in_reply_to_id": 2638581846,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We need this method because of the specialized database access which doesn't need to deserialize the read value:\r\n* https://github.com/bitcoin/bitcoin/blob/fa5f29774872d18febc0df38831a6e45f3de69cc/src/txdb.cpp#L74-L76\r\n\r\nOtherwise we could of course replace it with `!!GetCoin(outpoint)`:\r\n* https://github.com/bitcoin/bitcoin/blob/7f295e1d9b44c225c823242c1f04239f46fb27a6/src/coins.cpp#L166-L169\r\n\r\nWe're not even really using the former in production code anyway (see https://github.com/bitcoin/bitcoin/pull/34132), we could probably easily inline the `!!GetCoin(outpoint)` to the few remaining call sites instead. Regardless, the current change should simplify usage and we can investigate that later.\r\n\r\n------\r\n\r\nAlso, the underlying problem is that having a separate `CCoinsView` makes adding defaults weird, there's no logical default behavior.\r\nBut we could inline it into `CCoinsViewBacked` (and delete `CCoinsView` and rename `CCoinsViewBacked` back to `CCoinsView`)  and use that as the base for the other caches, with the default implementation simply delegating to `base`, something like:\r\n```patch\r\ndiff --git a/src/coins.cpp b/src/coins.cpp\r\nindex 9bdcb42f45..4f66ed447b 100644\r\n--- a/src/coins.cpp\r\n+++ b/src/coins.cpp\r\n@@ -14,7 +14,7 @@ TRACEPOINT_SEMAPHORE(utxocache, spent);\r\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\r\n \r\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\r\n-    CCoinsViewBacked(baseIn), m_deterministic(deterministic),\r\n+    CCoinsView(baseIn), m_deterministic(deterministic),\r\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\r\n {\r\n     m_sentinel.second.SelfRef(m_sentinel);\r\n@@ -362,10 +362,10 @@ static ReturnType ExecuteBackedWrapper(Func func, const std::vector<std::functio\r\n \r\n std::optional<Coin> CCoinsViewErrorCatcher::GetCoin(const COutPoint& outpoint) const\r\n {\r\n-    return ExecuteBackedWrapper<std::optional<Coin>>([&]() { return CCoinsViewBacked::GetCoin(outpoint); }, m_err_callbacks);\r\n+    return ExecuteBackedWrapper<std::optional<Coin>>([&]() { return CCoinsView::GetCoin(outpoint); }, m_err_callbacks);\r\n }\r\n \r\n bool CCoinsViewErrorCatcher::HaveCoin(const COutPoint& outpoint) const\r\n {\r\n-    return ExecuteBackedWrapper<bool>([&]() { return CCoinsViewBacked::HaveCoin(outpoint); }, m_err_callbacks);\r\n+    return ExecuteBackedWrapper<bool>([&]() { return CCoinsView::HaveCoin(outpoint); }, m_err_callbacks);\r\n }\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex a64f30376d..7e8120f710 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -303,37 +303,46 @@ private:\r\n     bool m_will_erase;\r\n };\r\n \r\n-/** Pure abstract view on the open txout dataset. */\r\n+/** Coins view backed by another CCoinsView. */\r\n class CCoinsView\r\n {\r\n+protected:\r\n+    CCoinsView* base{nullptr};\r\n+\r\n+    CCoinsView() = default;\r\n+\r\n public:\r\n+    explicit CCoinsView(CCoinsView* viewIn) : base(Assert(viewIn)) {}\r\n+\r\n     //! As we use CCoinsViews polymorphically, have a virtual destructor\r\n     virtual ~CCoinsView() = default;\r\n \r\n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\r\n+\r\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\r\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\r\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\r\n \r\n     //! Just check whether a given outpoint is unspent.\r\n-    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\r\n+    virtual bool HaveCoin(const COutPoint& outpoint) const { return base->HaveCoin(outpoint); }\r\n \r\n     //! Retrieve the block hash whose state this CCoinsView currently represents\r\n-    virtual uint256 GetBestBlock() const = 0;\r\n+    virtual uint256 GetBestBlock() const { return base->GetBestBlock(); }\r\n \r\n     //! Retrieve the range of blocks that may have been only partially written.\r\n     //! If the database is in a consistent state, the result is the empty vector.\r\n     //! Otherwise, a two-element vector is returned consisting of the new and\r\n     //! the old block hash, in that order.\r\n-    virtual std::vector<uint256> GetHeadBlocks() const = 0;\r\n+    virtual std::vector<uint256> GetHeadBlocks() const { return base->GetHeadBlocks(); }\r\n \r\n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\r\n     //! The passed cursor is used to iterate through the coins.\r\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\r\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) { return base->BatchWrite(cursor, hashBlock); }\r\n \r\n     //! Get a cursor to iterate over the whole state\r\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\r\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const { return base->Cursor(); }\r\n \r\n     //! Estimate database size\r\n-    virtual size_t EstimateSize() const = 0;\r\n+    virtual size_t EstimateSize() const { return base->EstimateSize(); }\r\n };\r\n \r\n /** Noop coins view. */\r\n@@ -361,28 +370,8 @@ public:\r\n     size_t EstimateSize() const override { return 0; }\r\n };\r\n \r\n-/** CCoinsView backed by another CCoinsView */\r\n-class CCoinsViewBacked : public CCoinsView\r\n-{\r\n-protected:\r\n-    CCoinsView* base;\r\n-\r\n-public:\r\n-    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{viewIn} {}\r\n-\r\n-    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\r\n-\r\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base->GetCoin(outpoint); }\r\n-    bool HaveCoin(const COutPoint& outpoint) const override { return base->HaveCoin(outpoint); }\r\n-    uint256 GetBestBlock() const override { return base->GetBestBlock(); }\r\n-    std::vector<uint256> GetHeadBlocks() const override { return base->GetHeadBlocks(); }\r\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base->BatchWrite(cursor, hashBlock); }\r\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return base->Cursor(); }\r\n-    size_t EstimateSize() const override { return base->EstimateSize(); }\r\n-};\r\n-\r\n /** CCoinsView that adds a memory cache for transactions to another CCoinsView */\r\n-class CCoinsViewCache : public CCoinsViewBacked\r\n+class CCoinsViewCache : public CCoinsView\r\n {\r\n private:\r\n     const bool m_deterministic;\r\n@@ -534,10 +523,10 @@ const Coin& AccessByTxid(const CCoinsViewCache& cache, const Txid& txid);\r\n  *\r\n  * Writes do not need similar protection, as failure to write is handled by the caller.\r\n */\r\n-class CCoinsViewErrorCatcher final : public CCoinsViewBacked\r\n+class CCoinsViewErrorCatcher final : public CCoinsView\r\n {\r\n public:\r\n-    explicit CCoinsViewErrorCatcher(CCoinsView* view) : CCoinsViewBacked(view) {}\r\n+    explicit CCoinsViewErrorCatcher(CCoinsView* view) : CCoinsView(view) {}\r\n \r\n     void AddReadErrCallback(std::function<void()> f) {\r\n         m_err_callbacks.emplace_back(std::move(f));\r\ndiff --git a/src/txmempool.cpp b/src/txmempool.cpp\r\nindex 4dc692bfd8..3e47428e8e 100644\r\n--- a/src/txmempool.cpp\r\n+++ b/src/txmempool.cpp\r\n@@ -720,7 +720,7 @@ bool CTxMemPool::HasNoInputsOf(const CTransaction &tx) const\r\n     return true;\r\n }\r\n \r\n-CCoinsViewMemPool::CCoinsViewMemPool(CCoinsView* baseIn, const CTxMemPool& mempoolIn) : CCoinsViewBacked(baseIn), mempool(mempoolIn) { }\r\n+CCoinsViewMemPool::CCoinsViewMemPool(CCoinsView* baseIn, const CTxMemPool& mempoolIn) : CCoinsView(baseIn), mempool(mempoolIn) { }\r\n \r\n std::optional<Coin> CCoinsViewMemPool::GetCoin(const COutPoint& outpoint) const\r\n {\r\ndiff --git a/src/txmempool.h b/src/txmempool.h\r\nindex 166a024823..4c24766c77 100644\r\n--- a/src/txmempool.h\r\n+++ b/src/txmempool.h\r\n@@ -778,7 +778,7 @@ public:\r\n  * signrawtransactionwithkey and signrawtransactionwithwallet,\r\n  * as long as the conflicting transaction is not yet confirmed.\r\n  */\r\n-class CCoinsViewMemPool : public CCoinsViewBacked\r\n+class CCoinsViewMemPool : public CCoinsView\r\n {\r\n     /**\r\n     * Coins made available by transactions being validated. Tracking these allows for package\r\n\r\n```\r\n\r\nThis would introduce a sensible default as the base class behavior (always delegating) and we'd instantiate it with the empty sigleton, which would always do nothin'.\r\nI haven't included this yet, we can discuss if it's a good idea.",
      "created_at": "2025-12-22T21:19:13Z",
      "updated_at": "2025-12-22T21:19:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2641276223",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641276223"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 25,
      "original_line": 25,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650048046",
      "pull_request_review_id": 3614915324,
      "id": 2650048046,
      "node_id": "PRRC_kwDOABII586d9IYu",
      "diff_hunk": "@@ -722,6 +722,11 @@ class MemPoolAccept\n     }\n \n private:\n+    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\n+     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\n+     * were pulled from disk. */\n+    CCoinsView m_dummy;\n+",
      "path": "src/validation.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "original_commit_id": "436765c23a009c18a2a8e29e8b9534924e80d1d0",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit 436765c23a009c18a2a8e29e8b9534924e80d1d0, it looks like you forgot to include the removal diff.\r\n\r\nEdit: It's doubly removed in 148a0a94c65425b7ea9b6cc667502167b8c1c7a0, but that second removal should be here.",
      "created_at": "2025-12-29T01:33:36Z",
      "updated_at": "2025-12-29T05:31:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650048046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650048046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 729,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650227623",
      "pull_request_review_id": 3615075843,
      "id": 2650227623,
      "node_id": "PRRC_kwDOABII586d90On",
      "diff_hunk": "@@ -378,6 +403,7 @@ class CCoinsViewCache : public CCoinsViewBacked\n \n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n+    CCoinsViewCache() : CCoinsViewCache{&CCoinsViewEmpty::Get()} {}",
      "path": "src/coins.h",
      "position": 124,
      "original_position": 111,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should this constructor be on `CCoinsViewBacked` instead?",
      "created_at": "2025-12-29T05:39:46Z",
      "updated_at": "2025-12-29T05:39:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650227623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650227623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 410,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650234336",
      "pull_request_review_id": 3615082648,
      "id": 2650234336,
      "node_id": "PRRC_kwDOABII586d913g",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure about this sanity check. We're checking that a call to this method will work? Is this better than an assertion that baseIn is non-null? Why not refactor `baseIn` to be a reference?",
      "created_at": "2025-12-29T05:46:39Z",
      "updated_at": "2025-12-29T05:46:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650234336",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650234336"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650833138",
      "pull_request_review_id": 3615731889,
      "id": 2650833138,
      "node_id": "PRRC_kwDOABII586eAIDy",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "it's not null, it will give illegal access since it points to a random address. Try reverting and running any of the mentioned tests from the commit message.",
      "created_at": "2025-12-29T12:07:36Z",
      "updated_at": "2025-12-29T12:07:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2650833138",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2650833138"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651156940",
      "pull_request_review_id": 3616078914,
      "id": 2651156940,
      "node_id": "PRRC_kwDOABII586eBXHM",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ok, but if it's a pointer it is legal for it to be a nullptr. So we should check first if it is not nullptr.\r\nAlso, instead of accessing a method, we could do a dynamic cast to `CCoinsView*` and assert the result.\r\n```suggestion\r\n    assert(!base || dynamic_cast<CCoinsView*>(base));\r\n```",
      "created_at": "2025-12-29T14:58:56Z",
      "updated_at": "2025-12-29T17:13:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651156940",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651156940"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651708755",
      "pull_request_review_id": 3616683354,
      "id": 2651708755,
      "node_id": "PRRC_kwDOABII586eDd1T",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`assert(!base || dynamic_cast<CCoinsView*>(base));` doesn't trigger the failure.\r\n\r\nReverting `m_dummy` (which I did accidentally in the first commit already):\r\n```patch\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\n--- a/src/validation.cpp\t(revision 5f5ff9798098a7cf9c5311dc54c615245fec1a3b)\r\n+++ b/src/validation.cpp\t(date 1767039346685)\r\n@@ -722,11 +722,6 @@\r\n     }\r\n \r\n private:\r\n-    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\r\n-     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\r\n-     * were pulled from disk. */\r\n-    CCoinsView m_dummy;\r\n-\r\n     CTxMemPool& m_pool;\r\n \r\n     /** Holds a cached view of available coins from the UTXO set, mempool, and artificial temporary coins (to enable package validation).\r\n@@ -746,6 +741,10 @@\r\n     /** When m_view is connected to m_viewmempool as its backend, it can pull coins from the mempool and from the UTXO\r\n      * set. This is also where temporary coins are stored. */\r\n     CCoinsViewMemPool m_viewmempool;\r\n+    /** When m_view is connected to m_dummy, it can no longer look up coins from the mempool or UTXO set (meaning no disk\r\n+     * operations happen), but can still return coins it accessed previously. Useful for keeping track of which coins\r\n+     * were pulled from disk. */\r\n+    CCoinsView m_dummy;\r\n \r\n     Chainstate& m_active_chainstate;\r\n```\r\n\r\nAnd running:\r\n> cmake -B build  -DCMAKE_BUILD_TYPE=Debug && cmake --build build && ./build/bin/test_bitcoin --run_test=wallet_tests\r\n\r\nfails correctly with:\r\n> Running 13 test cases...\r\n> ******** errors disabling the alternate stack:\r\n>         #error:22\r\n>         Invalid argument\r\n> unknown location:0: fatal error: in \"wallet_tests/CreateWallet\": memory access violation at address: 0x5f4d1884: invalid permissions\r\n>  wallet/test/wallet_tests.cpp:622: last checkpoint\r\n\r\nMoved the proper removal to the first commit: https://github.com/bitcoin/bitcoin/compare/784769b5b1a8465d1a09ec489a303c4616d11896..a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "created_at": "2025-12-29T20:20:22Z",
      "updated_at": "2025-12-29T20:22:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651708755",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651708755"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651711783",
      "pull_request_review_id": 3616686593,
      "id": 2651711783,
      "node_id": "PRRC_kwDOABII586eDekn",
      "diff_hunk": "@@ -378,6 +403,7 @@ class CCoinsViewCache : public CCoinsViewBacked\n \n public:\n     CCoinsViewCache(CCoinsView *baseIn, bool deterministic = false);\n+    CCoinsViewCache() : CCoinsViewCache{&CCoinsViewEmpty::Get()} {}",
      "path": "src/coins.h",
      "position": 124,
      "original_position": 111,
      "commit_id": "e3d4435b94ff7a1153d06e3e6bb709431b18b76b",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650227623,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How so? We have to init `m_deterministic` as well...",
      "created_at": "2025-12-29T20:21:32Z",
      "updated_at": "2025-12-29T20:21:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2651711783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2651711783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 410,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652027175",
      "pull_request_review_id": 3617058212,
      "id": 2652027175,
      "node_id": "PRRC_kwDOABII586eErkn",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hmm dynamic casting uninitialized memory should be UB as well, but I guess it doesn't trigger a memory access violation.\r\nBut, we still need to check that `base` is not `nullptr` before accessing, otherwise passing `nullptr` would trigger undefined behavior.",
      "created_at": "2025-12-30T01:08:33Z",
      "updated_at": "2025-12-30T01:08:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2652027175",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652027175"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652387942",
      "pull_request_review_id": 3617447177,
      "id": 2652387942,
      "node_id": "PRRC_kwDOABII586eGDpm",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "i don't think we support nullptr currently - it's why we have a default implementation with dummy values. ",
      "created_at": "2025-12-30T07:21:04Z",
      "updated_at": "2025-12-30T07:21:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2652387942",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2652387942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653138327",
      "pull_request_review_id": 3618429076,
      "id": 2653138327,
      "node_id": "PRRC_kwDOABII586eI62X",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The API supports it. I use it in #31132. If we want to disallow it then we should change the parameter to a reference.",
      "created_at": "2025-12-30T14:35:02Z",
      "updated_at": "2025-12-30T14:35:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653138327",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653138327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653248652",
      "pull_request_review_id": 3618585105,
      "id": 2653248652,
      "node_id": "PRRC_kwDOABII586eJVyM",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "As I understand it, this is sanity testing through triggering UB in the case the bug is present. I don't think that is ideal, as the compiler is allowed to assume it won't happen and optimize it away. This isn't too far fetched - if it could be inferred that (all implementations of) `CCoinsView::GetBestBlock` are side-effect free, then the statement `(void)base->GetBestBlock();` could just be optimized away.\n\nTesting for bugs due to initialization order seems more like a job for UBSan. Unfortunately, it seems none of the current fuzz tests (with UBSan enabled) trigger with the following patch (on master):\n\n```diff\ndiff --git a/src/coins.cpp b/src/coins.cpp\nindex 14381ecb0aa..c7206c22554 100644\n--- a/src/coins.cpp\n+++ b/src/coins.cpp\n@@ -38,6 +38,7 @@ CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    assert(!base || dynamic_cast<CCoinsView*>(base));\n     m_sentinel.second.SelfRef(m_sentinel);\n }\n```\n\nI'm not objecting to this change, but I think it would be better if we could test for bugs of this class in a more systematic way.\n",
      "created_at": "2025-12-30T15:31:21Z",
      "updated_at": "2025-12-30T16:21:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653248652",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653248652"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653974593",
      "pull_request_review_id": 3619382385,
      "id": 2653974593,
      "node_id": "PRRC_kwDOABII586eMHBB",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> The API supports it. I use it in https://github.com/bitcoin/bitcoin/pull/31132. If we want to disallow it then we should change the parameter to a reference.\r\n\r\nMy understanding is that it was stored as a pointer since references cannot be reallocated and we need to call `SetBackend` currently in a few places (which takes a reference, also proving that `nullptr` was never the goal).\r\nWe can change it to `std::reference_wrapper<CCoinsView> base` but it would trigger a huge changeset if it percolates to getting rid of all pointers in the constructors. But I don't mind adding an `Assert` to forbid that at least during runtime and fix the constructor and call sites after this PR is merged:\r\n```C++\r\nclass CCoinsViewBacked : public CCoinsView\r\n{\r\nprotected:\r\n    std::reference_wrapper<CCoinsView> base;\r\n\r\npublic:\r\n    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{*Assert(viewIn)} {} // TODO change to reference\r\n\r\n    void SetBackend(CCoinsView& viewIn) { base = std::ref(viewIn); }\r\n\r\n    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base.get().GetCoin(outpoint); }\r\n    bool HaveCoin(const COutPoint& outpoint) const override { return base.get().HaveCoin(outpoint); }\r\n    uint256 GetBestBlock() const override { return base.get().GetBestBlock(); }\r\n    std::vector<uint256> GetHeadBlocks() const override { return base.get().GetHeadBlocks(); }\r\n    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base.get().BatchWrite(cursor, hashBlock); }\r\n    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return base.get().Cursor(); }\r\n    size_t EstimateSize() const override { return base.get().EstimateSize(); }\r\n};\r\n```",
      "created_at": "2025-12-30T22:07:07Z",
      "updated_at": "2025-12-30T22:07:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653974593",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653974593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653979894",
      "pull_request_review_id": 3619387129,
      "id": 2653979894,
      "node_id": "PRRC_kwDOABII586eMIT2",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Sorry if I was unclear. `base` should remain a pointer. `viewIn` should be a reference in the constructor, as it is in `SetBackend`.",
      "created_at": "2025-12-30T22:09:14Z",
      "updated_at": "2025-12-30T22:09:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2653979894",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2653979894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654002456",
      "pull_request_review_id": 3619410447,
      "id": 2654002456,
      "node_id": "PRRC_kwDOABII586eMN0Y",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> viewIn should be a reference in the constructor\r\n\r\nyeah, that's what I meant by:\r\n\r\n> it would trigger a huge changeset if it percolates to getting rid of all pointers in the constructors\r\n\r\nIt triggered changes in 22 files so far - I have stopped refactoring after a while. We can prohibit new `nullptr` bases via an `Assert` for now, and clean up this area in a separate PR since it's a bit messy.",
      "created_at": "2025-12-30T22:17:45Z",
      "updated_at": "2025-12-30T22:19:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2654002456",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654002456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654282589",
      "pull_request_review_id": 3619698402,
      "id": 2654282589,
      "node_id": "PRRC_kwDOABII586eNSNd",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I don't think that is ideal, as the compiler is allowed to assume it won't happen and optimize it away.\r\n\r\nI needed something to demonstrate the UB - and that it's fixed now, so [I have removed this reproducer in the second commit](https://github.com/bitcoin/bitcoin/compare/a69ea84b83d22c66ddeeba6d27b761036d6fec40..b23d784b6baee140f75882fe009be5676db4cb0b#diff-f0ed73d62dae6ca28ebd3045e5fc0d5d02eaaacadb4c2a292985a3fbd7e1c77cL20). Would be cool if we could instrument the code with something like `-fsanitize=vptr` or `-Wreorder-ctor` (haven't tried any of them, not sure they would have found this one).\r\n\r\nI've also [added the `Assert`](https://github.com/bitcoin/bitcoin/compare/a69ea84b83d22c66ddeeba6d27b761036d6fec40..b23d784b6baee140f75882fe009be5676db4cb0b#diff-095ce1081a930998a10b37358fae5499ac47f8cb6f25f5df5d88e920a54e0341L371) to prohibit `nullptr` bases in `CCoinsViewBacked` - we should use `CCoinsViewEmpty::Get()` from now on to stop the propagation.",
      "created_at": "2025-12-30T23:18:12Z",
      "updated_at": "2025-12-31T06:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2654282589",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2654282589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656573494",
      "pull_request_review_id": 3622026233,
      "id": 2656573494,
      "node_id": "PRRC_kwDOABII586eWBg2",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 34,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& block_hash) = 0;\r\n```",
      "created_at": "2026-01-01T19:44:57Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656573494",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656573494"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656574800",
      "pull_request_review_id": 3622026233,
      "id": 2656574800,
      "node_id": "PRRC_kwDOABII586eWB1Q",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 69,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should we iterate through the cursor here to clear it, and return `true`? If we return `false` we leave the parent cache in an inconsistent state.",
      "created_at": "2026-01-01T19:47:55Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656574800",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656574800"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656574925",
      "pull_request_review_id": 3622026233,
      "id": 2656574925,
      "node_id": "PRRC_kwDOABII586eWB3N",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 92,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    explicit CCoinsViewBacked(CCoinsView* view_in) : base{Assert(view_in)} {}\r\n```",
      "created_at": "2026-01-01T19:48:10Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656574925",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656574925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 371,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656575022",
      "pull_request_review_id": 3622026233,
      "id": 2656575022,
      "node_id": "PRRC_kwDOABII586eWB4u",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}\n \n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 94,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    void SetBackend(CCoinsView& view_in) { base = &view_in; }\r\n```",
      "created_at": "2026-01-01T19:48:22Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656575022",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656575022"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 373,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656575277",
      "pull_request_review_id": 3622026233,
      "id": 2656575277,
      "node_id": "PRRC_kwDOABII586eWB8t",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}\n \n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\n+\n+    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base->GetCoin(outpoint); }\n+    bool HaveCoin(const COutPoint& outpoint) const override { return base->HaveCoin(outpoint); }\n+    uint256 GetBestBlock() const override { return base->GetBestBlock(); }\n+    std::vector<uint256> GetHeadBlocks() const override { return base->GetHeadBlocks(); }\n+    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base->BatchWrite(cursor, hashBlock); }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 100,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& block_hash) override { return base->BatchWrite(cursor, block_hash); }\r\n```",
      "created_at": "2026-01-01T19:48:53Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656575277",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656575277"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 379,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656576235",
      "pull_request_review_id": 3622026233,
      "id": 2656576235,
      "node_id": "PRRC_kwDOABII586eWCLr",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure we need this commit at all, since the PR deletes `m_dummy` and doesn't keep this line either.",
      "created_at": "2026-01-01T19:50:43Z",
      "updated_at": "2026-01-01T19:50:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656576235",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656576235"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656592223",
      "pull_request_review_id": 3622038231,
      "id": 2656592223,
      "node_id": "PRRC_kwDOABII586eWGFf",
      "diff_hunk": "@@ -93,10 +93,11 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                 coins_view_cache.Uncache(random_out_point);\n             },\n             [&] {\n-                if (fuzzed_data_provider.ConsumeBool()) {\n-                    backend_coins_view = CCoinsView{};\n+                if (is_db || fuzzed_data_provider.ConsumeBool()) {",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We want to keep the behavior of resetting the backend.\r\n\r\n```suggestion\r\n                if (is_db || fuzzed_data_provider.ConsumeBool()) {\r\n                    auto db_params = DBParams{\r\n                        .path = \"\",\r\n                        .cache_bytes = 1_MiB,\r\n                        .memory_only = true,\r\n                    };\r\n                    backend_coins_view = CCoinsViewDB{std::move(db_params), CoinsViewOptions{}};\r\n                }\r\n                coins_view_cache.SetBackend(backend_coins_view);\r\n```",
      "created_at": "2026-01-01T20:27:10Z",
      "updated_at": "2026-01-01T20:27:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656592223",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656592223"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599709",
      "pull_request_review_id": 3622042612,
      "id": 2656599709,
      "node_id": "PRRC_kwDOABII586eWH6d",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 34,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656573494,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done in the second commit to get that out of the way.",
      "created_at": "2026-01-01T20:42:57Z",
      "updated_at": "2026-01-01T20:42:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656599709",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599709"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599768",
      "pull_request_review_id": 3622042643,
      "id": 2656599768,
      "node_id": "PRRC_kwDOABII586eWH7Y",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 69,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656574800,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> If we return false \r\n\r\nI expect this to be merged after https://github.com/bitcoin/bitcoin/pull/33866/files#diff-f0ed73d62dae6ca28ebd3045e5fc0d5d02eaaacadb4c2a292985a3fbd7e1c77cR19-R22, where there is no return value anymore.\r\n\r\n> Should we iterate through the cursor here to clear it\r\n\r\nThanks, done.",
      "created_at": "2026-01-01T20:43:04Z",
      "updated_at": "2026-01-01T20:43:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656599768",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599768"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 359,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599790",
      "pull_request_review_id": 3622042662,
      "id": 2656599790,
      "node_id": "PRRC_kwDOABII586eWH7u",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 92,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656574925,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-01-01T20:43:08Z",
      "updated_at": "2026-01-01T20:43:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656599790",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599790"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 371,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599809",
      "pull_request_review_id": 3622042685,
      "id": 2656599809,
      "node_id": "PRRC_kwDOABII586eWH8B",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}\n \n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 94,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656575022,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-01-01T20:43:10Z",
      "updated_at": "2026-01-01T20:43:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656599809",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599809"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 373,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599841",
      "pull_request_review_id": 3622042719,
      "id": 2656599841,
      "node_id": "PRRC_kwDOABII586eWH8h",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}\n \n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\n+\n+    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base->GetCoin(outpoint); }\n+    bool HaveCoin(const COutPoint& outpoint) const override { return base->HaveCoin(outpoint); }\n+    uint256 GetBestBlock() const override { return base->GetBestBlock(); }\n+    std::vector<uint256> GetHeadBlocks() const override { return base->GetHeadBlocks(); }\n+    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base->BatchWrite(cursor, hashBlock); }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 100,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656575277,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-01-01T20:43:15Z",
      "updated_at": "2026-01-01T20:43:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656599841",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656599841"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 379,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656602352",
      "pull_request_review_id": 3622044422,
      "id": 2656602352,
      "node_id": "PRRC_kwDOABII586eWIjw",
      "diff_hunk": "@@ -93,10 +93,11 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                 coins_view_cache.Uncache(random_out_point);\n             },\n             [&] {\n-                if (fuzzed_data_provider.ConsumeBool()) {\n-                    backend_coins_view = CCoinsView{};\n+                if (is_db || fuzzed_data_provider.ConsumeBool()) {",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656592223,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can you explain why you think so? If we have a database backing the cache than we should switch it to another one? in https://github.com/bitcoin/bitcoin/blob/7817197cf2eb07aae32a6f67408c4493a57ea465/src/validation.cpp#L880 we have a normal db switched to an empty one. Here we're either setting the provided `backend_coins_view` or creating a new one - is that not what you think we should do?",
      "created_at": "2026-01-01T20:49:04Z",
      "updated_at": "2026-01-01T20:49:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656602352",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656602352"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656602847",
      "pull_request_review_id": 3622044687,
      "id": 2656602847,
      "node_id": "PRRC_kwDOABII586eWIrf",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The reason is explain in the commit message:\r\n> In a follow-up `m_dummy` will be completely removed, this commit was meant to demonstrate why that was necessary.\r\n\r\nI.e. I don't want the fix to be accidental - fix first, replace after.",
      "created_at": "2026-01-01T20:50:03Z",
      "updated_at": "2026-01-01T20:50:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656602847",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656602847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656604510",
      "pull_request_review_id": 3622045880,
      "id": 2656604510,
      "node_id": "PRRC_kwDOABII586eWJFe",
      "diff_hunk": "@@ -93,10 +93,11 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                 coins_view_cache.Uncache(random_out_point);\n             },\n             [&] {\n-                if (fuzzed_data_provider.ConsumeBool()) {\n-                    backend_coins_view = CCoinsView{};\n+                if (is_db || fuzzed_data_provider.ConsumeBool()) {",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656592223,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We are making assertions on `backend_coins_view` below, where we assume it is what is set as the backend of `coins_view_cache`. So if we set the backend as the empty view singleton and don't update `backend_coins_view` those assertions will fail.",
      "created_at": "2026-01-01T20:54:23Z",
      "updated_at": "2026-01-01T20:54:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656604510",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656604510"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656605146",
      "pull_request_review_id": 3622046185,
      "id": 2656605146,
      "node_id": "PRRC_kwDOABII586eWJPa",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "But it's not necessary. There is no UB unless you add this commit.",
      "created_at": "2026-01-01T20:55:26Z",
      "updated_at": "2026-01-01T20:55:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656605146",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656605146"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656611435",
      "pull_request_review_id": 3622050508,
      "id": 2656611435,
      "node_id": "PRRC_kwDOABII586eWKxr",
      "diff_hunk": "@@ -93,10 +93,11 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                 coins_view_cache.Uncache(random_out_point);\n             },\n             [&] {\n-                if (fuzzed_data_provider.ConsumeBool()) {\n-                    backend_coins_view = CCoinsView{};\n+                if (is_db || fuzzed_data_provider.ConsumeBool()) {",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "50245cadd68c3345c551cd65f878e9c7ca3ae1a4",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656592223,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Edit: [pushed](https://github.com/bitcoin/bitcoin/compare/50245cadd68c3345c551cd65f878e9c7ca3ae1a4..e3d4435b94ff7a1153d06e3e6bb709431b18b76b#diff-1ef3b6a1936b50f3d5ec4a1786d9e2d63d1a3e1815b103e67f20601995f355b4R96) something, what do you think?",
      "created_at": "2026-01-01T21:09:35Z",
      "updated_at": "2026-01-01T21:37:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2656611435",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656611435"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2658905806",
      "pull_request_review_id": 3624327337,
      "id": 2658905806,
      "node_id": "PRRC_kwDOABII586ee67O",
      "diff_hunk": "@@ -303,58 +303,83 @@ struct CoinsViewCacheCursor\n     bool m_will_erase;\n };\n \n-/** Abstract view on the open txout dataset. */\n+/** Pure abstract view on the open txout dataset. */\n class CCoinsView\n {\n public:\n+    //! As we use CCoinsViews polymorphically, have a virtual destructor\n+    virtual ~CCoinsView() = default;\n+\n     //! Retrieve the Coin (unspent transaction output) for a given outpoint.\n-    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const;\n+    virtual std::optional<Coin> GetCoin(const COutPoint& outpoint) const = 0;\n \n     //! Just check whether a given outpoint is unspent.\n-    virtual bool HaveCoin(const COutPoint &outpoint) const;\n+    virtual bool HaveCoin(const COutPoint& outpoint) const = 0;\n \n     //! Retrieve the block hash whose state this CCoinsView currently represents\n-    virtual uint256 GetBestBlock() const;\n+    virtual uint256 GetBestBlock() const = 0;\n \n     //! Retrieve the range of blocks that may have been only partially written.\n     //! If the database is in a consistent state, the result is the empty vector.\n     //! Otherwise, a two-element vector is returned consisting of the new and\n     //! the old block hash, in that order.\n-    virtual std::vector<uint256> GetHeadBlocks() const;\n+    virtual std::vector<uint256> GetHeadBlocks() const = 0;\n \n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\n     //! The passed cursor is used to iterate through the coins.\n-    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock);\n+    virtual bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) = 0;\n \n     //! Get a cursor to iterate over the whole state\n-    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\n-\n-    //! As we use CCoinsViews polymorphically, have a virtual destructor\n-    virtual ~CCoinsView() = default;\n+    virtual std::unique_ptr<CCoinsViewCursor> Cursor() const = 0;\n \n-    //! Estimate database size (0 if not implemented)\n-    virtual size_t EstimateSize() const { return 0; }\n+    //! Estimate database size\n+    virtual size_t EstimateSize() const = 0;\n };\n \n+/** Noop coins view. */\n+class CCoinsViewEmpty final : public CCoinsView\n+{\n+private:\n+    CCoinsViewEmpty() = default;\n+\n+public:\n+    static CCoinsViewEmpty& Get()\n+    {\n+        static CCoinsViewEmpty instance;\n+        return instance;\n+    }\n+\n+    CCoinsViewEmpty(const CCoinsViewEmpty&) = delete;\n+    CCoinsViewEmpty& operator=(const CCoinsViewEmpty&) = delete;\n+\n+    std::optional<Coin> GetCoin(const COutPoint&) const override { return {}; }\n+    bool HaveCoin(const COutPoint&) const override { return false; }\n+    uint256 GetBestBlock() const override { return {}; }\n+    std::vector<uint256> GetHeadBlocks() const override { return {}; }\n+    bool BatchWrite(CoinsViewCacheCursor&, const uint256&) override { return false; }\n+    std::unique_ptr<CCoinsViewCursor> Cursor() const override { return {}; }\n+    size_t EstimateSize() const override { return 0; }\n+};\n \n /** CCoinsView backed by another CCoinsView */\n class CCoinsViewBacked : public CCoinsView\n {\n protected:\n-    CCoinsView *base;\n+    CCoinsView* base;\n \n public:\n-    CCoinsViewBacked(CCoinsView *viewIn);\n-    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override;\n-    bool HaveCoin(const COutPoint &outpoint) const override;\n-    uint256 GetBestBlock() const override;\n-    std::vector<uint256> GetHeadBlocks() const override;\n-    void SetBackend(CCoinsView &viewIn);\n-    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) override;\n-    std::unique_ptr<CCoinsViewCursor> Cursor() const override;\n-    size_t EstimateSize() const override;\n-};\n+    explicit CCoinsViewBacked(CCoinsView* viewIn) : base{Assert(viewIn)} {}\n \n+    void SetBackend(CCoinsView& viewIn) { base = &viewIn; }\n+\n+    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override { return base->GetCoin(outpoint); }\n+    bool HaveCoin(const COutPoint& outpoint) const override { return base->HaveCoin(outpoint); }\n+    uint256 GetBestBlock() const override { return base->GetBestBlock(); }\n+    std::vector<uint256> GetHeadBlocks() const override { return base->GetHeadBlocks(); }\n+    bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override { return base->BatchWrite(cursor, hashBlock); }",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 100,
      "commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "original_commit_id": "b23d784b6baee140f75882fe009be5676db4cb0b",
      "in_reply_to_id": 2656575277,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Separated the renames and simple moves to a completely new commit to simplify review",
      "created_at": "2026-01-03T12:46:58Z",
      "updated_at": "2026-01-03T12:46:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2658905806",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2658905806"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 379,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2658906983",
      "pull_request_review_id": 3624328096,
      "id": 2658906983,
      "node_id": "PRRC_kwDOABII586ee7Nn",
      "diff_hunk": "@@ -13,31 +13,11 @@ TRACEPOINT_SEMAPHORE(utxocache, add);\n TRACEPOINT_SEMAPHORE(utxocache, spent);\n TRACEPOINT_SEMAPHORE(utxocache, uncache);\n \n-std::optional<Coin> CCoinsView::GetCoin(const COutPoint& outpoint) const { return std::nullopt; }\n-uint256 CCoinsView::GetBestBlock() const { return uint256(); }\n-std::vector<uint256> CCoinsView::GetHeadBlocks() const { return std::vector<uint256>(); }\n-bool CCoinsView::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return false; }\n-std::unique_ptr<CCoinsViewCursor> CCoinsView::Cursor() const { return nullptr; }\n-\n-bool CCoinsView::HaveCoin(const COutPoint &outpoint) const\n-{\n-    return GetCoin(outpoint).has_value();\n-}\n-\n-CCoinsViewBacked::CCoinsViewBacked(CCoinsView *viewIn) : base(viewIn) { }\n-std::optional<Coin> CCoinsViewBacked::GetCoin(const COutPoint& outpoint) const { return base->GetCoin(outpoint); }\n-bool CCoinsViewBacked::HaveCoin(const COutPoint &outpoint) const { return base->HaveCoin(outpoint); }\n-uint256 CCoinsViewBacked::GetBestBlock() const { return base->GetBestBlock(); }\n-std::vector<uint256> CCoinsViewBacked::GetHeadBlocks() const { return base->GetHeadBlocks(); }\n-void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n-bool CCoinsViewBacked::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlock) { return base->BatchWrite(cursor, hashBlock); }\n-std::unique_ptr<CCoinsViewCursor> CCoinsViewBacked::Cursor() const { return base->Cursor(); }\n-size_t CCoinsViewBacked::EstimateSize() const { return base->EstimateSize(); }\n-\n CCoinsViewCache::CCoinsViewCache(CCoinsView* baseIn, bool deterministic) :\n     CCoinsViewBacked(baseIn), m_deterministic(deterministic),\n     cacheCoins(0, SaltedOutpointHasher(/*deterministic=*/deterministic), CCoinsMap::key_equal{}, &m_cache_coins_memory_resource)\n {\n+    (void)base->GetBestBlock(); // Sanity check validity of base",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "a69ea84b83d22c66ddeeba6d27b761036d6fec40",
      "original_commit_id": "784769b5b1a8465d1a09ec489a303c4616d11896",
      "in_reply_to_id": 2650234336,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, that's why I added that commit to demonstrate that we're fixing a potential UB as well here.\r\nIt *may* not be UB currently since it *may* not be triggered by any compiler we're using currently - but I don't want to think about those, it's why I'm demonstrating the problem explicitly.",
      "created_at": "2026-01-03T12:49:43Z",
      "updated_at": "2026-01-03T12:49:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34124#discussion_r2658906983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2658906983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34124"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    }
  ]
}
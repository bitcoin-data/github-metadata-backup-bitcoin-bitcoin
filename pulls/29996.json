{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996",
    "id": 1845963395,
    "node_id": "PR_kwDOABII585uByqD",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29996",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29996.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29996.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/3f033542b869dfbe037cda705c3b8f7faa32da5d",
    "number": 29996,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "test: Assumeutxo: import snapshot in a node with a divergent chain",
    "user": {
      "login": "alfonsoromanz",
      "id": 19962151,
      "node_id": "MDQ6VXNlcjE5OTYyMTUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alfonsoromanz",
      "html_url": "https://github.com/alfonsoromanz",
      "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
      "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
      "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
      "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
      "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR adds tests to cover two scenarios of loading a snapshot when the current chain tip is:\r\n\r\n- Not an ancestor of the snapshot block but has less work\r\n- Not an ancestor or a descendant of the snapshot block and has more work\r\n\r\nIn the second scenario, the snapshot block does not belong to the most-work chain anymore so I believe it covers this scenario too: `TODO: Valid snapshot file and snapshot block, but the block is not on the\r\n      most-work chain`. Therefore I deleted that TODO as well.\r\n",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2024-04-29T15:13:24Z",
    "updated_at": "2024-05-13T15:35:40Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "f2d35954425ca5da217605d50443a5af88efc137",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "alfonsoromanz:assumeutxo_tests",
      "ref": "assumeutxo_tests",
      "sha": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 742079678,
        "node_id": "R_kgDOLDs8vg",
        "name": "bitcoin",
        "full_name": "alfonsoromanz/bitcoin",
        "owner": {
          "login": "alfonsoromanz",
          "id": 19962151,
          "node_id": "MDQ6VXNlcjE5OTYyMTUx",
          "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/alfonsoromanz",
          "html_url": "https://github.com/alfonsoromanz",
          "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
          "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
          "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
          "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
          "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/alfonsoromanz/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/alfonsoromanz/bitcoin",
        "archive_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/events",
        "forks_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/alfonsoromanz/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:alfonsoromanz/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/alfonsoromanz/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/alfonsoromanz/bitcoin/hooks",
        "svn_url": "https://github.com/alfonsoromanz/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 218440,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-13T15:09:10Z",
        "created_at": "2024-01-11T18:09:37Z",
        "updated_at": "2024-05-13T14:42:17Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ff8c606cf1eaefd0eab9f144561120ae6c5a498f",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35400,
        "stargazers_count": 76354,
        "watchers_count": 76354,
        "size": 258388,
        "default_branch": "master",
        "open_issues_count": 691,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-05-13T15:58:17Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-05-13T15:01:47Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 34,
    "deletions": 7,
    "changed_files": 1,
    "commits": 2,
    "review_comments": 15,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2083008209,
      "node_id": "IC_kwDOABII5858KC7R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2083008209",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-29T15:13:27Z",
      "updated_at": "2024-05-13T15:09:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29996).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [naiyoma](https://github.com/bitcoin/bitcoin/pull/29996#issuecomment-2087518282) |\n| Stale ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/29996#pullrequestreview-2045600755) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30053](https://github.com/bitcoin/bitcoin/pull/30053) (test: added test coverage to loadtxoutset could not open file by kevkevinpal)\n* [#29681](https://github.com/bitcoin/bitcoin/pull/29681) (test: loading assumeutxo snapshot start states by BrandonOdiwuor)\n* [#29428](https://github.com/bitcoin/bitcoin/pull/29428) (test: Assumeutxo: snapshots with less work should not be loaded by hernanmarino)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#issuecomment-2083008209",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996"
    },
    {
      "event": "labeled",
      "id": 12644821120,
      "node_id": "LE_lADOABII586HQtfUzwAAAALxsKiA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12644821120",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-29T15:13:30Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-29T15:17:29Z",
      "updated_at": "2024-04-29T15:17:29Z",
      "source": {
        "issue": {
          "id": 2177880415,
          "node_id": "I_kwDOABII586Bz9Ff",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29616",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29616/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29616/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29616/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/29616",
          "number": 29616,
          "state": "open",
          "state_reason": null,
          "title": "AssumeUTXO Mainnet Readiness Tracking",
          "body": "## Goals of this issue\r\n\r\n- Track all ongoing work on assumeutxo until mainnet params are included in a release\r\n- Categorize the work into critical/optional for mainnet readiness\r\n- Conceptual discussion on assumeutxo topics that may or may not be critical for mainnet readiness\r\n\r\nThe initial categorizations here are suggestions and changes should be discussed here in the issue. Obviously let me know if I missed anything.\r\n\r\n## Critical Issues/PRs\r\n\r\n- [ ] #29612 (which fixes #25675) - Improves size of dump, critical because it is not backwards compatible\r\n- [ ] #29519 - Stop syncing non-snapshot chain from peers that are already connected\r\n- [x] #29726 - Fix -reindex behavior\r\n- [x] #29370 - Get rid of faked nTx and nChainTx values (closing issues discussed in #29261)\r\n- [ ] #29720 - RPC fixes for missing values, addressing #29328\r\n- [ ] #28553 - The mainnet params themselves\r\n\r\n## Optional Issues/PRs\r\n\r\n(Attempted a rough ordering by importance)\r\n\r\n- [ ] #28616 (which fixes #28598) - Show background chain funds as not fully confirmed in GUI\r\n- [ ] #29553 - `dumptxoutset` with height param\r\n- [ ] #28670 - Improved error handling for `loadtxoutset`\r\n- [x] #29478 - Additional test coverage for `loadtxoutset`\r\n- [x] #29617 - Additional test coverage\r\n- [x] #29973 - Additional test coverage\r\n- [ ] #29428 - Additional test coverage\r\n- [ ]  #29996 - Additional test coverage\r\n- [ ] #29993 - Improve usability\r\n- [ ] #28608 (draft) - State and locking cleanup\r\n\r\n## Critical conceptual discussion\r\n\r\n- [ ] Agreement on a rule of thumb which height we choose once there is consensus for mainnet readiness, i.e. how to choose the height for #28553 once we are close to an upcoming release. I think the earlier we discuss this the better, so that this doesn't get in the way later.\r\n\r\n## Optional conceptual discussion\r\n\r\nThese were taken from #28553 and [the original assumeutxo PR](https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1727936044).\r\n\r\n- [ ] Distribution of snapshots - This recently came up [here](https://github.com/bitcoin/bitcoin/pull/29551#pullrequestreview-1917416713) and [here](https://bitcoin-irc.chaincode.com/bitcoin-core-dev/2024-03-07#1012635;). There are multiple levels to this topic but I believe that this is not critical either way. If it were critical then, at the most basic level, we would probably provide an \"official\" torrent/download link for the dump with the release. It would be great if one or more contributors could do that (@Sjors did this in #28516 for example) and are willing to maintain this for a reasonable amount of time but it is not critical IMO because anyone can use `dumptxoutset` to recreate the dump and then share it any way they like. So there is no need to provide this service from within the project. I think anyone who plans to distribute the dump to other users (think of downstream projects like BTCPayServer, Raspiblitz, Umbrel, Greenlight etc.) should validate the dump like this at least once anyway. And there may even be options for distribution possible for downstream projects that we can not even think of right now but if we don't make the feature available they can also not be explored.\r\n- [ ] Usage of MuHash #27669 - While it would be nice to have this I don't think it is blocking because this can still be introduced later without invalidating existing dumps.\r\n- [ ] Make params configurable/not hardcoded params - I think it would be good to stay on the safe side for now and make the feature available to the public as originally planned. If the feature sees wide adoption and requests for more flexibility come in that would be the right point to explore this further.\r\n- [ ] Should old hashes be removed from source code at some point? - Obviously not relevant for the first mainnet params\r\n- [ ] How frequently should we update testnet/signet params and is there any way to deal with the possibility that these chains [may get nuked at some point](https://x.com/kallewoof/status/1763222648367308958)?",
          "user": {
            "login": "fjahr",
            "id": 1322187,
            "node_id": "MDQ6VXNlcjEzMjIxODc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fjahr",
            "html_url": "https://github.com/fjahr",
            "followers_url": "https://api.github.com/users/fjahr/followers",
            "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
            "organizations_url": "https://api.github.com/users/fjahr/orgs",
            "repos_url": "https://api.github.com/users/fjahr/repos",
            "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/fjahr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 15,
          "created_at": "2024-03-10T19:57:46Z",
          "updated_at": "2024-05-10T14:29:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-29T15:21:34Z",
      "updated_at": "2024-04-29T15:21:34Z",
      "source": {
        "issue": {
          "id": 2133039837,
          "node_id": "PR_kwDOABII585mylYC",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29428",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29428/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29428/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29428/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29428",
          "number": 29428,
          "state": "open",
          "state_reason": null,
          "title": "test: Assumeutxo: snapshots with less work should not be loaded",
          "body": "This PR adds a test which checks that snapshots with less accumulated work than the node's active chain, should not be loaded and return with an error. Although in a different context of discussion the missing test was detect in a thread in https://github.com/bitcoin/bitcoin/pull/29394 (see https://github.com/bitcoin/bitcoin/pull/29394#discussion_r1484122214)\r\n",
          "user": {
            "login": "hernanmarino",
            "id": 87907936,
            "node_id": "MDQ6VXNlcjg3OTA3OTM2",
            "avatar_url": "https://avatars.githubusercontent.com/u/87907936?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hernanmarino",
            "html_url": "https://github.com/hernanmarino",
            "followers_url": "https://api.github.com/users/hernanmarino/followers",
            "following_url": "https://api.github.com/users/hernanmarino/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/hernanmarino/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/hernanmarino/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/hernanmarino/subscriptions",
            "organizations_url": "https://api.github.com/users/hernanmarino/orgs",
            "repos_url": "https://api.github.com/users/hernanmarino/repos",
            "events_url": "https://api.github.com/users/hernanmarino/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/hernanmarino/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 16,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29428",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29428",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29428.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29428.patch"
          },
          "created_at": "2024-02-13T20:01:01Z",
          "updated_at": "2024-05-13T13:31:23Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-29T22:16:33Z",
      "updated_at": "2024-04-29T22:16:33Z",
      "source": {
        "issue": {
          "id": 2197548850,
          "node_id": "PR_kwDOABII585qOPnA",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29681",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29681/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29681/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29681/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/29681",
          "number": 29681,
          "state": "open",
          "state_reason": null,
          "title": "test: loading assumeutxo snapshot start states",
          "body": "Fixes: https://github.com/bitcoin/bitcoin/issues/28648\r\n\r\nAdd assumeutxo test:\r\n\r\n- loading snapshot with current chain tip at snapshot_base_height\r\n- loading snapshot with current chain tip a descendant of snapshot block",
          "user": {
            "login": "BrandonOdiwuor",
            "id": 15610188,
            "node_id": "MDQ6VXNlcjE1NjEwMTg4",
            "avatar_url": "https://avatars.githubusercontent.com/u/15610188?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/BrandonOdiwuor",
            "html_url": "https://github.com/BrandonOdiwuor",
            "followers_url": "https://api.github.com/users/BrandonOdiwuor/followers",
            "following_url": "https://api.github.com/users/BrandonOdiwuor/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/BrandonOdiwuor/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/BrandonOdiwuor/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/BrandonOdiwuor/subscriptions",
            "organizations_url": "https://api.github.com/users/BrandonOdiwuor/orgs",
            "repos_url": "https://api.github.com/users/BrandonOdiwuor/repos",
            "events_url": "https://api.github.com/users/BrandonOdiwuor/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/BrandonOdiwuor/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29681",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/29681",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/29681.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/29681.patch"
          },
          "created_at": "2024-03-20T13:33:25Z",
          "updated_at": "2024-05-08T18:13:28Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12662791451,
      "node_id": "HRFPE_lADOABII586HQtfUzwAAAALywt0b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12662791451",
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T19:15:13Z"
    },
    {
      "event": "commented",
      "id": 2086782948,
      "node_id": "IC_kwDOABII5858Ycfk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2086782948",
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T19:25:18Z",
      "updated_at": "2024-04-30T19:25:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "I splitted the original commit into two commits (one for each test). The second test (https://github.com/bitcoin/bitcoin/pull/29996/commits/af0f401258e0c189799a36f4487eaa751d779e7b) may be redundant with this one: https://github.com/bitcoin/bitcoin/pull/29428. The only difference is that my test is executed on a node that has a divergent chain after block 199. I did that to cover this scenario described in the comments\r\n\r\n `[...] Loading a snapshot when the current chain tip is: [...] Not an ancestor or a descendant of the snapshot block and has more work`\r\n \r\n If it's redundant I can delete the second commit. Thoughts?",
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#issuecomment-2086782948",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996"
    },
    {
      "event": "commented",
      "id": 2087518282,
      "node_id": "IC_kwDOABII5858bQBK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2087518282",
      "actor": {
        "login": "naiyoma",
        "id": 40592031,
        "node_id": "MDQ6VXNlcjQwNTkyMDMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/40592031?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naiyoma",
        "html_url": "https://github.com/naiyoma",
        "followers_url": "https://api.github.com/users/naiyoma/followers",
        "following_url": "https://api.github.com/users/naiyoma/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naiyoma/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naiyoma/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naiyoma/subscriptions",
        "organizations_url": "https://api.github.com/users/naiyoma/orgs",
        "repos_url": "https://api.github.com/users/naiyoma/repos",
        "events_url": "https://api.github.com/users/naiyoma/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naiyoma/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-04-30T22:05:06Z",
      "updated_at": "2024-04-30T22:05:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, covers more tests scenarios for AssumeUTXO\r\n",
      "user": {
        "login": "naiyoma",
        "id": 40592031,
        "node_id": "MDQ6VXNlcjQwNTkyMDMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/40592031?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naiyoma",
        "html_url": "https://github.com/naiyoma",
        "followers_url": "https://api.github.com/users/naiyoma/followers",
        "following_url": "https://api.github.com/users/naiyoma/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naiyoma/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naiyoma/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naiyoma/subscriptions",
        "organizations_url": "https://api.github.com/users/naiyoma/orgs",
        "repos_url": "https://api.github.com/users/naiyoma/repos",
        "events_url": "https://api.github.com/users/naiyoma/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naiyoma/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#issuecomment-2087518282",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996"
    },
    {
      "event": "reviewed",
      "id": 2034676796,
      "node_id": "PRR_kwDOABII5855RrQ8",
      "url": null,
      "actor": null,
      "commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#pullrequestreview-2034676796",
      "submitted_at": "2024-05-02T01:42:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12681863066,
      "node_id": "HRFPE_lADOABII586HQtfUzwAAAALz5d-a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12681863066",
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-02T11:34:11Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-07T10:58:05Z",
      "updated_at": "2024-05-07T10:58:05Z",
      "source": {
        "issue": {
          "id": 2281816402,
          "node_id": "PR_kwDOABII585ur9RA",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30053",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30053/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30053/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30053/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/30053",
          "number": 30053,
          "state": "closed",
          "state_reason": null,
          "title": "test: added test coverage to loadtxoutset could not open file",
          "body": "The functional test coverage did not cover the rpc error of \"Couldn't open file...\" for loadtxoutset and this test adds coverage for it\r\n\r\nThis adds coverage to this line\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/rpc/blockchain.cpp#L2777",
          "user": {
            "login": "kevkevinpal",
            "id": 15950706,
            "node_id": "MDQ6VXNlcjE1OTUwNzA2",
            "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/kevkevinpal",
            "html_url": "https://github.com/kevkevinpal",
            "followers_url": "https://api.github.com/users/kevkevinpal/followers",
            "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
            "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
            "repos_url": "https://api.github.com/users/kevkevinpal/repos",
            "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30053",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/30053",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/30053.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/30053.patch"
          },
          "closed_at": "2024-05-08T08:15:11Z",
          "created_at": "2024-05-06T21:32:15Z",
          "updated_at": "2024-05-08T08:15:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 2045600755,
      "node_id": "PRR_kwDOABII58557WPz",
      "url": null,
      "actor": null,
      "commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "tACK [ce80f7e](https://github.com/bitcoin/bitcoin/pull/29996/commits/ce80f7ec9a66d594c3a6a6e249f911e9e543a623)\r\n\r\nMake and tests successful, thanks for adding this test - it's easy to follow through.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#pullrequestreview-2045600755",
      "submitted_at": "2024-05-08T13:16:53Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
    },
    {
      "event": "labeled",
      "id": 12784107994,
      "node_id": "LE_lADOABII586HQtfUzwAAAAL5_gHa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12784107994",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-13T09:21:11Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE3NTAxZjc3OWViODRlZmZkNTU3OTA3MGI4YjFjMWEzMDIwMjczZDY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a7501f779eb84effd5579070b8b1c1a3020273d6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a7501f779eb84effd5579070b8b1c1a3020273d6",
      "tree": {
        "sha": "8cbde4f8d9d2e6d16cfd9b613c30f2d0bbcd731f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8cbde4f8d9d2e6d16cfd9b613c30f2d0bbcd731f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b94061902e52132489fe296c12396798700f1f35",
          "sha": "b94061902e52132489fe296c12396798700f1f35",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b94061902e52132489fe296c12396798700f1f35"
        }
      ],
      "message": "test: loadtxoutset in divergent chain with less work",
      "committer": {
        "name": "Alfonso Roman Zubeldia",
        "email": "19962151+alfonsoromanz@users.noreply.github.com",
        "date": "2024-05-13T14:57:54Z"
      },
      "author": {
        "name": "Alfonso Roman Zubeldia",
        "email": "19962151+alfonsoromanz@users.noreply.github.com",
        "date": "2024-05-13T14:49:22Z"
      },
      "sha": "a7501f779eb84effd5579070b8b1c1a3020273d6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNmMDMzNTQyYjg2OWRmYmUwMzdjZGE3MDVjM2I4ZjdmYWEzMmRhNWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "tree": {
        "sha": "445353ffa5c05957d19ec87a524488c829b31014",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/445353ffa5c05957d19ec87a524488c829b31014"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a7501f779eb84effd5579070b8b1c1a3020273d6",
          "sha": "a7501f779eb84effd5579070b8b1c1a3020273d6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a7501f779eb84effd5579070b8b1c1a3020273d6"
        }
      ],
      "message": "test: loadtxoutset in divergent chain with more work",
      "committer": {
        "name": "Alfonso Roman Zubeldia",
        "email": "19962151+alfonsoromanz@users.noreply.github.com",
        "date": "2024-05-13T14:58:08Z"
      },
      "author": {
        "name": "Alfonso Roman Zubeldia",
        "email": "19962151+alfonsoromanz@users.noreply.github.com",
        "date": "2024-05-13T14:53:02Z"
      },
      "sha": "3f033542b869dfbe037cda705c3b8f7faa32da5d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12789048126,
      "node_id": "HRFPE_lADOABII586HQtfUzwAAAAL6SWM-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12789048126",
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-13T15:09:12Z"
    },
    {
      "event": "commented",
      "id": 2107965861,
      "node_id": "IC_kwDOABII5859pQGl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2107965861",
      "actor": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-13T15:18:56Z",
      "updated_at": "2024-05-13T15:18:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased. I also addressed some feedback from rkrux's comments: changed hardcoded value of `nblocks` from 99 to a dynamic value, i.e `SNAPSHOT_BASE_HEIGHT-START_HEIGHT-1`",
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#issuecomment-2107965861",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29996"
    },
    {
      "event": "unlabeled",
      "id": 12789412620,
      "node_id": "UNLE_lADOABII586HQtfUzwAAAAL6TvMM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12789412620",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-13T15:35:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586967904",
      "pull_request_review_id": 2034676796,
      "id": 1586967904,
      "node_id": "PRRC_kwDOABII585elzVg",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199\n+        for block_height in range(current_height, base_height, -1):\n+            block_hash = node.getblockhash(block_height)\n+            node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+        # Try importing the snapshot and assert its success\n+        loaded = node.loadtxoutset(dump_output_path)\n+        assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n+\n+        # Restart the node and delete the snapshot chainstate from previous test.\n+        self.restart_node(2, extra_args=['-reindex-chainstate=1', *self.extra_args[2]])\n+        assert_equal(node.getblockcount(), 298)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 42,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": null,
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "instead of number `298` would it make more sense to use `SNAPSHOT_BASE_HEIGHT`?",
      "created_at": "2024-05-02T01:23:21Z",
      "updated_at": "2024-05-02T01:42:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1586967904",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586967904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 172,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586968840",
      "pull_request_review_id": 2034676796,
      "id": 1586968840,
      "node_id": "PRRC_kwDOABII585elzkI",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 25,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": null,
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "is this not the same as `START_HEIGHT`?",
      "created_at": "2024-05-02T01:25:20Z",
      "updated_at": "2024-05-02T01:42:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1586968840",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586968840"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586972804",
      "pull_request_review_id": 2034676796,
      "id": 1586972804,
      "node_id": "PRRC_kwDOABII585el0iE",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199\n+        for block_height in range(current_height, base_height, -1):\n+            block_hash = node.getblockhash(block_height)\n+            node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 29,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": null,
      "user": {
        "login": "kevkevinpal",
        "id": 15950706,
        "node_id": "MDQ6VXNlcjE1OTUwNzA2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15950706?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kevkevinpal",
        "html_url": "https://github.com/kevkevinpal",
        "followers_url": "https://api.github.com/users/kevkevinpal/followers",
        "following_url": "https://api.github.com/users/kevkevinpal/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kevkevinpal/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kevkevinpal/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kevkevinpal/subscriptions",
        "organizations_url": "https://api.github.com/users/kevkevinpal/orgs",
        "repos_url": "https://api.github.com/users/kevkevinpal/repos",
        "events_url": "https://api.github.com/users/kevkevinpal/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kevkevinpal/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        block_hash = node.getblockhash(START_HEIGHT + 1)\r\n        node.invalidateblock(block_hash)\r\n        assert_equal(node.getblockcount(), START_HEIGHT)\r\n```",
      "created_at": "2024-05-02T01:34:42Z",
      "updated_at": "2024-05-02T01:42:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1586972804",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1586972804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": 156,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587494035",
      "pull_request_review_id": 2035514730,
      "id": 1587494035,
      "node_id": "PRRC_kwDOABII585enzyT",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199\n+        for block_height in range(current_height, base_height, -1):\n+            block_hash = node.getblockhash(block_height)\n+            node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+        # Try importing the snapshot and assert its success\n+        loaded = node.loadtxoutset(dump_output_path)\n+        assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n+\n+        # Restart the node and delete the snapshot chainstate from previous test.\n+        self.restart_node(2, extra_args=['-reindex-chainstate=1', *self.extra_args[2]])\n+        assert_equal(node.getblockcount(), 298)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 42,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": 1586967904,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Actually `SNAPSHOT_BASE_HEIGHT` is 299, and here I am trying to make sure that the snapshot was deleted and therefore the node is now using it's previous chain which has less work. I changed it to `assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT`  for more clarity",
      "created_at": "2024-05-02T11:38:57Z",
      "updated_at": "2024-05-02T11:38:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1587494035",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587494035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 172,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587496652",
      "pull_request_review_id": 2035516343,
      "id": 1587496652,
      "node_id": "PRRC_kwDOABII585en0bM",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 25,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": 1586968840,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, good catch. This line was removed since the iteration is no longer needed based on your other comment below.",
      "created_at": "2024-05-02T11:39:39Z",
      "updated_at": "2024-05-02T11:39:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1587496652",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587496652"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587497230",
      "pull_request_review_id": 2035516963,
      "id": 1587497230,
      "node_id": "PRRC_kwDOABII585en0kO",
      "diff_hunk": "@@ -152,6 +148,38 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        current_height = node.getblockcount()\n+        base_height = 199\n+        for block_height in range(current_height, base_height, -1):\n+            block_hash = node.getblockhash(block_height)\n+            node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 29,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "af0f401258e0c189799a36f4487eaa751d779e7b",
      "in_reply_to_id": 1586972804,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That's a good one. Thanks. I Fixed it.",
      "created_at": "2024-05-02T11:39:59Z",
      "updated_at": "2024-05-02T11:39:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1587497230",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1587497230"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": 156,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593998574",
      "pull_request_review_id": 2045600755,
      "id": 1593998574,
      "node_id": "PRRC_kwDOABII585fAnzu",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 23,
      "original_position": 23,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: Because this test involves dealing with multiple nodes, for verbosity and clarity we can call this variable as `second_node`.",
      "created_at": "2024-05-08T13:05:05Z",
      "updated_at": "2024-05-08T13:16:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1593998574",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1593998574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 162,
      "original_line": 162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594000248",
      "pull_request_review_id": 2045600755,
      "id": 1594000248,
      "node_id": "PRRC_kwDOABII585fAoN4",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 30,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`nblocks=99`\r\nWe can make this value dependent on SNAPSHOT_BASE_HEIGHT such as (SNAPSHOT_BASE_HEIGHT - 200) or (SNAPSHOT_BASE_HEIGHT / 2) so that it's tied to SNAPSHOT_BASE_HEIGHT, and any future changes will automatically account for this variable as well.",
      "created_at": "2024-05-08T13:06:22Z",
      "updated_at": "2024-05-08T13:16:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1594000248",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594000248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594008624",
      "pull_request_review_id": 2045600755,
      "id": 1594008624,
      "node_id": "PRRC_kwDOABII585fAqQw",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+        # Try importing the snapshot and assert its success\n+        loaded = node.loadtxoutset(dump_output_path)\n+        assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n+\n+        # Restart the node and delete the snapshot chainstate from previous test.\n+        self.restart_node(2, extra_args=['-reindex-chainstate=1', *self.extra_args[2]])",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 38,
      "original_position": 38,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Got to know from the CPP code that `-reindex-chainstate` will load up from the blk.dat files. That's why I understand only 2 more blocks are needed to exceed the work of the snapshot chain.",
      "created_at": "2024-05-08T13:11:00Z",
      "updated_at": "2024-05-08T13:16:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1594008624",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594008624"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 177,
      "original_line": 177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594014627",
      "pull_request_review_id": 2045600755,
      "id": 1594014627,
      "node_id": "PRRC_kwDOABII585fAruj",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+        # Try importing the snapshot and assert its success\n+        loaded = node.loadtxoutset(dump_output_path)\n+        assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n+\n+        # Restart the node and delete the snapshot chainstate from previous test.\n+        self.restart_node(2, extra_args=['-reindex-chainstate=1', *self.extra_args[2]])\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor or a descendant of the snapshot block and has more work\")\n+        # Generate two extra blocks and make sure node2's chain has more work than the snapshot's chain\n+        # This covers the scenario where the snapshot block is not on the most-work chain\n+        self.generate(node, nblocks=2, sync_fun=self.no_op)\n+        assert node.getblockcount() > SNAPSHOT_BASE_HEIGHT\n+        # Import the snapshot and assert its failure\n+        with node.assert_debug_log(expected_msgs=[\"[snapshot] activation failed - work does not exceed active chainstate\"]):\n+            assert_raises_rpc_error(-32603, \"Unable to load UTXO snapshot\", node.loadtxoutset, dump_output_path)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 48,
      "original_position": 48,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`-32603`\r\n\r\nAlthough not necessary for this PR, I am wondering how big of a lift would it be to tie these errors to the ones defined here: https://github.com/bitcoin/bitcoin/blob/master/src/rpc/protocol.h",
      "created_at": "2024-05-08T13:14:42Z",
      "updated_at": "2024-05-08T13:16:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1594014627",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1594014627"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 187,
      "original_line": 187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596777994",
      "pull_request_review_id": 2050118488,
      "id": 1596777994,
      "node_id": "PRRC_kwDOABII585fLOYK",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 23,
      "original_position": 23,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": 1593998574,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks for your review. Actually this test uses only one node and I used the same notation used in other tests, but I am willing to change it if others agree.",
      "created_at": "2024-05-10T13:48:30Z",
      "updated_at": "2024-05-10T13:48:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1596777994",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596777994"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 162,
      "original_line": 162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596778313",
      "pull_request_review_id": 2050118997,
      "id": 1596778313,
      "node_id": "PRRC_kwDOABII585fLOdJ",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 30,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": 1594000248,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point. The goal of this test is to generate a divergent chain starting from `START_HEIGHT` but having less work than the snapshot, which height equals `SNAPSHOT_BASE_HEIGHT`. Maybe I can set `nBlocks=SNAPSHOT_BASE_HEIGHT-START_HEIGHT-1`. This will result in `99` and it will adapt to any future changes to either `START_HEIGHT` or `SNAPSHOT_BASE_HEIGHT`",
      "created_at": "2024-05-10T13:48:47Z",
      "updated_at": "2024-05-10T13:48:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1596778313",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1596778313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1597568656",
      "pull_request_review_id": 2051304962,
      "id": 1597568656,
      "node_id": "PRRC_kwDOABII585fOPaQ",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 30,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": 1594000248,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, that would be good.",
      "created_at": "2024-05-12T07:13:56Z",
      "updated_at": "2024-05-12T07:13:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1597568656",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1597568656"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598649148",
      "pull_request_review_id": 2053004297,
      "id": 1598649148,
      "node_id": "PRRC_kwDOABII585fSXM8",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": null,
      "original_position": 30,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": 1594000248,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. Thanks",
      "created_at": "2024-05-13T15:14:29Z",
      "updated_at": "2024-05-13T15:14:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1598649148",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598649148"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598651033",
      "pull_request_review_id": 2053007625,
      "id": 1598651033,
      "node_id": "PRRC_kwDOABII585fSXqZ",
      "diff_hunk": "@@ -152,6 +148,35 @@ def test_invalid_mempool_state(self, dump_output_path):\n \n         self.restart_node(2, extra_args=self.extra_args[2])\n \n+    def test_snapshot_in_a_divergent_chain(self, dump_output_path):\n+        # First rollback node2's chain to the pregenerated one, up to height 199\n+        node = self.nodes[2]\n+        block_hash = node.getblockhash(START_HEIGHT + 1)\n+        node.invalidateblock(block_hash)\n+        assert_equal(node.getblockcount(), START_HEIGHT)\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor of the snapshot block but has less work\")\n+        # Generate a divergent chain in node2 but with less work compared to the snapshot\n+        self.generate(node, nblocks=99, sync_fun=self.no_op)\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+        # Try importing the snapshot and assert its success\n+        loaded = node.loadtxoutset(dump_output_path)\n+        assert_equal(loaded['coins_loaded'], SNAPSHOT_BASE_HEIGHT)\n+        assert_equal(loaded['base_height'], SNAPSHOT_BASE_HEIGHT)\n+\n+        # Restart the node and delete the snapshot chainstate from previous test.\n+        self.restart_node(2, extra_args=['-reindex-chainstate=1', *self.extra_args[2]])\n+        assert node.getblockcount() < SNAPSHOT_BASE_HEIGHT\n+\n+        self.log.info(f\"Check importing a snapshot where current chain-tip is not an ancestor or a descendant of the snapshot block and has more work\")\n+        # Generate two extra blocks and make sure node2's chain has more work than the snapshot's chain\n+        # This covers the scenario where the snapshot block is not on the most-work chain\n+        self.generate(node, nblocks=2, sync_fun=self.no_op)\n+        assert node.getblockcount() > SNAPSHOT_BASE_HEIGHT\n+        # Import the snapshot and assert its failure\n+        with node.assert_debug_log(expected_msgs=[\"[snapshot] activation failed - work does not exceed active chainstate\"]):\n+            assert_raises_rpc_error(-32603, \"Unable to load UTXO snapshot\", node.loadtxoutset, dump_output_path)",
      "path": "test/functional/feature_assumeutxo.py",
      "position": 48,
      "original_position": 48,
      "commit_id": "3f033542b869dfbe037cda705c3b8f7faa32da5d",
      "original_commit_id": "ce80f7ec9a66d594c3a6a6e249f911e9e543a623",
      "in_reply_to_id": 1594014627,
      "user": {
        "login": "alfonsoromanz",
        "id": 19962151,
        "node_id": "MDQ6VXNlcjE5OTYyMTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19962151?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alfonsoromanz",
        "html_url": "https://github.com/alfonsoromanz",
        "followers_url": "https://api.github.com/users/alfonsoromanz/followers",
        "following_url": "https://api.github.com/users/alfonsoromanz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alfonsoromanz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alfonsoromanz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alfonsoromanz/subscriptions",
        "organizations_url": "https://api.github.com/users/alfonsoromanz/orgs",
        "repos_url": "https://api.github.com/users/alfonsoromanz/repos",
        "events_url": "https://api.github.com/users/alfonsoromanz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alfonsoromanz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Not sure. Maybe you can try opening an issue to discuss it ",
      "created_at": "2024-05-13T15:15:56Z",
      "updated_at": "2024-05-13T15:15:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29996#discussion_r1598651033",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1598651033"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29996"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 187,
      "original_line": 187,
      "side": "RIGHT"
    }
  ]
}
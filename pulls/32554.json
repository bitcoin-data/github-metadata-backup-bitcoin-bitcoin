{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554",
    "id": 2527184806,
    "node_id": "PR_kwDOABII586Wocem",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32554",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32554.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32554.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/ea001f66246597a050cfe1f080592cc0da17ebc9",
    "number": 32554,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "bench: replace embedded raw block with configurable block generator",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Problem\r\n\r\nThe [hardcoded benchmark block 413567](https://mempool.space/block/413567) has several issues:\r\n- embeds 1.1MB of binary data in the repository (we can't remove it from history, but we can, from `HEAD`)\r\n- mined in 2016, predates SegWit v0, Taproot, and modern script types\r\n- benchmarks cannot test different transaction patterns or script mixes\r\n- updating to a newer block (e.g., [#32457](https://github.com/bitcoin/bitcoin/pull/32457)) would still add binary bloat and would remain inflexible\r\n\r\n### Fix\r\n\r\nAdded configurable `bench/block_generator.{h,cpp}` that builds fully valid blocks at runtime providing blocks or raw serialized stream.\r\n\r\n### Reproducer\r\n\r\nYou can run all affected tests and benchmarks with a sanity check:\r\n```bash\r\nrm -rf build && \\\r\ncmake -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_BENCH=ON && \\\r\ncmake --build build -j$(nproc) && \\\r\nbuild/bin/test_bitcoin -t block_generator_deterministic_seeded_output,block_generator_serialization_roundtrip,block_generator_seed_perturbation,block_generator_multiple_seed_sanity && \\\r\nbuild/bin/bench_bitcoin -sanity-check -filter='DeserializeBlockTest|DeserializeAndCheckBlockTest|LoadExternalBlockFile|WriteBlockBench|ReadBlockBench|ReadRawBlockBench|BlockToJsonVerbosity1|BlockToJsonVerbosity2|BlockToJsonVerbosity3|BlockToJsonVerboseWrite|HexStrBench'\r\n```\r\n---\r\n\r\nThis supersedes #32457 by eliminating the need for any hardcoded block data while enabling flexible benchmark scenarios.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-05-18T21:39:14Z",
    "updated_at": "2026-02-20T07:38:18Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "4231ebc6810d16f7d5f410d8790be2c6f82213cb",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/bench-block-generator",
      "ref": "l0rinc/bench-block-generator",
      "sha": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 292646,
        "default_branch": "master",
        "open_issues_count": 45,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-19T23:13:18Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-02-19T18:23:08Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "35e6444fdc4068adc79082648f9889ad593e623b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38920,
        "stargazers_count": 88190,
        "watchers_count": 88190,
        "size": 305361,
        "default_branch": "master",
        "open_issues_count": 720,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-20T03:10:51Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-20T07:55:13Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 458,
    "deletions": 60,
    "changed_files": 11,
    "commits": 4,
    "review_comments": 33,
    "comments": 6
  },
  "events": [
    {
      "event": "commented",
      "id": 2889225308,
      "node_id": "IC_kwDOABII586sNhRc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2889225308",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-18T21:39:17Z",
      "updated_at": "2026-02-19T19:11:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32554.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2890272937), [yuvicc](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3016802388), [Raimo33](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3419716580), [hodlinator](https://github.com/bitcoin/bitcoin/pull/32554#pullrequestreview-3605702499) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34448](https://github.com/bitcoin/bitcoin/pull/34448) (ci, iwyu: Fix warnings in `src/util` and treat them as errors by hebasto)\n* [#34208](https://github.com/bitcoin/bitcoin/pull/34208) (bench: add fluent API for untimed `setup` steps in nanobench by l0rinc)\n* [#32729](https://github.com/bitcoin/bitcoin/pull/32729) (test,refactor: extract script template helpers & widen sigop count coverage by l0rinc)\n* [#32427](https://github.com/bitcoin/bitcoin/pull/32427) ((RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store by sedited)\n* [#31682](https://github.com/bitcoin/bitcoin/pull/31682) ([IBD] specialize CheckBlock's input & coinbase checks by l0rinc)\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2889225308",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "commented",
      "id": 2890272937,
      "node_id": "IC_kwDOABII586sRhCp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2890272937",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:18:41Z",
      "updated_at": "2025-05-19T09:18:41Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2890272937",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "ready_for_review",
      "id": 17754225674,
      "node_id": "RFRE_lADOABII5863HC1azwAAAAQiO_wK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754225674",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T13:44:06Z"
    },
    {
      "event": "renamed",
      "id": 17754597963,
      "node_id": "RTE_lADOABII5863HC1azwAAAAQiQapL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754597963",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T14:03:43Z",
      "rename": {
        "from": "RFC: bench: replace embedded raw block with configurable block generator",
        "to": "bench: replace embedded raw block with configurable block generator"
      }
    },
    {
      "event": "labeled",
      "id": 17754599134,
      "node_id": "LE_lADOABII5863HC1azwAAAAQiQa7e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754599134",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T14:03:47Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 3016802388,
      "node_id": "IC_kwDOABII586z0MBU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3016802388",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-29T15:44:33Z",
      "updated_at": "2025-06-29T15:44:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nThis one is pretty useful as I can test with up-to date test_data.",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3016802388",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "commented",
      "id": 3419716580,
      "node_id": "IC_kwDOABII587L1Lvk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3419716580",
      "actor": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-19T14:37:15Z",
      "updated_at": "2025-10-19T14:37:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK for more realistic benchmarks",
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3419716580",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21687193807,
      "node_id": "HRFPE_lADOABII5863HC1azwAAAAUMqFDP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21687193807",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "created_at": "2025-12-20T23:18:52Z"
    },
    {
      "event": "commented",
      "id": 3678199901,
      "node_id": "IC_kwDOABII587bPOBd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678199901",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T23:19:52Z",
      "updated_at": "2025-12-20T23:19:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased and applied the new block everywhere, removing the binary of block 413567 embedded in the benchmarks.\r\nLet me know what you think.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3678199901",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "labeled",
      "id": 22604892688,
      "node_id": "LE_lADOABII5863HC1azwAAAAVDW0oQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22604892688",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-07T04:12:34Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22613637316,
      "node_id": "HRFPE_lADOABII5863HC1azwAAAAVD4LjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22613637316",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "created_at": "2026-02-07T19:16:08Z"
    },
    {
      "event": "unlabeled",
      "id": 22613877407,
      "node_id": "UNLE_lADOABII5863HC1azwAAAAVD5GKf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22613877407",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-07T19:41:50Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3605702499,
      "node_id": "PRR_kwDOABII587W6qdj",
      "url": null,
      "actor": null,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-11T12:34:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK b5b57cdf396d8945612fcb2d51e530475db0d87d\n\n**Strong problem A-C-K - It's quite bad that we are only benchmarking against a pre-segwit block.**\n\nThe general direction is promising, I'd mainly prefer slightly more realistic transactions.\n\nAlso, since removing the old block data doesn't shrink the size of the repo, maybe we could keep it around together with some of the older benchmarks?\n\nSuggestions branch: https://github.com/bitcoin/bitcoin/compare/master...hodlinator:bitcoin:pr/32554_suggestions\n(Corresponds pretty much to the inline comments).",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#pullrequestreview-3605702499",
      "submitted_at": "2026-02-11T12:34:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFhYzQyOGNiY2ExMDI3YTk4MDI4ZmNhNzAzYjZkOTVkNTRmZjYzOWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ac428cbca1027a98028fca703b6d95d54ff639e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1ac428cbca1027a98028fca703b6d95d54ff639e",
      "tree": {
        "sha": "e014b0fa57cb51cc209f595e7961b7a8d6321940",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e014b0fa57cb51cc209f595e7961b7a8d6321940"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e014b0fa57cb51cc209f595e7961b7a8d6321940\nparent b2805eec35ce9fdb69892e864556be4ae057ce6a\nauthor Lrinc <pap.lorinc@gmail.com> 1771240561 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1771260432 +0100\n\nbench: use deterministic `HexStr` payload\n\n`HexStrBench` read bytes from the embedded block fixture, which coupled this string benchmark to block fixture migration work.\nUse deterministic pseudo-random `std::byte` input instead.\nUse `MAX_BLOCK_WEIGHT` so input stays in the same order of magnitude and measured work stays above harness overhead.\nThis changes the baseline because input size moves from about 1 MB to 4 MB.\n\nCo-authored-by: hodlinator <172445034+hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmTShAACgkQZp//D/pH\nenZ2pA//b/wuQJwd6ulf+e0pLeuAfaXzsuUs+jdrdMwYV4AV5HXFEZuXM/5HaJRC\n/Gyd5890mT9BHHYDHaTAy9O8ftVVsTAd3E3L9/Mg9EhEYR9RGa9HdesLDOgF3dwv\nK3SguzeSWZSBsi1JiZL6GMFwTzIL7WVgM2mv6sgkoauLZm/hpMXE8tf6VEuTq4WM\nla40Lxb6xTJhbIPVTXBsN8GUGUT1mRzJMVlndj1aOfNI9omWnRIpkaQ57d8t+iIP\ncmRazETiNDVu9yagew+0v3rgqslfAomcLBl0J8gkNQp2ARhpLsln1gnew2Y7Z3yX\nlFvisaUYb61xVwrd8n72nEcyYHkgykn7dBYOkwAkscfanPqeXcFt8bMHVaXbsZvs\nioNRwDwH6lryEk7Wk9buMMYuv/RHi4ZL+PWHPwKEHkpVo3dTBK9mm5x0XSc5KDj6\nf5EdlLyD235s0EmEDQX0ZqLe/kXMELJn70zxVWRvcwf3hDrEOVDU0iGt7dMukr00\nU4+C1IulE6gjikrtL0ZoyErC+liK+byZsOaObZjkoLXPEMQj63n/4WKXaey8w6lr\nMw+LD2JU3DWYn4bv7t7PfPVFx77CAXl4Ti+6bg3/pCofFbB8wwJogBPC25V4z6P7\nQokiNIruiQlwzA8Epde3OhdREBLahiRrMatnNNP4tdEE/Vr7J6o=\n=0rBG\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b2805eec35ce9fdb69892e864556be4ae057ce6a",
          "sha": "b2805eec35ce9fdb69892e864556be4ae057ce6a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b2805eec35ce9fdb69892e864556be4ae057ce6a"
        }
      ],
      "message": "bench: use deterministic `HexStr` payload\n\n`HexStrBench` read bytes from the embedded block fixture, which coupled this string benchmark to block fixture migration work.\nUse deterministic pseudo-random `std::byte` input instead.\nUse `MAX_BLOCK_WEIGHT` so input stays in the same order of magnitude and measured work stays above harness overhead.\nThis changes the baseline because input size moves from about 1 MB to 4 MB.\n\nCo-authored-by: hodlinator <172445034+hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T16:47:12Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T11:16:01Z"
      },
      "sha": "1ac428cbca1027a98028fca703b6d95d54ff639e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDEwZjQxMzYwYTMyZTFlODk0MmNmZTgxOWEwMTJmYTExYmIxYWVkODE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/10f41360a32e1e8942cfe819a012fa11bb1aed81",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/10f41360a32e1e8942cfe819a012fa11bb1aed81",
      "tree": {
        "sha": "76c76161e5bc5b771d23de57e81d583074420009",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/76c76161e5bc5b771d23de57e81d583074420009"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 76c76161e5bc5b771d23de57e81d583074420009\nparent 1ac428cbca1027a98028fca703b6d95d54ff639e\nauthor Lrinc <pap.lorinc@gmail.com> 1771240603 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1771260432 +0100\n\nbench: route legacy fixture through helper APIs\n\nBench files loaded `block413567.raw` directly, so moving off the fixture required touching each benchmark's serialization setup.\nAdd shared helper entry points backed by the current fixture and switch benchmark callsites to those helpers.\nThis keeps behavior stable while moving setup to `regtest`, where the follow-up generated-block path can find a valid nonce quickly.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmTShAACgkQZp//D/pH\nenbouBAAt9d/oWoHRZHFl/lDuxdjOUQ6dmvP+4oOw/3Cx6Cl9AWnraYxkzLW0/v9\n3qY3RKvgLY1rq/d4cGD9LBsP7Md6okCO0JyGoy5vU6iOrpcRpJcWZ+LnkTxuzz7N\nKkNKjpnmQSdVSjB9pDFsvET/sXZaLCIW8y2/2NwFuEqMBQfjGgOeNRCch2BdeiOz\nGNDNScKEGWbynWCizPkkJj1o9bFtIM1+iip2KBD2iRXR01WFYS6NE8pGX40IKL7Y\nQllPO8+fnR4T4amQincIPutjg7ee3sTz60QR50haOlewM1pqkRYBh8b10C9ywF0s\nmV7x+nWAMI/qcwNnszvdlKZj1TkeGYtqLoWvW5uAwUKOYljN9OkHVtQZvUo5w9TS\n4rnnMmpTUX/huul+VcWf1PpXi5p99Y5bKHAFAKUHFDDE3IImFHPr3aQmQ29+6KRe\nXW84Uam78cXA0nk+HabyB+ggFaV4pUvTRL4HBG5bDZxpQtuHsTmtnR8GMOn95TUD\nrGzduZJ+usan+euyFcbU9zU4KVZ8x5zOxF345SLmeDCjrrZ5gx5iv6w1RaUdoZki\nF7jAB4zcUrfuBQeXT0Y8eNWdLcjf3oTpkzILwmOJK5tHl0Iz0qtXxA8QQYhvTVZS\nhdIh4POtF/+19NHA1TDVAPMroVSllHL2Yj9aHI+0WuE3ytD793A=\n=rJZz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ac428cbca1027a98028fca703b6d95d54ff639e",
          "sha": "1ac428cbca1027a98028fca703b6d95d54ff639e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1ac428cbca1027a98028fca703b6d95d54ff639e"
        }
      ],
      "message": "bench: route legacy fixture through helper APIs\n\nBench files loaded `block413567.raw` directly, so moving off the fixture required touching each benchmark's serialization setup.\nAdd shared helper entry points backed by the current fixture and switch benchmark callsites to those helpers.\nThis keeps behavior stable while moving setup to `regtest`, where the follow-up generated-block path can find a valid nonce quickly.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T16:47:12Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T11:16:43Z"
      },
      "sha": "10f41360a32e1e8942cfe819a012fa11bb1aed81"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM2NzBhY2IxODQ3ZTEyN2E2ZGZlY2NhNDEzZWM3YmVhMDI0ODIwY2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c670acb1847e127a6dfecca413ec7bea024820cd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c670acb1847e127a6dfecca413ec7bea024820cd",
      "tree": {
        "sha": "4cc2dc40fd72ee3ff17bb83b8f5f0ab8957edfd2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4cc2dc40fd72ee3ff17bb83b8f5f0ab8957edfd2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4cc2dc40fd72ee3ff17bb83b8f5f0ab8957edfd2\nparent 10f41360a32e1e8942cfe819a012fa11bb1aed81\nauthor Lrinc <pap.lorinc@gmail.com> 1771241250 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1771261240 +0100\n\nbench: switch helper to generated blocks and recipes\n\nThe helper migration still returned one fixed historical fixture block, which kept benchmark coverage narrow and blocked script-mix experiments.\nReplace the fixture-backed helper with runtime block generation and `ScriptRecipe` presets so callsites can tune output mixes.\nAdd unit tests that lock in deterministic seed behavior and helper round-trip validity.\nLink `bench_bitcoin` with `secp256k1` so benchmark code can include `<secp256k1.h>` and use canonical pubkey tag constants.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmTTTgACgkQZp//D/pH\nenZjag/8CNEcsIb86oHDggu+AeU7NdxBkM6Lu4GA1qlBZJejD1kvhJ+52Xk2s+m/\nCiDeaw4PSjK4DXINz0a6KFkaoj0rdgNWHzUbsHtrVWT3SW3kZDybG0o/QBwRY8sz\n+2WogsxcAXkmMvCkIUyvlPqZSqa9ggbBOodacR4ytKXiPyrkZvGls1Gu4K41LT0c\nXbAxWp/75zt+T2njRbRM9VTNZks647hIMBEDJ5iFphyG6q/JBeVL0vf/FuygAEEl\nMympsblXFqaZDcGKoFe9iyAw4UCkaNxkkw7OxzeI/WVkn5m41TJOhD/nFEUIvNEs\nOqHl0Kd9tZ7h2R4gc0+AWJgJojUSxMTpQV6q9RzKdu0M4QRy3FXF1FCYQif++HeH\n24gq1vmMD8OZWzVtjoKowF3FJAUp0TKS43XZWm0cDzd+87yf1IoDX8+DH4LRxP5W\nFnrSn6x5O/0guOMw+UW7xrHk0T+NiJHEMtWzW72UR71ve33ODj4vXcXRX7OuoWIX\nvf2MfIZL0xAs4xBQHON8YbGWhd3kdzs5WVyDOi88y0rswp+mW+PMYZJEQiHbU9TT\n0APUaaIdaeNnFZsLhjz2lpCEol6zNKJaPmcPfTHVbDTjb8IsirRpRNCTAlPeU62V\nC6Ja60ZxBINwJpSSXuOJHblK/9YzuAwzZa19MKdnVy1EL44EnlI=\n=ushl\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/10f41360a32e1e8942cfe819a012fa11bb1aed81",
          "sha": "10f41360a32e1e8942cfe819a012fa11bb1aed81",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/10f41360a32e1e8942cfe819a012fa11bb1aed81"
        }
      ],
      "message": "bench: switch helper to generated blocks and recipes\n\nThe helper migration still returned one fixed historical fixture block, which kept benchmark coverage narrow and blocked script-mix experiments.\nReplace the fixture-backed helper with runtime block generation and `ScriptRecipe` presets so callsites can tune output mixes.\nAdd unit tests that lock in deterministic seed behavior and helper round-trip validity.\nLink `bench_bitcoin` with `secp256k1` so benchmark code can include `<secp256k1.h>` and use canonical pubkey tag constants.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T17:00:40Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T11:27:30Z"
      },
      "sha": "c670acb1847e127a6dfecca413ec7bea024820cd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVhMDAxZjY2MjQ2NTk3YTA1MGNmZTFmMDgwNTkyY2MwZGExN2ViYzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea001f66246597a050cfe1f080592cc0da17ebc9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ea001f66246597a050cfe1f080592cc0da17ebc9",
      "tree": {
        "sha": "a6e9eac51b47e5d28eb0ea8e32005d8154012d86",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a6e9eac51b47e5d28eb0ea8e32005d8154012d86"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a6e9eac51b47e5d28eb0ea8e32005d8154012d86\nparent c670acb1847e127a6dfecca413ec7bea024820cd\nauthor Lrinc <pap.lorinc@gmail.com> 1771254848 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1771261693 +0100\n\nbench: remove embedded `block413567.raw` fixture\n\nAfter benchmarks switched to helper-generated data, the embedded `block413567.raw` fixture and its CMake raw-data wiring were no longer needed.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmTTv0ACgkQZp//D/pH\nenailA//acu6k01+5T/0z8V0WXDFuNEDAZrexCu4+OyxyPfCRzxkebxEPyrMM1e3\n80buzwCB5JzCTeAnmupTF8phEKzs3l7FIOglv62ToApR2c/yZ9XTtGJY3aHXxPjB\nX9fNmKBiigJgstu8mRDBdrXw2jmHa2BvMC49IBUBRE/Wiq63JlfIH9AeiLAEisNJ\nKGDMfRpDFdko9vbefQ4rHEg1a28ny/eWqfU91ejZ+B1JnQCscTsXaS2fmce0XuO8\nvPKgOb5vIYqbbdA7nHthhCh915EZlKLLb3gD4oezpcuAfh2ON/7UAO/LfXrFMHBl\nXmWKIYPK2glN5yzMl34j1ElBWM2qEiHDCEn9sN2RiN5T2hFCt9XlGz7ttdwtA+DJ\nTiCoTcDHlnLG3CItARnoiy8YGcOko4T6AvOtWC2GVci0SddPrjorlFbZ5wAHVDlh\nN299aHe3Scyc1hYBcG3WYNCX3RSEiUeX97fbOTfqQCwhJvncJ/qVH9jE3yyhJTrs\nbT5zUKLw3zfaEr5BSqJSFMHYdkujnVNkZcftrFMgyhTB9/i5XgEQIs07ljYxuCys\ntoE9Iz9EoSZJgrTXsRwuHaxjiZXtNdeN9f+ljJKIKabH0eJcQglS8jTyw1rwJ8eD\n+31eeXQEuevjdphM+T0AxdLU6LLoBBUG1HzdleuRRpLf5Gvgty0=\n=Atoa\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c670acb1847e127a6dfecca413ec7bea024820cd",
          "sha": "c670acb1847e127a6dfecca413ec7bea024820cd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c670acb1847e127a6dfecca413ec7bea024820cd"
        }
      ],
      "message": "bench: remove embedded `block413567.raw` fixture\n\nAfter benchmarks switched to helper-generated data, the embedded `block413567.raw` fixture and its CMake raw-data wiring were no longer needed.\n\nCo-authored-by: hodlinator <hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T17:08:13Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-16T15:14:08Z"
      },
      "sha": "ea001f66246597a050cfe1f080592cc0da17ebc9"
    },
    {
      "event": "reviewed",
      "id": 3808232123,
      "node_id": "PRR_kwDOABII587i_QK7",
      "url": null,
      "actor": null,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-16T17:09:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks a lot for the excellent review (I see you started it in December already).\nI have applied almost every suggestion in one shape or form - let's iterate on a few remaining ones, let's first see if there's an appetite for removing the pre-segwit block and having a configurable generator.\n\nSplit the change up to smaller commits, first migrating the existing benchmarks to a common interface, followed by introducing the new generator (and the deletion as a separate commit since that huge binary is breaking the diff tools for me)\nAdded you as coauthor.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#pullrequestreview-3808232123",
      "submitted_at": "2026-02-16T17:09:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22831088069,
      "node_id": "HRFPE_lADOABII5863HC1azwAAAAVQ1sHF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22831088069",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/ea001f66246597a050cfe1f080592cc0da17ebc9",
      "created_at": "2026-02-16T17:09:53Z"
    },
    {
      "event": "labeled",
      "id": 22832176848,
      "node_id": "LE_lADOABII5863HC1azwAAAAVQ517Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22832176848",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-16T18:02:24Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3932192898,
      "node_id": "IC_kwDOABII587qYICC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3932192898",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-20T07:38:18Z",
      "updated_at": "2026-02-20T07:38:18Z",
      "author_association": "MEMBER",
      "body": "Could turn into draft while CI is red?\r\n\r\nhttps://github.com/bitcoin/bitcoin/actions/runs/22071701913/job/63777633190?pr=32554#step:11:2752\r\n\r\n```\r\nbench_bitcoin: bench/block_generator.cpp:136: auto (anonymous namespace)::CreateScriptFactory(FastRandomContext &, const benchmark::ScriptRecipe &): Assertion `sum <= 1.0 && sum + 0.01 > 1.0' failed.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3932192898",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641210291",
      "pull_request_review_id": 3605702499,
      "id": 2641210291,
      "node_id": "PRRC_kwDOABII586dbauz",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BENCH_BLOCK_GENERATOR_H\n+#define BITCOIN_BENCH_BLOCK_GENERATOR_H\n+\n+#include <kernel/chainparams.h>\n+#include <primitives/block.h>\n+#include <uint256.h>\n+\n+#include <streams.h>\n+\n+namespace benchmark {\n+struct ScriptRecipe\n+{\n+    //! per-output type probabilities  must sum  1.0\n+    double anchor_prob{0};\n+    double multisig_prob{0};\n+    double null_data_prob{0};\n+    double pubkey_prob{0};\n+    double pubkeyhash_prob{0};\n+    double scripthash_prob{0};\n+    double witness_v1_taproot_prob{0};\n+    double witness_v0_keyhash_prob{0};\n+    double witness_v0_scripthash_prob{0};\n+    double witness_unknown_prob{0};\n+    double nonstandard_prob{0};\n+\n+    //! tuning\n+    size_t tx_count{0};\n+    double geometric_base_prob{0.5};\n+};\n+\n+/* purely legacy outputs, useful for pre-SegWit baselines */\n+inline constexpr ScriptRecipe kLegacy{\n+    .anchor_prob = 0.00,\n+    .multisig_prob = 0.05,\n+    .null_data_prob = 0.005,\n+    .pubkey_prob = 0.10,\n+    .pubkeyhash_prob = 0.20,\n+    .scripthash_prob = 0.10,\n+    .witness_v1_taproot_prob = 0.00,\n+    .witness_v0_keyhash_prob = 0.00,\n+    .witness_v0_scripthash_prob = 0.00,\n+    .witness_unknown_prob = 0.00,\n+    .nonstandard_prob = 0.005,\n+\n+    .tx_count = 1500,\n+};\n+\n+/* witness-heavy mix (roughly Taproot-era main chain) */\n+inline constexpr ScriptRecipe kWitness{\n+    .anchor_prob = 0.001,\n+    .multisig_prob = 0.005,\n+    .null_data_prob = 0.002,\n+    .pubkey_prob = 0.001,\n+    .pubkeyhash_prob = 0.02,\n+    .scripthash_prob = 0.01,\n+    .witness_v1_taproot_prob = 0.20,\n+    .witness_v0_keyhash_prob = 0.25,\n+    .witness_v0_scripthash_prob = 0.05,\n+    .witness_unknown_prob = 0.02,\n+    .nonstandard_prob = 0.02,\n+\n+    .tx_count = 2000,\n+};\n+\n+DataStream GetBlockData(\n+    const CChainParams& chain_params = *CChainParams::RegTest(CChainParams::RegTestOptions{}),\n+    const ScriptRecipe& = kWitness,\n+    const uint256& seed = {}\n+);\n+CBlock GetBlock(",
      "path": "src/bench/block_generator.h",
      "position": 1,
      "original_position": 74,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Naming should probably indicate work/computation:\r\n```suggestion\r\nDataStream GenerateBlockData(\r\n    const CChainParams& chain_params = *CChainParams::RegTest(CChainParams::RegTestOptions{}),\r\n    const ScriptRecipe& = kWitness,\r\n    const uint256& seed = {}\r\n);\r\nCBlock GenerateBlock(\r\n```",
      "created_at": "2025-12-22T20:55:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641210291",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641210291"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 69,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641223542",
      "pull_request_review_id": 3605702499,
      "id": 2641223542,
      "node_id": "PRRC_kwDOABII586dbd92",
      "diff_hunk": "@@ -35,17 +35,18 @@\n  */\n static void LoadExternalBlockFile(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};",
      "path": "src/bench/load_external.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "My guess is that we are changing networks in order to get a `powLimit` which allows for trivially finding a valid nonce. Could the commit message spell this out?\r\n\r\nCould also replace this assert...\r\nhttps://github.com/bitcoin/bitcoin/blob/0fbbefd017a817bc32b5eb4dbb7647c668c8a61f/src/bench/block_generator.cpp#L76-L78\r\n\r\n...with a more direct assert further down, closer to where it's important:\r\n```C++\r\n    block.hashPrevBlock = params.GenesisBlock().GetHash();\r\n    assert(params.GetConsensus().powLimit == uint256{\"7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"}); // lowest difficulty\r\n    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact();\r\n```",
      "created_at": "2025-12-22T21:01:28Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641223542",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641223542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 38,
      "original_start_line": 38,
      "start_side": "LEFT",
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641285591",
      "pull_request_review_id": 3605702499,
      "id": 2641285591,
      "node_id": "PRRC_kwDOABII586dbtHX",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 142,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Maybe have genesis block as previous block to be slightly more regular, instead of being a second genesis block (due to null `hashPrevBlock`)?\r\n```suggestion\r\n    block.nTime = params.GenesisBlock().nTime + 10 * 60;\r\n    block.hashPrevBlock = params.GenesisBlock().GetHash();\r\n    block.nBits = params.GenesisBlock().nBits;\r\n```\r\nBeing the genesis block also presents a mystery as non-coinbase transactions shouldn't be possible in genesis as outputs cannot be spent for 100 blocks. (I guess making us the second block doesn't help too much in that respect as the first 100 blocks should only have a coinbase transaction).",
      "created_at": "2025-12-22T21:21:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641285591",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641285591"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 140,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641304162",
      "pull_request_review_id": 3605702499,
      "id": 2641304162,
      "node_id": "PRRC_kwDOABII586dbxpi",
      "diff_hunk": "@@ -3,16 +3,19 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <bench/bench.h>\n-#include <bench/data/block413567.raw.h>\n+#include <pubkey.h>\n+#include <random.h>\n #include <span.h>\n #include <util/strencodings.h>\n \n+#include <cstdint>\n #include <vector>\n \n static void HexStrBench(benchmark::Bench& bench)\n {\n-    auto const& data = benchmark::data::block413567;\n-    bench.batch(data.size()).unit(\"byte\").run([&] {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    auto data{rng.randbytes<uint8_t>(CPubKey::COMPRESSED_SIZE)};",
      "path": "src/bench/strencodings.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Why not go for something in the same order of magnitude in size as on master, and use more modern std::bytes?\r\n```suggestion\r\n    auto data{rng.randbytes(MAX_BLOCK_WEIGHT)};\r\n```",
      "created_at": "2025-12-22T21:30:11Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641304162",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641304162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641314769",
      "pull_request_review_id": 3605702499,
      "id": 2641314769,
      "node_id": "PRRC_kwDOABII586db0PR",
      "diff_hunk": "@@ -19,32 +19,26 @@\n #include <memory>\n #include <vector>\n \n-static CBlock CreateTestBlock()\n-{\n-    DataStream stream{benchmark::data::block413567};\n-    CBlock block;\n-    stream >> TX_WITH_WITNESS(block);\n-    return block;\n-}\n-\n static void WriteBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const CBlock block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     bench.run([&] {\n-        const auto pos{blockman.WriteBlock(block, 413'567)};\n+        const auto pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};\n         assert(!pos.IsNull());\n     });\n }\n \n static void ReadBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const auto& test_block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     const auto& expected_hash{test_block.GetHash()};\n-    const auto& pos{blockman.WriteBlock(test_block, 413'567)};\n+    const auto& pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};",
      "path": "src/bench/readwriteblock.cpp",
      "position": 53,
      "original_position": 46,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think height should technically be 0 if we don't have a prev block - then again, we have a bunch of random non-coinbase transactions, which should disqualify us from being a genesis block.\r\n\r\n1 would be correct if our prev is genesis though, see my other comment.",
      "created_at": "2025-12-22T21:35:02Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641314769",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641314769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 34,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641333273",
      "pull_request_review_id": 3605702499,
      "id": 2641333273,
      "node_id": "PRRC_kwDOABII586db4wZ",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 48,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n            const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n```",
      "created_at": "2025-12-22T21:44:33Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641333273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641333273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641343010",
      "pull_request_review_id": 3605702499,
      "id": 2641343010,
      "node_id": "PRRC_kwDOABII586db7Ii",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 55,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Not sure what's going on here regarding the sometimes need of explicit type, but might as well stay consistent:\r\n```suggestion\r\n        std::pair{rec.null_data_prob, [&] {\r\n```",
      "created_at": "2025-12-22T21:49:51Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641343010",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641343010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641347270",
      "pull_request_review_id": 3605702499,
      "id": 2641347270,
      "node_id": "PRRC_kwDOABII586db8LG",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Developer notes encourage:\n```suggestion\nauto CreateScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n```",
      "created_at": "2025-12-22T21:51:59Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641347270",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641347270"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641351946",
      "pull_request_review_id": 3605702499,
      "id": 2641351946,
      "node_id": "PRRC_kwDOABII586db9UK",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 43,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Would prefer only mentioning namespace once at the top:\r\n\r\n```C++\r\nnamespace benchmark {\r\nnamespace {\r\n...\r\n```\r\n\r\n```suggestion\r\nauto createScriptFactory(FastRandomContext& rng, const ScriptRecipe& rec)\r\n```",
      "created_at": "2025-12-22T21:54:06Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641351946",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641351946"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641357046",
      "pull_request_review_id": 3605702499,
      "id": 2641357046,
      "node_id": "PRRC_kwDOABII586db-j2",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Could be uncompressed in some cases: https://learnmeabitcoin.com/technical/script/p2pk/",
      "created_at": "2025-12-22T21:56:43Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641357046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641357046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641396988",
      "pull_request_review_id": 3605702499,
      "id": 2641396988,
      "node_id": "PRRC_kwDOABII586dcIT8",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};",
      "path": "src/bench/block_generator.cpp",
      "position": 147,
      "original_position": 79,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Defaulting to initializing with a zero seed makes it not only deterministic, but even equal between process executions on different machines. If this design is intentional the rationale should be documented.",
      "created_at": "2025-12-22T22:13:13Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641396988",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641396988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 147,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641410600",
      "pull_request_review_id": 3605702499,
      "id": 2641410600,
      "node_id": "PRRC_kwDOABII586dcLoo",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));",
      "path": "src/bench/block_generator.cpp",
      "position": 164,
      "original_position": 93,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "https://learnmeabitcoin.com/technical/mining/coinbase-transaction/#requirements\r\n\r\n> [BIP 141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki): If the block contains [segwit transactions](https://learnmeabitcoin.com/technical/transaction/#example-segwit), the [witness](https://learnmeabitcoin.com/technical/transaction/witness/) field must contain a 32-byte [witness reserved value](https://learnmeabitcoin.com/technical/transaction/witness/#witness-reserved-value).\r\n\r\n> [BIP 141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki): If the block contains segwit transactions, one of the outputs must contain the [wTXID commitment](https://learnmeabitcoin.com/technical/transaction/wtxid/#commitment).",
      "created_at": "2025-12-22T22:18:38Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641410600",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641410600"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 164,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641414192",
      "pull_request_review_id": 3605702499,
      "id": 2641414192,
      "node_id": "PRRC_kwDOABII586dcMgw",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 96,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    auto script_factory{createScriptFactory(rng, rec)};\r\n```",
      "created_at": "2025-12-22T22:20:59Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641414192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641414192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2644156219",
      "pull_request_review_id": 3605702499,
      "id": 2644156219,
      "node_id": "PRRC_kwDOABII586dmp87",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};",
      "path": "src/bench/block_generator.cpp",
      "position": 150,
      "original_position": 82,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "When experimenting with changing the scripts I hit block size limits with just 2000 transactions due to large scripts.\r\n\r\nIt seems more precise to have `rec.tx_occupancy_limit` between `0.0-1.0` and just fill up the block with transactions until the serialized size exceeds that fraction of the maximum size. Then pop off the last added transaction to make sure we keep under the limit.\r\n\r\nWe could also insert an OP_RETURN output to a random tx to make it reach exactly the limit.\r\n\r\n<details><summary>Diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 2782b8d129..da7741f328 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -79,10 +79,10 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n     FastRandomContext rng{seed};\r\n \r\n     assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\r\n-    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\r\n+    const auto tx_occupancy_limit{rec.tx_occupancy_limit != 0.0 ? rec.tx_occupancy_limit : MakeUnitDouble(rng.rand64())};\r\n \r\n     CBlock block{};\r\n-    block.vtx.reserve(1 + tx_count);\r\n+    block.vtx.reserve(1 + (4000 * tx_occupancy_limit));\r\n \r\n     // coinbase\r\n     {\r\n@@ -95,7 +95,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n \r\n     auto scriptFactory{createScriptFactory(rng, rec)};\r\n     auto rand_script{[&] {\r\n-        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\r\n+        double probability{MakeUnitDouble(rng.rand64())};\r\n         for (const auto& [p, factory] : scriptFactory) {\r\n             if (probability < p) return factory();\r\n             probability -= p;\r\n@@ -104,7 +104,12 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         return CScript(raw.begin(), raw.end());\r\n     }};\r\n \r\n-    for (size_t i{0}; i < tx_count; ++i) {\r\n+    // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\n+    uint64_t block_size_no_witness{::GetSerializeSize(TX_NO_WITNESS(block)) + 2};\r\n+    uint64_t block_size_with_witness{::GetSerializeSize(TX_WITH_WITNESS(block)) + 2};\r\n+    const uint64_t block_size_limit(tx_occupancy_limit * MAX_BLOCK_WEIGHT);\r\n+    while (block_size_no_witness * WITNESS_SCALE_FACTOR < block_size_limit\r\n+           && block_size_no_witness * WITNESS_SCALE_FACTOR + (block_size_with_witness - block_size_no_witness) < block_size_limit) {\r\n         CMutableTransaction tx;\r\n         tx.version = 1 + rng.randrange<int>(3);\r\n         tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\r\n@@ -133,8 +138,12 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n             tx_out.scriptPubKey = rand_script();\r\n         }\r\n \r\n+        block_size_no_witness += ::GetSerializeSize(TX_NO_WITNESS(tx));\r\n+        block_size_with_witness += ::GetSerializeSize(TX_WITH_WITNESS(tx));\r\n         block.vtx.push_back(MakeTransactionRef(std::move(tx)));\r\n     }\r\n+    // Remove the transaction that had us exceed the limit.\r\n+    block.vtx.pop_back();\r\n \r\n     block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\r\n     block.nTime = params.GenesisBlock().nTime;\r\ndiff --git a/src/bench/block_generator.h b/src/bench/block_generator.h\r\nindex 4560005d53..4ce71f9c24 100644\r\n--- a/src/bench/block_generator.h\r\n+++ b/src/bench/block_generator.h\r\n@@ -28,7 +28,7 @@ struct ScriptRecipe\r\n     double nonstandard_prob{0};\r\n \r\n     //! tuning\r\n-    size_t tx_count{0};\r\n+    double tx_occupancy_limit{0}; // 0 means random, 1.0 is a full block.\r\n     double geometric_base_prob{0.5};\r\n };\r\n \r\n@@ -46,7 +46,7 @@ inline constexpr ScriptRecipe kLegacy{\r\n     .witness_unknown_prob = 0.00,\r\n     .nonstandard_prob = 0.005,\r\n \r\n-    .tx_count = 1500,\r\n+    .tx_occupancy_limit = 0.8,\r\n };\r\n \r\n /* witness-heavy mix (roughly Taproot-era main chain) */\r\n@@ -63,7 +63,7 @@ inline constexpr ScriptRecipe kWitness{\r\n     .witness_unknown_prob = 0.02,\r\n     .nonstandard_prob = 0.02,\r\n \r\n-    .tx_count = 2000,\r\n+    .tx_occupancy_limit = 1.0,\r\n };\r\n \r\n DataStream GetBlockData(\r\ndiff --git a/src/random.cpp b/src/random.cpp\r\nindex aeaf6baa8e..1908d45644 100644\r\n--- a/src/random.cpp\r\n+++ b/src/random.cpp\r\n@@ -701,16 +701,22 @@ void RandomInit()\r\n     ReportHardwareRand();\r\n }\r\n \r\n+double MakeUnitDouble(uint64_t uniform) noexcept\r\n+{\r\n+    // Convert uniform into a uniformly-distributed double in range [0, 1), use the expression\r\n+    // ((uniform >> 11) * 0x1.0p-53), as described in https://prng.di.unimi.it/ under\r\n+    // \"Generating uniform doubles in the unit interval\". Call this value x.\r\n+    return (uniform >> 11) * -0x1.0p-53;\r\n+}\r\n+\r\n double MakeExponentiallyDistributed(uint64_t uniform) noexcept\r\n {\r\n     // To convert uniform into an exponentially-distributed double, we use two steps:\r\n-    // - Convert uniform into a uniformly-distributed double in range [0, 1), use the expression\r\n-    //   ((uniform >> 11) * 0x1.0p-53), as described in https://prng.di.unimi.it/ under\r\n-    //   \"Generating uniform doubles in the unit interval\". Call this value x.\r\n+    // - MakeUnitDouble()\r\n     // - Given an x in uniformly distributed in [0, 1), we find an exponentially distributed value\r\n     //   by applying the quantile function to it. For the exponential distribution with mean 1 this\r\n     //   is F(x) = -log(1 - x).\r\n     //\r\n     // Combining the two, and using log1p(x) = log(1 + x), we obtain the following:\r\n-    return -std::log1p((uniform >> 11) * -0x1.0p-53);\r\n+    return -std::log1p(MakeUnitDouble(uniform));\r\n }\r\ndiff --git a/src/random.h b/src/random.h\r\nindex f0c0dcee81..ac2c5e924e 100644\r\n--- a/src/random.h\r\n+++ b/src/random.h\r\n@@ -158,6 +158,9 @@ concept StdChronoDuration = requires {\r\n         std::type_identity<T>());\r\n };\r\n \r\n+/** Given a uniformly random uint64_t, return a uniformly-distributed double in range [0, 1). */\r\n+double MakeUnitDouble(uint64_t uniform) noexcept;\r\n+\r\n /** Given a uniformly random uint64_t, return an exponentially distributed double with mean 1. */\r\n double MakeExponentiallyDistributed(uint64_t uniform) noexcept;\r\n \r\n```\r\n\r\n</details>",
      "created_at": "2025-12-23T20:01:41Z",
      "updated_at": "2026-02-11T16:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2644156219",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2644156219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 150,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784493271",
      "pull_request_review_id": 3605702499,
      "id": 2784493271,
      "node_id": "PRRC_kwDOABII586l9_7X",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty\n+    block.nNonce = rng.rand32();\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    while (!CheckProofOfWork(block.GetHash(), block.nBits, params.GetConsensus())) {\n+        ++block.nNonce;\n+    }\n+\n+    // Make sure we've generated a valid block",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 149,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Could add caveat:\n```suggestion\n    // Make sure we've generated a valid block (barring checks requiring context of other blocks)\n```",
      "created_at": "2026-02-09T20:55:32Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2784493271",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784493271"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784737375",
      "pull_request_review_id": 3605702499,
      "id": 2784737375,
      "node_id": "PRRC_kwDOABII586l-7hf",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 56,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Might want to make OP_RETURNs very large sometimes, probably using non-linear randomness?",
      "created_at": "2026-02-09T22:02:41Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2784737375",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784737375"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 56,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2786977791",
      "pull_request_review_id": 3605702499,
      "id": 2786977791,
      "node_id": "PRRC_kwDOABII586mHef_",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty\n+    block.nNonce = rng.rand32();\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    while (!CheckProofOfWork(block.GetHash(), block.nBits, params.GetConsensus())) {\n+        ++block.nNonce;\n+    }\n+\n+    // Make sure we've generated a valid block\n+    {\n+        BlockValidationState validationState;\n+        const bool checked{CheckBlock(block, validationState, params.GetConsensus())};\n+        assert(checked);",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 153,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Naming:\n```suggestion\n        const bool valid{CheckBlock(block, validationState, params.GetConsensus())};\n        assert(valid);\n```",
      "created_at": "2026-02-10T10:00:17Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2786977791",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2786977791"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 152,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787204189",
      "pull_request_review_id": 3605702499,
      "id": 2787204189,
      "node_id": "PRRC_kwDOABII586mIVxd",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BENCH_BLOCK_GENERATOR_H\n+#define BITCOIN_BENCH_BLOCK_GENERATOR_H\n+\n+#include <kernel/chainparams.h>\n+#include <primitives/block.h>\n+#include <uint256.h>\n+\n+#include <streams.h>\n+\n+namespace benchmark {\n+struct ScriptRecipe\n+{\n+    //! per-output type probabilities  must sum  1.0\n+    double anchor_prob{0};\n+    double multisig_prob{0};\n+    double null_data_prob{0};\n+    double pubkey_prob{0};\n+    double pubkeyhash_prob{0};\n+    double scripthash_prob{0};\n+    double witness_v1_taproot_prob{0};\n+    double witness_v0_keyhash_prob{0};\n+    double witness_v0_scripthash_prob{0};\n+    double witness_unknown_prob{0};\n+    double nonstandard_prob{0};\n+\n+    //! tuning\n+    size_t tx_count{0};",
      "path": "src/bench/block_generator.h",
      "position": 1,
      "original_position": 31,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Could document field (unless the approach is switched to `min_tx_occupancy`, see other comment):\r\n```suggestion\r\n    size_t tx_count{0}; //!< Does not include coinbase tx. Leave at 0 to pick a random, valid number.\r\n```",
      "created_at": "2026-02-10T10:44:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2787204189",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787204189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792800008",
      "pull_request_review_id": 3605702499,
      "id": 2792800008,
      "node_id": "PRRC_kwDOABII586mdr8I",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 104,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think it would be better to require that `ScriptRecipe` probabilities add up to ~1.0 and not generate random scripts as a fallback.\r\n\r\nIf we want to still generate random scripts it should be it's own `ScriptRecipe::random_prob` field IMO.\r\n\r\n<details><summary>Diff which applies on top off the tx_occupancy_limit-suggestion from other comment</summary>\r\n\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 1bedfb5f9d..1891400d20 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -68,7 +68,9 @@ auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe&\r\n \r\n     double sum{};\r\n     for (const auto& p : table | std::views::keys) sum += p;\r\n+    // Verify that probabilities add up to ~1.0.\r\n     assert(sum <= 1);\r\n+    assert(sum + 0.01 > 1.0);\r\n \r\n     return table;\r\n }\r\n@@ -100,8 +102,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n             if (probability < p) return factory();\r\n             probability -= p;\r\n         }\r\n-        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\r\n-        return CScript(raw.begin(), raw.end());\r\n+        return scriptFactory.back().second();\r\n     }};\r\n \r\n     // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\ndiff --git a/src/bench/block_generator.h b/src/bench/block_generator.h\r\nindex 4ce71f9c24..9ce7ea5ad8 100644\r\n--- a/src/bench/block_generator.h\r\n+++ b/src/bench/block_generator.h\r\n@@ -35,16 +35,16 @@ struct ScriptRecipe\r\n /* purely legacy outputs, useful for pre-SegWit baselines */\r\n inline constexpr ScriptRecipe kLegacy{\r\n     .anchor_prob = 0.00,\r\n-    .multisig_prob = 0.05,\r\n-    .null_data_prob = 0.005,\r\n-    .pubkey_prob = 0.10,\r\n-    .pubkeyhash_prob = 0.20,\r\n-    .scripthash_prob = 0.10,\r\n-    .witness_v1_taproot_prob = 0.00,\r\n-    .witness_v0_keyhash_prob = 0.00,\r\n-    .witness_v0_scripthash_prob = 0.00,\r\n-    .witness_unknown_prob = 0.00,\r\n-    .nonstandard_prob = 0.005,\r\n+    .multisig_prob = 0.10,\r\n+    .null_data_prob = 0.01,\r\n+    .pubkey_prob = 0.20,\r\n+    .pubkeyhash_prob = 0.43,\r\n+    .scripthash_prob = 0.23,\r\n+    .witness_v1_taproot_prob = 0,\r\n+    .witness_v0_keyhash_prob = 0,\r\n+    .witness_v0_scripthash_prob = 0,\r\n+    .witness_unknown_prob = 0,\r\n+    .nonstandard_prob = 0.025,\r\n \r\n     .tx_occupancy_limit = 0.8,\r\n };\r\n@@ -53,13 +53,13 @@ inline constexpr ScriptRecipe kLegacy{\r\n inline constexpr ScriptRecipe kWitness{\r\n     .anchor_prob = 0.001,\r\n     .multisig_prob = 0.005,\r\n-    .null_data_prob = 0.002,\r\n+    .null_data_prob = 0.01,\r\n     .pubkey_prob = 0.001,\r\n     .pubkeyhash_prob = 0.02,\r\n     .scripthash_prob = 0.01,\r\n-    .witness_v1_taproot_prob = 0.20,\r\n-    .witness_v0_keyhash_prob = 0.25,\r\n-    .witness_v0_scripthash_prob = 0.05,\r\n+    .witness_v1_taproot_prob = 0.35,\r\n+    .witness_v0_keyhash_prob = 0.40,\r\n+    .witness_v0_scripthash_prob = 0.16,\r\n     .witness_unknown_prob = 0.02,\r\n     .nonstandard_prob = 0.02,\r\n \r\n```\r\n\r\n</details>",
      "created_at": "2026-02-11T11:37:42Z",
      "updated_at": "2026-02-11T16:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2792800008",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792800008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 103,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 104,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792847114",
      "pull_request_review_id": 3605702499,
      "id": 2792847114,
      "node_id": "PRRC_kwDOABII586md3cK",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How about generating semi-realistic script sigs / unlock scripts?\r\n\r\n<details><summary>WIP diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 1891400d20..4ee174f8f5 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -40,39 +40,164 @@ CPubKey RandPub(FastRandomContext& rng)\r\n     return CPubKey(pubkey.begin(), pubkey.end());\r\n }\r\n \r\n-auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\r\n+struct FactoryEntry {\r\n+    const double prob;\r\n+    const std::function<CScript()> lock_script;\r\n+    const std::function<CScript()> unlock_script;\r\n+    const std::function<CScript()> witness_script; // TODO write + use field\r\n+};\r\n+\r\n+auto createScriptFactory(FastRandomContext& rng, const CExtKey& xprv, const benchmark::ScriptRecipe& rec)\r\n {\r\n-    std::array<std::pair<double, std::function<CScript()>>, 11> table{\r\n-        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\r\n-        std::pair{rec.multisig_prob, [&] {\r\n-            const size_t keys_count{1 + rng.randrange<size_t>(15)};\r\n-            const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n-            std::vector<CPubKey> keys;\r\n-            keys.reserve(keys_count);\r\n-            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\r\n-            return GetScriptForMultisig(required, keys);\r\n-        }},\r\n-        {rec.null_data_prob, [&] {\r\n-            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\r\n-            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\r\n-        }},\r\n-        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\r\n-        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\r\n-        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\r\n-        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\r\n-        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\r\n-        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\r\n-        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\r\n-        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\r\n+    FactoryEntry table[] = {\r\n+        {\r\n+            .prob = rec.anchor_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(PayToAnchor{}); },\r\n+            .unlock_script = {}, // TODO: confirm correctness\r\n+            .witness_script = {}, // TODO: confirm correctness\r\n+        },\r\n+        {\r\n+            .prob = rec.multisig_prob,\r\n+            .lock_script = [&] {\r\n+                const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n+                const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n+                std::vector<CPubKey> keys;\r\n+                keys.reserve(keys_count);\r\n+                for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\r\n+                return GetScriptForMultisig(required, keys);\r\n+            },\r\n+            .unlock_script = [&] {\r\n+                const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n+                const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n+                std::vector<CKey> priv_keys;\r\n+                priv_keys.reserve(keys_count);\r\n+                std::vector<CPubKey> pub_keys;\r\n+                pub_keys.reserve(keys_count);\r\n+\r\n+                for (size_t i{}; i < keys_count; ++i) {\r\n+                    CExtKey child_xprv;\r\n+                    Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                    const CKey priv{child_xprv.key};\r\n+                    priv_keys.push_back(priv);\r\n+                    pub_keys.push_back(priv.GetPubKey());\r\n+                }\r\n+\r\n+                const CScript prevout_lock_script{GetScriptForMultisig(required, pub_keys)};\r\n+\r\n+                CScript s{OP_0}; // Extra required dummy value for CHECKMULTISIG.\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                for (size_t i{}; i < required; ++i) {\r\n+                    std::vector<uint8_t> sig;\r\n+                    Assert(priv_keys[i].Sign(sighash, sig));\r\n+                    sig.push_back(sighash_type);\r\n+                    s << sig;\r\n+                }\r\n+\r\n+                return s;\r\n+            },\r\n+            .witness_script = {}, // TODO: confirm correctness\r\n+        },\r\n+        {\r\n+            .prob = rec.null_data_prob,\r\n+            .lock_script = [&] {\r\n+                const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\r\n+                return CScript{} << OP_RETURN << rng.randbytes(len);\r\n+            },\r\n+            .unlock_script = {},  // Unspendable\r\n+            .witness_script = {}, // Unspendable\r\n+        },\r\n+        {\r\n+            .prob = rec.pubkey_prob,\r\n+            .lock_script = [&] { return GetScriptForRawPubKey(RandPub(rng)); },\r\n+            .unlock_script = [&] {\r\n+                CExtKey child_xprv;\r\n+                Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                const CKey priv{child_xprv.key};\r\n+                const CPubKey pub{priv.GetPubKey()};\r\n+                const CScript prevout_lock_script{GetScriptForRawPubKey(pub)};\r\n+\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                std::vector<uint8_t> sig;\r\n+                Assert(priv.Sign(sighash, sig));\r\n+                sig.push_back(sighash_type);\r\n+\r\n+                return CScript{} << sig;\r\n+            },\r\n+            .witness_script = {},\r\n+        },\r\n+        {\r\n+            .prob = rec.pubkeyhash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(PKHash(RandPub(rng))); },\r\n+            .unlock_script = [&] {\r\n+                CExtKey child_xprv;\r\n+                Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                const CKey priv{child_xprv.key};\r\n+                const CPubKey pub{priv.GetPubKey()};\r\n+                const CScript prevout_lock_script{GetScriptForRawPubKey(pub)};\r\n+\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                std::vector<uint8_t> sig;\r\n+                Assert(priv.Sign(sighash, sig));\r\n+                sig.push_back(sighash_type);\r\n+\r\n+                return CScript{} << sig << pub;\r\n+            },\r\n+            .witness_script = {},\r\n+        },\r\n+        {\r\n+            .prob = rec.scripthash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v1_taproot_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v0_keyhash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v0_scripthash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_unknown_prob,\r\n+            .lock_script = [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.nonstandard_prob,\r\n+            .lock_script = [&] { return CScript() << OP_TRUE; },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n     };\r\n \r\n     double sum{};\r\n-    for (const auto& p : table | std::views::keys) sum += p;\r\n+    for (const auto& e : table) sum += e.prob;\r\n     // Verify that probabilities add up to ~1.0.\r\n     assert(sum <= 1);\r\n     assert(sum + 0.01 > 1.0);\r\n \r\n-    return table;\r\n+    return std::to_array(table);\r\n }\r\n \r\n CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\r\n@@ -80,6 +205,10 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n     assert(params.IsTestChain());\r\n     FastRandomContext rng{seed};\r\n \r\n+    CExtKey xprv;\r\n+    constexpr auto xprv_seed{std::to_array({std::byte{'2'}, std::byte{'1'}})};\r\n+    xprv.SetSeed(xprv_seed);\r\n+\r\n     assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\r\n     const auto tx_occupancy_limit{rec.tx_occupancy_limit != 0.0 ? rec.tx_occupancy_limit : MakeUnitDouble(rng.rand64())};\r\n \r\n@@ -95,14 +224,33 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         block.vtx.push_back(MakeTransactionRef(std::move(cb)));\r\n     }\r\n \r\n-    auto scriptFactory{createScriptFactory(rng, rec)};\r\n-    auto rand_script{[&] {\r\n+    auto scriptFactory{createScriptFactory(rng, xprv, rec)};\r\n+    auto rand_lock_script{[&] {\r\n         double probability{MakeUnitDouble(rng.rand64())};\r\n-        for (const auto& [p, factory] : scriptFactory) {\r\n-            if (probability < p) return factory();\r\n-            probability -= p;\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (probability < entry.prob) return entry.lock_script();\r\n+            probability -= entry.prob;\r\n+        }\r\n+        return scriptFactory.back().lock_script();\r\n+    }};\r\n+    const double unlock_script_prob{[&] {\r\n+        double sum{0.0};\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (entry.unlock_script) sum += entry.prob;\r\n+        }\r\n+        return sum;\r\n+    }()};\r\n+    auto rand_unlock_script{[&] {\r\n+        const FactoryEntry* last_unlock_entry{nullptr};\r\n+        double probability{MakeUnitDouble(rng.rand64()) * unlock_script_prob};\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (!entry.unlock_script) continue;\r\n+            last_unlock_entry = &entry;\r\n+            if (probability < entry.prob) return entry.unlock_script();\r\n+            probability -= entry.prob;\r\n         }\r\n-        return scriptFactory.back().second();\r\n+        assert(last_unlock_entry);\r\n+        return last_unlock_entry->unlock_script();\r\n     }};\r\n \r\n     // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\n@@ -120,7 +268,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         for (size_t in{0}; in < in_count; ++in) {\r\n             auto& tx_in{tx.vin[in]};\r\n             tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\r\n-            tx_in.scriptSig = rand_script();\r\n+            tx_in.scriptSig = rand_unlock_script();\r\n \r\n             const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\r\n             tx_in.scriptWitness.stack.reserve(witness_count);\r\n@@ -136,7 +284,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         for (size_t out{0}; out < out_count; ++out) {\r\n             auto& tx_out{tx.vout[out]};\r\n             tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\r\n-            tx_out.scriptPubKey = rand_script();\r\n+            tx_out.scriptPubKey = rand_lock_script();\r\n         }\r\n \r\n         block_size_no_witness += ::GetSerializeSize(TX_NO_WITNESS(tx));\r\ndiff --git a/src/bench/checkblock.cpp b/src/bench/checkblock.cpp\r\nindex 2bc03818ac..23354ba39c 100644\r\n--- a/src/bench/checkblock.cpp\r\n+++ b/src/bench/checkblock.cpp\r\n@@ -7,6 +7,7 @@\r\n #include <chainparams.h>\r\n #include <common/args.h>\r\n #include <consensus/validation.h>\r\n+#include <key.h>\r\n #include <primitives/block.h>\r\n #include <primitives/transaction.h>\r\n #include <streams.h>\r\n@@ -16,7 +17,6 @@\r\n #include <cassert>\r\n #include <cstddef>\r\n #include <memory>\r\n-#include <vector>\r\n \r\n // These are the two major time-sinks which happen after we have fully received\r\n // a block off the wire, but before we can relay the block on to peers using\r\n@@ -24,6 +24,7 @@\r\n \r\n static void DeserializeBlockTest(benchmark::Bench& bench)\r\n {\r\n+    ECC_Context ec_context;\r\n     auto stream{benchmark::GetBlockData()};\r\n     std::byte a{0};\r\n     stream.write({&a, 1}); // Prevent compaction\r\n@@ -37,6 +38,7 @@ static void DeserializeBlockTest(benchmark::Bench& bench)\r\n \r\n static void DeserializeAndCheckBlockTest(benchmark::Bench& bench)\r\n {\r\n+    ECC_Context ec_context;\r\n     const auto& chain_params{CChainParams::RegTest(CChainParams::RegTestOptions{})};\r\n     auto stream{benchmark::GetBlockData(*chain_params)};\r\n     std::byte a{0};\r\n```\r\n\r\n</details>",
      "created_at": "2026-02-11T11:49:09Z",
      "updated_at": "2026-02-11T16:38:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2792847114",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792847114"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793347220",
      "pull_request_review_id": 3784878585,
      "id": 2793347220,
      "node_id": "PRRC_kwDOABII586mfxiU",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2792847114,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm happy to continue working in this direction of more realistic scripts, but wanted to see what you thought before \"helping\" with something you might disagree with.",
      "created_at": "2026-02-11T13:38:32Z",
      "updated_at": "2026-02-11T13:38:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2793347220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793347220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812080265",
      "pull_request_review_id": 3808232123,
      "id": 2812080265,
      "node_id": "PRRC_kwDOABII586nnPCJ",
      "diff_hunk": "@@ -3,16 +3,19 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <bench/bench.h>\n-#include <bench/data/block413567.raw.h>\n+#include <pubkey.h>\n+#include <random.h>\n #include <span.h>\n #include <util/strencodings.h>\n \n+#include <cstdint>\n #include <vector>\n \n static void HexStrBench(benchmark::Bench& bench)\n {\n-    auto const& data = benchmark::data::block413567;\n-    bench.batch(data.size()).unit(\"byte\").run([&] {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    auto data{rng.randbytes<uint8_t>(CPubKey::COMPRESSED_SIZE)};",
      "path": "src/bench/strencodings.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641304162,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good idea, applied those and split it into a separate PR, and added you as co-author in #34598",
      "created_at": "2026-02-16T12:00:16Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812080265",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812080265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812350463",
      "pull_request_review_id": 3808232123,
      "id": 2812350463,
      "node_id": "PRRC_kwDOABII586noQ__",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BENCH_BLOCK_GENERATOR_H\n+#define BITCOIN_BENCH_BLOCK_GENERATOR_H\n+\n+#include <kernel/chainparams.h>\n+#include <primitives/block.h>\n+#include <uint256.h>\n+\n+#include <streams.h>\n+\n+namespace benchmark {\n+struct ScriptRecipe\n+{\n+    //! per-output type probabilities  must sum  1.0\n+    double anchor_prob{0};\n+    double multisig_prob{0};\n+    double null_data_prob{0};\n+    double pubkey_prob{0};\n+    double pubkeyhash_prob{0};\n+    double scripthash_prob{0};\n+    double witness_v1_taproot_prob{0};\n+    double witness_v0_keyhash_prob{0};\n+    double witness_v0_scripthash_prob{0};\n+    double witness_unknown_prob{0};\n+    double nonstandard_prob{0};\n+\n+    //! tuning\n+    size_t tx_count{0};\n+    double geometric_base_prob{0.5};\n+};\n+\n+/* purely legacy outputs, useful for pre-SegWit baselines */\n+inline constexpr ScriptRecipe kLegacy{\n+    .anchor_prob = 0.00,\n+    .multisig_prob = 0.05,\n+    .null_data_prob = 0.005,\n+    .pubkey_prob = 0.10,\n+    .pubkeyhash_prob = 0.20,\n+    .scripthash_prob = 0.10,\n+    .witness_v1_taproot_prob = 0.00,\n+    .witness_v0_keyhash_prob = 0.00,\n+    .witness_v0_scripthash_prob = 0.00,\n+    .witness_unknown_prob = 0.00,\n+    .nonstandard_prob = 0.005,\n+\n+    .tx_count = 1500,\n+};\n+\n+/* witness-heavy mix (roughly Taproot-era main chain) */\n+inline constexpr ScriptRecipe kWitness{\n+    .anchor_prob = 0.001,\n+    .multisig_prob = 0.005,\n+    .null_data_prob = 0.002,\n+    .pubkey_prob = 0.001,\n+    .pubkeyhash_prob = 0.02,\n+    .scripthash_prob = 0.01,\n+    .witness_v1_taproot_prob = 0.20,\n+    .witness_v0_keyhash_prob = 0.25,\n+    .witness_v0_scripthash_prob = 0.05,\n+    .witness_unknown_prob = 0.02,\n+    .nonstandard_prob = 0.02,\n+\n+    .tx_count = 2000,\n+};\n+\n+DataStream GetBlockData(\n+    const CChainParams& chain_params = *CChainParams::RegTest(CChainParams::RegTestOptions{}),\n+    const ScriptRecipe& = kWitness,\n+    const uint256& seed = {}\n+);\n+CBlock GetBlock(",
      "path": "src/bench/block_generator.h",
      "position": 1,
      "original_position": 74,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641210291,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, extracted this to a separate commit where we're wrapping the previous behavior first to separate the introduction of the generator from applying it.",
      "created_at": "2026-02-16T13:06:24Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812350463",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812350463"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 69,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812413904",
      "pull_request_review_id": 3808232123,
      "id": 2812413904,
      "node_id": "PRRC_kwDOABII586nogfQ",
      "diff_hunk": "@@ -35,17 +35,18 @@\n  */\n static void LoadExternalBlockFile(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};",
      "path": "src/bench/load_external.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641223542,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah, that's why I switched to `REGTEST`. `GenerateBlock*` does nonce search in setup, and we don't want to do that on `MAIN` difficulty - updated the code and commit message to spell that out.\r\n\r\nI have played with your suggestions but it seemed to me the `assert(chain_params.IsTestChain())` in `BuildBlock` should make that clear - and it's not the place to validate `GetConsensus().powLimit` values here.",
      "created_at": "2026-02-16T13:21:26Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812413904",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812413904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 38,
      "original_start_line": 38,
      "start_side": "LEFT",
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812420351",
      "pull_request_review_id": 3808232123,
      "id": 2812420351,
      "node_id": "PRRC_kwDOABII586noiD_",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 142,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641285591,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added genesis as `hashPrevBlock`, thanks. ",
      "created_at": "2026-02-16T13:22:32Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812420351",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812420351"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 140,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812425850",
      "pull_request_review_id": 3808232123,
      "id": 2812425850,
      "node_id": "PRRC_kwDOABII586nojZ6",
      "diff_hunk": "@@ -19,32 +19,26 @@\n #include <memory>\n #include <vector>\n \n-static CBlock CreateTestBlock()\n-{\n-    DataStream stream{benchmark::data::block413567};\n-    CBlock block;\n-    stream >> TX_WITH_WITNESS(block);\n-    return block;\n-}\n-\n static void WriteBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const CBlock block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     bench.run([&] {\n-        const auto pos{blockman.WriteBlock(block, 413'567)};\n+        const auto pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};\n         assert(!pos.IsNull());\n     });\n }\n \n static void ReadBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const auto& test_block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     const auto& expected_hash{test_block.GetHash()};\n-    const auto& pos{blockman.WriteBlock(test_block, 413'567)};\n+    const auto& pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};",
      "path": "src/bench/readwriteblock.cpp",
      "position": 53,
      "original_position": 46,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641314769,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we have a generis now so kept the 1 - thanks!",
      "created_at": "2026-02-16T13:23:34Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812425850",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812425850"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 34,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812473647",
      "pull_request_review_id": 3808232123,
      "id": 2812473647,
      "node_id": "PRRC_kwDOABII586novEv",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641357046,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "thanks, added it with 50% probability (and changed the magic numbers to use `SECP256K1_TAG_PUBKEY_UNCOMPRESSED`/`SECP256K1_TAG_PUBKEY_EVEN`/`SECP256K1_TAG_PUBKEY_ODD` constants instead. This required linking `secp256k1` to `bench_bitcoin`)",
      "created_at": "2026-02-16T13:35:40Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812473647",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812473647"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812712687",
      "pull_request_review_id": 3808232123,
      "id": 2812712687,
      "node_id": "PRRC_kwDOABII586nppbv",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));",
      "path": "src/bench/block_generator.cpp",
      "position": 164,
      "original_position": 93,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2641410600,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I have added https://github.com/bitcoin/bitcoin/blob/37cc2a2d953c072a236b657bfd7de5167092a47a/src/validation.cpp#L4076 which runs `CheckWitnessMalleation` validation here, thanks for the comment",
      "created_at": "2026-02-16T14:31:25Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812712687",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812712687"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 164,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812728314",
      "pull_request_review_id": 3808232123,
      "id": 2812728314,
      "node_id": "PRRC_kwDOABII586nptP6",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};",
      "path": "src/bench/block_generator.cpp",
      "position": 150,
      "original_position": 82,
      "commit_id": "ea001f66246597a050cfe1f080592cc0da17ebc9",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": 2644156219,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> It seems more precise to have rec.tx_occupancy_limit between 0.0-1.0 \r\n\r\nThe occupancy limit would be a cool solution to make sure this always generates a valid block, but it's not a real property of the blocks. I have also simplified generation a bit more so that a single seed generates all values now.\r\n\r\nI would expect users to create a block by setting exact values or just a seed and experiment until they get one that fits their needs - which should deterministically work after that. For example find heavier scripts to temporarily stress their optimizations or set the values manually. \r\n\r\n> When experimenting with changing the scripts I hit block size limits with just 2000 transactions due to large scripts.\r\n\r\nI have added a `block_generator_multiple_seed_sanity` to help us discover these invalid setups anyway.\r\n\r\n",
      "created_at": "2026-02-16T14:35:01Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812728314",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812728314"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 150,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812731236",
      "pull_request_review_id": 3808232123,
      "id": 2812731236,
      "node_id": "PRRC_kwDOABII586npt9k",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty\n+    block.nNonce = rng.rand32();\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    while (!CheckProofOfWork(block.GetHash(), block.nBits, params.GetConsensus())) {\n+        ++block.nNonce;\n+    }\n+\n+    // Make sure we've generated a valid block",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 149,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2784493271,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Reworded it, thanks",
      "created_at": "2026-02-16T14:35:38Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2812731236",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2812731236"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813055497",
      "pull_request_review_id": 3808232123,
      "id": 2813055497,
      "node_id": "PRRC_kwDOABII586nq9IJ",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 56,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2784737375,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "With a fixed tx_count, even a few rare huge OP_RETURNs can push the block overweight and make the generator fail deterministically for the default seed. \r\nBut I've bumped it a tiny bit and added better comment:\r\n```C++\r\nconst auto len{1 + rng.randrange<size_t>(100)}; // can exceed pre-v30 OP_RETURN 83-byte policy limits\r\n```",
      "created_at": "2026-02-16T15:45:49Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2813055497",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813055497"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 56,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813111655",
      "pull_request_review_id": 3808232123,
      "id": 2813111655,
      "node_id": "PRRC_kwDOABII586nrK1n",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 104,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2792800008,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I think it would be better to require that ScriptRecipe probabilities add up to ~1.0 and not generate random scripts as a fallback.\r\n\r\nGood idea, added `random_script_prob` to make this explicit.",
      "created_at": "2026-02-16T15:58:55Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2813111655",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813111655"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": 103,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 104,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813167827",
      "pull_request_review_id": 3808232123,
      "id": 2813167827,
      "node_id": "PRRC_kwDOABII586nrYjT",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();",
      "path": "src/bench/block_generator.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2792847114,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good point, split `rand_lock_script` and `rand_unlock_script` with very simple differentiation.\r\nBut the above implementation scares me, not sure we need that at this stage.\r\nFor this PR I want to keep generation self-contained and cheap, but I can imagine a bench+test helper in a follow-up where we can gradually make them more and more realistic.\r\nThanks for spending so much time on this!",
      "created_at": "2026-02-16T16:12:55Z",
      "updated_at": "2026-02-16T17:09:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2813167827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2813167827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    }
  ]
}